<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Análisis de Datos con Stata, R y Python</title>
  <meta name="description" content="Análisis de Datos con Stata, R y Python" />
  <meta name="generator" content="bookdown #bookdown:version# and GitBook 2.6.7" />

  <meta property="og:title" content="Análisis de Datos con Stata, R y Python" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Análisis de Datos con Stata, R y Python" />
  
  
  

<meta name="author" content="" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



<!--bookdown:title:start-->
<div id="header">
<h1 class="title">Análisis de Datos con Stata, R y Python</h1>
<p class="author"><em></em></p>
</div>
<!--bookdown:title:end-->

<!--bookdown:toc:start-->
  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">
<!--bookdown:toc2:start-->
<ul>
<li><a href="#prólogo" id="toc-prólogo"><span class="toc-section-number">1</span> Prólogo</a></li>
<li><a href="#análisis-de-datos-con-r" id="toc-análisis-de-datos-con-r"><span class="toc-section-number">2</span> Análisis de datos con R</a>
<ul>
<li><a href="#introducción-a-r-y-rstudio" id="toc-introducción-a-r-y-rstudio"><span class="toc-section-number">2.1</span> Introducción a R y RStudio</a>
<ul>
<li><a href="#por-qué-utilizar-r-como-lenguaje-de-programación" id="toc-por-qué-utilizar-r-como-lenguaje-de-programación"><span class="toc-section-number">2.1.1</span> ¿Por qué utilizar R como lenguaje de programación?</a></li>
<li><a href="#términos-clave-y-recurrentes-a-lo-largo-del-curso" id="toc-términos-clave-y-recurrentes-a-lo-largo-del-curso"><span class="toc-section-number">2.1.2</span> Términos clave y recurrentes a lo largo del curso</a></li>
<li><a href="#recursos-de-aprendizaje" id="toc-recursos-de-aprendizaje"><span class="toc-section-number">2.1.3</span> Recursos de Aprendizaje</a></li>
<li><a href="#interfaz-rstudio" id="toc-interfaz-rstudio"><span class="toc-section-number">2.1.4</span> Interfaz RStudio</a></li>
<li><a href="#instalación-de-paquetes-y-ayuda" id="toc-instalación-de-paquetes-y-ayuda"><span class="toc-section-number">2.1.5</span> Instalación de paquetes y ayuda</a></li>
<li><a href="#manipulación-de-objetos" id="toc-manipulación-de-objetos"><span class="toc-section-number">2.1.6</span> Manipulación de objetos</a></li>
<li><a href="#tipos-de-objetos" id="toc-tipos-de-objetos"><span class="toc-section-number">2.1.7</span> Tipos de objetos</a></li>
</ul></li>
<li><a href="#herramientas-de-programación" id="toc-herramientas-de-programación"><span class="toc-section-number">2.2</span> Herramientas de programación</a>
<ul>
<li><a href="#objetos-adicionales" id="toc-objetos-adicionales"><span class="toc-section-number">2.2.1</span> Objetos adicionales</a></li>
<li><a href="#acceder-a-elementos-de-un-objeto" id="toc-acceder-a-elementos-de-un-objeto"><span class="toc-section-number">2.2.2</span> Acceder a elementos de un objeto</a></li>
<li><a href="#tipos-de-objetos-y-datos" id="toc-tipos-de-objetos-y-datos"><span class="toc-section-number">2.2.3</span> Tipos de objetos y datos</a></li>
<li><a href="#herramientas-en-r" id="toc-herramientas-en-r"><span class="toc-section-number">2.2.4</span> Herramientas en R</a></li>
</ul></li>
<li><a href="#manipulación-de-bases-de-datos-parte-i" id="toc-manipulación-de-bases-de-datos-parte-i"><span class="toc-section-number">2.3</span> Manipulación de bases de datos (Parte I)</a>
<ul>
<li><a href="#principios-de-programación" id="toc-principios-de-programación"><span class="toc-section-number">2.3.1</span> Principios de programación</a></li>
<li><a href="#manipulacion-de-bases-de-datos-en-r" id="toc-manipulacion-de-bases-de-datos-en-r"><span class="toc-section-number">2.3.2</span> Manipulacion de bases de datos en R</a></li>
</ul></li>
<li><a href="#manipulación-de-bases-de-datos-parte-ii" id="toc-manipulación-de-bases-de-datos-parte-ii"><span class="toc-section-number">2.4</span> Manipulación de bases de datos (Parte II)</a>
<ul>
<li><a href="#funciones-clave" id="toc-funciones-clave"><span class="toc-section-number">2.4.1</span> Funciones clave</a></li>
<li><a href="#operador-piping" id="toc-operador-piping"><span class="toc-section-number">2.4.2</span> Operador piping</a></li>
<li><a href="#proceso-de-análisis-de-datos-parte-i-cargar-inspeccionar-y-limpiar" id="toc-proceso-de-análisis-de-datos-parte-i-cargar-inspeccionar-y-limpiar"><span class="toc-section-number">2.4.3</span> Proceso de análisis de datos (Parte I): cargar, inspeccionar y limpiar</a></li>
<li><a href="#proceso-de-análisis-de-datos-parte-ii-cargar-inspeccionar-y-limpiar" id="toc-proceso-de-análisis-de-datos-parte-ii-cargar-inspeccionar-y-limpiar"><span class="toc-section-number">2.4.4</span> Proceso de análisis de datos (Parte II): cargar, inspeccionar y limpiar</a></li>
</ul></li>
<li><a href="#manipulación-de-bases-de-datos-parte-iii" id="toc-manipulación-de-bases-de-datos-parte-iii"><span class="toc-section-number">2.5</span> Manipulación de bases de datos (Parte III)</a>
<ul>
<li><a href="#crear-variables" id="toc-crear-variables"><span class="toc-section-number">2.5.1</span> Crear Variables</a></li>
<li><a href="#factores" id="toc-factores"><span class="toc-section-number">2.5.2</span> Factores</a></li>
<li><a href="#funciones-útiles-para-transformar-bases-de-datos" id="toc-funciones-útiles-para-transformar-bases-de-datos"><span class="toc-section-number">2.5.3</span> Funciones útiles para transformar bases de datos</a></li>
<li><a href="#cambio-de-formato-de-los-datos" id="toc-cambio-de-formato-de-los-datos"><span class="toc-section-number">2.5.4</span> Cambio de formato de los datos</a></li>
<li><a href="#juntar-bases-de-datos" id="toc-juntar-bases-de-datos"><span class="toc-section-number">2.5.5</span> Juntar bases de datos</a></li>
</ul></li>
<li><a href="#análisis-de-datos" id="toc-análisis-de-datos"><span class="toc-section-number">2.6</span> Análisis de datos</a>
<ul>
<li><a href="#inspección-de-datos" id="toc-inspección-de-datos"><span class="toc-section-number">2.6.1</span> Inspección de datos</a></li>
<li><a href="#estadística-descriptiva" id="toc-estadística-descriptiva"><span class="toc-section-number">2.6.2</span> Estadística descriptiva</a></li>
<li><a href="#tablas-de-frecuencia" id="toc-tablas-de-frecuencia"><span class="toc-section-number">2.6.3</span> Tablas de frecuencia</a></li>
<li><a href="#estadística-descriptiva-con-dplyr" id="toc-estadística-descriptiva-con-dplyr"><span class="toc-section-number">2.6.4</span> Estadística descriptiva con “dplyr”</a></li>
</ul></li>
<li><a href="#visualización" id="toc-visualización"><span class="toc-section-number">2.7</span> Visualización</a>
<ul>
<li><a href="#visualización-r-base" id="toc-visualización-r-base"><span class="toc-section-number">2.7.1</span> Visualización: R base</a></li>
<li><a href="#uso-paquete-ggplot" id="toc-uso-paquete-ggplot"><span class="toc-section-number">2.7.2</span> Uso paquete ggplot</a></li>
</ul></li>
<li><a href="#análisis-de-datos-y-generación-de-informes-con-r-markdown" id="toc-análisis-de-datos-y-generación-de-informes-con-r-markdown"><span class="toc-section-number">2.8</span> Análisis de datos y generación de informes con R Markdown</a>
<ul>
<li><a href="#test-de-hipótesis" id="toc-test-de-hipótesis"><span class="toc-section-number">2.8.1</span> Test de hipótesis</a></li>
<li><a href="#regresión-lineal-en-r" id="toc-regresión-lineal-en-r"><span class="toc-section-number">2.8.2</span> Regresión Lineal en R</a></li>
<li><a href="#r-markdown" id="toc-r-markdown"><span class="toc-section-number">2.8.3</span> R Markdown</a></li>
</ul></li>
</ul></li>
<li><a href="#análisis-de-datos-con-stata" id="toc-análisis-de-datos-con-stata"><span class="toc-section-number">3</span> Análisis de datos con STATA</a>
<ul>
<li><a href="#buenas-prácticas-de-programación-y-visualización-parte-i" id="toc-buenas-prácticas-de-programación-y-visualización-parte-i"><span class="toc-section-number">3.1</span> Buenas prácticas de programación y visualización (Parte I)</a>
<ul>
<li><a href="#introducción" id="toc-introducción"><span class="toc-section-number">3.1.1</span> Introducción</a></li>
<li><a href="#estilo-de-codificación-en-stata" id="toc-estilo-de-codificación-en-stata"><span class="toc-section-number">3.1.2</span> Estilo de codificación en Stata</a></li>
</ul></li>
<li><a href="#buenas-practicas-de-programación-y-visualización-parte-ii" id="toc-buenas-practicas-de-programación-y-visualización-parte-ii"><span class="toc-section-number">3.2</span> Buenas practicas de programación y visualización (Parte II)</a>
<ul>
<li><a href="#organización-de-un-proyecto-en-stata" id="toc-organización-de-un-proyecto-en-stata"><span class="toc-section-number">3.2.1</span> Organización de un proyecto en Stata</a></li>
<li><a href="#buenas-practicas-de-visualización" id="toc-buenas-practicas-de-visualización"><span class="toc-section-number">3.2.2</span> Buenas practicas de visualización</a></li>
<li><a href="#sublime-text" id="toc-sublime-text"><span class="toc-section-number">3.2.3</span> Sublime Text</a></li>
</ul></li>
<li><a href="#programar-do---files-parte-i" id="toc-programar-do---files-parte-i"><span class="toc-section-number">3.3</span> Programar do - files (Parte I)</a>
<ul>
<li><a href="#programar-en-stata" id="toc-programar-en-stata"><span class="toc-section-number">3.3.1</span> Programar en Stata</a></li>
<li><a href="#comandos-y-funciones-claves-y-algunos-detalles" id="toc-comandos-y-funciones-claves-y-algunos-detalles"><span class="toc-section-number">3.3.2</span> Comandos y funciones claves (y algunos detalles)}</a></li>
<li><a href="#macros-locales-y-globales" id="toc-macros-locales-y-globales"><span class="toc-section-number">3.3.3</span> Macros locales y globales</a></li>
</ul></li>
<li><a href="#programar-do---files-parte-ii" id="toc-programar-do---files-parte-ii"><span class="toc-section-number">3.4</span> Programar do - files (Parte II)</a>
<ul>
<li><a href="#estructuras-de-datos" id="toc-estructuras-de-datos"><span class="toc-section-number">3.4.1</span> Estructuras de datos</a></li>
<li><a href="#iteradores-1" id="toc-iteradores-1"><span class="toc-section-number">3.4.2</span> Iteradores</a></li>
<li><a href="#manejo-de-bases-de-datos" id="toc-manejo-de-bases-de-datos"><span class="toc-section-number">3.4.3</span> Manejo de bases de datos</a></li>
</ul></li>
<li><a href="#programar-ado---files-parte-i" id="toc-programar-ado---files-parte-i"><span class="toc-section-number">3.5</span> Programar ado - files (Parte I)</a>
<ul>
<li><a href="#escribir-programas-en-stata" id="toc-escribir-programas-en-stata"><span class="toc-section-number">3.5.1</span> Escribir programas en Stata</a></li>
<li><a href="#por-qué-escribir-programas-abstracción" id="toc-por-qué-escribir-programas-abstracción"><span class="toc-section-number">3.5.2</span> ¿Por qué escribir programas?: Abstracción</a></li>
<li><a href="#mis-primeros-programas-en-stata" id="toc-mis-primeros-programas-en-stata"><span class="toc-section-number">3.5.3</span> Mis primeros programas en Stata</a></li>
<li><a href="#programa-con-distintos-argumentos" id="toc-programa-con-distintos-argumentos"><span class="toc-section-number">3.5.4</span> Programa con distintos argumentos</a></li>
<li><a href="#opción-syntax" id="toc-opción-syntax"><span class="toc-section-number">3.5.5</span> Opción Syntax</a></li>
<li><a href="#return" id="toc-return"><span class="toc-section-number">3.5.6</span> Return</a></li>
<li><a href="#implementar-opciones-al-programa" id="toc-implementar-opciones-al-programa"><span class="toc-section-number">3.5.7</span> Implementar opciones al programa</a></li>
<li><a href="#incluir-ifin-al-programa" id="toc-incluir-ifin-al-programa"><span class="toc-section-number">3.5.8</span> Incluir if/in al programa</a></li>
<li><a href="#generalizar-el-comando-para-incluir-múltiples-variables" id="toc-generalizar-el-comando-para-incluir-múltiples-variables"><span class="toc-section-number">3.5.9</span> Generalizar el comando para incluir múltiples variables</a></li>
<li><a href="#agregar-prefijos-a-los-programas" id="toc-agregar-prefijos-a-los-programas"><span class="toc-section-number">3.5.10</span> Agregar prefijos a los programas</a></li>
<li><a href="#programas-para-complementar-función-egen" id="toc-programas-para-complementar-función-egen"><span class="toc-section-number">3.5.11</span> Programas para complementar función egen</a></li>
</ul></li>
<li><a href="#programar-ado---files-parte-ii" id="toc-programar-ado---files-parte-ii"><span class="toc-section-number">3.6</span> Programar ado - files (Parte II)</a>
<ul>
<li><a href="#syntax" id="toc-syntax"><span class="toc-section-number">3.6.1</span> Syntax</a></li>
<li><a href="#varlist" id="toc-varlist"><span class="toc-section-number">3.6.2</span> Varlist</a></li>
<li><a href="#opciones" id="toc-opciones"><span class="toc-section-number">3.6.3</span> Opciones</a></li>
<li><a href="#programa-para-calcular-percentiles" id="toc-programa-para-calcular-percentiles"><span class="toc-section-number">3.6.4</span> Programa para calcular percentiles</a></li>
<li><a href="#programa-con-opción-return" id="toc-programa-con-opción-return"><span class="toc-section-number">3.6.5</span> Programa con opción return</a></li>
<li><a href="#agregar-opciones-al-programa" id="toc-agregar-opciones-al-programa"><span class="toc-section-number">3.6.6</span> Agregar opciones al programa</a></li>
<li><a href="#generalizar-el-comando-para-incluir-múltiples-variables-1" id="toc-generalizar-el-comando-para-incluir-múltiples-variables-1"><span class="toc-section-number">3.6.7</span> Generalizar el comando para incluir múltiples variables</a></li>
<li><a href="#agregar-prefijos-a-los-programas-1" id="toc-agregar-prefijos-a-los-programas-1"><span class="toc-section-number">3.6.8</span> Agregar prefijos a los programas</a></li>
<li><a href="#programas-para-complementar-función-egen-1" id="toc-programas-para-complementar-función-egen-1"><span class="toc-section-number">3.6.9</span> Programas para complementar función egen</a></li>
<li><a href="#generalización-de-la-función-egen" id="toc-generalización-de-la-función-egen"><span class="toc-section-number">3.6.10</span> Generalización de la función egen</a></li>
<li><a href="#documentar-tu-programa" id="toc-documentar-tu-programa"><span class="toc-section-number">3.6.11</span> Documentar tu programa</a></li>
<li><a href="#escribir-programas-e-class" id="toc-escribir-programas-e-class"><span class="toc-section-number">3.6.12</span> Escribir programas e-class</a></li>
</ul></li>
<li><a href="#programar-ado---files-parte-iii" id="toc-programar-ado---files-parte-iii"><span class="toc-section-number">3.7</span> Programar ado - files (Parte III)</a>
<ul>
<li><a href="#marksample-mark-y-markout" id="toc-marksample-mark-y-markout"><span class="toc-section-number">3.7.1</span> Marksample, Mark y Markout</a></li>
<li><a href="#sortpreserve" id="toc-sortpreserve"><span class="toc-section-number">3.7.2</span> Sortpreserve</a></li>
<li><a href="#mata" id="toc-mata"><span class="toc-section-number">3.7.3</span> Mata</a></li>
</ul></li>
<li><a href="#exportar-información" id="toc-exportar-información"><span class="toc-section-number">3.8</span> Exportar Información</a>
<ul>
<li><a href="#stata-markdown" id="toc-stata-markdown"><span class="toc-section-number">3.8.1</span> Stata Markdown</a></li>
<li><a href="#putdocx" id="toc-putdocx"><span class="toc-section-number">3.8.2</span> Putdocx</a></li>
</ul></li>
<li><a href="#manejo-de-grandes-bases-de-datos-en-stata" id="toc-manejo-de-grandes-bases-de-datos-en-stata"><span class="toc-section-number">3.9</span> Manejo de grandes bases de datos en Stata</a>
<ul>
<li><a href="#estilo-de-codificación-mejorar-velocidad-y-eficiencia" id="toc-estilo-de-codificación-mejorar-velocidad-y-eficiencia"><span class="toc-section-number">3.9.1</span> Estilo de codificación: mejorar velocidad y eficiencia</a></li>
<li><a href="#cargar-grandes-bases-de-datos" id="toc-cargar-grandes-bases-de-datos"><span class="toc-section-number">3.9.2</span> Cargar grandes bases de datos</a></li>
<li><a href="#reducir-el-uso-de-memoria" id="toc-reducir-el-uso-de-memoria"><span class="toc-section-number">3.9.3</span> Reducir el uso de memoria</a></li>
<li><a href="#reducir-el-tamaño-de-la-base-de-datos" id="toc-reducir-el-tamaño-de-la-base-de-datos"><span class="toc-section-number">3.9.4</span> Reducir el tamaño de la base de datos</a></li>
<li><a href="#eliminar-siempre-resultados-intermedios-incluso-temporales" id="toc-eliminar-siempre-resultados-intermedios-incluso-temporales"><span class="toc-section-number">3.9.5</span> Eliminar siempre resultados intermedios, incluso temporales</a></li>
<li><a href="#dividir-en-trozos-cuando-sea-posible" id="toc-dividir-en-trozos-cuando-sea-posible"><span class="toc-section-number">3.9.6</span> Dividir en trozos cuando sea posible</a></li>
<li><a href="#sort" id="toc-sort"><span class="toc-section-number">3.9.7</span> Sort</a></li>
<li><a href="#selección-de-muestra" id="toc-selección-de-muestra"><span class="toc-section-number">3.9.8</span> Selección de muestra</a></li>
<li><a href="#precaución-con-reshape" id="toc-precaución-con-reshape"><span class="toc-section-number">3.9.9</span> Precaución con reshape</a></li>
<li><a href="#subexpresiones-comunes" id="toc-subexpresiones-comunes"><span class="toc-section-number">3.9.10</span> Subexpresiones comunes</a></li>
<li><a href="#recomendaciones-adicionales" id="toc-recomendaciones-adicionales"><span class="toc-section-number">3.9.11</span> Recomendaciones Adicionales</a></li>
<li><a href="#resumen" id="toc-resumen"><span class="toc-section-number">3.9.12</span> Resumen</a></li>
</ul></li>
</ul></li>
<li><a href="#análisis-de-datos-con-python" id="toc-análisis-de-datos-con-python"><span class="toc-section-number">4</span> Análisis de Datos con Python</a>
<ul>
<li><a href="#introducción-al-análisis-de-datos-con-python" id="toc-introducción-al-análisis-de-datos-con-python"><span class="toc-section-number">4.1</span> Introducción al análisis de datos con Python</a>
<ul>
<li><a href="#antes-de-partir-con-python" id="toc-antes-de-partir-con-python"><span class="toc-section-number">4.1.1</span> Antes de partir con Python…</a></li>
<li><a href="#atajos" id="toc-atajos"><span class="toc-section-number">4.1.2</span> Atajos</a></li>
<li><a href="#extensiones-de-jupyter-notebook" id="toc-extensiones-de-jupyter-notebook"><span class="toc-section-number">4.1.3</span> Extensiones de Jupyter Notebook</a></li>
<li><a href="#sintaxis-básica" id="toc-sintaxis-básica"><span class="toc-section-number">4.1.4</span> Sintaxis básica</a></li>
<li><a href="#variables-y-objetos" id="toc-variables-y-objetos"><span class="toc-section-number">4.1.5</span> Variables y objetos</a></li>
<li><a href="#operadores" id="toc-operadores"><span class="toc-section-number">4.1.6</span> Operadores</a></li>
<li><a href="#estructuras-de-datos-listas-tuplas-conjuntos-diccionarios" id="toc-estructuras-de-datos-listas-tuplas-conjuntos-diccionarios"><span class="toc-section-number">4.1.7</span> Estructuras de datos: listas, tuplas, conjuntos, diccionarios</a></li>
<li><a href="#funciones-2" id="toc-funciones-2"><span class="toc-section-number">4.1.8</span> Funciones</a></li>
<li><a href="#methods" id="toc-methods"><span class="toc-section-number">4.1.9</span> Methods</a></li>
<li><a href="#paquetes" id="toc-paquetes"><span class="toc-section-number">4.1.10</span> Paquetes</a></li>
</ul></li>
<li><a href="#librerias-principales-de-python---numpy-matplotlib-pandas" id="toc-librerias-principales-de-python---numpy-matplotlib-pandas"><span class="toc-section-number">4.2</span> Librerías principales de Python - Numpy, Matplotlib, Pandas</a>
<ul>
<li><a href="#numpy" id="toc-numpy"><span class="toc-section-number">4.2.1</span> NumPy</a></li>
<li><a href="#matplotlib" id="toc-matplotlib"><span class="toc-section-number">4.2.2</span> Matplotlib</a></li>
<li><a href="#pandas" id="toc-pandas"><span class="toc-section-number">4.2.3</span> Pandas</a></li>
</ul></li>
<li><a href="#herramientas-de-programación-1" id="toc-herramientas-de-programación-1"><span class="toc-section-number">4.3</span> Herramientas de programación</a>
<ul>
<li><a href="#controladores-de-flujo" id="toc-controladores-de-flujo"><span class="toc-section-number">4.3.1</span> Controladores de flujo</a></li>
<li><a href="#if-elif-else" id="toc-if-elif-else"><span class="toc-section-number">4.3.2</span> if-elif-else</a></li>
<li><a href="#iteradores-básicos" id="toc-iteradores-básicos"><span class="toc-section-number">4.3.3</span> Iteradores básicos</a></li>
<li><a href="#iteradores-adicionales-en-python" id="toc-iteradores-adicionales-en-python"><span class="toc-section-number">4.3.4</span> Iteradores adicionales en Python</a></li>
<li><a href="#list-comprehension" id="toc-list-comprehension"><span class="toc-section-number">4.3.5</span> List Comprehension</a></li>
<li><a href="#generadores" id="toc-generadores"><span class="toc-section-number">4.3.6</span> Generadores</a></li>
<li><a href="#funciones-3" id="toc-funciones-3"><span class="toc-section-number">4.3.7</span> Funciones</a></li>
</ul></li>
<li><a href="#manipulación-de-bases-de-datos-parte-i-1" id="toc-manipulación-de-bases-de-datos-parte-i-1"><span class="toc-section-number">4.4</span> Manipulación de bases de datos (Parte I)</a>
<ul>
<li><a href="#importar-e-inspeccionar-datos-repaso" id="toc-importar-e-inspeccionar-datos-repaso"><span class="toc-section-number">4.4.1</span> Importar e inspeccionar datos (repaso)</a></li>
<li><a href="#manipular-repaso" id="toc-manipular-repaso"><span class="toc-section-number">4.4.2</span> Manipular (repaso)</a></li>
<li><a href="#agrupar-calculos" id="toc-agrupar-calculos"><span class="toc-section-number">4.4.3</span> Agrupar calculos</a></li>
<li><a href="#aplicar-funciones" id="toc-aplicar-funciones"><span class="toc-section-number">4.4.4</span> Aplicar funciones</a></li>
<li><a href="#datos-como-tablas-problemas-y-soluciones" id="toc-datos-como-tablas-problemas-y-soluciones"><span class="toc-section-number">4.4.5</span> Datos como tablas: problemas y soluciones</a></li>
<li><a href="#concatenar-data-frames" id="toc-concatenar-data-frames"><span class="toc-section-number">4.4.6</span> Concatenar data frames</a></li>
</ul></li>
<li><a href="#manipulación-de-bases-de-datos-parte-ii-1" id="toc-manipulación-de-bases-de-datos-parte-ii-1"><span class="toc-section-number">4.5</span> Manipulación de bases de datos (Parte II)</a>
<ul>
<li><a href="#aplicar-funciones-a-columnas-de-una-base-de-datos" id="toc-aplicar-funciones-a-columnas-de-una-base-de-datos"><span class="toc-section-number">4.5.1</span> Aplicar funciones a columnas de una base de datos</a></li>
<li><a href="#dividir-una-base-de-datos-por-grupos" id="toc-dividir-una-base-de-datos-por-grupos"><span class="toc-section-number">4.5.2</span> Dividir una base de datos por grupos</a></li>
<li><a href="#librería-datetime" id="toc-librería-datetime"><span class="toc-section-number">4.5.3</span> Librería datetime</a></li>
<li><a href="#reestructurar-un-dataframe" id="toc-reestructurar-un-dataframe"><span class="toc-section-number">4.5.4</span> Reestructurar un DataFrame</a></li>
<li><a href="#reestructurar-datos-para-arreglar-posibles-problemas" id="toc-reestructurar-datos-para-arreglar-posibles-problemas"><span class="toc-section-number">4.5.5</span> Reestructurar datos para arreglar posibles problemas</a></li>
<li><a href="#missing-values-2" id="toc-missing-values-2"><span class="toc-section-number">4.5.6</span> Missing values</a></li>
<li><a href="#juntar-bases-de-datos-merge-y-append" id="toc-juntar-bases-de-datos-merge-y-append"><span class="toc-section-number">4.5.7</span> Juntar bases de datos: merge y append</a></li>
</ul></li>
<li><a href="#análisis-de-datos-parte-i" id="toc-análisis-de-datos-parte-i"><span class="toc-section-number">4.6</span> Análisis de datos (Parte I)</a>
<ul>
<li><a href="#estadistica-descriptiva" id="toc-estadistica-descriptiva"><span class="toc-section-number">4.6.1</span> Estadistica Descriptiva</a></li>
<li><a href="#la-distribución-normal" id="toc-la-distribución-normal"><span class="toc-section-number">4.6.2</span> La distribución normal</a></li>
<li><a href="#test-de-hipotesis" id="toc-test-de-hipotesis"><span class="toc-section-number">4.6.3</span> Test de hipotesis</a></li>
<li><a href="#ejemplo-1-resumen-exploratorio-de-datos" id="toc-ejemplo-1-resumen-exploratorio-de-datos"><span class="toc-section-number">4.6.4</span> Ejemplo 1: resumen exploratorio de datos</a></li>
<li><a href="#ejemplo-2-datos-con-precios-de-casas" id="toc-ejemplo-2-datos-con-precios-de-casas"><span class="toc-section-number">4.6.5</span> Ejemplo 2: datos con precios de casas</a></li>
<li><a href="#ejemplo-3" id="toc-ejemplo-3"><span class="toc-section-number">4.6.6</span> Ejemplo 3</a></li>
<li><a href="#ejemplo-4" id="toc-ejemplo-4"><span class="toc-section-number">4.6.7</span> Ejemplo 4</a></li>
<li><a href="#ejemplo-5-desigualdad-de-ingreso-usando-gapminder" id="toc-ejemplo-5-desigualdad-de-ingreso-usando-gapminder"><span class="toc-section-number">4.6.8</span> Ejemplo 5 : Desigualdad de ingreso usando Gapminder</a></li>
</ul></li>
<li><a href="#análisis-de-datos-parte-ii" id="toc-análisis-de-datos-parte-ii"><span class="toc-section-number">4.7</span> Análisis de datos (Parte II)</a>
<ul>
<li><a href="#optimización-con-scipy" id="toc-optimización-con-scipy"><span class="toc-section-number">4.7.1</span> Optimización con Scipy</a></li>
<li><a href="#modelo-de-regresión-lineal" id="toc-modelo-de-regresión-lineal"><span class="toc-section-number">4.7.2</span> Modelo de regresión lineal</a></li>
<li><a href="#una-simulación-de-montecarlo" id="toc-una-simulación-de-montecarlo"><span class="toc-section-number">4.7.3</span> Una simulación de montecarlo</a></li>
<li><a href="#bootstraping" id="toc-bootstraping"><span class="toc-section-number">4.7.4</span> Bootstraping</a></li>
<li><a href="#regresión-logistica" id="toc-regresión-logistica"><span class="toc-section-number">4.7.5</span> Regresión Logistica</a></li>
<li><a href="#matching" id="toc-matching"><span class="toc-section-number">4.7.6</span> Matching</a></li>
</ul></li>
<li><a href="#análisis-de-datos-parte-iii" id="toc-análisis-de-datos-parte-iii"><span class="toc-section-number">4.8</span> Análisis de Datos (Parte III)</a>
<ul>
<li><a href="#bootstraping-en-el-contexto-de-mco" id="toc-bootstraping-en-el-contexto-de-mco"><span class="toc-section-number">4.8.1</span> Bootstraping en el contexto de MCO</a></li>
<li><a href="#logit-probabilidad-de-sobrevivir-al-hundimiento-del-titanic" id="toc-logit-probabilidad-de-sobrevivir-al-hundimiento-del-titanic"><span class="toc-section-number">4.8.2</span> Logit: Probabilidad de sobrevivir al hundimiento del Titanic</a></li>
<li><a href="#gmm" id="toc-gmm"><span class="toc-section-number">4.8.3</span> GMM</a></li>
<li><a href="#diferencias-en-diferencias" id="toc-diferencias-en-diferencias"><span class="toc-section-number">4.8.4</span> Diferencias en Diferencias</a></li>
<li><a href="#plotly" id="toc-plotly"><span class="toc-section-number">4.8.5</span> Plotly</a></li>
<li><a href="#automatización-1" id="toc-automatización-1"><span class="toc-section-number">4.8.6</span> Automatización</a></li>
</ul></li>
<li><a href="#web-scraping-en-python" id="toc-web-scraping-en-python"><span class="toc-section-number">4.9</span> Web Scraping en Python</a>
<ul>
<li><a href="#introducción-3" id="toc-introducción-3"><span class="toc-section-number">4.9.1</span> Introducción</a></li>
<li><a href="#muchos-ejemplos-practicos-de-web---scraping" id="toc-muchos-ejemplos-practicos-de-web---scraping"><span class="toc-section-number">4.9.2</span> Muchos ejemplos practicos de Web - scraping</a></li>
<li><a href="#selenium" id="toc-selenium"><span class="toc-section-number">4.9.3</span> Selenium</a></li>
</ul></li>
</ul></li>
<li><a href="#referencias" id="toc-referencias"><span class="toc-section-number">5</span> Referencias</a>
<ul>
<li><a href="#including-plots" id="toc-including-plots"><span class="toc-section-number">5.1</span> Including Plots</a></li>
</ul></li>
</ul>
<!--bookdown:toc2:end-->
      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Análisis de Datos con Stata, R y Python</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<!--bookdown:toc:end-->
<!--bookdown:body:start-->
<div id="prólogo" class="section level1 hasAnchor" number="1">
<h1 class="hasAnchor"><span class="header-section-number">1</span> Prólogo<a href="#prólogo" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<!--chapter:end:index.Rmd-->
</div>
<div id="análisis-de-datos-con-r" class="section level1 hasAnchor" number="2">
<h1 class="hasAnchor"><span class="header-section-number">2</span> Análisis de datos con R<a href="#análisis-de-datos-con-r" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="introducción-a-r-y-rstudio" class="section level2 hasAnchor" number="2.1">
<h2 class="hasAnchor"><span class="header-section-number">2.1</span> Introducción a R y RStudio<a href="#introducción-a-r-y-rstudio" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="por-qué-utilizar-r-como-lenguaje-de-programación" class="section level3 hasAnchor" number="2.1.1">
<h3 class="hasAnchor"><span class="header-section-number">2.1.1</span> ¿Por qué utilizar R como lenguaje de programación?<a href="#por-qué-utilizar-r-como-lenguaje-de-programación" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li><strong>Código abierto:</strong> no tiene costo.</li>
<li><strong>Versátil:</strong> análisis estadístico y econométrico + tareas de programación.</li>
<li><strong>Flexible y reproducible:</strong> garantiza reproducibilidad, es flexible ante cambios y detección de errores de forma más sencilla (ej.Excel).</li>
<li><strong>Demandado:</strong> solicitado en el mercado laboral.</li>
</ol>
</div>
<div id="términos-clave-y-recurrentes-a-lo-largo-del-curso" class="section level3 hasAnchor" number="2.1.2">
<h3 class="hasAnchor"><span class="header-section-number">2.1.2</span> Términos clave y recurrentes a lo largo del curso<a href="#términos-clave-y-recurrentes-a-lo-largo-del-curso" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><strong>RStudio:</strong> Interfaz Gráfica para el usuario. Esta diseñada para un uso más sencillo de R.</li>
<li><strong>Objetos:</strong> Cualquier cosa que guardes en R. Por ejemplo: bases de datos, variables, listasdenombres, gráficos.</li>
<li><strong>Funciones:</strong> Una operación producida por un código tal que acepta insumos y retorna productos.</li>
<li><strong>Paquetes:</strong> Básicamente es un conjunto de funciones útiles para distintos propósitos.</li>
<li><strong>Scripts/Códigos:</strong> Documento que contiene todos los comandos utilizados en un proceso de análisis de datos.</li>
</ul>
</div>
<div id="recursos-de-aprendizaje" class="section level3 hasAnchor" number="2.1.3">
<h3 class="hasAnchor"><span class="header-section-number">2.1.3</span> Recursos de Aprendizaje<a href="#recursos-de-aprendizaje" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div style="text-align: justify">
<ul>
<li>Hojas de resumen: material disponible con un resumen de los principales comandos/paquetes/funciones para distintos temas. Disponibles en: <a href="https://www.rstudio.com/resources/cheatsheets/" class="uri">https://www.rstudio.com/resources/cheatsheets/</a></li>
</ul>
</div>
<ul>
<li>Foros y sitios web:
<ul>
<li><a href="https://stackoverflow.com/questions/tagged/r">Stackoverflow.</a></li>
<li><a href="https://preettheman.medium.com/awesome-tricks-every-r-coder-should-know-c4220cd2cfbc">Medium.</a></li>
<li><a href="https://posit.co/">El Blog de RStudio.</a></li>
</ul></li>
<li>Libros:
<ul>
<li><a href="https://r4ds.had.co.nz/">R for Data Science.</a></li>
<li><a href="https://posit.co/resources/videos/">Recursos sobre R en español.</a></li>
<li><a href="https://bookdown.org/">Bookdown.</a></li>
</ul></li>
</ul>
</div>
<div id="interfaz-rstudio" class="section level3 hasAnchor" number="2.1.4">
<h3 class="hasAnchor"><span class="header-section-number">2.1.4</span> Interfaz RStudio<a href="#interfaz-rstudio" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="cuatro-secciones-en-rstudio" class="section level4 hasAnchor" number="2.1.4.1">
<h4 class="hasAnchor"><span class="header-section-number">2.1.4.1</span> Cuatro secciones en Rstudio<a href="#cuatro-secciones-en-rstudio" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Las “más importantes” son: <em>scripts, consola y environment/files/plots/packages</em>.</p>
<p>Para personalizar RStudio hay que ir a: <strong>Tools -&gt; Global Options</strong>. Allí pueden cambiar el color del ambiente, tipo de letra, orden, etc. La idea es utilizar RStudio de la forma mas intuitiva para ustedes.</p>
</div>
<div id="escribir-comentarios" class="section level4 hasAnchor" number="2.1.4.2">
<h4 class="hasAnchor"><span class="header-section-number">2.1.4.2</span> Escribir comentarios<a href="#escribir-comentarios" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>(#)</code> para escribir comentarios en el script. Si quiero marcar varias lineas como comentario: <code>ctrl + shift + c</code></p>
</div>
<div id="índices" class="section level4 hasAnchor" number="2.1.4.3">
<h4 class="hasAnchor"><span class="header-section-number">2.1.4.3</span> Índices<a href="#índices" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Es importante escribir índices para documentar sus códigos. Para observarlo debo escribir: <code>ctrl + shift + o</code></p>
<p>Los títulos pueden estar jerarquizados:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># El mas importante</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Este es un poco menos importante</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="do">### Este es un poco menos importante que el anterior</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="do">#### El menos importante</span></span></code></pre></div>
<p>Es importante actualizarlo constantemente para no perder funcionalidad.</p>
</div>
</div>
<div id="instalación-de-paquetes-y-ayuda" class="section level3 hasAnchor" number="2.1.5">
<h3 class="hasAnchor"><span class="header-section-number">2.1.5</span> Instalación de paquetes y ayuda<a href="#instalación-de-paquetes-y-ayuda" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Los paquetes son basicamente conjuntos de funciones. Los paquetes se instalan una vez, pero se llaman siempre que se vayan a utilizar.</p>
<div id="librerías" class="section level4 hasAnchor" number="2.1.5.1">
<h4 class="hasAnchor"><span class="header-section-number">2.1.5.1</span> Librerías<a href="#librerías" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Esto se puede hacer de dos maneras:</p>
<ol style="list-style-type: decimal">
<li><p>Desde la pestaña <em>packages</em> en la esquina inferior derecha.</p></li>
<li><p>Con comandos</p></li>
</ol>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;dplyr&quot;</span>)</span></code></pre></div>
<p>Varios paquetes a la vez:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">&quot;dplyr&quot;</span>,<span class="st">&quot;ggplot2&quot;</span>,<span class="st">&quot;rio&quot;</span>))</span></code></pre></div>
<p>Error común:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;dplyr&quot;</span>, <span class="st">&quot;ggplot2&quot;</span>)</span></code></pre></div>
<p>Por lo general es bueno instalarlas desde el inicio del trabajo dado que comúnmente usamos las mismas librerías al realizar análisis de datos. Con esta función le decimos a R que instale el paquete si este no está instalado (algo típico cuando cambiamos de computador):</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(dplyr)) {<span class="fu">install.packages</span>(<span class="st">&quot;dplyr&quot;</span>)}</span></code></pre></div>
<p>Cargar librerías:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code></pre></div>
<p>Si queremos ver que hay dentro de cada paquete:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span>(<span class="st">&quot;package:dplyr&quot;</span>, <span class="at">all =</span> <span class="cn">TRUE</span>) <span class="co">#ls = list objects</span></span></code></pre></div>
<p><strong>Importante</strong>: el paquete debe ser instalado una vez, pero cargado cada vez que se utilice. Muchas veces hay actualizaciones. Para revisar e instalarlas.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">update.packages</span>()</span></code></pre></div>
<p>Alternativamente puedo conectar paquete con función utilizando <code>::</code>. Si hago esto no es necesario llamar a la librería para utilizar esa función en particular. No obstante, lo recomendable es cargar todas las librerías de los paquetes que voy a utilizar al inicio.</p>
</div>
<div id="función-de-ayuda" class="section level4 hasAnchor" number="2.1.5.2">
<h4 class="hasAnchor"><span class="header-section-number">2.1.5.2</span> Función de ayuda<a href="#función-de-ayuda" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Sobre una función en particular:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">help</span>(mean) </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>?mean </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>mean <span class="co">#pulsar la tecla F1 </span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>sd</span></code></pre></div>
<p>Sobre un paquete en particular:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">help</span>(<span class="st">&quot;dplyr&quot;</span>) </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="at">help=</span><span class="st">&quot;dplyr&quot;</span>)</span></code></pre></div>
</div>
<div id="shortcuts-útiles" class="section level4 hasAnchor" number="2.1.5.3">
<h4 class="hasAnchor"><span class="header-section-number">2.1.5.3</span> <em>Shortcuts</em> útiles<a href="#shortcuts-útiles" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><code>Esc</code>: interrumpir el comando actual</li>
<li><code>Ctrl + s</code>: guardar</li>
<li><code>tab</code>: autocompletar</li>
<li><code>Ctrl + Enter</code>: ejecutar línea</li>
<li><code>Ctrl + Shift + C</code>: comentar</li>
<li><code>&lt;-</code>: Alt + - / option + -</li>
<li><code>%&gt;%</code>: ctrl + shift + m (<em>pipe</em>)</li>
<li><code>Ctrl + l</code>: limpiar</li>
<li><code>Ctrl + alt + b</code>: ejecutar todo hasta aquí (flechas en la consola me permiten ver los últimos comandos utilizados).</li>
<li><code>Shift + lineas</code>: seleccionar varias lineas</li>
<li><code>Ctrl + f</code>: buscar/remplazar</li>
<li><code>Ctrl + "flecha arriba" en la consola</code>: ver comandos utilizados.</li>
</ul>
</div>
<div id="limpiar-environment-en-r" class="section level4 hasAnchor" number="2.1.5.4">
<h4 class="hasAnchor"><span class="header-section-number">2.1.5.4</span> Limpiar <em>“environment”</em> en R<a href="#limpiar-environment-en-r" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Eliminar todos los objetos:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>())</span></code></pre></div>
<p>Eliminar sólo un objeto:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(data1)</span></code></pre></div>
<p>Si quiero limpiar la consola tengo que apretar <code>Ctrl + L</code>.</p>
</div>
<div id="identificar-el-paquete-de-una-función" class="section level4 hasAnchor" number="2.1.5.5">
<h4 class="hasAnchor"><span class="header-section-number">2.1.5.5</span> Identificar el paquete de una función<a href="#identificar-el-paquete-de-una-función" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Hay ocasiones en que queremos saber de que paquete es una función determinada. Para ello, revisar: <a href="https://sebastiansauer.github.io/finds_funs/" class="uri">https://sebastiansauer.github.io/finds_funs/</a></p>
</div>
<div id="error-común" class="section level4 hasAnchor" number="2.1.5.6">
<h4 class="hasAnchor"><span class="header-section-number">2.1.5.6</span> Error común<a href="#error-común" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Por ejemplo:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="st">&quot;hola&quot;</span></span></code></pre></div>
<p>Noten que en la consola aparece un signo <code>+</code>. En estos casos RStudio se detiene porque probablemente se les olvido un <code>)</code> o bien un <code>#</code>. En estos casos hay que corregir el error para ejecutar nuevamente y luego apretar <code>esc</code> en la consola para seguir ejecutando los comandos.</p>
</div>
</div>
<div id="manipulación-de-objetos" class="section level3 hasAnchor" number="2.1.6">
<h3 class="hasAnchor"><span class="header-section-number">2.1.6</span> Manipulación de objetos<a href="#manipulación-de-objetos" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="usar-r-como-calculadoraejecutar-comandos" class="section level4 hasAnchor" number="2.1.6.1">
<h4 class="hasAnchor"><span class="header-section-number">2.1.6.1</span> Usar R como calculadora/ejecutar comandos<a href="#usar-r-como-calculadoraejecutar-comandos" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>De manera separada (seleccionar las <code>ordenes+ctrl+Enter</code>):</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">+</span><span class="dv">2</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span><span class="sc">*</span><span class="dv">5</span><span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)</span></code></pre></div>
<p>Ejecutar todas las instrucciones:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">+</span><span class="dv">2</span> ; <span class="dv">3</span><span class="sc">*</span><span class="dv">5</span><span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span><span class="sc">+</span><span class="dv">4</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span><span class="sc">*</span><span class="dv">4</span> </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span><span class="sc">/</span><span class="dv">4</span> </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span><span class="sc">^</span><span class="dv">7</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span><span class="sc">^</span><span class="dv">77</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="fu">log</span>(<span class="dv">10</span>) </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="fu">log</span>(<span class="dv">1</span>)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="dv">91</span>) <span class="co"># raiz cuadrada</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fl">7.3</span>) <span class="co"># redondear</span></span></code></pre></div>
<p>Incluso grandes operaciones:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="dv">91</span>) <span class="sc">+</span> <span class="dv">4892788</span><span class="sc">*</span><span class="dv">673</span> <span class="sc">-</span> (<span class="fu">log</span>(<span class="dv">4</span>)<span class="sc">*</span><span class="fu">round</span>(<span class="fl">67893.9181</span>, <span class="at">digits =</span> <span class="dv">2</span>))</span></code></pre></div>
<p>Incluso uso de números imaginarios:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>2i<span class="sc">+</span>5i<span class="sc">+</span><span class="fu">sqrt</span>(25i)</span></code></pre></div>
</div>
<div id="creacion-de-objetos-asignaciones-y-funciones" class="section level4 hasAnchor" number="2.1.6.2">
<h4 class="hasAnchor"><span class="header-section-number">2.1.6.2</span> Creacion de objetos: asignaciones y funciones<a href="#creacion-de-objetos-asignaciones-y-funciones" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>con el signo <code>&lt;-</code> asignamos valores. También se puede utilizar <code>=</code>, pero no es recomendable, ya que confunde.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">4</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>y</span></code></pre></div>
<p>Las asignaciones son MUDAS. Si no las llamo, no aparecen en la consola. Lo anterior es una operación sencilla, pero lo que queremos es generar asignaciones con funciones.</p>
<p>Podemos utilizar funciones. Las funciones son la parte central del uso de R. Algunas funciones vienen instaladas en R. Otras funciones hay que obtenerlas desde paquetes. También es posible escribir tus propias funciones <code>()</code>. Las funciones estan por lo general escritas en paréntesis, por ejemplo <code>filter()</code>. Hay ocasiones en que las funciones estan relacionadas con un paquete específico <code>dplyr::filter()</code>.</p>
<ul>
<li>Ejemplo 1: función simple</li>
</ul>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="dv">49</span>)</span></code></pre></div>
<ul>
<li>Ejemplo 2: sobre una base de datos</li>
</ul>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mtcars<span class="sc">$</span>mpg)</span></code></pre></div>
<p><em>Nota:</em> mtcars viene incluidad en R.</p>
<p>Para ver mas:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>()</span></code></pre></div>
<p>Otra función:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">2</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span><span class="fu">c</span>(x,y) </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>z</span></code></pre></div>
<p>Uso de funciones aritméticas:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(z) </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">median</span>(z)</span></code></pre></div>
<p>Relaciones entre objetos:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="fu">mean</span>(z)</span></code></pre></div>
<p>Creación de objetos por asignación:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">3</span><span class="sc">+</span><span class="dv">10</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">*</span><span class="dv">4</span></span></code></pre></div>
<p>Comparar objetos:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>a <span class="sc">&gt;</span> b</span></code></pre></div>
<p>Notar que las asignaciones son silenciosas:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>a </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>b </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co"># o altenativamente utilizar print </span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(a) </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b)</span></code></pre></div>
<p>Creación de objetos usando funciones:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>valores <span class="ot">&lt;-</span> <span class="fu">c</span>(a,b)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>promedio <span class="ot">&lt;-</span> <span class="fu">mean</span>(valores)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(promedio)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>promedio</span></code></pre></div>
<p>Podemos escribir un promedio aquí usando función <code>mean():</code></p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">2</span> </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>valores1 <span class="ot">&lt;-</span> <span class="fu">c</span>(a,b)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>promedio1 <span class="ot">&lt;-</span><span class="fu">mean</span>(valores1)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(promedio1)</span></code></pre></div>
<p>Limpiamos datos nuevamente:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>()) </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(promedio)</span></code></pre></div>
</div>
<div id="creacion-de-objetos-y-asignaciones" class="section level4 hasAnchor" number="2.1.6.3">
<h4 class="hasAnchor"><span class="header-section-number">2.1.6.3</span> Creacion de objetos y asignaciones<a href="#creacion-de-objetos-y-asignaciones" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Es importante espaciar codigos. Definimos dos vectores utilizando la función <code>c()</code></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>educ <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">8</span>,<span class="dv">12</span>,<span class="dv">8</span>,<span class="dv">11</span>,<span class="dv">16</span>,<span class="dv">14</span>,<span class="dv">8</span>,<span class="dv">10</span>,<span class="dv">14</span>,<span class="dv">12</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>ingreso <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">325</span>,<span class="dv">415</span>,<span class="dv">360</span>,<span class="dv">380</span>,<span class="dv">670</span>,<span class="dv">545</span>,<span class="dv">350</span>,<span class="dv">420</span>,<span class="dv">680</span>,<span class="dv">465</span>)</span></code></pre></div>
<p>Calculamos promedio, desviación estándar y correlación</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(ingreso)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>promedioingreso <span class="ot">&lt;-</span> <span class="fu">mean</span>(ingreso)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(ingreso)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>sdingreso <span class="ot">&lt;-</span> <span class="fu">sd</span>(ingreso)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(educ, ingreso)</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>coreduing <span class="ot">&lt;-</span> <span class="fu">cor</span>(educ,ingreso)</span></code></pre></div>
<p>Graficamos</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(educ, ingreso)</span></code></pre></div>
<p>Estimar una regresión lineal</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(ingreso <span class="sc">~</span> educ)</span></code></pre></div>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 2.1.1:</b> Nombrar objetos</p>
<p>De los siguientes ejemplos, ¿Cuáles son nombres de variables válidas en R?</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># min_height</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># max.height</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co"># _age</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co"># .mass</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co"># MaxLength</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Min-length</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 2widths</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calsius2kelvin</span></span></code></pre></div>
</div>
</div>
</div>
<div id="tipos-de-objetos" class="section level3 hasAnchor" number="2.1.7">
<h3 class="hasAnchor"><span class="header-section-number">2.1.7</span> Tipos de objetos<a href="#tipos-de-objetos" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="vectores" class="section level4 hasAnchor" number="2.1.7.1">
<h4 class="hasAnchor"><span class="header-section-number">2.1.7.1</span> Vectores<a href="#vectores" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>R opera componente por componente, por lo que es muy sencillo poder trabajar con vectores y matrices.</p>
<p>Para crear un vector utilizamos la funcion <code>c()</code></p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="co">#o bien</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">6</span><span class="sc">:</span><span class="dv">8</span>)</span></code></pre></div>
<p>Veamos los vectores</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> x <span class="sc">+</span> y </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>z</span></code></pre></div>
<p>Supongamos los siguientes vectores:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>x<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>y<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span></code></pre></div>
<p>¿Cuál es su longitud?</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(x)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(y)</span></code></pre></div>
<p>Si no tienen la misma longitud, ¿cual sería el resultado de <code>x + y</code>?</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> x <span class="sc">+</span> y </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>z</span></code></pre></div>
<p><strong>IMPORTANTE</strong>: En este caso R realiza la operación de todos modos, pero nos indica que hay una advertencia de que sus dimensiones difieren. Lo relevante de los vectores es que sólo se puede concatenar elementos del mismo tipo, de lo contrario R nos arroja error.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fl">1.5</span><span class="sc">:</span><span class="fl">9.5</span>,<span class="dv">4</span>) <span class="co">#genera repeticiones de los valores definidos </span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">20</span><span class="sc">:</span><span class="dv">30</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>x3 <span class="ot">&lt;-</span> <span class="fu">c</span>(x1,x2)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>x4 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>))</span></code></pre></div>
<p>Subconjunto de un vector</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>y[<span class="dv">3</span>] <span class="co"># obtener el tercer elemento </span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>y[<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>] </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>y[<span class="dv">4</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>y[<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">6</span>)]</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>y[<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">16</span>)]</span></code></pre></div>
</div>
<div id="matrices" class="section level4 hasAnchor" number="2.1.7.2">
<h4 class="hasAnchor"><span class="header-section-number">2.1.7.2</span> Matrices<a href="#matrices" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div id="definir-matrices" class="section level5 hasAnchor" number="2.1.7.2.1">
<h5 class="hasAnchor"><span class="header-section-number">2.1.7.2.1</span> Definir matrices<a href="#definir-matrices" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Sintaxis general</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>mi.matriz <span class="ot">&lt;-</span> <span class="fu">matrix</span>(vector,</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ncol =</span> num_columnas, <span class="at">nrow =</span> num_filas,</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">byrow =</span> valor_logico,</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">dimnames =</span> <span class="fu">list</span>(vector_nombres_filas,</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>                                   vector_nombres_columnas)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Para crear matrices utilizamos la función <code>matrix()</code></p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">matrix</span> (<span class="at">data =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>), </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">nrow =</span> <span class="dv">2</span>, </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncol =</span> <span class="dv">2</span>) </span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>), </span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>             <span class="dv">2</span>, </span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>             <span class="dv">2</span>)</span></code></pre></div>
<p>No es necesario poner <code>data=</code>, pero por orden mental es mejor hacerlo.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>x </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>x1</span></code></pre></div>
<p>Notar que por DEFECTO rellena columna por columna. Podemos explicitar que queremos realizar la matriz fila por fila</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>),</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">nrow =</span> <span class="dv">3</span>, </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">ncol =</span> <span class="dv">2</span>, </span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>y</span></code></pre></div>
<p>Podemos saber cual es la dimensión de <code>x</code></p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(y)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(y)[<span class="dv">1</span>] <span class="co"># cantidad de filas</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(y)[<span class="dv">2</span>] <span class="co"># cantidad de columnas</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>y<span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>), <span class="at">nrow=</span><span class="dv">2</span>, <span class="at">ncol=</span><span class="dv">2</span>, <span class="at">byrow=</span><span class="dv">2</span>)</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>y</span></code></pre></div>
<p>Los va a repetir!</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>), <span class="at">nrow=</span><span class="dv">2</span>, <span class="at">ncol=</span><span class="dv">3</span>, <span class="at">byrow=</span> <span class="dv">2</span>) </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>y</span></code></pre></div>
<p>Notar que el orden en cualquier matrix es <strong>filas x columnas</strong>. Podemos también omitir la cantidad de filas o columnas en la matriz y obtenemos el mismo resultado</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>), <span class="dv">2</span>, <span class="at">byrow=</span>T)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>y </span></code></pre></div>
<p>En el caso de crear matrices vacías hay que definir las dimensiones</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow=</span><span class="dv">3</span>, <span class="at">ncol=</span><span class="dv">3</span>)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>y <span class="co">#útil para los loops</span></span></code></pre></div>
<p>Darle nombre a las filas y columnas</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">matrix</span> (<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>), <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">FALSE</span>, </span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">dimnames=</span><span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;X1&quot;</span>,<span class="st">&quot;X2&quot;</span>),<span class="fu">c</span>(<span class="st">&quot;Y1&quot;</span>, <span class="st">&quot;Y2&quot;</span>)))</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>y</span></code></pre></div>
<p>Se puede realizar desde las funciones colnames y rownames</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(x) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Variable 1&quot;</span>, <span class="st">&quot;Variable 2&quot;</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(x) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;a1&quot;</span>, <span class="st">&quot;a2&quot;</span>)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>x</span></code></pre></div>
<p>Añadir filas o columnas a una matriz</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">6</span>)</span></code></pre></div>
</div>
<div id="unir-matrices" class="section level5 hasAnchor" number="2.1.7.2.2">
<h5 class="hasAnchor"><span class="header-section-number">2.1.7.2.2</span> Unir matrices<a href="#unir-matrices" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Unir mediante filas (queda con el nombre del vector la observación)</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">rbind</span>(x,w) </span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>z</span></code></pre></div>
<p>Unir mediante columnas</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">cbind</span>(x,w) </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>z</span></code></pre></div>
<p>¿Y si tienen diferente cantidad de filas y/o columnas? repite el vector o observaci?n con menor longitud</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>),<span class="dv">3</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>x</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">6</span>)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>y</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>z<span class="ot">&lt;-</span><span class="fu">rbind</span>(x,y)</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>z </span></code></pre></div>
<p>Podemos pasar un vector a una matriz</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>x<span class="ot">&lt;-</span><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>x</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(x)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">5</span>)</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>x</span></code></pre></div>
<p>Trasponer matrices:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>),<span class="dv">3</span>)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>xtraspuesta <span class="ot">&lt;-</span> <span class="fu">t</span>(x)</span></code></pre></div>
<p>Potencialmente se pueden hacer muchas más operaciones que involucren matrices. Por ejemplo, subconjuntos de una matriz: segundo y cuarto elemento de la segunda fila:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>, <span class="at">nrow=</span><span class="dv">2</span>)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>M</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>M[<span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>M[<span class="dv">1</span>,]</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>M[,<span class="dv">2</span>]</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>M[<span class="dv">2</span>,<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>)]</span></code></pre></div>
</div>
</div>
</div>
</div>
<div id="herramientas-de-programación" class="section level2 hasAnchor" number="2.2">
<h2 class="hasAnchor"><span class="header-section-number">2.2</span> Herramientas de programación<a href="#herramientas-de-programación" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="objetos-adicionales" class="section level3 hasAnchor" number="2.2.1">
<h3 class="hasAnchor"><span class="header-section-number">2.2.1</span> Objetos adicionales<a href="#objetos-adicionales" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="arreglos" class="section level4 hasAnchor" number="2.2.1.1">
<h4 class="hasAnchor"><span class="header-section-number">2.2.1.1</span> Arreglos<a href="#arreglos" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Crear arreglos: La única diferencia con matrices es que acepta mas de dos dimensiones.</p>
<p>Para generarlos:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>mi.arreglo <span class="ot">&lt;-</span><span class="fu">array</span>(vector, </span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>                   dimensiones, </span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">dimnames =</span> etiquetas_dim)</span></code></pre></div>
<p>Para nombrarlos definimos etiquetas y luego las agregamos. Es mucho mejor y mas ordenado hacerlo así:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>dim1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;A1&quot;</span>, <span class="st">&quot;A2&quot;</span>)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>dim2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;B1&quot;</span>, <span class="st">&quot;B2&quot;</span>, <span class="st">&quot;B3&quot;</span>, <span class="st">&quot;B4&quot;</span>)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>dim3 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;C1&quot;</span>, <span class="st">&quot;C2&quot;</span>, <span class="st">&quot;C3&quot;</span>)</span></code></pre></div>
<p><strong>Ejemplo de arreglo:</strong> Defino un arreglo de 3 matrices de 2 (filas) x 4 (columnas)</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">24</span>,</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>           <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">3</span>),</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">dimnames =</span> <span class="fu">list</span>(dim1, dim2, dim3))</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>x</span></code></pre></div>
<p>Notar la tercera dimensión!</p>
<p><strong>Subconjuntos de un arreglo:</strong> x[Fila,Columna, Matriz]</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>x[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]       <span class="co"># 1 fila, 2da columna, 3ra matriz</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>x[,,<span class="dv">3</span>]         <span class="co"># 3era matriz completa</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>x[,<span class="dv">4</span>,]         <span class="co"># 4ta columna de todas las matrices</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>x[,<span class="sc">-</span><span class="dv">1</span>,<span class="dv">2</span>]       <span class="co"># Todas las filas, sin la primera columna, de la matriz 2. </span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>x[<span class="sc">-</span><span class="dv">1</span>,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),<span class="dv">3</span>] <span class="co"># Todas las columnas, sin la fila 1, de la matriz 3. </span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>x[<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,<span class="dv">3</span>]    <span class="co"># Columnas 1 y 2, sin la fila 1, de la matriz 3. </span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>x[,,<span class="dv">1</span>]<span class="sc">*</span><span class="dv">2</span></span></code></pre></div>
</div>
<div id="listas" class="section level4 hasAnchor" number="2.2.1.2">
<h4 class="hasAnchor"><span class="header-section-number">2.2.1.2</span> Listas<a href="#listas" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Las listas contienen elementos de diferente tipo: matrices, objetos, dataframes, vectores, etc.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>), <span class="st">&quot;R&quot;</span>, <span class="cn">TRUE</span>, <span class="dv">2</span><span class="sc">+</span>3i, 5L)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>x <span class="co">#separa todo componente</span></span></code></pre></div>
<p>Para acceder a un objeto dentro de la lista se debe utilizar DOBLE CORCHETE:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>x[[<span class="dv">5</span>]]</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>x[<span class="dv">5</span>]</span></code></pre></div>
<p>Veamos un ejemplo de cómo trabaja:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">Titulacion =</span> <span class="fu">c</span>(<span class="st">&quot;Economia&quot;</span>, <span class="st">&quot;Administracion&quot;</span>, <span class="st">&quot;Politica&quot;</span>), </span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">Edad =</span><span class="fu">c</span>(<span class="dv">25</span>,<span class="dv">23</span>,<span class="dv">27</span>))</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>x</span></code></pre></div>
<p>Al nombrar los componentes dentro de la lista, podemos llamarlos sin necesidad de los corchetes:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>x<span class="sc">$</span>Titulacion</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>x[[<span class="dv">1</span>]]</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>x[[<span class="st">&quot;Titulacion&quot;</span>]]</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>x<span class="sc">$</span>Edad</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>x[[<span class="dv">2</span>]]</span></code></pre></div>
<p>Como los componentes dentro de las listas tienen definida una naturaleza, podemos hacer operaciones con ellas también:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>x[[<span class="st">&quot;Edad&quot;</span>]]<span class="sc">*</span><span class="dv">3</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>x<span class="sc">$</span>Edad[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>)]<span class="sc">*</span><span class="dv">3</span></span></code></pre></div>
<p>Finalmente, tambien podemos crear listas vacias (útil para rellenar utilizando iteradores):</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span><span class="fu">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="at">length =</span> <span class="dv">10</span>)</span></code></pre></div>
<p><strong>Ejemplo de una lista:</strong> Definimos una lista</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>milista <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Primer elemento sera un vector</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">hospitales =</span> <span class="fu">c</span>(<span class="st">&quot;Van Buren&quot;</span>, <span class="st">&quot;Gustavo Fricke&quot;</span>, <span class="st">&quot;Salvador&quot;</span>),</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Segundo elemento sera un dataframe</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">direccion   =</span> <span class="fu">data.frame</span>(</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">calle =</span> <span class="fu">c</span>(<span class="st">&quot;San Ignacio&quot;</span>, <span class="st">&quot;Av. Alvarez&quot;</span>, <span class="st">&quot;Av. Salvador&quot;</span>),</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">ciudad   =</span> <span class="fu">c</span>(<span class="st">&quot;Valparaíso&quot;</span>, <span class="st">&quot;Viña del Mar&quot;</span>, <span class="st">&quot;Santiago&quot;</span>)</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>milista</span></code></pre></div>
<p>Llamar a subconjuntos</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Retorna el elemento de la lista</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>milista<span class="sc">$</span>hospitales</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>milista[<span class="dv">2</span>]</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Retorna el elemento, pero sin nombre y como vector</span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>milista[[<span class="dv">1</span>]]</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>milista[[<span class="st">&quot;hospitales&quot;</span>]]</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Elementos particulares</span></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>milista[[<span class="dv">1</span>]][<span class="dv">3</span>]</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>milista[[<span class="dv">2</span>]][,<span class="dv">1</span>]</span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>milista[[<span class="dv">2</span>]][<span class="dv">1</span>,]</span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>milista[[<span class="dv">2</span>]][<span class="dv">1</span>,<span class="dv">2</span>]</span></code></pre></div>
<p>Notar que es importante saber el tipo de dato.</p>
</div>
<div id="dataframes" class="section level4 hasAnchor" number="2.2.1.3">
<h4 class="hasAnchor"><span class="header-section-number">2.2.1.3</span> Dataframes<a href="#dataframes" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>Crear un dataframe:</strong> Es básicamente una matriz donde filas y columnas tienen significado. Contiene tanto valores numericos, carácteres, variables categóricas, etc.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Titulacion =</span> <span class="fu">c</span>(<span class="st">&quot;Economia&quot;</span>, <span class="st">&quot;Administracion&quot;</span>, </span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&quot;Administracion&quot;</span>),</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">Edad =</span><span class="fu">c</span>(<span class="dv">25</span>,<span class="dv">23</span>,<span class="dv">27</span>), </span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ocupacion =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>datos</span></code></pre></div>
<p>Esto es lo mas cercano a una base de datos. Es uno de los objetos básicos que veremos muchas veces a lo largo del curso.</p>
<p><strong>Dimensiones de un dataframe:</strong> Para ver las dimensiones hay que utilizar nrow(), ncol() o bien dim().</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(datos)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ncol</span>(datos)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(datos)</span></code></pre></div>
<p>Notar que nrow() y ncol() tambien sirven para matrices.</p>
<p><strong>Subconjuntos de un dataframe:</strong> Al igual que en las matrices, utilizamos <code>[ ]</code> para acceder a elementos dentro de la base.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>datos[<span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>datos[,<span class="dv">1</span>]</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>datos[,<span class="sc">-</span><span class="dv">2</span>]</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>datos[, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)]</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>datos[, <span class="fu">c</span>(<span class="st">&quot;Titulacion&quot;</span>)]</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Tambien puedo ocupar $ para llamar. </span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>datos<span class="sc">$</span>Titulacion</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Ojo que esto lo puedo hacer con todo</span></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(datos[,<span class="dv">2</span>])</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(datos[,<span class="dv">2</span>])[<span class="dv">3</span>]</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(datos[,<span class="dv">2</span>])[<span class="st">&quot;Max.&quot;</span>]</span></code></pre></div>
<p><strong>Tibbles:</strong> Una version mas moderna de dataframes. Es la misma idea: lista de vectores con nombres.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>Altura <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">168</span>, <span class="dv">177</span>, <span class="dv">177</span>, <span class="dv">177</span>, <span class="dv">178</span>, <span class="dv">172</span>, <span class="dv">165</span>, <span class="dv">171</span>, <span class="dv">178</span>, <span class="dv">170</span>)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>Peso  <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">88</span>, <span class="dv">72</span>, <span class="dv">85</span>, <span class="dv">95</span>, <span class="dv">71</span>, <span class="dv">69</span>, <span class="dv">61</span>, <span class="dv">61</span>, <span class="dv">51</span>, <span class="dv">75</span>)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Altura, Peso)</span></code></pre></div>
<p>Paquete para trabajar con bases de datos (más detalles en secciones 2.3 y 2.4)</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;tidyverse&quot;</span>) </span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble) <span class="co"># Una libreria dentro de tidyverse. </span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>misdatos <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(M)</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>misdatos</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Podemos ver los nombres o bien estadistica básica de cada variable. </span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(misdatos)</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(misdatos)</span></code></pre></div>
<p><strong>Agregar columnas a un dataframe:</strong> Podemos agregar variables a la base. Dos opciones:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Opción 1: utilizando $nombre_columna&lt;-vector</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>datos<span class="sc">$</span>id <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>datos</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Opción 2: utilizando el cbind (al igual que con matrices)</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>id2<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>datos1 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(id2,datos) </span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>datos1</span></code></pre></div>
<p><strong>Attach:</strong></p>
<p>Notación muy inconveniente</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>misdatos<span class="sc">$</span>Altura</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>misdatos<span class="sc">$</span>Peso</span></code></pre></div>
<p>Para evitar escribir datos cada vez que quiera llamar a una variable voy a utilizar la funcion <code>attach()</code>:</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(datos) <span class="co"># para comenzar</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Ahora puedo llamar a sus variables sin utilizar datos</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>nueva <span class="ot">&lt;-</span> Edad <span class="sc">*</span> ocupacion </span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>nueva <span class="ot">&lt;-</span> datos<span class="sc">$</span>Edad <span class="sc">*</span> datos<span class="sc">$</span>ocupacion</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>nueva </span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(datos) <span class="co"># para terminar</span></span></code></pre></div>
<p>Esta es una forma mucho mas conveniente de trabajar con dataframes o tibble en R.</p>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 2.2.1:</b> Crear un dataframe</p>
<p>Cree su primera base de datos. Debe armar una tabla igual a la figura. Tiene 5 minutos.
<img src="ejercicio2.PNG" alt="Ejercicio" /></p>
</div>
<p>Respuesta:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>ejer <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Tipo_animal =</span> <span class="fu">c</span>(<span class="st">&quot;Perro&quot;</span>, <span class="st">&quot;Perro&quot;</span>,<span class="st">&quot;Gato&quot;</span>,<span class="st">&quot;Perro&quot;</span>, </span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&quot;Gato&quot;</span>,<span class="st">&quot;Gato&quot;</span>,<span class="st">&quot;Gato&quot;</span>),</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Color =</span><span class="fu">c</span>(<span class="st">&quot;Café&quot;</span>,<span class="st">&quot;Blanco&quot;</span>,<span class="st">&quot;Negro&quot;</span>,<span class="st">&quot;Manchas&quot;</span>,<span class="st">&quot;Café&quot;</span>,<span class="st">&quot;Tricolor&quot;</span>,<span class="st">&quot;Negro&quot;</span>), </span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Peso =</span> <span class="fu">c</span>(<span class="dv">7</span>,<span class="dv">5</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">4</span>),</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Pasea=</span><span class="fu">c</span>(<span class="st">&quot;Sí&quot;</span>,<span class="st">&quot;Sí&quot;</span>,<span class="st">&quot;Sí&quot;</span>,<span class="st">&quot;No&quot;</span>,<span class="st">&quot;No&quot;</span>,<span class="st">&quot;No&quot;</span>,<span class="st">&quot;Sí&quot;</span>))</span></code></pre></div>
</div>
</div>
<div id="acceder-a-elementos-de-un-objeto" class="section level3 hasAnchor" number="2.2.2">
<h3 class="hasAnchor"><span class="header-section-number">2.2.2</span> Acceder a elementos de un objeto<a href="#acceder-a-elementos-de-un-objeto" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="vectores-1" class="section level4 hasAnchor" number="2.2.2.1">
<h4 class="hasAnchor"><span class="header-section-number">2.2.2.1</span> Vectores<a href="#vectores-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Para acceder a los elementos de un objeto debemos utilizar los corchetes <code>[ ]</code></p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Veamos en un vector</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>x<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">&quot;T&quot;</span>, <span class="st">&quot;FALSE&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>,<span class="dv">1</span><span class="sc">+</span>2i,<span class="st">&quot;t&quot;</span>, <span class="st">&quot;c&quot;</span>,<span class="st">&quot;a&quot;</span>,<span class="dv">6</span>)</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(x)</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Podemos llamar a un objeto de un vector </span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>x[<span class="dv">1</span>]</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>x[<span class="dv">3</span>]</span></code></pre></div>
<p>De esta manera podemos extraerlo o utilizarlo en diferentes operaciones. Pero sólo debe ser entre observaciones numericas:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>x[<span class="dv">1</span>]<span class="sc">+</span>x[<span class="dv">6</span>] <span class="co">#de lo contrario R nos arroja un error </span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>y<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="dv">1</span><span class="sc">+</span>2i)</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>y[<span class="dv">3</span>]<span class="sc">+</span>y[<span class="dv">7</span>]</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a><span class="co">#O podemos visualizar a x, pero sin el primer objeto</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>x[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a><span class="co">#O eliminar el primer objeto </span></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>x<span class="ot">&lt;-</span>x[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> x[<span class="sc">-</span><span class="dv">1</span>]</span></code></pre></div>
</div>
<div id="matrices-1" class="section level4 hasAnchor" number="2.2.2.2">
<h4 class="hasAnchor"><span class="header-section-number">2.2.2.2</span> Matrices<a href="#matrices-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Si analizamos los objetos de una matriz:</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>w<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>,<span class="dv">3</span>)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>w</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Elemento [1,1]</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>w[<span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Toda la primera columna </span></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>w[,<span class="dv">1</span>]</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Toda la segunda fila</span></span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>w[<span class="dv">2</span>,]</span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Dos columnas</span></span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>w[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="co"># w[,-3]</span></span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Todas las filas menos la primera</span></span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>w[<span class="sc">-</span><span class="dv">1</span>,]</span></code></pre></div>
</div>
<div id="listas-1" class="section level4 hasAnchor" number="2.2.2.3">
<h4 class="hasAnchor"><span class="header-section-number">2.2.2.3</span> Listas<a href="#listas-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Si queremos llamar a un objeto dentro de una lista:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>), <span class="st">&quot;R&quot;</span>, T, <span class="dv">2</span><span class="sc">+</span>3i, 5L)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>z <span class="co">#separa todo componente</span></span></code></pre></div>
<p>Para acceder a un objeto dentro de la lista se debe utilizar doble corchete:</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>z[[<span class="dv">1</span>]]</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Y algo dentro de ese objeto </span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>z[[<span class="dv">1</span>]][<span class="dv">5</span>]</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Tambien podemos analizar su clasificacion </span></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(z[[<span class="dv">1</span>]]) <span class="co">#numerico </span></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Si es numerico, entonces tambien podemos hacer operaciones </span></span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>z[[<span class="dv">1</span>]][<span class="dv">3</span>]<span class="sc">*</span>z[[<span class="dv">1</span>]][<span class="dv">5</span>]</span></code></pre></div>
</div>
</div>
<div id="tipos-de-objetos-y-datos" class="section level3 hasAnchor" number="2.2.3">
<h3 class="hasAnchor"><span class="header-section-number">2.2.3</span> Tipos de objetos y datos<a href="#tipos-de-objetos-y-datos" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="identificar-tipos-de-objetos" class="section level4 hasAnchor" number="2.2.3.1">
<h4 class="hasAnchor"><span class="header-section-number">2.2.3.1</span> Identificar tipos de objetos<a href="#identificar-tipos-de-objetos" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Veamos en un vector cualquiera</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>x<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">&quot;T&quot;</span>, <span class="cn">FALSE</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>,<span class="dv">1</span><span class="sc">+</span>2i,<span class="st">&quot;t&quot;</span>, <span class="st">&quot;c&quot;</span>,<span class="st">&quot;a&quot;</span>,<span class="dv">6</span>)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(x)</span></code></pre></div>
<p>Como bien sabemos todo en R es un objeto. Para saber que tipo de objeto es puedo utilizar la función <code>class()</code>:</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(datos)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span> (x)</span></code></pre></div>
<p>Note que <code>class()</code> identifico que es un “data.frame” y una lista. También puedo ver los tipos de elementos dentro de un determinado objeto. Para datos, existen 5 tipos principales, llamados:</p>
<ol style="list-style-type: decimal">
<li><strong>carácteres:</strong> texto. Se escriben con comillas (ej: “3”, “swc”).</li>
<li><strong>numéricos:</strong> numeros reales (ej. 2, 15.5).</li>
<li><strong>enteros:</strong> numeros enteros (“L” le dice a R que guarde esto como un entero).</li>
<li><strong>logical:</strong> valores logicos (ej. TRUE, FALSE).</li>
<li><strong>complejos:</strong> 1 + 4i (Numero complejos).</li>
</ol>
</div>
<div id="identificar-tipos-de-datos" class="section level4 hasAnchor" number="2.2.3.2">
<h4 class="hasAnchor"><span class="header-section-number">2.2.3.2</span> Identificar tipos de datos<a href="#identificar-tipos-de-datos" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Carácteres</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>z<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">&quot;a&quot;</span>,<span class="st">&quot;b&quot;</span>)</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(z)</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Números enteros</span></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>w<span class="ot">&lt;-</span><span class="fu">c</span>(1L,2L,3L) <span class="co">#la L es para obligar que sea entero</span></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(w)</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Numéricos </span></span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>w1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>)</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(w1)</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Notar que la L lo obliga a ser entero ¿Qué ocurre si no coloco la L? </span></span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Valores logicos</span></span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a>v1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>)</span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(v1)</span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-19"><a href="#cb88-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Notar que si estan entre comillas son caracteres, no logical!. </span></span>
<span id="cb88-20"><a href="#cb88-20" aria-hidden="true" tabindex="-1"></a>v<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">&quot;TRUE&quot;</span>, <span class="st">&quot;FALSE&quot;</span>)</span>
<span id="cb88-21"><a href="#cb88-21" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(v)</span>
<span id="cb88-22"><a href="#cb88-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-23"><a href="#cb88-23" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Números complejos </span></span>
<span id="cb88-24"><a href="#cb88-24" aria-hidden="true" tabindex="-1"></a>t<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">+</span>2i,<span class="dv">1</span><span class="sc">+</span>3i)</span>
<span id="cb88-25"><a href="#cb88-25" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(t)</span></code></pre></div>
<p>Hay más clases: Date(fechas), Factor(variables categóricas), data.frame, tibble, list.</p>
</div>
<div id="importan-los-tipos-de-los-objetos" class="section level4 hasAnchor" number="2.2.3.3">
<h4 class="hasAnchor"><span class="header-section-number">2.2.3.3</span> ¿Importan los tipos de los objetos?<a href="#importan-los-tipos-de-los-objetos" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>R intenta mantener dentro de un vector el tipo de objeto. Si es que tratamos de juntar distintos tipos de datos en un vector. Igualar a la clase. Por ejemplo, si intentamos generar un vector con texto y número/logical todo será texto:</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">TRUE</span>,<span class="st">&quot;a&quot;</span>, <span class="cn">TRUE</span>, <span class="dv">2</span>)</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>h</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(h)</span></code></pre></div>
<p>Si intentamos juntar un “Logical” con un número todo será número:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>h1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">TRUE</span>,<span class="dv">2</span>,<span class="dv">3</span>)</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>h1</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(h1)</span></code></pre></div>
<p>Aquí carácter todo se va a caracter:</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;T&quot;</span>, <span class="st">&quot;FALSE&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">1</span><span class="sc">+</span>2i, <span class="st">&quot;t&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;a&quot;</span>)</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(x)</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(y)</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>)</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(y)</span></code></pre></div>
<p>Si utilizo el operador <code>:</code> para crear vectores lo interpreta como un <em>integer</em>.</p>
</div>
<div id="forzar-a-r-para-que-utilice-un-tipo-de-dato" class="section level4 hasAnchor" number="2.2.3.4">
<h4 class="hasAnchor"><span class="header-section-number">2.2.3.4</span> Forzar a R para que utilice un tipo de dato<a href="#forzar-a-r-para-que-utilice-un-tipo-de-dato" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Forzar a R a llevar el vector solo a numérico:</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(x)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(z)</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>z </span></code></pre></div>
<p><code>as.numeric()</code> fuerza al vector a solo tener números. Noten que remplaza los que no son numérico por NA.</p>
<p>Forzar a R a llevar el vector solo a carácteres:</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>z1 <span class="ot">&lt;-</span> <span class="fu">as.character</span>(y)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(z1)</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>z1</span></code></pre></div>
<p>Noten que ahora se agregaron las dobles comillas.</p>
<p>Forzar a R a llevar el vector sólo a carácter.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>x</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>z2 <span class="ot">&lt;-</span> <span class="fu">as.logical</span>(x)</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(z2)</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>z2 </span></code></pre></div>
<p>Noten que “T” fue aceptado como TRUE!</p>
</div>
<div id="cómo-saber-que-tipo-de-datos-tengo" class="section level4 hasAnchor" number="2.2.3.5">
<h4 class="hasAnchor"><span class="header-section-number">2.2.3.5</span> ¿Cómo saber que tipo de datos tengo?<a href="#cómo-saber-que-tipo-de-datos-tengo" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Puedo preguntar a R sobre el tipo. </span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a><span class="fu">is.numeric</span>(y)   <span class="co"># Es numerico?</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a><span class="fu">is.character</span>(y) <span class="co"># Es caracter?</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a><span class="fu">is.logical</span>(y)   <span class="co"># Es logico?</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a><span class="co"># La respuesta a esta pregunta va a ser un valor lógico</span></span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(<span class="fu">is.numeric</span>(y))</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a><span class="co"># También se puede utilizar la opcion `typeof`</span></span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(y)</span></code></pre></div>
</div>
<div id="mayúsculas-importan" class="section level4 hasAnchor" number="2.2.3.6">
<h4 class="hasAnchor"><span class="header-section-number">2.2.3.6</span> Mayúsculas importan<a href="#mayúsculas-importan" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Como vimos en lasección anterior, R es sensible a las mayúsculas. Esto aplica para nombres de funciones, paquetes, comando y también para los datos. Por ejemplo:</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;a&quot;</span>,<span class="st">&quot;a&quot;</span>,<span class="st">&quot;a&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;B&quot;</span>,<span class="st">&quot;b&quot;</span>, <span class="st">&quot;A&quot;</span>)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(x)</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(x <span class="sc">==</span> <span class="st">&#39;a&#39;</span>)</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(x <span class="sc">==</span> <span class="st">&#39;b&#39;</span>)</span></code></pre></div>
<p>Para R las minúsculas y mayúsculas SI IMPORTAN!.</p>
</div>
<div id="carácteres-especiales" class="section level4 hasAnchor" number="2.2.3.7">
<h4 class="hasAnchor"><span class="header-section-number">2.2.3.7</span> Carácteres especiales<a href="#carácteres-especiales" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Vimos que existen nombres de variables no validos en R. Tambien existe un conjunto de caracteres invalidos.</p>
<ul>
<li><strong>NA:</strong> Not Available (missing values)</li>
<li><strong>NaN:</strong> Not a Numbers (ej. 0/0)</li>
<li><strong>Inf:</strong> Infinito (1/0)</li>
<li><strong>-Inf:</strong> Menos infinito</li>
</ul>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span><span class="sc">/</span><span class="dv">0</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">0</span> </span></code></pre></div>
</div>
<div id="missing-values" class="section level4 hasAnchor" number="2.2.3.8">
<h4 class="hasAnchor"><span class="header-section-number">2.2.3.8</span> Missing values<a href="#missing-values" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>En R, los valores perdidos (“missing values”) se representan con el valor especial <code>NA</code> (letras mayusculas N y A - sin comillas). Para saber si tengo valores <code>NA</code> en un objeto, puedo ocupar la funcion <code>is.na()</code>:</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>ejemplo <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="cn">NA</span>,<span class="dv">4</span>)</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="fu">is.na</span>(ejemplo)</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>ejemplo[<span class="sc">!</span><span class="fu">is.na</span>(ejemplo)]</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a><span class="co"># El resultado es un vector. Noten que es importante para utilizar algunas funciones:</span></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(ejemplo)</span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(ejemplo, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>No funciona en el primer caso, si en el segundo. Veremos mas detalles sobre como tratar missing values (ej. recodificar) en las clases de manipulacion y analisis de datos.</p>
</div>
<div id="funciones-útiles" class="section level4 hasAnchor" number="2.2.3.9">
<h4 class="hasAnchor"><span class="header-section-number">2.2.3.9</span> Funciones útiles<a href="#funciones-útiles" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Redondear</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(x,<span class="at">digits =</span> n)</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">c</span>(<span class="fl">2.53</span>, <span class="fl">3.52</span>), <span class="dv">1</span>)</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Estadística simple</span></span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>)</span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(x)    <span class="co"># promedio</span></span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a><span class="fu">median</span>(x)  <span class="co"># mediana</span></span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(x)      <span class="co"># desviacion estandar</span></span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(x)     <span class="co"># suma del vector</span></span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a><span class="fu">min</span>(x)     <span class="co"># Valor minimo</span></span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(x)     <span class="co"># Valor maximo</span></span>
<span id="cb99-14"><a href="#cb99-14" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(x)   <span class="co"># rango </span></span>
<span id="cb99-15"><a href="#cb99-15" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(x) <span class="co"># resumen </span></span>
<span id="cb99-16"><a href="#cb99-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-17"><a href="#cb99-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Notar que tienen que ser vectores!</span></span>
<span id="cb99-18"><a href="#cb99-18" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="dv">10</span>, <span class="dv">6</span>, <span class="dv">12</span>, <span class="dv">10</span>, <span class="dv">5</span>, <span class="dv">0</span>) </span>
<span id="cb99-19"><a href="#cb99-19" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">6</span>, <span class="dv">12</span>, <span class="dv">10</span>, <span class="dv">5</span>, <span class="dv">0</span>))</span>
<span id="cb99-20"><a href="#cb99-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-21"><a href="#cb99-21" aria-hidden="true" tabindex="-1"></a><span class="co"># En el primer caso sólo toma el primer valor! Ojo, siempre un vector. </span></span>
<span id="cb99-22"><a href="#cb99-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-23"><a href="#cb99-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Otras funciones</span></span>
<span id="cb99-24"><a href="#cb99-24" aria-hidden="true" tabindex="-1"></a><span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">2</span> )                        <span class="co"># Crear secuencias</span></span>
<span id="cb99-25"><a href="#cb99-25" aria-hidden="true" tabindex="-1"></a><span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>),<span class="dv">10</span>)                    <span class="co"># Repetir</span></span>
<span id="cb99-26"><a href="#cb99-26" aria-hidden="true" tabindex="-1"></a><span class="fu">cut</span>(x,<span class="dv">2</span>)                            <span class="co"># subdividir</span></span>
<span id="cb99-27"><a href="#cb99-27" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(x, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>) <span class="co"># Generar un aleatorio</span></span>
<span id="cb99-28"><a href="#cb99-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-29"><a href="#cb99-29" aria-hidden="true" tabindex="-1"></a><span class="co"># El analisis de datos es...</span></span>
<span id="cb99-30"><a href="#cb99-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-31"><a href="#cb99-31" aria-hidden="true" tabindex="-1"></a>Altura <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">168</span>, <span class="dv">177</span>, <span class="dv">177</span>, <span class="dv">177</span>, <span class="dv">178</span>, <span class="dv">172</span>, <span class="dv">165</span>, <span class="dv">171</span>, <span class="dv">178</span>, <span class="dv">170</span>)</span>
<span id="cb99-32"><a href="#cb99-32" aria-hidden="true" tabindex="-1"></a>Peso  <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">88</span>, <span class="dv">72</span>, <span class="dv">85</span>, <span class="dv">95</span>, <span class="dv">71</span>, <span class="dv">69</span>, <span class="dv">61</span>, <span class="dv">61</span>, <span class="dv">51</span>, <span class="dv">75</span>)</span>
<span id="cb99-33"><a href="#cb99-33" aria-hidden="true" tabindex="-1"></a>M <span class="ot">=</span> <span class="fu">cbind</span>(Altura, Peso)</span>
<span id="cb99-34"><a href="#cb99-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-35"><a href="#cb99-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Paquete para trabajar con bases de datos (más detalles en secciones 2.3 y 2.4)</span></span>
<span id="cb99-36"><a href="#cb99-36" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;tidyverse&quot;</span>) </span>
<span id="cb99-37"><a href="#cb99-37" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble) <span class="co"># Una libreria dentro de tidyverse. </span></span>
<span id="cb99-38"><a href="#cb99-38" aria-hidden="true" tabindex="-1"></a>misdatos <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(M)</span>
<span id="cb99-39"><a href="#cb99-39" aria-hidden="true" tabindex="-1"></a>misdatos</span>
<span id="cb99-40"><a href="#cb99-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-41"><a href="#cb99-41" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(misdatos)</span>
<span id="cb99-42"><a href="#cb99-42" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(Altura)</span>
<span id="cb99-43"><a href="#cb99-43" aria-hidden="true" tabindex="-1"></a><span class="fu">min</span>(misdatos<span class="sc">$</span>Peso)</span>
<span id="cb99-44"><a href="#cb99-44" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(misdatos)</span></code></pre></div>
</div>
</div>
<div id="herramientas-en-r" class="section level3 hasAnchor" number="2.2.4">
<h3 class="hasAnchor"><span class="header-section-number">2.2.4</span> Herramientas en R<a href="#herramientas-en-r" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="escribir-códigos" class="section level4 hasAnchor" number="2.2.4.1">
<h4 class="hasAnchor"><span class="header-section-number">2.2.4.1</span> Escribir Códigos<a href="#escribir-códigos" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Algunos comentarios con respecto a la escritura de codigos:</p>
<ol style="list-style-type: decimal">
<li>Siempre escribir comentarios autocontenidos.</li>
<li>Siempre utilizar índice.</li>
</ol>
<ul>
<li>Me permite reducir el código.</li>
<li>Me permite ver donde estoy también en un código largo.</li>
<li>Puedo verlo con ctrl + shift + O o bien en la esquina inferior izquierda del script.</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>Separar códigos largos en varios códigos. Cada código debe tener un objetivo claro que debe explicar en una oración.</li>
<li>Escribir códigos en bloques.</li>
<li>Tres consejos básicos de estilo:</li>
</ol>
<ul>
<li>utilizar <code>_</code> para generar variables o bien otra convención.</li>
<li>separar entre objetos y operaciones.</li>
</ul>
</div>
<div id="condicionales-y-controladores-de-flujo" class="section level4 hasAnchor" number="2.2.4.2">
<h4 class="hasAnchor"><span class="header-section-number">2.2.4.2</span> Condicionales y controladores de flujo<a href="#condicionales-y-controladores-de-flujo" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Operadores básicos:</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>())</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Asignador</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="dv">3</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>a </span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>a1 <span class="ot">=</span> <span class="dv">2</span> <span class="sc">*</span> <span class="dv">3</span></span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>a1 </span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Nota: Nunca ocupar igual. </span></span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Igualdad </span></span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a><span class="cn">TRUE</span> <span class="sc">==</span> <span class="cn">TRUE</span> </span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a><span class="cn">TRUE</span> <span class="sc">==</span> <span class="cn">FALSE</span></span>
<span id="cb100-15"><a href="#cb100-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-16"><a href="#cb100-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Nota: Para comparar elementos se utiliza doble igual &quot;==&quot;.  </span></span>
<span id="cb100-17"><a href="#cb100-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-18"><a href="#cb100-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-19"><a href="#cb100-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Desigualdad (!=)</span></span>
<span id="cb100-20"><a href="#cb100-20" aria-hidden="true" tabindex="-1"></a><span class="cn">TRUE</span> <span class="sc">!=</span> <span class="cn">FALSE</span> </span>
<span id="cb100-21"><a href="#cb100-21" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;Hola&quot;</span> <span class="sc">!=</span> <span class="st">&quot;Chao&quot;</span></span>
<span id="cb100-22"><a href="#cb100-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-23"><a href="#cb100-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Otros comparadores: &lt;, &gt; (&gt;=), (&lt;=) </span></span>
<span id="cb100-24"><a href="#cb100-24" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="sc">&lt;</span> <span class="dv">5</span></span>
<span id="cb100-25"><a href="#cb100-25" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> <span class="sc">&gt;</span> <span class="dv">8</span></span>
<span id="cb100-26"><a href="#cb100-26" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> <span class="sc">&gt;=</span> <span class="dv">5</span></span>
<span id="cb100-27"><a href="#cb100-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-28"><a href="#cb100-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Nota: No confundir con &lt;- que es para asignar. </span></span>
<span id="cb100-29"><a href="#cb100-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-30"><a href="#cb100-30" aria-hidden="true" tabindex="-1"></a><span class="cn">TRUE</span> <span class="sc">&gt;</span> <span class="cn">FALSE</span></span>
<span id="cb100-31"><a href="#cb100-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-32"><a href="#cb100-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Noten que la respuesta en un logical. </span></span>
<span id="cb100-33"><a href="#cb100-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-34"><a href="#cb100-34" aria-hidden="true" tabindex="-1"></a><span class="co"># En vectores y matrices</span></span>
<span id="cb100-35"><a href="#cb100-35" aria-hidden="true" tabindex="-1"></a>vector1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">16</span>,<span class="dv">9</span>,<span class="dv">13</span>)</span>
<span id="cb100-36"><a href="#cb100-36" aria-hidden="true" tabindex="-1"></a>vector2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">12</span>,<span class="dv">15</span>)</span>
<span id="cb100-37"><a href="#cb100-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-38"><a href="#cb100-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Comparar contra un escalar</span></span>
<span id="cb100-39"><a href="#cb100-39" aria-hidden="true" tabindex="-1"></a>vector1 <span class="sc">&gt;</span> <span class="dv">10</span></span>
<span id="cb100-40"><a href="#cb100-40" aria-hidden="true" tabindex="-1"></a>vector2 <span class="sc">&lt;</span> <span class="dv">10</span></span>
<span id="cb100-41"><a href="#cb100-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-42"><a href="#cb100-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Compararlos entre ellos </span></span>
<span id="cb100-43"><a href="#cb100-43" aria-hidden="true" tabindex="-1"></a>vector1 <span class="sc">&lt;</span> vector2</span>
<span id="cb100-44"><a href="#cb100-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-45"><a href="#cb100-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Veamos en una matriz </span></span>
<span id="cb100-46"><a href="#cb100-46" aria-hidden="true" tabindex="-1"></a>matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(vector1, vector2), </span>
<span id="cb100-47"><a href="#cb100-47" aria-hidden="true" tabindex="-1"></a>                 <span class="at">byrow =</span> <span class="cn">TRUE</span>, </span>
<span id="cb100-48"><a href="#cb100-48" aria-hidden="true" tabindex="-1"></a>                 <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb100-49"><a href="#cb100-49" aria-hidden="true" tabindex="-1"></a>matrix</span>
<span id="cb100-50"><a href="#cb100-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-51"><a href="#cb100-51" aria-hidden="true" tabindex="-1"></a>matrix <span class="sc">&gt;</span> <span class="dv">10</span></span></code></pre></div>
<p>Operador %in%: Un operador muy útil para comparar valores y para evaluar rápidamente si un valor está dentro de un vector o marco de datos.</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>())</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>v1 <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>v2 <span class="ot">&lt;-</span> <span class="dv">101</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>)</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a><span class="co"># El valor v1 ¿se encuentra dentro de t?</span></span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>v1 <span class="sc">%in%</span> t </span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Otro ejemplo....</span></span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>mivector <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;d&quot;</span>)</span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;a&quot;</span> <span class="sc">%in%</span> mivector</span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Si no  está en el vector da un FALSE</span></span>
<span id="cb101-15"><a href="#cb101-15" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;h&quot;</span> <span class="sc">%in%</span> mivector</span>
<span id="cb101-16"><a href="#cb101-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-17"><a href="#cb101-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Si le quiero preguntar si NO está, coloco un signo de exclamación al frente. </span></span>
<span id="cb101-18"><a href="#cb101-18" aria-hidden="true" tabindex="-1"></a><span class="sc">!</span><span class="st">&quot;a&quot;</span> <span class="sc">%in%</span> mivector</span>
<span id="cb101-19"><a href="#cb101-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-20"><a href="#cb101-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Un vector en otro vector </span></span>
<span id="cb101-21"><a href="#cb101-21" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">12</span>, <span class="dv">19</span>, <span class="dv">1</span>)</span>
<span id="cb101-22"><a href="#cb101-22" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">16</span>, <span class="dv">1</span>)</span>
<span id="cb101-23"><a href="#cb101-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-24"><a href="#cb101-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Veamos si los elementos de un vector &quot;largo&quot; están en uno &quot;corto&quot; </span></span>
<span id="cb101-25"><a href="#cb101-25" aria-hidden="true" tabindex="-1"></a>b <span class="sc">%in%</span> a</span>
<span id="cb101-26"><a href="#cb101-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-27"><a href="#cb101-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Esto va a ser muy útil cuando trabajemos con bases de datos. </span></span></code></pre></div>
<p>Operadores para seleccionar subconjuntos de datos:</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="cn">NA</span>,<span class="dv">8</span>)</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>y</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Vamos a seleccionar solo los que no son NA</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>y1 <span class="ot">&lt;-</span> y[<span class="sc">!</span><span class="fu">is.na</span>(y)]</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>y1 </span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Noten que utilizamos la funcion is.NA y un operador (!). Más detalles en parte de análisis de datos, pero noten que la idea principal está aquí. </span></span></code></pre></div>
<p>Operadores lógicos:</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Operador (&amp;): operador &quot;y&quot;</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="cn">TRUE</span> <span class="sc">&amp;</span> <span class="cn">TRUE</span> </span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a><span class="cn">TRUE</span> <span class="sc">&amp;</span> <span class="cn">FALSE</span></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a><span class="cn">FALSE</span> <span class="sc">&amp;</span> <span class="cn">TRUE</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a><span class="cn">FALSE</span> <span class="sc">&amp;</span> <span class="cn">FALSE</span> </span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Ejemplo </span></span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">12</span> </span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a>x <span class="sc">&gt;</span> <span class="dv">5</span> <span class="sc">&amp;</span> x <span class="sc">&lt;</span> <span class="dv">11</span>  </span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Operador (|): operador &quot;o&quot;. Condiciones no excluyentes.</span></span>
<span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a><span class="cn">TRUE</span>  <span class="sc">|</span> <span class="cn">TRUE</span> </span>
<span id="cb103-13"><a href="#cb103-13" aria-hidden="true" tabindex="-1"></a><span class="cn">TRUE</span>  <span class="sc">|</span> <span class="cn">FALSE</span> </span>
<span id="cb103-14"><a href="#cb103-14" aria-hidden="true" tabindex="-1"></a><span class="cn">FALSE</span> <span class="sc">|</span> <span class="cn">TRUE</span></span>
<span id="cb103-15"><a href="#cb103-15" aria-hidden="true" tabindex="-1"></a><span class="cn">FALSE</span> <span class="sc">|</span> <span class="cn">FALSE</span> </span>
<span id="cb103-16"><a href="#cb103-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-17"><a href="#cb103-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Ejemplo</span></span>
<span id="cb103-18"><a href="#cb103-18" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb103-19"><a href="#cb103-19" aria-hidden="true" tabindex="-1"></a>y <span class="sc">&lt;</span> <span class="dv">5</span> <span class="sc">|</span> y <span class="sc">&gt;</span> <span class="dv">15</span> </span>
<span id="cb103-20"><a href="#cb103-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-21"><a href="#cb103-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Operador de negación (!)</span></span>
<span id="cb103-22"><a href="#cb103-22" aria-hidden="true" tabindex="-1"></a><span class="sc">!</span><span class="cn">TRUE</span> </span>
<span id="cb103-23"><a href="#cb103-23" aria-hidden="true" tabindex="-1"></a><span class="sc">!</span><span class="cn">FALSE</span> </span>
<span id="cb103-24"><a href="#cb103-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-25"><a href="#cb103-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Combinarlo con funciones </span></span>
<span id="cb103-26"><a href="#cb103-26" aria-hidden="true" tabindex="-1"></a><span class="sc">!</span><span class="fu">is.numeric</span>(<span class="dv">5</span>)</span>
<span id="cb103-27"><a href="#cb103-27" aria-hidden="true" tabindex="-1"></a><span class="sc">!</span><span class="fu">is.numeric</span>(<span class="st">&quot;Hello&quot;</span>)</span>
<span id="cb103-28"><a href="#cb103-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-29"><a href="#cb103-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Operadores con vectores </span></span>
<span id="cb103-30"><a href="#cb103-30" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>) <span class="sc">&amp;</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span>)</span>
<span id="cb103-31"><a href="#cb103-31" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>) <span class="sc">|</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span>)</span>
<span id="cb103-32"><a href="#cb103-32" aria-hidden="true" tabindex="-1"></a><span class="sc">!</span><span class="fu">c</span>(<span class="cn">TRUE</span>,<span class="cn">TRUE</span>,<span class="cn">FALSE</span>)</span>
<span id="cb103-33"><a href="#cb103-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-34"><a href="#cb103-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Si utilizo dos &quot;&amp;&amp;&quot; sólo compara el primer elemento del vector</span></span>
<span id="cb103-35"><a href="#cb103-35" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="cn">TRUE</span>,<span class="cn">FALSE</span>,<span class="cn">FALSE</span>) <span class="sc">||</span> <span class="fu">c</span>(<span class="cn">TRUE</span>,<span class="cn">FALSE</span>,<span class="cn">FALSE</span>)</span>
<span id="cb103-36"><a href="#cb103-36" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="cn">TRUE</span>,<span class="cn">FALSE</span>,<span class="cn">FALSE</span>) <span class="sc">&amp;&amp;</span> <span class="fu">c</span>(<span class="cn">TRUE</span>,<span class="cn">TRUE</span>, <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div id="condicionales" class="section level4 hasAnchor" number="2.2.4.3">
<h4 class="hasAnchor"><span class="header-section-number">2.2.4.3</span> Condicionales<a href="#condicionales" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>If:</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a><span class="co">#if (condicion){</span></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a><span class="co">#  cualquier cosa que quiero que se haga si la condición se cumple </span></span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a><span class="co">#}</span></span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (x <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;x es número mayor que cero&quot;</span>)</span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb104-14"><a href="#cb104-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-15"><a href="#cb104-15" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (x <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb104-16"><a href="#cb104-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb104-17"><a href="#cb104-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;x es un número mayor que cero &quot;</span>)</span>
<span id="cb104-18"><a href="#cb104-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb104-19"><a href="#cb104-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb104-20"><a href="#cb104-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-21"><a href="#cb104-21" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (x <span class="sc">&lt;</span> <span class="dv">0</span>){</span>
<span id="cb104-22"><a href="#cb104-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb104-23"><a href="#cb104-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;x es un número menor que cero&quot;</span>)</span>
<span id="cb104-24"><a href="#cb104-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb104-25"><a href="#cb104-25" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Else:</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (x <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;x es un número positivo&quot;</span>)</span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span>{</span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;x es un número negativo&quot;</span>)</span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Elseif:</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (x <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;x es mayor que cero&quot;</span>)</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> (x <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;x es igual a cero&quot;</span>)</span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span>{</span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;x es menor que cero&quot;</span>)</span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb106-15"><a href="#cb106-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-16"><a href="#cb106-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Importante: `(%%) corresponde al resto de una división`</span></span>
<span id="cb106-17"><a href="#cb106-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-18"><a href="#cb106-18" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">6</span> </span>
<span id="cb106-19"><a href="#cb106-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-20"><a href="#cb106-20" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (x <span class="sc">%%</span> <span class="dv">2</span> <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb106-21"><a href="#cb106-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb106-22"><a href="#cb106-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;x es divisible por 2&quot;</span>)</span>
<span id="cb106-23"><a href="#cb106-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb106-24"><a href="#cb106-24" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> (x <span class="sc">%%</span> <span class="dv">3</span> <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb106-25"><a href="#cb106-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb106-26"><a href="#cb106-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;x es divisible por 3&quot;</span>)</span>
<span id="cb106-27"><a href="#cb106-27" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb106-28"><a href="#cb106-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb106-29"><a href="#cb106-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;x no es divisible ni por 2 ni por 3&quot;</span>)</span>
<span id="cb106-30"><a href="#cb106-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb106-31"><a href="#cb106-31" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb106-32"><a href="#cb106-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-33"><a href="#cb106-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Notar que si la primera condición se cumple, la segunda no se ejecuta aunque sea cierta.  </span></span></code></pre></div>
</div>
<div id="funciones" class="section level4 hasAnchor" number="2.2.4.4">
<h4 class="hasAnchor"><span class="header-section-number">2.2.4.4</span> Funciones<a href="#funciones" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Idea principal:
<span class="math inline">\(f(x) = 2x + 1\)</span>, <span class="math inline">\(x \in R\)</span>
<span class="math inline">\(f(x) = &#39;hola&#39; + x\)</span>, <span class="math inline">\(x \in (&#39;pepe&#39;, &#39;pepa&#39;, &#39;marta&#39;)\)</span></p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>valores <span class="ot">&lt;-</span>  <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>)</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(valores)</span></code></pre></div>
<p>Algunas cosas adicionales sobre funciones: <code>n</code> me permite ver los argumentos de una función, sin necesidad de ver la documentación. Útil a veces.</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Escribir funciones con un argumento</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>triple <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="dv">3</span> <span class="sc">*</span> x</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(y)</span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a>triple <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a>  x<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb108-15"><a href="#cb108-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-16"><a href="#cb108-16" aria-hidden="true" tabindex="-1"></a><span class="fu">triple</span>(<span class="dv">500</span>)</span>
<span id="cb108-17"><a href="#cb108-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-18"><a href="#cb108-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Escribir funciones con mas de un argumento</span></span>
<span id="cb108-19"><a href="#cb108-19" aria-hidden="true" tabindex="-1"></a>operacion <span class="ot">&lt;-</span> <span class="cf">function</span>(a,b){</span>
<span id="cb108-20"><a href="#cb108-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb108-21"><a href="#cb108-21" aria-hidden="true" tabindex="-1"></a>  a<span class="sc">*</span>b <span class="sc">+</span> a<span class="sc">/</span>b</span>
<span id="cb108-22"><a href="#cb108-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb108-23"><a href="#cb108-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb108-24"><a href="#cb108-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb108-25"><a href="#cb108-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-26"><a href="#cb108-26" aria-hidden="true" tabindex="-1"></a><span class="fu">operacion</span>(<span class="dv">4</span>,<span class="dv">2</span>)</span>
<span id="cb108-27"><a href="#cb108-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-28"><a href="#cb108-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Escribir funciones fijando opción por defecto.</span></span>
<span id="cb108-29"><a href="#cb108-29" aria-hidden="true" tabindex="-1"></a>operacion_defecto <span class="ot">&lt;-</span> <span class="cf">function</span>(a,<span class="at">b =</span> <span class="dv">1</span>){</span>
<span id="cb108-30"><a href="#cb108-30" aria-hidden="true" tabindex="-1"></a>  a<span class="sc">*</span>b <span class="sc">+</span> a<span class="sc">/</span>b</span>
<span id="cb108-31"><a href="#cb108-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb108-32"><a href="#cb108-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb108-33"><a href="#cb108-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb108-34"><a href="#cb108-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-35"><a href="#cb108-35" aria-hidden="true" tabindex="-1"></a><span class="fu">operacion_defecto</span>(<span class="dv">4</span>)</span>
<span id="cb108-36"><a href="#cb108-36" aria-hidden="true" tabindex="-1"></a><span class="fu">operacion_defecto</span>(<span class="dv">4</span>,<span class="dv">0</span>)</span>
<span id="cb108-37"><a href="#cb108-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-38"><a href="#cb108-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Escribir funciones utilizando if y return.</span></span>
<span id="cb108-39"><a href="#cb108-39" aria-hidden="true" tabindex="-1"></a>operacion_condicionales <span class="ot">&lt;-</span> <span class="cf">function</span>(a,<span class="at">b =</span> <span class="dv">1</span>){</span>
<span id="cb108-40"><a href="#cb108-40" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (b <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb108-41"><a href="#cb108-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="dv">0</span>)</span>
<span id="cb108-42"><a href="#cb108-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb108-43"><a href="#cb108-43" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb108-44"><a href="#cb108-44" aria-hidden="true" tabindex="-1"></a>  a<span class="sc">*</span>b <span class="sc">+</span> a<span class="sc">/</span>b  </span>
<span id="cb108-45"><a href="#cb108-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb108-46"><a href="#cb108-46" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb108-47"><a href="#cb108-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-48"><a href="#cb108-48" aria-hidden="true" tabindex="-1"></a><span class="fu">operacion_condicionales</span>(<span class="dv">4</span>,<span class="dv">0</span>)</span>
<span id="cb108-49"><a href="#cb108-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-50"><a href="#cb108-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Funciones con texto </span></span>
<span id="cb108-51"><a href="#cb108-51" aria-hidden="true" tabindex="-1"></a>texto <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb108-52"><a href="#cb108-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;Hola mundo!&quot;</span>)</span>
<span id="cb108-53"><a href="#cb108-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="cn">TRUE</span>)</span>
<span id="cb108-54"><a href="#cb108-54" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb108-55"><a href="#cb108-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-56"><a href="#cb108-56" aria-hidden="true" tabindex="-1"></a><span class="fu">texto</span>()</span>
<span id="cb108-57"><a href="#cb108-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-58"><a href="#cb108-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Funciones por defecto en ambos casos</span></span>
<span id="cb108-59"><a href="#cb108-59" aria-hidden="true" tabindex="-1"></a>operacion_dosdefectos <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">a =</span> <span class="dv">1</span>,<span class="at">b =</span> <span class="dv">1</span>){</span>
<span id="cb108-60"><a href="#cb108-60" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (b <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb108-61"><a href="#cb108-61" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="dv">0</span>)</span>
<span id="cb108-62"><a href="#cb108-62" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb108-63"><a href="#cb108-63" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb108-64"><a href="#cb108-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb108-65"><a href="#cb108-65" aria-hidden="true" tabindex="-1"></a>  a<span class="sc">*</span>b <span class="sc">+</span> a<span class="sc">/</span>b  </span>
<span id="cb108-66"><a href="#cb108-66" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb108-67"><a href="#cb108-67" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb108-68"><a href="#cb108-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-69"><a href="#cb108-69" aria-hidden="true" tabindex="-1"></a><span class="fu">operacion_dosdefectos</span>()</span></code></pre></div>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 2.2.2:</b> Funciones</p>
<p>Genere una función que sea igual a la división de dos elementos. Coloque un mensaje que indique cuando la división es indeterminada.</p>
</div>
<p>Respuesta:</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>operacion_indeterminada <span class="ot">&lt;-</span> <span class="cf">function</span>(a,b){</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>  a<span class="sc">/</span>b </span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (b <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">&quot;Es indeterminado&quot;</span>)</span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a><span class="fu">operacion_indeterminada</span>(<span class="dv">1</span>,<span class="dv">0</span>)</span></code></pre></div>
</div>
</div>
</div>
<div id="manipulación-de-bases-de-datos-parte-i" class="section level2 hasAnchor" number="2.3">
<h2 class="hasAnchor"><span class="header-section-number">2.3</span> Manipulación de bases de datos (Parte I)<a href="#manipulación-de-bases-de-datos-parte-i" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="principios-de-programación" class="section level3 hasAnchor" number="2.3.1">
<h3 class="hasAnchor"><span class="header-section-number">2.3.1</span> Principios de programación<a href="#principios-de-programación" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="iteradores" class="section level4 hasAnchor" number="2.3.1.1">
<h4 class="hasAnchor"><span class="header-section-number">2.3.1.1</span> Iteradores<a href="#iteradores" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>For loop:</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Imaginen que queremos mostrar los nombres de un vector de forma reiterada</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>ciudades <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Nueva York&quot;</span>, <span class="st">&quot;Paris&quot;</span>, <span class="st">&quot;Santiago&quot;</span>, <span class="st">&quot;Rancagua&quot;</span>)</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ciudades[<span class="dv">1</span>])</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ciudades[<span class="dv">2</span>])</span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ciudades[<span class="dv">3</span>])</span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ciudades[<span class="dv">4</span>])</span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Lo anterior se puede hacer utilizando un iterador.</span></span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>){</span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(ciudades[i])</span>
<span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb110-13"><a href="#cb110-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-14"><a href="#cb110-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Utilizando variables ocultas...</span></span>
<span id="cb110-15"><a href="#cb110-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (.j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>){</span>
<span id="cb110-16"><a href="#cb110-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(ciudades[.j])</span>
<span id="cb110-17"><a href="#cb110-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb110-18"><a href="#cb110-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-19"><a href="#cb110-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (.j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(ciudades)){</span>
<span id="cb110-20"><a href="#cb110-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(ciudades[.j])</span>
<span id="cb110-21"><a href="#cb110-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb110-22"><a href="#cb110-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-23"><a href="#cb110-23" aria-hidden="true" tabindex="-1"></a><span class="co"># o escrito señalando el nombre de cada elemento de un vector. </span></span>
<span id="cb110-24"><a href="#cb110-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (ciudad <span class="cf">in</span> ciudades){</span>
<span id="cb110-25"><a href="#cb110-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(ciudad)</span>
<span id="cb110-26"><a href="#cb110-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb110-27"><a href="#cb110-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-28"><a href="#cb110-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Otro ejemplo:</span></span>
<span id="cb110-29"><a href="#cb110-29" aria-hidden="true" tabindex="-1"></a>semana <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Domingo&quot;</span>,</span>
<span id="cb110-30"><a href="#cb110-30" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Lunes&quot;</span>,</span>
<span id="cb110-31"><a href="#cb110-31" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Martes&quot;</span>,</span>
<span id="cb110-32"><a href="#cb110-32" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Miercoles&quot;</span>,</span>
<span id="cb110-33"><a href="#cb110-33" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Jueves&quot;</span>,</span>
<span id="cb110-34"><a href="#cb110-34" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Viernes&quot;</span>,</span>
<span id="cb110-35"><a href="#cb110-35" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Sabado&quot;</span>)</span>
<span id="cb110-36"><a href="#cb110-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-37"><a href="#cb110-37" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (dia <span class="cf">in</span> semana)</span>
<span id="cb110-38"><a href="#cb110-38" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb110-39"><a href="#cb110-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(dia)</span>
<span id="cb110-40"><a href="#cb110-40" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>For loop con opciones:</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>ciudades <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Nueva York&quot;</span>, <span class="st">&quot;Paris&quot;</span>, <span class="st">&quot;Santiago&quot;</span>, <span class="st">&quot;Tokio&quot;</span>)</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Agregar opcion break: quiebra el loop</span></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (ciudad <span class="cf">in</span> ciudades){</span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nchar</span>(ciudad) <span class="sc">==</span> <span class="dv">8</span>){</span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span></span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(ciudad)</span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Agregar  Opción next: se salta ese elemento</span></span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (ciudad <span class="cf">in</span> ciudades){</span>
<span id="cb111-13"><a href="#cb111-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nchar</span>(ciudad) <span class="sc">==</span> <span class="dv">8</span>){</span>
<span id="cb111-14"><a href="#cb111-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">next</span> </span>
<span id="cb111-15"><a href="#cb111-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb111-16"><a href="#cb111-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(ciudad)</span>
<span id="cb111-17"><a href="#cb111-17" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Flexibilizar el iterador:</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>ciudades <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Nueva York&quot;</span>, <span class="st">&quot;Paris&quot;</span>, <span class="st">&quot;Santiago&quot;</span>, </span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;Tokio&quot;</span>, <span class="st">&quot;Rancagua&quot;</span>, <span class="st">&quot;Roma&quot;</span>)</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Ahora el tamaño del loop es flexible. Esto es muy inportante para cuando trabajemos con bases de datos. </span></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(ciudades)){</span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(ciudades[i])</span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Noten que ahora llamo a los elementos dentro de un loop como subconjuntos de un vector. </span></span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a><span class="co"># En resumen, dos versiones de lo mismo </span></span>
<span id="cb112-13"><a href="#cb112-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-14"><a href="#cb112-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(ciudades)){</span>
<span id="cb112-15"><a href="#cb112-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(ciudades[i])</span>
<span id="cb112-16"><a href="#cb112-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb112-17"><a href="#cb112-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-18"><a href="#cb112-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (ciudad <span class="cf">in</span> ciudades){</span>
<span id="cb112-19"><a href="#cb112-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb112-20"><a href="#cb112-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(ciudad)</span>
<span id="cb112-21"><a href="#cb112-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb112-22"><a href="#cb112-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-23"><a href="#cb112-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Ejemplo: para dejar mensajes </span></span>
<span id="cb112-24"><a href="#cb112-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-25"><a href="#cb112-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(ciudades)){</span>
<span id="cb112-26"><a href="#cb112-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(ciudades[i], <span class="st">&quot;esta en la posicion&quot;</span>,i, </span>
<span id="cb112-27"><a href="#cb112-27" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;en el vector ciudades&quot;</span>))</span>
<span id="cb112-28"><a href="#cb112-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb112-29"><a href="#cb112-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-30"><a href="#cb112-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Lo anterior es aplicable para inspecciones de bases de datos, por ejemplo, podemos dejar un mensaje</span></span>
<span id="cb112-31"><a href="#cb112-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-32"><a href="#cb112-32" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(mtcars)){</span>
<span id="cb112-33"><a href="#cb112-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;el promedio de la variable&quot;</span>,</span>
<span id="cb112-34"><a href="#cb112-34" aria-hidden="true" tabindex="-1"></a>              <span class="fu">names</span>(mtcars[i]), <span class="st">&quot;es&quot;</span>,</span>
<span id="cb112-35"><a href="#cb112-35" aria-hidden="true" tabindex="-1"></a>              <span class="fu">mean</span>(mtcars[,i])))</span>
<span id="cb112-36"><a href="#cb112-36" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>While: mientras que…</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span> </span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (x <span class="sc">&lt;=</span> <span class="dv">7</span>){</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;x es&quot;</span>, x))</span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Actualización </span></span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> x <span class="sc">+</span> <span class="dv">1</span> </span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (x <span class="sc">&lt;=</span> <span class="dv">700</span>){</span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;x es&quot;</span>, x))</span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Actualizacion </span></span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> x <span class="sc">+</span> <span class="dv">1</span> </span>
<span id="cb113-14"><a href="#cb113-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb113-15"><a href="#cb113-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-16"><a href="#cb113-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Muy importante la actualización.</span></span></code></pre></div>
</div>
<div id="lapply-sapply-y-vapply" class="section level4 hasAnchor" number="2.3.1.2">
<h4 class="hasAnchor"><span class="header-section-number">2.3.1.2</span> Lapply, Sapply y Vapply<a href="#lapply-sapply-y-vapply" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Lapply:</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>nyc <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">poblacion =</span> <span class="dv">8405837</span>, </span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">barrios =</span> <span class="fu">c</span>(<span class="st">&quot;Manhattan&quot;</span>, <span class="st">&quot;Bronx&quot;</span>, </span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;Brooklyn&quot;</span>, <span class="st">&quot;Queens&quot;</span>, </span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;Staten Island&quot;</span>))</span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>nyc</span></code></pre></div>
<ul>
<li>Equivalencia loop y lapply. Quiero saber todas las clases de la lista:</li>
</ul>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Puedo hacer esto con un loop </span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (objeto <span class="cf">in</span> nyc){</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">class</span>(objeto))</span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(nyc)){</span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">class</span>(nyc[[i]]))</span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-10"><a href="#cb115-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Pero, si utilizo `lapply()` puedo hacerlo mucho más eficiente. </span></span>
<span id="cb115-11"><a href="#cb115-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Lapply: que aplica esto como si fuese un `for`. </span></span>
<span id="cb115-12"><a href="#cb115-12" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(nyc,class)</span></code></pre></div>
<ul>
<li>Resultado de lapply con vector:</li>
</ul>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lapply ejecuta la función, en este caso class, para todo elemento del objeto, en este caso nyc. </span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Si quiero saber el número de carácteres</span></span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>cities <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;New york&quot;</span>,<span class="st">&quot;Paris&quot;</span>, <span class="st">&quot;Tokyo&quot;</span>, <span class="st">&quot; Rio de Janeiro&quot;</span>)</span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(cities,nchar)</span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(<span class="fu">lapply</span>(cities,nchar))</span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Noten que el resultado aquí es una lista. Si quiero que sea un vector, puedo utilizar la función `unlist()`. </span></span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a><span class="fu">unlist</span>(<span class="fu">lapply</span>(cities,nchar))</span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(<span class="fu">unlist</span>(<span class="fu">lapply</span>(cities,nchar)))</span></code></pre></div>
<ul>
<li>Lapply como función:</li>
</ul>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>precios <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fl">2.25</span>, <span class="fl">2.18</span>, <span class="fl">2.89</span>, <span class="fl">2.84</span>, <span class="fl">2.89</span>)</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Creamos una función</span></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>multiplicar <span class="ot">&lt;-</span> <span class="cf">function</span>(x,factor){</span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">*</span> factor</span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Ahora, podemos aplicar lapply y agregar opciones de la función</span></span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a>tresveces <span class="ot">&lt;-</span> <span class="fu">lapply</span>(precios, multiplicar, <span class="at">factor =</span> <span class="dv">3</span>)</span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a>tresveces <span class="ot">&lt;-</span> <span class="fu">unlist</span>(tresveces)</span>
<span id="cb117-11"><a href="#cb117-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-12"><a href="#cb117-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Noten que la sintaxis es: objeto, función, opciones. Es decir, igual a lo anterior, pero pudiendo agregar opcionales. </span></span></code></pre></div>
<p><strong>Sapply:</strong> Es una variacion de <code>lapply</code> que sirve para simplificar <code>lapply</code>. Ahora el resultado es un vector, no una lista.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>cities <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;New york&quot;</span>,<span class="st">&quot;Paris&quot;</span>, <span class="st">&quot;Tokyo&quot;</span>, <span class="st">&quot; Rio de Janeiro&quot;</span>)</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(cities,nchar)</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(cities,nchar)</span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Noten que es bastante ordenado. Sin embargo, falla cuando no es fácil ordenar el resultado. </span></span></code></pre></div>
<p><strong>Vapply:</strong> Es una variación que sirve para definir explícitamente el tipo de objeto del resultado.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vapply</span>(cities, nchar, <span class="fu">numeric</span>(<span class="dv">1</span>))</span></code></pre></div>
</div>
</div>
<div id="manipulacion-de-bases-de-datos-en-r" class="section level3 hasAnchor" number="2.3.2">
<h3 class="hasAnchor"><span class="header-section-number">2.3.2</span> Manipulacion de bases de datos en R<a href="#manipulacion-de-bases-de-datos-en-r" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Analizar datos es parte importante de las labores que uno desea realizar al utilizar R. Vamos a revisar cuatro aspectos iniciales de cualquier trabajo con datos:</p>
<ol style="list-style-type: decimal">
<li>Importar datos en distintos formatos.</li>
<li>Inspeccionar y limpiar los datos que tenemos.</li>
<li>Transformar los datos con el fin de crear nuevas variables.</li>
<li>Juntar bases de datos de distinto tipo.</li>
</ol>
<div id="importar-bases-de-datos" class="section level4 hasAnchor" number="2.3.2.1">
<h4 class="hasAnchor"><span class="header-section-number">2.3.2.1</span> Importar bases de datos<a href="#importar-bases-de-datos" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li><p>Para poder utilizar, cargar, renovar datos es importante tenerlos todos en un solo lugar.</p></li>
<li><p>Esto también aplica para los resultados y codigos.</p></li>
<li><p>Para que esto efectivamente ocurra necesitamos decirle a R cual va a ser nuestro directorio de trabajo. Es decir, el lugar donde guardaremos los datos que queremos trabajar, los resultados de nuestros análisis y nuestros códigos.</p></li>
</ol>
<p>Directorios de trabajo en R:</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Me dice donde estoy </span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a><span class="fu">getwd</span>()</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Si quiero indicarle otra ruta tengo dos opciones: </span></span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Opcion 1: Indicar a R la ruta/carpeta donde tengo mis datos </span></span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">&quot;C:/Users/catab/Dropbox/Cursos de R/Curso R - Noviembre 2022/Clase 3&quot;</span>)</span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Opcion 2: Lo mismo que opcion 1, pero más ordenado. </span></span>
<span id="cb120-10"><a href="#cb120-10" aria-hidden="true" tabindex="-1"></a>ruta <span class="ot">&lt;-</span><span class="st">&quot;C:/Users/catab/Dropbox/Cursos de R/Curso R - Noviembre 2022/Clase 3&quot;</span></span>
<span id="cb120-11"><a href="#cb120-11" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(ruta)</span>
<span id="cb120-12"><a href="#cb120-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-13"><a href="#cb120-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Noten que es necesario ocupar `/`. Por defecto las rutas al copiarlas vienen con otro tipo de &quot;slash&quot;. Para cambiarlas fácilmente, y no una por una, vamos a utilizar `ctrl + f`. </span></span>
<span id="cb120-14"><a href="#cb120-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-15"><a href="#cb120-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Con este atajo podemos remplazar varios elementos a la vez. Cuidado!! Es importante decirle si queremos que modifique todo el documento o bien solo una parte. </span></span>
<span id="cb120-16"><a href="#cb120-16" aria-hidden="true" tabindex="-1"></a><span class="fu">dir</span>(ruta)</span></code></pre></div>
<p>Ejemplo de ordenar carpetas:</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>ruta <span class="ot">&lt;-</span> <span class="st">&quot;C:/Users/catab/Dropbox/Cursos de R/Curso R - Noviembre 2022/Clase 3&quot;</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Codigos </span></span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>codigos <span class="ot">&lt;-</span> <span class="st">&quot;C:/Users/catab/Dropbox/Cursos de R/Curso R - Noviembre 2022/Clase 3/codigos&quot;</span></span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>codigos <span class="ot">&lt;-</span> <span class="fu">paste</span>(ruta,<span class="st">&quot;/&quot;</span>,<span class="st">&quot;codigos&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(codigos)</span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a><span class="fu">dir</span>(codigos)</span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Datos </span></span>
<span id="cb121-10"><a href="#cb121-10" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> <span class="st">&quot;C:/Users/catab/Dropbox/Curso R - Agosto 2022/Clase 3/datos&quot;</span></span>
<span id="cb121-11"><a href="#cb121-11" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> <span class="fu">paste</span>(ruta,<span class="st">&quot;/&quot;</span>,<span class="st">&quot;datos&quot;</span>,<span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb121-12"><a href="#cb121-12" aria-hidden="true" tabindex="-1"></a><span class="fu">dir</span>(datos)</span>
<span id="cb121-13"><a href="#cb121-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-14"><a href="#cb121-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Datos raw </span></span>
<span id="cb121-15"><a href="#cb121-15" aria-hidden="true" tabindex="-1"></a>datosraw <span class="ot">&lt;-</span> <span class="st">&quot;C:/Users/catab/Dropbox/Cursos de R/Curso R - Noviembre 2022/Clase 3/datos/raw&quot;</span></span>
<span id="cb121-16"><a href="#cb121-16" aria-hidden="true" tabindex="-1"></a><span class="fu">dir</span>(datosraw)</span>
<span id="cb121-17"><a href="#cb121-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-18"><a href="#cb121-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Todo lo anterior no es muy recomendado. </span></span></code></pre></div>
<p>Proyectos de R:</p>
<ul>
<li>Proyecto: piensen en muchos proyectos con muchos códigos.</li>
<li>Es una herramienta incorporada en RStudio que permite manejar un proyecto de análisis de datos.</li>
<li>Permite dividir el trabajo en múltiples contextos cada uno con su propio directorio de trabajo, espacio de trabajo e historial.</li>
<li>¿Por qué utilizarlo?
<ul>
<li>Mantiene códigos y datos en la misma carpeta.</li>
<li>Mantiene códigos y datos separados de otros proyectos: evita confusiones o errores.</li>
<li>Identifica automáticamente el directorio de trabajo, facilitando cooperación.</li>
</ul></li>
</ul>
<p>Pasos para crear un proyecto:</p>
<ul>
<li>Dos opciones:
<ul>
<li>R crea una carpeta de trabajo.</li>
<li>Crear una carpeta primero, y luego decirle a R que la identifique.</li>
</ul></li>
<li>Todos los nuevos archivos serán automáticamente guardados en la carpeta del proyecto.</li>
<li>Una vez hecho el proyecto se genera un archivo con extensión <code>R.proj</code>.</li>
<li>Aquí R guarda información del proyecto: historial, datos, etc.</li>
<li>Lo más importante es que fija el directorio de trabajo de forma tal de que siempre sea el mismo una vez que se abre un proyecto. Evita cambiar directorios de trabajo al colaborar.</li>
</ul>
<p>Package here:</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;pacman&quot;</span>)</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(<span class="st">&quot;here&quot;</span>)</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a><span class="fu">here</span>()</span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a><span class="fu">here</span>(<span class="st">&quot;datos&quot;</span>)</span></code></pre></div>
<p>Package <code>rio</code>: R tiene bases de datos propias. Sin embargo, muchas veces van a querer trabajar con datos propios. o bien de datos públicos que muchas veces estan en distintos formatos. Rio package es una forma flexible de importar datos en distintos.</p>
<p>Rio debe su nombre por R input/output. Dos funciones principales: <code>import()</code> y <code>export()</code>. Además, cuando se le indica la extensión a <code>rio</code> este leerá y utilizará la herramienta indicada para leer esos datos.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pacman)</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a><span class="fu">p_load</span>(here, <span class="co"># Modificar carpetas</span></span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>       rio)  <span class="co"># Importar/exportar datos</span></span></code></pre></div>
<p>Hay otras opciones tambien para importar datos. Por ejemplo, <code>read.csv() ("base R")</code>; <code>read.xlsx ("openxlsx")</code>. El problema es que son difíciles de recordar. Mejor utilizar una.</p>
<p>Importar datos en distintos formatos: Utilizar <code>import()</code> para importar un conjunto de datos es bastante sencillo. Basta con proporcionar la ruta del archivo (incluyendo el nombre y la extensión del archivo) entre comillas.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ocupamos R project, here e import para importar datos fácilmente</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>datos_xlsx <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="fu">here</span>(<span class="st">&quot;datos&quot;</span>, <span class="st">&quot;Data.xlsx&quot;</span>))</span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>datos_dta  <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="fu">here</span>(<span class="st">&quot;datos&quot;</span>, <span class="st">&quot;Data.dta&quot;</span>))</span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>datos_txt  <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="fu">here</span>(<span class="st">&quot;datos&quot;</span>, <span class="st">&quot;Data.txt&quot;</span>))</span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>datos_csv  <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="fu">here</span>(<span class="st">&quot;datos&quot;</span>, <span class="st">&quot;Data.csv&quot;</span>))</span></code></pre></div>
<p>Opciones:</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Importar distintas hojas: Por defecto se importa la primer hoja de una base de datos, con &quot;which&quot; puedo elegir la hoja.</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>datos_xlsx_h1 <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="fu">here</span>(<span class="st">&quot;datos&quot;</span>, <span class="st">&quot;Data.xlsx&quot;</span>), </span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">which =</span> <span class="st">&quot;hoja1&quot;</span>) </span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>datos_xlsx_h2 <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="fu">here</span>(<span class="st">&quot;datos&quot;</span>, <span class="st">&quot;Data.xlsx&quot;</span>), </span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">which =</span> <span class="st">&quot;hoja2&quot;</span>) </span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Puedo decirle a priori que valores son missings. </span></span>
<span id="cb125-9"><a href="#cb125-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-10"><a href="#cb125-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Especificar un missing</span></span>
<span id="cb125-11"><a href="#cb125-11" aria-hidden="true" tabindex="-1"></a>datos_xlsx <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="fu">here</span>(<span class="st">&quot;datos&quot;</span>, <span class="st">&quot;Data.xlsx&quot;</span>), <span class="at">na =</span> <span class="st">&quot;2018&quot;</span>) </span>
<span id="cb125-12"><a href="#cb125-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-13"><a href="#cb125-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Especificar varios a la vez..</span></span>
<span id="cb125-14"><a href="#cb125-14" aria-hidden="true" tabindex="-1"></a>datos_xlsx <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="fu">here</span>(<span class="st">&quot;datos&quot;</span>, <span class="st">&quot;Data.xlsx&quot;</span>), </span>
<span id="cb125-15"><a href="#cb125-15" aria-hidden="true" tabindex="-1"></a>                     <span class="at">na =</span> <span class="fu">c</span>(<span class="st">&quot;Missing&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="st">&quot; &quot;</span>))</span>
<span id="cb125-16"><a href="#cb125-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-17"><a href="#cb125-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Saltar filas.</span></span>
<span id="cb125-18"><a href="#cb125-18" aria-hidden="true" tabindex="-1"></a>datos_xlsx <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="fu">here</span>(<span class="st">&quot;datos&quot;</span>, <span class="st">&quot;Data.xlsx&quot;</span>), <span class="at">skip =</span> <span class="dv">1</span>)</span>
<span id="cb125-19"><a href="#cb125-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-20"><a href="#cb125-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Noten que puedo hacerlo con cualquier tipo de datos, ya que son opciones de la función `rio`. </span></span>
<span id="cb125-21"><a href="#cb125-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-22"><a href="#cb125-22" aria-hidden="true" tabindex="-1"></a>datos_dta  <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="fu">here</span>(<span class="st">&quot;datos&quot;</span>, <span class="st">&quot;Data.dta&quot;</span>) , <span class="at">skip =</span> <span class="dv">1</span>)</span>
<span id="cb125-23"><a href="#cb125-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-24"><a href="#cb125-24" aria-hidden="true" tabindex="-1"></a><span class="co"># En la tabla de este link pueden ver los distintos paquetes que soporta `rio`, junto a ejemplo adicionales. </span></span>
<span id="cb125-25"><a href="#cb125-25" aria-hidden="true" tabindex="-1"></a><span class="fu">browseURL</span>(<span class="st">&quot;https://cran.r-project.org/web/packages/rio/vignettes/rio.html&quot;</span>) </span></code></pre></div>
</div>
</div>
</div>
<div id="manipulación-de-bases-de-datos-parte-ii" class="section level2 hasAnchor" number="2.4">
<h2 class="hasAnchor"><span class="header-section-number">2.4</span> Manipulación de bases de datos (Parte II)<a href="#manipulación-de-bases-de-datos-parte-ii" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Ya sabemos cargar datos. Ahora vamos a hacer el primer proceso para analizar cualquier base de datos.</p>
<div id="funciones-clave" class="section level3 hasAnchor" number="2.4.1">
<h3 class="hasAnchor"><span class="header-section-number">2.4.1</span> Funciones clave<a href="#funciones-clave" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>Tidyverse</code> es una colección de paquetes de R. <code>Tidyverse</code> contiene múltiples paquetes que iremos utilizando. Incluye: <code>dplyr</code>, <code>ggplot2</code>, <code>tidyr</code>, <code>stringr</code>, <code>tibble</code>, <code>purrr</code>, <code>magrittr</code> y <code>forcats</code>. Una paquete clave es <code>dplyr</code> que contiene muchas funciones para trabajar con bases de datos.</p>
<p>Instalamos tidyverse:</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;tidyverse&quot;</span>)</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pacman)</span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a><span class="fu">p_load</span>(tidyverse)</span></code></pre></div>
</div>
<div id="operador-piping" class="section level3 hasAnchor" number="2.4.2">
<h3 class="hasAnchor"><span class="header-section-number">2.4.2</span> Operador piping<a href="#operador-piping" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Piping <code>%&gt;%</code>: <code>crtrl + shift + m</code>. Paquete asociado: <code>magrittr</code></p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">p_load</span>(magrittr)</span></code></pre></div>
<ol style="list-style-type: decimal">
<li>Operador que permite encadenar las funciones para realizar de manera sencilla transformaciones complejas en las bases de datos.</li>
<li>Lo que dice es pasar el elemento que esta a su izquierda como un argumento de la función que tiene a la derecha.</li>
<li>Coloca el énfasis en las acciones. Pasa un output intermedio de una función a la siguiente.</li>
<li><code>magrittr</code> es el paquete que permite ocupar <code>piping</code>. <code>piping</code> se utiliza mucho con las librerias de <code>tidyverse</code> y <code>dplyr</code> enfocadas en análisis de datos.</li>
<li>Excelente cuando existe una secuencia de acciones/operaciones que queremos realizar.</li>
</ol>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(iris)</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Ejemplo 1: usar pipe como encadenador </span></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(iris, <span class="at">n =</span> <span class="dv">4</span>)</span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Con piping</span></span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="at">n =</span> <span class="dv">4</span>)</span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Ejemplo 2: obtener número total de observaciones y un promedio. </span></span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize</span>(mtcars, </span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">media =</span> <span class="fu">mean</span>(disp))</span>
<span id="cb128-12"><a href="#cb128-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-13"><a href="#cb128-13" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">promedio =</span> <span class="fu">mean</span>(disp))</span>
<span id="cb128-14"><a href="#cb128-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-15"><a href="#cb128-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Con piping </span></span>
<span id="cb128-16"><a href="#cb128-16" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span></span>
<span id="cb128-17"><a href="#cb128-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(mpg <span class="sc">&gt;</span> <span class="dv">20</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-18"><a href="#cb128-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">promedio =</span> <span class="fu">mean</span>(disp))</span>
<span id="cb128-19"><a href="#cb128-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-20"><a href="#cb128-20" aria-hidden="true" tabindex="-1"></a>promedio_mpg_20 <span class="ot">&lt;-</span> mtcars <span class="sc">%&gt;%</span></span>
<span id="cb128-21"><a href="#cb128-21" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">filter</span>(mpg <span class="sc">&gt;</span> <span class="dv">20</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-22"><a href="#cb128-22" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">summarise</span>(<span class="at">promedio =</span> <span class="fu">mean</span>(disp))</span>
<span id="cb128-23"><a href="#cb128-23" aria-hidden="true" tabindex="-1"></a>promedio_mpg_20 </span></code></pre></div>
</div>
<div id="proceso-de-análisis-de-datos-parte-i-cargar-inspeccionar-y-limpiar" class="section level3 hasAnchor" number="2.4.3">
<h3 class="hasAnchor"><span class="header-section-number">2.4.3</span> Proceso de análisis de datos (Parte I): cargar, inspeccionar y limpiar<a href="#proceso-de-análisis-de-datos-parte-i-cargar-inspeccionar-y-limpiar" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Preámbulo:</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Limpiar</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Cargamos paquetes que vamos a utilizar</span></span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pacman)</span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a><span class="fu">p_load</span>(</span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a>  rio,        <span class="co"># Importar/Exportar datos </span></span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a>  here,       <span class="co"># Determinar las rutas de mi carpeta </span></span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a>  tidyverse,  <span class="co"># Analisis de datos y visualización</span></span>
<span id="cb129-10"><a href="#cb129-10" aria-hidden="true" tabindex="-1"></a>  magrittr,   <span class="co"># Para utilizar operador %&gt;%  </span></span>
<span id="cb129-11"><a href="#cb129-11" aria-hidden="true" tabindex="-1"></a>  janitor     <span class="co"># Para análisis de datos</span></span>
<span id="cb129-12"><a href="#cb129-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb129-13"><a href="#cb129-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-14"><a href="#cb129-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Importamos datos</span></span>
<span id="cb129-15"><a href="#cb129-15" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="fu">here</span>(<span class="st">&quot;datos&quot;</span>, <span class="st">&quot;Data.xlsx&quot;</span>), <span class="at">which =</span> <span class="st">&quot;hoja1&quot;</span>) </span></code></pre></div>
<p>Inspeccionar:</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visión general </span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>datos </span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a><span class="fu">view</span>(datos)</span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Para una inspección detallada </span></span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a><span class="fu">p_load</span>(skimr)</span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a><span class="fu">skim</span>(datos)</span>
<span id="cb130-8"><a href="#cb130-8" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(datos)</span>
<span id="cb130-9"><a href="#cb130-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-10"><a href="#cb130-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Mirar algunas filas, columnas, etc.</span></span>
<span id="cb130-11"><a href="#cb130-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-12"><a href="#cb130-12" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(datos)     <span class="co"># muestra las 6 primeras filas </span></span>
<span id="cb130-13"><a href="#cb130-13" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(datos)     <span class="co"># últimas 6 filas </span></span>
<span id="cb130-14"><a href="#cb130-14" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(datos, <span class="dv">11</span>) <span class="co"># podemos pedir m?s de 6 </span></span>
<span id="cb130-15"><a href="#cb130-15" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(datos, <span class="dv">3</span>)  <span class="co"># o menos de 6</span></span>
<span id="cb130-16"><a href="#cb130-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-17"><a href="#cb130-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Mirar nombre variables/columnas</span></span>
<span id="cb130-18"><a href="#cb130-18" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(datos)</span>
<span id="cb130-19"><a href="#cb130-19" aria-hidden="true" tabindex="-1"></a>datos <span class="sc">%&gt;%</span> <span class="fu">names</span>()</span>
<span id="cb130-20"><a href="#cb130-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-21"><a href="#cb130-21" aria-hidden="true" tabindex="-1"></a><span class="co"># `names()` también puede ser </span></span>
<span id="cb130-22"><a href="#cb130-22" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(datos) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;YEAR&quot;</span>, <span class="st">&quot;GDP&quot;</span>, <span class="st">&quot;GROSS_EXPORTS&quot;</span>, </span>
<span id="cb130-23"><a href="#cb130-23" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;GROSS_IMPORTS&quot;</span>, <span class="st">&quot;NET_EXPORTS&quot;</span> )</span>
<span id="cb130-24"><a href="#cb130-24" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(datos)</span>
<span id="cb130-25"><a href="#cb130-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-26"><a href="#cb130-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Mirar filas </span></span>
<span id="cb130-27"><a href="#cb130-27" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(datos)</span>
<span id="cb130-28"><a href="#cb130-28" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(mtcars)</span>
<span id="cb130-29"><a href="#cb130-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-30"><a href="#cb130-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Mirar la cantidad de variables de la base de datos</span></span>
<span id="cb130-31"><a href="#cb130-31" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(datos) <span class="co"># columnas o variables</span></span>
<span id="cb130-32"><a href="#cb130-32" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(datos) </span>
<span id="cb130-33"><a href="#cb130-33" aria-hidden="true" tabindex="-1"></a><span class="fu">ncol</span>(datos) </span>
<span id="cb130-34"><a href="#cb130-34" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(datos)</span>
<span id="cb130-35"><a href="#cb130-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-36"><a href="#cb130-36" aria-hidden="true" tabindex="-1"></a><span class="co"># ¿Qué tipo de objeto es? </span></span>
<span id="cb130-37"><a href="#cb130-37" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(datos)</span>
<span id="cb130-38"><a href="#cb130-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-39"><a href="#cb130-39" aria-hidden="true" tabindex="-1"></a><span class="co"># También podemos inspeccionar elementos específicos</span></span>
<span id="cb130-40"><a href="#cb130-40" aria-hidden="true" tabindex="-1"></a>datos<span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="fu">here</span>(<span class="st">&quot;datos&quot;</span>, <span class="st">&quot;Data.xlsx&quot;</span>), <span class="at">which =</span> <span class="st">&quot;hoja1&quot;</span>) </span>
<span id="cb130-41"><a href="#cb130-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-42"><a href="#cb130-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Si queremos ver la columna de GDP</span></span>
<span id="cb130-43"><a href="#cb130-43" aria-hidden="true" tabindex="-1"></a>datos<span class="sc">$</span>gdp</span>
<span id="cb130-44"><a href="#cb130-44" aria-hidden="true" tabindex="-1"></a>datos[<span class="dv">2</span>]</span>
<span id="cb130-45"><a href="#cb130-45" aria-hidden="true" tabindex="-1"></a>datos[,<span class="dv">2</span>]</span>
<span id="cb130-46"><a href="#cb130-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-47"><a href="#cb130-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Para llamarlos solo por su nombre recordar ocupar `attach()`</span></span>
<span id="cb130-48"><a href="#cb130-48" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(datos)</span>
<span id="cb130-49"><a href="#cb130-49" aria-hidden="true" tabindex="-1"></a>gdp</span>
<span id="cb130-50"><a href="#cb130-50" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(datos)</span>
<span id="cb130-51"><a href="#cb130-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-52"><a href="#cb130-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Si queremos un objeto dentro de una variable </span></span>
<span id="cb130-53"><a href="#cb130-53" aria-hidden="true" tabindex="-1"></a>datos<span class="sc">$</span>gdp[<span class="dv">7</span>]</span>
<span id="cb130-54"><a href="#cb130-54" aria-hidden="true" tabindex="-1"></a>datos[<span class="dv">7</span>,<span class="dv">2</span>]      <span class="co">#[fila, columna]</span></span>
<span id="cb130-55"><a href="#cb130-55" aria-hidden="true" tabindex="-1"></a>datos[<span class="dv">7</span>,<span class="st">&quot;gdp&quot;</span>]</span>
<span id="cb130-56"><a href="#cb130-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-57"><a href="#cb130-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Si queremos seleccionar parte de la columna </span></span>
<span id="cb130-58"><a href="#cb130-58" aria-hidden="true" tabindex="-1"></a>datos<span class="sc">$</span>gdp[<span class="dv">5</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb130-59"><a href="#cb130-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-60"><a href="#cb130-60" aria-hidden="true" tabindex="-1"></a><span class="co"># o bien (solo por `attach()`)</span></span>
<span id="cb130-61"><a href="#cb130-61" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(datos)</span>
<span id="cb130-62"><a href="#cb130-62" aria-hidden="true" tabindex="-1"></a>gdp[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb130-63"><a href="#cb130-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-64"><a href="#cb130-64" aria-hidden="true" tabindex="-1"></a><span class="co"># o bien </span></span>
<span id="cb130-65"><a href="#cb130-65" aria-hidden="true" tabindex="-1"></a>datos[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,<span class="dv">2</span>] <span class="co"># mostrar las filas 1:2, de la columna 2</span></span>
<span id="cb130-66"><a href="#cb130-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-67"><a href="#cb130-67" aria-hidden="true" tabindex="-1"></a><span class="co"># `table()` me permite hacer una tabla sencilla de frecuencias</span></span>
<span id="cb130-68"><a href="#cb130-68" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(datos<span class="sc">$</span>year)</span>
<span id="cb130-69"><a href="#cb130-69" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(datos)</span>
<span id="cb130-70"><a href="#cb130-70" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(year)</span>
<span id="cb130-71"><a href="#cb130-71" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(datos)</span></code></pre></div>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 2.4.1:</b> Utilizando el operador pipping, mostrar las últimas 2 filas de las primeras 11 filas.</p>
</div>
<p>Limpiar:</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(datos) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;YEAR&quot;</span>, <span class="st">&quot;GDP&quot;</span>, <span class="st">&quot;GROSS_EXPORTS&quot;</span>, </span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;GROSS_IMPORTS&quot;</span>, <span class="st">&quot;NET_EXPORTS&quot;</span> )</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(datos)</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a><span class="co"># La función `clean_names()` del paquete `janitor` estandariza nombres: </span></span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>datos_nuevos <span class="ot">&lt;-</span> <span class="fu">clean_names</span>(datos)</span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(datos)</span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(datos_nuevos)</span></code></pre></div>
<p>Renombrar variables:</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>datos<span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="fu">here</span>(<span class="st">&quot;datos&quot;</span>, <span class="st">&quot;Data.xlsx&quot;</span>), <span class="at">which =</span> <span class="st">&quot;hoja1&quot;</span>) </span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Función para renombrar variables. Sintaxis: rename(nuevonombre = viejonombre)</span></span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Escribamos esto, pero con `piping`</span></span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a>datos_renombrados <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span> </span>
<span id="cb132-9"><a href="#cb132-9" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">rename</span>(<span class="at">tiempo =</span> year, </span>
<span id="cb132-10"><a href="#cb132-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">pib =</span> gdp, </span>
<span id="cb132-11"><a href="#cb132-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">exportaciones =</span> gross_exports)</span>
<span id="cb132-12"><a href="#cb132-12" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(datos_renombrados)</span>
<span id="cb132-13"><a href="#cb132-13" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(datos_renombrados)</span></code></pre></div>
<p>Seleccionar variables o columnas:</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span> <span class="fu">ls</span>())</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>datos<span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="fu">here</span>(<span class="st">&quot;datos&quot;</span>, <span class="st">&quot;Data.xlsx&quot;</span>), <span class="at">which =</span> <span class="st">&quot;hoja1&quot;</span>) </span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a><span class="co"># select() de `dplyr` permite seleccionar variables</span></span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>datos_select <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span> </span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">select</span>(year, gdp)  </span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a>datos_select1 <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span> </span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>))</span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-11"><a href="#cb133-11" aria-hidden="true" tabindex="-1"></a>datos_select1 <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span> </span>
<span id="cb133-12"><a href="#cb133-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(datos)<span class="sc">-</span><span class="dv">1</span>))  </span>
<span id="cb133-13"><a href="#cb133-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-14"><a href="#cb133-14" aria-hidden="true" tabindex="-1"></a><span class="co"># También puedo seleccionar en base a un criterio (Sólo sirve para string)</span></span>
<span id="cb133-15"><a href="#cb133-15" aria-hidden="true" tabindex="-1"></a>datos_select2 <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span> </span>
<span id="cb133-16"><a href="#cb133-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, <span class="fu">contains</span>(<span class="st">&quot;Gross&quot;</span>))</span>
<span id="cb133-17"><a href="#cb133-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-18"><a href="#cb133-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Con `select` también se puede renombrar </span></span>
<span id="cb133-19"><a href="#cb133-19" aria-hidden="true" tabindex="-1"></a>datos_select_renombrados <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span> </span>
<span id="cb133-20"><a href="#cb133-20" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">select</span>(<span class="at">tiempo =</span> year, </span>
<span id="cb133-21"><a href="#cb133-21" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">pib =</span> gdp)</span>
<span id="cb133-22"><a href="#cb133-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-23"><a href="#cb133-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Una opción es ocupar select con `everything()` para ordeanar mis columnas. </span></span>
<span id="cb133-24"><a href="#cb133-24" aria-hidden="true" tabindex="-1"></a>datos_select_ordenados <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span> </span>
<span id="cb133-25"><a href="#cb133-25" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">select</span>(gdp, year, <span class="fu">everything</span>()) </span></code></pre></div>
<p>Remover columnas:</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="co"># La idea aqui es decir: todas se quedan, menos las que pongo aquí. </span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>datos_select_remover <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span> </span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(gdp, year)) </span></code></pre></div>
<p>Mirar si hay duplicados. En ocasiones es importante revisar si hay duplicados. El paquete <code>dplyr</code> contiene <code>distinct()</code>. Esta función examina cada fila y reduce los datos solo a las que sean valores diferentes:</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>datos1 <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ¿Cuantos duplicados?</span></span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(datos)</span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(datos1)</span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a>dif <span class="ot">&lt;-</span> <span class="fu">nrow</span>(datos) <span class="sc">-</span> <span class="fu">nrow</span>(datos1) </span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a>dif</span></code></pre></div>
</div>
<div id="proceso-de-análisis-de-datos-parte-ii-cargar-inspeccionar-y-limpiar" class="section level3 hasAnchor" number="2.4.4">
<h3 class="hasAnchor"><span class="header-section-number">2.4.4</span> Proceso de análisis de datos (Parte II): cargar, inspeccionar y limpiar<a href="#proceso-de-análisis-de-datos-parte-ii-cargar-inspeccionar-y-limpiar" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Cargar:</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Limpiamos consola</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Cargamos paquetes que vamos a utilizar</span></span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a>  rio,        <span class="co"># importar/exportar datos. </span></span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a>  here,       <span class="co"># escribir rutas de las carpetas.  </span></span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a>  janitor,    <span class="co"># limpiar datos y tablas.</span></span>
<span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a>  tidyverse,  <span class="co"># Manejo de bases de datos y visualización. </span></span>
<span id="cb136-10"><a href="#cb136-10" aria-hidden="true" tabindex="-1"></a>  magrittr,    <span class="co"># Permite utilizar operador %&gt;% (piping). </span></span>
<span id="cb136-11"><a href="#cb136-11" aria-hidden="true" tabindex="-1"></a>  skimr,       <span class="co"># Inspeccionar datos</span></span>
<span id="cb136-12"><a href="#cb136-12" aria-hidden="true" tabindex="-1"></a>  inspectdf,   <span class="co"># Inspeccionar datos</span></span>
<span id="cb136-13"><a href="#cb136-13" aria-hidden="true" tabindex="-1"></a>  gapminder    <span class="co"># Base de datos con información de países. </span></span>
<span id="cb136-14"><a href="#cb136-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb136-15"><a href="#cb136-15" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;gapminder&quot;</span>)</span>
<span id="cb136-16"><a href="#cb136-16" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> <span class="fu">view</span>()</span>
<span id="cb136-17"><a href="#cb136-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-18"><a href="#cb136-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Cargamos datos que vienen incluidos en R. </span></span>
<span id="cb136-19"><a href="#cb136-19" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(starwars) </span>
<span id="cb136-20"><a href="#cb136-20" aria-hidden="true" tabindex="-1"></a>starwars </span></code></pre></div>
<p>Inspeccionar datos:</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  Inspect_cat() retorna una base de datos que resume características de un data.frame.</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>inspeccion <span class="ot">&lt;-</span> <span class="fu">inspect_cat</span>(starwars)</span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>inspeccion</span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(inspeccion)</span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Las columnas son: </span></span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true" tabindex="-1"></a><span class="co"># col_names: nombre de cada columna</span></span>
<span id="cb137-9"><a href="#cb137-9" aria-hidden="true" tabindex="-1"></a><span class="co"># cnt: número de valores únicos por nivel</span></span>
<span id="cb137-10"><a href="#cb137-10" aria-hidden="true" tabindex="-1"></a><span class="co"># common: el nivel más común</span></span>
<span id="cb137-11"><a href="#cb137-11" aria-hidden="true" tabindex="-1"></a><span class="co"># common_pcnt: el porcentaje de ocurrencia del nivel más común.</span></span>
<span id="cb137-12"><a href="#cb137-12" aria-hidden="true" tabindex="-1"></a><span class="co"># levels: una lista de dataframes (tibbles) cada uno con tablas de frecuencia para todos los niveles. </span></span>
<span id="cb137-13"><a href="#cb137-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-14"><a href="#cb137-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Notar que una de las columnas de un data frame pueden ser listas: </span></span>
<span id="cb137-15"><a href="#cb137-15" aria-hidden="true" tabindex="-1"></a>inspeccion[<span class="dv">1</span>,<span class="dv">5</span>]</span>
<span id="cb137-16"><a href="#cb137-16" aria-hidden="true" tabindex="-1"></a>inspeccion[<span class="dv">2</span>,<span class="dv">5</span>]</span>
<span id="cb137-17"><a href="#cb137-17" aria-hidden="true" tabindex="-1"></a>inspeccion[<span class="dv">3</span>,<span class="dv">5</span>]</span>
<span id="cb137-18"><a href="#cb137-18" aria-hidden="true" tabindex="-1"></a>inspeccion[<span class="dv">4</span>,<span class="dv">5</span>]</span>
<span id="cb137-19"><a href="#cb137-19" aria-hidden="true" tabindex="-1"></a>inspeccion[<span class="dv">5</span>,<span class="dv">5</span>]</span>
<span id="cb137-20"><a href="#cb137-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-21"><a href="#cb137-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Ahora, si quiero ver el contenido, debo utilizar doble paréntesis cuadrado</span></span>
<span id="cb137-22"><a href="#cb137-22" aria-hidden="true" tabindex="-1"></a>inspeccion[<span class="dv">1</span>,<span class="dv">5</span>]      <span class="co"># Con el nombre</span></span>
<span id="cb137-23"><a href="#cb137-23" aria-hidden="true" tabindex="-1"></a>inspeccion[[<span class="dv">1</span>,<span class="dv">5</span>]]    <span class="co"># El contenido</span></span>
<span id="cb137-24"><a href="#cb137-24" aria-hidden="true" tabindex="-1"></a>inspeccion[[<span class="dv">5</span>]]      <span class="co"># El contenido de todas las filas, en este caso, listas</span></span>
<span id="cb137-25"><a href="#cb137-25" aria-hidden="true" tabindex="-1"></a>inspeccion[[<span class="dv">5</span>]][[<span class="dv">1</span>]]</span>
<span id="cb137-26"><a href="#cb137-26" aria-hidden="true" tabindex="-1"></a>inspeccion[[<span class="dv">5</span>]][[<span class="dv">2</span>]]</span>
<span id="cb137-27"><a href="#cb137-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-28"><a href="#cb137-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Una forma más simple de mirar esta información es:</span></span>
<span id="cb137-29"><a href="#cb137-29" aria-hidden="true" tabindex="-1"></a>inspeccion<span class="sc">$</span>levels<span class="sc">$</span>eye_color</span>
<span id="cb137-30"><a href="#cb137-30" aria-hidden="true" tabindex="-1"></a>inspeccion[[<span class="dv">5</span>]][[<span class="dv">1</span>]]</span>
<span id="cb137-31"><a href="#cb137-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-32"><a href="#cb137-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Otra cosa interesante de este paquete es la función `show_plot()`</span></span>
<span id="cb137-33"><a href="#cb137-33" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> <span class="fu">inspect_cat</span>() <span class="sc">%&gt;%</span> <span class="fu">show_plot</span>()</span>
<span id="cb137-34"><a href="#cb137-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-35"><a href="#cb137-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Esta función permite ver las categorías de cada variable categórica. Noten que las zonas en gris son los NA. </span></span></code></pre></div>
<p>Limpiar bases de datos (continuación):</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span> <span class="fu">ls</span>())</span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>datos<span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="fu">here</span>(<span class="st">&quot;datos&quot;</span>, <span class="st">&quot;Data.xlsx&quot;</span>), <span class="at">which =</span> <span class="st">&quot;hoja1&quot;</span>) </span></code></pre></div>
<ul>
<li>Seleccionar columnas:</li>
</ul>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Vimos que `select()` es parte importante. `select()` puede ser utilizado con varias funciones adicionales: </span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. everything () - todas las otras columnas no mencionadas.</span></span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>datos_everything <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span> </span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span> (year, gdp, <span class="fu">everything</span>()) </span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. last_col () - la última columna.</span></span>
<span id="cb139-8"><a href="#cb139-8" aria-hidden="true" tabindex="-1"></a>datos_last_col <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span> </span>
<span id="cb139-9"><a href="#cb139-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, <span class="fu">last_col</span>())</span>
<span id="cb139-10"><a href="#cb139-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-11"><a href="#cb139-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. where () - aplicar una función a todas las columnas y </span></span>
<span id="cb139-12"><a href="#cb139-12" aria-hidden="true" tabindex="-1"></a><span class="co">#               selecciona solo las que cumple esta condición </span></span>
<span id="cb139-13"><a href="#cb139-13" aria-hidden="true" tabindex="-1"></a><span class="co">#               (es decir, cuando es verdadera). </span></span>
<span id="cb139-14"><a href="#cb139-14" aria-hidden="true" tabindex="-1"></a>datos_where <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span> </span>
<span id="cb139-15"><a href="#cb139-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.logical))</span>
<span id="cb139-16"><a href="#cb139-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-17"><a href="#cb139-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. contains () - columns containing a character string</span></span>
<span id="cb139-18"><a href="#cb139-18" aria-hidden="true" tabindex="-1"></a>datos_contains <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span> </span>
<span id="cb139-19"><a href="#cb139-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">&quot;exports&quot;</span>))</span>
<span id="cb139-20"><a href="#cb139-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-21"><a href="#cb139-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. starts_with () - selecciona la variable si se tiene un prefijo determinado</span></span>
<span id="cb139-22"><a href="#cb139-22" aria-hidden="true" tabindex="-1"></a>datos_starts_with <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span> </span>
<span id="cb139-23"><a href="#cb139-23" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;gross_&quot;</span>)) </span>
<span id="cb139-24"><a href="#cb139-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-25"><a href="#cb139-25" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. ends_with () - selecciona la variable si se tiene un sufijo determinado</span></span>
<span id="cb139-26"><a href="#cb139-26" aria-hidden="true" tabindex="-1"></a>datos_ends_with <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span> </span>
<span id="cb139-27"><a href="#cb139-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">ends_with</span>(<span class="st">&quot;_imports&quot;</span>)) </span>
<span id="cb139-28"><a href="#cb139-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-29"><a href="#cb139-29" aria-hidden="true" tabindex="-1"></a><span class="co"># 7. matches () - aplicar una expresión regular </span></span>
<span id="cb139-30"><a href="#cb139-30" aria-hidden="true" tabindex="-1"></a>datos_matches <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span> </span>
<span id="cb139-31"><a href="#cb139-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">matches</span>(<span class="st">&quot;gross|gdp&quot;</span>))</span>
<span id="cb139-32"><a href="#cb139-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-33"><a href="#cb139-33" aria-hidden="true" tabindex="-1"></a><span class="co"># 8. any_of () - la selecciona si la columna existe pero NO retorna error </span></span>
<span id="cb139-34"><a href="#cb139-34" aria-hidden="true" tabindex="-1"></a><span class="co">#                si no la encuentra. </span></span>
<span id="cb139-35"><a href="#cb139-35" aria-hidden="true" tabindex="-1"></a>datos_any_of  <span class="ot">&lt;-</span>  datos <span class="sc">%&gt;%</span> </span>
<span id="cb139-36"><a href="#cb139-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">any_of</span>(<span class="fu">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;gdp&quot;</span>, <span class="st">&quot;cualquiercosa&quot;</span>)))</span></code></pre></div>
<ul>
<li>Manipulación de NAs: Con vectores. Los NA son parte importante de la limpieza de los datos. Recordemos que la función <code>is.na()</code> nos permite identificarlos.</li>
</ul>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="cn">NA</span>,<span class="cn">NA</span>,<span class="dv">5</span>)</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>malos <span class="ot">&lt;-</span> <span class="fu">is.na</span>(x)  </span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>malos</span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(malos)</span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Si queremos eliminar los NA es cosa de colocar un vector sobre otro</span></span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a>x[<span class="sc">!</span>malos]</span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a>x[<span class="sc">!</span><span class="fu">is.na</span>(x)]</span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-10"><a href="#cb140-10" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> x[<span class="sc">!</span>malos]</span>
<span id="cb140-11"><a href="#cb140-11" aria-hidden="true" tabindex="-1"></a>x</span></code></pre></div>
<ul>
<li>Manipulación de NAs: con <code>complete cases()</code></li>
</ul>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Miremos un caso más práctico con iris</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(iris)</span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a><span class="fu">skim</span>(iris)</span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;iris&quot;</span>)</span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Generar NA en la base de datos (después veremos esto en detalle ahora concéntrense solo en los NA)</span></span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a>iris<span class="sc">$</span>Sepal.Length<span class="ot">&lt;-</span><span class="fu">ifelse</span>(iris<span class="sc">$</span>Sepal.Length<span class="sc">&lt;</span><span class="dv">5</span>, <span class="cn">NA</span>,iris<span class="sc">$</span>Sepal.Length)</span>
<span id="cb141-8"><a href="#cb141-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-9"><a href="#cb141-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Dos opciones: </span></span>
<span id="cb141-10"><a href="#cb141-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-11"><a href="#cb141-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># (i) como antes</span></span>
<span id="cb141-12"><a href="#cb141-12" aria-hidden="true" tabindex="-1"></a>  malos <span class="ot">&lt;-</span> <span class="fu">is.na</span>(iris<span class="sc">$</span>Sepal.Length)</span>
<span id="cb141-13"><a href="#cb141-13" aria-hidden="true" tabindex="-1"></a>  iris2 <span class="ot">&lt;-</span> iris[<span class="sc">!</span>malos,] </span>
<span id="cb141-14"><a href="#cb141-14" aria-hidden="true" tabindex="-1"></a>  iris2</span>
<span id="cb141-15"><a href="#cb141-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-16"><a href="#cb141-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># (ii) utilizando `complete.cases()`</span></span>
<span id="cb141-17"><a href="#cb141-17" aria-hidden="true" tabindex="-1"></a>  completos <span class="ot">&lt;-</span> <span class="fu">complete.cases</span>(iris<span class="sc">$</span>Sepal.Length)</span>
<span id="cb141-18"><a href="#cb141-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(completos, <span class="dv">100</span>) </span>
<span id="cb141-19"><a href="#cb141-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-20"><a href="#cb141-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Creamos una base nueva solo con casos completos. </span></span>
<span id="cb141-21"><a href="#cb141-21" aria-hidden="true" tabindex="-1"></a>  iris3 <span class="ot">&lt;-</span> iris[completos,] </span>
<span id="cb141-22"><a href="#cb141-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(iris3)  </span>
<span id="cb141-23"><a href="#cb141-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(iris3) </span></code></pre></div>
</div>
</div>
<div id="manipulación-de-bases-de-datos-parte-iii" class="section level2 hasAnchor" number="2.5">
<h2 class="hasAnchor"><span class="header-section-number">2.5</span> Manipulación de bases de datos (Parte III)<a href="#manipulación-de-bases-de-datos-parte-iii" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="crear-variables" class="section level3 hasAnchor" number="2.5.1">
<h3 class="hasAnchor"><span class="header-section-number">2.5.1</span> Crear Variables<a href="#crear-variables" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="crear-variables-binarias" class="section level4 hasAnchor" number="2.5.1.1">
<h4 class="hasAnchor"><span class="header-section-number">2.5.1.1</span> Crear variables binarias<a href="#crear-variables-binarias" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Ahora vamos a ver como crear variables dicótomas o binarias. Estas variables son muy importantes para hacer análisis de datos. Vamos a utilizar la función <code>ifelse()</code>.</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span> <span class="fu">ls</span>())</span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="fu">here</span>(<span class="st">&quot;datos&quot;</span>, <span class="st">&quot;Data.xlsx&quot;</span>), <span class="at">which =</span> <span class="st">&quot;hoja1&quot;</span>) </span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Asignar valor 1 si estamos en democracia, 0 caso contrario</span></span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">demo =</span> <span class="fu">ifelse</span>(year<span class="sc">&gt;=</span><span class="dv">1990</span>,<span class="dv">1</span>,<span class="dv">0</span>))</span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(data<span class="sc">$</span>demo)</span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-8"><a href="#cb142-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Tabla 1: ¿Cual fue el pib promedio en democracia y en dictadura?</span></span>
<span id="cb142-9"><a href="#cb142-9" aria-hidden="true" tabindex="-1"></a>tabla1 <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(demo) <span class="sc">%&gt;%</span> </span>
<span id="cb142-10"><a href="#cb142-10" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">summarize</span>(<span class="at">promediopib =</span> <span class="fu">mean</span>(gdp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) </span>
<span id="cb142-11"><a href="#cb142-11" aria-hidden="true" tabindex="-1"></a>tabla1 </span>
<span id="cb142-12"><a href="#cb142-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-13"><a href="#cb142-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Asignar valor 1 si estamos en democracia y el pib es mayor a su media</span></span>
<span id="cb142-14"><a href="#cb142-14" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span>  <span class="fu">mutate</span>(<span class="at">avance =</span> <span class="fu">ifelse</span>(demo <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> gdp <span class="sc">&gt;</span> <span class="fu">mean</span>(gdp),</span>
<span id="cb142-15"><a href="#cb142-15" aria-hidden="true" tabindex="-1"></a>                                         <span class="dv">1</span>,<span class="dv">0</span>))</span>
<span id="cb142-16"><a href="#cb142-16" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(data<span class="sc">$</span>gdp)</span>
<span id="cb142-17"><a href="#cb142-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-18"><a href="#cb142-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Asignar valor 1 si estamos en democracia y si dentro de esos periodos</span></span>
<span id="cb142-19"><a href="#cb142-19" aria-hidden="true" tabindex="-1"></a><span class="co"># las exportaciones netas son mayores a la mediana de las importaciones </span></span>
<span id="cb142-20"><a href="#cb142-20" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>expo <span class="ot">&lt;-</span><span class="fu">ifelse</span>(data<span class="sc">$</span>demo<span class="sc">==</span><span class="dv">1</span>, <span class="fu">ifelse</span>(data<span class="sc">$</span>gross_exports<span class="sc">&gt;</span></span>
<span id="cb142-21"><a href="#cb142-21" aria-hidden="true" tabindex="-1"></a>                                          <span class="fu">median</span>(data<span class="sc">$</span>gross_imports),<span class="dv">1</span>,<span class="dv">0</span>),<span class="dv">0</span>)</span>
<span id="cb142-22"><a href="#cb142-22" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(data<span class="sc">$</span>expo)</span></code></pre></div>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 2.5.1:</b> Escriba lo anterior utilizando mutate.</p>
</div>
<p>Respuesta:</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">expo =</span> <span class="fu">ifelse</span>(demo<span class="sc">==</span><span class="dv">1</span>, </span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>                                      <span class="fu">ifelse</span>(gross_exports<span class="sc">&gt;</span></span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>                                          <span class="fu">median</span>(gross_imports),<span class="dv">1</span>,<span class="dv">0</span>),<span class="dv">0</span>))</span></code></pre></div>
</div>
<div id="crear-variables-categóricas" class="section level4 hasAnchor" number="2.5.1.2">
<h4 class="hasAnchor"><span class="header-section-number">2.5.1.2</span> Crear variables categóricas<a href="#crear-variables-categóricas" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>También podemos crear variables categóricas utilizando <code>ifelse()</code>. De manera muy sencilla podemos generar variables según ciertas condiciones:</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="co"># De manera muy sencilla podemos generar variables según ciertas condiciones  </span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>tipo<span class="ot">&lt;-</span><span class="fu">ifelse</span>(data<span class="sc">$</span>year<span class="sc">&lt;</span><span class="dv">1980</span> <span class="sc">&amp;</span> data<span class="sc">$</span>year<span class="sc">&gt;</span><span class="dv">1959</span>,<span class="dv">1</span>,</span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">ifelse</span>(data<span class="sc">$</span>year<span class="sc">&lt;</span><span class="dv">2000</span> <span class="sc">&amp;</span> data<span class="sc">$</span>year<span class="sc">&gt;</span><span class="dv">1979</span>,<span class="dv">2</span>,</span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">ifelse</span>(data<span class="sc">$</span>year<span class="sc">&lt;</span><span class="dv">2010</span> <span class="sc">&amp;</span> data<span class="sc">$</span>year<span class="sc">&gt;</span><span class="dv">1999</span>,<span class="dv">3</span>,<span class="dv">4</span>)</span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a>                  )</span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(data<span class="sc">$</span>tipo)  </span>
<span id="cb144-8"><a href="#cb144-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-9"><a href="#cb144-9" aria-hidden="true" tabindex="-1"></a><span class="co">#  Nota: no es recomendable utilizar o escribir tantos `ifelse()` juntos.</span></span>
<span id="cb144-10"><a href="#cb144-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Es mejor utilizar `case_when()` que veremos un más adelante. </span></span></code></pre></div>
</div>
</div>
<div id="factores" class="section level3 hasAnchor" number="2.5.2">
<h3 class="hasAnchor"><span class="header-section-number">2.5.2</span> Factores<a href="#factores" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>R puede codificar automáticamente una variable categorica (factor) con un número entero. Sirven para hacer estadisticas o estimar regresiones. Los factores, pueden ser ordenados o no ordenados, se utilizan para representar variables que se agrupan en categorías.</p>
<p>Veamos un ejemplo:</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;Ford&quot;</span>,<span class="st">&quot;BMW&quot;</span>,<span class="st">&quot;Peugeot&quot;</span>),<span class="dv">10</span>)</span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>x</span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(x)</span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a><span class="co"># `factor()`</span></span>
<span id="cb145-7"><a href="#cb145-7" aria-hidden="true" tabindex="-1"></a>factor_nominal <span class="ot">&lt;-</span> <span class="fu">factor</span>(x)</span>
<span id="cb145-8"><a href="#cb145-8" aria-hidden="true" tabindex="-1"></a>factor_nominal</span>
<span id="cb145-9"><a href="#cb145-9" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(factor_nominal)</span>
<span id="cb145-10"><a href="#cb145-10" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(factor_nominal) <span class="co">#para analizar que niveles tiene el objeto</span></span>
<span id="cb145-11"><a href="#cb145-11" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(factor_nominal)  <span class="co"># resume la cantidad de observaciones por nivel</span></span></code></pre></div>
</div>
<div id="funciones-útiles-para-transformar-bases-de-datos" class="section level3 hasAnchor" number="2.5.3">
<h3 class="hasAnchor"><span class="header-section-number">2.5.3</span> Funciones útiles para transformar bases de datos<a href="#funciones-útiles-para-transformar-bases-de-datos" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>across()</code>: Algunas veces queremos aplicar una función a múltiples variables, para ello vamos a utilizar la función <code>across()</code> y especificar la función con <code>fns</code>. Por ejemplo:</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>datos2 <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">fns =</span> as.numeric))</span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Aquí `across()`, que es una función de &quot;dplyr&quot;, permite ser utilizada con `mutate()`, `select()`, `filter()`, `summarise()`, etc. </span></span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a>datos3 <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">contains</span>(<span class="st">&quot;gross&quot;</span>), <span class="at">.fns =</span> as.numeric))</span></code></pre></div>
<p><code>cumsum()</code>: Suma acumulada</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Para hacer operaciones acumuladas</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">15</span>,<span class="dv">10</span>))     <span class="co"># Retorna la suma del vector</span></span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cumsum</span>(<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">15</span>,<span class="dv">10</span>))  <span class="co"># Retorna la suma acumulada del vector</span></span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Puedo utilizarla con mutate ()</span></span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a>datos_acumulados <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb147-7"><a href="#cb147-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb147-8"><a href="#cb147-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(gdp) <span class="sc">%&gt;%</span> </span>
<span id="cb147-9"><a href="#cb147-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gdp_acumulado =</span> <span class="fu">cumsum</span>(n))</span>
<span id="cb147-10"><a href="#cb147-10" aria-hidden="true" tabindex="-1"></a>datos_acumulados</span></code></pre></div>
<p>Recodificar variables: A continuación se presentan algunos escenarios en los que es necesario recodificar (cambiar) los valores:</p>
<ol style="list-style-type: decimal">
<li>Editar un valor específico (por ejemplo, una fecha con un año o formato incorrecto)</li>
<li>Para conciliar valores que no se escriben igual</li>
<li>Crear una nueva columna de valores categóricas</li>
<li>Crear una nueva columna de categorías numéricas (por ejemplo, categorías de edad)</li>
</ol>
<p><code>recode ()</code>: Cambiar valores</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span> <span class="fu">ls</span>())</span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="fu">here</span>(<span class="st">&quot;datos&quot;</span>, <span class="st">&quot;Data.xlsx&quot;</span>), <span class="at">which =</span> <span class="st">&quot;hoja1&quot;</span>) </span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">demo =</span> <span class="fu">ifelse</span>(year<span class="sc">&gt;=</span><span class="dv">1990</span>,<span class="dv">1</span>,<span class="dv">0</span>))</span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Seguimos con data </span></span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(data)</span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Creamos una nueva variable </span></span>
<span id="cb148-9"><a href="#cb148-9" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">regimen =</span> <span class="fu">ifelse</span>(demo <span class="sc">==</span> <span class="dv">1</span>, <span class="st">&quot;Democracia&quot;</span>, <span class="st">&quot;Dictadura&quot;</span>))</span>
<span id="cb148-10"><a href="#cb148-10" aria-hidden="true" tabindex="-1"></a>datos </span>
<span id="cb148-11"><a href="#cb148-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-12"><a href="#cb148-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Recodificamos (cambiar nombres)</span></span>
<span id="cb148-13"><a href="#cb148-13" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span> </span>
<span id="cb148-14"><a href="#cb148-14" aria-hidden="true" tabindex="-1"></a>         <span class="fu">mutate</span>(<span class="at">regimen =</span> <span class="fu">recode</span>(regimen, <span class="st">&quot;Democracia&quot;</span> <span class="ot">=</span> <span class="st">&quot;Demo&quot;</span>, </span>
<span id="cb148-15"><a href="#cb148-15" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot;Dictadura&quot;</span> <span class="ot">=</span> <span class="st">&quot;Dict&quot;</span>))</span>
<span id="cb148-16"><a href="#cb148-16" aria-hidden="true" tabindex="-1"></a>datos </span>
<span id="cb148-17"><a href="#cb148-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-18"><a href="#cb148-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Notar que es vieja variable por nueva variable</span></span></code></pre></div>
<p><code>replace()</code>: Reemplazar valores</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span>  <span class="fu">mutate</span>(<span class="at">avance =</span> <span class="fu">ifelse</span>(demo <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> gdp <span class="sc">&gt;</span> <span class="fu">mean</span>(gdp),</span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>                                           <span class="dv">1</span>,<span class="dv">0</span>))</span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Similar sintaxis a la de recode</span></span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span> </span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a>         <span class="fu">mutate</span>(<span class="at">regimen =</span> <span class="fu">replace</span>(regimen, avance <span class="sc">==</span> <span class="dv">0</span>, <span class="st">&quot;No cambio en el pib&quot;</span>))</span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Sintaxis</span></span>
<span id="cb149-9"><a href="#cb149-9" aria-hidden="true" tabindex="-1"></a><span class="co"># mutate(columna a cambiar = replace(columna a cambiar, </span></span>
<span id="cb149-10"><a href="#cb149-10" aria-hidden="true" tabindex="-1"></a><span class="co">#                                      criterio para las filas, </span></span>
<span id="cb149-11"><a href="#cb149-11" aria-hidden="true" tabindex="-1"></a><span class="co">#                                      nuevo valor)).</span></span>
<span id="cb149-12"><a href="#cb149-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-13"><a href="#cb149-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Un equivalente a `replace()` es utilizar []. </span></span>
<span id="cb149-14"><a href="#cb149-14" aria-hidden="true" tabindex="-1"></a>datos<span class="sc">$</span>regimen[datos<span class="sc">$</span>avance <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="st">&quot;No cambio en el pib&quot;</span></span></code></pre></div>
<p><code>replace_na()</code>: Para cambiar los valores perdidos (NA) por un valor específico, como “Missing”, utilice la función <code>dplyr</code> <code>replace_na()</code> dentro de <code>mutate()</code>:</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>datos_ficticios <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">var1 =</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">10</span>), <span class="cn">NA</span>),</span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>                              <span class="at">var2 =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="cn">NA</span>,<span class="dv">11</span>)))</span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>datos_ficticios</span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a>datos_ficticios1 <span class="ot">&lt;-</span> datos_ficticios <span class="sc">%&gt;%</span> </span>
<span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">mutate</span>(<span class="at">var1 =</span> <span class="fu">replace_na</span>(var1, <span class="dv">0</span>))</span>
<span id="cb150-7"><a href="#cb150-7" aria-hidden="true" tabindex="-1"></a>datos_ficticios1</span></code></pre></div>
<div class="alert alert-block alert-danger">
<p><b>Recordatorio:</b> Esta función cambia los missing values solo por valores de la misma clase de la variable/columna, por lo tanto, si trabajamos con valores de clase numérica los reemplazos deben ser también numéricos.</p>
</div>
<p><code>case_when()</code>: una función de <code>dplyr</code>. Es útil para asignar múltiples valores. Sirve si se necesita recodificar muchos grupos:</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>datosedad <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">edad =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">500</span>,<span class="dv">2330</span>,<span class="dv">8</span>,<span class="dv">10</span>,<span class="dv">12</span>), </span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">unidad =</span> <span class="fu">c</span>(<span class="st">&quot;años&quot;</span>,<span class="st">&quot;años&quot;</span>, <span class="st">&quot;años&quot;</span>, <span class="cn">NA</span>, <span class="st">&quot;meses&quot;</span>, <span class="st">&quot;meses&quot;</span>, </span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&quot;años&quot;</span>, <span class="st">&quot;años&quot;</span>, <span class="st">&quot;semanas&quot;</span>))</span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a>datosedad</span>
<span id="cb151-7"><a href="#cb151-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-8"><a href="#cb151-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Imaginemos que queremos tener una medida comparable de edad, para ello</span></span>
<span id="cb151-9"><a href="#cb151-9" aria-hidden="true" tabindex="-1"></a><span class="co"># podemos utilizar `case_when()`. </span></span>
<span id="cb151-10"><a href="#cb151-10" aria-hidden="true" tabindex="-1"></a>datos_case_when <span class="ot">&lt;-</span>  datosedad <span class="sc">%&gt;%</span> </span>
<span id="cb151-11"><a href="#cb151-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(edad_años <span class="ot">=</span> <span class="fu">case_when</span>(</span>
<span id="cb151-12"><a href="#cb151-12" aria-hidden="true" tabindex="-1"></a>    unidad <span class="sc">==</span> <span class="st">&quot;años&quot;</span>  <span class="sc">~</span> edad, </span>
<span id="cb151-13"><a href="#cb151-13" aria-hidden="true" tabindex="-1"></a>    unidad <span class="sc">==</span> <span class="st">&quot;meses&quot;</span> <span class="sc">~</span> edad<span class="sc">/</span><span class="dv">12</span>, </span>
<span id="cb151-14"><a href="#cb151-14" aria-hidden="true" tabindex="-1"></a>    unidad <span class="sc">==</span> <span class="st">&quot;semanas&quot;</span> <span class="sc">~</span> edad<span class="sc">/</span><span class="dv">52</span>, </span>
<span id="cb151-15"><a href="#cb151-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.na</span>(unidad) <span class="sc">~</span> edad))</span>
<span id="cb151-16"><a href="#cb151-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-17"><a href="#cb151-17" aria-hidden="true" tabindex="-1"></a>datos_case_when</span></code></pre></div>
</div>
<div id="cambio-de-formato-de-los-datos" class="section level3 hasAnchor" number="2.5.4">
<h3 class="hasAnchor"><span class="header-section-number">2.5.4</span> Cambio de formato de los datos<a href="#cambio-de-formato-de-los-datos" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="de-ancho-a-largo" class="section level4 hasAnchor" number="2.5.4.1">
<h4 class="hasAnchor"><span class="header-section-number">2.5.4.1</span> De ancho a largo<a href="#de-ancho-a-largo" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>En en siguiente ejemplo, los datos están guardaos en “wide” para las columnas que tienen el número de casos de malaria por tramos de edad. Para un trabajo de análisis de datos es importante transformar los datos a “long”.</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>count_data <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="fu">here</span>(<span class="st">&quot;datos&quot;</span>,<span class="st">&quot;malaria_facility_count_data.rds&quot;</span>))</span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(count_data)</span></code></pre></div>
<p><code>pivot_longer()</code>: función del paquete <code>tidyr</code>. Paquete incluido en <code>tidyverse()</code>. Transforma los datos de wide a long.</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>df_long <span class="ot">&lt;-</span> count_data <span class="sc">%&gt;%</span> </span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(<span class="st">&quot;malaria_rdt_0-4&quot;</span>, </span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;malaria_rdt_5-14&quot;</span>, </span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;malaria_rdt_15&quot;</span>, </span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;malaria_tot&quot;</span>)</span>
<span id="cb153-7"><a href="#cb153-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb153-8"><a href="#cb153-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-9"><a href="#cb153-9" aria-hidden="true" tabindex="-1"></a>df_long </span>
<span id="cb153-10"><a href="#cb153-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-11"><a href="#cb153-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Una mejor opción es con la función starts_with(): </span></span>
<span id="cb153-12"><a href="#cb153-12" aria-hidden="true" tabindex="-1"></a>count_data <span class="sc">%&gt;%</span> </span>
<span id="cb153-13"><a href="#cb153-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb153-14"><a href="#cb153-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;malaria_&quot;</span>)</span>
<span id="cb153-15"><a href="#cb153-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb153-16"><a href="#cb153-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-17"><a href="#cb153-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Para agregar nombres a las nuevas variable creadas</span></span>
<span id="cb153-18"><a href="#cb153-18" aria-hidden="true" tabindex="-1"></a>df_long1 <span class="ot">&lt;-</span> count_data <span class="sc">%&gt;%</span> </span>
<span id="cb153-19"><a href="#cb153-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb153-20"><a href="#cb153-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;malaria_&quot;</span>),</span>
<span id="cb153-21"><a href="#cb153-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;grupo_edad&quot;</span>,</span>
<span id="cb153-22"><a href="#cb153-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;casos_malaria&quot;</span></span>
<span id="cb153-23"><a href="#cb153-23" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb153-24"><a href="#cb153-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-25"><a href="#cb153-25" aria-hidden="true" tabindex="-1"></a>df_long1</span></code></pre></div>
</div>
<div id="de-largo-a-ancho" class="section level4 hasAnchor" number="2.5.4.2">
<h4 class="hasAnchor"><span class="header-section-number">2.5.4.2</span> De largo a ancho<a href="#de-largo-a-ancho" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>pivot_wider()</code>: Transforma los datos de long a wide. Útil si quiero hacer una tabla mas amigable para el o la lectora.</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="fu">here</span>(<span class="st">&quot;datos&quot;</span>,<span class="st">&quot;linelist_cleaned.rds&quot;</span>))</span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a> df_wide <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span></span>
<span id="cb154-5"><a href="#cb154-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">count</span>(age_cat, gender)</span>
<span id="cb154-6"><a href="#cb154-6" aria-hidden="true" tabindex="-1"></a> df_wide</span>
<span id="cb154-7"><a href="#cb154-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-8"><a href="#cb154-8" aria-hidden="true" tabindex="-1"></a><span class="co"># En un mejor formato</span></span>
<span id="cb154-9"><a href="#cb154-9" aria-hidden="true" tabindex="-1"></a> table_wide <span class="ot">&lt;-</span> df_wide <span class="sc">%&gt;%</span></span>
<span id="cb154-10"><a href="#cb154-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb154-11"><a href="#cb154-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">id_cols =</span> age_cat,</span>
<span id="cb154-12"><a href="#cb154-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">names_from =</span> gender,</span>
<span id="cb154-13"><a href="#cb154-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">values_from =</span> n</span>
<span id="cb154-14"><a href="#cb154-14" aria-hidden="true" tabindex="-1"></a>   )</span>
<span id="cb154-15"><a href="#cb154-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-16"><a href="#cb154-16" aria-hidden="true" tabindex="-1"></a> table_wide</span></code></pre></div>
<p>Otra opción para hacer esto mismo es <code>gather()</code> y <code>spread()</code>:</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="fu">here</span>(<span class="st">&quot;datos&quot;</span>,<span class="st">&quot;Cuadro_1.xls&quot;</span>), <span class="at">skip =</span> <span class="dv">1</span>) </span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Cargamos datos que estan en formato ancho y los preparamos un poco...</span></span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> datos[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)]  </span>
<span id="cb155-6"><a href="#cb155-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(datos) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1960</span><span class="sc">:</span><span class="dv">2018</span>)</span>
<span id="cb155-7"><a href="#cb155-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(datos)</span>
<span id="cb155-8"><a href="#cb155-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-9"><a href="#cb155-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Como vemos, los años estan en las columnas, y queremos pasar a long data, </span></span>
<span id="cb155-10"><a href="#cb155-10" aria-hidden="true" tabindex="-1"></a><span class="co"># de forma tal que los años esten en una columna y el pib en otra </span></span>
<span id="cb155-11"><a href="#cb155-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. La funciom &quot;gather()&quot; transforma los datos de formato ancho (wide) a </span></span>
<span id="cb155-12"><a href="#cb155-12" aria-hidden="true" tabindex="-1"></a><span class="co"># formato largo (long)</span></span>
<span id="cb155-13"><a href="#cb155-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-14"><a href="#cb155-14" aria-hidden="true" tabindex="-1"></a><span class="co"># De ancho a largo: utilizando la función gather()</span></span>
<span id="cb155-15"><a href="#cb155-15" aria-hidden="true" tabindex="-1"></a><span class="co"># La primera es la variable &quot;clave&quot; y la segunda es la del valor</span></span>
<span id="cb155-16"><a href="#cb155-16" aria-hidden="true" tabindex="-1"></a>data_long <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span> </span>
<span id="cb155-17"><a href="#cb155-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(año, pib, <span class="dv">1</span><span class="sc">:</span><span class="dv">59</span>)</span>
<span id="cb155-18"><a href="#cb155-18" aria-hidden="true" tabindex="-1"></a>data_long</span>
<span id="cb155-19"><a href="#cb155-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-20"><a href="#cb155-20" aria-hidden="true" tabindex="-1"></a><span class="co"># De largo a ancho: utilizando la función spread()</span></span>
<span id="cb155-21"><a href="#cb155-21" aria-hidden="true" tabindex="-1"></a>data_wide <span class="ot">&lt;-</span> data_long <span class="sc">%&gt;%</span> </span>
<span id="cb155-22"><a href="#cb155-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(año,pib)</span>
<span id="cb155-23"><a href="#cb155-23" aria-hidden="true" tabindex="-1"></a>data_wide</span></code></pre></div>
</div>
</div>
<div id="juntar-bases-de-datos" class="section level3 hasAnchor" number="2.5.5">
<h3 class="hasAnchor"><span class="header-section-number">2.5.5</span> Juntar bases de datos<a href="#juntar-bases-de-datos" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="pegar-hacia-el-lado-por-columnas" class="section level4 hasAnchor" number="2.5.5.1">
<h4 class="hasAnchor"><span class="header-section-number">2.5.5.1</span> Pegar hacia el lado (por columnas)<a href="#pegar-hacia-el-lado-por-columnas" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>En el siguiente ejemplo, tenemos datos de hospitales.</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>hosp_info <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="fu">here</span>(<span class="st">&quot;datos&quot;</span>,<span class="st">&quot;hosp_info_final.xlsx&quot;</span>))</span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>linelist_mini <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="fu">here</span>(<span class="st">&quot;datos&quot;</span>,<span class="st">&quot;linelist_mini_final.xlsx&quot;</span>))</span></code></pre></div>
<p>Sintaxis: Imaginemos que tenemos dos bases de datos “df1”, “df2”. df1 tienen una columna llamada “ID”. df2 tiene una columna que se llama identificador.</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Caso 1: nombres de identificadores distintos.</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>data_junta <span class="ot">&lt;-</span> <span class="fu">join</span>(df1,</span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>                   df2,</span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;ID&quot;</span> <span class="ot">=</span> <span class="st">&quot;identificador&quot;</span>))</span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Caso 2: imaginemos ambas bases de datos (df1, df2) tienen un</span></span>
<span id="cb157-7"><a href="#cb157-7" aria-hidden="true" tabindex="-1"></a><span class="co">#         identificador llamado &quot;ID&quot;</span></span>
<span id="cb157-8"><a href="#cb157-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-9"><a href="#cb157-9" aria-hidden="true" tabindex="-1"></a>data_junta <span class="ot">&lt;-</span> <span class="fu">join</span>(df1,</span>
<span id="cb157-10"><a href="#cb157-10" aria-hidden="true" tabindex="-1"></a>                        df2,</span>
<span id="cb157-11"><a href="#cb157-11" aria-hidden="true" tabindex="-1"></a>                        <span class="at">by =</span> <span class="st">&quot;ID&quot;</span>)</span>
<span id="cb157-12"><a href="#cb157-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-13"><a href="#cb157-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Caso 3: imaginemos queremos pegar bases de datos considerando más</span></span>
<span id="cb157-14"><a href="#cb157-14" aria-hidden="true" tabindex="-1"></a><span class="co">#         de un identificador.</span></span>
<span id="cb157-15"><a href="#cb157-15" aria-hidden="true" tabindex="-1"></a>data_junta <span class="ot">&lt;-</span> <span class="fu">join</span>(df1, df2, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;nombre&quot;</span> <span class="ot">=</span> <span class="st">&quot;primernombre&quot;</span>,</span>
<span id="cb157-16"><a href="#cb157-16" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&quot;apellido&quot;</span> <span class="ot">=</span> <span class="st">&quot;primerapellido&quot;</span>,</span>
<span id="cb157-17"><a href="#cb157-17" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&quot;Edad&quot;</span> <span class="ot">=</span> <span class="st">&quot;edad&quot;</span>))</span></code></pre></div>
<p><strong>Left y Right join:</strong></p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Left join: la primera base de datos que aparece es la referencia.</span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Right join: la segunda base de datos que aparece es la referencia.</span></span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Left_join</span></span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a>left_join_ex1 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(linelist_mini,</span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a>                           hosp_info,</span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a>                           <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;hospital&quot;</span> <span class="ot">=</span> <span class="st">&quot;hosp_name&quot;</span>))</span>
<span id="cb158-8"><a href="#cb158-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-9"><a href="#cb158-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-10"><a href="#cb158-10" aria-hidden="true" tabindex="-1"></a>right_join_ex1 <span class="ot">&lt;-</span> <span class="fu">right_join</span>(hosp_info,</span>
<span id="cb158-11"><a href="#cb158-11" aria-hidden="true" tabindex="-1"></a>                             linelist_mini,</span>
<span id="cb158-12"><a href="#cb158-12" aria-hidden="true" tabindex="-1"></a>                             <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;hosp_name&quot;</span> <span class="ot">=</span> <span class="st">&quot;hospital&quot;</span>))</span>
<span id="cb158-13"><a href="#cb158-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-14"><a href="#cb158-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Ambos son equivalentes. </span></span>
<span id="cb158-15"><a href="#cb158-15" aria-hidden="true" tabindex="-1"></a>right_join_ex2 <span class="ot">&lt;-</span> <span class="fu">right_join</span>(linelist_mini,</span>
<span id="cb158-16"><a href="#cb158-16" aria-hidden="true" tabindex="-1"></a>                             hosp_info,</span>
<span id="cb158-17"><a href="#cb158-17" aria-hidden="true" tabindex="-1"></a>                             <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;hospital&quot;</span> <span class="ot">=</span> <span class="st">&quot;hosp_name&quot;</span>))</span>
<span id="cb158-18"><a href="#cb158-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-19"><a href="#cb158-19" aria-hidden="true" tabindex="-1"></a>left_join_ex2 <span class="ot">&lt;-</span> linelist_mini <span class="sc">%&gt;%</span></span>
<span id="cb158-20"><a href="#cb158-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(hosp_info,</span>
<span id="cb158-21"><a href="#cb158-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;hospital&quot;</span> <span class="ot">=</span> <span class="st">&quot;hosp_name&quot;</span>))</span>
<span id="cb158-22"><a href="#cb158-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-23"><a href="#cb158-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Notas:</span></span>
<span id="cb158-24"><a href="#cb158-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-25"><a href="#cb158-25" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Todas las filas/observaciones de la base de datos de referencia</span></span>
<span id="cb158-26"><a href="#cb158-26" aria-hidden="true" tabindex="-1"></a><span class="co">#    se mantienen.</span></span>
<span id="cb158-27"><a href="#cb158-27" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Si hay más de un match, se duplican las observaciones.</span></span>
<span id="cb158-28"><a href="#cb158-28" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Los identificadores se combinan. Según el nombre</span></span>
<span id="cb158-29"><a href="#cb158-29" aria-hidden="true" tabindex="-1"></a><span class="co">#     de la columna de la base de datos de referencia.</span></span>
<span id="cb158-30"><a href="#cb158-30" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Cuando no hay un &quot;match&quot; las columnas se llenan con un NA</span></span>
<span id="cb158-31"><a href="#cb158-31" aria-hidden="true" tabindex="-1"></a><span class="co">#     para las observaciones de la base de referencia.</span></span>
<span id="cb158-32"><a href="#cb158-32" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. No &quot;match&quot; por la base que no es de referencia se borran.</span></span></code></pre></div>
<p><strong>Full Join:</strong> El más inclusivo de los “joins”. Retorna todas las observaciones/filas:</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>full_join_ex3 <span class="ot">&lt;-</span> <span class="fu">full_join</span>(linelist_mini,</span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>                           hosp_info,</span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;hospital&quot;</span> <span class="ot">=</span> <span class="st">&quot;hosp_name&quot;</span>))</span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a>full_join_ex3 <span class="ot">&lt;-</span> linelist_mini <span class="sc">%&gt;%</span></span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(hosp_info,</span>
<span id="cb159-7"><a href="#cb159-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;hospital&quot;</span> <span class="ot">=</span> <span class="st">&quot;hosp_name&quot;</span>))</span></code></pre></div>
<p><strong>Inner join:</strong> El más restrictivo de los “join”. Retorna solo las filas que hicieron match entre ambas bases de datos.</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Su análogo en stata es:  merge 1:1, keep _merge==3</span></span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Los que se pegaron perfectamente entre ambas bases.</span></span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a>inner_join_example <span class="ot">&lt;-</span> linelist_mini <span class="sc">%&gt;%</span></span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(hosp_info,</span>
<span id="cb160-6"><a href="#cb160-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;hospital&quot;</span> <span class="ot">=</span> <span class="st">&quot;hosp_name&quot;</span>))</span></code></pre></div>
<p><strong>Semi - join:</strong> Mantiene todas las observaciones de la base de referencia que tengan un “match” en la base secundaria, pero NO agrega nuevas columnas ni duplicados en casos de multiples “match”.</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>semi_join_example1 <span class="ot">&lt;-</span> <span class="fu">semi_join</span>(hosp_info, linelist_mini, </span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a>                                <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;hosp_name&quot;</span> <span class="ot">=</span><span class="st">&quot;hospital&quot;</span>))</span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-5"><a href="#cb161-5" aria-hidden="true" tabindex="-1"></a>semi_join_example <span class="ot">&lt;-</span> hosp_info <span class="sc">%&gt;%</span></span>
<span id="cb161-6"><a href="#cb161-6" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">semi_join</span>(linelist_mini,</span>
<span id="cb161-7"><a href="#cb161-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;hosp_name&quot;</span> <span class="ot">=</span> <span class="st">&quot;hospital&quot;</span>))</span></code></pre></div>
<p><strong>Anti- join:</strong> Se le llama, al igual que semi-join “join de filtros”. Retorna las observaciones/filas en la base de datos de referencia que no hacen “match” en base de datos secundaria.</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>anti_join_example <span class="ot">&lt;-</span> hosp_info <span class="sc">%&gt;%</span></span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(linelist_mini,</span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;hosp_name&quot;</span> <span class="ot">=</span> <span class="st">&quot;hospital&quot;</span>))</span></code></pre></div>
<p>La función <code>merge</code>:</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>authors <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">surname =</span> (<span class="fu">c</span>(<span class="st">&quot;Tukey&quot;</span>, <span class="st">&quot;Venables&quot;</span>, <span class="st">&quot;Tierney&quot;</span>, <span class="st">&quot;Ripley&quot;</span>, <span class="st">&quot;McNeil&quot;</span>)),</span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">nationality =</span> <span class="fu">c</span>(<span class="st">&quot;US&quot;</span>, <span class="st">&quot;Australia&quot;</span>, <span class="st">&quot;US&quot;</span>, <span class="st">&quot;UK&quot;</span>, <span class="st">&quot;Australia&quot;</span>),</span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">deceased =</span> <span class="fu">c</span>(<span class="st">&quot;yes&quot;</span>, <span class="fu">rep</span>(<span class="st">&quot;no&quot;</span>, <span class="dv">4</span>)))</span>
<span id="cb163-7"><a href="#cb163-7" aria-hidden="true" tabindex="-1"></a>authors</span>
<span id="cb163-8"><a href="#cb163-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-9"><a href="#cb163-9" aria-hidden="true" tabindex="-1"></a>books <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb163-10"><a href="#cb163-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> (<span class="fu">c</span>(<span class="st">&quot;Tukey&quot;</span>, <span class="st">&quot;Venables&quot;</span>, <span class="st">&quot;Tierney&quot;</span>,</span>
<span id="cb163-11"><a href="#cb163-11" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;Ripley&quot;</span>, <span class="st">&quot;Ripley&quot;</span>, <span class="st">&quot;McNeil&quot;</span>, <span class="st">&quot;R Core&quot;</span>)),</span>
<span id="cb163-12"><a href="#cb163-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="fu">c</span>(<span class="st">&quot;Exploratory Data Analysis&quot;</span>,</span>
<span id="cb163-13"><a href="#cb163-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Modern Applied Statistics ...&quot;</span>,</span>
<span id="cb163-14"><a href="#cb163-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;LISP-STAT&quot;</span>,</span>
<span id="cb163-15"><a href="#cb163-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Spatial Statistics&quot;</span>, <span class="st">&quot;Stochastic Simulation&quot;</span>,</span>
<span id="cb163-16"><a href="#cb163-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Interactive Data Analysis&quot;</span>,</span>
<span id="cb163-17"><a href="#cb163-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;An Introduction to R&quot;</span>),</span>
<span id="cb163-18"><a href="#cb163-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">other.author =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="st">&quot;Ripley&quot;</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>,</span>
<span id="cb163-19"><a href="#cb163-19" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;Venables &amp; Smith&quot;</span>))</span>
<span id="cb163-20"><a href="#cb163-20" aria-hidden="true" tabindex="-1"></a>books</span>
<span id="cb163-21"><a href="#cb163-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-22"><a href="#cb163-22" aria-hidden="true" tabindex="-1"></a>m0 <span class="ot">&lt;-</span> <span class="fu">merge</span>(authors,</span>
<span id="cb163-23"><a href="#cb163-23" aria-hidden="true" tabindex="-1"></a>            books,</span>
<span id="cb163-24"><a href="#cb163-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">by.x =</span> <span class="st">&quot;surname&quot;</span>, <span class="at">by.y =</span> <span class="st">&quot;name&quot;</span>)</span>
<span id="cb163-25"><a href="#cb163-25" aria-hidden="true" tabindex="-1"></a>m0</span>
<span id="cb163-26"><a href="#cb163-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-27"><a href="#cb163-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Por defecto solo mantiene las que hicieron match.</span></span>
<span id="cb163-28"><a href="#cb163-28" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span>  <span class="fu">merge</span>(authors,</span>
<span id="cb163-29"><a href="#cb163-29" aria-hidden="true" tabindex="-1"></a>             books,</span>
<span id="cb163-30"><a href="#cb163-30" aria-hidden="true" tabindex="-1"></a>             <span class="at">by.x =</span> <span class="st">&quot;surname&quot;</span>, <span class="at">by.y =</span> <span class="st">&quot;name&quot;</span>, <span class="at">all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb163-31"><a href="#cb163-31" aria-hidden="true" tabindex="-1"></a>m1</span></code></pre></div>
</div>
<div id="pegar-hacia-abajo-por-filas" class="section level4 hasAnchor" number="2.5.5.2">
<h4 class="hasAnchor"><span class="header-section-number">2.5.5.2</span> Pegar hacia abajo (por filas)<a href="#pegar-hacia-abajo-por-filas" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Otra forma de unir bases de datos es agregar filas. Similar a lo que se hace con <code>append()</code> en Stata. Vamos a utilizar la función <code>bind_rows()</code> desde el paquete “dplyr”.</p>
<ol style="list-style-type: decimal">
<li><code>bind_rows()</code> es bastante inclusivo. Cualquier columna presente en las bases de datos se incluye en el output.</li>
<li>Si ambas columnas se llaman igual, se alinearan correctamente.</li>
<li>Adicionalmente, podemos agregar el argumento <code>.id=</code>. Este argumento genera una nueva columna que sirve para identificar de donde proviene la informacion.</li>
</ol>
<p><strong>Ejemplo 1:</strong> caso sencillo</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>continente_resumen <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span></span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(continent) <span class="sc">%&gt;%</span></span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">cases =</span> <span class="fu">n</span>(),</span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">gdpPercapmedian =</span> <span class="fu">median</span>(gdpPercap, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb164-6"><a href="#cb164-6" aria-hidden="true" tabindex="-1"></a>continente_resumen</span>
<span id="cb164-7"><a href="#cb164-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-8"><a href="#cb164-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear Tabla 2: sin agrupar</span></span>
<span id="cb164-9"><a href="#cb164-9" aria-hidden="true" tabindex="-1"></a>totales <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span></span>
<span id="cb164-10"><a href="#cb164-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb164-11"><a href="#cb164-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">cases =</span> <span class="fu">n</span>(),</span>
<span id="cb164-12"><a href="#cb164-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">gdpPercapmedian =</span>  <span class="fu">median</span>(gdpPercap, <span class="at">na.rm=</span>T)</span>
<span id="cb164-13"><a href="#cb164-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb164-14"><a href="#cb164-14" aria-hidden="true" tabindex="-1"></a>totales</span>
<span id="cb164-15"><a href="#cb164-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-16"><a href="#cb164-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Ahora las podemos pegar</span></span>
<span id="cb164-17"><a href="#cb164-17" aria-hidden="true" tabindex="-1"></a>combinadas <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(continente_resumen, totales)</span>
<span id="cb164-18"><a href="#cb164-18" aria-hidden="true" tabindex="-1"></a>combinadas</span>
<span id="cb164-19"><a href="#cb164-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-20"><a href="#cb164-20" aria-hidden="true" tabindex="-1"></a><span class="co"># ¿Como cambiar ese NA? </span></span>
<span id="cb164-21"><a href="#cb164-21" aria-hidden="true" tabindex="-1"></a>combinadas <span class="ot">&lt;-</span> combinadas <span class="sc">%&gt;%</span> </span>
<span id="cb164-22"><a href="#cb164-22" aria-hidden="true" tabindex="-1"></a>              <span class="fu">mutate</span>(<span class="at">continent =</span> <span class="fu">replace_na</span>(<span class="st">&quot;total&quot;</span>))</span>
<span id="cb164-23"><a href="#cb164-23" aria-hidden="true" tabindex="-1"></a>combinadas</span>
<span id="cb164-24"><a href="#cb164-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-25"><a href="#cb164-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Muy util colocar &quot;id&quot;</span></span>
<span id="cb164-26"><a href="#cb164-26" aria-hidden="true" tabindex="-1"></a>combinadas_id <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(continente_resumen, </span>
<span id="cb164-27"><a href="#cb164-27" aria-hidden="true" tabindex="-1"></a>                           totales, </span>
<span id="cb164-28"><a href="#cb164-28" aria-hidden="true" tabindex="-1"></a>                           <span class="at">.id =</span> <span class="st">&quot;id&quot;</span>)</span>
<span id="cb164-29"><a href="#cb164-29" aria-hidden="true" tabindex="-1"></a>combinadas_id</span></code></pre></div>
<p><strong>Ejemplo 2:</strong> ¿Qué ocurre si hay más de un archivo?</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Base de datos maestra</span></span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a>trial <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">year    =</span> <span class="fu">c</span>(<span class="dv">2016</span>, <span class="dv">2017</span>, <span class="dv">2018</span>, <span class="dv">2019</span>),</span>
<span id="cb165-4"><a href="#cb165-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">n       =</span> <span class="fu">c</span>(<span class="dv">501</span>, <span class="dv">499</span>, <span class="dv">498</span>, <span class="dv">502</span>),</span>
<span id="cb165-5"><a href="#cb165-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="fu">c</span>(<span class="dv">51</span>, <span class="dv">52</span>, <span class="dv">49</span>, <span class="dv">50</span>)</span>
<span id="cb165-6"><a href="#cb165-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb165-7"><a href="#cb165-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span>
<span id="cb165-8"><a href="#cb165-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-9"><a href="#cb165-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Base de datos 1</span></span>
<span id="cb165-10"><a href="#cb165-10" aria-hidden="true" tabindex="-1"></a>trial_2020 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb165-11"><a href="#cb165-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">year    =</span> <span class="dv">2020</span>,</span>
<span id="cb165-12"><a href="#cb165-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">n       =</span> <span class="dv">500</span>,</span>
<span id="cb165-13"><a href="#cb165-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="dv">48</span></span>
<span id="cb165-14"><a href="#cb165-14" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb165-15"><a href="#cb165-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span>
<span id="cb165-16"><a href="#cb165-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-17"><a href="#cb165-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Base de datos 2</span></span>
<span id="cb165-18"><a href="#cb165-18" aria-hidden="true" tabindex="-1"></a>trial_2021 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb165-19"><a href="#cb165-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">year      =</span> <span class="dv">2021</span>,</span>
<span id="cb165-20"><a href="#cb165-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">n         =</span> <span class="dv">598</span>,</span>
<span id="cb165-21"><a href="#cb165-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome   =</span> <span class="dv">57</span></span>
<span id="cb165-22"><a href="#cb165-22" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb165-23"><a href="#cb165-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span>
<span id="cb165-24"><a href="#cb165-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-25"><a href="#cb165-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Para combinar mas de una base de datos</span></span>
<span id="cb165-26"><a href="#cb165-26" aria-hidden="true" tabindex="-1"></a>trial1<span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(trial,trial_2020, trial_2021)</span></code></pre></div>
<p><strong>Ejemplo 3:</strong> ¿Qué ocurre si tengo muchos archivos?</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>())</span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pacman)</span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a><span class="fu">p_load</span>(plyr)    <span class="co"># Recomendable ocupar paquete plyr.</span></span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a>allfiles <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="st">&quot;datos&quot;</span>,</span>
<span id="cb166-6"><a href="#cb166-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">pattern =</span> <span class="st">&quot;.csv&quot;</span>,</span>
<span id="cb166-7"><a href="#cb166-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb166-8"><a href="#cb166-8" aria-hidden="true" tabindex="-1"></a>allfiles</span>
<span id="cb166-9"><a href="#cb166-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-10"><a href="#cb166-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Append data</span></span>
<span id="cb166-11"><a href="#cb166-11" aria-hidden="true" tabindex="-1"></a>combined_data<span class="ot">&lt;-</span> <span class="fu">ldply</span>(allfiles, read_csv)</span>
<span id="cb166-12"><a href="#cb166-12" aria-hidden="true" tabindex="-1"></a>combined_data</span>
<span id="cb166-13"><a href="#cb166-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-14"><a href="#cb166-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformar a un data.frame.</span></span>
<span id="cb166-15"><a href="#cb166-15" aria-hidden="true" tabindex="-1"></a>combined_data_sep <span class="ot">&lt;-</span> <span class="fu">separate</span>(<span class="at">data =</span> combined_data,</span>
<span id="cb166-16"><a href="#cb166-16" aria-hidden="true" tabindex="-1"></a>                              <span class="at">col =</span> <span class="st">&quot;year;n;outcome&quot;</span>,</span>
<span id="cb166-17"><a href="#cb166-17" aria-hidden="true" tabindex="-1"></a>                              <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;n&quot;</span>, <span class="st">&quot;outcome&quot;</span>),</span>
<span id="cb166-18"><a href="#cb166-18" aria-hidden="true" tabindex="-1"></a>                              <span class="at">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb166-19"><a href="#cb166-19" aria-hidden="true" tabindex="-1"></a>combined_data_sep</span></code></pre></div>
</div>
</div>
</div>
<div id="análisis-de-datos" class="section level2 hasAnchor" number="2.6">
<h2 class="hasAnchor"><span class="header-section-number">2.6</span> Análisis de datos<a href="#análisis-de-datos" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="inspección-de-datos" class="section level3 hasAnchor" number="2.6.1">
<h3 class="hasAnchor"><span class="header-section-number">2.6.1</span> Inspección de datos<a href="#inspección-de-datos" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Preámbulo:</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Limpiamos consola</span></span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Cargamos paquetes que vamos a utilizar</span></span>
<span id="cb167-5"><a href="#cb167-5" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb167-6"><a href="#cb167-6" aria-hidden="true" tabindex="-1"></a>  rio,        <span class="co"># importar/exportar datos. </span></span>
<span id="cb167-7"><a href="#cb167-7" aria-hidden="true" tabindex="-1"></a>  here,       <span class="co"># escribir rutas de las carpetas.  </span></span>
<span id="cb167-8"><a href="#cb167-8" aria-hidden="true" tabindex="-1"></a>  janitor,    <span class="co"># limpiar datos y tablas.</span></span>
<span id="cb167-9"><a href="#cb167-9" aria-hidden="true" tabindex="-1"></a>  tidyverse,  <span class="co"># Manejo de bases de datos y visualización. </span></span>
<span id="cb167-10"><a href="#cb167-10" aria-hidden="true" tabindex="-1"></a>  magrittr,    <span class="co"># Permite utilizar operador %&gt;% (piping). </span></span>
<span id="cb167-11"><a href="#cb167-11" aria-hidden="true" tabindex="-1"></a>  skimr,       <span class="co"># Inspeccionar datos</span></span>
<span id="cb167-12"><a href="#cb167-12" aria-hidden="true" tabindex="-1"></a>  inspectdf,   <span class="co"># Inspeccionar datos</span></span>
<span id="cb167-13"><a href="#cb167-13" aria-hidden="true" tabindex="-1"></a>  gapminder    <span class="co"># Base de datos con información de países. </span></span>
<span id="cb167-14"><a href="#cb167-14" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Ahora vamos a crear tablas de estadística descriptiva que nos interesen para el análisis de datos.</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Importamos datos</span></span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="fu">here</span>(<span class="st">&quot;datos&quot;</span>,<span class="st">&quot;linelist_cleaned.rds&quot;</span>))</span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Inspeccionamos los datos</span></span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a><span class="co"># a.  Visión general de la base de datos</span></span>
<span id="cb168-7"><a href="#cb168-7" aria-hidden="true" tabindex="-1"></a><span class="fu">skim</span>(datos)</span>
<span id="cb168-8"><a href="#cb168-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-9"><a href="#cb168-9" aria-hidden="true" tabindex="-1"></a><span class="co"># b. Información sobre cada columna</span></span>
<span id="cb168-10"><a href="#cb168-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(datos)</span>
<span id="cb168-11"><a href="#cb168-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-12"><a href="#cb168-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-13"><a href="#cb168-13" aria-hidden="true" tabindex="-1"></a><span class="co"># c. Información sobre cada variable categórica. </span></span>
<span id="cb168-14"><a href="#cb168-14" aria-hidden="true" tabindex="-1"></a>insp <span class="ot">&lt;-</span> <span class="fu">inspect_cat</span>(datos)</span>
<span id="cb168-15"><a href="#cb168-15" aria-hidden="true" tabindex="-1"></a>insp</span>
<span id="cb168-16"><a href="#cb168-16" aria-hidden="true" tabindex="-1"></a>insp_figura <span class="ot">&lt;-</span> insp <span class="sc">%&gt;%</span> <span class="fu">show_plot</span>()</span>
<span id="cb168-17"><a href="#cb168-17" aria-hidden="true" tabindex="-1"></a>insp_figura</span>
<span id="cb168-18"><a href="#cb168-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-19"><a href="#cb168-19" aria-hidden="true" tabindex="-1"></a><span class="co"># d. Miramos nombre de las variables</span></span>
<span id="cb168-20"><a href="#cb168-20" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(datos)</span>
<span id="cb168-21"><a href="#cb168-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-22"><a href="#cb168-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Nota 1: Tenemos 29 variables y el id es igual a case_id. </span></span></code></pre></div>
<p>Transformamos variables de interés:</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="co"># a. Miramos la clase de cada variable </span></span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unlist</span>(<span class="fu">lapply</span>(datos,class))</span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Nota 2: gender esta como texto, podría estar como factor. Lo mismo ocurre con outcome. </span></span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-6"><a href="#cb169-6" aria-hidden="true" tabindex="-1"></a><span class="co"># b. Transformamos gender/outcome en factores </span></span>
<span id="cb169-7"><a href="#cb169-7" aria-hidden="true" tabindex="-1"></a>datos<span class="sc">$</span>gender <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(datos<span class="sc">$</span>gender)</span>
<span id="cb169-8"><a href="#cb169-8" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(datos<span class="sc">$</span>gender)</span>
<span id="cb169-9"><a href="#cb169-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-10"><a href="#cb169-10" aria-hidden="true" tabindex="-1"></a>datos<span class="sc">$</span>outcome<span class="ot">&lt;-</span> <span class="fu">as.factor</span>(datos<span class="sc">$</span>outcome)</span>
<span id="cb169-11"><a href="#cb169-11" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(datos<span class="sc">$</span>outcome)</span>
<span id="cb169-12"><a href="#cb169-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-13"><a href="#cb169-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Miramos como esta codificado ahora </span></span>
<span id="cb169-14"><a href="#cb169-14" aria-hidden="true" tabindex="-1"></a><span class="fu">unlist</span>(<span class="fu">lapply</span>(datos,class))[<span class="st">&quot;gender&quot;</span>]</span>
<span id="cb169-15"><a href="#cb169-15" aria-hidden="true" tabindex="-1"></a><span class="fu">skim</span>(datos)</span>
<span id="cb169-16"><a href="#cb169-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-17"><a href="#cb169-17" aria-hidden="true" tabindex="-1"></a><span class="co"># c. Seleccionamos solo variables que nos interesa ocupar: reducir el problema!</span></span>
<span id="cb169-18"><a href="#cb169-18" aria-hidden="true" tabindex="-1"></a>datos_trabajo <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span> <span class="fu">select</span>(case_id, outcome, gender, age, </span>
<span id="cb169-19"><a href="#cb169-19" aria-hidden="true" tabindex="-1"></a>                                  age_years, age_cat, hospital, wt_kg<span class="sc">:</span>temp, </span>
<span id="cb169-20"><a href="#cb169-20" aria-hidden="true" tabindex="-1"></a>                                  days_onset_hosp)</span>
<span id="cb169-21"><a href="#cb169-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-22"><a href="#cb169-22" aria-hidden="true" tabindex="-1"></a><span class="co"># d. Vemos que hay variables que están codificadas como &quot;yes&quot; y &quot;no&quot;. </span></span>
<span id="cb169-23"><a href="#cb169-23" aria-hidden="true" tabindex="-1"></a><span class="co">#    Vamos a crearlas como variables binarias. </span></span>
<span id="cb169-24"><a href="#cb169-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-25"><a href="#cb169-25" aria-hidden="true" tabindex="-1"></a>datos_trabajo <span class="ot">&lt;-</span>  datos_trabajo <span class="sc">%&gt;%</span>  </span>
<span id="cb169-26"><a href="#cb169-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">chills =</span>  <span class="fu">ifelse</span>(chills <span class="sc">==</span> <span class="st">&quot;yes&quot;</span>,<span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb169-27"><a href="#cb169-27" aria-hidden="true" tabindex="-1"></a>         <span class="at">cough  =</span>  <span class="fu">ifelse</span>(cough <span class="sc">==</span> <span class="st">&quot;yes&quot;</span>,<span class="dv">1</span>,<span class="dv">0</span>), </span>
<span id="cb169-28"><a href="#cb169-28" aria-hidden="true" tabindex="-1"></a>         <span class="at">aches  =</span>  <span class="fu">ifelse</span>(aches <span class="sc">==</span> <span class="st">&quot;yes&quot;</span>,<span class="dv">1</span>,<span class="dv">0</span>), </span>
<span id="cb169-29"><a href="#cb169-29" aria-hidden="true" tabindex="-1"></a>         <span class="at">vomit  =</span>  <span class="fu">ifelse</span>(vomit <span class="sc">==</span> <span class="st">&quot;yes&quot;</span>,<span class="dv">1</span>,<span class="dv">0</span>))</span>
<span id="cb169-30"><a href="#cb169-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-31"><a href="#cb169-31" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(datos_trabajo)</span>
<span id="cb169-32"><a href="#cb169-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-33"><a href="#cb169-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Limpiamos para quedarnos solo con los datos que nos interesan. </span></span>
<span id="cb169-34"><a href="#cb169-34" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(insp, insp_figura)</span>
<span id="cb169-35"><a href="#cb169-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-36"><a href="#cb169-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspeccionamos nuevamente</span></span>
<span id="cb169-37"><a href="#cb169-37" aria-hidden="true" tabindex="-1"></a><span class="fu">skim</span>(datos_trabajo)</span>
<span id="cb169-38"><a href="#cb169-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-39"><a href="#cb169-39" aria-hidden="true" tabindex="-1"></a><span class="co"># e. Ahora vamos a dejar una base de datos unicamente con valores completos</span></span>
<span id="cb169-40"><a href="#cb169-40" aria-hidden="true" tabindex="-1"></a>completos <span class="ot">&lt;-</span> <span class="fu">complete.cases</span>(datos_trabajo)</span>
<span id="cb169-41"><a href="#cb169-41" aria-hidden="true" tabindex="-1"></a>completos </span>
<span id="cb169-42"><a href="#cb169-42" aria-hidden="true" tabindex="-1"></a>datos_trabajo <span class="ot">&lt;-</span> datos_trabajo[completos,]</span>
<span id="cb169-43"><a href="#cb169-43" aria-hidden="true" tabindex="-1"></a><span class="fu">skim</span>(datos_trabajo)            </span>
<span id="cb169-44"><a href="#cb169-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-45"><a href="#cb169-45" aria-hidden="true" tabindex="-1"></a><span class="co"># f. Finalmente, vamos a renombrar la base de datos con la que vamos a trabajar.  </span></span>
<span id="cb169-46"><a href="#cb169-46" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(datos, completos)</span>
<span id="cb169-47"><a href="#cb169-47" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> datos_trabajo</span>
<span id="cb169-48"><a href="#cb169-48" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(datos_trabajo)</span></code></pre></div>
</div>
<div id="estadística-descriptiva" class="section level3 hasAnchor" number="2.6.2">
<h3 class="hasAnchor"><span class="header-section-number">2.6.2</span> Estadística descriptiva<a href="#estadística-descriptiva" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Describiendo los datos:</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(rstatix)</span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Opcion 1: utilizar get_summary_stats() del paquete &quot;rstatix&quot;. </span></span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a><span class="co"># El resultado se guarda en un dataframe. </span></span>
<span id="cb170-5"><a href="#cb170-5" aria-hidden="true" tabindex="-1"></a>tabla1 <span class="ot">&lt;-</span> datos  <span class="sc">%&gt;%</span> </span>
<span id="cb170-6"><a href="#cb170-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_summary_stats</span>(</span>
<span id="cb170-7"><a href="#cb170-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">everything</span>(),  </span>
<span id="cb170-8"><a href="#cb170-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">&quot;full&quot;</span>)                    </span>
<span id="cb170-9"><a href="#cb170-9" aria-hidden="true" tabindex="-1"></a>tabla1 </span>
<span id="cb170-10"><a href="#cb170-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-11"><a href="#cb170-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Puedo exportar esta tabla en excel utilizando `rio` y `here`.</span></span>
<span id="cb170-12"><a href="#cb170-12" aria-hidden="true" tabindex="-1"></a><span class="fu">export</span>(tabla1, <span class="fu">here</span>(<span class="st">&quot;resultados&quot;</span>, </span>
<span id="cb170-13"><a href="#cb170-13" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;ejercicio1&quot;</span>, </span>
<span id="cb170-14"><a href="#cb170-14" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;tabla1.xlsx&quot;</span>))</span></code></pre></div>
</div>
<div id="tablas-de-frecuencia" class="section level3 hasAnchor" number="2.6.3">
<h3 class="hasAnchor"><span class="header-section-number">2.6.3</span> Tablas de frecuencia<a href="#tablas-de-frecuencia" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>El paquete “janitor” ofrece la función <code>tabyl()</code> para producir tabulaciones simples y tabulaciones cruzadas, que pueden ser “adornadas” o modificadas con funciones de ayuda para mostrar porcentajes, proporciones, recuentos, etc.</p>
<p>El uso por defecto de <code>tabyl()</code> en una columna específica produce los valores únicos, los recuentos y los “porcentajes” de la columna (en realidad proporciones). Las proporciones pueden tener muchos dígitos. Puede ajustar el número de décimales con la función <code>adorn_rounding()</code> como se describe a continuación.</p>
<div id="tablas-de-frecuencias-con-una-entrada" class="section level4 hasAnchor" number="2.6.3.1">
<h4 class="hasAnchor"><span class="header-section-number">2.6.3.1</span> Tablas de frecuencias con una entrada<a href="#tablas-de-frecuencias-con-una-entrada" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Frecuencia para age_cat </span></span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a>tabla2a <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span> <span class="fu">tabyl</span>(outcome)</span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a>tabla2a </span>
<span id="cb171-4"><a href="#cb171-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-5"><a href="#cb171-5" aria-hidden="true" tabindex="-1"></a>tabla2b <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span> <span class="fu">tabyl</span>(gender)</span>
<span id="cb171-6"><a href="#cb171-6" aria-hidden="true" tabindex="-1"></a>tabla2b </span>
<span id="cb171-7"><a href="#cb171-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-8"><a href="#cb171-8" aria-hidden="true" tabindex="-1"></a>tabla2c <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span> <span class="fu">tabyl</span>(age_cat)</span>
<span id="cb171-9"><a href="#cb171-9" aria-hidden="true" tabindex="-1"></a>tabla2c </span>
<span id="cb171-10"><a href="#cb171-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-11"><a href="#cb171-11" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(tabla2a, tabla2b, tabla2c)</span>
<span id="cb171-12"><a href="#cb171-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-13"><a href="#cb171-13" aria-hidden="true" tabindex="-1"></a><span class="co"># ¿Qué pasa si queremos hacer una tabla de frecuencias para </span></span>
<span id="cb171-14"><a href="#cb171-14" aria-hidden="true" tabindex="-1"></a><span class="co"># todas las variables que son factores? -&gt; iteradores! </span></span>
<span id="cb171-15"><a href="#cb171-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-16"><a href="#cb171-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Nombre de todas las variables de la base de datos</span></span>
<span id="cb171-17"><a href="#cb171-17" aria-hidden="true" tabindex="-1"></a>nombres <span class="ot">&lt;-</span> <span class="fu">names</span>(datos)</span>
<span id="cb171-18"><a href="#cb171-18" aria-hidden="true" tabindex="-1"></a>nombres </span>
<span id="cb171-19"><a href="#cb171-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-20"><a href="#cb171-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Selecciono solo a las que son categóricas (factores)</span></span>
<span id="cb171-21"><a href="#cb171-21" aria-hidden="true" tabindex="-1"></a>select <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(datos, is.factor))</span>
<span id="cb171-22"><a href="#cb171-22" aria-hidden="true" tabindex="-1"></a>select </span>
<span id="cb171-23"><a href="#cb171-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-24"><a href="#cb171-24" aria-hidden="true" tabindex="-1"></a>nombres <span class="ot">&lt;-</span> nombres[select <span class="sc">==</span> <span class="cn">TRUE</span>]</span>
<span id="cb171-25"><a href="#cb171-25" aria-hidden="true" tabindex="-1"></a>nombres </span></code></pre></div>
<p>Ahora voy a generar tantas tablas como variables categóricas para ello vamos a hacer uso de iteraciones. Creo una lista vacía, donde voy a guardar las tablas (data frames) que se generen.</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a>tabla2 <span class="ot">&lt;-</span>  <span class="fu">list</span>()</span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a>tabla2a <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span> <span class="fu">tabyl</span>(outcome)</span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a>tabla2a </span>
<span id="cb172-5"><a href="#cb172-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-6"><a href="#cb172-6" aria-hidden="true" tabindex="-1"></a>tabla2b <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span> <span class="fu">tabyl</span>(gender)</span>
<span id="cb172-7"><a href="#cb172-7" aria-hidden="true" tabindex="-1"></a>tabla2b </span>
<span id="cb172-8"><a href="#cb172-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-9"><a href="#cb172-9" aria-hidden="true" tabindex="-1"></a>tabla2c <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span> <span class="fu">tabyl</span>(age_cat)</span>
<span id="cb172-10"><a href="#cb172-10" aria-hidden="true" tabindex="-1"></a>tabla2c </span>
<span id="cb172-11"><a href="#cb172-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-12"><a href="#cb172-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(nombres)){</span>
<span id="cb172-13"><a href="#cb172-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb172-14"><a href="#cb172-14" aria-hidden="true" tabindex="-1"></a>  tabla2[[i]] <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span> <span class="fu">tabyl</span>(nombres[i])</span>
<span id="cb172-15"><a href="#cb172-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Ahora tengo una lista de tablas. Cada tabla habla de un variable categórica. Si vemos son equivalente a generarlas de otra forma. Si tengo pocas variables categóricas, esta forma puede no ser relevante, sin embargo, si tengo muchas, puede ser una buena forma de generar estadística descriptiva.</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Comparamos </span></span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a>datos <span class="sc">%&gt;%</span> <span class="fu">tabyl</span>(outcome,<span class="at">show_na =</span> <span class="cn">FALSE</span>)</span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a>tabla2[[<span class="dv">1</span>]]</span>
<span id="cb173-4"><a href="#cb173-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-5"><a href="#cb173-5" aria-hidden="true" tabindex="-1"></a>datos <span class="sc">%&gt;%</span> <span class="fu">tabyl</span>(gender,<span class="at">show_na =</span> <span class="cn">FALSE</span>)</span>
<span id="cb173-6"><a href="#cb173-6" aria-hidden="true" tabindex="-1"></a>tabla2[[<span class="dv">2</span>]]</span>
<span id="cb173-7"><a href="#cb173-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-8"><a href="#cb173-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Exportamos utilizando `rio` y `here` de nuevo </span></span>
<span id="cb173-9"><a href="#cb173-9" aria-hidden="true" tabindex="-1"></a><span class="fu">export</span>(tabla2[[<span class="dv">1</span>]],<span class="fu">here</span>(<span class="st">&quot;resultados&quot;</span>, <span class="st">&quot;ejercicio1&quot;</span>, <span class="st">&quot;tabla2-1-freq-outcomes.xlsx&quot;</span>))</span>
<span id="cb173-10"><a href="#cb173-10" aria-hidden="true" tabindex="-1"></a><span class="fu">export</span>(tabla2[[<span class="dv">2</span>]],<span class="fu">here</span>(<span class="st">&quot;resultados&quot;</span>, <span class="st">&quot;ejercicio1&quot;</span>, <span class="st">&quot;tabla2-2-freq-gender.xlsx&quot;</span>))</span>
<span id="cb173-11"><a href="#cb173-11" aria-hidden="true" tabindex="-1"></a><span class="fu">export</span>(tabla2[[<span class="dv">3</span>]],<span class="fu">here</span>(<span class="st">&quot;resultados&quot;</span>, <span class="st">&quot;ejercicio1&quot;</span>, <span class="st">&quot;tabla2-3-freq-age_cat.xlsx&quot;</span>))</span></code></pre></div>
</div>
<div id="tablas-de-frecuencias-con-más-de-una-entrada" class="section level4 hasAnchor" number="2.6.3.2">
<h4 class="hasAnchor"><span class="header-section-number">2.6.3.2</span> Tablas de frecuencias con más de una entrada<a href="#tablas-de-frecuencias-con-más-de-una-entrada" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Imaginen que estamos interesados o interesadas en saber cuantas observaciones por categoría de edad por genero. Para ello nos gustaría hacer una tabla de doble entrada. Podemos ocupar <code>tabyl()</code> para hacer eso fácilmente:</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>tabla3 <span class="ot">&lt;-</span> datos  <span class="sc">%&gt;%</span> <span class="fu">tabyl</span>(age_cat, gender, <span class="at">show_na =</span> <span class="cn">FALSE</span>)</span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a>tabla3 </span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(tabla3)</span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Hacemos una lista </span></span>
<span id="cb174-6"><a href="#cb174-6" aria-hidden="true" tabindex="-1"></a>tabla3 <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb174-7"><a href="#cb174-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-8"><a href="#cb174-8" aria-hidden="true" tabindex="-1"></a>tabla3[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span> <span class="fu">tabyl</span>(outcome, gender)</span>
<span id="cb174-9"><a href="#cb174-9" aria-hidden="true" tabindex="-1"></a>tabla3[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span> <span class="fu">tabyl</span>(outcome, age_cat)</span>
<span id="cb174-10"><a href="#cb174-10" aria-hidden="true" tabindex="-1"></a>tabla3[[<span class="dv">3</span>]] <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span> <span class="fu">tabyl</span>(age_cat, gender)</span>
<span id="cb174-11"><a href="#cb174-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-12"><a href="#cb174-12" aria-hidden="true" tabindex="-1"></a>tabla3[[<span class="dv">1</span>]]</span>
<span id="cb174-13"><a href="#cb174-13" aria-hidden="true" tabindex="-1"></a>tabla3[[<span class="dv">2</span>]]</span>
<span id="cb174-14"><a href="#cb174-14" aria-hidden="true" tabindex="-1"></a>tabla3[[<span class="dv">3</span>]]</span>
<span id="cb174-15"><a href="#cb174-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-16"><a href="#cb174-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Exportamos pero a diferentes hojas</span></span>
<span id="cb174-17"><a href="#cb174-17" aria-hidden="true" tabindex="-1"></a><span class="fu">export</span>(<span class="fu">list</span>(<span class="st">&quot;tabla 3.1&quot;</span> <span class="ot">=</span> tabla3[[<span class="dv">1</span>]],<span class="st">&quot;tabla 3.2&quot;</span> <span class="ot">=</span> tabla3[[<span class="dv">2</span>]],</span>
<span id="cb174-18"><a href="#cb174-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;tabla 3.3&quot;</span> <span class="ot">=</span> tabla3[[<span class="dv">3</span>]]),   <span class="co">#Podemos asignarles nombres</span></span>
<span id="cb174-19"><a href="#cb174-19" aria-hidden="true" tabindex="-1"></a>       <span class="fu">here</span>(<span class="st">&quot;resultados&quot;</span>, <span class="st">&quot;ejercicio1&quot;</span>, <span class="st">&quot;tabla3_cruzadas.xlsx&quot;</span>))</span></code></pre></div>
</div>
<div id="tablas-mejoradas-con-opciones" class="section level4 hasAnchor" number="2.6.3.3">
<h4 class="hasAnchor"><span class="header-section-number">2.6.3.3</span> Tablas mejoradas con opciones<a href="#tablas-mejoradas-con-opciones" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tabular los recuentos y las proporciones por categoría de edad</span></span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Con porcentajes para una de una entrada</span></span>
<span id="cb175-4"><a href="#cb175-4" aria-hidden="true" tabindex="-1"></a>tabla4 <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span>               </span>
<span id="cb175-5"><a href="#cb175-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(age_cat) <span class="sc">%&gt;%</span>       </span>
<span id="cb175-6"><a href="#cb175-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_pct_formatting</span>()   <span class="co"># convertir proporciones en porcentajes</span></span>
<span id="cb175-7"><a href="#cb175-7" aria-hidden="true" tabindex="-1"></a>tabla4</span>
<span id="cb175-8"><a href="#cb175-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-9"><a href="#cb175-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Con porcentajes por fila</span></span>
<span id="cb175-10"><a href="#cb175-10" aria-hidden="true" tabindex="-1"></a>tabla5 <span class="ot">&lt;-</span> datos  <span class="sc">%&gt;%</span>                                  </span>
<span id="cb175-11"><a href="#cb175-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(age_cat, gender) <span class="sc">%&gt;%</span>                  <span class="co"># contar para edad y género</span></span>
<span id="cb175-12"><a href="#cb175-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_totals</span>(<span class="at">where =</span> <span class="st">&quot;row&quot;</span>) <span class="sc">%&gt;%</span>             <span class="co"># agregar totales</span></span>
<span id="cb175-13"><a href="#cb175-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_percentages</span>(<span class="at">denominator =</span> <span class="st">&quot;row&quot;</span>) <span class="sc">%&gt;%</span>  <span class="co"># cambiar a porcentaje</span></span>
<span id="cb175-14"><a href="#cb175-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_pct_formatting</span>(<span class="at">digits =</span> <span class="dv">2</span>)            <span class="co"># numero de digitos</span></span>
<span id="cb175-15"><a href="#cb175-15" aria-hidden="true" tabindex="-1"></a>tabla5 </span>
<span id="cb175-16"><a href="#cb175-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-17"><a href="#cb175-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Nota: ¿Qué ocurre si cambio col/row en adorn_percentages? </span></span>
<span id="cb175-18"><a href="#cb175-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-19"><a href="#cb175-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Con porcentajes  por columna </span></span>
<span id="cb175-20"><a href="#cb175-20" aria-hidden="true" tabindex="-1"></a>tabla6 <span class="ot">&lt;-</span> datos  <span class="sc">%&gt;%</span>                                  </span>
<span id="cb175-21"><a href="#cb175-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(age_cat, gender) <span class="sc">%&gt;%</span>                  <span class="co"># contar para edad y genero</span></span>
<span id="cb175-22"><a href="#cb175-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_totals</span>(<span class="at">where =</span> <span class="st">&quot;row&quot;</span>) <span class="sc">%&gt;%</span>             <span class="co"># agregar totales</span></span>
<span id="cb175-23"><a href="#cb175-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_percentages</span>(<span class="at">denominator =</span> <span class="st">&quot;col&quot;</span>) <span class="sc">%&gt;%</span>  <span class="co"># cambiar a porcentaje</span></span>
<span id="cb175-24"><a href="#cb175-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_pct_formatting</span>(<span class="at">digits =</span> <span class="dv">2</span>)            <span class="co"># nùmero de digitos</span></span>
<span id="cb175-25"><a href="#cb175-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-26"><a href="#cb175-26" aria-hidden="true" tabindex="-1"></a>tabla6 </span>
<span id="cb175-27"><a href="#cb175-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-28"><a href="#cb175-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-29"><a href="#cb175-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Con total  por columna y fila </span></span>
<span id="cb175-30"><a href="#cb175-30" aria-hidden="true" tabindex="-1"></a>tabla7 <span class="ot">&lt;-</span> datos  <span class="sc">%&gt;%</span>                                  </span>
<span id="cb175-31"><a href="#cb175-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(age_cat, gender) <span class="sc">%&gt;%</span>                  <span class="co"># contar para edad y genero</span></span>
<span id="cb175-32"><a href="#cb175-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_totals</span>(<span class="at">where =</span> <span class="fu">list</span>(<span class="st">&quot;row&quot;</span>,<span class="st">&quot;col&quot;</span>)) <span class="sc">%&gt;%</span>             <span class="co"># agregar totales</span></span>
<span id="cb175-33"><a href="#cb175-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_percentages</span>(<span class="at">denominator =</span> <span class="st">&quot;col&quot;</span>) <span class="sc">%&gt;%</span>  <span class="co"># cambiar a porcentaje</span></span>
<span id="cb175-34"><a href="#cb175-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_pct_formatting</span>(<span class="at">digits =</span> <span class="dv">2</span>)            <span class="co"># nùmero de digitos</span></span>
<span id="cb175-35"><a href="#cb175-35" aria-hidden="true" tabindex="-1"></a>tabla7 </span>
<span id="cb175-36"><a href="#cb175-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-37"><a href="#cb175-37" aria-hidden="true" tabindex="-1"></a><span class="co"># ¿Como se diferencian estas tablas? </span></span>
<span id="cb175-38"><a href="#cb175-38" aria-hidden="true" tabindex="-1"></a>tabla4</span>
<span id="cb175-39"><a href="#cb175-39" aria-hidden="true" tabindex="-1"></a>tabla5 <span class="co"># por fila</span></span>
<span id="cb175-40"><a href="#cb175-40" aria-hidden="true" tabindex="-1"></a>tabla6 <span class="co"># por la columna</span></span>
<span id="cb175-41"><a href="#cb175-41" aria-hidden="true" tabindex="-1"></a>tabla7 <span class="co"># agrega dos totales</span></span>
<span id="cb175-42"><a href="#cb175-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-43"><a href="#cb175-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Agregamos titulos </span></span>
<span id="cb175-44"><a href="#cb175-44" aria-hidden="true" tabindex="-1"></a>tabla8 <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span>                                 </span>
<span id="cb175-45"><a href="#cb175-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(age_cat, gender) <span class="sc">%&gt;%</span>                  </span>
<span id="cb175-46"><a href="#cb175-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_totals</span>(<span class="at">where =</span> <span class="st">&quot;row&quot;</span>) <span class="sc">%&gt;%</span>            </span>
<span id="cb175-47"><a href="#cb175-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_percentages</span>(<span class="at">denominator =</span> <span class="st">&quot;row&quot;</span>) <span class="sc">%&gt;%</span>  <span class="co"># </span></span>
<span id="cb175-48"><a href="#cb175-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_pct_formatting</span>(<span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span>        </span>
<span id="cb175-49"><a href="#cb175-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_ns</span>(<span class="at">position =</span> <span class="st">&quot;rear&quot;</span>) <span class="sc">%&gt;%</span>  <span class="co"># front para colocar parentesis en %        </span></span>
<span id="cb175-50"><a href="#cb175-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_title</span>(                     <span class="co"># Agregar titulos            </span></span>
<span id="cb175-51"><a href="#cb175-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">row_name =</span> <span class="st">&quot;Cat. edad&quot;</span>,</span>
<span id="cb175-52"><a href="#cb175-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_name =</span> <span class="st">&quot;Genero&quot;</span>)</span>
<span id="cb175-53"><a href="#cb175-53" aria-hidden="true" tabindex="-1"></a>tabla8</span>
<span id="cb175-54"><a href="#cb175-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-55"><a href="#cb175-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Exportamos tablas utilizando `rio` y `here`. </span></span>
<span id="cb175-56"><a href="#cb175-56" aria-hidden="true" tabindex="-1"></a>lista <span class="ot">&lt;-</span> <span class="fu">list</span>(tabla4,tabla5,tabla6,tabla7,tabla8)</span>
<span id="cb175-57"><a href="#cb175-57" aria-hidden="true" tabindex="-1"></a>lista</span>
<span id="cb175-58"><a href="#cb175-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-59"><a href="#cb175-59" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>){</span>
<span id="cb175-60"><a href="#cb175-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">export</span>(lista[i],<span class="fu">here</span>(<span class="st">&quot;resultados&quot;</span>, <span class="st">&quot;ejercicio1&quot;</span>, </span>
<span id="cb175-61"><a href="#cb175-61" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">paste</span>(<span class="st">&quot;tabla&quot;</span>,i <span class="sc">+</span> <span class="dv">3</span>,<span class="st">&quot;.xlsx&quot;</span>,<span class="at">sep=</span><span class="st">&quot;&quot;</span>)))</span>
<span id="cb175-62"><a href="#cb175-62" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb175-63"><a href="#cb175-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-64"><a href="#cb175-64" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(flextable)</span>
<span id="cb175-65"><a href="#cb175-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-66"><a href="#cb175-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Exportamos la tabla directamente desde flextable</span></span>
<span id="cb175-67"><a href="#cb175-67" aria-hidden="true" tabindex="-1"></a>tabla8_imagen_word <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span></span>
<span id="cb175-68"><a href="#cb175-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(age_cat, gender) <span class="sc">%&gt;%</span> </span>
<span id="cb175-69"><a href="#cb175-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_totals</span>(<span class="at">where =</span> <span class="st">&quot;col&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb175-70"><a href="#cb175-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_percentages</span>(<span class="at">denominator =</span> <span class="st">&quot;col&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb175-71"><a href="#cb175-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_pct_formatting</span>(<span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb175-72"><a href="#cb175-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_ns</span>(<span class="at">position =</span> <span class="st">&quot;front&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb175-73"><a href="#cb175-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_title</span>(</span>
<span id="cb175-74"><a href="#cb175-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">row_name =</span> <span class="st">&quot;Categoria Edad&quot;</span>,</span>
<span id="cb175-75"><a href="#cb175-75" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_name =</span> <span class="st">&quot;Genero&quot;</span>,</span>
<span id="cb175-76"><a href="#cb175-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">placement =</span> <span class="st">&quot;combined&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb175-77"><a href="#cb175-77" aria-hidden="true" tabindex="-1"></a>  flextable<span class="sc">::</span><span class="fu">flextable</span>() <span class="sc">%&gt;%</span>                  </span>
<span id="cb175-78"><a href="#cb175-78" aria-hidden="true" tabindex="-1"></a>  flextable<span class="sc">::</span><span class="fu">autofit</span>() <span class="sc">%&gt;%</span>                       </span>
<span id="cb175-79"><a href="#cb175-79" aria-hidden="true" tabindex="-1"></a>  flextable<span class="sc">::</span><span class="fu">save_as_docx</span>(<span class="at">path =</span> <span class="st">&quot;tabla8_imagen.docx&quot;</span>)  </span></code></pre></div>
</div>
</div>
<div id="estadística-descriptiva-con-dplyr" class="section level3 hasAnchor" number="2.6.4">
<h3 class="hasAnchor"><span class="header-section-number">2.6.4</span> Estadística descriptiva con “dplyr”<a href="#estadística-descriptiva-con-dplyr" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Ahora vamos a volver a utilizar los verbos del paquete “dplyr” que vimos la sección anterior. Vamos a generar las mismas cosas, pero de otra forma.</p>
<p>Frecuencias:</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Removemos todo, menos datos </span></span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>()[<span class="sc">!</span> <span class="fu">ls</span>() <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;datos&quot;</span>)])</span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. ¿Cuál es el total de datos?</span></span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true" tabindex="-1"></a>tabla1 <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span>                 </span>
<span id="cb176-6"><a href="#cb176-6" aria-hidden="true" tabindex="-1"></a>          <span class="fu">summarise</span>(<span class="at">n_rows =</span> <span class="fu">n</span>())   </span>
<span id="cb176-7"><a href="#cb176-7" aria-hidden="true" tabindex="-1"></a>tabla1 </span>
<span id="cb176-8"><a href="#cb176-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-9"><a href="#cb176-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. ¿Cuál es el total por categorías de edad? (con group_by y con summarize)?</span></span>
<span id="cb176-10"><a href="#cb176-10" aria-hidden="true" tabindex="-1"></a>tabla2 <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span> </span>
<span id="cb176-11"><a href="#cb176-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age_cat) <span class="sc">%&gt;%</span>     </span>
<span id="cb176-12"><a href="#cb176-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_rows =</span> <span class="fu">n</span>())   </span>
<span id="cb176-13"><a href="#cb176-13" aria-hidden="true" tabindex="-1"></a>tabla2 </span>
<span id="cb176-14"><a href="#cb176-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-15"><a href="#cb176-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. ¿Cuál es el total por categorías de edad (con count)?</span></span>
<span id="cb176-16"><a href="#cb176-16" aria-hidden="true" tabindex="-1"></a>tabla3 <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span> </span>
<span id="cb176-17"><a href="#cb176-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(age_cat)</span>
<span id="cb176-18"><a href="#cb176-18" aria-hidden="true" tabindex="-1"></a>tabla3 </span>
<span id="cb176-19"><a href="#cb176-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-20"><a href="#cb176-20" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. ¿Cuál es el total por categorías de edad y outcome (con count)?</span></span>
<span id="cb176-21"><a href="#cb176-21" aria-hidden="true" tabindex="-1"></a>tabla4 <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span> </span>
<span id="cb176-22"><a href="#cb176-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(age_cat, outcome)</span>
<span id="cb176-23"><a href="#cb176-23" aria-hidden="true" tabindex="-1"></a>tabla4 </span>
<span id="cb176-24"><a href="#cb176-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-25"><a href="#cb176-25" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Equivalente con group_by()</span></span>
<span id="cb176-26"><a href="#cb176-26" aria-hidden="true" tabindex="-1"></a>tabla4a <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span> </span>
<span id="cb176-27"><a href="#cb176-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age_cat, outcome) <span class="sc">%&gt;%</span> </span>
<span id="cb176-28"><a href="#cb176-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_rows =</span> <span class="fu">n</span>())</span>
<span id="cb176-29"><a href="#cb176-29" aria-hidden="true" tabindex="-1"></a>tabla4a</span></code></pre></div>
<p>Porcentajes:</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a>tabla5 <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span> </span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(outcome, age_cat) <span class="sc">%&gt;%</span>                     </span>
<span id="cb177-3"><a href="#cb177-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(                            </span>
<span id="cb177-4"><a href="#cb177-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">percent =</span> (n <span class="sc">/</span> <span class="fu">sum</span>(n))<span class="sc">*</span><span class="dv">100</span>) </span>
<span id="cb177-5"><a href="#cb177-5" aria-hidden="true" tabindex="-1"></a>tabla5</span>
<span id="cb177-6"><a href="#cb177-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-7"><a href="#cb177-7" aria-hidden="true" tabindex="-1"></a>tabla6 <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span>                  </span>
<span id="cb177-8"><a href="#cb177-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(outcome) <span class="sc">%&gt;%</span>                          </span>
<span id="cb177-9"><a href="#cb177-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(age_cat) <span class="sc">%&gt;%</span>                            </span>
<span id="cb177-10"><a href="#cb177-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percent =</span> (n <span class="sc">/</span> <span class="fu">sum</span>(n)<span class="sc">*</span><span class="dv">100</span>)) </span>
<span id="cb177-11"><a href="#cb177-11" aria-hidden="true" tabindex="-1"></a>tabla6 </span></code></pre></div>
<p>Resumen:</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a>tabla7 <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span>         <span class="co"># armamos la tabla como un nuevo objeto</span></span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(hospital) <span class="sc">%&gt;%</span>    <span class="co"># agrupamos todos los cálculos por hospital</span></span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(                <span class="co"># generamos la estadística que nos interesa</span></span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">cases       =</span> <span class="fu">n</span>(),      <span class="co"># número de observaciones por grupo</span></span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">delay_max   =</span> <span class="fu">max</span>(days_onset_hosp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),  <span class="co"># maximo retraso</span></span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">delay_mean  =</span> <span class="fu">round</span>(<span class="fu">mean</span>(days_onset_hosp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">digits =</span> <span class="dv">1</span>),  <span class="co"># retraso promedio</span></span>
<span id="cb178-7"><a href="#cb178-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">delay_sd    =</span> <span class="fu">round</span>(<span class="fu">sd</span>(days_onset_hosp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">digits =</span> <span class="dv">1</span>),  <span class="co"># desviacion estandar retraso</span></span>
<span id="cb178-8"><a href="#cb178-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">delay_3     =</span> <span class="fu">sum</span>(days_onset_hosp <span class="sc">&gt;=</span> <span class="dv">3</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),   <span class="co"># número de hospitales on retrasos mayores a tres dias</span></span>
<span id="cb178-9"><a href="#cb178-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_delay_3 =</span> (delay_3 <span class="sc">/</span> cases))                    <span class="co"># porcentaje de lo anterior </span></span>
<span id="cb178-10"><a href="#cb178-10" aria-hidden="true" tabindex="-1"></a>tabla7</span></code></pre></div>
<p>Estadísticas condicionales:</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a>tabla8 <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span> </span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(hospital) <span class="sc">%&gt;%</span> </span>
<span id="cb179-3"><a href="#cb179-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb179-4"><a href="#cb179-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_temp_fvr =</span> <span class="fu">max</span>(temp[fever <span class="sc">==</span> <span class="st">&quot;yes&quot;</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb179-5"><a href="#cb179-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_temp_no =</span> <span class="fu">max</span>(temp[fever <span class="sc">==</span> <span class="st">&quot;no&quot;</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb179-6"><a href="#cb179-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb179-7"><a href="#cb179-7" aria-hidden="true" tabindex="-1"></a>tabla8</span>
<span id="cb179-8"><a href="#cb179-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-9"><a href="#cb179-9" aria-hidden="true" tabindex="-1"></a><span class="co"># ¿Cuál es la temperatura promedio para los pacientes que tuvieron fiebre y para los que no?</span></span>
<span id="cb179-10"><a href="#cb179-10" aria-hidden="true" tabindex="-1"></a>tabla9 <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span> </span>
<span id="cb179-11"><a href="#cb179-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(hospital) <span class="sc">%&gt;%</span> </span>
<span id="cb179-12"><a href="#cb179-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb179-13"><a href="#cb179-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">promedio_temp_fvr =</span> <span class="fu">mean</span>(temp[fever <span class="sc">==</span> <span class="st">&quot;yes&quot;</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb179-14"><a href="#cb179-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">promedio_temp_no =</span> <span class="fu">mean</span>(temp[fever <span class="sc">==</span> <span class="st">&quot;no&quot;</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb179-15"><a href="#cb179-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb179-16"><a href="#cb179-16" aria-hidden="true" tabindex="-1"></a>tabla9</span></code></pre></div>
<p>Percentiles:</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Percentiles por defecto de la variable edad (0%, 25%, 50%, 75%, 100%). </span></span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Usamos la función `quantile()`. </span></span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a>tabla10 <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span> </span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">percentiles_edad =</span> <span class="fu">quantile</span>(age_years, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a>tabla10</span>
<span id="cb180-6"><a href="#cb180-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-7"><a href="#cb180-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Agregarlos manualmente</span></span>
<span id="cb180-8"><a href="#cb180-8" aria-hidden="true" tabindex="-1"></a>tabla11 <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span> </span>
<span id="cb180-9"><a href="#cb180-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb180-10"><a href="#cb180-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">percentiles_edad =</span> <span class="fu">quantile</span>(</span>
<span id="cb180-11"><a href="#cb180-11" aria-hidden="true" tabindex="-1"></a>      age_years,</span>
<span id="cb180-12"><a href="#cb180-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">05</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.98</span>), </span>
<span id="cb180-13"><a href="#cb180-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb180-14"><a href="#cb180-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb180-15"><a href="#cb180-15" aria-hidden="true" tabindex="-1"></a>tabla11 </span>
<span id="cb180-16"><a href="#cb180-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-17"><a href="#cb180-17" aria-hidden="true" tabindex="-1"></a><span class="co"># También los podemos calcular combinando con otro verbos y mas especifico</span></span>
<span id="cb180-18"><a href="#cb180-18" aria-hidden="true" tabindex="-1"></a>tabla12 <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span> </span>
<span id="cb180-19"><a href="#cb180-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(hospital,outcome) <span class="sc">%&gt;%</span> </span>
<span id="cb180-20"><a href="#cb180-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb180-21"><a href="#cb180-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">p05 =</span> <span class="fu">quantile</span>(age_years, <span class="at">probs =</span> <span class="fl">0.05</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb180-22"><a href="#cb180-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">p50 =</span> <span class="fu">quantile</span>(age_years, <span class="at">probs =</span> <span class="fl">0.5</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb180-23"><a href="#cb180-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">p75 =</span> <span class="fu">quantile</span>(age_years, <span class="at">probs =</span> <span class="fl">0.75</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb180-24"><a href="#cb180-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">p98 =</span> <span class="fu">quantile</span>(age_years, <span class="at">probs =</span> <span class="fl">0.98</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb180-25"><a href="#cb180-25" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb180-26"><a href="#cb180-26" aria-hidden="true" tabindex="-1"></a>tabla12</span>
<span id="cb180-27"><a href="#cb180-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-28"><a href="#cb180-28" aria-hidden="true" tabindex="-1"></a><span class="co"># También podemos hacerlo utilizando `get_summary_stats()`</span></span>
<span id="cb180-29"><a href="#cb180-29" aria-hidden="true" tabindex="-1"></a>tabla13 <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span> </span>
<span id="cb180-30"><a href="#cb180-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(hospital) <span class="sc">%&gt;%</span> </span>
<span id="cb180-31"><a href="#cb180-31" aria-hidden="true" tabindex="-1"></a>  rstatix<span class="sc">::</span><span class="fu">get_summary_stats</span>(age, <span class="at">type =</span> <span class="st">&quot;quantile&quot;</span>)</span>
<span id="cb180-32"><a href="#cb180-32" aria-hidden="true" tabindex="-1"></a>tabla13 </span></code></pre></div>
<p>Resumir datos agregados:</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Contamos y quitamos los NA</span></span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a>tabla14 <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span> </span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(gender, outcome) <span class="sc">%&gt;%</span> </span>
<span id="cb181-4"><a href="#cb181-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(outcome, gender)</span>
<span id="cb181-5"><a href="#cb181-5" aria-hidden="true" tabindex="-1"></a>tabla14</span>
<span id="cb181-6"><a href="#cb181-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-7"><a href="#cb181-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Contamos por grupos y con condiciones. </span></span>
<span id="cb181-8"><a href="#cb181-8" aria-hidden="true" tabindex="-1"></a>tabla15 <span class="ot">&lt;-</span> tabla14 <span class="sc">%&gt;%</span> </span>
<span id="cb181-9"><a href="#cb181-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(outcome) <span class="sc">%&gt;%</span> </span>
<span id="cb181-10"><a href="#cb181-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb181-11"><a href="#cb181-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_cases  =</span> <span class="fu">sum</span>(n, <span class="at">na.rm=</span>T),</span>
<span id="cb181-12"><a href="#cb181-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">male_cases   =</span> <span class="fu">sum</span>(n[gender <span class="sc">==</span> <span class="st">&quot;m&quot;</span>], <span class="at">na.rm=</span>T),</span>
<span id="cb181-13"><a href="#cb181-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">female_cases =</span> <span class="fu">sum</span>(n[gender <span class="sc">==</span> <span class="st">&quot;f&quot;</span>], <span class="at">na.rm=</span>T))</span>
<span id="cb181-14"><a href="#cb181-14" aria-hidden="true" tabindex="-1"></a>tabla15</span>
<span id="cb181-15"><a href="#cb181-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-16"><a href="#cb181-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Hacer lo mismo, pero para mas grupos y variables</span></span>
<span id="cb181-17"><a href="#cb181-17" aria-hidden="true" tabindex="-1"></a>tabla16 <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span> </span>
<span id="cb181-18"><a href="#cb181-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(outcome) <span class="sc">%&gt;%</span> </span>
<span id="cb181-19"><a href="#cb181-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">c</span>(age_years, temp, wt_kg, ht_cm),  <span class="co"># columnas</span></span>
<span id="cb181-20"><a href="#cb181-20" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.fns =</span> mean,                               <span class="co"># funcion</span></span>
<span id="cb181-21"><a href="#cb181-21" aria-hidden="true" tabindex="-1"></a>                   <span class="at">na.rm =</span> <span class="cn">TRUE</span>))                             <span class="co"># opciones</span></span>
<span id="cb181-22"><a href="#cb181-22" aria-hidden="true" tabindex="-1"></a>tabla16</span>
<span id="cb181-23"><a href="#cb181-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-24"><a href="#cb181-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Para todas las variables numéricas </span></span>
<span id="cb181-25"><a href="#cb181-25" aria-hidden="true" tabindex="-1"></a>tabla17 <span class="ot">&lt;-</span></span>
<span id="cb181-26"><a href="#cb181-26" aria-hidden="true" tabindex="-1"></a>  datos <span class="sc">%&gt;%</span> </span>
<span id="cb181-27"><a href="#cb181-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(outcome) <span class="sc">%&gt;%</span> </span>
<span id="cb181-28"><a href="#cb181-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(</span>
<span id="cb181-29"><a href="#cb181-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">.cols =</span> <span class="fu">where</span>(is.numeric), </span>
<span id="cb181-30"><a href="#cb181-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">.fns =</span> mean,</span>
<span id="cb181-31"><a href="#cb181-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.rm=</span>T))</span>
<span id="cb181-32"><a href="#cb181-32" aria-hidden="true" tabindex="-1"></a>tabla17 </span>
<span id="cb181-33"><a href="#cb181-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-34"><a href="#cb181-34" aria-hidden="true" tabindex="-1"></a><span class="co"># De long a wide</span></span>
<span id="cb181-35"><a href="#cb181-35" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(scales)</span>
<span id="cb181-36"><a href="#cb181-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-37"><a href="#cb181-37" aria-hidden="true" tabindex="-1"></a>tabla18 <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span>                  </span>
<span id="cb181-38"><a href="#cb181-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(outcome) <span class="sc">%&gt;%</span>                         </span>
<span id="cb181-39"><a href="#cb181-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(age_cat) <span class="sc">%&gt;%</span>                            </span>
<span id="cb181-40"><a href="#cb181-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percent =</span> scales<span class="sc">::</span><span class="fu">percent</span>(n <span class="sc">/</span> <span class="fu">sum</span>(n))) </span>
<span id="cb181-41"><a href="#cb181-41" aria-hidden="true" tabindex="-1"></a>tabla18 </span>
<span id="cb181-42"><a href="#cb181-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-43"><a href="#cb181-43" aria-hidden="true" tabindex="-1"></a><span class="co"># La tabla esta en formato long! </span></span>
<span id="cb181-44"><a href="#cb181-44" aria-hidden="true" tabindex="-1"></a>tabla19 <span class="ot">&lt;-</span> tabla18 <span class="sc">%&gt;%</span>  </span>
<span id="cb181-45"><a href="#cb181-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>percent) <span class="sc">%&gt;%</span>   <span class="co"># no quiero porcentaje</span></span>
<span id="cb181-46"><a href="#cb181-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> age_cat, </span>
<span id="cb181-47"><a href="#cb181-47" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> n)  </span>
<span id="cb181-48"><a href="#cb181-48" aria-hidden="true" tabindex="-1"></a>tabla19</span>
<span id="cb181-49"><a href="#cb181-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-50"><a href="#cb181-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Tabla con totales</span></span>
<span id="cb181-51"><a href="#cb181-51" aria-hidden="true" tabindex="-1"></a>tabla20 <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span> </span>
<span id="cb181-52"><a href="#cb181-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(gender) <span class="sc">%&gt;%</span></span>
<span id="cb181-53"><a href="#cb181-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb181-54"><a href="#cb181-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">known_outcome =</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(outcome)),           <span class="co"># Número de filas del grupo en las que no falta el resultado</span></span>
<span id="cb181-55"><a href="#cb181-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_death  =</span> <span class="fu">sum</span>(outcome <span class="sc">==</span> <span class="st">&quot;Death&quot;</span>, <span class="at">na.rm=</span>T),    <span class="co"># Número de filas en el grupo donde el resultado es Muerte</span></span>
<span id="cb181-56"><a href="#cb181-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_recover =</span> <span class="fu">sum</span>(outcome <span class="sc">==</span> <span class="st">&quot;Recover&quot;</span>, <span class="at">na.rm=</span>T), <span class="co"># Número de filas del grupo cuyo resultado es Recuperado</span></span>
<span id="cb181-57"><a href="#cb181-57" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb181-58"><a href="#cb181-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_totals</span>() <span class="sc">%&gt;%</span>                                <span class="co"># Adornar la fila total (suma de cada columna numérica)</span></span>
<span id="cb181-59"><a href="#cb181-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_percentages</span>(<span class="st">&quot;row&quot;</span>) <span class="sc">%&gt;%</span>                      <span class="co"># Proporciones</span></span>
<span id="cb181-60"><a href="#cb181-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_pct_formatting</span>() <span class="sc">%&gt;%</span>                        <span class="co"># porcetnaje</span></span>
<span id="cb181-61"><a href="#cb181-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_ns</span>(<span class="at">position =</span> <span class="st">&quot;rear&quot;</span>)                      <span class="co"># ()</span></span>
<span id="cb181-62"><a href="#cb181-62" aria-hidden="true" tabindex="-1"></a>tabla20 </span>
<span id="cb181-63"><a href="#cb181-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-64"><a href="#cb181-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Exportamos todas las tablas </span></span>
<span id="cb181-65"><a href="#cb181-65" aria-hidden="true" tabindex="-1"></a>lista_tablas <span class="ot">&lt;-</span> <span class="fu">list</span>(tabla1,tabla2,tabla3,tabla4,tabla5,</span>
<span id="cb181-66"><a href="#cb181-66" aria-hidden="true" tabindex="-1"></a>                     tabla6,tabla7,tabla8,tabla9,tabla10,</span>
<span id="cb181-67"><a href="#cb181-67" aria-hidden="true" tabindex="-1"></a>                     tabla11,tabla12,tabla13,tabla14,tabla15,</span>
<span id="cb181-68"><a href="#cb181-68" aria-hidden="true" tabindex="-1"></a>                     tabla16,tabla17,tabla18,tabla19,tabla20)</span>
<span id="cb181-69"><a href="#cb181-69" aria-hidden="true" tabindex="-1"></a>lista_tablas</span>
<span id="cb181-70"><a href="#cb181-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-71"><a href="#cb181-71" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>){</span>
<span id="cb181-72"><a href="#cb181-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">export</span>(lista_tablas[i],<span class="fu">here</span>(<span class="st">&quot;resultados&quot;</span>, <span class="st">&quot;ejercicio2&quot;</span>, </span>
<span id="cb181-73"><a href="#cb181-73" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">paste</span>(<span class="st">&quot;tabla&quot;</span>,i,<span class="st">&quot;.xlsx&quot;</span>,<span class="at">sep=</span><span class="st">&quot;&quot;</span>)))</span>
<span id="cb181-74"><a href="#cb181-74" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Juntar tablas:</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Algunas estadísticas por hospital y outcome</span></span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a>tabla21 <span class="ot">&lt;-</span>datos <span class="sc">%&gt;%</span> </span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(outcome) <span class="sc">&amp;</span> hospital <span class="sc">!=</span> <span class="st">&quot;Missing&quot;</span>) <span class="sc">%&gt;%</span>  <span class="co"># Dejo todo lo que no sea missing</span></span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(hospital, outcome) <span class="sc">%&gt;%</span>                      <span class="co"># agrupo por hospital y outcome</span></span>
<span id="cb182-5"><a href="#cb182-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(                                            </span>
<span id="cb182-6"><a href="#cb182-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">N =</span> <span class="fu">n</span>(),                                                 </span>
<span id="cb182-7"><a href="#cb182-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">ct_value =</span> <span class="fu">median</span>(ct_blood, <span class="at">na.rm=</span>T))               </span>
<span id="cb182-8"><a href="#cb182-8" aria-hidden="true" tabindex="-1"></a>tabla21</span>
<span id="cb182-9"><a href="#cb182-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-10"><a href="#cb182-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Algunas estadísticas solo por outcome </span></span>
<span id="cb182-11"><a href="#cb182-11" aria-hidden="true" tabindex="-1"></a>tabla22 <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span> </span>
<span id="cb182-12"><a href="#cb182-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(outcome) <span class="sc">&amp;</span> hospital <span class="sc">!=</span> <span class="st">&quot;Missing&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb182-13"><a href="#cb182-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(outcome) <span class="sc">%&gt;%</span>                            <span class="co"># Ahora agrupo solo por outcome, no hospital    </span></span>
<span id="cb182-14"><a href="#cb182-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb182-15"><a href="#cb182-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">N =</span> <span class="fu">n</span>(),                                       <span class="co"># Estadisticas solo por outcome    </span></span>
<span id="cb182-16"><a href="#cb182-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">ct_value =</span> <span class="fu">median</span>(ct_blood, <span class="at">na.rm=</span>T))</span>
<span id="cb182-17"><a href="#cb182-17" aria-hidden="true" tabindex="-1"></a>tabla22</span>
<span id="cb182-18"><a href="#cb182-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-19"><a href="#cb182-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Juntando </span></span>
<span id="cb182-20"><a href="#cb182-20" aria-hidden="true" tabindex="-1"></a>table_long <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(tabla21, tabla22) <span class="sc">%&gt;%</span> </span>
<span id="cb182-21"><a href="#cb182-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hospital =</span> <span class="fu">replace_na</span>(hospital, <span class="st">&quot;Total&quot;</span>))</span>
<span id="cb182-22"><a href="#cb182-22" aria-hidden="true" tabindex="-1"></a>table_long</span>
<span id="cb182-23"><a href="#cb182-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-24"><a href="#cb182-24" aria-hidden="true" tabindex="-1"></a><span class="co"># A formato long y a exportar </span></span>
<span id="cb182-25"><a href="#cb182-25" aria-hidden="true" tabindex="-1"></a>table_long <span class="sc">%&gt;%</span> </span>
<span id="cb182-26"><a href="#cb182-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hospital =</span> <span class="fu">replace_na</span>(hospital, <span class="st">&quot;Total&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb182-27"><a href="#cb182-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(                                         <span class="co"># de largo a ancho</span></span>
<span id="cb182-28"><a href="#cb182-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="fu">c</span>(ct_value, N),                       <span class="co"># cambio valores</span></span>
<span id="cb182-29"><a href="#cb182-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> outcome) <span class="sc">%&gt;%</span>                           <span class="co"># cambio columnas</span></span>
<span id="cb182-30"><a href="#cb182-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(                                              <span class="co"># agrego nuevas columnas</span></span>
<span id="cb182-31"><a href="#cb182-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">N_Known =</span> N_Death <span class="sc">+</span> N_Recover,                               <span class="co"># numero total</span></span>
<span id="cb182-32"><a href="#cb182-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">Pct_Death =</span> scales<span class="sc">::</span><span class="fu">percent</span>(N_Death <span class="sc">/</span> N_Known, <span class="fl">0.1</span>),         <span class="co"># % casos que murieron</span></span>
<span id="cb182-33"><a href="#cb182-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">Pct_Recover =</span> scales<span class="sc">::</span><span class="fu">percent</span>(N_Recover <span class="sc">/</span> N_Known, <span class="fl">0.1</span>)) <span class="sc">%&gt;%</span> <span class="co"># % casos recuperados</span></span>
<span id="cb182-34"><a href="#cb182-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(                                              <span class="co"># reordeno columnas</span></span>
<span id="cb182-35"><a href="#cb182-35" aria-hidden="true" tabindex="-1"></a>    hospital, N_Known,                                   <span class="co"># totales</span></span>
<span id="cb182-36"><a href="#cb182-36" aria-hidden="true" tabindex="-1"></a>    N_Recover, Pct_Recover, ct_value_Recover,            <span class="co"># recuperado</span></span>
<span id="cb182-37"><a href="#cb182-37" aria-hidden="true" tabindex="-1"></a>    N_Death, Pct_Death, ct_value_Death)  <span class="sc">%&gt;%</span>             <span class="co"># muertes</span></span>
<span id="cb182-38"><a href="#cb182-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(N_Known)  <span class="sc">%&gt;%</span>                                  <span class="co"># Ordeno </span></span>
<span id="cb182-39"><a href="#cb182-39" aria-hidden="true" tabindex="-1"></a>  flextable<span class="sc">::</span><span class="fu">flextable</span>() <span class="sc">%&gt;%</span>                     <span class="co"># a imagen</span></span>
<span id="cb182-40"><a href="#cb182-40" aria-hidden="true" tabindex="-1"></a>  flextable<span class="sc">::</span><span class="fu">autofit</span>() <span class="sc">%&gt;%</span>                       <span class="co"># una linea por fila </span></span>
<span id="cb182-41"><a href="#cb182-41" aria-hidden="true" tabindex="-1"></a>  flextable<span class="sc">::</span><span class="fu">save_as_docx</span>(<span class="at">path =</span> <span class="fu">here</span>(<span class="st">&quot;resultados&quot;</span>,<span class="st">&quot;ejercicio2&quot;</span>,<span class="st">&quot;tablefinal.docx&quot;</span>))  <span class="co"># exporto</span></span></code></pre></div>
</div>
</div>
<div id="visualización" class="section level2 hasAnchor" number="2.7">
<h2 class="hasAnchor"><span class="header-section-number">2.7</span> Visualización<a href="#visualización" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="visualización-r-base" class="section level3 hasAnchor" number="2.7.1">
<h3 class="hasAnchor"><span class="header-section-number">2.7.1</span> Visualización: R base<a href="#visualización-r-base" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Vamos a hacer graficos unicamente utilizando R básico.</p>
<div id="plot" class="section level4 hasAnchor" number="2.7.1.1">
<h4 class="hasAnchor"><span class="header-section-number">2.7.1.1</span> Plot<a href="#plot" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Para visualizar datos </span></span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a>altura <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">168</span>, <span class="dv">177</span>, <span class="dv">177</span>, <span class="dv">177</span>, <span class="dv">178</span>, <span class="dv">172</span>, <span class="dv">165</span>, <span class="dv">171</span>, <span class="dv">178</span>, <span class="dv">170</span>)</span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a>peso <span class="ot">&lt;-</span>  <span class="fu">c</span>(<span class="dv">88</span>, <span class="dv">72</span>, <span class="dv">85</span>, <span class="dv">52</span>, <span class="dv">71</span>, <span class="dv">69</span>, <span class="dv">61</span>, <span class="dv">61</span>, <span class="dv">51</span>, <span class="dv">75</span>)</span>
<span id="cb183-4"><a href="#cb183-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-5"><a href="#cb183-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico simple </span></span>
<span id="cb183-6"><a href="#cb183-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(altura,</span>
<span id="cb183-7"><a href="#cb183-7" aria-hidden="true" tabindex="-1"></a>     peso, </span>
<span id="cb183-8"><a href="#cb183-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Peso (kg)&quot;</span>, </span>
<span id="cb183-9"><a href="#cb183-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Altura (cm)&quot;</span>)</span>
<span id="cb183-10"><a href="#cb183-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-11"><a href="#cb183-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Ahora lo vamos a exportar</span></span>
<span id="cb183-12"><a href="#cb183-12" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="fu">here</span>(<span class="st">&quot;figuras&quot;</span>))</span>
<span id="cb183-13"><a href="#cb183-13" aria-hidden="true" tabindex="-1"></a><span class="fu">pdf</span>(<span class="st">&quot;g1.pdf&quot;</span>)</span>
<span id="cb183-14"><a href="#cb183-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(altura,peso)</span>
<span id="cb183-15"><a href="#cb183-15" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb183-16"><a href="#cb183-16" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(altura,peso)</span></code></pre></div>
</div>
<div id="histograma" class="section level4 hasAnchor" number="2.7.1.2">
<h4 class="hasAnchor"><span class="header-section-number">2.7.1.2</span> Histograma<a href="#histograma" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Buscar ayuda: </span></span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a>?<span class="fu">hist</span>()</span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementarla </span></span>
<span id="cb184-5"><a href="#cb184-5" aria-hidden="true" tabindex="-1"></a>g2 <span class="ot">&lt;-</span> <span class="fu">hist</span>(wage,</span>
<span id="cb184-6"><a href="#cb184-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="dv">20</span>,   <span class="co"># número de intervalos</span></span>
<span id="cb184-7"><a href="#cb184-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">main =</span> <span class="st">&quot;Distribución del Salario (dólares por hora)&quot;</span>,    <span class="co"># título del gráfico</span></span>
<span id="cb184-8"><a href="#cb184-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">&quot;Salario&quot;</span>,                                        <span class="co"># título del eje x</span></span>
<span id="cb184-9"><a href="#cb184-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">ylab =</span> <span class="st">&quot;Número de personas&quot;</span>                              <span class="co"># título del eje y</span></span>
<span id="cb184-10"><a href="#cb184-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb184-11"><a href="#cb184-11" aria-hidden="true" tabindex="-1"></a>g2</span>
<span id="cb184-12"><a href="#cb184-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-13"><a href="#cb184-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Podemos agregar colores</span></span>
<span id="cb184-14"><a href="#cb184-14" aria-hidden="true" tabindex="-1"></a>g2 <span class="ot">&lt;-</span> <span class="fu">hist</span>(wage,</span>
<span id="cb184-15"><a href="#cb184-15" aria-hidden="true" tabindex="-1"></a>     <span class="at">breaks =</span> <span class="dv">20</span>,   <span class="co"># n?mero de intervalos</span></span>
<span id="cb184-16"><a href="#cb184-16" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Distribución del Salario (dólares por hora)&quot;</span>,    <span class="co"># título del gráfico</span></span>
<span id="cb184-17"><a href="#cb184-17" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Salario&quot;</span>,                                        <span class="co"># título del eje x</span></span>
<span id="cb184-18"><a href="#cb184-18" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Numero de personas&quot;</span>,                              <span class="co"># título del eje y</span></span>
<span id="cb184-19"><a href="#cb184-19" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">&quot;pink&quot;</span></span>
<span id="cb184-20"><a href="#cb184-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb184-21"><a href="#cb184-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-22"><a href="#cb184-22" aria-hidden="true" tabindex="-1"></a>g2</span>
<span id="cb184-23"><a href="#cb184-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-24"><a href="#cb184-24" aria-hidden="true" tabindex="-1"></a><span class="co"># También podemos agregar límites en los ejes</span></span>
<span id="cb184-25"><a href="#cb184-25" aria-hidden="true" tabindex="-1"></a>g2 <span class="ot">&lt;-</span> <span class="fu">hist</span>(wage,</span>
<span id="cb184-26"><a href="#cb184-26" aria-hidden="true" tabindex="-1"></a>     <span class="at">breaks =</span> <span class="dv">20</span>,   <span class="co"># número de intervalos</span></span>
<span id="cb184-27"><a href="#cb184-27" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Distribución del Salario (dólares por hora)&quot;</span>,    </span>
<span id="cb184-28"><a href="#cb184-28" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Salario&quot;</span>,                                        </span>
<span id="cb184-29"><a href="#cb184-29" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Número de personas&quot;</span>,                              </span>
<span id="cb184-30"><a href="#cb184-30" aria-hidden="true" tabindex="-1"></a>     <span class="at">col=</span><span class="st">&quot;pink&quot;</span>,</span>
<span id="cb184-31"><a href="#cb184-31" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">50</span>),<span class="co"># Límites del histograma</span></span>
<span id="cb184-32"><a href="#cb184-32" aria-hidden="true" tabindex="-1"></a>     <span class="at">freq =</span> <span class="cn">TRUE</span> <span class="co">#TRUE = freq. absoluta, FALSE: relativa. </span></span>
<span id="cb184-33"><a href="#cb184-33" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb184-34"><a href="#cb184-34" aria-hidden="true" tabindex="-1"></a>g2</span>
<span id="cb184-35"><a href="#cb184-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-36"><a href="#cb184-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-37"><a href="#cb184-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Podemos hacer lo mismo, pero  agregar la distribución empirica</span></span>
<span id="cb184-38"><a href="#cb184-38" aria-hidden="true" tabindex="-1"></a><span class="fu">pdf</span>(<span class="st">&quot;g3.pdf&quot;</span>)</span>
<span id="cb184-39"><a href="#cb184-39" aria-hidden="true" tabindex="-1"></a>g3 <span class="ot">&lt;-</span> <span class="fu">hist</span>(wage,</span>
<span id="cb184-40"><a href="#cb184-40" aria-hidden="true" tabindex="-1"></a>     <span class="at">breaks =</span> <span class="dv">20</span>,   <span class="co"># número de intervalos</span></span>
<span id="cb184-41"><a href="#cb184-41" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Distribución del Salario (dólares por hora)&quot;</span>,    </span>
<span id="cb184-42"><a href="#cb184-42" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Salario&quot;</span>,                                        </span>
<span id="cb184-43"><a href="#cb184-43" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Número de personas&quot;</span>,                              </span>
<span id="cb184-44"><a href="#cb184-44" aria-hidden="true" tabindex="-1"></a>     <span class="at">col=</span><span class="st">&quot;pink&quot;</span>,</span>
<span id="cb184-45"><a href="#cb184-45" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">30</span>),</span>
<span id="cb184-46"><a href="#cb184-46" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">12</span>), <span class="co"># Límites del histograma</span></span>
<span id="cb184-47"><a href="#cb184-47" aria-hidden="true" tabindex="-1"></a>     <span class="at">freq =</span> <span class="cn">FALSE</span>, <span class="co">#TRUE = freq. absoluta, FALSE: relativa. </span></span>
<span id="cb184-48"><a href="#cb184-48" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb184-49"><a href="#cb184-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-50"><a href="#cb184-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-51"><a href="#cb184-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Agrego la distribución empirica de los datos </span></span>
<span id="cb184-52"><a href="#cb184-52" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(wage), <span class="at">col=</span><span class="st">&quot;blue&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)  </span></code></pre></div>
<p>Opciones:</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="co"># lwd = line width</span></span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a><span class="co"># col = color</span></span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a><span class="co"># lty = line type</span></span>
<span id="cb185-4"><a href="#cb185-4" aria-hidden="true" tabindex="-1"></a><span class="co"># opciones de lty (0 = blank,  1 = solid (default), </span></span>
<span id="cb185-5"><a href="#cb185-5" aria-hidden="true" tabindex="-1"></a><span class="co">#                              2 = dashed, 3 = dotted, </span></span>
<span id="cb185-6"><a href="#cb185-6" aria-hidden="true" tabindex="-1"></a><span class="co">#                              4 = dotdash, 5 = longdash, </span></span>
<span id="cb185-7"><a href="#cb185-7" aria-hidden="true" tabindex="-1"></a><span class="co">#                              6 = twodash) </span></span>
<span id="cb185-8"><a href="#cb185-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-9"><a href="#cb185-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Agregar más de una distribución </span></span>
<span id="cb185-10"><a href="#cb185-10" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(wage, <span class="at">adjust=</span><span class="dv">2</span>), <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">lty=</span><span class="dv">2</span>) <span class="co"># adjust=2 lo que hace es suavizar un poco la curva </span></span>
<span id="cb185-11"><a href="#cb185-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-12"><a href="#cb185-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Agregar el promedio y la mediana </span></span>
<span id="cb185-13"><a href="#cb185-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-14"><a href="#cb185-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Promedio </span></span>
<span id="cb185-15"><a href="#cb185-15" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="fu">mean</span>(wage), </span>
<span id="cb185-16"><a href="#cb185-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd =</span> <span class="dv">2</span>, </span>
<span id="cb185-17"><a href="#cb185-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">lty =</span> <span class="dv">3</span>, </span>
<span id="cb185-18"><a href="#cb185-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">col=</span><span class="st">&quot;darkgreen&quot;</span>)</span>
<span id="cb185-19"><a href="#cb185-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-20"><a href="#cb185-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Mediana </span></span>
<span id="cb185-21"><a href="#cb185-21" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="fu">median</span>(wage), </span>
<span id="cb185-22"><a href="#cb185-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd =</span> <span class="dv">2</span>, </span>
<span id="cb185-23"><a href="#cb185-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">lty =</span> <span class="dv">3</span>, </span>
<span id="cb185-24"><a href="#cb185-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">col=</span><span class="st">&quot;darkblue&quot;</span>)    </span>
<span id="cb185-25"><a href="#cb185-25" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb185-26"><a href="#cb185-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-27"><a href="#cb185-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Notar que solo hemos utilizado paquetes básicos de R.</span></span>
<span id="cb185-28"><a href="#cb185-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Ahora, podemos exportar el gráfico a la carpeta.</span></span></code></pre></div>
</div>
<div id="gráfico-de-dispersión" class="section level4 hasAnchor" number="2.7.1.3">
<h4 class="hasAnchor"><span class="header-section-number">2.7.1.3</span> Gráfico de dispersión<a href="#gráfico-de-dispersión" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Básico </span></span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(experience, wage)</span>
<span id="cb186-4"><a href="#cb186-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(wage<span class="sc">~</span>experience)</span>
<span id="cb186-5"><a href="#cb186-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-6"><a href="#cb186-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Mejorando la presentación </span></span>
<span id="cb186-7"><a href="#cb186-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span> (wage <span class="sc">~</span> experience,  </span>
<span id="cb186-8"><a href="#cb186-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">main =</span> <span class="st">&quot;Salario en función de la experiencia&quot;</span>,</span>
<span id="cb186-9"><a href="#cb186-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">&quot;Experiencia (en años)&quot;</span>,</span>
<span id="cb186-10"><a href="#cb186-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">ylab =</span> <span class="st">&quot;Salario&quot;</span></span>
<span id="cb186-11"><a href="#cb186-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb186-12"><a href="#cb186-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-13"><a href="#cb186-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Podemos agrupar </span></span>
<span id="cb186-14"><a href="#cb186-14" aria-hidden="true" tabindex="-1"></a>CPS1985 <span class="ot">&lt;-</span> CPS1985 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">sexo =</span> <span class="fu">as.numeric</span>(gender))</span>
<span id="cb186-15"><a href="#cb186-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-16"><a href="#cb186-16" aria-hidden="true" tabindex="-1"></a><span class="fu">pdf</span>(<span class="st">&quot;g4.pdf&quot;</span>)</span>
<span id="cb186-17"><a href="#cb186-17" aria-hidden="true" tabindex="-1"></a>g4 <span class="ot">&lt;-</span> <span class="fu">plot</span> (wage <span class="sc">~</span> experience, </span>
<span id="cb186-18"><a href="#cb186-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> CPS1985, </span>
<span id="cb186-19"><a href="#cb186-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">pch =</span> sexo, <span class="co">#Diferente simbolo dependiendo del género</span></span>
<span id="cb186-20"><a href="#cb186-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> sexo,  <span class="co">#Color diferenciado por género</span></span>
<span id="cb186-21"><a href="#cb186-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">main =</span> <span class="st">&quot;Salario en función de la experiencia&quot;</span>,</span>
<span id="cb186-22"><a href="#cb186-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">&quot;Experiencia (en años)&quot;</span>,</span>
<span id="cb186-23"><a href="#cb186-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">ylab =</span> <span class="st">&quot;Salario&quot;</span></span>
<span id="cb186-24"><a href="#cb186-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb186-25"><a href="#cb186-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-26"><a href="#cb186-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Agregamos Leyenda </span></span>
<span id="cb186-27"><a href="#cb186-27" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>, </span>
<span id="cb186-28"><a href="#cb186-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend=</span><span class="fu">c</span>(<span class="st">&quot;Hombres&quot;</span>,<span class="st">&quot;Mujeres&quot;</span>), </span>
<span id="cb186-29"><a href="#cb186-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, </span>
<span id="cb186-30"><a href="#cb186-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">col=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,</span>
<span id="cb186-31"><a href="#cb186-31" aria-hidden="true" tabindex="-1"></a>       <span class="at">bty=</span><span class="st">&quot;n&quot;</span>) <span class="co">#Caja de la leyenda</span></span>
<span id="cb186-32"><a href="#cb186-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-33"><a href="#cb186-33" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="at">legend=</span><span class="fu">c</span>(<span class="st">&quot;Hombres&quot;</span>,<span class="st">&quot;Mujeres&quot;</span>), <span class="at">pch=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">col=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb186-34"><a href="#cb186-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-35"><a href="#cb186-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Agregamos una regresión </span></span>
<span id="cb186-36"><a href="#cb186-36" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(CPS1985[gender<span class="sc">==</span><span class="st">&quot;male&quot;</span>,], </span>
<span id="cb186-37"><a href="#cb186-37" aria-hidden="true" tabindex="-1"></a>     <span class="fu">abline</span>(<span class="fu">lm</span>(wage<span class="sc">~</span>experience), <span class="at">col=</span><span class="st">&quot;black&quot;</span>))</span>
<span id="cb186-38"><a href="#cb186-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-39"><a href="#cb186-39" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(CPS1985[gender<span class="sc">==</span><span class="st">&quot;female&quot;</span>,], </span>
<span id="cb186-40"><a href="#cb186-40" aria-hidden="true" tabindex="-1"></a>     <span class="fu">abline</span>(<span class="fu">lm</span>(wage<span class="sc">~</span>experience), <span class="at">col=</span><span class="st">&quot;red&quot;</span>))</span>
<span id="cb186-41"><a href="#cb186-41" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
</div>
<div id="gráfico-de-barras" class="section level4 hasAnchor" number="2.7.1.4">
<h4 class="hasAnchor"><span class="header-section-number">2.7.1.4</span> Gráfico de barras<a href="#gráfico-de-barras" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Primero tenemos que crear las frecuencias </span></span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a>frecuencias <span class="ot">&lt;-</span> <span class="fu">table</span>(occupation)  <span class="co"># con variable categórica</span></span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a>frecuencias</span>
<span id="cb187-4"><a href="#cb187-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-5"><a href="#cb187-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Básico</span></span>
<span id="cb187-6"><a href="#cb187-6" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(frecuencias,</span>
<span id="cb187-7"><a href="#cb187-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)</span>
<span id="cb187-8"><a href="#cb187-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb187-9"><a href="#cb187-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-10"><a href="#cb187-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Ahora con educación </span></span>
<span id="cb187-11"><a href="#cb187-11" aria-hidden="true" tabindex="-1"></a>educacion <span class="ot">&lt;-</span> <span class="fu">table</span>(education)</span>
<span id="cb187-12"><a href="#cb187-12" aria-hidden="true" tabindex="-1"></a><span class="fu">pdf</span>(<span class="st">&quot;g5.pdf&quot;</span>)</span>
<span id="cb187-13"><a href="#cb187-13" aria-hidden="true" tabindex="-1"></a>g5 <span class="ot">&lt;-</span>  <span class="fu">barplot</span>(educacion,</span>
<span id="cb187-14"><a href="#cb187-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(educacion),  <span class="co"># para establecer el número de diferentes colores  (=diferentes valores)</span></span>
<span id="cb187-15"><a href="#cb187-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">horiz =</span> <span class="cn">FALSE</span>,            <span class="co"># orientación de las barras</span></span>
<span id="cb187-16"><a href="#cb187-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">250</span>)</span>
<span id="cb187-17"><a href="#cb187-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb187-18"><a href="#cb187-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-19"><a href="#cb187-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Agregamos un título</span></span>
<span id="cb187-20"><a href="#cb187-20" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&quot;Distribución de la educación&quot;</span>, </span>
<span id="cb187-21"><a href="#cb187-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab=</span> <span class="st">&quot;Educación (en años)&quot;</span>, </span>
<span id="cb187-22"><a href="#cb187-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">ylab =</span> <span class="st">&quot;Número de personas&quot;</span>)</span>
<span id="cb187-23"><a href="#cb187-23" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
</div>
<div id="gráfico-de-torta" class="section level4 hasAnchor" number="2.7.1.5">
<h4 class="hasAnchor"><span class="header-section-number">2.7.1.5</span> Gráfico de torta<a href="#gráfico-de-torta" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> <span class="fu">table</span>(ethnicity)</span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>datos</span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a><span class="fu">pie</span>(datos, </span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Caucasicos&quot;</span>, <span class="st">&quot;Hispanos&quot;</span>, <span class="st">&quot;Otros&quot;</span>), </span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">heat.colors</span>(<span class="dv">3</span>),</span>
<span id="cb188-6"><a href="#cb188-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">&quot;Frecuencia de etnias&quot;</span>,</span>
<span id="cb188-7"><a href="#cb188-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">clockwise =</span> <span class="cn">FALSE</span>)</span>
<span id="cb188-8"><a href="#cb188-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-9"><a href="#cb188-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Podemos cambiar los colores </span></span>
<span id="cb188-10"><a href="#cb188-10" aria-hidden="true" tabindex="-1"></a>colores<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">&quot;darkred&quot;</span>,<span class="st">&quot;pink&quot;</span>,<span class="st">&quot;red&quot;</span>)</span>
<span id="cb188-11"><a href="#cb188-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-12"><a href="#cb188-12" aria-hidden="true" tabindex="-1"></a><span class="fu">pdf</span>(<span class="st">&quot;g6.pdf&quot;</span>)</span>
<span id="cb188-13"><a href="#cb188-13" aria-hidden="true" tabindex="-1"></a>g6 <span class="ot">&lt;-</span> <span class="fu">pie</span>(datos, </span>
<span id="cb188-14"><a href="#cb188-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">levels</span>(ethnicity), </span>
<span id="cb188-15"><a href="#cb188-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> colores,</span>
<span id="cb188-16"><a href="#cb188-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">main =</span> <span class="st">&quot;Frecuencia etnias&quot;</span>)</span>
<span id="cb188-17"><a href="#cb188-17" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
</div>
<div id="boxplot" class="section level4 hasAnchor" number="2.7.1.6">
<h4 class="hasAnchor"><span class="header-section-number">2.7.1.6</span> Boxplot<a href="#boxplot" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Algunas cosas que tener en cuenta sobre un boxplot:</p>
<ol style="list-style-type: decimal">
<li>Se le llama grafico de caja y bigote.</li>
<li>Primer quartil (1): borde inferior de la caja.</li>
<li>Mediana: Linea de al medio de la caja.</li>
<li>Tercer quartil: Borde superior de la caja.</li>
<li>Rango intercuartil: Diferencia entre el tercer cuartil y el primero.</li>
</ol>
<p>Sobre el gráfico:</p>
<ol style="list-style-type: decimal">
<li>Caja más grande implica que los datos están mas dispersos.</li>
<li>Tamaño de la caja es el rango intercuartil.</li>
<li>Si la mediana esta al centro, la distribución es simétrica.</li>
<li>¿Que pasa si la parte superior (sobre la linea) es más grande? Los datos se concentran en la parte baja de la distribución.</li>
<li>Los bigotes determinan el límite para valores atípicos.Su longitud máxima es de un 150% del Rango intercuartil (RIC).</li>
</ol>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(wage,</span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">main =</span> <span class="st">&quot;Salario (dólares por hora)&quot;</span>,</span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">ylab =</span> <span class="st">&quot;Salario&quot;</span>,</span>
<span id="cb189-5"><a href="#cb189-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">col =</span> <span class="st">&quot;pink&quot;</span>,</span>
<span id="cb189-6"><a href="#cb189-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">border =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb189-7"><a href="#cb189-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-8"><a href="#cb189-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Separando por sexo</span></span>
<span id="cb189-9"><a href="#cb189-9" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(wage <span class="sc">~</span> gender,</span>
<span id="cb189-10"><a href="#cb189-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">&quot;Salario (dólares por hora) según sexo&quot;</span>,</span>
<span id="cb189-11"><a href="#cb189-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">&quot;Salario&quot;</span>,</span>
<span id="cb189-12"><a href="#cb189-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;pink&quot;</span>,<span class="st">&quot;darkgreen&quot;</span>),</span>
<span id="cb189-13"><a href="#cb189-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">border =</span> <span class="st">&quot;black&quot;</span>)</span>
<span id="cb189-14"><a href="#cb189-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-15"><a href="#cb189-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-16"><a href="#cb189-16" aria-hidden="true" tabindex="-1"></a><span class="co">#Horizontal</span></span>
<span id="cb189-17"><a href="#cb189-17" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(wage <span class="sc">~</span> gender,</span>
<span id="cb189-18"><a href="#cb189-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">&quot;Salario (dólares por hora) según sexo&quot;</span>,</span>
<span id="cb189-19"><a href="#cb189-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">&quot;Salario&quot;</span>,</span>
<span id="cb189-20"><a href="#cb189-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">names =</span> <span class="fu">c</span>(<span class="st">&quot;Hombres&quot;</span>,<span class="st">&quot;Mujeres&quot;</span>),    <span class="co">#Cambiar nombres</span></span>
<span id="cb189-21"><a href="#cb189-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">horizontal =</span> T,                    <span class="co">#Posición horizontal</span></span>
<span id="cb189-22"><a href="#cb189-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="fu">rainbow</span>(<span class="dv">2</span>, <span class="at">alpha=</span><span class="fl">0.8</span>),       <span class="co">#Paleta rainbow (aleatoria) y transparencia (alpha)</span></span>
<span id="cb189-23"><a href="#cb189-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">border =</span> <span class="st">&quot;black&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="uso-paquete-ggplot" class="section level3 hasAnchor" number="2.7.2">
<h3 class="hasAnchor"><span class="header-section-number">2.7.2</span> Uso paquete ggplot<a href="#uso-paquete-ggplot" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Ahora vamos a utilizar un paquete avanzado de visualización. Primero, algunos aspectos relacionados con la lógica de su uso.</p>
<ol style="list-style-type: decimal">
<li>Utilizar <code>ggplot2</code> es básicamente ir agregando capas. Entre cada cosa que quiero agregar al gráfico debo colocar un signo <code>+</code>.</li>
<li>La sintaxis básica incluye:</li>
</ol>
<ul>
<li><ol style="list-style-type: lower-alpha">
<li>Comience con el comando <code>ggplot()</code> de la línea de base, esto “abre” el ggplot y permite que las funciones subsecuentes sean agregadas con <code>+</code>. Normalmente el conjunto de datos también se especifica en este comando.</li>
</ol></li>
<li><ol start="2" style="list-style-type: lower-alpha">
<li>Añadir capas “geom”, estas funciones visualizan los datos como geometrías (formas), por ejemplo, como un gráfico de barras, un gráfico de líneas, un gráfico de dispersión, un histograma (¡o una combinación!). Todas estas funciones comienzan con <code>geom_</code> como prefijo.</li>
</ol></li>
<li><ol start="3" style="list-style-type: lower-alpha">
<li>Añade elementos de diseño al gráfico, como etiquetas de ejes, títulos, fuentes, tamaños, esquemas de color, leyendas o rotación de ejes.</li>
</ol></li>
</ul>
<p>Ejemplo:</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(datos, <span class="fu">aes</span>(<span class="at">x =</span> experience, <span class="at">y =</span> wage)) <span class="sc">+</span>                               </span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>( <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span>                          </span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>()<span class="sc">+</span>                                    </span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>()  </span></code></pre></div>
<p>Ahora ya entendemos la sintaxis general. Para cambiar de tipo de gráficos tenemos distintas geometrías.</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_point (para puntos)</span></span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_line (para lineas)</span></span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_histogram (para histograma)</span></span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_boxplot (para boxplot)</span></span>
<span id="cb191-5"><a href="#cb191-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_bar o geom_col() (para barras)</span></span>
<span id="cb191-6"><a href="#cb191-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_smooth (lineas suavizadas)</span></span></code></pre></div>
<div id="geometrías" class="section level4 hasAnchor" number="2.7.2.1">
<h4 class="hasAnchor"><span class="header-section-number">2.7.2.1</span> Geometrías<a href="#geometrías" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Otros tienen más sentido con una variable</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(datos, <span class="fu">aes</span>(<span class="at">x =</span> experience))<span class="sc">+</span>                               </span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>() <span class="sc">+</span>                         </span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>()<span class="sc">+</span>                                   </span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>() </span>
<span id="cb192-5"><a href="#cb192-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-6"><a href="#cb192-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(datos, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> experience, <span class="at">y =</span> wage))<span class="sc">+</span>                               </span>
<span id="cb192-7"><a href="#cb192-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span>                         </span>
<span id="cb192-8"><a href="#cb192-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>()<span class="sc">+</span>                                   </span>
<span id="cb192-9"><a href="#cb192-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>() </span></code></pre></div>
</div>
<div id="aesthetics" class="section level4 hasAnchor" number="2.7.2.2">
<h4 class="hasAnchor"><span class="header-section-number">2.7.2.2</span> Aesthetics<a href="#aesthetics" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Otro aspecto importante es lo que se denomina “aesthetics”. Estas son las características visuales de los datos. En ggplot estos son modificados dentro de la opción <code>theme()</code>. No todas las geometrías tienen las mismas opciones. Sin embargo, algunas comunes son:</p>
<ul>
<li><code>shape</code>: Mostrar un punto con <code>geom_point()</code> como punto, estrella, triángulo o cuadrado.</li>
<li><code>fill</code>: El color interior (por ejemplo, de una barra o boxplot)</li>
<li><code>color</code>: La línea exterior de una barra, boxplot, etc., o el color del punto si se utiliza <code>geom_point()</code></li>
<li><code>size</code>: Tamaño (por ejemplo, grosor de la línea, tamaño del punto)</li>
<li><code>alpha</code>: Transparencia (1 = opaco, 0 = invisible)</li>
<li><code>binwidtho</code>: Ancho de los bins o cajas del histograma</li>
<li><code>width</code>: Anchura de las columnas del “bar plot”.</li>
<li><code>linetype</code>: Tipo de línea (por ejemplo, sólida, discontinua, punteada)</li>
</ul>
<p>Los “aesthetics” pueden ser asignados a valores o a vectores.</p>
<p>Ejemplo:</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualización de puntos </span></span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(datos, <span class="fu">aes</span>(<span class="at">x =</span> experience, <span class="at">y =</span> wage))<span class="sc">+</span>                               </span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;darkgreen&quot;</span>,</span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">size  =</span> <span class="fl">2.8</span>, </span>
<span id="cb193-5"><a href="#cb193-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span> <span class="fu">theme</span>()</span>
<span id="cb193-6"><a href="#cb193-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-7"><a href="#cb193-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Histograma </span></span>
<span id="cb193-8"><a href="#cb193-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(datos, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> wage))<span class="sc">+</span>                               </span>
<span id="cb193-9"><a href="#cb193-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color =</span> <span class="st">&quot;white&quot;</span>, </span>
<span id="cb193-10"><a href="#cb193-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill  =</span> <span class="st">&quot;pink&quot;</span>, </span>
<span id="cb193-11"><a href="#cb193-11" aria-hidden="true" tabindex="-1"></a>                 <span class="at">binwidth =</span> <span class="dv">5</span> , </span>
<span id="cb193-12"><a href="#cb193-12" aria-hidden="true" tabindex="-1"></a>                 <span class="at">alpha =</span> <span class="dv">1</span>)</span></code></pre></div>
</div>
<div id="escalar-los-valores-o-agrupar" class="section level4 hasAnchor" number="2.7.2.3">
<h4 class="hasAnchor"><span class="header-section-number">2.7.2.3</span> Escalar los valores o agrupar<a href="#escalar-los-valores-o-agrupar" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Si queremos diferenciar alguna variable categorica por color (agrupar)</span></span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(datos, <span class="fu">aes</span>(experience, wage, <span class="at">color =</span> gender)) <span class="sc">+</span> </span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5"><a href="#cb194-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Si queremos diferenciar alguna variable continua por tamaño (escalar)</span></span>
<span id="cb194-6"><a href="#cb194-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(datos, <span class="fu">aes</span>(<span class="at">x =</span> experience,</span>
<span id="cb194-7"><a href="#cb194-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y =</span> wage,</span>
<span id="cb194-8"><a href="#cb194-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">size =</span> age)) <span class="sc">+</span> </span>
<span id="cb194-9"><a href="#cb194-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="st">&quot;circle&quot;</span>,</span>
<span id="cb194-10"><a href="#cb194-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.3</span>)</span>
<span id="cb194-11"><a href="#cb194-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-12"><a href="#cb194-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Ambos (agrupar y escalar)</span></span>
<span id="cb194-13"><a href="#cb194-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> datos, </span>
<span id="cb194-14"><a href="#cb194-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> experience,</span>
<span id="cb194-15"><a href="#cb194-15" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> wage,</span>
<span id="cb194-16"><a href="#cb194-16" aria-hidden="true" tabindex="-1"></a>                     <span class="at">size =</span> age,</span>
<span id="cb194-17"><a href="#cb194-17" aria-hidden="true" tabindex="-1"></a>                     <span class="at">color =</span> gender)) <span class="sc">+</span> </span>
<span id="cb194-18"><a href="#cb194-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="st">&quot;circle&quot;</span>,</span>
<span id="cb194-19"><a href="#cb194-19" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.3</span>)</span></code></pre></div>
</div>
<div id="equivalencia-sintaxis-ggplot" class="section level4 hasAnchor" number="2.7.2.4">
<h4 class="hasAnchor"><span class="header-section-number">2.7.2.4</span> Equivalencia sintaxis ggplot<a href="#equivalencia-sintaxis-ggplot" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Notar que estas tres sintaxis son equivalentes</span></span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> datos, </span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age))<span class="sc">+</span></span>
<span id="cb195-4"><a href="#cb195-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()</span>
<span id="cb195-5"><a href="#cb195-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-6"><a href="#cb195-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> datos)<span class="sc">+</span></span>
<span id="cb195-7"><a href="#cb195-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age))</span>
<span id="cb195-8"><a href="#cb195-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-9"><a href="#cb195-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb195-10"><a href="#cb195-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">data =</span> datos, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age))</span></code></pre></div>
</div>
<div id="combinar-gráficos" class="section level4 hasAnchor" number="2.7.2.5">
<h4 class="hasAnchor"><span class="header-section-number">2.7.2.5</span> Combinar gráficos<a href="#combinar-gráficos" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>facet_wrap()</code>: Mostrar un panel diferente para cada nivel de una sola variable. Un ejemplo de esto podría ser mostrar una figura diferente para cada region de un país. Las facetas se ordenan alfabéticamente, a menos que la variable sea un factor con otro ordenamiento definido. Por ejemplo:</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Datos </span></span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a>malaria_data <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="fu">here</span>(<span class="st">&quot;datos&quot;</span>, <span class="st">&quot;malaria_facility_count_data.rds&quot;</span>)) <span class="sc">%&gt;%</span>  </span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>submitted_date, <span class="sc">-</span>Province, <span class="sc">-</span>newid)                                 </span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-5"><a href="#cb196-5" aria-hidden="true" tabindex="-1"></a><span class="co"># A plot with facets by district</span></span>
<span id="cb196-6"><a href="#cb196-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(malaria_data, <span class="fu">aes</span>(<span class="at">x =</span> data_date, <span class="at">y =</span> malaria_tot)) <span class="sc">+</span></span>
<span id="cb196-7"><a href="#cb196-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="dv">1</span>, <span class="at">fill =</span> <span class="st">&quot;darkred&quot;</span>) <span class="sc">+</span>   <span class="co"># graficamos datos como columnas</span></span>
<span id="cb196-8"><a href="#cb196-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span>         <span class="co"># simplificamos la parte de atras</span></span>
<span id="cb196-9"><a href="#cb196-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Fecha&quot;</span>,         <span class="co">#Etiquetas/labels</span></span>
<span id="cb196-10"><a href="#cb196-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">&quot;Casos de Malaria&quot;</span>,</span>
<span id="cb196-11"><a href="#cb196-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> <span class="st">&quot;Casos de Malaria por distrito&quot;</span>) <span class="sc">+</span></span>
<span id="cb196-12"><a href="#cb196-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>District)   <span class="co"># creamos las facetas</span></span></code></pre></div>
<p><code>facet_grid()</code>: Se utiliza cuando se quiere introducir una segunda variable en la disposición de las facetas. Aquí cada panel de una cuadrícula muestra la intersección entre los valores de dos columnas. Por ejemplo:</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a>malaria_age <span class="ot">&lt;-</span> malaria_data <span class="sc">%&gt;%</span></span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>malaria_tot) <span class="sc">%&gt;%</span> </span>
<span id="cb197-3"><a href="#cb197-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb197-4"><a href="#cb197-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(<span class="fu">starts_with</span>(<span class="st">&quot;malaria_rdt_&quot;</span>)),  </span>
<span id="cb197-5"><a href="#cb197-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;grupo_edad&quot;</span>,      </span>
<span id="cb197-6"><a href="#cb197-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;num_casos&quot;</span>      </span>
<span id="cb197-7"><a href="#cb197-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb197-8"><a href="#cb197-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb197-9"><a href="#cb197-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_group =</span> <span class="fu">str_replace</span>(grupo_edad, <span class="st">&quot;malaria_rdt_&quot;</span>, <span class="st">&quot;&quot;</span>))</span>
<span id="cb197-10"><a href="#cb197-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-11"><a href="#cb197-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(malaria_age, <span class="fu">aes</span>(<span class="at">x =</span> data_date, <span class="at">y =</span> num_casos)) <span class="sc">+</span></span>
<span id="cb197-12"><a href="#cb197-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">&quot;darkred&quot;</span>, <span class="at">width =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb197-13"><a href="#cb197-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb197-14"><a href="#cb197-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( </span>
<span id="cb197-15"><a href="#cb197-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Fechas&quot;</span>,</span>
<span id="cb197-16"><a href="#cb197-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Casos&quot;</span>,</span>
<span id="cb197-17"><a href="#cb197-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Casos de Malaria por grupos de edad y distrito&quot;</span>) <span class="sc">+</span></span>
<span id="cb197-18"><a href="#cb197-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(District <span class="sc">~</span> age_group)</span></code></pre></div>
</div>
<div id="modificar-y-guardar" class="section level4 hasAnchor" number="2.7.2.6">
<h4 class="hasAnchor"><span class="header-section-number">2.7.2.6</span> Modificar y guardar<a href="#modificar-y-guardar" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Modificar graficos: Una cosa muy positiva de <code>ggplot()</code> es que uno puede definirlo con un nombre y luego ir sobre-escribiendolo. Eso es muy útil para la sintaxis.</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico original </span></span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a>histograma <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> datos, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age))<span class="sc">+</span></span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a>              <span class="fu">geom_histogram</span>()</span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a>histograma</span>
<span id="cb198-5"><a href="#cb198-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-6"><a href="#cb198-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico modificado. </span></span>
<span id="cb198-7"><a href="#cb198-7" aria-hidden="true" tabindex="-1"></a>histograma_modificado <span class="ot">&lt;-</span> histograma <span class="sc">+</span></span>
<span id="cb198-8"><a href="#cb198-8" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">50</span>)</span>
<span id="cb198-9"><a href="#cb198-9" aria-hidden="true" tabindex="-1"></a>histograma_modificado</span>
<span id="cb198-10"><a href="#cb198-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Noten que solamente hemos agregado la nueva opción sobre el objeto asignado. </span></span>
<span id="cb198-11"><a href="#cb198-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Muy útil y recomendable para hacer visualizaciones en R. </span></span></code></pre></div>
<p>Exportar gráficos: Para los gráfico que se generen con <code>ggplot()</code> es posible utilizar la opción <code>ggsave()</code>.</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">here</span>(<span class="st">&quot;figuras&quot;</span>, <span class="st">&quot;histograma.pdf&quot;</span>), histograma_modificado)</span></code></pre></div>
</div>
<div id="labels" class="section level4 hasAnchor" number="2.7.2.7">
<h4 class="hasAnchor"><span class="header-section-number">2.7.2.7</span> Labels<a href="#labels" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a>distribucion_salarios <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> datos,      <span class="co"># datos</span></span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mapping =</span> <span class="fu">aes</span>(     <span class="co"># ejes</span></span>
<span id="cb200-4"><a href="#cb200-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> age,                        </span>
<span id="cb200-5"><a href="#cb200-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> wage,         </span>
<span id="cb200-6"><a href="#cb200-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> occupation))<span class="sc">+</span>     <span class="co"># agrupo</span></span>
<span id="cb200-7"><a href="#cb200-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span>               <span class="co"># geometria</span></span>
<span id="cb200-8"><a href="#cb200-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb200-9"><a href="#cb200-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Salarios por edad&quot;</span>,</span>
<span id="cb200-10"><a href="#cb200-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Estados Unidos, 1985&quot;</span>,</span>
<span id="cb200-11"><a href="#cb200-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Edad en años&quot;</span>,</span>
<span id="cb200-12"><a href="#cb200-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Salario en dólares por hora&quot;</span>,</span>
<span id="cb200-13"><a href="#cb200-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;Ocupación&quot;</span>,</span>
<span id="cb200-14"><a href="#cb200-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> stringr<span class="sc">::</span><span class="fu">str_glue</span>(<span class="st">&quot;Maxima edad es: {max(datos$age, na.rm=TRUE)}&quot;</span>))</span>
<span id="cb200-15"><a href="#cb200-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-16"><a href="#cb200-16" aria-hidden="true" tabindex="-1"></a>distribucion_salarios</span></code></pre></div>
</div>
<div id="temas" class="section level4 hasAnchor" number="2.7.2.8">
<h4 class="hasAnchor"><span class="header-section-number">2.7.2.8</span> Temas<a href="#temas" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Clasico </span></span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a>distribucion_salarios <span class="sc">+</span> <span class="fu">theme_classic</span>()</span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-4"><a href="#cb201-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Mínimo </span></span>
<span id="cb201-5"><a href="#cb201-5" aria-hidden="true" tabindex="-1"></a>distribucion_salarios <span class="sc">+</span> <span class="fu">theme_minimal</span>()</span>
<span id="cb201-6"><a href="#cb201-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-7"><a href="#cb201-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Oscuro </span></span>
<span id="cb201-8"><a href="#cb201-8" aria-hidden="true" tabindex="-1"></a>distribucion_salarios <span class="sc">+</span> <span class="fu">theme_dark</span>()</span>
<span id="cb201-9"><a href="#cb201-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-10"><a href="#cb201-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Claro</span></span>
<span id="cb201-11"><a href="#cb201-11" aria-hidden="true" tabindex="-1"></a>distribucion_salarios <span class="sc">+</span> <span class="fu">theme_light</span>()</span>
<span id="cb201-12"><a href="#cb201-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-13"><a href="#cb201-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Gris </span></span>
<span id="cb201-14"><a href="#cb201-14" aria-hidden="true" tabindex="-1"></a>distribucion_salarios <span class="sc">+</span> <span class="fu">theme_grey</span>()</span>
<span id="cb201-15"><a href="#cb201-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-16"><a href="#cb201-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Blanco y negro </span></span>
<span id="cb201-17"><a href="#cb201-17" aria-hidden="true" tabindex="-1"></a>distribucion_salarios <span class="sc">+</span> <span class="fu">theme_bw</span>()</span></code></pre></div>
</div>
<div id="piping-y-ggplot" class="section level4 hasAnchor" number="2.7.2.9">
<h4 class="hasAnchor"><span class="header-section-number">2.7.2.9</span> Piping y ggplot<a href="#piping-y-ggplot" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a>  datos <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="fu">here</span>(<span class="st">&quot;datos&quot;</span>, <span class="st">&quot;linelist_cleaned.rds&quot;</span>))</span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb202-4"><a href="#cb202-4" aria-hidden="true" tabindex="-1"></a>  datos <span class="sc">%&gt;%</span>                                                     </span>
<span id="cb202-5"><a href="#cb202-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">c</span>(case_id, fever, chills, cough, aches, vomit)) <span class="sc">%&gt;%</span>    </span>
<span id="cb202-6"><a href="#cb202-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(                                                 </span>
<span id="cb202-7"><a href="#cb202-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">cols =</span> <span class="sc">-</span>case_id,                                  </span>
<span id="cb202-8"><a href="#cb202-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">names_to =</span> <span class="st">&quot;symptom_name&quot;</span>,</span>
<span id="cb202-9"><a href="#cb202-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">values_to =</span> <span class="st">&quot;symptom_is_present&quot;</span>)<span class="sc">%&gt;%</span></span>
<span id="cb202-10"><a href="#cb202-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(                                                      </span>
<span id="cb202-11"><a href="#cb202-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">symptom_is_present =</span> <span class="fu">replace_na</span>(symptom_is_present, <span class="st">&quot;unknown&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb202-12"><a href="#cb202-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggplot</span>(                                                        </span>
<span id="cb202-13"><a href="#cb202-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> symptom_name, <span class="at">fill =</span> symptom_is_present))<span class="sc">+</span></span>
<span id="cb202-14"><a href="#cb202-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">&quot;fill&quot;</span>, <span class="at">col =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span>                    </span>
<span id="cb202-15"><a href="#cb202-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb202-16"><a href="#cb202-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb202-17"><a href="#cb202-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">&quot;Sintoma&quot;</span>,</span>
<span id="cb202-18"><a href="#cb202-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">&quot;Sintoma (status)&quot;</span></span>
<span id="cb202-19"><a href="#cb202-19" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
</div>
<div id="gráficos-para-variables-continuas" class="section level4 hasAnchor" number="2.7.2.10">
<h4 class="hasAnchor"><span class="header-section-number">2.7.2.10</span> Gráficos para variables continuas<a href="#gráficos-para-variables-continuas" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Histograma:</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;CPS1985&quot;</span>)</span>
<span id="cb203-3"><a href="#cb203-3" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> CPS1985</span>
<span id="cb203-4"><a href="#cb203-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(CPS1985)</span>
<span id="cb203-5"><a href="#cb203-5" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(data)</span>
<span id="cb203-6"><a href="#cb203-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-7"><a href="#cb203-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Gráfico absoluto</span></span>
<span id="cb203-8"><a href="#cb203-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x=</span>wage)) <span class="sc">+</span> </span>
<span id="cb203-9"><a href="#cb203-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()</span>
<span id="cb203-10"><a href="#cb203-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-11"><a href="#cb203-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Gráfico relativo</span></span>
<span id="cb203-12"><a href="#cb203-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x=</span>wage)) <span class="sc">+</span> </span>
<span id="cb203-13"><a href="#cb203-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y=</span>..density..))</span>
<span id="cb203-14"><a href="#cb203-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-15"><a href="#cb203-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Histograma con 20 intervalos</span></span>
<span id="cb203-16"><a href="#cb203-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x=</span>wage)) <span class="sc">+</span> </span>
<span id="cb203-17"><a href="#cb203-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">100</span>, </span>
<span id="cb203-18"><a href="#cb203-18" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color=</span><span class="st">&quot;black&quot;</span>, </span>
<span id="cb203-19"><a href="#cb203-19" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill=</span><span class="st">&quot;blue&quot;</span>, </span>
<span id="cb203-20"><a href="#cb203-20" aria-hidden="true" tabindex="-1"></a>                 <span class="at">alpha =</span> <span class="fl">0.8</span>)</span>
<span id="cb203-21"><a href="#cb203-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-22"><a href="#cb203-22" aria-hidden="true" tabindex="-1"></a><span class="co">#Agregando títulos y limites</span></span>
<span id="cb203-23"><a href="#cb203-23" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x=</span>wage)) <span class="sc">+</span> </span>
<span id="cb203-24"><a href="#cb203-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">20</span>, <span class="at">color=</span><span class="st">&quot;white&quot;</span>, <span class="at">fill=</span><span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb203-25"><a href="#cb203-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Distribución del salario (dólares por hora)&quot;</span>,</span>
<span id="cb203-26"><a href="#cb203-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Salario&quot;</span>,</span>
<span id="cb203-27"><a href="#cb203-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Número de empleados&quot;</span>) <span class="sc">+</span> </span>
<span id="cb203-28"><a href="#cb203-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>,<span class="dv">30</span>)</span>
<span id="cb203-29"><a href="#cb203-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-30"><a href="#cb203-30" aria-hidden="true" tabindex="-1"></a><span class="co">#Gráficos de subconjuntos</span></span>
<span id="cb203-31"><a href="#cb203-31" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x=</span>wage)) <span class="sc">+</span> </span>
<span id="cb203-32"><a href="#cb203-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">20</span>, <span class="at">color=</span><span class="st">&quot;white&quot;</span>, <span class="at">fill=</span><span class="st">&quot;pink&quot;</span>) <span class="sc">+</span></span>
<span id="cb203-33"><a href="#cb203-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(gender<span class="sc">~</span>.)</span>
<span id="cb203-34"><a href="#cb203-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-35"><a href="#cb203-35" aria-hidden="true" tabindex="-1"></a><span class="co"># U horizontal</span></span>
<span id="cb203-36"><a href="#cb203-36" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x=</span>wage)) <span class="sc">+</span> </span>
<span id="cb203-37"><a href="#cb203-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">20</span>, <span class="at">color=</span><span class="st">&quot;white&quot;</span>, <span class="at">fill=</span><span class="st">&quot;pink&quot;</span>) <span class="sc">+</span></span>
<span id="cb203-38"><a href="#cb203-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>gender)<span class="sc">+</span></span>
<span id="cb203-39"><a href="#cb203-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Distribución del salario (dólares por hora)&quot;</span>,</span>
<span id="cb203-40"><a href="#cb203-40" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Salario&quot;</span>,</span>
<span id="cb203-41"><a href="#cb203-41" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Número de empleados&quot;</span>) <span class="sc">+</span> <span class="fu">xlim</span>(<span class="dv">0</span>,<span class="dv">30</span>) <span class="sc">+</span> <span class="fu">theme_minimal</span>()</span>
<span id="cb203-42"><a href="#cb203-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-43"><a href="#cb203-43" aria-hidden="true" tabindex="-1"></a><span class="co"># O ambos juntos </span></span>
<span id="cb203-44"><a href="#cb203-44" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x=</span>wage)) <span class="sc">+</span></span>
<span id="cb203-45"><a href="#cb203-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">20</span>, <span class="fu">aes</span>(<span class="at">fill=</span>gender), </span>
<span id="cb203-46"><a href="#cb203-46" aria-hidden="true" tabindex="-1"></a>                 <span class="at">position=</span><span class="st">&quot;fill&quot;</span>, </span>
<span id="cb203-47"><a href="#cb203-47" aria-hidden="true" tabindex="-1"></a>                 <span class="at">alpha=</span><span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb203-48"><a href="#cb203-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Distribución del salario (dólares por hora)&quot;</span>,</span>
<span id="cb203-49"><a href="#cb203-49" aria-hidden="true" tabindex="-1"></a>       <span class="at">x=</span> <span class="st">&quot;Salario&quot;</span>, </span>
<span id="cb203-50"><a href="#cb203-50" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">&quot;Empleados&quot;</span>, </span>
<span id="cb203-51"><a href="#cb203-51" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill=</span><span class="st">&quot;Género&quot;</span>) <span class="sc">+</span>  <span class="co"># títulos de ejes y leyenda</span></span>
<span id="cb203-52"><a href="#cb203-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_discrete</span>(<span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Hombre&quot;</span>,<span class="st">&quot;Mujer&quot;</span>)) <span class="sc">+</span>    <span class="co"># títulos claves leyenda</span></span>
<span id="cb203-53"><a href="#cb203-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>,<span class="dv">30</span>)</span></code></pre></div>
<p>Gráfico de densidad:</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x=</span>wage, <span class="at">color=</span>gender)) <span class="sc">+</span></span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_freqpoly</span>(<span class="at">bins=</span><span class="dv">20</span>, <span class="fu">aes</span>(<span class="at">y=</span>..density..)) <span class="sc">+</span></span>
<span id="cb204-3"><a href="#cb204-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">&quot;Género&quot;</span>)</span>
<span id="cb204-4"><a href="#cb204-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-5"><a href="#cb204-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Uniendo a y b</span></span>
<span id="cb204-6"><a href="#cb204-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x=</span>wage)) <span class="sc">+</span> </span>
<span id="cb204-7"><a href="#cb204-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y=</span>..density..), </span>
<span id="cb204-8"><a href="#cb204-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">bins=</span><span class="dv">20</span>, </span>
<span id="cb204-9"><a href="#cb204-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color=</span><span class="st">&quot;white&quot;</span>, </span>
<span id="cb204-10"><a href="#cb204-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill=</span><span class="st">&quot;pink&quot;</span>) <span class="sc">+</span> </span>
<span id="cb204-11"><a href="#cb204-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#stat_function(fun = dnorm, colour = &quot;red&quot;,</span></span>
<span id="cb204-12"><a href="#cb204-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#              args = list(mean = mean(wage, na.rm = TRUE),</span></span>
<span id="cb204-13"><a href="#cb204-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                          sd = sd(wage, na.rm = TRUE))) +</span></span>
<span id="cb204-14"><a href="#cb204-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">color=</span><span class="st">&quot;blue&quot;</span>)<span class="sc">+</span></span>
<span id="cb204-15"><a href="#cb204-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Distribución del salario (dólares por hora)&quot;</span>,</span>
<span id="cb204-16"><a href="#cb204-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">x=</span> <span class="st">&quot;Salario&quot;</span>, </span>
<span id="cb204-17"><a href="#cb204-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">&quot;Empleados&quot;</span>)</span></code></pre></div>
<p>Diagrama de dispersión (scatterplot):</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(experience, <span class="fu">log</span>(wage))) <span class="sc">+</span></span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Diagrama de dispersión&quot;</span>,</span>
<span id="cb205-4"><a href="#cb205-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle=</span> <span class="st">&quot;ScatterPlot&quot;</span>,</span>
<span id="cb205-5"><a href="#cb205-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption=</span><span class="st">&quot;Fuente: CPS1985 (paquete AER)&quot;</span>,</span>
<span id="cb205-6"><a href="#cb205-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">x=</span><span class="st">&quot;Experiencia (en años)&quot;</span>,</span>
<span id="cb205-7"><a href="#cb205-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">&quot;Salario (en logaritmo)&quot;</span>)</span>
<span id="cb205-8"><a href="#cb205-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-9"><a href="#cb205-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Formas de darle color al gráfico</span></span>
<span id="cb205-10"><a href="#cb205-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-11"><a href="#cb205-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># (1) Desde geom_()</span></span>
<span id="cb205-12"><a href="#cb205-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(experience, <span class="fu">log</span>(wage))) <span class="sc">+</span></span>
<span id="cb205-13"><a href="#cb205-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>gender))</span>
<span id="cb205-14"><a href="#cb205-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-15"><a href="#cb205-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># (2) Desde ggplot()</span></span>
<span id="cb205-16"><a href="#cb205-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(experience, <span class="fu">log</span>(wage), <span class="at">color=</span><span class="st">&quot;red&quot;</span>)) <span class="sc">+</span></span>
<span id="cb205-17"><a href="#cb205-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>()</span>
<span id="cb205-18"><a href="#cb205-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-19"><a href="#cb205-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Función jitter (shortcut geom_point(position = &quot;jitter&quot;)</span></span>
<span id="cb205-20"><a href="#cb205-20" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(experience,<span class="fu">log</span>(wage))) <span class="sc">+</span></span>
<span id="cb205-21"><a href="#cb205-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width=</span>.<span class="dv">2</span>, <span class="at">alpha=</span><span class="fl">0.5</span>) <span class="sc">+</span>               <span class="co">#Suavizar la visualización de solapamiento</span></span>
<span id="cb205-22"><a href="#cb205-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Diagrama de dispersión&quot;</span>,</span>
<span id="cb205-23"><a href="#cb205-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle=</span> <span class="st">&quot;ScatterPlot&quot;</span>,</span>
<span id="cb205-24"><a href="#cb205-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption=</span><span class="st">&quot;Fuente: CPS1985 (paquete AER)&quot;</span>,</span>
<span id="cb205-25"><a href="#cb205-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">x=</span><span class="st">&quot;Experiencia (en años)&quot;</span>,</span>
<span id="cb205-26"><a href="#cb205-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">&quot;Salario (en logaritmo)&quot;</span>)</span>
<span id="cb205-27"><a href="#cb205-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-28"><a href="#cb205-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Diviendo por categorías</span></span>
<span id="cb205-29"><a href="#cb205-29" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(experience,<span class="fu">log</span>(wage), <span class="at">color=</span>gender)) <span class="sc">+</span></span>
<span id="cb205-30"><a href="#cb205-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>() <span class="sc">+</span></span>
<span id="cb205-31"><a href="#cb205-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&quot;lm&quot;</span>) <span class="sc">+</span> </span>
<span id="cb205-32"><a href="#cb205-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Diagrama de dispersión&quot;</span>,</span>
<span id="cb205-33"><a href="#cb205-33" aria-hidden="true" tabindex="-1"></a>       <span class="at">x=</span><span class="st">&quot;Experiencia (en años)&quot;</span>,</span>
<span id="cb205-34"><a href="#cb205-34" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">&quot;Salario (en logaritmo)&quot;</span>) <span class="sc">+</span></span>
<span id="cb205-35"><a href="#cb205-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">name=</span><span class="st">&quot;Género&quot;</span>, <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Hombre&quot;</span>,<span class="st">&quot;Mujer&quot;</span>))</span>
<span id="cb205-36"><a href="#cb205-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-37"><a href="#cb205-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Nota: Ojo con realizar de otra manera, cambia la recta de regresión</span></span>
<span id="cb205-38"><a href="#cb205-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-39"><a href="#cb205-39" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(experience,<span class="fu">log</span>(wage))) <span class="sc">+</span></span>
<span id="cb205-40"><a href="#cb205-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>gender)) <span class="sc">+</span></span>
<span id="cb205-41"><a href="#cb205-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&quot;lm&quot;</span>) <span class="sc">+</span></span>
<span id="cb205-42"><a href="#cb205-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Diagrama de dispersión&quot;</span>,</span>
<span id="cb205-43"><a href="#cb205-43" aria-hidden="true" tabindex="-1"></a>       <span class="at">x=</span><span class="st">&quot;Experiencia (en años)&quot;</span>,</span>
<span id="cb205-44"><a href="#cb205-44" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">&quot;Salario (en logaritmo)&quot;</span>) <span class="sc">+</span></span>
<span id="cb205-45"><a href="#cb205-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="st">&quot;Género&quot;</span>, <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Hombre&quot;</span>,<span class="st">&quot;Mujer&quot;</span>))</span></code></pre></div>
<p>Boxplot:</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Básico</span></span>
<span id="cb206-2"><a href="#cb206-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x=</span>gender, <span class="at">y=</span>wage, <span class="at">fill=</span>gender)) <span class="sc">+</span></span>
<span id="cb206-3"><a href="#cb206-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb206-4"><a href="#cb206-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Boxplot&quot;</span>,</span>
<span id="cb206-5"><a href="#cb206-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x=</span><span class="st">&quot;Género&quot;</span>, </span>
<span id="cb206-6"><a href="#cb206-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">&quot;Salario&quot;</span>, </span>
<span id="cb206-7"><a href="#cb206-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill=</span><span class="st">&quot;Género&quot;</span>) <span class="sc">+</span>   <span class="co"># titulo ejes y leyenda</span></span>
<span id="cb206-8"><a href="#cb206-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Hombre&quot;</span>,<span class="st">&quot;Mujer&quot;</span>)) <span class="sc">+</span>   <span class="co"># etiquetas del eje x</span></span>
<span id="cb206-9"><a href="#cb206-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_discrete</span>(<span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Hombre&quot;</span>,<span class="st">&quot;Mujer&quot;</span>))  <span class="co"># etiquetas claves leyenda</span></span>
<span id="cb206-10"><a href="#cb206-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-11"><a href="#cb206-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Visualizando todos los datos con paletas creadas (armamos una función)</span></span>
<span id="cb206-12"><a href="#cb206-12" aria-hidden="true" tabindex="-1"></a>ts4_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb206-13"><a href="#cb206-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">pink</span><span class="st">`</span>        <span class="ot">=</span> <span class="st">&quot;#B40586&quot;</span>,</span>
<span id="cb206-14"><a href="#cb206-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">light blue</span><span class="st">`</span>       <span class="ot">=</span> <span class="st">&quot;#00A2E9&quot;</span>,</span>
<span id="cb206-15"><a href="#cb206-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">green</span><span class="st">`</span>      <span class="ot">=</span> <span class="st">&quot;#00AC8B&quot;</span>,</span>
<span id="cb206-16"><a href="#cb206-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">orange</span><span class="st">`</span>     <span class="ot">=</span> <span class="st">&quot;#f37735&quot;</span>,</span>
<span id="cb206-17"><a href="#cb206-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">red</span><span class="st">`</span>     <span class="ot">=</span> <span class="st">&quot;#FF1B6B&quot;</span>,</span>
<span id="cb206-18"><a href="#cb206-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">purple</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;#805FAA&quot;</span>,</span>
<span id="cb206-19"><a href="#cb206-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">blue</span><span class="st">`</span>  <span class="ot">=</span> <span class="st">&quot;#0059ff&quot;</span>,</span>
<span id="cb206-20"><a href="#cb206-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">light green</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;#7EAF64&quot;</span>)</span>
<span id="cb206-21"><a href="#cb206-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-22"><a href="#cb206-22" aria-hidden="true" tabindex="-1"></a>ts4_cols <span class="ot">&lt;-</span> <span class="cf">function</span>(...) {</span>
<span id="cb206-23"><a href="#cb206-23" aria-hidden="true" tabindex="-1"></a>  cols <span class="ot">&lt;-</span> <span class="fu">c</span>(...)</span>
<span id="cb206-24"><a href="#cb206-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(cols)){</span>
<span id="cb206-25"><a href="#cb206-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span> (ts4_colors)</span>
<span id="cb206-26"><a href="#cb206-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb206-27"><a href="#cb206-27" aria-hidden="true" tabindex="-1"></a>  ts4_colors[cols]</span>
<span id="cb206-28"><a href="#cb206-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb206-29"><a href="#cb206-29" aria-hidden="true" tabindex="-1"></a><span class="fu">ts4_cols</span>(<span class="st">&quot;red&quot;</span>)</span>
<span id="cb206-30"><a href="#cb206-30" aria-hidden="true" tabindex="-1"></a><span class="fu">ts4_cols</span>()</span>
<span id="cb206-31"><a href="#cb206-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-32"><a href="#cb206-32" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x=</span>gender, <span class="at">y=</span>wage, <span class="at">fill=</span>gender) ) <span class="sc">+</span></span>
<span id="cb206-33"><a href="#cb206-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">alpha=</span><span class="fl">0.3</span>, </span>
<span id="cb206-34"><a href="#cb206-34" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill=</span><span class="fu">ts4_cols</span>(<span class="st">&quot;pink&quot;</span>,<span class="st">&quot;light green&quot;</span>), </span>
<span id="cb206-35"><a href="#cb206-35" aria-hidden="true" tabindex="-1"></a>               <span class="at">outlier.colour =</span> <span class="fu">ts4_cols</span>(<span class="st">&quot;blue&quot;</span>)) <span class="sc">+</span></span>
<span id="cb206-36"><a href="#cb206-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Boxplot&quot;</span>,<span class="at">x=</span><span class="st">&quot;Género&quot;</span>, <span class="at">y=</span><span class="st">&quot;Salario&quot;</span>) <span class="sc">+</span></span>
<span id="cb206-37"><a href="#cb206-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Hombre&quot;</span>,<span class="st">&quot;Mujer&quot;</span>)) <span class="sc">+</span></span>
<span id="cb206-38"><a href="#cb206-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb206-39"><a href="#cb206-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span>              </span>
<span id="cb206-40"><a href="#cb206-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">stat=</span> <span class="st">&quot;summary&quot;</span>, <span class="at">shape=</span><span class="dv">16</span>, <span class="at">size=</span><span class="dv">4</span>, <span class="at">colour=</span><span class="fu">ts4_cols</span>(<span class="st">&quot;purple&quot;</span>)) <span class="sc">+</span></span>
<span id="cb206-41"><a href="#cb206-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">colour=</span><span class="fu">ts4_cols</span>(<span class="st">&quot;orange&quot;</span>))</span></code></pre></div>
<p>Gráfico de barras:</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(ethnicity)) <span class="sc">+</span></span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb207-3"><a href="#cb207-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Diagrama de barras&quot;</span>,</span>
<span id="cb207-4"><a href="#cb207-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">x=</span> <span class="st">&quot;Raza&quot;</span>,</span>
<span id="cb207-5"><a href="#cb207-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">&quot;Empleados&quot;</span>) <span class="sc">+</span></span>
<span id="cb207-6"><a href="#cb207-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Caucásico&quot;</span>, <span class="st">&quot;Hispano&quot;</span>, <span class="st">&quot;Otros&quot;</span>))</span>
<span id="cb207-7"><a href="#cb207-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-8"><a href="#cb207-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Distintos colores</span></span>
<span id="cb207-9"><a href="#cb207-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(ethnicity, <span class="at">fill=</span>ethnicity)) <span class="sc">+</span></span>
<span id="cb207-10"><a href="#cb207-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb207-11"><a href="#cb207-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Distribución de empleadores según etnia&quot;</span>,</span>
<span id="cb207-12"><a href="#cb207-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">x=</span> <span class="st">&quot;Raza&quot;</span>,</span>
<span id="cb207-13"><a href="#cb207-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">&quot;Empleados&quot;</span>) <span class="sc">+</span></span>
<span id="cb207-14"><a href="#cb207-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Caucásico&quot;</span>, <span class="st">&quot;Hispano&quot;</span>, <span class="st">&quot;Otros&quot;</span>)) <span class="sc">+</span> <span class="fu">guides</span>(<span class="at">fill=</span><span class="cn">FALSE</span>)  <span class="co"># Sin/con leyenda</span></span>
<span id="cb207-15"><a href="#cb207-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-16"><a href="#cb207-16" aria-hidden="true" tabindex="-1"></a><span class="co"># ¿Cómo se distribuye el género sobre la etnia?</span></span>
<span id="cb207-17"><a href="#cb207-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(ethnicity, <span class="at">fill=</span>gender)) <span class="sc">+</span></span>
<span id="cb207-18"><a href="#cb207-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb207-19"><a href="#cb207-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Diagrama de barras&quot;</span>,</span>
<span id="cb207-20"><a href="#cb207-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">x=</span> <span class="st">&quot;Etnia&quot;</span>,</span>
<span id="cb207-21"><a href="#cb207-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">&quot;Empleados&quot;</span>) <span class="sc">+</span></span>
<span id="cb207-22"><a href="#cb207-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Caucásico&quot;</span>, <span class="st">&quot;Hispano&quot;</span>, <span class="st">&quot;Otros&quot;</span>)) <span class="sc">+</span></span>
<span id="cb207-23"><a href="#cb207-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_discrete</span>(<span class="st">&quot;Género&quot;</span>, <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Hombre&quot;</span>,<span class="st">&quot;Mujer&quot;</span>))</span>
<span id="cb207-24"><a href="#cb207-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-25"><a href="#cb207-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Separado por género, pero paralelo</span></span>
<span id="cb207-26"><a href="#cb207-26" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(ethnicity, <span class="at">fill=</span>gender)) <span class="sc">+</span></span>
<span id="cb207-27"><a href="#cb207-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position=</span><span class="st">&quot;dodge&quot;</span>) <span class="sc">+</span>            <span class="co"># también: position=position_dodge()</span></span>
<span id="cb207-28"><a href="#cb207-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Distribución de empleadores según etnia&quot;</span>,</span>
<span id="cb207-29"><a href="#cb207-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">x=</span> <span class="st">&quot;Raza&quot;</span>,</span>
<span id="cb207-30"><a href="#cb207-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">&quot;Empleados&quot;</span>) <span class="sc">+</span></span>
<span id="cb207-31"><a href="#cb207-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Caucásico&quot;</span>, <span class="st">&quot;Hispano&quot;</span>, <span class="st">&quot;Otros&quot;</span>)) <span class="sc">+</span></span>
<span id="cb207-32"><a href="#cb207-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Accent&quot;</span>,                             <span class="co"># Definir la paleta manualmente </span></span>
<span id="cb207-33"><a href="#cb207-33" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;Género&quot;</span>,</span>
<span id="cb207-34"><a href="#cb207-34" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Hombre&quot;</span>,<span class="st">&quot;Mujer&quot;</span>))</span></code></pre></div>
</div>
<div id="gráficos-con-plotly" class="section level4 hasAnchor" number="2.7.2.11">
<h4 class="hasAnchor"><span class="header-section-number">2.7.2.11</span> Gráficos con plotly<a href="#gráficos-con-plotly" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Ejemplo 1:</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(ethnicity, <span class="at">fill=</span>gender)) <span class="sc">+</span></span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position=</span><span class="st">&quot;dodge&quot;</span>) <span class="sc">+</span>            <span class="co"># también: position=position_dodge()</span></span>
<span id="cb208-3"><a href="#cb208-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Distribución de empleadores según etnia&quot;</span>,</span>
<span id="cb208-4"><a href="#cb208-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">x=</span> <span class="st">&quot;Raza&quot;</span>,</span>
<span id="cb208-5"><a href="#cb208-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">&quot;Empleados&quot;</span>) <span class="sc">+</span></span>
<span id="cb208-6"><a href="#cb208-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Caucásico&quot;</span>, <span class="st">&quot;Hispano&quot;</span>, <span class="st">&quot;Otros&quot;</span>)) <span class="sc">+</span></span>
<span id="cb208-7"><a href="#cb208-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Accent&quot;</span>,     <span class="co">#Definir la paleta manualmente </span></span>
<span id="cb208-8"><a href="#cb208-8" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;Género&quot;</span>,</span>
<span id="cb208-9"><a href="#cb208-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Hombre&quot;</span>,<span class="st">&quot;Mujer&quot;</span>))</span>
<span id="cb208-10"><a href="#cb208-10" aria-hidden="true" tabindex="-1"></a>g1</span>
<span id="cb208-11"><a href="#cb208-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-12"><a href="#cb208-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(g1)</span></code></pre></div>
<p>Ejemplo 2:</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>) <span class="co">#semilla</span></span>
<span id="cb209-2"><a href="#cb209-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-3"><a href="#cb209-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> diamonds[<span class="fu">sample</span>(<span class="fu">nrow</span>(diamonds), <span class="dv">1000</span>), ]</span>
<span id="cb209-4"><a href="#cb209-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-5"><a href="#cb209-5" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> d, <span class="fu">aes</span>(<span class="at">x =</span> carat, <span class="at">y =</span> price)) <span class="sc">+</span></span>
<span id="cb209-6"><a href="#cb209-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">text =</span> <span class="fu">paste</span>(<span class="st">&quot;Clarity:&quot;</span>, clarity)), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb209-7"><a href="#cb209-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">colour =</span> cut, <span class="at">fill =</span> cut)) <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span> cut)</span>
<span id="cb209-8"><a href="#cb209-8" aria-hidden="true" tabindex="-1"></a>p</span>
<span id="cb209-9"><a href="#cb209-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-10"><a href="#cb209-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(p)</span></code></pre></div>
<div class="alert alert-block alert-danger">
<p><b>Recordatorio:</b> Set seed o sembrar la semilla nos permite generar datos seudo aleatorizados pero replicables, de manera que cualquier persona que acceda al script sea capaz de llegar a los mismos resultados que nosotros. El número que se incluye dentro de la función actua como un “código” que genera estos datos aleatorios, y puede ser cualquiera.</p>
</div>
<p>Ejemplo 3: Ocupar directamente plotly</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(iris)</span>
<span id="cb210-2"><a href="#cb210-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-3"><a href="#cb210-3" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(<span class="at">data =</span> iris, </span>
<span id="cb210-4"><a href="#cb210-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">x =</span> <span class="sc">~</span>Sepal.Length, </span>
<span id="cb210-5"><a href="#cb210-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">y =</span> <span class="sc">~</span>Petal.Length, </span>
<span id="cb210-6"><a href="#cb210-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">color=</span><span class="sc">~</span>Species)</span>
<span id="cb210-7"><a href="#cb210-7" aria-hidden="true" tabindex="-1"></a>fig</span>
<span id="cb210-8"><a href="#cb210-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-9"><a href="#cb210-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Sacar barra de opciones y zoom</span></span>
<span id="cb210-10"><a href="#cb210-10" aria-hidden="true" tabindex="-1"></a>fig <span class="sc">%&gt;%</span></span>
<span id="cb210-11"><a href="#cb210-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(<span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">fixedrange =</span> <span class="cn">TRUE</span>),</span>
<span id="cb210-12"><a href="#cb210-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">showlegend =</span> <span class="cn">TRUE</span>,</span>
<span id="cb210-13"><a href="#cb210-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">fixedrange =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb210-14"><a href="#cb210-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">config</span>(<span class="at">displayModeBar =</span> <span class="cn">FALSE</span>)</span>
<span id="cb210-15"><a href="#cb210-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-16"><a href="#cb210-16" aria-hidden="true" tabindex="-1"></a><span class="co">#Line plot</span></span>
<span id="cb210-17"><a href="#cb210-17" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>)</span>
<span id="cb210-18"><a href="#cb210-18" aria-hidden="true" tabindex="-1"></a>random_y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">50</span>, <span class="at">mean =</span> <span class="dv">0</span>)</span>
<span id="cb210-19"><a href="#cb210-19" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x, random_y)</span>
<span id="cb210-20"><a href="#cb210-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-21"><a href="#cb210-21" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(data, <span class="at">x =</span> <span class="sc">~</span>x, </span>
<span id="cb210-22"><a href="#cb210-22" aria-hidden="true" tabindex="-1"></a>               <span class="at">y =</span> <span class="sc">~</span>random_y, </span>
<span id="cb210-23"><a href="#cb210-23" aria-hidden="true" tabindex="-1"></a>               <span class="at">type =</span> <span class="st">&#39;scatter&#39;</span>, </span>
<span id="cb210-24"><a href="#cb210-24" aria-hidden="true" tabindex="-1"></a>               <span class="at">mode =</span> <span class="st">&#39;lines&#39;</span>)</span>
<span id="cb210-25"><a href="#cb210-25" aria-hidden="true" tabindex="-1"></a>fig</span>
<span id="cb210-26"><a href="#cb210-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-27"><a href="#cb210-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Histogramas</span></span>
<span id="cb210-28"><a href="#cb210-28" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(<span class="at">x =</span> <span class="sc">~</span><span class="fu">rnorm</span>(<span class="dv">50</span>), </span>
<span id="cb210-29"><a href="#cb210-29" aria-hidden="true" tabindex="-1"></a>               <span class="at">type =</span> <span class="st">&quot;histogram&quot;</span>)</span>
<span id="cb210-30"><a href="#cb210-30" aria-hidden="true" tabindex="-1"></a>fig</span>
<span id="cb210-31"><a href="#cb210-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-32"><a href="#cb210-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Con 2 grupos</span></span>
<span id="cb210-33"><a href="#cb210-33" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>)</span>
<span id="cb210-34"><a href="#cb210-34" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> fig <span class="sc">%&gt;%</span> <span class="fu">add_histogram</span>(<span class="at">x =</span> <span class="sc">~</span><span class="fu">rnorm</span>(<span class="dv">500</span>))</span>
<span id="cb210-35"><a href="#cb210-35" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> fig <span class="sc">%&gt;%</span> <span class="fu">add_histogram</span>(<span class="at">x =</span> <span class="sc">~</span><span class="fu">rnorm</span>(<span class="dv">500</span>) <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb210-36"><a href="#cb210-36" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> fig <span class="sc">%&gt;%</span> <span class="fu">layout</span>(<span class="at">barmode =</span> <span class="st">&quot;overlay&quot;</span>)</span>
<span id="cb210-37"><a href="#cb210-37" aria-hidden="true" tabindex="-1"></a>fig</span>
<span id="cb210-38"><a href="#cb210-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-39"><a href="#cb210-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplot</span></span>
<span id="cb210-40"><a href="#cb210-40" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(<span class="at">y =</span> <span class="sc">~</span><span class="fu">rnorm</span>(<span class="dv">50</span>), <span class="at">type =</span> <span class="st">&quot;box&quot;</span>)</span>
<span id="cb210-41"><a href="#cb210-41" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> fig <span class="sc">%&gt;%</span> <span class="fu">add_trace</span>(<span class="at">y =</span> <span class="sc">~</span><span class="fu">rnorm</span>(<span class="dv">50</span>, <span class="dv">1</span>))</span>
<span id="cb210-42"><a href="#cb210-42" aria-hidden="true" tabindex="-1"></a>fig</span></code></pre></div>
</div>
</div>
</div>
<div id="análisis-de-datos-y-generación-de-informes-con-r-markdown" class="section level2 hasAnchor" number="2.8">
<h2 class="hasAnchor"><span class="header-section-number">2.8</span> Análisis de datos y generación de informes con R Markdown<a href="#análisis-de-datos-y-generación-de-informes-con-r-markdown" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="test-de-hipótesis" class="section level3 hasAnchor" number="2.8.1">
<h3 class="hasAnchor"><span class="header-section-number">2.8.1</span> Test de hipótesis<a href="#test-de-hipótesis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Imaginen que una compañia quiere testear la efectividad de una estrategia de venta. La estrategia A consiste en colocar un letrero que diga “oferta final”. La estrategia B consiste en dejar todo como siempre. Aleatoriamente se eligen los días y lugares en donde se utilizara la estrategia A y los días en que se utilizara la estrategia B. Luego, se registran los datos de ventas y se observan que las ventas de la compañía con la estrategia B fueron un 43,4% mayores a las tiendas con la estrategia A. La intuición se contradice con los datos, sin embargo, ¿Es esto debido al azar? ¿o bien es un resultado estadísticamente significativo?</p>
<div id="test-de-diferencia-de-media" class="section level4 hasAnchor" number="2.8.1.1">
<h4 class="hasAnchor"><span class="header-section-number">2.8.1.1</span> Test de diferencia de media<a href="#test-de-diferencia-de-media" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Una de las pruebas más comunes en estadística, la prueba t, se utiliza para determinar si las medias de dos grupos son iguales entre sí. La hipótesis de la prueba es que ambos grupos proceden de distribuciones normales con varianzas iguales. La hipótesis nula es que las dos medias son iguales, y la alternativa es que no lo son. Se sabe que bajo la hipótesis nula, podemos calcular un estadístico t que seguirá una distribución t.</p>
<p>También existe una modificación ampliamente utilizada de la prueba t, conocida como prueba t de Welch, que ajusta el número de grados de libertad cuando se cree que las varianzas no son iguales entre sí. Este tutorial cubre los fundamentos de la realización de pruebas t en R.</p>
<p><code>t.test()</code> puede utilizarse para realizar pruebas t de una y dos muestras en vectores de datos. La función contiene una variedad de argumentos. La sintaxis es:</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Datos </span></span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;midwest&quot;</span>)</span>
<span id="cb211-3"><a href="#cb211-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(midwest)</span>
<span id="cb211-4"><a href="#cb211-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(midwest)</span>
<span id="cb211-5"><a href="#cb211-5" aria-hidden="true" tabindex="-1"></a><span class="fu">skim</span>(midwest)</span>
<span id="cb211-6"><a href="#cb211-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-7"><a href="#cb211-7" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(x, <span class="at">y =</span> <span class="cn">NULL</span>, </span>
<span id="cb211-8"><a href="#cb211-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">alternative =</span> <span class="fu">c</span>(<span class="st">&quot;two.sided&quot;</span>, <span class="st">&quot;less&quot;</span>, <span class="st">&quot;greater&quot;</span>), </span>
<span id="cb211-9"><a href="#cb211-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">paired =</span> <span class="cn">FALSE</span>,</span>
<span id="cb211-10"><a href="#cb211-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">mu =</span> <span class="dv">0</span>,</span>
<span id="cb211-11"><a href="#cb211-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">var.equal =</span> <span class="cn">FALSE</span>, </span>
<span id="cb211-12"><a href="#cb211-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">conf.level =</span> <span class="fl">0.95</span>)</span></code></pre></div>
<p>Aquí <span class="math inline">\(x\)</span> es un vector numérico de valores de datos e <span class="math inline">\(y\)</span> es un vector numérico opcional de valores de datos. Si se excluye <span class="math inline">\(y\)</span>, la función realiza una prueba t de una muestra sobre los datos contenidos en <span class="math inline">\(x\)</span>, si se incluye realiza una prueba t de dos muestras utilizando tanto <span class="math inline">\(x\)</span> como <span class="math inline">\(y\)</span>.</p>
<p>El argumento <span class="math inline">\(mu\)</span> proporciona un número que indica el verdadero valor de la media (o la diferencia de medias si se realiza una prueba de dos muestras) bajo la hipótesis nula. Por defecto, la prueba realiza una prueba t de dos caras; sin embargo, puede realizar una hipótesis alternativa cambiando el argumento alternativo a “mayor” o “menor” dependiendo de si la hipótesis alternativa es que la media es mayor o menor que <span class="math inline">\(mu\)</span>, respectivamente.</p>
<p>Por ejemplo:</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(x, <span class="at">alternative =</span> <span class="st">&quot;less&quot;</span>, <span class="at">mu =</span> <span class="dv">25</span>)</span></code></pre></div>
<p>Realiza una prueba t de una muestra sobre los datos contenidos en <span class="math inline">\(x\)</span> donde la hipótesis nula es que <span class="math inline">\(mu = 25\)</span> y la alternativa es menor que 25. El argumento <code>var.equal</code> indica si se deben asumir o no varianzas iguales al realizar una prueba t de dos muestras. Por defecto se asume una varianza desigual.</p>
<p>Por último, el argumento <code>conf.level</code> determina el nivel de confianza del intervalo de confianza.</p>
</div>
<div id="t-test-de-una-cola" class="section level4 hasAnchor" number="2.8.1.2">
<h4 class="hasAnchor"><span class="header-section-number">2.8.1.2</span> t-test de una cola<a href="#t-test-de-una-cola" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>La prueba t de una muestra compara la media de una muestra con un valor conocido, cuando la varianza de la población es desconocida. Consideremos que queremos evaluar el porcentaje de adultos con estudios universitarios en el “midwest” y compararlo con un valor determinado.</p>
<p>Por ejemplo, supongamos que la media nacional de adultos con estudios universitarios es del 32% (licenciatura o superior) y queremos ver si la media del “midwest” es significativamente diferente (en terminos estadísticos) de la media nacional. En concreto, queremos comprobar si la media del medio oeste es inferior a la media nacional.</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(midwest<span class="sc">$</span>percollege)</span>
<span id="cb213-2"><a href="#cb213-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráficamente </span></span>
<span id="cb213-3"><a href="#cb213-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-4"><a href="#cb213-4" aria-hidden="true" tabindex="-1"></a><span class="co"># En escala absoluta</span></span>
<span id="cb213-5"><a href="#cb213-5" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(midwest, <span class="fu">aes</span>(percollege)) <span class="sc">+</span> </span>
<span id="cb213-6"><a href="#cb213-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_histogram</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey30&quot;</span>)</span>
<span id="cb213-7"><a href="#cb213-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-8"><a href="#cb213-8" aria-hidden="true" tabindex="-1"></a><span class="co"># En escala logarítmica </span></span>
<span id="cb213-9"><a href="#cb213-9" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(midwest, <span class="fu">aes</span>(percollege)) <span class="sc">+</span> </span>
<span id="cb213-10"><a href="#cb213-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey30&quot;</span>) <span class="sc">+</span></span>
<span id="cb213-11"><a href="#cb213-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>()</span>
<span id="cb213-12"><a href="#cb213-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-13"><a href="#cb213-13" aria-hidden="true" tabindex="-1"></a><span class="co"># La escala logarítmica es una transformación que sirve justificar el supuesto de normalidad. </span></span>
<span id="cb213-14"><a href="#cb213-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-15"><a href="#cb213-15" aria-hidden="true" tabindex="-1"></a><span class="co"># La escala logarítmica hace que la distancia entre 10 y 100 sea la misma que entre 100 y 1000.       </span></span>
<span id="cb213-16"><a href="#cb213-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-17"><a href="#cb213-17" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb213-18"><a href="#cb213-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Recordemos que queremos testear si el promedio del </span></span>
<span id="cb213-19"><a href="#cb213-19" aria-hidden="true" tabindex="-1"></a><span class="co">#    &quot;midwest&quot; es menor que el promedio nacional. </span></span>
<span id="cb213-20"><a href="#cb213-20" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Hacemos tres test: </span></span>
<span id="cb213-21"><a href="#cb213-21" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(midwest<span class="sc">$</span>percollege, </span>
<span id="cb213-22"><a href="#cb213-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">mu =</span> <span class="dv">32</span>, </span>
<span id="cb213-23"><a href="#cb213-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">alternative =</span> <span class="st">&quot;less&quot;</span>)</span></code></pre></div>
<p>El resultado nos indica que p &lt; 0.001 lo que nos dice que rechazamos la hipótesis nula (de que es igual a la nacional) lo que nos da evidencia estadística de que la media poblacional del “midwest” es menor que un 32%. Pero, como vimos anteriormente, tenemos problemas de no normalidad (recuerden el gráfico con las distribuciones empíricas). Para asegurarnos de que nuestra conclusión es correcta vamos a efectuar dos versiones alternativas del test:</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="co"># La misma versión, pero en logaritmos... </span></span>
<span id="cb214-2"><a href="#cb214-2" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(<span class="fu">log</span>(midwest<span class="sc">$</span>percollege), </span>
<span id="cb214-3"><a href="#cb214-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">mu =</span> <span class="fu">log</span>(<span class="dv">32</span>), </span>
<span id="cb214-4"><a href="#cb214-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">alternative =</span> <span class="st">&quot;less&quot;</span>)</span>
<span id="cb214-5"><a href="#cb214-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-6"><a href="#cb214-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Wilcox test sirve cuando no deseamos asumir que los datos provienen de una distribución normal. </span></span>
<span id="cb214-7"><a href="#cb214-7" aria-hidden="true" tabindex="-1"></a><span class="fu">wilcox.test</span>(midwest<span class="sc">$</span>percollege, </span>
<span id="cb214-8"><a href="#cb214-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">mu =</span> <span class="dv">32</span>, </span>
<span id="cb214-9"><a href="#cb214-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">alternative =</span> <span class="st">&quot;less&quot;</span>)</span></code></pre></div>
<p>Ambos resultados apoyan nuestra conclusión inicial de que el porcentaje de adultos con estudios universitarios en el medio oeste es estadísticamente inferior a la media nacional.</p>
</div>
<div id="t-test-de-dos-colas" class="section level4 hasAnchor" number="2.8.1.3">
<h4 class="hasAnchor"><span class="header-section-number">2.8.1.3</span> t-test de dos colas<a href="#t-test-de-dos-colas" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Ahora digamos que queremos comparar las diferencias entre el porcentaje promedio de adultos con estudios universitarios en Ohio y en Michigan. En este caso, queremos realizar una prueba t de dos muestras.</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Seleccionamos los datos </span></span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> midwest <span class="sc">%&gt;%</span></span>
<span id="cb215-3"><a href="#cb215-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(state <span class="sc">==</span> <span class="st">&quot;OH&quot;</span> <span class="sc">|</span> state <span class="sc">==</span> <span class="st">&quot;MI&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb215-4"><a href="#cb215-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(state, percollege)</span>
<span id="cb215-5"><a href="#cb215-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-6"><a href="#cb215-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Estadisticas para ohio</span></span>
<span id="cb215-7"><a href="#cb215-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(state <span class="sc">==</span> <span class="st">&quot;OH&quot;</span>) <span class="sc">%&gt;%</span> .<span class="sc">$</span>percollege)</span>
<span id="cb215-8"><a href="#cb215-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-9"><a href="#cb215-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Estadisticas para michigan </span></span>
<span id="cb215-10"><a href="#cb215-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(state <span class="sc">==</span> <span class="st">&quot;MI&quot;</span>) <span class="sc">%&gt;%</span> .<span class="sc">$</span>percollege)</span></code></pre></div>
<p>Podemos ver que Ohio parece tener ligeramente menos adultos con estudios universitarios que Michigan. No obstante, el gráfico no nos dice si es estadísticamente significativo o no.</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(state, percollege)) <span class="sc">+</span></span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span>
<span id="cb216-3"><a href="#cb216-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-4"><a href="#cb216-4" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(percollege)) <span class="sc">+</span></span>
<span id="cb216-5"><a href="#cb216-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey30&quot;</span>) <span class="sc">+</span></span>
<span id="cb216-6"><a href="#cb216-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> state)</span>
<span id="cb216-7"><a href="#cb216-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-8"><a href="#cb216-8" aria-hidden="true" tabindex="-1"></a><span class="co"># En logaritmos </span></span>
<span id="cb216-9"><a href="#cb216-9" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(percollege)) <span class="sc">+</span></span>
<span id="cb216-10"><a href="#cb216-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey30&quot;</span>) <span class="sc">+</span></span>
<span id="cb216-11"><a href="#cb216-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> state) <span class="sc">+</span></span>
<span id="cb216-12"><a href="#cb216-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>()</span>
<span id="cb216-13"><a href="#cb216-13" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb216-14"><a href="#cb216-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-15"><a href="#cb216-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Realizamos los test </span></span>
<span id="cb216-16"><a href="#cb216-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-17"><a href="#cb216-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Sintaxis basica </span></span>
<span id="cb216-18"><a href="#cb216-18" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(percollege <span class="sc">~</span> state, </span>
<span id="cb216-19"><a href="#cb216-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">data =</span> df)</span>
<span id="cb216-20"><a href="#cb216-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-21"><a href="#cb216-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformando los datos</span></span>
<span id="cb216-22"><a href="#cb216-22" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(<span class="fu">log</span>(percollege) <span class="sc">~</span> state, </span>
<span id="cb216-23"><a href="#cb216-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">data =</span> df)</span>
<span id="cb216-24"><a href="#cb216-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-25"><a href="#cb216-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Sin asumir normalidad</span></span>
<span id="cb216-26"><a href="#cb216-26" aria-hidden="true" tabindex="-1"></a><span class="fu">wilcox.test</span>(percollege <span class="sc">~</span> state, </span>
<span id="cb216-27"><a href="#cb216-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> df)</span></code></pre></div>
<p>Los resultados que aparecen a continuación muestran un valor <span class="math inline">\(p &lt; 0.01\)</span> que apoya la hipótesis alternativa de que “la verdadera diferencia de medias no es igual a 0”; esencialmente afirma que existe una diferencia estadística entre las dos medias.</p>
</div>
<div id="paired-t---test" class="section level4 hasAnchor" number="2.8.1.4">
<h4 class="hasAnchor"><span class="header-section-number">2.8.1.4</span> paired t - test<a href="#paired-t---test" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Sirve para hacer test de diferencias de media para dos grupos que son estadisticamente iguales, pero que fueron sometidos a un tratamientom distinto. Lo que se quiere testear es si efectivamente la diferencia de promedios de alguna variable puede estar asociada a este tratamiento.</p>
<p>Vamos a ocupar la base de datos de R llamada “sleep”. Imaginen queremos testear si una droga particular tiene un efecto estadisticamente significativo sobre las horas que se duerme. En particular, vamos a ver si la variable “extra” es diferente entre ambos grupos. Vamos a utilizar <code>t.test()</code> nuevamente, pero con la opción <code>paired = TRUE</code>.</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Miramos los datos graficamente </span></span>
<span id="cb217-2"><a href="#cb217-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sleep, <span class="fu">aes</span>(group, extra)) <span class="sc">+</span></span>
<span id="cb217-3"><a href="#cb217-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span>
<span id="cb217-4"><a href="#cb217-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-5"><a href="#cb217-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Testeamos </span></span>
<span id="cb217-6"><a href="#cb217-6" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(extra <span class="sc">~</span> group, </span>
<span id="cb217-7"><a href="#cb217-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">data =</span> sleep, </span>
<span id="cb217-8"><a href="#cb217-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">paired =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
</div>
<div id="regresión-lineal-en-r" class="section level3 hasAnchor" number="2.8.2">
<h3 class="hasAnchor"><span class="header-section-number">2.8.2</span> Regresión Lineal en R<a href="#regresión-lineal-en-r" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="mco-con-datos-generados" class="section level4 hasAnchor" number="2.8.2.1">
<h4 class="hasAnchor"><span class="header-section-number">2.8.2.1</span> MCO con datos generados<a href="#mco-con-datos-generados" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Limpiar </span></span>
<span id="cb218-2"><a href="#cb218-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb218-3"><a href="#cb218-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-4"><a href="#cb218-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Fijar la semilla (Nos permite generar resultados reproducibles)</span></span>
<span id="cb218-5"><a href="#cb218-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb218-6"><a href="#cb218-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-7"><a href="#cb218-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Genero número de observaciones </span></span>
<span id="cb218-8"><a href="#cb218-8" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">50</span> </span>
<span id="cb218-9"><a href="#cb218-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-10"><a href="#cb218-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Simular una variable x con una distribución uniforme runif(N,min,max)</span></span>
<span id="cb218-11"><a href="#cb218-11" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(N,<span class="dv">1</span>,<span class="dv">40</span>)</span>
<span id="cb218-12"><a href="#cb218-12" aria-hidden="true" tabindex="-1"></a>x</span>
<span id="cb218-13"><a href="#cb218-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-14"><a href="#cb218-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Simular y rnorm(N,media,sd)</span></span>
<span id="cb218-15"><a href="#cb218-15" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">40</span> <span class="sc">+</span> <span class="fl">0.5</span><span class="sc">*</span>x <span class="sc">+</span> <span class="fu">rnorm</span>(N,<span class="dv">0</span>,<span class="dv">2</span>)</span>
<span id="cb218-16"><a href="#cb218-16" aria-hidden="true" tabindex="-1"></a>y</span>
<span id="cb218-17"><a href="#cb218-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-18"><a href="#cb218-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear una base de datos (data.frame) con lo que yo genere. </span></span>
<span id="cb218-19"><a href="#cb218-19" aria-hidden="true" tabindex="-1"></a>mco_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x,y)</span>
<span id="cb218-20"><a href="#cb218-20" aria-hidden="true" tabindex="-1"></a>mco_data</span>
<span id="cb218-21"><a href="#cb218-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-22"><a href="#cb218-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Ahora, vamos a estimar por Minimos Cuadrados ordinarios </span></span>
<span id="cb218-23"><a href="#cb218-23" aria-hidden="true" tabindex="-1"></a><span class="co"># el modelo</span></span>
<span id="cb218-24"><a href="#cb218-24" aria-hidden="true" tabindex="-1"></a>mco <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, </span>
<span id="cb218-25"><a href="#cb218-25" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> mco_data)</span>
<span id="cb218-26"><a href="#cb218-26" aria-hidden="true" tabindex="-1"></a>mco </span>
<span id="cb218-27"><a href="#cb218-27" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mco)</span>
<span id="cb218-28"><a href="#cb218-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-29"><a href="#cb218-29" aria-hidden="true" tabindex="-1"></a><span class="co"># También lo podemos ver gráficamente </span></span>
<span id="cb218-30"><a href="#cb218-30" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mco_data, <span class="fu">aes</span>(x,y))<span class="sc">+</span> </span>
<span id="cb218-31"><a href="#cb218-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">with=</span>.<span class="dv">2</span>, <span class="at">alpha=</span><span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb218-32"><a href="#cb218-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">se =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> </span>
<span id="cb218-33"><a href="#cb218-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Diagrama de dispersión&quot;</span>, </span>
<span id="cb218-34"><a href="#cb218-34" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;ScatterPlot&quot;</span>, </span>
<span id="cb218-35"><a href="#cb218-35" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;x&quot;</span>, </span>
<span id="cb218-36"><a href="#cb218-36" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;y&quot;</span>) <span class="sc">+</span> <span class="fu">theme_minimal</span>()</span></code></pre></div>
<div class="alert alert-block alert-success">
<p><b>En resumen….</b>
Para estimar: <code>mco &lt;- lm(y ~ x1 + x2 + x3, data = misdatos)</code>
Para mirar resultados: <code>summary(mco)</code>
Para mirar gráficamente: <code>ggplot() + geom_point() + geom_smooth(method = "lm")</code></p>
</div>
</div>
<div id="mco-con-datos-reales" class="section level4 hasAnchor" number="2.8.2.2">
<h4 class="hasAnchor"><span class="header-section-number">2.8.2.2</span> MCO con datos reales<a href="#mco-con-datos-reales" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb219-2"><a href="#cb219-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;CPS1985&quot;</span>)</span>
<span id="cb219-3"><a href="#cb219-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(CPS1985)</span>
<span id="cb219-4"><a href="#cb219-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-5"><a href="#cb219-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlación entre variables </span></span>
<span id="cb219-6"><a href="#cb219-6" aria-hidden="true" tabindex="-1"></a>CPS1985 <span class="sc">%&gt;%</span>  </span>
<span id="cb219-7"><a href="#cb219-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">cor1 =</span> <span class="fu">cor</span>(wage, education), </span>
<span id="cb219-8"><a href="#cb219-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">cor2 =</span> <span class="fu">cor</span>(wage, experience))</span>
<span id="cb219-9"><a href="#cb219-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-10"><a href="#cb219-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráficamente </span></span>
<span id="cb219-11"><a href="#cb219-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(CPS1985, <span class="fu">aes</span>(education, <span class="fu">log</span>(wage))) <span class="sc">+</span> </span>
<span id="cb219-12"><a href="#cb219-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb219-13"><a href="#cb219-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&#39;lm&#39;</span>, <span class="at">se =</span> T) <span class="sc">+</span></span>
<span id="cb219-14"><a href="#cb219-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Diagrama de dispersión&quot;</span>,</span>
<span id="cb219-15"><a href="#cb219-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle=</span> <span class="st">&quot;ScatterPlot&quot;</span>,</span>
<span id="cb219-16"><a href="#cb219-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption=</span><span class="st">&quot;Fuente: CPS1985 (paquete AER)&quot;</span>,</span>
<span id="cb219-17"><a href="#cb219-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">x=</span><span class="st">&quot;Educación en años&quot;</span>,</span>
<span id="cb219-18"><a href="#cb219-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">&quot;Salario (en logaritmo)&quot;</span>)</span>
<span id="cb219-19"><a href="#cb219-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-20"><a href="#cb219-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimación </span></span>
<span id="cb219-21"><a href="#cb219-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-22"><a href="#cb219-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Creamos variables que utilizaremos en las estimaciones </span></span>
<span id="cb219-23"><a href="#cb219-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-24"><a href="#cb219-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Crear dos variables: log(wage) y experiencia al cuadrado. </span></span>
<span id="cb219-25"><a href="#cb219-25" aria-hidden="true" tabindex="-1"></a>  CPS1985<span class="sc">$</span>lnwage <span class="ot">&lt;-</span> <span class="fu">log</span>(CPS1985<span class="sc">$</span>wage)</span>
<span id="cb219-26"><a href="#cb219-26" aria-hidden="true" tabindex="-1"></a>  CPS1985<span class="sc">$</span>exp2 <span class="ot">&lt;-</span> CPS1985<span class="sc">$</span>exp <span class="sc">*</span> CPS1985<span class="sc">$</span>exp </span>
<span id="cb219-27"><a href="#cb219-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-28"><a href="#cb219-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># R no nos permite elevar variables al cuadrado dentro de la función</span></span>
<span id="cb219-29"><a href="#cb219-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generamos variables categóricas que queramos incluir en la regresión</span></span>
<span id="cb219-30"><a href="#cb219-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-31"><a href="#cb219-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Variables dicótomicas (sobre variable binarias).  </span></span>
<span id="cb219-32"><a href="#cb219-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>(CPS1985<span class="sc">$</span>gender)</span>
<span id="cb219-33"><a href="#cb219-33" aria-hidden="true" tabindex="-1"></a>  CPS1985<span class="sc">$</span>sexo <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(CPS1985<span class="sc">$</span>gender <span class="sc">==</span> <span class="st">&quot;male&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb219-34"><a href="#cb219-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>(CPS1985<span class="sc">$</span>union)</span>
<span id="cb219-35"><a href="#cb219-35" aria-hidden="true" tabindex="-1"></a>  CPS1985<span class="sc">$</span>sind <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(CPS1985<span class="sc">$</span>union <span class="sc">==</span> <span class="st">&quot;yes&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb219-36"><a href="#cb219-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-37"><a href="#cb219-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Variables dicótomas (sobre variables categóricas)</span></span>
<span id="cb219-38"><a href="#cb219-38" aria-hidden="true" tabindex="-1"></a>  CPS1985 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(CPS1985, </span>
<span id="cb219-39"><a href="#cb219-39" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">dummy</span>(<span class="fu">factor</span>(CPS1985<span class="sc">$</span>occupation), <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>))</span>
<span id="cb219-40"><a href="#cb219-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-41"><a href="#cb219-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generando formas editables </span></span>
<span id="cb219-42"><a href="#cb219-42" aria-hidden="true" tabindex="-1"></a>  f0 <span class="ot">&lt;-</span> wage <span class="sc">~</span> education </span>
<span id="cb219-43"><a href="#cb219-43" aria-hidden="true" tabindex="-1"></a>  f1 <span class="ot">&lt;-</span> lnwage <span class="sc">~</span> education </span>
<span id="cb219-44"><a href="#cb219-44" aria-hidden="true" tabindex="-1"></a>  f2 <span class="ot">&lt;-</span> lnwage <span class="sc">~</span> education <span class="sc">+</span> experience</span>
<span id="cb219-45"><a href="#cb219-45" aria-hidden="true" tabindex="-1"></a>  f3 <span class="ot">&lt;-</span> lnwage <span class="sc">~</span> education <span class="sc">+</span> experience <span class="sc">+</span> exp2</span>
<span id="cb219-46"><a href="#cb219-46" aria-hidden="true" tabindex="-1"></a>  f4 <span class="ot">&lt;-</span> lnwage <span class="sc">~</span> education <span class="sc">+</span> experience <span class="sc">+</span> exp2 <span class="sc">+</span> sexo</span>
<span id="cb219-47"><a href="#cb219-47" aria-hidden="true" tabindex="-1"></a>  f5 <span class="ot">&lt;-</span> lnwage <span class="sc">~</span> education <span class="sc">+</span> experience <span class="sc">+</span> exp2 <span class="sc">+</span> sexo <span class="sc">+</span> sind</span>
<span id="cb219-48"><a href="#cb219-48" aria-hidden="true" tabindex="-1"></a>  f6 <span class="ot">&lt;-</span> lnwage <span class="sc">~</span> education <span class="sc">+</span> experience <span class="sc">+</span> exp2 <span class="sc">+</span> sexo <span class="sc">+</span> sind <span class="sc">+</span> CPS1985_services</span>
<span id="cb219-49"><a href="#cb219-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-50"><a href="#cb219-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Estimaciones </span></span>
<span id="cb219-51"><a href="#cb219-51" aria-hidden="true" tabindex="-1"></a>  mco_0 <span class="ot">&lt;-</span> <span class="fu">lm</span>(f0, <span class="at">data=</span>CPS1985, <span class="at">na.action =</span> na.exclude)</span>
<span id="cb219-52"><a href="#cb219-52" aria-hidden="true" tabindex="-1"></a>  mco_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(f1, <span class="at">data=</span>CPS1985, <span class="at">na.action =</span> na.exclude)</span>
<span id="cb219-53"><a href="#cb219-53" aria-hidden="true" tabindex="-1"></a>  mco_2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(f2, <span class="at">data=</span>CPS1985, <span class="at">na.action =</span> na.exclude)</span>
<span id="cb219-54"><a href="#cb219-54" aria-hidden="true" tabindex="-1"></a>  mco_3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(f3, <span class="at">data=</span>CPS1985, <span class="at">na.action =</span> na.exclude)</span>
<span id="cb219-55"><a href="#cb219-55" aria-hidden="true" tabindex="-1"></a>  mco_4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(f4, <span class="at">data=</span>CPS1985, <span class="at">na.action =</span> na.exclude)</span>
<span id="cb219-56"><a href="#cb219-56" aria-hidden="true" tabindex="-1"></a>  mco_5 <span class="ot">&lt;-</span> <span class="fu">lm</span>(f5, <span class="at">data=</span>CPS1985, <span class="at">na.action =</span> na.exclude)</span>
<span id="cb219-57"><a href="#cb219-57" aria-hidden="true" tabindex="-1"></a>  mco_6 <span class="ot">&lt;-</span> <span class="fu">lm</span>(f6, <span class="at">data=</span>CPS1985, <span class="at">na.action =</span> na.exclude)</span>
<span id="cb219-58"><a href="#cb219-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-59"><a href="#cb219-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-60"><a href="#cb219-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Mirar los resultados de mis estimaciones </span></span>
<span id="cb219-61"><a href="#cb219-61" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mco_0)</span>
<span id="cb219-62"><a href="#cb219-62" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mco_1)</span>
<span id="cb219-63"><a href="#cb219-63" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mco_2)</span>
<span id="cb219-64"><a href="#cb219-64" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mco_3)</span>
<span id="cb219-65"><a href="#cb219-65" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mco_4)</span>
<span id="cb219-66"><a href="#cb219-66" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mco_5)</span>
<span id="cb219-67"><a href="#cb219-67" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mco_6)</span>
<span id="cb219-68"><a href="#cb219-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-69"><a href="#cb219-69" aria-hidden="true" tabindex="-1"></a><span class="co"># Exportar resultados </span></span>
<span id="cb219-70"><a href="#cb219-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-71"><a href="#cb219-71" aria-hidden="true" tabindex="-1"></a><span class="co"># El paquete se llama &quot;stargazer&quot;</span></span>
<span id="cb219-72"><a href="#cb219-72" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="fu">here</span>(<span class="st">&quot;resultados&quot;</span>))</span>
<span id="cb219-73"><a href="#cb219-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-74"><a href="#cb219-74" aria-hidden="true" tabindex="-1"></a><span class="fu">stargazer</span>(mco_1, mco_2, mco_3, <span class="co"># Modelos</span></span>
<span id="cb219-75"><a href="#cb219-75" aria-hidden="true" tabindex="-1"></a>          <span class="at">type =</span> <span class="st">&quot;text&quot;</span>, </span>
<span id="cb219-76"><a href="#cb219-76" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">&quot;Estimación MCO salarios vs. educ&quot;</span>, </span>
<span id="cb219-77"><a href="#cb219-77" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">&quot;qje&quot;</span>, <span class="co"># Estilos </span></span>
<span id="cb219-78"><a href="#cb219-78" aria-hidden="true" tabindex="-1"></a>          <span class="at">notes =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">footnotezie ***p=.01; ** p =.05; *p=.1&quot;</span>, </span>
<span id="cb219-79"><a href="#cb219-79" aria-hidden="true" tabindex="-1"></a>          <span class="at">notes.append =</span> F, <span class="co"># Para remplazar notas puestas anteriormente. </span></span>
<span id="cb219-80"><a href="#cb219-80" aria-hidden="true" tabindex="-1"></a>          <span class="at">single.row =</span> F, <span class="co"># Para que los errores estandar esten en la misma linea que los coeficientes </span></span>
<span id="cb219-81"><a href="#cb219-81" aria-hidden="true" tabindex="-1"></a>          <span class="at">no.space =</span> T, <span class="co"># No se generen espacios entre los regresores.</span></span>
<span id="cb219-82"><a href="#cb219-82" aria-hidden="true" tabindex="-1"></a>          <span class="at">out =</span> <span class="st">&quot;est1-3.doc&quot;</span>, </span>
<span id="cb219-83"><a href="#cb219-83" aria-hidden="true" tabindex="-1"></a>          <span class="at">digits =</span> <span class="dv">2</span>)</span></code></pre></div>
</div>
</div>
<div id="r-markdown" class="section level3 hasAnchor" number="2.8.3">
<h3 class="hasAnchor"><span class="header-section-number">2.8.3</span> R Markdown<a href="#r-markdown" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Herramienta para crear informes que sean automáticos, reproducibles y con datos que se puedan actualizar en el tiempo.</li>
<li>Se pueden generar informes en formato word, pdf, html.</li>
<li>R markdown (Rmd) es básicamente una intersección entre texto narrativo y código que genera visualizaciones y estimaciones con el fin de analizar datos.</li>
<li>Rmd puede generar: texto plano, segmentos de co ́digo, gr ́aficos, tablas, tableros interactivos.</li>
<li>R markdown es especialmente útil:
<ul>
<li><strong>Informes rutinarios:</strong> Por ejemplo, informe semanal sobre un conjunto de análisis que se actualiza en el tiempo.</li>
<li><strong>Informes de análisis para un subconjunto de datos:</strong> Por ejemplo, informes por país de una base de datos que contiene información de distintos países.</li>
</ul></li>
</ul>
<div id="conceptos-básicos" class="section level4 hasAnchor" number="2.8.3.1">
<h4 class="hasAnchor"><span class="header-section-number">2.8.3.1</span> Conceptos Básicos<a href="#conceptos-básicos" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><strong>Markdown</strong> es el lenguaje que permite escribir documentos en texto plano. Los archivos escritos en Markdown tienen la extensión <code>.md</code>.</li>
<li><strong>R Markdown</strong> es la variación especifica para R. Permite escribir texto plano con Markdown y adjuntar código proveniente de R. Los archivos escritos en R Markdown tienen la extensión <code>.Rmd</code>.</li>
<li><strong>knirt:</strong> Paquete de R. Sirve para leer los segmentos de código que queremos introducir en los reportes.</li>
<li><strong>Pandoc:</strong> Sirve para convertir el output en un archivo con formato word/pdf/html. Es un software que viene instalado automáticamente en R.</li>
</ul>
</div>
<div id="proceso" class="section level4 hasAnchor" number="2.8.3.2">
<h4 class="hasAnchor"><span class="header-section-number">2.8.3.2</span> Proceso<a href="#proceso" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="figure">
<img src="C8.1.png" alt="" />
<p class="caption">Fuente: <a href="https://rmarkdown.rstudio.com/authoring" class="uri">https://rmarkdown.rstudio.com/authoring</a> quick tour.html</p>
</div>
</div>
<div id="primer-archivo-en-r-markdown" class="section level4 hasAnchor" number="2.8.3.3">
<h4 class="hasAnchor"><span class="header-section-number">2.8.3.3</span> Primer archivo en R Markdown<a href="#primer-archivo-en-r-markdown" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><img src="C8.2.png" />
<img src="C8.3.png" /></p>
<ul>
<li>Opciones para elegir el tipo de documento y si quiero confeccionar un documento/presentación/un tablero u otros tipos de archivo más detallados.</li>
<li>Opciones para cambiar título y autor(a).</li>
</ul>
</div>
<div id="directorio-de-trabajo" class="section level4 hasAnchor" number="2.8.3.4">
<h4 class="hasAnchor"><span class="header-section-number">2.8.3.4</span> Directorio de trabajo<a href="#directorio-de-trabajo" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>El directorio de trabajo de un archivo <code>.Rmd</code> será donde esta guardado el archivo con esa extensión.</li>
<li>De este modo, R buscará los archivos en la carpeta en donde este guardado el archivo <code>.Rmd</code>.</li>
<li>Para este ejercicio simplemente dejaremos los datos que utilizaremos junto al archivo.</li>
</ul>
</div>
<div id="componentes-de-r-markdown" class="section level4 hasAnchor" number="2.8.3.5">
<h4 class="hasAnchor"><span class="header-section-number">2.8.3.5</span> Componentes de R Markdown<a href="#componentes-de-r-markdown" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><img src="C8.4.png" /></p>
<ul>
<li>YAML: fijar título, fecha y tipo de output.</li>
<li>Markdown text: introducir texto.</li>
<li>Code Chunk: cargar paquetes, datos, visualizaciones.</li>
</ul>
<p><img src="C8.5.png" /></p>
<!--chapter:end:01-curso1.Rmd-->
</div>
</div>
</div>
</div>
<div id="análisis-de-datos-con-stata" class="section level1 hasAnchor" number="3">
<h1 class="hasAnchor"><span class="header-section-number">3</span> Análisis de datos con STATA<a href="#análisis-de-datos-con-stata" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="buenas-prácticas-de-programación-y-visualización-parte-i" class="section level2 hasAnchor" number="3.1">
<h2 class="hasAnchor"><span class="header-section-number">3.1</span> Buenas prácticas de programación y visualización (Parte I)<a href="#buenas-prácticas-de-programación-y-visualización-parte-i" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="introducción" class="section level3 hasAnchor" number="3.1.1">
<h3 class="hasAnchor"><span class="header-section-number">3.1.1</span> Introducción<a href="#introducción" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="programación-defensiva" class="section level4 hasAnchor" number="3.1.1.1">
<h4 class="hasAnchor"><span class="header-section-number">3.1.1.1</span> Programación defensiva<a href="#programación-defensiva" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>Las personas somos malas escribiendo códigos</strong></p>
<p>Esta sección esta basada en los trabajos de <a href="https://www.nickeubank.com/">Nick Eubank</a>.</p>
<ul>
<li>La filosofía de escribir un código esta motivada por el hecho de que las personas somos <strong>malas escribiendo códigos</strong>.</li>
<li>Si queremos evitar errores <strong>no es suficiente con ser cuidadoso</strong></li>
<li>Es necesario diseñar estrategias que tomen en cuenta el hecho de que vamos a cometer errores al escribir un código.</li>
<li>Las estrategias se hacen más importantes con el trabajo colaborativo que puede \alert{amplificar los errores.</li>
</ul>
<p>En esta sección revisaremos cuatro ``buenas practicas’’</p>
<ul>
<li>Usar testeos o pruebas.</li>
<li>No duplicar información.</li>
<li>No transcribir información, siempre exportarla.</li>
<li>Usar un estilo correcto.</li>
</ul>
<p>Con estos elementos podremos:</p>
<ul>
<li><strong>Minimizar</strong> las oportunidades de generar errores al codificar.</li>
<li><strong>Maximizar</strong> la probabilidad de que cuando se cometa un error (lo que ocurrirá!) se pueda detectar con mayor facilidad.
\end{itemize}</li>
</ul>
<p>¿Necesito entender estos principios?</p>
<p> testearon la reproducibilidad de 67 artículos <strong>publicados</strong>. Todos con alguna sección empírica. Encuentran que:</p>
<ul>
<li>Solo 29 artículos fueron totalmente replicables.</li>
<li>29 artículos tenían problemas al tratar </li>
<li>9 poseen datos incorrectos o errores de codificación.</li>
</ul>
<p> indican que Chang y Li utilizan una versión poco estricta de replicabilidad.</p>
<div class="alert alert-block alert-info">
<b></b> (…) Chang and Li (2015) use a qualitative definition of replication, and test only key results of the paper, and this appears to lead to a fairly generous interpretation of replicability. (…)
</div>
<div class="alert alert-block alert-info">
<b></b> (…) To our minds, this is evidence that even when data are available (which they sometimes are not) , even when using the original data and a relatively non-stringent conceptual understanding of what constitutes replication success.
</div>
<p>¿Qué podemos aprender de esta historia?</p>
<ul>
<li>Todos y todas tienen problemas para codificar.</li>
<li>Hoy el <strong>trabajo es colaborativo</strong>. También tienes que confiar en otros.</li>
<li>Hay cosas que no se pueden resolver con ser cuidadoso(a) al codificar. ¿Si los datos están mal?</li>
<li>Reproducibilidad y replicabilidad son claves. Buenas referencias se encuentran en la página de <a href="https://jschultecloos.github.io/">Julia Schulte-Cloos</a>.</li>
</ul>
</div>
<div id="practica-i-escribir-pruebas" class="section level4 hasAnchor" number="3.1.1.2">
<h4 class="hasAnchor"><span class="header-section-number">3.1.1.2</span> Practica I: escribir pruebas<a href="#practica-i-escribir-pruebas" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>¿Qué es escribir pruebas?</p>
<p><a href="https://www.nickeubank.com/">Nick Eubank</a> indica que si el tuviese que elegir solo una practica elegiría agregar pruebas o tests a los códigos.</p>
<p>¿Qué es una prueba?</p>
<ul>
<li>Son afirmaciones que tienen como respuesta un valor lógico.</li>
<li>Buscan chequear una condición particular, en caso de que no se cumpla esta condición, la ejecución se detiene.</li>
</ul>
<p>¿Por qué agregar estos chequeos, si yo siempre chequeo o reviso mis códigos?</p>
<ol style="list-style-type: decimal">
<li>Test se ejecutan <strong>cada vez</strong> que corres tu código</li>
</ol>
<ul>
<li>La mayoría testea la <strong>primera</strong> vez que escribe un código.</li>
<li>Si hay una entrega el testeo disminuye rápidamente.</li>
<li>Si ya ha pasado algún tiempo. Únicamente ejecuto el código y espero los resultados. Entender un código (incluso el que uno(a) misma escribió es difícil).</li>
<li>Un error que se comete en una de las múltiples ediciones del código pueda ser detectado con facilidad al testear.</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>Genera el hábito de chequear permanentemente a un <strong>costo razonable</strong></li>
</ol>
<ul>
<li>La mayoría se para a chequear los datos cuando detecta algún error o bien sospecha que existe un problema.</li>
<li>Si nos acostumbramos a escribir pruebas al final de los códigos o bien cada vez que se hagan cierto tipo de operaciones (ej. siempre después de unir bases de datos), iremos generando el hábito de chequear constantemente, pero sin sobre-invertir en revisiones posteriores.</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>Ayuda a <strong>detectar</strong> problemas rápidamente</li>
</ol>
<ul>
<li>Se donde esta el error. Puedo corregirlo rápidamente.</li>
<li>Esto es especialmente importante en Stata dado que no nos indica en que linea del código se produjo el error. % Chequear bien esto.</li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li>Escribir pruebas ayuda a detectar más problemas de los <strong>previstos</strong></li>
</ol>
<ul>
<li>Los errores de un código se manifiestan de múltiples formas y muchas veces son consecuencia de errores anteriores.</li>
<li>Por ejemplo…</li>
<li>Si tengo valores duplicados mi estadística descriptiva estará mala.</li>
<li>El problema surge de no darle un tratamiento correcto a los valores duplicados. No surge de algún problema en el código que genera la estadística descriptiva.</li>
</ul>
<p><strong>Ejemplo 1:</strong> Para escribir pruebas en Stata utilizaremos el comando <code>|assert|</code>. Notar que este comando detiene la ejecución del código cuando <strong>la condición no se cumple</strong>.</p>
<p>Testear si la base de datos tiene 100 observaciones:</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span> </span>
<span id="cb220-2"><a href="#cb220-2" aria-hidden="true" tabindex="-1"></a><span class="kw">assert</span> <span class="ot">`r(N)&#39;</span> == 100</span></code></pre></div>
<p>Testear si la variable <code>tasa_desempleo</code> toma valores razonables:</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="kw">assert</span> tasa_desempleo| &gt; 0 &amp; tasa_desempleo| &lt; 100</span></code></pre></div>
<p>Testear si la variable <code>edad</code> es siempre positiva:</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a>edad &gt; 0</span></code></pre></div>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.1.1:</b></p>
<p>Instrucciones:</p>
<ul>
<li>Descargar carpeta <em>ejercicios - Clase 1</em></li>
<li>Abrir <code>ejercicios_clase1.do</code> y fijar directorio de trabajo en la carpeta descargada.</li>
</ul>
<p>Preguntas:</p>
<ol style="list-style-type: decimal">
<li>La base de datos <em>World Development Indicator (WDI)</em> tiene observaciones duplicadas. <strong>Escriba un test que falle cuando existen valores duplicados</strong>.</li>
<li>Los países en la base de datos <code>Polity</code> deberían ser un subconjunto de los países que están en la base WDI. <strong>Escriba un test que falle debido a este problema</strong>.</li>
</ol>
</div>
<p>¿Cuando escribir tests?</p>
<ul>
<li>Después de juntar bases: <strong>Siempre</strong> incluir test después de utilizar un <code>merge</code>.</li>
<li>Después manipulaciones complejas de datos: Si piensas que fue difícil, incluye un test.</li>
<li>Después de eliminar observaciones: <strong>Siempre</strong> incluir test después de utilizar un <code>drop</code>.</li>
</ul>
<div class="alert alert-block alert-info">
<p><b>Regla general</b> siempre que te veas a ti misma(o) revisando o chequeando algún segmento de código interactivamente <strong>escribe un test</strong>.</p>
</div>
</div>
<div id="practica-ii-no-duplicar-información" class="section level4 hasAnchor" number="3.1.1.3">
<h4 class="hasAnchor"><span class="header-section-number">3.1.1.3</span> Practica II: no duplicar información<a href="#practica-ii-no-duplicar-información" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Todo en un solo sitio</p>
<ul>
<li>Información debe estar expresada una sola vez en un código.</li>
<li>Si la información esta en muchas partes en el código, tendrás que buscar todos esos lugares.</li>
<li>Veamos un ejemplo…</li>
</ul>
<p>Imaginemos que quiero eliminar todas las observaciones que toman un valor mayor a un cierto límite.</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> <span class="kw">if</span> var1 &gt; 110 </span>
<span id="cb223-2"><a href="#cb223-2" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> <span class="kw">if</span> var2 &gt; 110 </span>
<span id="cb223-3"><a href="#cb223-3" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> <span class="kw">if</span> var3 &gt; 110 </span></code></pre></div>
<p>Lo anterior funciona… ¿Cual es el problema entonces?</p>
<ul>
<li>Imaginemos que queremos cambiar el límite de 110 a 100. Del modo en que esta escrito, vamos a tener que hacer cambios <strong>3 veces!</strong></li>
<li>Si estas restricciones se encuentran en distintas partes de tú código, se puede inducir un error.</li>
</ul>
<p><strong>Ejemplo 2:</strong> Para evitar el problema anterior, es mejor escribir:</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> lim = 110 </span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">drop</span> <span class="kw">if</span> var1 &gt; <span class="ot">`lim&#39;</span></span>
<span id="cb224-3"><a href="#cb224-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">drop</span> <span class="kw">if</span> var2 &gt; <span class="ot">`lim&#39;</span> </span>
<span id="cb224-4"><a href="#cb224-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">drop</span> <span class="kw">if</span> var3 &gt; <span class="ot">`lim&#39;</span> </span></code></pre></div>
<p>De esta forma, en caso de decidir cambiar la restricción, solo tendrás que hacer <strong>un cambio</strong>. Minimizando la posibilidad de cometer un error.</p>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.1.2:</b></p>
<ul>
<li>Todas las regresiones que se encuentran en el código tienen la misma base, es decir, el mismo conjunto de variables que se repite.</li>
<li>La idea es consolidar la base con el fin de evitar duplicación de información.</li>
<li>Con este fin, agregar <code>population</code> como control en todas las regresiones. Nuevamente, no dupliques información.</li>
</ul>
</div>
</div>
<div id="practica-iii-no-transcribir-exportar-información" class="section level4 hasAnchor" number="3.1.1.4">
<h4 class="hasAnchor"><span class="header-section-number">3.1.1.4</span> Practica III: no transcribir, exportar información<a href="#practica-iii-no-transcribir-exportar-información" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Nunca transcribir</p>
<ul>
<li><strong>Nunca se debe transcribir resultados</strong>. Todo debe ser exportado de forma tal que pueda ser actualizado automáticamente.<br />
</li>
<li>No cumplir con esta practica es una importante fuente de errores:</li>
<li><strong>Errores de transcripción:</strong> Si me equivoco en el décimo decimal no es tan grave, si cambio un signo si lo es.</li>
<li><strong>Problemas para actualizar:</strong> Es probable que al actualizar un código (como sucede usualmente en cualquier proyecto), olvidemos traspasar los resultados.</li>
<li>¿Como evitar este problema?
<ul>
<li>Para usuarios de <span class="math inline">\(\LaTeX\)</span> cada resultado debe ser guardado en archivos <code>.tex</code>.</li>
<li>Hacer esto no solo con las tablas (ej. <code>putexcel</code>). También hacerlo con cualquier estadística que aparezca en el texto.</li>
<li>Generar el número que se desea citar. Convertirlo a <code>string</code> y guardarlo (ej. <code>midato.tex</code>). Llamarlo con <code>\input{midato.tex}</code>.</li>
<li>Para usuarios de Word es un poco más complejo. Veremos que se puede hacer en la Clase 6.</li>
<li>También veremos Stata Markdown.</li>
</ul></li>
</ul>
<p>Ejemplo 3:</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a>eststo <span class="kw">clear</span></span>
<span id="cb225-2"><a href="#cb225-2" aria-hidden="true" tabindex="-1"></a>eststo: <span class="kw">reg</span> polity gdp_per_cap</span>
<span id="cb225-3"><a href="#cb225-3" aria-hidden="true" tabindex="-1"></a>eststo: <span class="kw">reg</span> polity gdp_per_cap under5_mortality</span>
<span id="cb225-4"><a href="#cb225-4" aria-hidden="true" tabindex="-1"></a>esttab <span class="kw">using</span> nombredelarchivo.tex, <span class="kw">replace</span> <span class="co">///</span></span>
<span id="cb225-5"><a href="#cb225-5" aria-hidden="true" tabindex="-1"></a>       <span class="bn">title</span>(<span class="st">&quot;Mis estimaciones&quot;</span>)</span></code></pre></div>
<p>Importar a <span class="math inline">\(\LaTeX\)</span>: <code>\input{nombredelarchivo.tex}</code></p>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.1.3:</b></p>
<p>Calcula el promedio de <code>literacy_rate</code> y guárdalo en una macro local. Generar un formato tal que solo tenga dos decimales. Guarda el valor como <em>string</em> en un archivo <code>.tex</code> en la misma carpeta.</p>
</div>
</div>
<div id="practica-iv-estilo-importa" class="section level4 hasAnchor" number="3.1.1.5">
<h4 class="hasAnchor"><span class="header-section-number">3.1.1.5</span> Practica IV: estilo importa<a href="#practica-iv-estilo-importa" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Algunos comentarios sobre estilo</p>
<ul>
<li>Estilo no se refiere a la estética del código ni al orden (para bien o para mal!).</li>
<li>Tiene que ver con la facilidad con el que este se puede <strong>leer</strong>. El objetivo final es siempre poder detectar errores.<br />
</li>
<li>Tres aspectos son claves:
<ul>
<li><strong>Utilizar espacios.</strong> Usar espacios siempre después de utilizar un operador. Por ejemplo:</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb226"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> var1=var2+var3      <span class="co">/// Mal</span></span>
<span id="cb226-2"><a href="#cb226-2" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> var1 = var2 + var3  <span class="co">/// Bien</span></span></code></pre></div>
<ul>
<li>Con criterio…</li>
</ul>
<div class="sourceCode" id="cb227"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a>hours + minutes / 60 + seconds / 3600 </span>
<span id="cb227-2"><a href="#cb227-2" aria-hidden="true" tabindex="-1"></a>hours + minutes/60 + seconds/3600</span></code></pre></div>
<ul>
<li><p><strong>Usar variables que sean informativas en si mismas.</strong> No escribir <code>var1</code>, si puedes escribir: <code>tasa_desempleo</code>. Requiere más trabajo, pero facilita la lectura. Agregar unidades también facilita la lectura (<code>labels</code>).<br />
</p></li>
<li><p>Escribir comentarios</p>
<ul>
<li>Ejercicio para explicar en pocas palabras lo que se ha hecho.</li>
<li>Existe un equilibrio entre parsimonia y calidad del comentario.</li>
<li>Establecer el objetivo del comentario claramente es muy importante.</li>
</ul></li>
<li><p>No hay una regla para escribir comentarios</p>
<ul>
<li>Utilizar imperativo si lo tiene que corregir otra persona (ej. modifica parámetros aquí, fija directorio).</li>
<li>Debe incluir suficiente contexto para que alguien que no trabaje directamente en eso entienda que se debe hacer.</li>
<li>Los comentarios largos deben explicar secciones de código. Importante escribir el código por bloques.</li>
<li>La brevedad no debe afectar nunca la comprensión. Esto también aplica para los comandos (ejemplo de <a href="https://michaelshill.net/2015/07/31/in-stata-coding-style-is-the-essential/">Michael Shill</a>).</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb228"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="kw">summarize</span> var1</span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a><span class="kw">sum</span> var1</span>
<span id="cb228-3"><a href="#cb228-3" aria-hidden="true" tabindex="-1"></a>su var1</span></code></pre></div>
</div>
</div>
<div id="estilo-de-codificación-en-stata" class="section level3 hasAnchor" number="3.1.2">
<h3 class="hasAnchor"><span class="header-section-number">3.1.2</span> Estilo de codificación en Stata<a href="#estilo-de-codificación-en-stata" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="más-allá-del-orden" class="section level4 hasAnchor" number="3.1.2.1">
<h4 class="hasAnchor"><span class="header-section-number">3.1.2.1</span> Más allá del orden<a href="#más-allá-del-orden" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Un buen estilo es seguir una estrategia</p>
<ul>
<li>Revisaremos un poco más sobre estilo en base a dos referencias adicionales: y de una guía confeccionada por <a href="https://michaelstepner.com/">Michael Stepner</a>.</li>
<li>Los códigos tienen distintas audiencias. La primera es tu computadora. Si tu computadora no entiende tú código es el peor de los mundos.</li>
<li>Una de las audiencias más importantes son tus colaboradores y colaboradoras. Si ellos/as no lo entienden. <strong>El problema es tuyo en primer lugar.</strong></li>
<li>No hay un solo buen estilo. No hay una guía que pueda sustituir experiencia o estrategias ya probadas de trabajo de equipo.</li>
<li>Lo importante es y <strong>utilizarlas</strong> en la medida de que sea positivo para el producto final.</li>
<li>Ahora veremos algunas estrategias y buenas practicas que pueden ayudar a mejorar el estilo de codificación individual y de tu equipo.</li>
</ul>
</div>
<div id="códigos-cortos" class="section level4 hasAnchor" number="3.1.2.2">
<h4 class="hasAnchor"><span class="header-section-number">3.1.2.2</span> Códigos cortos<a href="#códigos-cortos" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>Ningún segmento de código debiese ser mayor a 100 - 150 carácteres.</li>
<li>Códigos largos, debiesen ser escritos de forma más pequeña como funciones (Clase 4).</li>
<li>Si tienes dificultades para reducir un código a estos estándares, es probable que tengas que pensar en como estructurarlo de mejor forma.</li>
<li>Cada segmento de código o funciones debiesen tener un propósito <strong>claro e intuitivo</strong> para lectores experimentados en el lenguaje de programación que se este utilizando.</li>
</ul>
<p>do - files cortos y con foco</p>
<ul>
<li>Todo do-file debe tener un propósito que pueda ser <strong>explicado en una oración.</strong> De hecho, hay que hacerlo. En el preámbulo.<br />
</li>
<li>Un proyecto debe tener varios <code>do-files</code> con las siguientes características.
<ul>
<li><strong>Cortos:</strong> Debes ser capaz de leer un do-file completo en poco minutos y entender el objetivo. Una buena regla es que no sean más largos de 250 - 350 lineas. No es estricta esta regla. Hay ocasiones que se justifican códigos más largos. %Lo importante es claridad. No sacrificarla nunca.</li>
<li><strong>Autocontenidos:</strong> Cada do-file interactúa con otros solo a través de los archivos que carga y de los que guarda.</li>
<li><strong>Enfocados:</strong> Un <code>do-file</code> cumple un propósito determinado. Cada parte se debe entender como un paso intuitivo para lograr ese propósito.</li>
</ul></li>
</ul>
<p>Funciones claras</p>
<ul>
<li>Un lector debe saber exactamente cuales son los <code>inputs</code> de las funciones.<br />
</li>
<li>Las funciones debiesen declarar explicitamente <code>inputs</code> y <code>outputs</code>. Solo deben funcionar en variables locales.</li>
<li>Las funciones deben trabajar solo en el conjunto de datos para el cual están diseñadas. Por ejemplo: parametros regresión.</li>
<li>Usar variables globales rara vez.</li>
</ul>
</div>
<div id="nombres-descriptivos" class="section level4 hasAnchor" number="3.1.2.3">
<h4 class="hasAnchor"><span class="header-section-number">3.1.2.3</span> Nombres Descriptivos<a href="#nombres-descriptivos" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>Nombres adecuados remplazan comentarios y hacen del código un archivo auto contenido. * <strong>Utilizar nombres completos</strong>. Abreviaciones solo en el caso de estar seguro que cualquier lector puede entenderlo sin ambigüedad.</li>
<li>Si se utilizan abreviaciones. Ser consistente. Utilizar siempre las mismas a lo largo del código.</li>
<li>Cuando no se pueda ser suficientemente claro en un nombre, utilizar si o si para dar una descripción (ej. agregar unidad de medida).</li>
<li><code>labels</code> especifican información. (ej, <code>edad</code> con el <code>label</code> <em>edad al 31 de enero</em> es más informativa que <code>edad</code> y más corto que <code>edad_31enero</code>.</li>
<li>No utilizar nombres en dos (o más) archivos que no expliciten porque son diferentes. Por ejemplo: <code>version_final.do</code> y <code>version_final_ahorasiquesi.do</code>.</li>
<li>Los nombres pueden ser más cortos cuando se utilicen con frecuencia o el objeto este inmediatamente después. Por ejemplo:</li>
</ul>
<div class="sourceCode" id="cb229"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a>beta_mco = (educacion&#39; * educacion)^(-1) * <span class="co">///</span></span>
<span id="cb229-2"><a href="#cb229-2" aria-hidden="true" tabindex="-1"></a>           (educacion&#39; * log_salarios)</span></code></pre></div>
<p>Mejor escrito sería:</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a>X = educacion</span>
<span id="cb230-2"><a href="#cb230-2" aria-hidden="true" tabindex="-1"></a>Y = log_salarios</span>
<span id="cb230-3"><a href="#cb230-3" aria-hidden="true" tabindex="-1"></a>beta_educ_salarios = (X&#39;*X)^(-1)*(X&#39;*Y) </span></code></pre></div>
<ul>
<li>No ser tacaño(a) al nombrar variables, archivos, carpetas.</li>
<li>Probablemente lo escribas solo una vez. No ahorres espacio. Siempre pensar en la claridad.</li>
<li>Para el caso de una figura:
<ul>
<li><code>c_1.pdf</code> es un pesimo nombre.</li>
<li><code>correlaciones.pdf</code> es un mal nombre.</li>
<li><code>T1_CORRELACIONES_INGRESO_MORTALIDAD.PDF</code> es un mejor nombre.</li>
</ul></li>
<li>Para el caso de una carpeta:
<ul>
<li><code>datos/brutos/interregional</code> es un mal nombre.</li>
<li><code>datos/brutos/Estimaciones Censo Interregional 2010 - 2021</code> es un buen nombre.</li>
</ul></li>
<li>Estos nombres nos permiten pensar en el flujo del proyecto sin tener que mirar los códigos.</li>
</ul>
</div>
<div id="ojo-con-el-álgebra" class="section level4 hasAnchor" number="3.1.2.4">
<h4 class="hasAnchor"><span class="header-section-number">3.1.2.4</span> Ojo con el álgebra<a href="#ojo-con-el-álgebra" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Separa el álgebra en partes.</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> pib_percapita_real = <span class="co">///</span></span>
<span id="cb231-2"><a href="#cb231-2" aria-hidden="true" tabindex="-1"></a>    (cons + ggob + <span class="kw">export</span> - import - impuestos)* 10^6 <span class="co">///</span></span>
<span id="cb231-3"><a href="#cb231-3" aria-hidden="true" tabindex="-1"></a>    /(indice_precios * poblacion_miles * 1000)</span></code></pre></div>
<p>Más largo, pero mucho más entendible:</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> pib_millones_nominal = <span class="co">///</span></span>
<span id="cb232-2"><a href="#cb232-2" aria-hidden="true" tabindex="-1"></a>    (cons + ggob + <span class="kw">export</span> - import - impuestos)</span>
<span id="cb232-3"><a href="#cb232-3" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> pib_total_real = pib_millones_nominal * 10^6 <span class="co">///</span></span>
<span id="cb232-4"><a href="#cb232-4" aria-hidden="true" tabindex="-1"></a>    / indice_precios</span>
<span id="cb232-5"><a href="#cb232-5" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> pop_total = poblacion_miles * 1000</span>
<span id="cb232-6"><a href="#cb232-6" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> pib_percapita_real = pib_total_real / pob_total </span></code></pre></div>
</div>
<div id="consistencia" class="section level4 hasAnchor" number="3.1.2.5">
<h4 class="hasAnchor"><span class="header-section-number">3.1.2.5</span> Consistencia<a href="#consistencia" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Ser consistentes
* Hay cosas de estilo que son solo un tema de gusto. Por ejemplo, hay quienes escriben <code>nivel_empleo_anual</code> y otras que escribe <code>NivelEmpleoAnual</code>.
* No importa la elección de un estilo u otro. Lo que importa es que todas y todos los miembros del equipo utilicen <strong>la misma</strong> convención.</p>
</div>
<div id="chequear-errores" class="section level4 hasAnchor" number="3.1.2.6">
<h4 class="hasAnchor"><span class="header-section-number">3.1.2.6</span> Chequear errores<a href="#chequear-errores" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>Hemos aprendido que es importante escribir pruebas o testeos. Especialmente relevante después de operaciones complicadas o pegado de bases de datos.</li>
<li>Stata en algunas ocasiones indica los errores que se comenten, sin la necesidad de colocar estas pruebas. Por ejemplo:</li>
</ul>
<div class="sourceCode" id="cb233"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> <span class="fu">string</span> x = <span class="st">&quot;hola&quot;</span></span>
<span id="cb233-2"><a href="#cb233-2" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> <span class="fu">y</span> = x^2</span></code></pre></div>
<p>Stata retorna el siguiente error:</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="dv">type</span> mismatch </span>
<span id="cb234-2"><a href="#cb234-2" aria-hidden="true" tabindex="-1"></a><span class="fu">r</span>(109);</span></code></pre></div>
<p>Normalmente el error da suficiente información. A pesar de lo anterior, en algunas circunstancias, no es tan claro saber cual es el error. Cuando ustedes se hayan encontrado con un error, que no les fue fácil descifrar, ** tienen que escribir un comentario que lo indique**. Facilitara mucho el trabajo colaborativo.</p>
</div>
<div id="separar-tipos-de-códigos" class="section level4 hasAnchor" number="3.1.2.7">
<h4 class="hasAnchor"><span class="header-section-number">3.1.2.7</span> Separar tipos de códigos<a href="#separar-tipos-de-códigos" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Separar códigos lentos de los rápidos</p>
<ul>
<li>Códigos lentos que rara vez se piensan ejecutar idealmente debiesen estar separados de los códigos rápidos que se quieren ejecutar múltiples ocasiones.</li>
<li>Evito tener que ejecutar un código lento cada vez que necesito actualizar algún resultado.</li>
<li>Este criterio cambia en caso de que todos los códigos sean rápidos.</li>
</ul>
</div>
<div id="automatización" class="section level4 hasAnchor" number="3.1.2.8">
<h4 class="hasAnchor"><span class="header-section-number">3.1.2.8</span> Automatización<a href="#automatización" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>Todo lo que se pueda automatizar debe ser automatizado.</li>
<li>Nunca hacer trabajo que vaya a obtener resultados de forma interactiva. Lo interactivo es siempre para inspeccionar.</li>
</ul>
</div>
<div id="abstracción" class="section level4 hasAnchor" number="3.1.2.9">
<h4 class="hasAnchor"><span class="header-section-number">3.1.2.9</span> Abstracción<a href="#abstracción" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>Abstraer para eliminar pasos redundantes.<br />
</li>
<li>Abstraer con fines de hacer códigos más claros. <strong>No por otras razones</strong>.</li>
<li>Abstracción es esencial para escribir un buen código por al menos dos razones:
<ul>
<li>Al eliminar la redundancia se reducen las posibilidades de cometer errores.</li>
<li>Aumenta la claridad. Para cualquier lector será más facil leer un código no redundante.</li>
</ul></li>
</ul>
<p><strong>Ejemplo 4:</strong> Supongamos que queremos ver la correlación espacial del consumo de papas fritas. Queremos testear si el consumo per-capita de papas fritas esta correlacionado con el consumo promedio percapita de las otras comunas de la misma región.</p>
<p>Primero tenemos que calcular el consumo per-capita del resto:</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> total_pc_papitas = <span class="kw">total</span>(pc_papitas), <span class="kw">by</span>(region)</span>
<span id="cb235-2"><a href="#cb235-2" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> total_obs = <span class="fu">count</span>(pc_papitas), <span class="kw">by</span>(region)</span>
<span id="cb235-3"><a href="#cb235-3" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> consumo_papitas_resto_pc = <span class="co">///</span></span>
<span id="cb235-4"><a href="#cb235-4" aria-hidden="true" tabindex="-1"></a>(total_pc_papitas - pc_papitas)/(total_obs - 1)</span></code></pre></div>
<p>Ahora podemos ver si existe correlación. ¿Pero si queremos cambiar el nivel de agregación? Tal vez si existe correlación, pero a nivel de área metropolitana. Copiemos el código de nuevo y calculemos esto.</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> total_pc_papitas = <span class="kw">total</span>(pc_papitas), <span class="kw">by</span>(metroarea)</span>
<span id="cb236-2"><a href="#cb236-2" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> total_obs = <span class="fu">count</span>(pc_papitas), <span class="kw">by</span>(region)</span>
<span id="cb236-3"><a href="#cb236-3" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> consumo_papitas_restometro_pc = <span class="co">///</span></span>
<span id="cb236-4"><a href="#cb236-4" aria-hidden="true" tabindex="-1"></a>(total_pc_papitas - pc_papitas)/(total_obs - 1)</span></code></pre></div>
<p>Noten que hay un error. Se nos olvido remplazar región por <code>metroarea</code>. Este error se puede propagar si seguimos haciendo operaciones.</p>
<p>Una alternativa al copiar y pega es escribir una función con propósito general que calcule la variable que deseamos bajo distintos parámetros.</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> consumo_papitas_resto </span>
<span id="cb237-2"><a href="#cb237-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">syntax</span>, invar(varname) outvar(<span class="bn">name</span>) byvar(varname)</span>
<span id="cb237-3"><a href="#cb237-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">tempvar</span> tot_invar count_invar </span>
<span id="cb237-4"><a href="#cb237-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">egen</span> <span class="ot">`tot_invar&#39;</span> = <span class="kw">total</span>(<span class="ot">`invar&#39;</span>), <span class="kw">by</span>(<span class="ot">`byvar&#39;</span>)</span>
<span id="cb237-5"><a href="#cb237-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">egen</span> <span class="ot">`count_invar&#39;</span> = <span class="fu">count</span>(&#39;invar&#39;), <span class="kw">by</span>(&#39;byvar&#39;) </span>
<span id="cb237-6"><a href="#cb237-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">gen</span> <span class="ot">`outvar&#39;</span> = (<span class="ot">`tot_invar&#39;</span> - <span class="ot">`invar&#39;</span>) <span class="co">///</span></span>
<span id="cb237-7"><a href="#cb237-7" aria-hidden="true" tabindex="-1"></a>    / (<span class="ot">`count_invar&#39;</span> - 1) </span>
<span id="cb237-8"><a href="#cb237-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> </span></code></pre></div>
<p>Con el programa podemos escribir los bloques de código anteriores como:</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a>* Caso 1 </span>
<span id="cb238-2"><a href="#cb238-2" aria-hidden="true" tabindex="-1"></a>consumo_papitas_resto, invar(pc_papitas) <span class="co">///</span></span>
<span id="cb238-3"><a href="#cb238-3" aria-hidden="true" tabindex="-1"></a>outvar(consumo_papitas_resto_pc) byvar(region)</span>
<span id="cb238-4"><a href="#cb238-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-5"><a href="#cb238-5" aria-hidden="true" tabindex="-1"></a>* Caso 2</span>
<span id="cb238-6"><a href="#cb238-6" aria-hidden="true" tabindex="-1"></a>consumo_papitas_resto, invar(pc_papitas)  <span class="co">///</span></span>
<span id="cb238-7"><a href="#cb238-7" aria-hidden="true" tabindex="-1"></a>outvar(consumo_papitas_restometro_pc) byvar(metroarea)</span></code></pre></div>
<p>Hemos escrito la función de forma totalmente general. Podemos cambiar el nivel de agregación sin inducir errores.</p>
</div>
<div id="documentación-y-comentarios" class="section level4 hasAnchor" number="3.1.2.10">
<h4 class="hasAnchor"><span class="header-section-number">3.1.2.10</span> Documentación y comentarios<a href="#documentación-y-comentarios" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>No escribas documentación que no vas a mantener.</li>
<li>Códigos deben ser autoexplicativos.</li>
<li>Imaginemos queremos estimar una elasticidad de demanda para hacer un análisis de bienestar.</li>
</ul>
<div class="sourceCode" id="cb239"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a>* Elasticidad = Cambio porcentual en la cantidad ç</span>
<span id="cb239-2"><a href="#cb239-2" aria-hidden="true" tabindex="-1"></a>   / Cambio Porcentual en precio</span>
<span id="cb239-3"><a href="#cb239-3" aria-hidden="true" tabindex="-1"></a>* Elasticidad = -0,4 / 0,2 = -2</span>
<span id="cb239-4"><a href="#cb239-4" aria-hidden="true" tabindex="-1"></a>* Mirar Informe 1, Tabla 2A.</span>
<span id="cb239-5"><a href="#cb239-5" aria-hidden="true" tabindex="-1"></a>    calcular_perdida_bienestar, elasticidad(3)</span></code></pre></div>
<p>Problema: código contradice comentario. Cuando tenemos dos fuentes o más fuentes que informan sobre el mismo objeto, es probable que estas se puedan contradecir. El problema de inconsistencia interna es especialmente importante para documentación, comentarios, notas, etc.</p>
<ul>
<li>Para evitar este problema es necesario mantener los comentarios al día tal como se hace con los códigos.</li>
<li>Hacer esto es costoso. Mantener un código extenso al mismo tiempo que una larga documentación no es sencillo.</li>
<li>Dado esta restricción, es importante .</li>
<li>Volviendo al ejemplo. ¿Como le decimos al lector del código debe tener una elasticidad de 2 y no de 3?</li>
</ul>
<p>Ejemplo de un código auto-explicativo:</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a>* Mirar Informe 1: Tabla 2A. </span>
<span id="cb240-2"><a href="#cb240-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">local</span> cambio_porcentual_cantidad = -0,4</span>
<span id="cb240-3"><a href="#cb240-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">local</span> cambio_porcentual_precio = 0,2 </span>
<span id="cb240-4"><a href="#cb240-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">local</span> elasticidad = <span class="ot">`cambio_porcentual_cantidad&#39;</span> <span class="co">///</span></span>
<span id="cb240-5"><a href="#cb240-5" aria-hidden="true" tabindex="-1"></a>  / <span class="ot">`cambio_porcentual_precio&#39;</span></span>
<span id="cb240-6"><a href="#cb240-6" aria-hidden="true" tabindex="-1"></a>  calcular_perdida_bienestar, elasticidad(<span class="ot">`elasticidad&#39;</span>) </span></code></pre></div>
<p>Menos comentarios que el anterior. <strong>Sin números mágicos</strong>. Pero es más informativo e interno consistentemente dado que no puedo cambiar algunos de los parámetros sin modificar el resultado. Comentarios sirven en su justa medida: es imposible desprender del mismo código sin saber la tabla.</p>
</div>
<div id="identificadores-únicos" class="section level4 hasAnchor" number="3.1.2.11">
<h4 class="hasAnchor"><span class="header-section-number">3.1.2.11</span> Identificadores únicos<a href="#identificadores-únicos" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Bases de datos con Identificadores únicos</p>
<ul>
<li>ID permiten saber la unidad de observación (hogar, empresas, lugares, etc).</li>
<li>Conocer ID únicos es esencial para entender los datos. Indican que es lo que describen los datos.</li>
<li>También nos sirven para entender como juntar estos datos con otras fuentes de información.<br />
</li>
<li>Dos reglas que siempre tener en cuenta:
<ul>
<li>No tienen que existir observaciones duplicadas que tengan el mismo ID único.</li>
<li>Los ID no pueden tener <em>missings</em>.</li>
</ul></li>
<li>Una forma de verificar estos dos hechos es utilizando el comando <code>isid</code>. Este comando chequea si las variables especificadas identifican únicamente a las observaciones. Si esto no ocurre arrojara el siguiente mensaje:</li>
</ul>
<div class="sourceCode" id="cb241"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="kw">variable</span> does <span class="kw">not</span> uniquely identify the observations</span></code></pre></div>
<p>Si encuentro plausible que alguna variable tenga <em>missing</em> puedo colocar la opción <code>missok</code>.</p>
</div>
<div id="no-ser-repetitivo" class="section level4 hasAnchor" number="3.1.2.12">
<h4 class="hasAnchor"><span class="header-section-number">3.1.2.12</span> No ser repetitivo<a href="#no-ser-repetitivo" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Hemos hablado de evitar ser repetitivo. ¿Cuándo hacerlo? Repetir en una operación simple con dos categorías es razonable.</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="kw">xtile</span> decil_ing_ga = ing <span class="kw">if</span> grupo==<span class="st">&quot;A&quot;</span>, nq(10)</span>
<span id="cb242-2"><a href="#cb242-2" aria-hidden="true" tabindex="-1"></a><span class="kw">xtile</span> decil_ing_gb = ing <span class="kw">if</span> grupo==<span class="st">&quot;B&quot;</span>, nq(10)</span></code></pre></div>
<p>Si tengo que operar 15 veces, mejor hacerlo iterativamente:</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> <span class="fu">y</span> = 2001/2015 {</span>
<span id="cb243-2"><a href="#cb243-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">xtile</span> decil_ing_<span class="ot">`y&#39;</span> = inn <span class="kw">if</span> año == <span class="ot">`y&#39;</span>, nq(10)</span>
<span id="cb243-3"><a href="#cb243-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Si involucra múltiples operaciones. A pesar de que solo existan dos categorías, es mejor hacerlo iterativo.</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> g <span class="kw">in</span> <span class="st">&quot;A&quot;</span> <span class="st">&quot;B&quot;</span> {</span>
<span id="cb244-2"><a href="#cb244-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">assert</span> ingreso &gt;= 0 <span class="kw">if</span> grupo == <span class="st">&quot;`g&#39;&quot;</span></span>
<span id="cb244-3"><a href="#cb244-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">xtile</span> decil_ingreso_<span class="ot">`g&#39;</span> = ingreso <span class="co">/// </span></span>
<span id="cb244-4"><a href="#cb244-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> grupo==<span class="st">&quot;`g&#39;&quot;</span>  &amp; ingreso &gt; 0, nq(10)  </span>
<span id="cb244-5"><a href="#cb244-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">replace</span> decil_ingreso_<span class="ot">`g&#39;</span> = 0 <span class="co">/// </span></span>
<span id="cb244-6"><a href="#cb244-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> grupo==<span class="st">&quot;`g&#39;&quot;</span>  &amp; ingreso == 0</span>
<span id="cb244-7"><a href="#cb244-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">label</span> <span class="kw">var</span> decil_ingreso_<span class="ot">`g&#39;</span> <span class="st">&quot;Deciles de ingreso&quot;</span></span>
<span id="cb244-8"><a href="#cb244-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Un ejemplo de convención para evitar ser repetitivos:</p>
<ul>
<li>Cuando necesites cambiar <strong>solo una cosa</strong> en el código utilizar un <em>loop</em>. <code>foreach</code> y <code>forvalues</code> iteran por el mismo código múltiples veces, cambiando el valor de una variable local cada vez.</li>
<li>Cuando necesites cambiar <strong>múltiples cosas</strong> dentro de un código, define un programa dentro del do-file utilizando <code>program</code>. De este modo tu podrás especificar más de un argumento.</li>
<li>Cuando necesites repetir un código en <strong>múltiples do.files</strong>, pueden definir un programa en un <code>ado-file</code>, guardarlo y llamarlo cuando lo necesites. Es importante que el código agregue automáticamente la ruta en donde se encuentran guardados estos programas.</li>
</ul>
<p>Algunas ayudas:
* Cuando algunas lineas de código necesiten cambiar entre repeticiones utilizar <code>if/else</code> y <code>forvalues</code>. Estos iteran por el mismo código múltiples veces, cambiando el valor de una variable local cada vez.
* Cuando definas programas dentro de un do-file, agrega una linea que diga <code>cap program drop &lt;program_name&gt;</code> antes de <code>program define</code>. Automáticamente se eliminará y redefinirá el programa cada vez que ejecutes el código.</p>
<p>Mensajes finales sobre estilo de codificación</p>
<ul>
<li>Haz las cosas lo más simples posibles para ti (y tu equipo) de hoy y del futuro.</li>
<li>No confíes tanto en ti de hoy y menos en el del futuro. Es mejor programar <strong>defensivamente</strong>.</li>
<li>Ser consistente en formato, estilo, organización y nombres. Sigue estrategias.</li>
<li>Reducir en lo posible pegado y repetición.</li>
<li>Testear regularmente.</li>
<li>Documentar a menudo, estratégicamente, pero mínimamente.</li>
</ul>
</div>
</div>
</div>
<div id="buenas-practicas-de-programación-y-visualización-parte-ii" class="section level2 hasAnchor" number="3.2">
<h2 class="hasAnchor"><span class="header-section-number">3.2</span> Buenas practicas de programación y visualización (Parte II)<a href="#buenas-practicas-de-programación-y-visualización-parte-ii" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="organización-de-un-proyecto-en-stata" class="section level3 hasAnchor" number="3.2.1">
<h3 class="hasAnchor"><span class="header-section-number">3.2.1</span> Organización de un proyecto en Stata<a href="#organización-de-un-proyecto-en-stata" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="flujo-de-trabajo-en-stata" class="section level4 hasAnchor" number="3.2.1.1">
<h4 class="hasAnchor"><span class="header-section-number">3.2.1.1</span> Flujo de trabajo en Stata<a href="#flujo-de-trabajo-en-stata" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Hasta el momento uno de los mayores mensajes es <strong>adoptar un sistema de organización</strong> compartirlo en el equipo y adherirse a él. Este debe incluir:</p>
<ol style="list-style-type: decimal">
<li>Estructuras de directorio.</li>
<li>Estilo de codificación.<br />
</li>
<li>Convenciones para escribir nombres.<br />
</li>
<li>Convenciones para exportar datos.</li>
</ol>
<p>Hemos visto en detalle (2) y (3). Algunas cosas de (4) (más detalles en Sección 3.6). En esta sección nos enfocaremos en (1). Esta sección se basa en una de las guías de <a href="https://asjadnaqvi.medium.com/">Asjad Nqvi</a>. Muy buenos recursos. Muy recomendado. También revisaremos algunos elementos de ().
* Un proyecto de análisis de datos contempla: planificar el trabajo, documentar las actividades, crear y verificar variables, generar y presentar análisis estadístico, replicar resultados y archivar.
* Todo lo anterior es a lo que nos referiremos como flujo de trabajo.
* Un buen flujo de trabajo es esencial para que tu y tus colaboradores(as) y los interesados en tu trabajo puedan replicarlo.
* Replicar es clave para generar información confiable y correcta.</p>
<p>La administración del flujo de trabajo se hace al <strong>inicio</strong> de un proyecto. No al final. No hacerlo así tiene costos en tiempo y posiblemente induzca errores no forzados. Veremos algunos aspectos relacionados con la administración de datos y <em>scripts</em>. Nuevamente, más que reglas a seguir, lo presentado aquí son una serie de buenas practicas que pueden ayudar a mejorar la gestión del trabajo con Stata. La idea de esto es que finalmente podamos dedicarle más y mejor tiempo al análisis de datos.</p>
<div class="alert alert-block alert-info">
<p><b>, prefacio.</b></p>
When I started, I thought my workflow <span style="color:red"> “was very good and that it was simply a matter of recording what I did”, “red”
</style>
. As writing proceeded (<strong>this book</strong>), I discovered gaps, inefficiencies, and inconsistencies in what I did. Sometimes these involved procedures that I knew were awkward, but where <span style="color:red"> “I never took the time to find a better approach”, “red”
</style>
<p>. Some problems were due to oversights where I had not realized the consequences of the things I did or failed to do.</p>
</div>
</div>
<div id="organización-de-archivos-y-carpetas" class="section level4 hasAnchor" number="3.2.1.2">
<h4 class="hasAnchor"><span class="header-section-number">3.2.1.2</span> Organización de archivos y carpetas<a href="#organización-de-archivos-y-carpetas" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>¿Les suena familiar?</p>
<ul>
<li>Tener múltiples versiones de un archivo y no saber cual es cual.</li>
<li>No poder encontrar un archivo y pensar que lo has borrado.</li>
<li>Tu equipo (y tú) no saben cual es el informe final. Hay dos archivos que con el nombre archivo final, pero con distinto contenido.</li>
</ul>
<p>Para evitar los problemas anteriores es importante diseñar la estructura de la carpeta de trabajo y comprometerse a seguir una alerta.</p>
<p>Carpetas</p>
<ul>
<li>Todo se guarda en carpetas. <strong>TODO</strong>.</li>
<li>Estas deben seguir un orden lógico e intuitivo. Como consejo. Colocar números en la carpeta. Al ordenar las carpetas seguirán este orden y no el alfabético.</li>
<li>No tener espacios en el nombre de las carpetas.</li>
<li>Nunca utilizar (-) entre nombres de una carpeta. Utilizar (_).</li>
<li>Evitar nombrar las carpetas con mayúsculas.</li>
<li>Siempre escribir un <code>README.txt</code>. Puede ser tedioso, pero muy necesario. Corto, informativo, que explique el flujo de trabajo y las carpetas. Sugerencia: colocar las rutas.</li>
</ul>
<div class="figure">
<img src="C2.2.1.png" alt="" />
<p class="caption">Proyecto muy pequeño</p>
</div>
<div class="figure">
<img src="C2.2.2.png" alt="" />
<p class="caption">Proyecto pequeño</p>
</div>
<div class="figure">
<img src="C2.2.3.png" alt="" />
<p class="caption">Proyecto grande</p>
</div>
<div class="figure">
<img src="C2.2.4.png" alt="" />
<p class="caption">Otro ejemplo de proyecto. Ejemplo de </p>
</div>
<p>Es importante generar dos tipos de carpetas para los resultados <code>trabajo</code> y otras que diga <code>compartir</code>.</p>
<ul>
<li><code>trabajo</code> guarda todos los resultados (ej. tablas, gráficos, documentos) que están siendo trabajados.</li>
<li><code>compartir</code> guarda resultados terminados y listos para compartir en alguna etapa del proyecto. Por ejemplo, cuando se quieran compartir resultados intermedios del proyecto.</li>
</ul>
<p>Dos reglas:</p>
<ul>
<li>Resultados se comparten solo después que los archivos que lo generan pasen a la carpeta <code>compartir</code>.</li>
<li>Una vez traspasados a la carpeta compartir. No se modifican. Incluso cuando puedan existir errores.</li>
</ul>
<p>Ayuda a garantizar que los resultados que se comparte se puedan replicar. Si encuentras errores o decides cambiar algo no cambies los ya posteados. Genera nuevos. Esto también ayuda a la replicabilidad: permite saber que cambios existieron durante un proyecto.</p>
<p>Un directorio de trabajo estructurado es especialmente <strong>importante para proyectos colaborativos</strong> donde todo se puede desordenar mas fácilmente. Dos directorios son sugeridos cuando se trabaja de forma colaborativa: <code>correo</code> y otras que diga <code>privados</code>. <code>correo</code> guarda intercambios entre colaboradoras mientras que <code>privados</code> guarda el trabajo propio de cada colaborador(a). Otras carpetas que pueden complementar trabajo son <code>porhacer</code> que sea una carpeta que sirva como una lista de tareas <code>poraprender</code>. En cualquier caso, estas carpetas pueden ser parte de <code>privados</code>.</p>
<p>Cuando se tengan versiones se pueden utilizar dos modos:</p>
<ul>
<li>v1, v2, v3, etc.</li>
<li>Fechas. Si se utilizan estas escribirlo en año/mes/día. De esta forma se ordenara automáticamente desde el último al primero.</li>
</ul>
<p>Cuando versiones anteriores no te sean útiles. <strong>Borralas!</strong> No acumules archivos y códigos porque sí. Si por alguna razón deseas dejarlos (ej. necesidad de respaldar lo hecho). Genera una carpeta temporal. Esta puede estar en tú versión personal del proyecto, pero no en el archivo final.</p>
<p>Master do-file</p>
<ul>
<li>Diferentes <code>do-files</code> para diferentes tareas.</li>
<li>Separar en secciones y subsecciones. Por ejemplo: Preámbulo, cargar datos, generar variables, figura I, Tabla 3, etc.</li>
<li>Crear <code>master_do.files</code> cada proyecto o subproyecto debe tener un archivo maestro que ejecute <strong>todos</strong> los códigos de inicio a fin y genere todos los resultados.</li>
<li>Cada vez que se termine un proyecto o se obtenga algún resultado es importante ejecutar el <code>master_do.files</code>.</li>
</ul>
<p>Ejemplo de master do-file:</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a>  *** Información del proyecto aquí ***</span>
<span id="cb245-2"><a href="#cb245-2" aria-hidden="true" tabindex="-1"></a>  *** Información sobre directorios ***</span>
<span id="cb245-3"><a href="#cb245-3" aria-hidden="true" tabindex="-1"></a>  *** Ejecutar códigos ***</span>
<span id="cb245-4"><a href="#cb245-4" aria-hidden="true" tabindex="-1"></a>  * Generación <span class="kw">de</span> datos</span>
<span id="cb245-5"><a href="#cb245-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">do</span> ./dofiles/01_datos_v11.<span class="kw">do</span> </span>
<span id="cb245-6"><a href="#cb245-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">do</span> ./dofiles/02_merge_v2.<span class="kw">do</span> </span>
<span id="cb245-7"><a href="#cb245-7" aria-hidden="true" tabindex="-1"></a>  * Generación <span class="kw">de</span> tablas</span>
<span id="cb245-8"><a href="#cb245-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">do</span> ./dofiles/03_tablas_v4.<span class="kw">do</span> </span>
<span id="cb245-9"><a href="#cb245-9" aria-hidden="true" tabindex="-1"></a>  * Estimación principal</span>
<span id="cb245-10"><a href="#cb245-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">do</span> ./dofiles/04_estimaciones_v11.<span class="kw">do</span> </span>
<span id="cb245-11"><a href="#cb245-11" aria-hidden="true" tabindex="-1"></a>  * Figuras principales</span>
<span id="cb245-12"><a href="#cb245-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">do</span> ./dofiles/05_graficos_v11.<span class="kw">do</span> </span></code></pre></div>
<p>Rutas de las carpetas:</p>
<ul>
<li>Es importante tener una carpeta principal y referenciar todas las rutas a esa dirección.</li>
<li>Utilizar siempre <code>/</code> no <code>\textbackslash</code>. Puede causar problemas según el sistema operativo que utilices.</li>
<li>Utilizar macros para nombrar a las carpetas. Que estos nombres tengan sentido y se relacionen con el flujo de trabajo.</li>
<li>Recordar que una variable <code>local</code> guarda información temporalmente mientras que <code>global</code> guarda información permanentemente. Esto último hace de los <code>global</code> algo no recomendable de utilizar constantemente. No obstante, es útil para los directorios.</li>
</ul>
<div class="sourceCode" id="cb246"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a>   *** Nota 1: Remplazar esta ruta ***</span>
<span id="cb246-2"><a href="#cb246-2" aria-hidden="true" tabindex="-1"></a>   <span class="kw">global</span> miproyecto <span class="st">&quot;C://Program Files/Dropbox/miproyecto/&quot;</span></span>
<span id="cb246-3"><a href="#cb246-3" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb246-4"><a href="#cb246-4" aria-hidden="true" tabindex="-1"></a>   *** Nota 2: Directorios <span class="kw">de</span> subcarpetas ***</span>
<span id="cb246-5"><a href="#cb246-5" aria-hidden="true" tabindex="-1"></a>   <span class="kw">clear</span></span>
<span id="cb246-6"><a href="#cb246-6" aria-hidden="true" tabindex="-1"></a>   <span class="kw">global</span> datosbrutos <span class="st">&quot;$miproyecto/datos/brutos&quot;</span></span>
<span id="cb246-7"><a href="#cb246-7" aria-hidden="true" tabindex="-1"></a>   cd <span class="st">&quot;$datosbrutos&quot;</span></span>
<span id="cb246-8"><a href="#cb246-8" aria-hidden="true" tabindex="-1"></a>   <span class="kw">use</span> datos1.dta, <span class="kw">replace</span> </span></code></pre></div>
</div>
</div>
<div id="buenas-practicas-de-visualización" class="section level3 hasAnchor" number="3.2.2">
<h3 class="hasAnchor"><span class="header-section-number">3.2.2</span> Buenas practicas de visualización<a href="#buenas-practicas-de-visualización" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="principios-de-una-buena-visualización-de-datos" class="section level4 hasAnchor" number="3.2.2.1">
<h4 class="hasAnchor"><span class="header-section-number">3.2.2.1</span> Principios de una buena visualización de datos<a href="#principios-de-una-buena-visualización-de-datos" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Un gráfico mal hecho desinforma, gráficos mal hechos son inefectivos. Comunican mal la información o incluso la distorsionan. Las personas tenemos un procesamiento visual limitado. Existe uno previo e inconsciente y uno posterior consciente. Entender este aspecto es importante si queremos diseñar visualizaciones que sean efectivas.</p>
<p>Esta sección esta basada en <strong>An Economist’s Guide to Visualizing Data</strong> ().</p>
<p>Tres principios básicos</p>
<ul>
<li>Mostrar los datos
<ul>
<li>Es la parte más importante del gráfico.</li>
<li>No mostrar ni mucho, ni muy poco.</li>
</ul></li>
<li>Disminuir distractores.
<ul>
<li>Disminuir el uso de elementos visuales no útiles para entender los datos.</li>
<li>Símbolos innecesarios, texto, texturas son ejemplos de elementos visuales no útiles. * Integrar el texto al gráfico</li>
<li>El gráfico debe ser capaz de complementar el texto y al mismo tiempo contener suficiente información para estar sin él.</li>
</ul></li>
</ul>
</div>
<div id="siete-gráficos-alternativos" class="section level4 hasAnchor" number="3.2.2.2">
<h4 class="hasAnchor"><span class="header-section-number">3.2.2.2</span> Siete gráficos alternativos<a href="#siete-gráficos-alternativos" class="anchor-section" aria-label="Anchor link to header"></a></h4>
</div>
</div>
<div id="sublime-text" class="section level3 hasAnchor" number="3.2.3">
<h3 class="hasAnchor"><span class="header-section-number">3.2.3</span> Sublime Text<a href="#sublime-text" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Esta sección esta basada en la página web de <a href="https://acarril.github.io/">Alvaro Carril</a>.</p>
<div id="qué-es-sublime" class="section level4 hasAnchor" number="3.2.3.1">
<h4 class="hasAnchor"><span class="header-section-number">3.2.3.1</span> ¿Qué es Sublime?<a href="#qué-es-sublime" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><a href="https://www.sublimetext.com/">Sublime Text</a> es un editor de códigos gratuito. Este editor permite compilar códigos de distintos lenguajes de programación tales como Stata, Python, R, , entre muchos otros.</p></li>
<li><p>Tiene algunas herramientas que facilitan el trabajo de programación tales como atajos (<em>shortcuts</em>) o multicolumnas. Veremos varias en esta sección.
Es muy útil cuando tienes un proyecto grande con códigos de distintos tipos de lenguaje.
Instalar Sublime</p></li>
<li><p>Dirígete a <a href="https://www.sublimetext.com/">sublimetext.com</a>. Descarga e instala Sublime Text 4 (ST4) para tu sistema operativo.</p></li>
<li><p>Es esencial que también instales <code>Package Control</code>, que te permite añadir y eliminar fácilmente complementos adicionales. Si esta bien instalado debiese aparecer en <em>preferences.</em></p></li>
<li><p>Para installar hay que entrar a sublime, apretar <code>ctrl + shift + p</code>.</p></li>
<li><p>Tipear <code>Install Package Control</code> y presionar <code>enter</code>.</p></li>
</ul>
</div>
<div id="ejecutar-stata-desde-sublime" class="section level4 hasAnchor" number="3.2.3.2">
<h4 class="hasAnchor"><span class="header-section-number">3.2.3.2</span> Ejecutar Stata desde Sublime<a href="#ejecutar-stata-desde-sublime" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Para Windows</p>
<ul>
<li><strong>Instalar StataEditor:</strong> En ST4 aprete <code>ctrl+shift+p</code>. Escriba <code>install</code> y presione <code>Enter</code>. Ahora busque <code>StataEditor</code> y haga clic en él para instalarlo.</li>
<li><strong>Instale Pywin32:</strong> repita el proceso anterior pero instalando el complemento <code>Pywin32</code>.</li>
</ul>
<p>Configure StataEditor:</p>
<ul>
<li>En ST4 vaya a <code>Preferences -&gt; Package Settings -&gt; StataEditor -&gt; Settings - Users</code></li>
<li>En este archivo en blanco debe escribir la ruta de su ejecutable de Stata y la versión que posee.</li>
<li>Mi archivo de configuración en Windows se ve así:</li>
</ul>
<div class="sourceCode" id="cb247"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb247-2"><a href="#cb247-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;stata_path&quot;</span>: <span class="st">&quot;C:/Program Files/Stata17/StataMP-64.exe&quot;</span>,</span>
<span id="cb247-3"><a href="#cb247-3" aria-hidden="true" tabindex="-1"></a>   <span class="st">&quot;stata_version&quot;</span>: 17,</span>
<span id="cb247-4"><a href="#cb247-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Registre la biblioteca de automatización de Stata:</p>
<ul>
<li>Vaya al ejecutable de Stata del que ha copiado la ruta (por ejemplo, StataMP-64.exe).</li>
<li>Cree un acceso directo en su escritorio.</li>
<li>Ahora haga clic con el botón derecho en este nuevo acceso directo y seleccione ``Propiedades”.</li>
<li>En el campo ``Destino”, añada /Registro al final (con un espacio precedente). En mi caso es:</li>
</ul>
<div class="sourceCode" id="cb248"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;C:\Program Files\Stata17\StataMP-64.exe&quot;</span> /Register</span></code></pre></div>
<p>Aplicar y aceptar los cambios. Apretar sobre el acceso directo el click derecho y ejecutar como administrador. Y listo!</p>
<p>Para Mac</p>
<ul>
<li>Para instalar el Editor Mejorado de Stata en ST4, inicie la paleta de comandos con <code>Cmd+shift+p</code>, escriba `<code>install" y presione</code>Enter`.</li>
<li>Ahora busque <code>Stata Improved Editor</code> y haga clic en él para instalarlo.</li>
<li>Reinicie ST4 y listo!</li>
</ul>
<p>Autoguardado</p>
<ul>
<li>Sublime permite auto-guardar los códigos.</li>
<li>De esta forma no hay que preocuparse en casos de que no hayas respaldado tu código.</li>
<li>Para esto hay que escribir vamos a instalar el paquete <code>autosave</code> y adicionalmente vamos a agregar a ``preferencias”:</li>
</ul>
<div class="sourceCode" id="cb249"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a>``save_on_focus_lost<span class="st">&quot;: true.</span></span></code></pre></div>
<p>Codificación colaborativa</p>
<ul>
<li>Para trabajo colaborativo existen editores de códigos que se enfocan en que dos o más personas puedan programar desde sus computadoras.</li>
<li>Una buena página es <a href="https://codeshare.io/bvz4Ow">Code Share</a></li>
<li>Muy útil para pedir ayuda o hacer una revisión final.</li>
</ul>
</div>
</div>
</div>
<div id="programar-do---files-parte-i" class="section level2 hasAnchor" number="3.3">
<h2 class="hasAnchor"><span class="header-section-number">3.3</span> Programar do - files (Parte I)<a href="#programar-do---files-parte-i" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="programar-en-stata" class="section level3 hasAnchor" number="3.3.1">
<h3 class="hasAnchor"><span class="header-section-number">3.3.1</span> Programar en Stata<a href="#programar-en-stata" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Esta sección esta basada en: <strong>An introduction to Stata Programing</strong> (), en notas de clase de la profesora <a href="https://www.erinhengel.com/">Erin Hengel</a>, en <strong>Advanced Stata Topics</strong> del profesor Alexander C. Lembcke, en <strong>Seventy-six Stata tips</strong> , en <strong>Top 10 ``gotchas”</strong> de y en <strong>Data Management Using Stata. A Practical Handbook</strong> de .</p>
<div id="qué-es-programar-en-stata" class="section level4 hasAnchor" number="3.3.1.1">
<h4 class="hasAnchor"><span class="header-section-number">3.3.1.1</span> ¿Qué es programar en Stata?<a href="#qué-es-programar-en-stata" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Programar en Stata es:</p>
<ul>
<li>Escribir <code>do - files</code>: una secuencia de comandos ejecutables a través de un archivo <code>.do</code>.</li>
<li>Escribir los que formalmente en Stata es un <em>programa</em>: un conjunto de comandos que incluyen el comando <code>program</code>. Un programa en Stata se guarda como un <em>ado - file</em>.</li>
<li>Escribir lenguaje de programación matricial: denominado mata.</li>
</ul>
</div>
<div id="do---files" class="section level4 hasAnchor" number="3.3.1.2">
<h4 class="hasAnchor"><span class="header-section-number">3.3.1.2</span> do - files<a href="#do---files" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>El uso de <code>do-file</code> garantiza la replicabilidad del análisis de datos utilizando Stata. Recordar que un <code>do-file</code> puede llamar a otros (ej. <code>master do.file</code>. La jerarquización de los <code>do-file</code> puede ser importante para proyectos grandes o complejos. Es importante evitar trabajar en Stata interactivamente. Únicamente hay que hacerlo para inspeccionar datos (recordar practicas Sección 3.1).</p>
</div>
<div id="ado---files" class="section level4 hasAnchor" number="3.3.1.3">
<h4 class="hasAnchor"><span class="header-section-number">3.3.1.3</span> ado - files<a href="#ado---files" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Sirven para crear tus propios en Stata. Una vez que armes tu programa y lo guardes en la carpeta de <code>ado-file</code> puedes utilizarlo como cualquier otro comando de Stata. Por ejemplo, puedes agregar las opciones <em>if</em>, <em>in range</em> y otras. También puedes escribir un documento de ayuda (<em>help</em>} que explique el programa. Crear tus propios comandos es una muy buena forma de ser más eficiente al trabajar con Stata (recordar Sección 1).</p>
<p>Mata para ado-files: Los <code>ado-files</code> pueden realizar tareas más complejas que involucren ejecutar el comando múltiples veces.</p>
<ul>
<li>El lenguaje de programación mata es mucho más rápido que un <code>ado-file</code>.</li>
<li>Útil para realizar tareas que sean intensivas computacionalmente.</li>
<li>No es solo un lenguajes de programación que utiliza matrices. También sirve para tareas que involucran texto o listas.</li>
<li>Próximante discutiremos este lenguaje.</li>
</ul>
</div>
</div>
<div id="comandos-y-funciones-claves-y-algunos-detalles" class="section level3 hasAnchor" number="3.3.2">
<h3 class="hasAnchor"><span class="header-section-number">3.3.2</span> Comandos y funciones claves (y algunos detalles)}<a href="#comandos-y-funciones-claves-y-algunos-detalles" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Revisaremos algunos aspectos necesarios para mejorar la eficiencia al trabajar en Stata.</p>
<ul>
<li>Directorios y uso de <code>profile.do</code>.</li>
<li>Tipos de comandos.</li>
<li>Tipos de datos y uso de <code>compress</code>.</li>
<li>Uso de <code>capture</code>, <code>preserve</code> y <code>restore</code>.</li>
</ul>
<div id="directorios" class="section level4 hasAnchor" number="3.3.2.1">
<h4 class="hasAnchor"><span class="header-section-number">3.3.2.1</span> Directorios<a href="#directorios" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><code>cd</code> y <code>pwd</code> sirven para fijar y conocer mis directorios. Es importante utilizar <strong>dobles comillas</strong> en los casos en que la ruta del directorio tenga espacios.</li>
<li>El comando <code>sysdir</code> provee una lista de los directorios importantes para Stata.</li>
<li>El comando <code>update</code> sirve para actualizar los comandos.</li>
<li>La carpeta <code>PLUS</code> es el directorio donde se guardan comandos descargados. Si utilizas <code>ssc</code>, se guardara en esta carpeta.<br />
</li>
<li><code>PERSONAL</code> para tus propios <code>ado-files</code>.</li>
</ul>
</div>
<div id="profile-do" class="section level4 hasAnchor" number="3.3.2.2">
<h4 class="hasAnchor"><span class="header-section-number">3.3.2.2</span> Profile do<a href="#profile-do" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>¿Qué es profile do?</p>
<ul>
<li>Una opción no tan conocida es la utilización de <code>profile.do</code></li>
<li>Este archivo se ejecuta cada vez que Stata se inicia. Si no tienes uno guardado no pasa nada.</li>
<li>Este <code>do-file</code> permite, por ejemplo, fijar tu directorio de trabajo inicial, cambiar características de los gráficos, generar atajos.<br />
</li>
<li>También se puede hacer que Stata abra un log-file y lo guarde siempre en el mismo lugar.</li>
<li>Cada vez que inicies sesión Stata ira por <code>profile.do</code>. Si lo encuentra lo va a ejecutar.<br />
</li>
<li>Stata recomienda guardar <code>profile.do</code> en <em>home directory</em> (ver <em>help profilew para ususarios de windows y profilem para Mac</em>).</li>
<li>Vamos a ver como modificar <code>profile.do</code>. En particular:
<ul>
<li>Ajustes generales.</li>
<li>Establecer las características de los gráficos.</li>
<li>Establecer atajos</li>
<li>Abrir, cerrar y guardar un log-file con la fecha.</li>
</ul></li>
</ul>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.3.1:</b></p>
<p>Instrucciones</p>
<ol style="list-style-type: decimal">
<li>Descargar carpeta <em>ejercicios-clase3</em>.</li>
<li>Abrir <code>profile.do</code> e inspeccionar cada una de las lineas del código.</li>
</ol>
<p>Preguntas</p>
<ol style="list-style-type: decimal">
<li>Agrega dos elementos a alguna sección.</li>
<li>Modifica las carpetas según las características de tu computadora.</li>
<li>Guarda <code>profile.do</code> en el <em>home directory</em>. Ejecutar nuevamente Stata y verificar que el código se ha ejecutado.</li>
</ol>
</div>
</div>
<div id="tipos-de-comandos" class="section level4 hasAnchor" number="3.3.2.3">
<h4 class="hasAnchor"><span class="header-section-number">3.3.2.3</span> Tipos de comandos<a href="#tipos-de-comandos" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Comandos r-class y e-class</p>
<ul>
<li>Muchos comandos en Stata (ej. <code>summarize</code>, <code>correlate</code>, <code>regress</code>) hacen que sea posible utilizar sus resultados una vez que estos son ejecutados.</li>
<li><code>summarize</code> y <code>correlate</code> son comandos <code>r-class</code>. Es decir, comandos que guardan sus resultados en <code>r()</code>.</li>
<li><code>regress</code> es un comando <code>e-class</code>. Es decir, comandos que guardan sus resultados en <code>e()</code>.</li>
<li><code>return list</code> retorna los valores guardados en <code>r()</code></li>
</ul>
<div class="sourceCode" id="cb250"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a>* <span class="fu">r</span>-<span class="kw">class</span></span>
<span id="cb250-2"><a href="#cb250-2" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto.dta, <span class="kw">clear</span> </span>
<span id="cb250-3"><a href="#cb250-3" aria-hidden="true" tabindex="-1"></a><span class="kw">summarize</span> mpg </span>
<span id="cb250-4"><a href="#cb250-4" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span> <span class="ot">list</span> </span>
<span id="cb250-5"><a href="#cb250-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb250-6"><a href="#cb250-6" aria-hidden="true" tabindex="-1"></a><span class="kw">summarize</span> mpg, <span class="kw">detail</span> </span>
<span id="cb250-7"><a href="#cb250-7" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span> <span class="ot">list</span> </span>
<span id="cb250-8"><a href="#cb250-8" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;La asimetría de mpg es&quot;</span> <span class="fu">r</span>(skewness) </span>
<span id="cb250-9"><a href="#cb250-9" aria-hidden="true" tabindex="-1"></a><span class="kw">summarize</span> price, <span class="kw">detail</span> </span>
<span id="cb250-10"><a href="#cb250-10" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span> <span class="ot">list</span> </span></code></pre></div>
<p>Su limitación es que solo están disponibles los valores del último comando <code>r-class</code> ejecutado.</p>
<p>Los comandos <code>e-class</code> son comandos de <em>estimación</em>. Para verlos <code>ereturn list</code> y para llamarlos individualmente <code>e(nombre)</code>. Guardan más información que los de <code>r-class</code> : matrices, vectores y funciones. La información de los comandos <code>e-class</code> sigue estando disponible una vez que utilizamos algún comando <code>r</code>-class`. <strong>Aquí una diferencia!</strong></p>
<p>Un ejemplo clásico son las estimaciones de regresión lineal.</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="kw">regress</span> mpg <span class="kw">weight</span> <span class="fu">length</span> rep78 </span>
<span id="cb251-2"><a href="#cb251-2" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;La regresión se estimo para &quot;</span> <span class="fu">e</span>(<span class="kw">N</span>) <span class="st">&quot; observaciones.&quot;</span> </span>
<span id="cb251-3"><a href="#cb251-3" aria-hidden="true" tabindex="-1"></a><span class="kw">ereturn</span> <span class="ot">list</span></span></code></pre></div>
<p>En general cualquier comando de estimación se guarda en esta clase de formato.</p>
</div>
<div id="tipos-de-datos" class="section level4 hasAnchor" number="3.3.2.4">
<h4 class="hasAnchor"><span class="header-section-number">3.3.2.4</span> Tipos de datos<a href="#tipos-de-datos" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>numeric y string</p>
<ul>
<li>La mayor distinción entre tipos de datos es entre <em>numeric</em> y <em>string</em>.</li>
<li>Al trabajar con datos muchas veces es necesario realizar conversiones entre estos dos formatos. Los comandos <code>destring</code>, <code>tostring</code> y <code>encode</code> son útiles para estas tareas (si alguien tiene dudas con alguno me escriben).</li>
<li><em>strings</em> pueden soportar un máximo de 244 caracteres con un <code>byte</code> por cada carácter.</li>
<li>Por ejemplo, una variable del tipo <code>str20</code> requiere 20 <code>bytes</code> por observación.</li>
</ul>
<p>Clasificación de los datos</p>
<ul>
<li>Para las variables en formato <em>numeric</em> los tipos de datos son: <code>byte</code>, <code>int</code>, <code>long</code>, <code>float</code> y <code>double</code>.</li>
<li>Los tres primeros solo puede almacenar valores enteros. <code>long</code> puede almacenar todos los números de 9 dígitos, pero es limitado para 10 dígitos.</li>
<li><code>float</code> y <code>double</code> pueden almacenar números grandes.</li>
<li>No asumir que <code>float</code> será aritméticamente exacto. Por ejemplo:</li>
</ul>
<div class="sourceCode" id="cb252"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">float</span>(16777216)</span>
<span id="cb252-2"><a href="#cb252-2" aria-hidden="true" tabindex="-1"></a>        16777216</span>
<span id="cb252-3"><a href="#cb252-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">float</span>(16777217)</span>
<span id="cb252-4"><a href="#cb252-4" aria-hidden="true" tabindex="-1"></a>        16777216</span></code></pre></div>
<p>¿Como utilizar esto para programar efectivamente en Stata?</p>
<ul>
<li>IDs con muchos dígitos (y caracteres) guardarlos como <em>string</em>. No como <code>integers</code>, <code>float</code> o <code>doubles</code>.</li>
<li>No confiar en test exactos contra una constante con datos en formato <code>float</code>. Utilizar formato <code>double</code> para cualquier serie que necesita ser precisa (ej. suma de los residuos de una regresión).</li>
<li>Utiliza <code>integers</code> cuando sea apropiado (ej. variables dicotómicas). Guardar valores como <code>int</code> o <code>byte</code> ayuda a utilizar de forma más eficiente el espacio en el disco.</li>
<li><code>compress</code> examina cada variable y determina si estas pueden ser guardadas de forma más eficiente. <strong>Utilizarlo</strong>.</li>
</ul>
<p>Si se especifican valores iniciales fuera de los rangos permitidos para cada tipo de dato el resultado será un <em>missing</em>.</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span> <span class="ot">all</span> </span>
<span id="cb253-2"><a href="#cb253-2" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="kw">obs</span> 10 </span>
<span id="cb253-3"><a href="#cb253-3" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> <span class="kw">byte</span> var1 = 101</span>
<span id="cb253-4"><a href="#cb253-4" aria-hidden="true" tabindex="-1"></a><span class="kw">summarize</span> var1 </span></code></pre></div>
<p>Notar que no se genera ninguna alerta de <em>missing</em> cuando este se crea. Esto es distinto para variables que ya existen.</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span> <span class="ot">all</span></span>
<span id="cb254-2"><a href="#cb254-2" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="kw">obs</span> 10</span>
<span id="cb254-3"><a href="#cb254-3" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> <span class="kw">byte</span> var1 = 1</span>
<span id="cb254-4"><a href="#cb254-4" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> var1 = 101</span></code></pre></div>
<p>Si el valor esta fuera de los rangos permitidos, la variable se guarda en un formato mayor. <code>byte</code> a <code>int</code>, <code>int</code> a <code>long</code>, a <code>float</code> a <code>double</code>. En este caso un mensaje aparece.</p>
</div>
<div id="capture-preserve-y-restore" class="section level4 hasAnchor" number="3.3.2.5">
<h4 class="hasAnchor"><span class="header-section-number">3.3.2.5</span> capture, preserve y restore<a href="#capture-preserve-y-restore" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Manejando errores: capture</p>
<ul>
<li>Sirve para evitar que Stata aborte cuando detecta un error.</li>
<li>Bueno para cuando quieres borrar algo que ya no se encuentra. Lo malo es que suprime todos los errores y oculta todo lo que puede ir mal.</li>
</ul>
<div class="sourceCode" id="cb255"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="kw">obs</span> 10</span>
<span id="cb255-2"><a href="#cb255-2" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> <span class="kw">byte</span> var1 = 5</span>
<span id="cb255-3"><a href="#cb255-3" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> <span class="kw">byte</span> var2 = 10 </span>
<span id="cb255-4"><a href="#cb255-4" aria-hidden="true" tabindex="-1"></a><span class="kw">capture</span> <span class="kw">drop</span> var1 var2 var3 </span>
<span id="cb255-5"><a href="#cb255-5" aria-hidden="true" tabindex="-1"></a><span class="kw">describe</span> var1 var2</span></code></pre></div>
<p>Código crea <code>var1</code> y <code>var2</code>, luego las elimina incluyendo una variable que no existe. Al contrario de lo que se intuye, no se borran las variables, dado que hay una variable que no existe. La recomendación es siempre utilizar <code>capture</code> con moderación. Puede ser utilizado en bloque para así no tener que utilizarlo en cada linea.</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto.dta, <span class="kw">clear</span></span>
<span id="cb256-2"><a href="#cb256-2" aria-hidden="true" tabindex="-1"></a><span class="kw">capture</span>{</span>
<span id="cb256-3"><a href="#cb256-3" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> price mpg-trunk</span>
<span id="cb256-4"><a href="#cb256-4" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> price mpg-<span class="kw">weight</span></span>
<span id="cb256-5"><a href="#cb256-5" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> price mpg-foreign</span>
<span id="cb256-6"><a href="#cb256-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb256-7"><a href="#cb256-7" aria-hidden="true" tabindex="-1"></a><span class="kw">ereturn</span> <span class="ot">list</span> </span></code></pre></div>
<p>preserve y restore</p>
<ul>
<li>Algunos comandos en Stata remplazan la base actual por una nueva (ej. <code>collapse</code> o <code>contract</code>).</li>
<li>Utilizar <code>preserve</code> y <code>restore</code> es útil en estos casos.</li>
<li>En caso de que queramos obtener estadística descriptiva agregada y asociarla a observaciones podemos utilizar estos comandos.</li>
</ul>
<div class="sourceCode" id="cb257"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a>* Ejemplo con <span class="kw">collapse</span></span>
<span id="cb257-2"><a href="#cb257-2" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto.dta, <span class="kw">clear</span></span>
<span id="cb257-3"><a href="#cb257-3" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> lprice = <span class="fu">log</span>(price)</span>
<span id="cb257-4"><a href="#cb257-4" aria-hidden="true" tabindex="-1"></a><span class="kw">preserve</span></span>
<span id="cb257-5"><a href="#cb257-5" aria-hidden="true" tabindex="-1"></a><span class="kw">collapse</span> (<span class="fu">max</span>) max_lprice=lprice max_mpg=mpg <span class="co">///</span></span>
<span id="cb257-6"><a href="#cb257-6" aria-hidden="true" tabindex="-1"></a>(<span class="fu">iqr</span>) iqr_lprince = lprice iqr_mpg = mpg <span class="kw">if</span> !<span class="fu">missing</span>(rep78), <span class="kw">by</span>(rep78) </span>
<span id="cb257-7"><a href="#cb257-7" aria-hidden="true" tabindex="-1"></a><span class="kw">sort</span> rep78 </span>
<span id="cb257-8"><a href="#cb257-8" aria-hidden="true" tabindex="-1"></a><span class="kw">tempfile</span> repstats</span>
<span id="cb257-9"><a href="#cb257-9" aria-hidden="true" tabindex="-1"></a><span class="kw">save</span> <span class="ot">`repstats&#39;</span></span>
<span id="cb257-10"><a href="#cb257-10" aria-hidden="true" tabindex="-1"></a><span class="kw">restore</span> </span>
<span id="cb257-11"><a href="#cb257-11" aria-hidden="true" tabindex="-1"></a><span class="kw">sort</span> rep78 </span>
<span id="cb257-12"><a href="#cb257-12" aria-hidden="true" tabindex="-1"></a><span class="kw">merge</span> <span class="fu">m</span>:1 rep78 <span class="kw">using</span> <span class="ot">`repstats&#39;</span></span>
<span id="cb257-13"><a href="#cb257-13" aria-hidden="true" tabindex="-1"></a><span class="kw">assert</span> <span class="dt">_merge</span> != 2</span>
<span id="cb257-14"><a href="#cb257-14" aria-hidden="true" tabindex="-1"></a><span class="kw">summarize</span> lprice max_lprice max_mpg </span>
<span id="cb257-15"><a href="#cb257-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-16"><a href="#cb257-16" aria-hidden="true" tabindex="-1"></a>* Ejemplo con <span class="kw">contract</span></span>
<span id="cb257-17"><a href="#cb257-17" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto.dta, <span class="kw">clear</span></span>
<span id="cb257-18"><a href="#cb257-18" aria-hidden="true" tabindex="-1"></a><span class="kw">preserve</span></span>
<span id="cb257-19"><a href="#cb257-19" aria-hidden="true" tabindex="-1"></a><span class="kw">contract</span> mpg, <span class="kw">cfreq</span>(cumfreq) <span class="kw">percent</span>(percentage) <span class="kw">cpercent</span>(cumpercent)</span>
<span id="cb257-20"><a href="#cb257-20" aria-hidden="true" tabindex="-1"></a><span class="kw">sort</span> mpg </span>
<span id="cb257-21"><a href="#cb257-21" aria-hidden="true" tabindex="-1"></a><span class="kw">tempfile</span> mpgfreq</span>
<span id="cb257-22"><a href="#cb257-22" aria-hidden="true" tabindex="-1"></a><span class="kw">save</span> <span class="ot">`mpgfreq&#39;</span></span>
<span id="cb257-23"><a href="#cb257-23" aria-hidden="true" tabindex="-1"></a><span class="kw">restore</span> </span>
<span id="cb257-24"><a href="#cb257-24" aria-hidden="true" tabindex="-1"></a><span class="kw">sort</span> mpg</span>
<span id="cb257-25"><a href="#cb257-25" aria-hidden="true" tabindex="-1"></a><span class="kw">merge</span> <span class="fu">m</span>:1 mpg <span class="kw">using</span> <span class="ot">`mpgfreq&#39;</span></span>
<span id="cb257-26"><a href="#cb257-26" aria-hidden="true" tabindex="-1"></a><span class="kw">assert</span> <span class="dt">_merge</span> != 2</span>
<span id="cb257-27"><a href="#cb257-27" aria-hidden="true" tabindex="-1"></a><span class="kw">summarize</span> _freq cumfreq percentage cumpercent</span></code></pre></div>
</div>
<div id="missing-values-1" class="section level4 hasAnchor" number="3.3.2.6">
<h4 class="hasAnchor"><span class="header-section-number">3.3.2.6</span> Missing values<a href="#missing-values-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>En general uno utiliza <code>if variable !=.</code> para evitar incluir <strong>missings</strong>.</li>
<li>Mejor practica es <code>variable &lt;.</code> para excluir todos los valores en <em>missing</em>. Otra opción es <code>if !missing(variable)</code>.</li>
<li>Los <em>missing</em> están codificados internamente como valores mayores a cualquier número. El menor valor de todos los <em>missing</em> es el punto. Al utilizar <code>if variable &lt;.</code> es como decir, solo utiliza los números.</li>
<li>Como vimos en la Sección 3.1 hay muchos problemas al no tratar bien los <em>missings</em>. Este problema se incrementa al momento de trabajar con bases de datos imposibles de inspeccionar. Veremos algunas recomendaciones que pueden ser utiles para evitar estos errores.</li>
</ul>
<p>Los comandos tratan distinto a los missings</p>
<ul>
<li>Cualquier función de datos <em>missing</em> será <em>missing</em>.</li>
<li>Cuando se calcula un promedio o una desviación estándar solo valores no missing son considerados (ej. <code>sum</code>).<br />
</li>
<li>Algunos comandos en Stata manejan los <em>missing</em> de otras formas. Por ejemplo, las funciones <code>max</code>, <code>min</code> y las funciones para filas de <code>egen</code>: <code>rowmax()</code>, <code>rowmean()</code>, <code>rowmin()</code>, <code>rowsd()</code> y <code>rowtotal()</code> ignoran los <em>missing</em>. Por ejemplo, <code>rowmean(x1,x2,x3)</code> calcula el promedio de las variables y solo retornara <em>missing</em> si todas lo son.</li>
<li>Por ejemplo, <code>rowmean(x1,x2,x3)</code> calcula el promedio de las variables y solo retornara <em>missing</em> si todas lo son.</li>
<li><code>collapse (sum)</code> trata a los <em>missing</em> como ceros.</li>
</ul>
<p>Calcular un promedio con missings</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span></span>
<span id="cb258-2"><a href="#cb258-2" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="kw">obs</span> 10 </span>
<span id="cb258-3"><a href="#cb258-3" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> var1 = rnormal()</span>
<span id="cb258-4"><a href="#cb258-4" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> var2 = 5 </span>
<span id="cb258-5"><a href="#cb258-5" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> var3 = .</span>
<span id="cb258-6"><a href="#cb258-6" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> promedio = (var1 + var2 + var3)/3</span>
<span id="cb258-7"><a href="#cb258-7" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> promedio1 = <span class="fu">rowmean</span>(var1 var2 var3)</span></code></pre></div>
<p>PromedioSinMissing da como resultado <em>missings</em>. PromedioConMissing no considera <em>missings</em>. Es importante tratar de entender como funcionan los <code>missings</code> de los comandos que utilizas.</p>
<p>Generar variables considerando missings: Al crear una variable <em>dicotómica</em>, <code>gen</code> y <code>gen byte</code> tratan a los <em>missing</em> de formas distintas.</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span> <span class="kw">N</span> = 500</span>
<span id="cb259-2"><a href="#cb259-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> <span class="kw">obs</span> <span class="ot">`N&#39;</span></span>
<span id="cb259-3"><a href="#cb259-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">gen</span> indicador = uniform() &lt; .5</span>
<span id="cb259-4"><a href="#cb259-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">replace</span> indicador =. <span class="kw">if</span> <span class="fu">mod</span>(<span class="dt">_n</span>, 2) == 0</span>
<span id="cb259-5"><a href="#cb259-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb259-6"><a href="#cb259-6" aria-hidden="true" tabindex="-1"></a>    * Si indicador es <span class="fu">missing</span>, <span class="kw">variable</span> sera <span class="fu">missing</span></span>
<span id="cb259-7"><a href="#cb259-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">gen</span> variable_primercaso = 1 <span class="kw">if</span> indicador == 1 </span>
<span id="cb259-8"><a href="#cb259-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">replace</span> variable_primercaso = 0 <span class="kw">if</span> indicador == 0</span>
<span id="cb259-9"><a href="#cb259-9" aria-hidden="true" tabindex="-1"></a>    * Si indicador es <span class="fu">missing</span>, <span class="kw">variable</span> sera cero. </span>
<span id="cb259-10"><a href="#cb259-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">gen</span> variable_segundocaso=(indicador==1)</span>
<span id="cb259-11"><a href="#cb259-11" aria-hidden="true" tabindex="-1"></a>    \<span class="kw">end</span>{minted}</span>
<span id="cb259-12"><a href="#cb259-12" aria-hidden="true" tabindex="-1"></a>    \<span class="kw">end</span>{itemize}</span></code></pre></div>
<p><code>sum()</code> considera <em>missing</em> como ceros.</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">clear</span> <span class="ot">all</span> </span>
<span id="cb260-2"><a href="#cb260-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> <span class="kw">obs</span> 4 </span>
<span id="cb260-3"><a href="#cb260-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">generate</span> <span class="kw">byte</span> var1 = <span class="fu">cond</span>(<span class="fu">mod</span>(<span class="dt">_n</span>,2)==1, 1, .)</span>
<span id="cb260-4"><a href="#cb260-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">generate</span> <span class="kw">byte</span> var1sum = <span class="kw">sum</span>(var1)</span>
<span id="cb260-5"><a href="#cb260-5" aria-hidden="true" tabindex="-1"></a>    <span class="ot">list</span>, <span class="kw">noobs</span></span></code></pre></div>
<p><code>max()</code> trata a los <em>missing</em> como si no estuviesen allí.</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb261-1"><a href="#cb261-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">display</span> <span class="fu">max</span>(-5,.)</span></code></pre></div>
<p>tabmiss, mvdecode y mvencode</p>
<ul>
<li>En ocasiones los <em>missing</em> difieren en notación (ej. al importar datos de otro paquete). Siempre que trabajes con una base de datos nueva es importante recodificar. Notar que no todos tienen que ir a un punto. Todo depende del origen de los <em>missing</em>.</li>
<li><code>mvdecode</code> y <code>mvencode</code> pueden ser útiles en este tipo de casos.</li>
<li><code>mvdecode</code> permite recodificar valores numéricos como <em>missing</em>. Útil cuando valores son representados como -99, -999.</li>
<li><code>mvencode</code> hace lo inverso. Mapea <em>missing</em> como numéricos.</li>
<li>El comando <code>tabmiss</code> inspecciona todas las variables de una base de datos y reporta los <code>missing</code> totales y como fracción del total de observaciones.</li>
</ul>
<div class="sourceCode" id="cb262"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span> <span class="ot">all</span> </span>
<span id="cb262-2"><a href="#cb262-2" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="dv">seed</span> 1234</span>
<span id="cb262-3"><a href="#cb262-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="kw">N</span> = 50</span>
<span id="cb262-4"><a href="#cb262-4" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="kw">obs</span> <span class="ot">`N&#39;</span></span>
<span id="cb262-5"><a href="#cb262-5" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> income = <span class="fu">abs</span>(<span class="kw">int</span>(rnormal(0,5)))</span>
<span id="cb262-6"><a href="#cb262-6" aria-hidden="true" tabindex="-1"></a><span class="kw">assert</span> income &gt;= 0</span>
<span id="cb262-7"><a href="#cb262-7" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> income =. <span class="kw">if</span> <span class="fu">mod</span>(<span class="dt">_n</span>, 2) == 0</span>
<span id="cb262-8"><a href="#cb262-8" aria-hidden="true" tabindex="-1"></a>* Para ver los <span class="fu">missing</span> en variables</span>
<span id="cb262-9"><a href="#cb262-9" aria-hidden="true" tabindex="-1"></a>tabmiss </span>
<span id="cb262-10"><a href="#cb262-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-11"><a href="#cb262-11" aria-hidden="true" tabindex="-1"></a>* Transformar un valor númerico a <span class="fu">missing</span></span>
<span id="cb262-12"><a href="#cb262-12" aria-hidden="true" tabindex="-1"></a><span class="kw">mvdecode</span> income, mv(2)</span>
<span id="cb262-13"><a href="#cb262-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-14"><a href="#cb262-14" aria-hidden="true" tabindex="-1"></a>* Transformar varios valores númericos a <span class="fu">missing</span>.</span>
<span id="cb262-15"><a href="#cb262-15" aria-hidden="true" tabindex="-1"></a><span class="kw">mvdecode</span> income, mv(2 5)</span>
<span id="cb262-16"><a href="#cb262-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-17"><a href="#cb262-17" aria-hidden="true" tabindex="-1"></a>* Transformar varios a <span class="fu">missing</span>, pero identific ́andolos.</span>
<span id="cb262-18"><a href="#cb262-18" aria-hidden="true" tabindex="-1"></a><span class="kw">mvdecode</span> income, mv(3 = .a \ 6 = .b)</span>
<span id="cb262-19"><a href="#cb262-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-20"><a href="#cb262-20" aria-hidden="true" tabindex="-1"></a>* Missings se cambian <span class="kw">de</span> vuelta a su valor original.</span>
<span id="cb262-21"><a href="#cb262-21" aria-hidden="true" tabindex="-1"></a><span class="kw">mvencode</span> income, mv(.a = 3 \ .b = 6)</span></code></pre></div>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.3.2: </b></p>
<p>Instrucciones</p>
<p>Abrir <code>ejercicios-clase3.do</code> y ejecute las líneas correspondientes al ejercicio 2.</p>
<p>Pregunta</p>
<p>Compare las opciones 1, 2 y 3 en relación a como tratan los <em>missing</em>. Explique las diferencias entre cada una de estas opciones.</p>
</div>
<p>generate, replace y missing: Sólo unas pequeños detalles.</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span> </span>
<span id="cb263-2"><a href="#cb263-2" aria-hidden="true" tabindex="-1"></a>cd <span class="st">&quot;$ejercicio3&quot;</span></span>
<span id="cb263-3"><a href="#cb263-3" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> census2c, <span class="kw">clear</span></span>
<span id="cb263-4"><a href="#cb263-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb263-5"><a href="#cb263-5" aria-hidden="true" tabindex="-1"></a>* Opción 1</span>
<span id="cb263-6"><a href="#cb263-6" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> smallpop_o1 = 1 <span class="kw">if</span> pop&lt;=5000</span>
<span id="cb263-7"><a href="#cb263-7" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> smallpop_o1 = 0 <span class="kw">if</span> pop&gt;5000</span>
<span id="cb263-8"><a href="#cb263-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb263-9"><a href="#cb263-9" aria-hidden="true" tabindex="-1"></a>* Opción 2</span>
<span id="cb263-10"><a href="#cb263-10" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> smallpop_o2 = (pop &lt;= 5000) </span>
<span id="cb263-11"><a href="#cb263-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb263-12"><a href="#cb263-12" aria-hidden="true" tabindex="-1"></a>* Opcion 3</span>
<span id="cb263-13"><a href="#cb263-13" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> smallpop_o3 = (pop &lt;= 5000) <span class="kw">if</span> !<span class="fu">missing</span>(pop)</span></code></pre></div>
<p>Opción 1 es la típica. Ojo no esta considerando <em>missing</em>. Es necesario agregar <code>&amp; !missing(pop)</code>. Escrito de esta forma, si <code>pop</code> es <em>missing</em>, <code>smallpop</code> será <em>cero</em>. Opción 2 es más simple, pero si cualquier valor de <code>pop</code> es <em>missing</em> será evaluado como un cero también. La razón es que los <em>missing</em> en Stata son considerados como números muy grandes para el programa. La Opción 3 soluciona el problema.</p>
</div>
<div id="string-a-numeric-y-al-revés" class="section level4 hasAnchor" number="3.3.2.7">
<h4 class="hasAnchor"><span class="header-section-number">3.3.2.7</span> String a numeric y al revés<a href="#string-a-numeric-y-al-revés" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>De string a numeric</p>
<ul>
<li>Si las variables han sido mal clasificadas como <em>string</em> puedes utilizar la función <code>real()</code>.</li>
<li>Por ejemplo: <code>generate idpaciente = real(pacienteid)</code>.</li>
<li>El comando anterior genera <em>missing</em> para todas las observaciones que no puedan ser interpretadas como numéricas.</li>
<li>Mucho mejor es utilizar <code>destring, replace</code>.</li>
<li>Otro caso usual es que tenemos datos en formato <code>string</code> y queremos que tengan un equivalente. El comando <code>encode</code>. No es aconsejable utilizar este comando para valores numéricos guardados como <em>string</em>.</li>
</ul>
<p>De numeric a string</p>
<ul>
<li>Hay veces en las que se quiere generar un equivalente <em>string</em> a valores numéricos.</li>
<li>Tres comandos: <code>string()</code> , <code>tostring()</code> y <code>decode()</code>.</li>
<li>Un ejemplo es querer mantener los 0 que estan al inicio de un código ID.</li>
<li>El comando <code>tostring zip, format(\%05.0f) generate(idstring)</code> genera un <em>string</em> de cinco digitos con los ceros al inicio.</li>
<li><code>decode()</code> sirve para un caso en que tengas un id en numérico, pero que no la tengas en <em>string</em>.</li>
</ul>
<p>Strings entre comillas: importa poner las comillas bien.</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;Este es un string normal&quot;</span></span>
<span id="cb264-2"><a href="#cb264-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-3"><a href="#cb264-3" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;Este no es un string con &quot;</span>comillas<span class="st">&quot; &quot;</span></span>
<span id="cb264-4"><a href="#cb264-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-5"><a href="#cb264-5" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">`&quot;</span>Este si es un <span class="fu">string</span> con <span class="st">&quot;comillas&quot;&quot;&#39;</span></span></code></pre></div>
</div>
<div id="funciones-para-generar-variables" class="section level4 hasAnchor" number="3.3.2.8">
<h4 class="hasAnchor"><span class="header-section-number">3.3.2.8</span> Funciones para generar variables<a href="#funciones-para-generar-variables" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>generate y replace: función <code>cond()</code></p>
<ul>
<li>Si quiero que un resultado sea “a” si una <em>condición es verdadera</em> y “b” si es <em>falsa</em>.</li>
<li>La función <code>cond(x,a,b)</code> posee esta capacidad sin la necesidad de utilizar <code>if</code>.</li>
</ul>
<div class="sourceCode" id="cb265"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb265-1"><a href="#cb265-1" aria-hidden="true" tabindex="-1"></a>* Útil para construir una tabla</span>
<span id="cb265-2"><a href="#cb265-2" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> netmarr2x = <span class="fu">cond</span>(marr/divr &gt; 2, 1, 2) </span>
<span id="cb265-3"><a href="#cb265-3" aria-hidden="true" tabindex="-1"></a><span class="kw">label</span> <span class="kw">define</span> netmarr2xc 1 <span class="st">&quot;marr &gt; 2 divr&quot;</span> 2 <span class="st">&quot;marr &lt;= 2 divr&quot;</span> </span>
<span id="cb265-4"><a href="#cb265-4" aria-hidden="true" tabindex="-1"></a><span class="kw">label</span> <span class="kw">values</span> netmarr2x netmarr2xc </span>
<span id="cb265-5"><a href="#cb265-5" aria-hidden="true" tabindex="-1"></a><span class="kw">tabstat</span> pop medage, <span class="kw">by</span>(netmarr2x) </span></code></pre></div>
<p>Las observaciones en Stata estás numeradas desde el 1. <code>_N</code> es el mayor número de observaciones, mientras que el actual es <code>_n</code>. <code>sort</code> (ascendete) y <code>gsort</code> (ascendete o descendente) alteran el orden de las observaciones. Como recomendación eviten generar variables o condiciones que dependan de la posición especifica de una observación.</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a>* Ejemplo 1: uso <span class="kw">de</span> <span class="kw">gsort</span></span>
<span id="cb266-2"><a href="#cb266-2" aria-hidden="true" tabindex="-1"></a><span class="kw">gsort</span> region -pop </span>
<span id="cb266-3"><a href="#cb266-3" aria-hidden="true" tabindex="-1"></a><span class="kw">by</span> region: <span class="kw">generate</span> totpop = <span class="kw">sum</span>(pop)</span>
<span id="cb266-4"><a href="#cb266-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-5"><a href="#cb266-5" aria-hidden="true" tabindex="-1"></a>* Ejemplo 2: uso <span class="kw">de</span> <span class="dt">_n</span> <span class="fu">y</span> _N</span>
<span id="cb266-6"><a href="#cb266-6" aria-hidden="true" tabindex="-1"></a><span class="kw">by</span> region: <span class="ot">list</span> region totpop <span class="kw">if</span> <span class="dt">_n</span> == _N</span>
<span id="cb266-7"><a href="#cb266-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-8"><a href="#cb266-8" aria-hidden="true" tabindex="-1"></a>* Ejemplo 3: <span class="kw">sort</span></span>
<span id="cb266-9"><a href="#cb266-9" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> largepop = 0</span>
<span id="cb266-10"><a href="#cb266-10" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> largepop = 1 <span class="kw">if</span> pop &gt; 5000 &amp; !<span class="fu">missing</span>(pop)</span>
<span id="cb266-11"><a href="#cb266-11" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> smallpop = (pop &lt;= 5000) <span class="kw">if</span> !<span class="fu">missing</span>(pop)</span>
<span id="cb266-12"><a href="#cb266-12" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> popsize = smallpop + 2*largepop</span>
<span id="cb266-13"><a href="#cb266-13" aria-hidden="true" tabindex="-1"></a><span class="kw">label</span> <span class="kw">variable</span> popsize <span class="st">&quot;Population size code&quot;</span></span>
<span id="cb266-14"><a href="#cb266-14" aria-hidden="true" tabindex="-1"></a><span class="kw">label</span> <span class="kw">define</span> popsize 1  <span class="st">&quot;&lt;= 5 million&quot;</span> 2 <span class="st">&quot;&gt; 5 million&quot;</span>, modify</span>
<span id="cb266-15"><a href="#cb266-15" aria-hidden="true" tabindex="-1"></a><span class="kw">label</span> <span class="kw">values</span> popsize popsize </span>
<span id="cb266-16"><a href="#cb266-16" aria-hidden="true" tabindex="-1"></a><span class="kw">bysort</span> region popsize: <span class="kw">egen</span> meanpop2 = <span class="kw">mean</span>(pop) </span></code></pre></div>
<p><code>recode</code> para variables discretas: <code>recode</code> crea una nueva variable basada en otra variable.</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb267-1"><a href="#cb267-1" aria-hidden="true" tabindex="-1"></a>* Esta no es una buena opción </span>
<span id="cb267-2"><a href="#cb267-2" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> newcode = 5 <span class="kw">if</span> oldcode == 2 </span>
<span id="cb267-3"><a href="#cb267-3" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> newcode = 8 <span class="kw">if</span> oldcode == 3 </span>
<span id="cb267-4"><a href="#cb267-4" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> newcode = 12 <span class="kw">if</span> <span class="fu">inlist</span>(oldcode, 5, 6, 7)</span>
<span id="cb267-5"><a href="#cb267-5" aria-hidden="true" tabindex="-1"></a>* Esta si es una buena opción </span>
<span id="cb267-6"><a href="#cb267-6" aria-hidden="true" tabindex="-1"></a><span class="kw">recode</span> oldcode (2 = 5) (3 = 8) (5/7 = 12), <span class="kw">gen</span>(newcode) </span></code></pre></div>
<p>El signo (<span class="math inline">\(=\)</span>) es para indicar valor antiguo a valor nuevo. No es necesario aplicarlo linea por linea. <code>recode</code> produce <strong>un código más eficiente</strong>.</p>
<p><code>recode</code> para variables continuas: <code>recode(x,x1,x2,x3,x4,xn)</code> para variables continuas de forma tal de generar intervalos tal que <span class="math inline">\(x \leq x_1 ; x_1 \leq x \leq x_2\)</span> y así sucesivamente. Los resultados son iguales a los límites creados.</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> census2c, <span class="kw">clear</span></span>
<span id="cb268-2"><a href="#cb268-2" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> breaks = <span class="kw">recode</span>(medage, 29, 30, 31, 32, 33)</span></code></pre></div>
<p>Otros comandos que cumplen una función parecida son <code>floor</code> y <code>ceil()</code>. Ambos sirven para generar un valor entero. El primero para redondear hacia abajo y el otro hacia arriba. <code>floor(x)</code> retorna el entero <span class="math inline">\(n\)</span> tal que <span class="math inline">\(n \leq x &lt; n + 1\)</span> mientras que <code>ceil(x)</code> es tal que <span class="math inline">\(n - 1 &lt; x \leq n\)</span>.</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb269-1"><a href="#cb269-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> census2c, <span class="kw">clear</span></span>
<span id="cb269-2"><a href="#cb269-2" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> popurbfloor = <span class="fu">floor</span>(popurb)</span>
<span id="cb269-3"><a href="#cb269-3" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> popurbceil = <span class="fu">ceil</span>(popurb)</span></code></pre></div>
<p><code>irecode</code> para variables continuas: <code>irecode(x,x1,x2,x3,x4,x_n)</code> es una alternativa para categorizar grupos también. Por ejemplo:</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb270-1"><a href="#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> <span class="kw">size</span> = <span class="fu">irecode</span>(pop, 1000, 4000, 8000, 20000)</span>
<span id="cb270-2"><a href="#cb270-2" aria-hidden="true" tabindex="-1"></a><span class="kw">label</span> <span class="kw">define</span> popsize 0 <span class="st">&quot;&lt;1m&quot;</span> 1 <span class="st">&quot;1-4m&quot;</span> 2 <span class="st">&quot;4-8m&quot;</span> 3 <span class="st">&quot;&gt;8m&quot;</span> </span>
<span id="cb270-3"><a href="#cb270-3" aria-hidden="true" tabindex="-1"></a><span class="kw">label</span> <span class="kw">values</span> <span class="kw">size</span> popsize</span>
<span id="cb270-4"><a href="#cb270-4" aria-hidden="true" tabindex="-1"></a><span class="kw">tabstat</span> pop, stat(<span class="kw">mean</span> <span class="fu">min</span> <span class="fu">max</span>) <span class="kw">by</span>(<span class="kw">size</span>)</span></code></pre></div>
<p>Categorizara cada grupo según el intervalo en el que este. <strong>Parte del cero!</strong>. $x x_1 $, <span class="math inline">\(x_1 \leq x \leq x_2 \rightarrow 1\)</span> y así sucesivamente.</p>
<p>Crear cuartiles con <code>xtile</code>: Con <code>xtile</code> podemos querer clasificar las variables según cuantiles (quintiles, deciles, cuartiles, etc).</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb271-1"><a href="#cb271-1" aria-hidden="true" tabindex="-1"></a>* Creamos cuartiles para población </span>
<span id="cb271-2"><a href="#cb271-2" aria-hidden="true" tabindex="-1"></a><span class="kw">xtile</span> popcuart = pop , nq(4)</span>
<span id="cb271-3"><a href="#cb271-3" aria-hidden="true" tabindex="-1"></a><span class="kw">tabstat</span> pop, stat(n <span class="kw">mean</span> <span class="fu">min</span> <span class="fu">max</span>) <span class="kw">by</span>(popcuart)</span></code></pre></div>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.3.3:</b></p>
<p>Instrucciones</p>
<ol style="list-style-type: decimal">
<li>Cargar la base <code>auto.dta</code></li>
</ol>
<p>Pregunta</p>
<ol style="list-style-type: decimal">
<li>Genere una variable que sirva para redondear hacia abajo la variable <code>mpg</code> en en múltiplos de 5, de modo que cualquier valor de 10 a 14 se redondee a 10, cualquier valor de 15 a 19 a 15 y así sucesivamente.</li>
</ol>
</div>
</div>
<div id="funciones-de-egen" class="section level4 hasAnchor" number="3.3.2.9">
<h4 class="hasAnchor"><span class="header-section-number">3.3.2.9</span> Funciones de egen<a href="#funciones-de-egen" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Todos y todas conocemos algunas de las típicas funciones de <code>egen</code>.</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span> </span>
<span id="cb272-2"><a href="#cb272-2" aria-hidden="true" tabindex="-1"></a>* Ejemplo del uso <span class="kw">de</span> <span class="kw">egen</span></span>
<span id="cb272-3"><a href="#cb272-3" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> <span class="kw">size</span> = <span class="fu">irecode</span>(pop, 1000, 4000, 8000, 20000)</span>
<span id="cb272-4"><a href="#cb272-4" aria-hidden="true" tabindex="-1"></a><span class="kw">label</span> <span class="kw">define</span> popsize 0 <span class="st">&quot;&lt;1m&quot;</span> 1 <span class="st">&quot;1-4m&quot;</span> 2 <span class="st">&quot;4-8m&quot;</span> 3 <span class="st">&quot;&gt;8m&quot;</span> </span>
<span id="cb272-5"><a href="#cb272-5" aria-hidden="true" tabindex="-1"></a><span class="kw">label</span> <span class="kw">values</span> <span class="kw">size</span> popsize</span>
<span id="cb272-6"><a href="#cb272-6" aria-hidden="true" tabindex="-1"></a><span class="kw">bysort</span> <span class="kw">size</span>: <span class="kw">egen</span> avgpop = <span class="kw">mean</span>(pop)</span>
<span id="cb272-7"><a href="#cb272-7" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> popratio = 100 * pop / avgpop </span>
<span id="cb272-8"><a href="#cb272-8" aria-hidden="true" tabindex="-1"></a><span class="kw">format</span> popratio \%7.2f</span>
<span id="cb272-9"><a href="#cb272-9" aria-hidden="true" tabindex="-1"></a><span class="ot">list</span> state pop avgpop popratio <span class="kw">if</span> <span class="kw">size</span> == 0 </span></code></pre></div>
<p>Otras funciones son <code>iqr()</code>, <code>kurt()</code>,<code>mad()</code>, <code>mdev()</code>, <code>median()</code>, <code>mode()</code>, <code>pc()</code>, <code>pctile()</code>, <code>rank()</code>, <code>sd()</code>, <code>skwe()</code>, <code>std()</code>.</p>
<p>egenmore</p>
<ul>
<li>Menos conocida es la colección de funciones adicionales de <code>egen</code> hechas por <a href="https://www.durham.ac.uk/staff/n-j-cox/">Nicholas J. Cox.</a></li>
<li>Estas funciones están contenidas en el comando <code>egenmore</code>.</li>
<li><code>bom()</code> y <code>eom()</code> crean variables de fechas que corresponde al primer y último día de un mes determinado.</li>
<li><code>corr()</code> calcula correlaciones y covarianzas mientras que <code>var()</code> calcular la varianza.</li>
<li><code>semean()</code> calcula la desviación estándar del error de una media.</li>
<li><code>record()</code> permite calcular el valor más alto o más bajo de una serie.</li>
</ul>
<div class="sourceCode" id="cb273"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb273-1"><a href="#cb273-1" aria-hidden="true" tabindex="-1"></a>* Ejemplo 1: Generar <span class="kw">variable</span> que tenga la primera palabra <span class="kw">de</span> una frase (wordof)</span>
<span id="cb273-2"><a href="#cb273-2" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> firstword = wordof(make),  <span class="fu">word</span>(1)</span>
<span id="cb273-3"><a href="#cb273-3" aria-hidden="true" tabindex="-1"></a><span class="ot">list</span> firstword make <span class="kw">in</span>  1/15</span>
<span id="cb273-4"><a href="#cb273-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb273-5"><a href="#cb273-5" aria-hidden="true" tabindex="-1"></a>* Ejemplo 2: Para generar automáticamente valores extremos (outside, 1,5 RIQ)</span>
<span id="cb273-6"><a href="#cb273-6" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span>    extrmpg = outside(mpg)</span>
<span id="cb273-7"><a href="#cb273-7" aria-hidden="true" tabindex="-1"></a><span class="kw">tab</span> extrmpg,    <span class="fu">missing</span></span></code></pre></div>
<p><code>rall()</code> y <code>rany()</code> son útiles para el análisis de datos. Evaluan una condición y genera un indicador si todas o alguna observación la cumple.</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb274-1"><a href="#cb274-1" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="kw">obs</span> 12</span>
<span id="cb274-2"><a href="#cb274-2" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> a = 1 <span class="kw">in</span> 1 </span>
<span id="cb274-3"><a href="#cb274-3" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> b = 2 <span class="kw">in</span> 2/4</span>
<span id="cb274-4"><a href="#cb274-4" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> c  = -3  <span class="kw">in</span> 5/7</span>
<span id="cb274-5"><a href="#cb274-5" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> <span class="kw">d</span> = 4  <span class="kw">in</span> 8/10</span>
<span id="cb274-6"><a href="#cb274-6" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> <span class="fu">e</span> = . <span class="kw">in</span> 11/12</span>
<span id="cb274-7"><a href="#cb274-7" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> any = rany(a b c <span class="kw">d</span> <span class="fu">e</span>) , c(@ &gt; 0 &amp; !<span class="fu">missing</span>(@))</span>
<span id="cb274-8"><a href="#cb274-8" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> <span class="ot">all</span> = rall(a b c <span class="kw">d</span> <span class="fu">e</span>) , c(@ &gt; 0 &amp; !<span class="fu">missing</span>(@)) </span></code></pre></div>
</div>
</div>
<div id="macros-locales-y-globales" class="section level3 hasAnchor" number="3.3.3">
<h3 class="hasAnchor"><span class="header-section-number">3.3.3</span> Macros locales y globales<a href="#macros-locales-y-globales" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="nombrar-macros" class="section level4 hasAnchor" number="3.3.3.1">
<h4 class="hasAnchor"><span class="header-section-number">3.3.3.1</span> Nombrar macros<a href="#nombrar-macros" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>Una macro es un <strong>contenedor</strong> que puede almacenar números o nombres de variables.</li>
<li>Puede ser <code>local</code> o <code>global</code>. La primera es temporal, la segunda no.<br />
</li>
<li>Un ejemplo de variable local es:</li>
</ul>
<div class="sourceCode" id="cb275"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb275-1"><a href="#cb275-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> NivelEstres Nada Medio Moderado Severo </span>
<span id="cb275-2"><a href="#cb275-2" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;Los niveles de estrés son: `NivelEstres&#39;&quot;</span></span></code></pre></div>
<p>El primer comando define la macro y sus valores. Para llamar a la macro hay que utilizar las comillas (“). <code>local nombre texto</code> <span class="math inline">\(\rightarrow\)</span> <code>local nombre = text</code> <span class="math inline">\(\rightarrow\)</span> <code>local nombre = "text"</code>.</p>
<p>Ojo con las rutas:</p>
<ul>
<li>En ocasiones voy a querer utilizar una macro dentro de la ruta de una carpeta.</li>
<li>Es importante utilizar siempre <code>/</code> o bien <code>\\</code>. De otra forma no lo reconocerá.</li>
</ul>
<div class="sourceCode" id="cb276"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb276-1"><a href="#cb276-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> filename base.dta </span>
<span id="cb276-2"><a href="#cb276-2" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="st">&quot;H:\ECStata\`filename&#39;&quot;</span></span>
<span id="cb276-3"><a href="#cb276-3" aria-hidden="true" tabindex="-1"></a><span class="fu">r</span>(601);</span>
<span id="cb276-4"><a href="#cb276-4" aria-hidden="true" tabindex="-1"></a>* Para corregir <span class="fu">el</span> <span class="kw">error</span>, dos caminos: </span>
<span id="cb276-5"><a href="#cb276-5" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="st">&quot;H:\ECStata</span><span class="ch">\\</span><span class="st">`filename&#39;&quot;</span> </span>
<span id="cb276-6"><a href="#cb276-6" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="st">&quot;H:/ECStata/`filename&#39;&quot;</span></span></code></pre></div>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.3.4:</b> Compare los siguientes comandos y comente las diferencias:</p>
<ul>
<li><code>display "Dos mas dos = 2 + 2"</code></li>
<li><code>display "Dos mas dos</code>= 2 + 2’“`</li>
</ul>
</div>
<p>Ojo con el signo igual: Algunas veces es bueno colocar un signo <span class="math inline">\(=\)</span> al definir macros. Por ejemplo, cuando redefinimos variables.</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb277-1"><a href="#cb277-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> contador 0</span>
<span id="cb277-2"><a href="#cb277-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> NivelEstres Nada Medio Moderado Severo </span>
<span id="cb277-3"><a href="#cb277-3" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> a <span class="kw">of</span> <span class="kw">local</span> NivelEstres { </span>
<span id="cb277-4"><a href="#cb277-4" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> contador = <span class="ot">`contador&#39;</span> + 1 </span>
<span id="cb277-5"><a href="#cb277-5" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;Nivel de Estres `contador&#39; : `a&#39;&quot;</span></span>
<span id="cb277-6"><a href="#cb277-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>La primera parte sirve para definir la <code>macro</code> mientras que la segunda sirve para dar cuenta de su valor actual. Al actualizar, ocupen igual.</p>
<p>Sin signo igual: En algunas ocasiones queremos escribir una <code>macro</code> dentro de un <em>loop</em>. En estos casos es conveniente evitar el signo igual.</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> contador 0</span>
<span id="cb278-2"><a href="#cb278-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> NivelEstres Nada Medio Moderado Severo </span>
<span id="cb278-3"><a href="#cb278-3" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> a <span class="kw">of</span> <span class="kw">local</span> NivelEstres {</span>
<span id="cb278-4"><a href="#cb278-4" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> contador = <span class="ot">`contador&#39;</span> + 1 </span>
<span id="cb278-5"><a href="#cb278-5" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> nuevalista <span class="ot">`nuevalista&#39;</span> <span class="ot">`contador&#39;</span> &#39;a&#39; </span>
<span id="cb278-6"><a href="#cb278-6" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb278-7"><a href="#cb278-7" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;`nuevalista&#39;&quot;</span> </span></code></pre></div>
<p>El <code>local nuevalista</code> define una macro como <em>string</em> que posee su propio contenido, el valor de contar y el valor del iterador.</p>
</div>
<div id="generar-variables-contadores-y-condiciones-con-macros" class="section level4 hasAnchor" number="3.3.3.2">
<h4 class="hasAnchor"><span class="header-section-number">3.3.3.2</span> Generar variables, contadores y condiciones con macros<a href="#generar-variables-contadores-y-condiciones-con-macros" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Podemos utilizar macros para renombrar variables.</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb279-1"><a href="#cb279-1" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span> </span>
<span id="cb279-2"><a href="#cb279-2" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> a = 10/20{ </span>
<span id="cb279-3"><a href="#cb279-3" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> v<span class="ot">`a&#39;</span> = rnormal()</span>
<span id="cb279-4"><a href="#cb279-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb279-5"><a href="#cb279-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb279-6"><a href="#cb279-6" aria-hidden="true" tabindex="-1"></a>* Renombramos variables </span>
<span id="cb279-7"><a href="#cb279-7" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> i = 11/15 { </span>
<span id="cb279-8"><a href="#cb279-8" aria-hidden="true" tabindex="-1"></a><span class="kw">rename</span> v<span class="ot">`i&#39;</span> x<span class="ot">`=1960 + `i&#39;</span>&#39;</span>
<span id="cb279-9"><a href="#cb279-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>En este fragmento de código, Stata evalúa la expresión <code>1960 + 'i'</code> antes de evaluar la macro externa. Por ejemplo, cuando pase por el iterador <code>i = 11</code>, el nuevo nombre de la variable será <code>x1971</code>.</p>
<p>Resumir condiciones: Podemos utilizar macros para resumir condiciones. Esto es útil para estimar modelos o generar estadística descriptiva.</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb280-1"><a href="#cb280-1" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span> </span>
<span id="cb280-2"><a href="#cb280-2" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto </span>
<span id="cb280-3"><a href="#cb280-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="fu">cond</span> <span class="st">&quot;if foreign==0&quot;</span></span>
<span id="cb280-4"><a href="#cb280-4" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="kw">varlist</span> <span class="st">&quot;mpg rep78 trunk weight turn&quot;</span></span>
<span id="cb280-5"><a href="#cb280-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-6"><a href="#cb280-6" aria-hidden="true" tabindex="-1"></a>* Estimar la regresión considerando la condicíòn</span>
<span id="cb280-7"><a href="#cb280-7" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> price <span class="ot">`varlist&#39;</span> <span class="ot">`cond&#39;</span></span></code></pre></div>
<p>Agrupar en base a una condición: Imaginemos que ahora queremos estimar una regresión para todas las compañías de auto que empiezan empiezan con B.</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb281-1"><a href="#cb281-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> autoname B </span>
<span id="cb281-2"><a href="#cb281-2" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> price mpg <span class="kw">weight</span> <span class="kw">if</span> <span class="fu">substr</span>(make,1,1)==<span class="st">&quot;`autoname&#39;&quot;</span></span></code></pre></div>
<p>La mejor manera de pensar en esto es hacer lo que hace Stata: reemplazar <code>"ctyname"</code> por su contenido <code>substr(país,1,1)=="</code>ctyname’“<code>. Al hacerlo, se convierte en</code>substr(país,1,1)==”B”<code>. Si se omiten las comillas dobles, se obtiene</code>substr(country,1,1)==B`, lo que da lugar a un error.</p>
<p>Contadores: Las macros también pueden ser útiles para contadores.</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true" tabindex="-1"></a>* Para adelante</span>
<span id="cb282-2"><a href="#cb282-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> i = 1 </span>
<span id="cb282-3"><a href="#cb282-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> ++i </span>
<span id="cb282-4"><a href="#cb282-4" aria-hidden="true" tabindex="-1"></a><span class="kw">di</span> <span class="ot">`i&#39;</span> </span>
<span id="cb282-5"><a href="#cb282-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb282-6"><a href="#cb282-6" aria-hidden="true" tabindex="-1"></a>* Para atrás</span>
<span id="cb282-7"><a href="#cb282-7" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> i = 1</span>
<span id="cb282-8"><a href="#cb282-8" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> --i </span>
<span id="cb282-9"><a href="#cb282-9" aria-hidden="true" tabindex="-1"></a><span class="kw">di</span> <span class="ot">`i&#39;</span> </span></code></pre></div>
<p>Muy útil para hacer gráficos o guardar datos en matrices.</p>
<p>Utilizar una macro para estimar regresiones: Imaginen que desean estimar regresiones sobre un conjunto de variables donde una parte de este conjunto esta fija y la otra parte es variable.</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb283-1"><a href="#cb283-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> rhs mpg <span class="kw">weight</span></span>
<span id="cb283-2"><a href="#cb283-2" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> price <span class="ot">`rhs&#39;</span> <span class="kw">if</span> foreign == 0 </span>
<span id="cb283-3"><a href="#cb283-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> rhs <span class="st">&quot;`rhs&#39; headroom trunk&quot;</span>  </span>
<span id="cb283-4"><a href="#cb283-4" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> price <span class="ot">`rhs&#39;</span> <span class="kw">if</span> foreign == 0 </span></code></pre></div>
<p>¿Qué ocurre si queremos hacerlo por separado? ¿Uno a uno?</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> rhs <span class="st">&quot;mpg weight \`add_var&#39;&quot;</span> </span>
<span id="cb284-2"><a href="#cb284-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> add_var <span class="st">&quot;headroom&quot;</span></span>
<span id="cb284-3"><a href="#cb284-3" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> price <span class="ot">`rhs&#39;</span> <span class="kw">if</span> foreign == 0  </span>
<span id="cb284-4"><a href="#cb284-4" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> add_var <span class="st">&quot;trunk&quot;</span> </span>
<span id="cb284-5"><a href="#cb284-5" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> price <span class="ot">`rhs&#39;</span> <span class="kw">if</span> foreign == 0  </span>
<span id="cb284-6"><a href="#cb284-6" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> add_var <span class="st">&quot;turn&quot;</span> </span>
<span id="cb284-7"><a href="#cb284-7" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> price <span class="ot">`rhs&#39;</span> <span class="kw">if</span> foreign == 0  </span></code></pre></div>
<p>Lo que ocurre cuando hacemos referencia a una macro es que su valor se introduce en ese punto. El uso de una barra invertida en su lugar hace que se introduzca la referencia de la macro, es decir, no se sustituirá el valor de <code>add_var</code> sino el término `<code>add_var'</code>. Así que cada vez que llamamos a la local <code>rhs</code> el valor actual de el local <code>add_var</code> es sustituido.</p>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.3.5: </b></p>
<p>Instrucciones</p>
<ol style="list-style-type: decimal">
<li>Cargar la base <code>auto.dta</code></li>
</ol>
<p>Preguntas</p>
<ol style="list-style-type: decimal">
<li><p>Defina una variable macro llamada <code>control</code> que contenga <code>mpg</code>, <code>rep78</code> y <code>headroom</code>. Estime una regresión entre <code>price</code> y <code>control</code> para vehículos extranjeros y de nuevo para vehículos domésticos.</p></li>
<li><p>Ejecute <code>summarize mpg</code> junto con <code>return list</code>. Defina dos macros <code>display</code> <code>local mean1 r(mean)</code> y <code>local mean2 = r(mean)</code>. ¿Son iguales?</p></li>
</ol>
</div>
</div>
<div id="globales" class="section level4 hasAnchor" number="3.3.3.3">
<h4 class="hasAnchor"><span class="header-section-number">3.3.3.3</span> Globales<a href="#globales" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Crear macros globales</p>
<ul>
<li>Se crean con el comando <code>global</code>.</li>
<li>Útiles para fijar directorios o programas.</li>
<li>En otros casos es mejor utilizar <code>local</code>.</li>
</ul>
<div class="sourceCode" id="cb285"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb285-1"><a href="#cb285-1" aria-hidden="true" tabindex="-1"></a>* Para generarla </span>
<span id="cb285-2"><a href="#cb285-2" aria-hidden="true" tabindex="-1"></a><span class="kw">global</span> <span class="kw">variable</span></span>
<span id="cb285-3"><a href="#cb285-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-4"><a href="#cb285-4" aria-hidden="true" tabindex="-1"></a>* En caso <span class="kw">de</span> querer llamarla</span>
<span id="cb285-5"><a href="#cb285-5" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="ot">$variable</span></span></code></pre></div>
</div>
<div id="funciones-extendidas-de-macros" class="section level4 hasAnchor" number="3.3.3.4">
<h4 class="hasAnchor"><span class="header-section-number">3.3.3.4</span> Funciones extendidas de macros<a href="#funciones-extendidas-de-macros" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>¿Qué son las funciones de macros extendidas?</p>
<ul>
<li>Stata también define ciertas macro. Estas se denominan <em>extended macro functions</em> o macros extendidas.</li>
<li>En algunos casos contienen información sobre tu sistema operativo, sobre la última estimación que se realizo o sobre la base de datos.</li>
<li>El <code>help extended_fcn</code> y la documentación que la acompaña proporcionan una descripción completa de la sintaxis de cada función de macro extendida (hay muchas). Muchas tienen ligeras variaciones de sintaxis entre ellas (por ejemplo, algunas requieren que las macros estén entre comillas dobles; otras no lo permiten).</li>
</ul>
<div class="sourceCode" id="cb286"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb286-1"><a href="#cb286-1" aria-hidden="true" tabindex="-1"></a>* La sintaxis general es: </span>
<span id="cb286-2"><a href="#cb286-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> nombremacro: función <span class="kw">macro</span> extendida</span></code></pre></div>
<p>Mirar labels</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb287-1"><a href="#cb287-1" aria-hidden="true" tabindex="-1"></a>* Para mirar los labels <span class="kw">de</span> trunk</span>
<span id="cb287-2"><a href="#cb287-2" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto, <span class="kw">clear</span></span>
<span id="cb287-3"><a href="#cb287-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> tlab : <span class="kw">variable</span> <span class="kw">label</span> trunk </span>
<span id="cb287-4"><a href="#cb287-4" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;`tlab&#39;&quot;</span></span></code></pre></div>
<p><code>variable label</code> recupera el nombre asignado a una variable.</p>
<p>Contar dentro de un local</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb288-1"><a href="#cb288-1" aria-hidden="true" tabindex="-1"></a>* Para contar dentro <span class="kw">de</span> un <span class="kw">local</span></span>
<span id="cb288-2"><a href="#cb288-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> NivelEstres Nada Medio Moderado Severo </span>
<span id="cb288-3"><a href="#cb288-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> wds: <span class="fu">word</span> <span class="fu">count</span> <span class="ot">`NivelEstres&#39;</span> </span>
<span id="cb288-4"><a href="#cb288-4" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;Hay `wds&#39; niveles de estres:&quot;</span></span>
<span id="cb288-5"><a href="#cb288-5" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> i = 1/<span class="ot">`wds&#39;</span> {</span>
<span id="cb288-6"><a href="#cb288-6" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> wd: <span class="fu">word</span> <span class="ot">`i&#39;</span> <span class="kw">of</span> <span class="ot">`NivelEstres&#39;</span></span>
<span id="cb288-7"><a href="#cb288-7" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;Nivel `i&#39; is `wd&#39;&quot;</span></span>
<span id="cb288-8"><a href="#cb288-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><code>word count</code> y <code>word</code> como funciones de extensión que operan sobre <em>strings</em>.</p>
<p>Conocer tipos de datos</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb289-1"><a href="#cb289-1" aria-hidden="true" tabindex="-1"></a>* Para conocer tipos <span class="kw">de</span> datos</span>
<span id="cb289-2"><a href="#cb289-2" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto, <span class="kw">clear</span></span>
<span id="cb289-3"><a href="#cb289-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> stortype : <span class="dv">type</span> make </span>
<span id="cb289-4"><a href="#cb289-4" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;`stortype&#39;&quot;</span></span></code></pre></div>
<p>Ojos con las comillas dobles (nuevamente): Algunas veces las macros contienen comillas dobles. Para poder escribirlos sin errores es necesario modificar levemente la forma en que se llama a la variable <code>local</code></p>
<div class="sourceCode" id="cb290"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb290-1"><a href="#cb290-1" aria-hidden="true" tabindex="-1"></a>* Con <span class="kw">error</span> </span>
<span id="cb290-2"><a href="#cb290-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> answers yes no <span class="st">&quot;do not know&quot;</span> </span>
<span id="cb290-3"><a href="#cb290-3" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;`answers&#39;&quot;</span></span>
<span id="cb290-4"><a href="#cb290-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-5"><a href="#cb290-5" aria-hidden="true" tabindex="-1"></a>* Sin <span class="kw">error</span> </span>
<span id="cb290-6"><a href="#cb290-6" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> answers yes no <span class="st">&quot;do not know&quot;</span> </span>
<span id="cb290-7"><a href="#cb290-7" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">`&quot;</span><span class="ot">`answers&#39;</span><span class="st">&quot;&#39;</span></span></code></pre></div>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.3.6: </b></p>
<p>Preguntas</p>
<ol style="list-style-type: decimal">
<li>Use una macro extendida para mostrar el tipo de dato (ej. <code>int</code>, <code>float</code>, <code>long</code>,…) de <code>mpg</code>. Revise el <code>help</code> de <code>extended_fcn</code>.</li>
<li>Use una macro extendida para retornar el valor del label asociado a <code>foreign</code> cuando es igual a 1.</li>
<li>Use una macro extendida para mostrar solo la primera variable de `<code>controls'</code>.</li>
<li>Utilice una función extendida de macros para mostrar todos los archivos de su directorio actual (sugerencia: utilice comillas compuestas cuando muestre los nombres de los archivos).</li>
</ol>
</div>
</div>
<div id="funciones-de-macro-extendidas-para-listas" class="section level4 hasAnchor" number="3.3.3.5">
<h4 class="hasAnchor"><span class="header-section-number">3.3.3.5</span> Funciones de macro extendidas para listas<a href="#funciones-de-macro-extendidas-para-listas" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Stata también define ciertas macro para operar sobre listas. Estas funciones permiten combinar listas, buscar elementos dentro de una lista o bien buscar elementos comunes entre dos listas. Conveniente revisar <code>help macrolist</code> para más funciones.</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb291-1"><a href="#cb291-1" aria-hidden="true" tabindex="-1"></a>* Sintaxis: </span>
<span id="cb291-2"><a href="#cb291-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> nombre <span class="kw">macro</span>: <span class="ot">list</span> función</span>
<span id="cb291-3"><a href="#cb291-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb291-4"><a href="#cb291-4" aria-hidden="true" tabindex="-1"></a>* Ejemplo <span class="kw">de</span> lista</span>
<span id="cb291-5"><a href="#cb291-5" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> animales <span class="st">&quot;gato perro gato loro loro&quot;</span> </span>
<span id="cb291-6"><a href="#cb291-6" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> uniqanimales : <span class="ot">list</span> uniq animales </span>
<span id="cb291-7"><a href="#cb291-7" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;`uniqanimales&#39;&quot;</span></span></code></pre></div>
<p>Función levelsof: El comando <code>levelsof</code> lista los valores distintos de una variable. Al agregar la opción <code>local(nombremacro)</code> esto se guardara como una macro.</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb292-1"><a href="#cb292-1" aria-hidden="true" tabindex="-1"></a>* Sintaxis básica</span>
<span id="cb292-2"><a href="#cb292-2" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto, <span class="kw">clear</span></span>
<span id="cb292-3"><a href="#cb292-3" aria-hidden="true" tabindex="-1"></a><span class="kw">levelsof</span> rep78 </span>
<span id="cb292-4"><a href="#cb292-4" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;`r(levels)&#39;&quot;</span></span>
<span id="cb292-5"><a href="#cb292-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb292-6"><a href="#cb292-6" aria-hidden="true" tabindex="-1"></a>* Sintaxis cuando hay variables categóricas.</span>
<span id="cb292-7"><a href="#cb292-7" aria-hidden="true" tabindex="-1"></a><span class="kw">levelsof</span> foreign, <span class="kw">local</span>(<span class="kw">levels</span>)</span>
<span id="cb292-8"><a href="#cb292-8" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> <span class="ot">l</span> <span class="kw">of</span> <span class="kw">local</span> <span class="kw">levels</span> {</span>
<span id="cb292-9"><a href="#cb292-9" aria-hidden="true" tabindex="-1"></a><span class="kw">di</span> <span class="st">&quot;-&gt; foreign = `: label (foreign) `l&#39;&#39;&quot;</span></span>
<span id="cb292-10"><a href="#cb292-10" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> price mpg <span class="kw">if</span> foreign == <span class="ot">`l&#39;</span></span>
<span id="cb292-11"><a href="#cb292-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="manipulación-de-locales-vía-listas-de-macros" class="section level4 hasAnchor" number="3.3.3.6">
<h4 class="hasAnchor"><span class="header-section-number">3.3.3.6</span> Manipulación de locales vía listas de macros<a href="#manipulación-de-locales-vía-listas-de-macros" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Listas de macros: Las <code>macro lists</code> permiten obtener el número de elementos de una macro, trabajar con valores duplicados, ordenar elementos. Veremos cuatro aplicaciones:</p>
<ol style="list-style-type: decimal">
<li>Elementos duplicados.</li>
<li>Agregar y remover elementos.</li>
<li>Uniones e intersecciones.</li>
<li>Ordenar elementos.</li>
</ol>
<p>Elementos duplicados: <code>dups</code> extrae todos los elementos sobrantes.</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb293-1"><a href="#cb293-1" aria-hidden="true" tabindex="-1"></a>* Deja solo los unicos</span>
<span id="cb293-2"><a href="#cb293-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> fib 0 1 1 2 3</span>
<span id="cb293-3"><a href="#cb293-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> fib_nodups : <span class="ot">list</span> uniq fib</span>
<span id="cb293-4"><a href="#cb293-4" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;`fib_nodups&#39;&quot;</span></span>
<span id="cb293-5"><a href="#cb293-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb293-6"><a href="#cb293-6" aria-hidden="true" tabindex="-1"></a>* Quita todo los duplicados</span>
<span id="cb293-7"><a href="#cb293-7" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> fib 0 1 1 2 3</span>
<span id="cb293-8"><a href="#cb293-8" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> fib_dups : <span class="ot">list</span> dups fib</span>
<span id="cb293-9"><a href="#cb293-9" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;`fib_dups&#39;&quot;</span></span></code></pre></div>
<p>Agregar y remover elementos: Es básicamente pegar elementos de una macro con otra. Definamos dos variables locales: <code>vars</code> y <code>coef</code> y peguémoslos.</p>
<div class="sourceCode" id="cb294"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb294-1"><a href="#cb294-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> vars x <span class="fu">y</span> z </span>
<span id="cb294-2"><a href="#cb294-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> coefs a b c </span>
<span id="cb294-3"><a href="#cb294-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> vars_coefs <span class="ot">`vars&#39;</span> <span class="ot">`coefs&#39;</span></span>
<span id="cb294-4"><a href="#cb294-4" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;`vars_coefs&#39;&quot;</span></span></code></pre></div>
<p>Para remover tenemos que definir un nuevo local con los elementos que queremos quitar y sustraerlo del original. Supongamos que queremos actualizar el contenido de <code>vars</code> eliminado “y”.</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb295-1"><a href="#cb295-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="kw">not</span> <span class="fu">y</span></span>
<span id="cb295-2"><a href="#cb295-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> vars : <span class="ot">list</span> vars - <span class="kw">not</span></span>
<span id="cb295-3"><a href="#cb295-3" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;`vars&#39;&quot;</span></span></code></pre></div>
<p>Unión de elementos: Podemos pegar todos los elementos diferentes entre dos listas.</p>
<div class="sourceCode" id="cb296"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb296-1"><a href="#cb296-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> A house tree car</span>
<span id="cb296-2"><a href="#cb296-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> B computer car bike</span>
<span id="cb296-3"><a href="#cb296-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> all_things : <span class="ot">list</span> A | B</span>
<span id="cb296-4"><a href="#cb296-4" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;`all_things&#39;&quot;</span></span></code></pre></div>
<p>Noten que los elementos de <code>car</code> no fueron pegados. Notar que esto es distinto a simplemente pegar macros entre sí.</p>
<p>Intersección de elementos: Podemos hacer la intersección entre dos elementos de una lista. Esto corresponde a los elementos que pertenecen a ambas macros.</p>
<div class="sourceCode" id="cb297"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb297-1"><a href="#cb297-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> A house tree car</span>
<span id="cb297-2"><a href="#cb297-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> B computer car bike</span>
<span id="cb297-3"><a href="#cb297-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> common_things : <span class="ot">list</span> A &amp; B</span>
<span id="cb297-4"><a href="#cb297-4" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;`common_things&#39;&quot;</span></span></code></pre></div>
<p>Noten que en este caso solo <code>car</code> se mantiene.</p>
<p>Ordenar elementos: En ocasiones queremos ordenar los elementos de una lista contenida en una macro.</p>
<div class="sourceCode" id="cb298"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb298-1"><a href="#cb298-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> names camila camilo pedro paula</span>
<span id="cb298-2"><a href="#cb298-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> names : <span class="ot">list</span> <span class="kw">sort</span> names</span>
<span id="cb298-3"><a href="#cb298-3" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;`names&#39;&quot;</span></span></code></pre></div>
<p>Para hacer que los elementos de una macro se ordenen aleatoriamente es conveniente utilizar mata</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb299-1"><a href="#cb299-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> nums 1 2 3 4 5</span>
<span id="cb299-2"><a href="#cb299-2" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> : st_local(<span class="st">&quot;random_nums&quot;</span>, <span class="co">///</span></span>
<span id="cb299-3"><a href="#cb299-3" aria-hidden="true" tabindex="-1"></a>invtokens(<span class="kw">jumble</span>(tokens(st_local(<span class="st">&quot;nums&quot;</span>))&#39;)&#39;))</span>
<span id="cb299-4"><a href="#cb299-4" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;`random_nums&#39;&quot;</span></span></code></pre></div>
</div>
<div id="creturn" class="section level4 hasAnchor" number="3.3.3.7">
<h4 class="hasAnchor"><span class="header-section-number">3.3.3.7</span> creturn<a href="#creturn" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Macros con creturn</p>
<ul>
<li>En algunos casos al utilizar <code>local</code> o <code>global</code> vamos a querer fijar algunos parámetros.</li>
<li>Para este propósito utilizar <code>creturn</code>. Algunos ejemplos son: <code>c(current_date)</code>, <code>c(pwd)</code>, <code>c(current_time)</code>, <code>c(stata_version)</code>, <code>c(pi)</code>, <code>c(alpha)</code>, <code>c(Wdays)</code>.</li>
</ul>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.3.7: </b></p>
<p>Preguntas</p>
<ol style="list-style-type: decimal">
<li>Define una macro llamada comestibles con peras, manzanas, fresas, yogur, vino y queso en ella. Ponla en orden alfabético.</li>
<li>Define una macro llamada unión que contenga los miembros de la macro <em>animales</em> y <em>comestibles</em> y luego utiliza una función de lista extendida de la macro para mostrar el número de palabras que contiene.</li>
<li>Ordena <em>unión</em> y muestra la posición de la palabra “vino” utilizando una función de lista extendida de macros.</li>
</ol>
</div>
</div>
</div>
</div>
<div id="programar-do---files-parte-ii" class="section level2 hasAnchor" number="3.4">
<h2 class="hasAnchor"><span class="header-section-number">3.4</span> Programar do - files (Parte II)<a href="#programar-do---files-parte-ii" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="estructuras-de-datos" class="section level3 hasAnchor" number="3.4.1">
<h3 class="hasAnchor"><span class="header-section-number">3.4.1</span> Estructuras de datos<a href="#estructuras-de-datos" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="escalares" class="section level4 hasAnchor" number="3.4.1.1">
<h4 class="hasAnchor"><span class="header-section-number">3.4.1.1</span> Escalares<a href="#escalares" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>Los escalares pueden contener valores numéricos o <em>strings</em>. Un escalar solo puede contener un valor.</li>
<li>La sintaxis para generar un escalar es <code>scalar scalar_name = exp</code>.</li>
</ul>
<div class="sourceCode" id="cb300"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb300-1"><a href="#cb300-1" aria-hidden="true" tabindex="-1"></a><span class="kw">quietly</span>: <span class="kw">summarize</span> mpg </span>
<span id="cb300-2"><a href="#cb300-2" aria-hidden="true" tabindex="-1"></a><span class="fu">scalar</span> mean_mpg = <span class="fu">r</span>(<span class="kw">mean</span>)</span>
<span id="cb300-3"><a href="#cb300-3" aria-hidden="true" tabindex="-1"></a><span class="kw">quietly</span>: <span class="kw">summarize</span> rep78</span>
<span id="cb300-4"><a href="#cb300-4" aria-hidden="true" tabindex="-1"></a><span class="fu">scalar</span> mean_rep78 = <span class="fu">r</span>(<span class="kw">mean</span>)</span>
<span id="cb300-5"><a href="#cb300-5" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;r(mean) guarda el promedio de rep78: &quot;</span> <span class="fu">r</span>(<span class="kw">mean</span>) </span>
<span id="cb300-6"><a href="#cb300-6" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;Pero tambien podemos recuperarlo:&quot;</span> mean_mpg</span></code></pre></div>
<p>Para utilizar un escalar en una operación solo es necesario llamarlo por su nombre. Para listar el contenido de todos los escalares <code>scalar list</code>. Para borrar <code>scalar drop scalar_name</code> o si quiero eliminar todo <code>scalar drop _all</code>. Los escalares permiten parametrizar un <code>do-file</code>.</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb301-1"><a href="#cb301-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> fem2, <span class="kw">clear</span> </span>
<span id="cb301-2"><a href="#cb301-2" aria-hidden="true" tabindex="-1"></a><span class="fu">scalar</span> lb1 = 80 </span>
<span id="cb301-3"><a href="#cb301-3" aria-hidden="true" tabindex="-1"></a><span class="fu">scalar</span> ub1 = 88 </span>
<span id="cb301-4"><a href="#cb301-4" aria-hidden="true" tabindex="-1"></a><span class="fu">scalar</span> lb2 = 89 </span>
<span id="cb301-5"><a href="#cb301-5" aria-hidden="true" tabindex="-1"></a><span class="fu">scalar</span> ub2 = 97 </span>
<span id="cb301-6"><a href="#cb301-6" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> i = 1/2 {</span>
<span id="cb301-7"><a href="#cb301-7" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="dt">_n</span> <span class="st">&quot;IQ&quot;</span> <span class="st">&quot;lb`i&#39;&quot;</span> <span class="st">&quot;-&quot;</span> <span class="st">&quot;ub`i&#39;&quot;</span> </span>
<span id="cb301-8"><a href="#cb301-8" aria-hidden="true" tabindex="-1"></a><span class="kw">tabulate</span> anxiety <span class="kw">if</span> <span class="fu">inrange</span>(iq, lb<span class="ot">`i&#39;</span>, ub<span class="ot">`i&#39;</span>)</span>
<span id="cb301-9"><a href="#cb301-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="elementos-y-operaciones-con-matrices" class="section level4 hasAnchor" number="3.4.1.2">
<h4 class="hasAnchor"><span class="header-section-number">3.4.1.2</span> Elementos y operaciones con matrices<a href="#elementos-y-operaciones-con-matrices" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Stata puede generar matrices.</p>
<div class="sourceCode" id="cb302"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb302-1"><a href="#cb302-1" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> <span class="kw">weight</span> age age2</span>
<span id="cb302-2"><a href="#cb302-2" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> b = <span class="fu">e</span>(b)</span>
<span id="cb302-3"><a href="#cb302-3" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> <span class="ot">list</span> b</span>
<span id="cb302-4"><a href="#cb302-4" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> <span class="kw">V</span> = <span class="fu">e</span>(<span class="kw">V</span>)</span>
<span id="cb302-5"><a href="#cb302-5" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> <span class="ot">list</span> <span class="kw">V</span></span></code></pre></div>
<p>Las matrices son muy importantes para guardar resultados y exportarlos de forma conveniente. También son útiles para cuando se quieren hacer estimaciones de muchos parámetros y para distintos conjuntos de datos.</p>
<p>Operaciones con matrices: Se puede operar con matrices. Por ejemplo, sabemos que <span class="math inline">\(b = (X&#39;X)^{-1}X&#39;y\)</span> y que <span class="math inline">\(V = \sigma^{2}(X&#39;X)^{-1}\)</span>. Si queremos extraer solo la matriz <span class="math inline">\(X&#39;y\)</span> tenemos que operar, calculando <span class="math inline">\(\frac{1}{\sigma^{2}}V^{-1}b\)</span>.</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb303-1"><a href="#cb303-1" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> <span class="kw">define</span> b = <span class="fu">e</span>(b)&#39; </span>
<span id="cb303-2"><a href="#cb303-2" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> <span class="kw">define</span> xty = <span class="fu">inv</span>(<span class="kw">V</span>) * b /<span class="fu">e</span>(rmse)^2</span>
<span id="cb303-3"><a href="#cb303-3" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> <span class="ot">list</span> xty </span></code></pre></div>
<p><code>e(b)’</code> indica la traspuesta, mientras que <code>inv()</code> es para calcular la matriz inversa.</p>
<p>Llamar a los elementos de una matriz: Se puede acceder a los escalares contenidos en las matrices. Por ejemplo, si queremos obtener los elementos de la matriz <span class="math inline">\(e(b)\)</span> tenemos:</p>
<div class="sourceCode" id="cb304"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb304-1"><a href="#cb304-1" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;The coefficient on weight is: &quot;</span> _b[<span class="kw">weight</span>] </span>
<span id="cb304-2"><a href="#cb304-2" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;Its standard error is: &quot;</span> _se[<span class="kw">weight</span>] </span>
<span id="cb304-3"><a href="#cb304-3" aria-hidden="true" tabindex="-1"></a>* Valores predichos </span>
<span id="cb304-4"><a href="#cb304-4" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> anxietyhat = _b[<span class="dt">_cons</span>] + _b[<span class="kw">weight</span>] * <span class="kw">weight</span> + <span class="co">/// </span></span>
<span id="cb304-5"><a href="#cb304-5" aria-hidden="true" tabindex="-1"></a>_b[age] * age + _b[age2] * age2</span></code></pre></div>
<p>También podemos utilizar las posiciones de los elementos de la matriz (<code>b[i,k)]</code>).</p>
</div>
<div id="funciones-1" class="section level4 hasAnchor" number="3.4.1.3">
<h4 class="hasAnchor"><span class="header-section-number">3.4.1.3</span> Funciones<a href="#funciones-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Solo disponibles para comandos <code>e-class</code>. Por ejemplo, si estimamos una regresión veremos que la unica función disponible es <code>e(sample)</code>.</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb305-1"><a href="#cb305-1" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto </span>
<span id="cb305-2"><a href="#cb305-2" aria-hidden="true" tabindex="-1"></a><span class="kw">regress</span> mpg <span class="kw">weight</span> <span class="fu">length</span> rep78</span>
<span id="cb305-3"><a href="#cb305-3" aria-hidden="true" tabindex="-1"></a><span class="kw">ereturn</span> <span class="ot">list</span></span></code></pre></div>
<p><code>e(sample)</code> nos indica si una determinada observación se utilizó para estimar la regresión. Es decir, es igual a uno si una observación estaba en la muestra de estimación y 0 si fue excluida.</p>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.4.1:</b></p>
<p>Preguntas:</p>
<ol style="list-style-type: decimal">
<li>Estime una regresión de mpg contra weight length rep78 utilizando base de datos auto, pero solo para los autos extranjeros (<code>foreign == 1</code>).</li>
<li>Genere una nueva variable, llamada <code>enmuestra</code> que tome los valores dados por la función <code>e(sample)</code>.</li>
<li>Utilizando <code>br</code>, observe los valores de <code>enmuestra</code>. ¿Qué observa?</li>
<li>Calcule la estadística de <code>mpg</code> solo para las observaciones que fueron incluidas en la regresión.</li>
</ol>
</div>
</div>
</div>
<div id="iteradores-1" class="section level3 hasAnchor" number="3.4.2">
<h3 class="hasAnchor"><span class="header-section-number">3.4.2</span> Iteradores<a href="#iteradores-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="foreach" class="section level4 hasAnchor" number="3.4.2.1">
<h4 class="hasAnchor"><span class="header-section-number">3.4.2.1</span> Foreach<a href="#foreach" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>foreach</code> y <code>forvalues</code>: <code>forvalues</code> itera sobre una lista de números y <code>foreach</code> recorre los elementos de una macro, o los nombres de las variables de una lista de variables, o los elementos de una lista de números.</p>
<div class="sourceCode" id="cb306"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb306-1"><a href="#cb306-1" aria-hidden="true" tabindex="-1"></a>* Foreach</span>
<span id="cb306-2"><a href="#cb306-2" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> animal <span class="kw">in</span> cats and dogs { </span>
<span id="cb306-3"><a href="#cb306-3" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;`animal&#39;&quot;</span></span>
<span id="cb306-4"><a href="#cb306-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb306-5"><a href="#cb306-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-6"><a href="#cb306-6" aria-hidden="true" tabindex="-1"></a>* Forvalues </span>
<span id="cb306-7"><a href="#cb306-7" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> i = 1(1)100 { </span>
<span id="cb306-8"><a href="#cb306-8" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> x<span class="ot">`i&#39;</span> = runiform()</span>
<span id="cb306-9"><a href="#cb306-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Hay algunas variaciones en <code>foreach</code> según el tipo de lista. La sintaxis es similar a la recien presentada, pero difiere en dos aspectos:</p>
<ul>
<li><code>in</code> se remplaza por <code>of</code>.</li>
<li>Hay que llamar al identificador.</li>
<li>Veamos como iterar sobre una lista de <strong>globales y locales</strong>.
\end{itemize}</li>
</ul>
<div class="sourceCode" id="cb307"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb307-1"><a href="#cb307-1" aria-hidden="true" tabindex="-1"></a>* Sobre locales <span class="fu">y</span> globales</span>
<span id="cb307-2"><a href="#cb307-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> money <span class="st">&quot;Franc Dollar Lira Pound&quot;</span> </span>
<span id="cb307-3"><a href="#cb307-3" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> currency <span class="kw">of</span> <span class="kw">local</span> money { </span>
<span id="cb307-4"><a href="#cb307-4" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;`currency&#39;&quot;</span></span>
<span id="cb307-5"><a href="#cb307-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Veamos como iterar sobre una <strong>lista de variables</strong>:</p>
<div class="sourceCode" id="cb308"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb308-1"><a href="#cb308-1" aria-hidden="true" tabindex="-1"></a>* Sobre lista <span class="kw">de</span> variables</span>
<span id="cb308-2"><a href="#cb308-2" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> <span class="kw">var</span> <span class="kw">of</span> <span class="kw">varlist</span> mpg <span class="kw">weight</span>-turn { </span>
<span id="cb308-3"><a href="#cb308-3" aria-hidden="true" tabindex="-1"></a><span class="kw">quietly</span> <span class="kw">summarize</span> <span class="ot">`var&#39;</span> <span class="kw">summarize</span> <span class="ot">`var&#39;</span> <span class="kw">if</span> <span class="ot">`var&#39;</span> &gt; <span class="fu">r</span>(<span class="kw">mean</span>)</span>
<span id="cb308-4"><a href="#cb308-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Veamos como iterar sobre una <strong>lista de de nuevas variables</strong>:</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb309-1"><a href="#cb309-1" aria-hidden="true" tabindex="-1"></a>* Sobre lista <span class="kw">de</span> nuevas variables</span>
<span id="cb309-2"><a href="#cb309-2" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> <span class="kw">var</span> <span class="kw">of</span> newlist z1-z20 { </span>
<span id="cb309-3"><a href="#cb309-3" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> <span class="ot">`var&#39;</span> = runiform()</span>
<span id="cb309-4"><a href="#cb309-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Veamos como iterar sobre una <strong>lista de números</strong>:</p>
<div class="sourceCode" id="cb310"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb310-1"><a href="#cb310-1" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> num <span class="kw">of</span> numlist 1 4/8 13(2)21 103 { </span>
<span id="cb310-2"><a href="#cb310-2" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="ot">`num&#39;</span></span>
<span id="cb310-3"><a href="#cb310-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="combinar-macros-con-iteradores" class="section level4 hasAnchor" number="3.4.2.2">
<h4 class="hasAnchor"><span class="header-section-number">3.4.2.2</span> Combinar macros con iteradores<a href="#combinar-macros-con-iteradores" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>foreach</code> y <code>forvalues</code> combinados con macros pueden utilizarse para ahorrarnos mucho trabajo. Podemos generar tun conjunto de locales a partir de iteraciones.</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb311-1"><a href="#cb311-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> replicate.dta, <span class="kw">replace</span></span>
<span id="cb311-2"><a href="#cb311-2" aria-hidden="true" tabindex="-1"></a><span class="kw">levelsof</span> cty</span>
<span id="cb311-3"><a href="#cb311-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> ctries <span class="st">&quot;`r(levels)&#39;&quot;</span> </span>
<span id="cb311-4"><a href="#cb311-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb311-5"><a href="#cb311-5" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> ctr <span class="kw">in</span> <span class="ot">`ctries&#39;</span> { </span>
<span id="cb311-6"><a href="#cb311-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">sum</span> hours_t <span class="kw">if</span> cty == <span class="st">&quot;`ctr&#39;&quot;</span> </span>
<span id="cb311-7"><a href="#cb311-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">local</span> nombre <span class="ot">`ctr&#39;</span> = <span class="ot">`r(mean)&#39;</span></span>
<span id="cb311-8"><a href="#cb311-8" aria-hidden="true" tabindex="-1"></a>} </span></code></pre></div>
<p>Como ya hemos visto, el comando <code>levelsof</code> devuelve una lista de todos los valores distintos de una variable categórica y los guarda en la macro <code>r(levels)</code>. Esto lo hace en el caso de que nosotros no le asignemos un nombre. Podemos utilizar esta lista para los países y años de nuestra muestra para definir dos iteraciones que recorran todos los valores posibles. Para cada valor resumimos la población y definimos una macro local compuesta por el código de país y el año (por ejemplo, USA1990) que toma el valor de la población en ese año para ese país.</p>
<p>Una aplicación del <code>forvalues</code>:</p>
<div class="sourceCode" id="cb312"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb312-1"><a href="#cb312-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> gdp4cty, <span class="kw">clear</span> </span>
<span id="cb312-2"><a href="#cb312-2" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> i = 1/4 {</span>
<span id="cb312-3"><a href="#cb312-3" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> <span class="kw">double</span> lngdp&#39;i&#39; = <span class="fu">log</span>(gdp&#39;i&#39;)</span>
<span id="cb312-4"><a href="#cb312-4" aria-hidden="true" tabindex="-1"></a><span class="kw">summarize</span> lngdp&#39;i&#39;</span>
<span id="cb312-5"><a href="#cb312-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Utilizando dos <code>forvalues</code>:</p>
<div class="sourceCode" id="cb313"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb313-1"><a href="#cb313-1" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> <span class="fu">y</span> = 1995(2)1999 {</span>
<span id="cb313-2"><a href="#cb313-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">forvalues</span> i = 2(2)4 {</span>
<span id="cb313-3"><a href="#cb313-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">summarize</span> gdp<span class="ot">`i&#39;</span>_<span class="ot">`y&#39;</span></span>
<span id="cb313-4"><a href="#cb313-4" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb313-5"><a href="#cb313-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><code>foreach</code> y <code>recode</code>:</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb314-1"><a href="#cb314-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> gdp4cty, <span class="kw">clear</span> </span>
<span id="cb314-2"><a href="#cb314-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> ctycode 111 112 136 134 </span>
<span id="cb314-3"><a href="#cb314-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> i 0</span>
<span id="cb314-4"><a href="#cb314-4" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> c <span class="kw">of</span> <span class="kw">local</span> ctycode{ </span>
<span id="cb314-5"><a href="#cb314-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">local</span> ++i </span>
<span id="cb314-6"><a href="#cb314-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">local</span> rc <span class="st">&quot;`rc&#39; (`i&#39;=`c&#39;)&quot;</span> </span>
<span id="cb314-7"><a href="#cb314-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb314-8"><a href="#cb314-8" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;`rc&#39;&quot;</span></span>
<span id="cb314-9"><a href="#cb314-9" aria-hidden="true" tabindex="-1"></a><span class="kw">recode</span> <span class="kw">cc</span> <span class="ot">`rc&#39;</span>, <span class="kw">gen</span>(newcc)</span></code></pre></div>
<p>Loops anidados: <code>foreach</code> y <code>forvalues</code></p>
<div class="sourceCode" id="cb315"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb315-1"><a href="#cb315-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> gdp4cty, <span class="kw">clear</span> </span>
<span id="cb315-2"><a href="#cb315-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> country US UK DE FR </span>
<span id="cb315-3"><a href="#cb315-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> yrlist 1995 1999 </span>
<span id="cb315-4"><a href="#cb315-4" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> i = 1/4 {</span>
<span id="cb315-5"><a href="#cb315-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span> cnaine: <span class="fu">word</span> <span class="ot">`i&#39;</span> <span class="kw">of</span> <span class="ot">`country&#39;</span></span>
<span id="cb315-6"><a href="#cb315-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="st">&quot;`cnaine&#39;&quot;</span></span>
<span id="cb315-7"><a href="#cb315-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="fu">y</span> <span class="kw">of</span> <span class="kw">local</span> yrlist {</span>
<span id="cb315-8"><a href="#cb315-8" aria-hidden="true" tabindex="-1"></a>            <span class="kw">rename</span> gdp<span class="ot">`i&#39;</span>_<span class="ot">`y&#39;</span> gdp<span class="ot">`cnaine&#39;</span>_<span class="ot">`y&#39;</span></span>
<span id="cb315-9"><a href="#cb315-9" aria-hidden="true" tabindex="-1"></a>    } </span>
<span id="cb315-10"><a href="#cb315-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>En estos casos es bueno utilizar espacios para hacer el código más amigable. Ojo que a Stata no le interesa esto para ejecutar, es solo una cuestión de estilo.</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb316-1"><a href="#cb316-1" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto, <span class="kw">clear</span></span>
<span id="cb316-2"><a href="#cb316-2" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> <span class="fu">y</span> <span class="kw">of</span> <span class="kw">varlist</span> mpg rep78 headroom trunk <span class="kw">weight</span> <span class="fu">length</span> { </span>
<span id="cb316-3"><a href="#cb316-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> x <span class="kw">of</span> <span class="kw">varlist</span> rep78 price displacement gear_ratio foreign { </span>
<span id="cb316-4"><a href="#cb316-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">regress</span> <span class="ot">`y&#39;</span> <span class="ot">`x&#39;</span></span>
<span id="cb316-5"><a href="#cb316-5" aria-hidden="true" tabindex="-1"></a>} </span></code></pre></div>
<p>También útil para estimar regresiones.</p>
<p>Tokenize: Podemos almacenar los elementos de la lista de países en macros numeradas con <code>tokenize</code>.</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb317-1"><a href="#cb317-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> gdp4cty, <span class="kw">clear</span></span>
<span id="cb317-2"><a href="#cb317-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> country US UK DE FR </span>
<span id="cb317-3"><a href="#cb317-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> yrlist 1995 1999 </span>
<span id="cb317-4"><a href="#cb317-4" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> ncty: <span class="fu">word</span> <span class="fu">count</span> <span class="ot">`country&#39;</span></span>
<span id="cb317-5"><a href="#cb317-5" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;`ncty&#39;&quot;</span></span>
<span id="cb317-6"><a href="#cb317-6" aria-hidden="true" tabindex="-1"></a><span class="kw">tokenize</span> <span class="ot">`country&#39;</span></span>
<span id="cb317-7"><a href="#cb317-7" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> i = 1/<span class="ot">`ncty&#39;</span>{</span>
<span id="cb317-8"><a href="#cb317-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="fu">y</span> <span class="kw">of</span> <span class="kw">local</span> yrlist {</span>
<span id="cb317-9"><a href="#cb317-9" aria-hidden="true" tabindex="-1"></a>            <span class="kw">rename</span> gdp<span class="ot">`i&#39;</span>_<span class="ot">`y&#39;</span> gdp<span class="ot">``i&#39;</span>&#39;_<span class="ot">`y&#39;</span></span>
<span id="cb317-10"><a href="#cb317-10" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb317-11"><a href="#cb317-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Aquí los nombres de los países se almacenan como valores de las macros numeradas. Debemos referenciar doblemente la macro <span class="math inline">\(i\)</span>. El contenido de esa macro la primera vez que se pasa por el bucle es el número 1. Para acceder al primer código de país, debemos referenciar la macro <span class="math inline">\(`1&#39;\)</span>.</p>
</div>
<div id="while-loop" class="section level4 hasAnchor" number="3.4.2.3">
<h4 class="hasAnchor"><span class="header-section-number">3.4.2.3</span> While loop<a href="#while-loop" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Realiza la iteración o se repite una lista de comandos mientras la condición <code>while</code> sea verdadera. La sintaxis es:</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb318-1"><a href="#cb318-1" aria-hidden="true" tabindex="-1"></a><span class="kw">while</span> <span class="fu">exp</span> { </span>
<span id="cb318-2"><a href="#cb318-2" aria-hidden="true" tabindex="-1"></a>hace algo</span>
<span id="cb318-3"><a href="#cb318-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>¿Cuando es útil? : <strong>Cuando no este seguro(a) cuantas veces se realizará la iteración</strong>. Notar que si no hay convergencia, va iterar infinitamente.</p>
<div class="sourceCode" id="cb319"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb319-1"><a href="#cb319-1" aria-hidden="true" tabindex="-1"></a><span class="kw">while</span> <span class="fu">reldif</span> (nueva, antigua) &gt; 0.001 { </span>
<span id="cb319-2"><a href="#cb319-2" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>También se puede combinar con macros. Es importante utilizar los incrementales:</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb320-1"><a href="#cb320-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> i=1 </span>
<span id="cb320-2"><a href="#cb320-2" aria-hidden="true" tabindex="-1"></a><span class="kw">while</span> <span class="ot">`i&#39;</span>&lt;=5 {</span>
<span id="cb320-3"><a href="#cb320-3" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;loop number&quot;</span> <span class="ot">`i&#39;</span> </span>
<span id="cb320-4"><a href="#cb320-4" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> i = <span class="ot">`i&#39;</span>+1</span>
<span id="cb320-5"><a href="#cb320-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>La primera parte define el inicio del contador, mientras que la segunda indica la condición para que sea ejecutado. El <code>local</code> final actualiza (incremental). Si el incremento es unitario podemos utilizar <code>local ++i</code>.</p>
</div>
<div id="branching" class="section level4 hasAnchor" number="3.4.2.4">
<h4 class="hasAnchor"><span class="header-section-number">3.4.2.4</span> Branching<a href="#branching" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Hacer una cosa en caso de que alguna condición sea cierta y otra cosa en caso de que sea falsa. La sintaxis básica es:</p>
<div class="sourceCode" id="cb321"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb321-1"><a href="#cb321-1" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> algo es verdadero { </span>
<span id="cb321-2"><a href="#cb321-2" aria-hidden="true" tabindex="-1"></a>hacer esto</span>
<span id="cb321-3"><a href="#cb321-3" aria-hidden="true" tabindex="-1"></a>} <span class="kw">else</span> {</span>
<span id="cb321-4"><a href="#cb321-4" aria-hidden="true" tabindex="-1"></a>hacer lo contrario</span>
<span id="cb321-5"><a href="#cb321-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.4.2:</b></p>
<p>Preguntas</p>
<ol style="list-style-type: decimal">
<li>Defina una macro llamada mimacro que sea igual a un número entero aleatorio entre 1 y 99.</li>
<li>Utilizando <code>if</code> y <code>else</code> muestre un mensaje que diga si es par o impar.</li>
</ol>
</div>
</div>
<div id="aplicaciones" class="section level4 hasAnchor" number="3.4.2.5">
<h4 class="hasAnchor"><span class="header-section-number">3.4.2.5</span> Aplicaciones<a href="#aplicaciones" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Seguir secuencias especiales: <code>creturn</code> posee varias constantes y valores a los que se puede acceder. Por ejemplo:</p>
<ul>
<li><code>c(filename)</code> nombre del último nombre del archivo guardado.</li>
<li><code>c(alpha/ALPHA)</code> lista de letras minúsculas/mayusculas.<br />
</li>
<li><code>c(Mons)</code> lista de nombres de los meses abreviados.</li>
<li><code>c(Months)</code> lista de los nombres de los meses no abreviados.</li>
<li><code>c(Wdays)</code> lista de los dias de la semana abreviados a tres caracteres.</li>
<li><code>c(Weekdays)</code> lista de los días de la semana no abreviados.</li>
</ul>
<p>Con un iterador es posible aplicar estas listas para agregar labels. Suponga que tenemos valores de 1 a 12 que representan meses.</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb322-1"><a href="#cb322-1" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span> <span class="ot">all</span></span>
<span id="cb322-2"><a href="#cb322-2" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="kw">obs</span> 12</span>
<span id="cb322-3"><a href="#cb322-3" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> <span class="fu">month</span> = <span class="dt">_n</span> </span>
<span id="cb322-4"><a href="#cb322-4" aria-hidden="true" tabindex="-1"></a><span class="kw">tokenize</span> <span class="ot">`c(Months)&#39;</span> </span>
<span id="cb322-5"><a href="#cb322-5" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> i = 1/12 {</span>
<span id="cb322-6"><a href="#cb322-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">label</span> <span class="kw">define</span> monthlab <span class="ot">`i&#39;</span> <span class="st">&quot;``i&#39;&#39;&quot;</span> , modify </span>
<span id="cb322-7"><a href="#cb322-7" aria-hidden="true" tabindex="-1"></a>                   }</span>
<span id="cb322-8"><a href="#cb322-8" aria-hidden="true" tabindex="-1"></a><span class="kw">label</span> val <span class="fu">month</span> monthlab</span></code></pre></div>
</div>
<div id="monitorear-un-loop" class="section level4 hasAnchor" number="3.4.2.6">
<h4 class="hasAnchor"><span class="header-section-number">3.4.2.6</span> Monitorear un loop<a href="#monitorear-un-loop" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Ejemplo proveniente de (Stata tip 41). Cualquier <em>loop</em> puede ser modificado para que muestre su progreso con el comando <code>_dots</code>. Esto es importante para cuando se requieren hacer procesos que toman varias horas y es necesario monitorear avances.</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb323-1"><a href="#cb323-1" aria-hidden="true" tabindex="-1"></a><span class="kw">_dots</span> 0, <span class="bn">title</span>(Loop ejecutando) reps(75) </span>
<span id="cb323-2"><a href="#cb323-2" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> i = 1/75 { </span>
<span id="cb323-3"><a href="#cb323-3" aria-hidden="true" tabindex="-1"></a><span class="kw">_dots</span> ‘i’ 0</span>
<span id="cb323-4"><a href="#cb323-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb323-5"><a href="#cb323-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb323-6"><a href="#cb323-6" aria-hidden="true" tabindex="-1"></a>----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5</span>
<span id="cb323-7"><a href="#cb323-7" aria-hidden="true" tabindex="-1"></a>..................................................    50</span>
<span id="cb323-8"><a href="#cb323-8" aria-hidden="true" tabindex="-1"></a>.........................</span></code></pre></div>
<p>El primer comando <code>_dots</code> establece las lineas. Titulo y número de repeticiones son opcionales. <code>reps</code> solo acepta enteros como argumento. <code>_dots ‘i’ 0</code> tiene dos elementos:</p>
<ul>
<li>El primer argumento es el número de repetición, que registra el número de intentos en curso. En el ejemplo, esta automáticamente determinado por el <em>loop</em>.</li>
<li>El segundo argumento es el código de retorno, el cual indica el tipo de símbolo. En el ejemplo tenemos un 0.</li>
<li>Los códigos de retorno alternativos producen una “s” (-1), “.” (), “x” roja (1), una “e” (2), una “n” (3) o un “?” (cualquier otro valor).</li>
</ul>
<p>Ejemplo no numérico: La idea es definir una macro local para que actue como un contador.</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb324-1"><a href="#cb324-1" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto</span>
<span id="cb324-2"><a href="#cb324-2" aria-hidden="true" tabindex="-1"></a><span class="kw">_dots</span> 0, reps(10)</span>
<span id="cb324-3"><a href="#cb324-3" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> <span class="kw">var</span> <span class="kw">of</span> <span class="kw">varlist</span> price - gear_ratio {</span>
<span id="cb324-4"><a href="#cb324-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">sum</span> <span class="ot">`var&#39;</span>, <span class="kw">d</span></span>
<span id="cb324-5"><a href="#cb324-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">local</span> i = <span class="ot">`i&#39;</span>+1</span>
<span id="cb324-6"><a href="#cb324-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">_dots</span> <span class="ot">`i&#39;</span> 0</span>
<span id="cb324-7"><a href="#cb324-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Contar repeticiones:</p>
<ul>
<li>El número de repeticiones en <code>rep</code> no es calculado por <code>_dots</code>. Es necesario contar manualmente las variables e introducir el número.</li>
<li>Esto lo vamos a hacer con la ayuda de una función de macro extendida <code>sizeof</code>.</li>
<li><code>unab</code> permite ingresar una lista de variable abreviada y expandirla, de forma tal de que la pueda contar.</li>
</ul>
<div class="sourceCode" id="cb325"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb325-1"><a href="#cb325-1" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto</span>
<span id="cb325-2"><a href="#cb325-2" aria-hidden="true" tabindex="-1"></a><span class="kw">unab</span> myvars : price - gear_ratio</span>
<span id="cb325-3"><a href="#cb325-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="kw">N</span> : <span class="ot">list</span> <span class="kw">sizeof</span> myvars</span>
<span id="cb325-4"><a href="#cb325-4" aria-hidden="true" tabindex="-1"></a><span class="kw">_dots</span> 0, reps(<span class="ot">`N&#39;</span>)</span>
<span id="cb325-5"><a href="#cb325-5" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> <span class="kw">var</span> <span class="kw">of</span> <span class="kw">varlist</span> <span class="ot">`myvars&#39;</span> {</span>
<span id="cb325-6"><a href="#cb325-6" aria-hidden="true" tabindex="-1"></a>  ...</span>
<span id="cb325-7"><a href="#cb325-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">local</span> i = <span class="ot">`i&#39;</span>+1</span>
<span id="cb325-8"><a href="#cb325-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">_dots</span> <span class="ot">`i&#39;</span> 0</span>
<span id="cb325-9"><a href="#cb325-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Un ejemplo más complejo es:</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb326-1"><a href="#cb326-1" aria-hidden="true" tabindex="-1"></a><span class="kw">noisily</span> <span class="kw">_dots</span> 0, <span class="bn">title</span>(Looping <span class="kw">until</span> 70 successes...) </span>
<span id="cb326-2"><a href="#cb326-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> rep 1 </span>
<span id="cb326-3"><a href="#cb326-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> nsuccess 0 </span>
<span id="cb326-4"><a href="#cb326-4" aria-hidden="true" tabindex="-1"></a><span class="kw">while</span> ‘nsuccess’ &lt; 70 { </span>
<span id="cb326-5"><a href="#cb326-5" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> fail = uniform() &lt; .2 </span>
<span id="cb326-6"><a href="#cb326-6" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> nsuccess = ‘nsuccess’ + (‘fail’ == 0) </span>
<span id="cb326-7"><a href="#cb326-7" aria-hidden="true" tabindex="-1"></a><span class="kw">noisily</span> <span class="kw">_dots</span> ‘rep++’ ‘fail’</span>
<span id="cb326-8"><a href="#cb326-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Se ejecuta hasta que logre 70 aciertos. En este ejemplo artificial, cada iteración tiene un éxito aleatorio con una probabilidad del 80%. Los éxitos se indican con un punto (.) y los fracasos con una x.</p>
</div>
</div>
<div id="manejo-de-bases-de-datos" class="section level3 hasAnchor" number="3.4.3">
<h3 class="hasAnchor"><span class="header-section-number">3.4.3</span> Manejo de bases de datos<a href="#manejo-de-bases-de-datos" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="prefijo-by" class="section level4 hasAnchor" number="3.4.3.1">
<h4 class="hasAnchor"><span class="header-section-number">3.4.3.1</span> Prefijo: by<a href="#prefijo-by" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Los prefijos en Stata ejecutan tareas repetitivas sin la necesidad de especificar el rango de valores sobre la tarea que es ejecutada. Un prefijo muy conocido es <code>by</code>. Por ejemplo, <code>by varlist [, sort]: command</code>. <code>command</code> es repetido para cada valor de la variable. Es más, repeticiones siguen el orden de la variable sea <em>string</em> o <em>numeric</em>.</p>
<div class="sourceCode" id="cb327"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb327-1"><a href="#cb327-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> bpress, <span class="kw">clear</span></span>
<span id="cb327-2"><a href="#cb327-2" aria-hidden="true" tabindex="-1"></a><span class="kw">bysort</span> sex agegrp: <span class="kw">summarize</span> bp </span></code></pre></div>
</div>
<div id="prefijo-xi" class="section level4 hasAnchor" number="3.4.3.2">
<h4 class="hasAnchor"><span class="header-section-number">3.4.3.2</span> Prefijo: xi<a href="#prefijo-xi" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>xi</code> es útil para cuando queremos producir un variable indicador para las observaciones que son distintas entre si.</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb328-1"><a href="#cb328-1" aria-hidden="true" tabindex="-1"></a><span class="kw">xi</span> i.agegrp</span></code></pre></div>
<p>El ejemplo le esta diciendo a Stata que genere variables indicadores. Esto es muy útil para reducir los códigos.</p>
<p>Interpretando prefijo xi: <code>xi</code> es comúnmente utilizado como un prefijo. La principal ventaja es cuando existen múltiples interacciones entre las variables.</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb329-1"><a href="#cb329-1" aria-hidden="true" tabindex="-1"></a>* Caso 1: incluye indicadores <span class="kw">de</span> ambas variables.</span>
<span id="cb329-2"><a href="#cb329-2" aria-hidden="true" tabindex="-1"></a><span class="kw">xi</span>: <span class="kw">regress</span> bp i.agegrp i.sex</span>
<span id="cb329-3"><a href="#cb329-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb329-4"><a href="#cb329-4" aria-hidden="true" tabindex="-1"></a>* Caso 2: incluye además interacciones entre ellas.</span>
<span id="cb329-5"><a href="#cb329-5" aria-hidden="true" tabindex="-1"></a><span class="kw">xi</span>: <span class="kw">regress</span> bp i.agegrp*i.sex</span>
<span id="cb329-6"><a href="#cb329-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb329-7"><a href="#cb329-7" aria-hidden="true" tabindex="-1"></a>* Caso 3: Interactúa una <span class="kw">variable</span> continua con una discreta.</span>
<span id="cb329-8"><a href="#cb329-8" aria-hidden="true" tabindex="-1"></a><span class="kw">xi</span>: <span class="kw">regress</span> bp i.agegrp*bp0</span>
<span id="cb329-9"><a href="#cb329-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb329-10"><a href="#cb329-10" aria-hidden="true" tabindex="-1"></a>* Caso 4: Incluye solo interacciones con <span class="kw">variable</span> continua (además <span class="kw">de</span> principal). </span>
<span id="cb329-11"><a href="#cb329-11" aria-hidden="true" tabindex="-1"></a><span class="kw">xi</span>: <span class="kw">regress</span> bp i.agegrp|bp0 </span></code></pre></div>
</div>
<div id="prefijo-statsby" class="section level4 hasAnchor" number="3.4.3.3">
<h4 class="hasAnchor"><span class="header-section-number">3.4.3.3</span> Prefijo: statsby<a href="#prefijo-statsby" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>statsby</code> permite ampliar <code>by</code>. Este último tiene la limitación de permitir únicamente un comando.</p>
<div class="sourceCode" id="cb330"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb330-1"><a href="#cb330-1" aria-hidden="true" tabindex="-1"></a><span class="kw">statsby</span> <span class="kw">mean</span>=<span class="fu">r</span>(<span class="kw">mean</span>) <span class="fu">sd</span>=<span class="fu">r</span>(<span class="fu">sd</span>) n=<span class="fu">r</span>(<span class="kw">N</span>), <span class="kw">by</span>(agegrp sex): <span class="kw">summarize</span> bp</span></code></pre></div>
<p>Se produce una nueva base de datos con una observación por grupo con los estadísticos incorporados. <strong>Útil para calcular estadística descriptiva</strong>.</p>
</div>
<div id="prefijo-rolling" class="section level4 hasAnchor" number="3.4.3.4">
<h4 class="hasAnchor"><span class="header-section-number">3.4.3.4</span> Prefijo: rolling<a href="#prefijo-rolling" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>statsby</code> permite obtener estadísticas para sub-muestras que no se traslapan. <code>rolling</code> sirve para sub-muestras traslapadas. Por ejemplo, al trabajar con series de tiempo se quiere calcular estadísticas para datos que están traslapados (el. calcular una media móvil).</p>
<p>Vamos a calcular medias y medianas utilizando una ventana de 90 días:</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb331-1"><a href="#cb331-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> ibm, <span class="kw">clear</span> </span>
<span id="cb331-2"><a href="#cb331-2" aria-hidden="true" tabindex="-1"></a><span class="kw">rolling</span> <span class="kw">mean</span>=<span class="fu">r</span>(<span class="kw">mean</span>) <span class="kw">median</span>=<span class="fu">r</span>(p50), <span class="kw">window</span>(90): <span class="kw">summarize</span> spx, <span class="kw">d</span> </span>
<span id="cb331-3"><a href="#cb331-3" aria-hidden="true" tabindex="-1"></a><span class="kw">tsset</span> <span class="kw">end</span> </span>
<span id="cb331-4"><a href="#cb331-4" aria-hidden="true" tabindex="-1"></a><span class="kw">tsline</span> <span class="kw">mean</span></span></code></pre></div>
<p><code>start</code> y <code>end</code> indican el inicio y fin de la ventana.</p>
</div>
<div id="merge-y-append" class="section level4 hasAnchor" number="3.4.3.5">
<h4 class="hasAnchor"><span class="header-section-number">3.4.3.5</span> Merge y Append<a href="#merge-y-append" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Recomendaciones para utilizar merge</p>
<ul>
<li>Especifique siempre el tipo de fusión (1:1, m:1 o 1:m). Si no se especifica el tipo de fusión, se llama a la versión antigua y no robusta de la fusión.</li>
<li>Nunca haga fusiones de muchos a muchos (m:m), o al menos, sólo hágalo cuando tenga una muy buena razón.</li>
<li>Incluya siempre la opción <code>assert()</code> para indicar qué patrón de observaciones coincidentes espera.</li>
<li>Incluya siempre la opción <code>keep()</code> para indicar qué observaciones deben conservarse del conjunto de datos fusionados.</li>
<li>Siempre que sea posible, incluya la opción <code>keepusing()</code> y enumere explícitamente qué variables pretende añadir al conjunto de datos; puede incluir esta opción incluso cuando mantenga todas las variables de los datos utilizados.</li>
<li>Utilice la opción <code>nogen</code>, excepto cuando piense utilizar explícitamente la variable <code>_merge</code> más adelante. Nunca debe guardar un conjunto de datos que tenga <code>_merge</code>; si necesita esta variable más adelante, dele un nombre más informativo.</li>
</ul>
<p>Con respecto a especificar <code>_merge</code> y <code>assert</code> notar que:</p>
<div class="sourceCode" id="cb332"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb332-1"><a href="#cb332-1" aria-hidden="true" tabindex="-1"></a>     <span class="kw">merge</span> ..., <span class="kw">assert</span>(<span class="fu">match</span> master) <span class="kw">keep</span>(<span class="fu">match</span>)</span>
<span id="cb332-2"><a href="#cb332-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb332-3"><a href="#cb332-3" aria-hidden="true" tabindex="-1"></a>     * Es equivalente a: </span>
<span id="cb332-4"><a href="#cb332-4" aria-hidden="true" tabindex="-1"></a>     <span class="kw">merge</span> ...</span>
<span id="cb332-5"><a href="#cb332-5" aria-hidden="true" tabindex="-1"></a>     <span class="kw">assert</span> <span class="dt">_merge</span>==1 | <span class="dt">_merge</span>==3</span>
<span id="cb332-6"><a href="#cb332-6" aria-hidden="true" tabindex="-1"></a>     <span class="kw">keep</span> <span class="kw">if</span> <span class="dt">_merge</span>==3</span></code></pre></div>
<p>Append con ciudado:</p>
<ul>
<li>El comando <code>append</code> es muy útil para manejos de bases de datos. Una precaución común es con respecto al nombre de las variables. Si dos variables (ej. PRECIO y precio) difieren, se generaran dos columnas nuevas al hacer el <code>append</code> en vez de una.</li>
<li>Una precaución un poco menos conocida guarda relación con el tipo de variables. ¿Qué ocurre si dos variables se llaman igual, pero <strong>estan guardadas en formatos distintos</strong>?</li>
<li>En este caso, el orden en el cual se combine la base de datos va a importar y puede generar diferencias al momento de pegar datos. Esto es especialmente importante cuando una variable esta guardada en numérico en una base de datos y en <code>string</code> en la otra.</li>
</ul>
<p>Veamos un ejemplo con la base <code>auto.dta</code>. Vamos a crear dos bases de datos según la procedencia de los autos y ejecutar el comando <code>append</code>.</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb333-1"><a href="#cb333-1" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto </span>
<span id="cb333-2"><a href="#cb333-2" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> <span class="kw">if</span> foreign</span>
<span id="cb333-3"><a href="#cb333-3" aria-hidden="true" tabindex="-1"></a><span class="kw">save</span> autodom </span>
<span id="cb333-4"><a href="#cb333-4" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto </span>
<span id="cb333-5"><a href="#cb333-5" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> <span class="kw">if</span> !foreign </span>
<span id="cb333-6"><a href="#cb333-6" aria-hidden="true" tabindex="-1"></a><span class="kw">rename</span> foreign nondom </span>
<span id="cb333-7"><a href="#cb333-7" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> str foreign = <span class="st">&quot;foreign&quot;</span> <span class="kw">if</span> nondom </span>
<span id="cb333-8"><a href="#cb333-8" aria-hidden="true" tabindex="-1"></a><span class="kw">save</span> autofor</span>
<span id="cb333-9"><a href="#cb333-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb333-10"><a href="#cb333-10" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> autdom </span>
<span id="cb333-11"><a href="#cb333-11" aria-hidden="true" tabindex="-1"></a><span class="kw">append</span> <span class="kw">using</span> autofor </span>
<span id="cb333-12"><a href="#cb333-12" aria-hidden="true" tabindex="-1"></a><span class="kw">describe</span> foreign </span></code></pre></div>
<p>Notar que <code>append</code> genera el siguiente mensaje: <code>foreign is str 7 in using data byt will be byte now</code>. Noten que el contenido de la variable string se ha perdido: 22 casos son ahora <em>missing</em>.</p>
<p>¿Qué ocurre si hacemos el proceso al revés? Vamos a cargar autos extranjeros y le vamos a pegar autos domésticos:</p>
<div class="sourceCode" id="cb334"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb334-1"><a href="#cb334-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> autfor </span>
<span id="cb334-2"><a href="#cb334-2" aria-hidden="true" tabindex="-1"></a><span class="kw">append</span> <span class="kw">using</span> autodom, <span class="kw">force</span></span>
<span id="cb334-3"><a href="#cb334-3" aria-hidden="true" tabindex="-1"></a><span class="kw">describe</span> foreign </span>
<span id="cb334-4"><a href="#cb334-4" aria-hidden="true" tabindex="-1"></a><span class="kw">codebook</span> foreign</span></code></pre></div>
<p>El formato de los datos de la primer base de datos manda.
* No utilizar force sin cuidado.
* Con distintos tipos de datos, <code>append</code> es sensible al orden en que los archivos son pegados. <strong>Tener cuidado y revisar consistencia en los datos</strong>. Hacer test aquí tambíen es importante.</p>
</div>
</div>
</div>
<div id="programar-ado---files-parte-i" class="section level2 hasAnchor" number="3.5">
<h2 class="hasAnchor"><span class="header-section-number">3.5</span> Programar ado - files (Parte I)<a href="#programar-ado---files-parte-i" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="escribir-programas-en-stata" class="section level3 hasAnchor" number="3.5.1">
<h3 class="hasAnchor"><span class="header-section-number">3.5.1</span> Escribir programas en Stata<a href="#escribir-programas-en-stata" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>En esta sección aprenderemos a escribir nuestros propios comandos en Stata. Escribir programas en Stata tiene muchas ventajas relacionadas con las buenas practicas que vimos en la Sección 1.</p>
<p>Vamos a utilizar <code>program</code> para escribir los programas. Es posible equipar cualquier comando con las opciones típicas usuales (ej. <code>if</code> o <code>inrange</code>. Discutiremos mayormente programas del tipo <code>r-class</code> y algunos comentarios con respecto a los del tipo <code>e-class</code>.</p>
<p><strong>¿Por qué debiese escribir mis propios programas en Stata?</strong> Automatizar procesos que se ejecutan frecuentemente y donde los resultados dependen de algún tipo de heterogeneidad.</p>
</div>
<div id="por-qué-escribir-programas-abstracción" class="section level3 hasAnchor" number="3.5.2">
<h3 class="hasAnchor"><span class="header-section-number">3.5.2</span> ¿Por qué escribir programas?: Abstracción<a href="#por-qué-escribir-programas-abstracción" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Abstraer para eliminar pasos redundantes.<br />
</li>
<li>Abstraer con fines de hacer códigos más claros. <strong>No por otras razones</strong>.</li>
<li>Abstracción es esencial para escribir un buen código por al menos dos razones:
<ul>
<li>Al eliminar la redundancia se reducen las posibilidades de cometer errores.</li>
<li>Aumenta la claridad. Para cualquier lector será más facil leer un código no redundante.</li>
</ul></li>
</ul>
<p>Veamos un ejemplo: Supongamos que queremos ver la correlación espacial del consumo de papas fritas. Queremos testear si el consumo per-capita de papas fritas esta correlacionado con el consumo promedio percapita de las otras comunas de la misma región. Primero tenemos que calcular el consumo per-capita del resto:</p>
<div class="sourceCode" id="cb335"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb335-1"><a href="#cb335-1" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> total_pc_papitas = <span class="kw">total</span>(pc_papitas), <span class="kw">by</span>(region)</span>
<span id="cb335-2"><a href="#cb335-2" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> total_obs = <span class="fu">count</span>(pc_papitas), <span class="kw">by</span>(region)</span>
<span id="cb335-3"><a href="#cb335-3" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> consumo_papitas_resto_pc = <span class="co">///</span></span>
<span id="cb335-4"><a href="#cb335-4" aria-hidden="true" tabindex="-1"></a>(total_pc_papitas - pc_papitas)/(total_obs - 1)</span></code></pre></div>
<p>Ahora podemos ver si existe correlación. ¿Pero si queremos cambiar el nivel de agregación? Tal vez si existe correlación, pero a nivel de área metropolitana. Copiemos el código de nuevo y calculemos esto.</p>
<div class="sourceCode" id="cb336"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb336-1"><a href="#cb336-1" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> total_pc_papitas = <span class="kw">total</span>(pc_papitas), <span class="kw">by</span>(metroarea)</span>
<span id="cb336-2"><a href="#cb336-2" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> total_obs = <span class="fu">count</span>(pc_papitas), <span class="kw">by</span>(region)</span>
<span id="cb336-3"><a href="#cb336-3" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> consumo_papitas_restometro_pc = <span class="co">///</span></span>
<span id="cb336-4"><a href="#cb336-4" aria-hidden="true" tabindex="-1"></a>(total_pc_papitas - pc_papitas)/(total_obs - 1)</span></code></pre></div>
<p>Noten que hay un error. Se nos olvido remplazar región por <code>metroarea</code>. Este error se puede propagar si seguimos haciendo operaciones. Una alternativa al copiar y pegar es escribir una función con propósito general que calcule la variable que deseamos bajo distintos parámetros.</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb337-1"><a href="#cb337-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> consumo_papitas_resto </span>
<span id="cb337-2"><a href="#cb337-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">syntax</span>, invar(varname) outvar(<span class="bn">name</span>) byvar(varname)</span>
<span id="cb337-3"><a href="#cb337-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">tempvar</span> tot_invar count_invar </span>
<span id="cb337-4"><a href="#cb337-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">egen</span> <span class="ot">`tot_invar&#39;</span> = <span class="kw">total</span>(<span class="ot">`invar&#39;</span>), <span class="kw">by</span>(<span class="ot">`byvar&#39;</span>)</span>
<span id="cb337-5"><a href="#cb337-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">egen</span> <span class="ot">`count_invar&#39;</span> = <span class="fu">count</span>(&#39;invar&#39;), <span class="kw">by</span>(&#39;byvar&#39;) </span>
<span id="cb337-6"><a href="#cb337-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">gen</span> <span class="ot">`outvar&#39;</span> = (<span class="ot">`tot_invar&#39;</span> - <span class="ot">`invar&#39;</span>) <span class="co">///</span></span>
<span id="cb337-7"><a href="#cb337-7" aria-hidden="true" tabindex="-1"></a>    / (<span class="ot">`count_invar&#39;</span> - 1) </span>
<span id="cb337-8"><a href="#cb337-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> </span></code></pre></div>
<p>Con el programa podemos escribir los bloques de código anteriores como:</p>
<div class="sourceCode" id="cb338"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb338-1"><a href="#cb338-1" aria-hidden="true" tabindex="-1"></a>* Caso 1 </span>
<span id="cb338-2"><a href="#cb338-2" aria-hidden="true" tabindex="-1"></a>consumo_papitas_resto, invar(pc_papitas) <span class="co">///</span></span>
<span id="cb338-3"><a href="#cb338-3" aria-hidden="true" tabindex="-1"></a>outvar(consumo_papitas_resto_pc) byvar(region)</span>
<span id="cb338-4"><a href="#cb338-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb338-5"><a href="#cb338-5" aria-hidden="true" tabindex="-1"></a>* Caso 2</span>
<span id="cb338-6"><a href="#cb338-6" aria-hidden="true" tabindex="-1"></a>consumo_papitas_resto, invar(pc_papitas)  <span class="co">///</span></span>
<span id="cb338-7"><a href="#cb338-7" aria-hidden="true" tabindex="-1"></a>outvar(consumo_papitas_restometro_pc) byvar(metroarea)</span></code></pre></div>
<p>Hemos escrito la función de forma totalmente general. Podemos cambiar el nivel de agregación sin inducir errores.</p>
<p>Estructura de un programa en Stata: La sintaxis más simple es:</p>
<div class="sourceCode" id="cb339"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb339-1"><a href="#cb339-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">program</span> nombredelprograma</span>
<span id="cb339-2"><a href="#cb339-2" aria-hidden="true" tabindex="-1"></a>        <span class="kw">display</span> <span class="st">&quot;Lo que va a hacer el programa&quot;</span></span>
<span id="cb339-3"><a href="#cb339-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span> </span></code></pre></div>
<p>Cuando se ha definido un programa con <code>program</code>, este se vuelve indistinguible de cualquier otro comando de Stata. Es importante estar seguros(as) de que no estoy escribiendo el mismo nombre que otro programa. Para garantizar lo anterior, es bueno utilizar el comando <code>which</code>.</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb340-1"><a href="#cb340-1" aria-hidden="true" tabindex="-1"></a>which tabmiss</span></code></pre></div>
<p>Guardar un programa en Stata</p>
<ul>
<li>Hay dos lugares en donde puedes guardar tus <code>ado-files</code>.</li>
<li>Cuando se ha definido un programa con <code>program</code>, este se vuelve indistinguible de cualquier otro comando de Stata.</li>
<li>En el directorio de trabajo del proyecto.</li>
<li>Se puede hacer una carpeta nueva en la sección de códigos que indique los programas.</li>
<li>Otra opción es guardarlo en el directorio <code>Personal</code> de Stata. Para entrar escriban <code>personal</code> en la consola.</li>
</ul>
<p>Nombrar un programa en Stata</p>
<ul>
<li>Es posible darle cualquier nombre a un programa mientras no sea un nombre que ya es utilizado por Stata.</li>
<li>Si por ejemplo, creas un programa llamado <code>summarize</code> Stata lo va a ignorar y utilizará su propio comando.</li>
</ul>
</div>
<div id="mis-primeros-programas-en-stata" class="section level3 hasAnchor" number="3.5.3">
<h3 class="hasAnchor"><span class="header-section-number">3.5.3</span> Mis primeros programas en Stata<a href="#mis-primeros-programas-en-stata" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="programa-1" class="section level4 hasAnchor" number="3.5.3.1">
<h4 class="hasAnchor"><span class="header-section-number">3.5.3.1</span> Programa 1<a href="#programa-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Vamos escribir nuestro primer programa:</p>
<div class="sourceCode" id="cb341"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb341-1"><a href="#cb341-1" aria-hidden="true" tabindex="-1"></a>  * Mi primer programa en Stata</span>
<span id="cb341-2"><a href="#cb341-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">program</span> minombrees </span>
<span id="cb341-3"><a href="#cb341-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">display</span> <span class="st">&quot;Hola, mi nombre es &quot;</span></span>
<span id="cb341-4"><a href="#cb341-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span> </span></code></pre></div>
<p>Noten que al ejecutarlo no se genera ningún resultado. Lo que hemos hecho es definir un comando llamado <code>minombrees</code> con una simple función. Esta es la idea principal de un programa. Ejecuten nuevamente el programa. Al hacer esto observaran que se genera un error. Esto es porque al igual que las variables, no es posible asignar dos nombres iguales a un programa. Para evitar esto, es importante utilizar <code>program drop minombrees</code> antes de cargar el comando nuevamente. Este es un buen momento para utilizar <code>capture</code>.</p>
</div>
<div id="programa-2" class="section level4 hasAnchor" number="3.5.3.2">
<h4 class="hasAnchor"><span class="header-section-number">3.5.3.2</span> Programa 2<a href="#programa-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Vamos escribir un programa que permita calcular un promedio. Vamos a escribir un comando que nos permita crear una nueva variable que contenga los valores promedio y que muestre el resultado en la pantalla. Esto sería igual que escribir:</p>
<div class="sourceCode" id="cb342"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb342-1"><a href="#cb342-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">sysuse</span> auto, <span class="kw">clear</span></span>
<span id="cb342-2"><a href="#cb342-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">egen</span> mimedia_mpg = <span class="kw">mean</span>(mpg)</span>
<span id="cb342-3"><a href="#cb342-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">tab</span> mean_mpg </span></code></pre></div>
<p>Podemos evitar la repetición de estos dos comandos armando un programa:</p>
<div class="sourceCode" id="cb343"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb343-1"><a href="#cb343-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> <span class="kw">drop</span> <span class="dt">_all</span> </span>
<span id="cb343-2"><a href="#cb343-2" aria-hidden="true" tabindex="-1"></a><span class="kw">capture</span> <span class="kw">program</span> <span class="kw">drop</span> mymean</span>
<span id="cb343-3"><a href="#cb343-3" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> mymean </span>
<span id="cb343-4"><a href="#cb343-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">egen</span> media_<span class="ot">`1&#39;</span> = <span class="kw">mean</span>(<span class="ot">`1&#39;</span>)</span>
<span id="cb343-5"><a href="#cb343-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">tab</span> media_<span class="ot">`1&#39;</span></span>
<span id="cb343-6"><a href="#cb343-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> </span>
<span id="cb343-7"><a href="#cb343-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb343-8"><a href="#cb343-8" aria-hidden="true" tabindex="-1"></a>* Aplicamos este programa </span>
<span id="cb343-9"><a href="#cb343-9" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto, <span class="kw">clear</span></span>
<span id="cb343-10"><a href="#cb343-10" aria-hidden="true" tabindex="-1"></a>mimedia mpg</span></code></pre></div>
<p>Noten que hemos utilizado `<code>1'</code>. Este nos indica cualquier variable que este en la primera posición. Si incluimos más de una variable. <strong>Solo va a considerar la primera variable</strong>.</p>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.5.1: </b></p>
<p>Preguntas</p>
<ol style="list-style-type: decimal">
<li>Escriba un programa que permita ver todas las etiquetas (<code>labels</code>) de una base de datos.</li>
<li>Aplique este programa a la base <code>auto.dta</code>.</li>
</ol>
</div>
</div>
<div id="programa-3" class="section level4 hasAnchor" number="3.5.3.3">
<h4 class="hasAnchor"><span class="header-section-number">3.5.3.3</span> Programa 3<a href="#programa-3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Vamos a reescribir el programa para permitir un número arbitrario de variables. La macro ‘0’ contiene toda la cadena, ‘1’ el primer elemento, ‘2’ el segundo, etc. Podemos hacer una iteración sobre todos los elementos sin saber cuántos hay utilizando la técnica de desplazamiento incremental que implementaremos con <code>macro_shift</code>.</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb344-1"><a href="#cb344-1" aria-hidden="true" tabindex="-1"></a><span class="kw">capture</span> <span class="kw">program</span> <span class="kw">drop</span> mimedia </span>
<span id="cb344-2"><a href="#cb344-2" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> <span class="kw">define</span> mimedia </span>
<span id="cb344-3"><a href="#cb344-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">while</span> <span class="st">&quot;`1&#39;&quot;</span>!=<span class="st">&quot;&quot;</span> { </span>
<span id="cb344-4"><a href="#cb344-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">egen</span> mean_<span class="ot">`1&#39;</span>=<span class="kw">mean</span>(<span class="ot">`1&#39;</span>) </span>
<span id="cb344-5"><a href="#cb344-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">tab</span> mean_<span class="ot">`1&#39;</span> </span>
<span id="cb344-6"><a href="#cb344-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">macro</span> <span class="kw">shift</span></span>
<span id="cb344-7"><a href="#cb344-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb344-8"><a href="#cb344-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb344-9"><a href="#cb344-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb344-10"><a href="#cb344-10" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto, <span class="kw">clear</span></span>
<span id="cb344-11"><a href="#cb344-11" aria-hidden="true" tabindex="-1"></a>mimedia price mpg rep78 </span></code></pre></div>
<p>El comando <code>macro shift</code> sirve como incremental. Termina cuando encuentra un vacio, lo que explica la presencia del <code>while</code>. Notar que <code>"</code>1’“` habla de la posición. Es una buena tecnica para garantizar que el iterador seguirá cuando este vacio.</p>
</div>
<div id="programa-4" class="section level4 hasAnchor" number="3.5.3.4">
<h4 class="hasAnchor"><span class="header-section-number">3.5.3.4</span> Programa 4<a href="#programa-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Modificamos un poco el programa para que despliegue los resultados en la consola de Stata. Adicionalmente, agregamos un <code>quietly</code>.</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb345-1"><a href="#cb345-1" aria-hidden="true" tabindex="-1"></a><span class="kw">capture</span> <span class="kw">program</span> <span class="kw">drop</span> mimedia </span>
<span id="cb345-2"><a href="#cb345-2" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> <span class="kw">define</span> mimedia </span>
<span id="cb345-3"><a href="#cb345-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">while</span> <span class="st">&quot;`1&#39;&quot;</span>!=<span class="st">&quot;&quot;</span> { </span>
<span id="cb345-4"><a href="#cb345-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">qui</span>: <span class="kw">egen</span> <span class="ot">`1&#39;</span>_mean = <span class="kw">mean</span>(<span class="ot">`1&#39;</span>) </span>
<span id="cb345-5"><a href="#cb345-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">display</span> <span class="st">&quot;Media de `1&#39; = &quot;</span> <span class="ot">`1&#39;</span>_mean </span>
<span id="cb345-6"><a href="#cb345-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">macro</span> <span class="kw">shift</span></span>
<span id="cb345-7"><a href="#cb345-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb345-8"><a href="#cb345-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb345-9"><a href="#cb345-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb345-10"><a href="#cb345-10" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto, <span class="kw">clear</span></span>
<span id="cb345-11"><a href="#cb345-11" aria-hidden="true" tabindex="-1"></a>mimedia price mpg rep78 </span></code></pre></div>
</div>
<div id="programa-5" class="section level4 hasAnchor" number="3.5.3.5">
<h4 class="hasAnchor"><span class="header-section-number">3.5.3.5</span> Programa 5<a href="#programa-5" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>El comando <code>macro shift</code> es útil, pero puede ser lento. Agregando variables locales usuales y un incremental es mucho mejor. Ojo con las dobles comillas.</p>
<div class="sourceCode" id="cb346"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb346-1"><a href="#cb346-1" aria-hidden="true" tabindex="-1"></a><span class="kw">capture</span> <span class="kw">program</span> <span class="kw">drop</span> mimedia </span>
<span id="cb346-2"><a href="#cb346-2" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> <span class="kw">define</span> mimedia </span>
<span id="cb346-3"><a href="#cb346-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span> i = 1</span>
<span id="cb346-4"><a href="#cb346-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">while</span> <span class="st">&quot;``i&#39;&#39;&quot;</span>~=<span class="st">&quot;&quot;</span> { </span>
<span id="cb346-5"><a href="#cb346-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">qui</span>: <span class="kw">egen</span> <span class="ot">``i&#39;</span>&#39;_mean = <span class="kw">mean</span>(<span class="ot">``i&#39;</span>&#39;) </span>
<span id="cb346-6"><a href="#cb346-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">display</span> <span class="st">&quot;Media de `i&#39; = &quot;</span> <span class="ot">``i&#39;</span>&#39;_mean </span>
<span id="cb346-7"><a href="#cb346-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">local</span> ++i</span>
<span id="cb346-8"><a href="#cb346-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb346-9"><a href="#cb346-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
</div>
</div>
<div id="programa-con-distintos-argumentos" class="section level3 hasAnchor" number="3.5.4">
<h3 class="hasAnchor"><span class="header-section-number">3.5.4</span> Programa con distintos argumentos<a href="#programa-con-distintos-argumentos" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>El programa de los ejemplos anteriores soporta un solo argumento. Ahora vamos a ver un programa que considere explícitamente que los argumentos de un programa pueden tomar roles distintos.</p>
<div class="sourceCode" id="cb347"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb347-1"><a href="#cb347-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> <span class="kw">drop</span> <span class="dt">_all</span> </span>
<span id="cb347-2"><a href="#cb347-2" aria-hidden="true" tabindex="-1"></a><span class="kw">capture</span> <span class="kw">program</span> <span class="kw">drop</span> show </span>
<span id="cb347-3"><a href="#cb347-3" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> <span class="kw">define</span> show</span>
<span id="cb347-4"><a href="#cb347-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">tempvar</span> <span class="kw">obs</span> </span>
<span id="cb347-5"><a href="#cb347-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">quietly</span> <span class="kw">gen</span> <span class="ot">`obs&#39;</span> = <span class="ot">`1&#39;</span> <span class="co">///</span></span>
<span id="cb347-6"><a href="#cb347-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> (ctycode == <span class="st">&quot;`2&#39;&quot;</span> &amp; <span class="fu">year</span> ==<span class="ot">`3&#39;</span>)</span>
<span id="cb347-7"><a href="#cb347-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">sort</span> <span class="ot">`obs&#39;</span></span>
<span id="cb347-8"><a href="#cb347-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="st">&quot;`1&#39; of country `2&#39; in `3&#39; is: &quot;</span> <span class="ot">`obs&#39;</span> </span>
<span id="cb347-9"><a href="#cb347-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p><code>tempvar</code> crea una variable temporal que existe mientras el programa se ejecuta pero que se elimina automáticamente una vez que el programa termina su ejecución. Es importante estar seguros(as) de que cualquier <em>string</em> están en comillas dobles.</p>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.5.2:</b></p>
<p>Preguntas</p>
<ol style="list-style-type: decimal">
<li>Escriba un programa que reporte la mediana de la diferencia entre dos variables.</li>
<li>Aplique este programa a la base <code>auto.dta</code>.</li>
</ol>
</div>
</div>
<div id="opción-syntax" class="section level3 hasAnchor" number="3.5.5">
<h3 class="hasAnchor"><span class="header-section-number">3.5.5</span> Opción Syntax<a href="#opción-syntax" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Renombrando argumentos:</p>
<ul>
<li>De momento hemos escrito los programas utilizando <code>'1', '2', '3'</code> con el fin de introducir el uso de programas en Stata.</li>
<li>Sin embargo, esta notación puede ser un poco confusa y provocar errores en la codificación. Podemos asignar nombres de mayor significado a los argumentos del programa.</li>
</ul>
<div class="sourceCode" id="cb348"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb348-1"><a href="#cb348-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> <span class="kw">drop</span> <span class="dt">_all</span> </span>
<span id="cb348-2"><a href="#cb348-2" aria-hidden="true" tabindex="-1"></a><span class="kw">capture</span> <span class="kw">program</span> <span class="kw">drop</span> show </span>
<span id="cb348-3"><a href="#cb348-3" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> <span class="kw">define</span> show</span>
<span id="cb348-4"><a href="#cb348-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">args</span> <span class="kw">var</span> cty yr</span>
<span id="cb348-5"><a href="#cb348-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">tempvar</span> <span class="kw">obs</span> </span>
<span id="cb348-6"><a href="#cb348-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">quietly</span> <span class="kw">gen</span> <span class="ot">`obs&#39;</span> = <span class="ot">`var&#39;</span> <span class="co">///</span></span>
<span id="cb348-7"><a href="#cb348-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> (ctycode == <span class="st">&quot;`cty&#39;&quot;</span> &amp; <span class="fu">year</span> ==<span class="ot">`yr&#39;</span>)</span>
<span id="cb348-8"><a href="#cb348-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">sort</span> <span class="ot">`obs&#39;</span></span>
<span id="cb348-9"><a href="#cb348-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="st">&quot;`1&#39; of country `2&#39; in `3&#39; is: &quot;</span> <span class="ot">`obs&#39;</span> </span>
<span id="cb348-10"><a href="#cb348-10" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p>El comando<code>args</code> asigna a las variables locales <code>var</code>, <code>cty</code>, <code>yr</code> los valores de <code>'1'</code>, <code>'2'</code>, <code>'3'</code>. Noten que si llaman al programa con cuatro argumentos <strong>no</strong> retorna un error. Un método mucho más robusto y mejor para llamar a los argumentos de un programa es utilizar <code>syntax</code>. En vez de referirnos a cada elemento de un programa por su posición, vamos a especificar la “gramática” del programa.</p>
<p>La sintaxis de Stata es:</p>
<div class="sourceCode" id="cb349"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb349-1"><a href="#cb349-1" aria-hidden="true" tabindex="-1"></a>[<span class="kw">by</span> <span class="kw">varlist</span>:] command [<span class="kw">varlist</span>] [=<span class="fu">exp</span>] [<span class="kw">in</span> <span class="kw">range</span>] [, options]</span></code></pre></div>
<p><code>varlist</code> denota la lista de variables, <code>command</code> el comando a ejecutar, <code>exp</code> denota una expresión algebraica, <code>range</code> denota un rango para las observaciones mientras que <code>,options</code> denota la lista de opciones propias de un comando. Utilizar <code>syntax</code> en un programa hace que Stata verifique si un programa satisface la sintaxis. En caso de que no la cumpla, arrojara un error.</p>
<p>Syntax
* El comando <code>syntax</code> almacena en macros locales todos los elementos típicos de un comando en Stata.
* Por ejemplo, <code>syntax</code> también puede definir condicionales como <code>if</code> o <code>in</code>.</p>
<div class="sourceCode" id="cb350"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb350-1"><a href="#cb350-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">program</span> ... </span>
<span id="cb350-2"><a href="#cb350-2" aria-hidden="true" tabindex="-1"></a>        <span class="kw">syntax</span> <span class="kw">varlist</span>(<span class="fu">min</span> = 2) [<span class="kw">if</span>] [<span class="kw">in</span>]</span></code></pre></div>
<p>Si quieren hacer programas más complejos, con otras características es importante revisar <a href="https://www.stata.com/manuals/psyntax.pdf#psyntax">syntax</a>.</p>
<p>Uno de los primeros elementos de <code>syntax</code> es <code>varlist</code>. Es posible indicar el mínimo o máximo de variables.
* Por ejemplo: <code>varlist(min = 2 max = 2)</code>.
* Si tienes solo una variable puedes utilizar <code>varname</code>.
* Es equivalente a <code>varlist(min = 1 max = 1)</code>.
* La macro que guarda las variables siempre se llama <code>varlist</code>.</p>
<p>Ejemplo 1: programa para calcular percentiles</p>
<div class="sourceCode" id="cb351"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb351-1"><a href="#cb351-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> pctrange, rclass </span>
<span id="cb351-2"><a href="#cb351-2" aria-hidden="true" tabindex="-1"></a><span class="kw">version</span> 17 </span>
<span id="cb351-3"><a href="#cb351-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">syntax</span> <span class="kw">varlist</span>(<span class="fu">max</span> = 1 <span class="kw">numeric</span>)</span>
<span id="cb351-4"><a href="#cb351-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">quietly</span> <span class="kw">summarize</span> <span class="ot">`varlist&#39;</span>, <span class="kw">detail</span> </span>
<span id="cb351-5"><a href="#cb351-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="kw">range</span> = <span class="fu">r</span>(<span class="fu">max</span>) - <span class="fu">r</span>(<span class="fu">min</span>)</span>
<span id="cb351-6"><a href="#cb351-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> p7525 = <span class="fu">r</span>(p75) - <span class="fu">r</span>(p25)</span>
<span id="cb351-7"><a href="#cb351-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> p9010 = <span class="fu">r</span>(p90) - <span class="fu">r</span>(p10)</span>
<span id="cb351-8"><a href="#cb351-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> result <span class="dt">_n</span> <span class="st">&quot;Rangos de percentiles para `varlist&#39;&quot;</span></span>
<span id="cb351-9"><a href="#cb351-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">&quot;75-25 : &quot;</span> p7525</span>
<span id="cb351-10"><a href="#cb351-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">&quot;90-10:  &quot;</span> p9010 </span>
<span id="cb351-11"><a href="#cb351-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">&quot;Range: &quot;</span> <span class="kw">range</span></span>
<span id="cb351-12"><a href="#cb351-12" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> </span></code></pre></div>
<p>El programa anterior nos permite obtener los percentiles de alguna variable al mismo tiempo que los muestra en la consola. Noten que tambíen he incluido que tipo de comando es. En este caso es un comando <code>r-class</code>. <code>program</code> es quien determina el nombre del programa. <code>syntax</code> permite determinar los elementos de tu programa. En el ejemplo define el tipo y el límite de variables. También puede definir condicionales como <code>if</code> o <code>in</code>.</p>
<p>Los escalares definidos durante el programa se pueden utilizar. Esto no siempre es conveniente. Como recomendación es bueno <strong>guardar los programas como variables temporales</strong>.</p>
<p>Ejemplo 2: programa para calcular percentiles con variables locales</p>
<div class="sourceCode" id="cb352"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb352-1"><a href="#cb352-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> pctrange, rclass </span>
<span id="cb352-2"><a href="#cb352-2" aria-hidden="true" tabindex="-1"></a><span class="kw">version</span> 17 </span>
<span id="cb352-3"><a href="#cb352-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">syntax</span> <span class="kw">varlist</span>(<span class="fu">max</span> = 1 <span class="kw">numeric</span>)</span>
<span id="cb352-4"><a href="#cb352-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span> res <span class="st">&quot;range p7525 p9010&quot;</span></span>
<span id="cb352-5"><a href="#cb352-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">tempname</span> <span class="ot">`res&#39;</span>    </span>
<span id="cb352-6"><a href="#cb352-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> result <span class="dt">_n</span> <span class="st">&quot;Rangos de percentiles para `varlist&#39;&quot;</span></span>
<span id="cb352-7"><a href="#cb352-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">quietly</span> <span class="kw">summarize</span> <span class="ot">`varlist&#39;</span>, <span class="kw">detail</span> </span>
<span id="cb352-8"><a href="#cb352-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`range&#39;</span> = <span class="fu">r</span>(<span class="fu">max</span>) - <span class="fu">r</span>(<span class="fu">min</span>)</span>
<span id="cb352-9"><a href="#cb352-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`p7525&#39;</span> = <span class="fu">r</span>(p75) - <span class="fu">r</span>(p25)</span>
<span id="cb352-10"><a href="#cb352-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`p9010&#39;</span> = <span class="fu">r</span>(p90) - <span class="fu">r</span>(p10)</span>
<span id="cb352-11"><a href="#cb352-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">&quot;75-25 : &quot;</span> <span class="ot">`p7525&#39;</span></span>
<span id="cb352-12"><a href="#cb352-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">&quot;90-10:  &quot;</span> <span class="ot">`p9010&#39;</span></span>
<span id="cb352-13"><a href="#cb352-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">&quot;Range: &quot;</span> <span class="ot">`range&#39;</span></span></code></pre></div>
</div>
<div id="return" class="section level3 hasAnchor" number="3.5.6">
<h3 class="hasAnchor"><span class="header-section-number">3.5.6</span> Return<a href="#return" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Una característica importante de los comandos de Stata es su capacidad de reportar los resultados de forma tal de que los usuarios y usuarias podamos utilizarlos posteriormente.</li>
<li>El comando <code>return</code> nos permite guardar los escalares y hacerlos accesibles, sin tener el problema que vimos en el ejemplo anterior.<br />
</li>
<li>Notar que el lado izquierdo del escalar de retorno se refiere al nombre de la macro, el lado derecho debe hacer referencia a la macro una vez más para extraer el valor almacenado en ese nombre, por lo que debe utilizar dos comillas.</li>
</ul>
<p>Ejemplo 3: programa para calcular percentiles con return</p>
<div class="sourceCode" id="cb353"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb353-1"><a href="#cb353-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> pctrange, rclass </span>
<span id="cb353-2"><a href="#cb353-2" aria-hidden="true" tabindex="-1"></a><span class="kw">version</span> 17 </span>
<span id="cb353-3"><a href="#cb353-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">syntax</span> <span class="kw">varlist</span>(<span class="fu">max</span> = 1 <span class="kw">numeric</span>)</span>
<span id="cb353-4"><a href="#cb353-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span> res <span class="st">&quot;range p7525 p9010&quot;</span></span>
<span id="cb353-5"><a href="#cb353-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">tempname</span> <span class="ot">`res&#39;</span>    </span>
<span id="cb353-6"><a href="#cb353-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> result <span class="dt">_n</span> <span class="st">&quot;Rangos de percentiles para `varlist&#39;&quot;</span></span>
<span id="cb353-7"><a href="#cb353-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">quietly</span> <span class="kw">summarize</span> <span class="ot">`varlist&#39;</span>, <span class="kw">detail</span> </span>
<span id="cb353-8"><a href="#cb353-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`range&#39;</span> = <span class="fu">r</span>(<span class="fu">max</span>) - <span class="fu">r</span>(<span class="fu">min</span>)</span>
<span id="cb353-9"><a href="#cb353-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`p7525&#39;</span> = <span class="fu">r</span>(p75) - <span class="fu">r</span>(p25)</span>
<span id="cb353-10"><a href="#cb353-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`p9010&#39;</span> = <span class="fu">r</span>(p90) - <span class="fu">r</span>(p10)</span>
<span id="cb353-11"><a href="#cb353-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">&quot;75-25 : &quot;</span> <span class="ot">`p7525&#39;</span></span>
<span id="cb353-12"><a href="#cb353-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">&quot;90-10:  &quot;</span> <span class="ot">`p9010 &#39;</span></span>
<span id="cb353-13"><a href="#cb353-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">&quot;Range: &quot;</span> <span class="ot">`range&#39;</span></span>
<span id="cb353-14"><a href="#cb353-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="fu">r</span> <span class="kw">of</span> <span class="kw">local</span> res {</span>
<span id="cb353-15"><a href="#cb353-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span> <span class="fu">scalar</span> <span class="ot">`r&#39;</span> = <span class="ot">``r&#39;</span>&#39;</span>
<span id="cb353-16"><a href="#cb353-16" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb353-17"><a href="#cb353-17" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> </span></code></pre></div>
</div>
<div id="implementar-opciones-al-programa" class="section level3 hasAnchor" number="3.5.7">
<h3 class="hasAnchor"><span class="header-section-number">3.5.7</span> Implementar opciones al programa<a href="#implementar-opciones-al-programa" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Podemos agregar distintas opciones al programa. Una opción es agregar como opcional que el programa de un resultado en la consola. Al incluir <span class="math inline">\([ ]\)</span> en <code>syntax</code> significa un componente <strong>opcional</strong> en el comando.</p>
<p>Ejemplo 4: implementar opciones al programa (imprimir por defecto)</p>
<div class="sourceCode" id="cb354"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb354-1"><a href="#cb354-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> pctrange, rclass </span>
<span id="cb354-2"><a href="#cb354-2" aria-hidden="true" tabindex="-1"></a><span class="kw">version</span> 17 </span>
<span id="cb354-3"><a href="#cb354-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">syntax</span> <span class="kw">varlist</span>(<span class="fu">max</span> = 1 <span class="kw">numeric</span>) [, PRINT]</span>
<span id="cb354-4"><a href="#cb354-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span> res <span class="st">&quot;range p7525 p9010&quot;</span></span>
<span id="cb354-5"><a href="#cb354-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">tempname</span> <span class="ot">`res&#39;</span>    </span>
<span id="cb354-6"><a href="#cb354-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> result <span class="dt">_n</span> <span class="st">&quot;Rangos de percentiles para `varlist&#39;&quot;</span></span>
<span id="cb354-7"><a href="#cb354-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">quietly</span> <span class="kw">summarize</span> <span class="ot">`varlist&#39;</span>, <span class="kw">detail</span> </span>
<span id="cb354-8"><a href="#cb354-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`range&#39;</span> = <span class="fu">r</span>(<span class="fu">max</span>) - <span class="fu">r</span>(<span class="fu">min</span>)</span>
<span id="cb354-9"><a href="#cb354-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`p7525&#39;</span> = <span class="fu">r</span>(p75) - <span class="fu">r</span>(p25)</span>
<span id="cb354-10"><a href="#cb354-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`p9010&#39;</span> = <span class="fu">r</span>(p90) - <span class="fu">r</span>(p10)</span>
<span id="cb354-11"><a href="#cb354-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="st">&quot;`print&#39;&quot;</span> == <span class="st">&quot;print&quot;</span> {</span>
<span id="cb354-12"><a href="#cb354-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">&quot;75-25 : &quot;</span> <span class="ot">`p7525&#39;</span></span>
<span id="cb354-13"><a href="#cb354-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">&quot;90-10:  &quot;</span> <span class="ot">`p9010 &#39;</span></span>
<span id="cb354-14"><a href="#cb354-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">&quot;Range: &quot;</span> <span class="ot">`range&#39;</span></span>
<span id="cb354-15"><a href="#cb354-15" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb354-16"><a href="#cb354-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="fu">r</span> <span class="kw">of</span> <span class="kw">local</span> res {</span>
<span id="cb354-17"><a href="#cb354-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span> <span class="fu">scalar</span> <span class="ot">`r&#39;</span> = <span class="ot">``r&#39;</span>&#39;</span>
<span id="cb354-18"><a href="#cb354-18" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb354-19"><a href="#cb354-19" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> </span></code></pre></div>
<p>Ejemplo 5: implementar opciones al programa (no imprimir por defecto)</p>
<div class="sourceCode" id="cb355"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb355-1"><a href="#cb355-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> pctrange, rclass </span>
<span id="cb355-2"><a href="#cb355-2" aria-hidden="true" tabindex="-1"></a><span class="kw">version</span> 17 </span>
<span id="cb355-3"><a href="#cb355-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">syntax</span> <span class="kw">varlist</span>(<span class="fu">max</span> = 1 <span class="kw">numeric</span>) [, noPRINT]</span>
<span id="cb355-4"><a href="#cb355-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span> res <span class="st">&quot;range p7525 p9010&quot;</span></span>
<span id="cb355-5"><a href="#cb355-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">tempname</span> <span class="ot">`res&#39;</span>    </span>
<span id="cb355-6"><a href="#cb355-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> result <span class="dt">_n</span> <span class="st">&quot;Rangos de percentiles para `varlist&#39;&quot;</span></span>
<span id="cb355-7"><a href="#cb355-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">quietly</span> <span class="kw">summarize</span> <span class="ot">`varlist&#39;</span>, <span class="kw">detail</span> </span>
<span id="cb355-8"><a href="#cb355-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`range&#39;</span> = <span class="fu">r</span>(<span class="fu">max</span>) - <span class="fu">r</span>(<span class="fu">min</span>)</span>
<span id="cb355-9"><a href="#cb355-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`p7525&#39;</span> = <span class="fu">r</span>(p75) - <span class="fu">r</span>(p25)</span>
<span id="cb355-10"><a href="#cb355-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`p9010&#39;</span> = <span class="fu">r</span>(p90) - <span class="fu">r</span>(p10)</span>
<span id="cb355-11"><a href="#cb355-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="st">&quot;`print&#39;&quot;</span> != <span class="st">&quot;noprint&quot;</span> {</span>
<span id="cb355-12"><a href="#cb355-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">&quot;75-25 : &quot;</span> <span class="ot">`p7525&#39;</span></span>
<span id="cb355-13"><a href="#cb355-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">&quot;90-10:  &quot;</span> <span class="ot">`p9010 &#39;</span></span>
<span id="cb355-14"><a href="#cb355-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">&quot;Range: &quot;</span> <span class="ot">`range&#39;</span></span>
<span id="cb355-15"><a href="#cb355-15" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb355-16"><a href="#cb355-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="fu">r</span> <span class="kw">of</span> <span class="kw">local</span> res {</span>
<span id="cb355-17"><a href="#cb355-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span> <span class="fu">scalar</span> <span class="ot">`r&#39;</span> = <span class="ot">``r&#39;</span>&#39;</span>
<span id="cb355-18"><a href="#cb355-18" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb355-19"><a href="#cb355-19" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> </span></code></pre></div>
</div>
<div id="incluir-ifin-al-programa" class="section level3 hasAnchor" number="3.5.8">
<h3 class="hasAnchor"><span class="header-section-number">3.5.8</span> Incluir if/in al programa<a href="#incluir-ifin-al-programa" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Incluir un subconjunto de observaciones</p>
<ul>
<li>Cualquier comando debiese incluir <code>if</code> o <code>in range</code>.</li>
<li>Nuevamente, estas opciones son manejadas dentro del comando <code>syntax</code>. Para incluir estas opciones hay que agregar <code>[if]</code> y <code>[in]</code>.</li>
<li>Con estos comandos puedo ejecutar el programa para sub-muestras. Es importante asegurar que la sub-muestra no es vacía. Para ello es importante calcular <code>r(N)</code>, chequear que sea distinto de cero y agregar un título que lo indique.</li>
<li>El comando <code>marksample touse</code> utiliza la información provista por <code>if</code> o <code>in</code> en caso de que estos sean indicados en el programa. Este comando genera una variable local <code>touse</code> que es igual a 1 si las variables entran en el calculo que hace el programa y 0 en caso contrario.</li>
<li>Utilizaremos <code>'touse'</code> para calcular el número de observaciones que se utilizan después de aplicar los condicionales. Es necesario agregar <code>'touse'</code> en cada parte del programa que trabaje con la variable de <em>input</em>.</li>
</ul>
<p>Ejemplo 6: Incluir un subconjunto de observaciones</p>
<div class="sourceCode" id="cb356"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb356-1"><a href="#cb356-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> pctrange, rclass </span>
<span id="cb356-2"><a href="#cb356-2" aria-hidden="true" tabindex="-1"></a><span class="kw">version</span> 17 </span>
<span id="cb356-3"><a href="#cb356-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">syntax</span> <span class="kw">varlist</span>(<span class="fu">max</span> = 1 <span class="kw">numeric</span>) [, noPRINT]</span>
<span id="cb356-4"><a href="#cb356-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span> res <span class="st">&quot;range p7525 p9010&quot;</span></span>
<span id="cb356-5"><a href="#cb356-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">tempname</span> <span class="ot">`res&#39;</span>    </span>
<span id="cb356-6"><a href="#cb356-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> result <span class="dt">_n</span> <span class="st">&quot;Rangos de percentiles para `varlist&#39;&quot;</span></span>
<span id="cb356-7"><a href="#cb356-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">quietly</span> <span class="kw">summarize</span> <span class="ot">`varlist&#39;</span>, <span class="kw">detail</span> </span>
<span id="cb356-8"><a href="#cb356-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`range&#39;</span> = <span class="fu">r</span>(<span class="fu">max</span>) - <span class="fu">r</span>(<span class="fu">min</span>)</span>
<span id="cb356-9"><a href="#cb356-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`p7525&#39;</span> = <span class="fu">r</span>(p75) - <span class="fu">r</span>(p25)</span>
<span id="cb356-10"><a href="#cb356-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`p9010&#39;</span> = <span class="fu">r</span>(p90) - <span class="fu">r</span>(p10)</span>
<span id="cb356-11"><a href="#cb356-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="st">&quot;`print&#39;&quot;</span> != <span class="st">&quot;noprint&quot;</span> {</span>
<span id="cb356-12"><a href="#cb356-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">&quot;75-25 : &quot;</span> <span class="ot">`p7525&#39;</span></span>
<span id="cb356-13"><a href="#cb356-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">&quot;90-10:  &quot;</span> <span class="ot">`p9010 &#39;</span></span>
<span id="cb356-14"><a href="#cb356-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">&quot;Range: &quot;</span> <span class="ot">`range&#39;</span></span>
<span id="cb356-15"><a href="#cb356-15" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb356-16"><a href="#cb356-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="fu">r</span> <span class="kw">of</span> <span class="kw">local</span> res {</span>
<span id="cb356-17"><a href="#cb356-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span> <span class="fu">scalar</span> <span class="ot">`r&#39;</span> = <span class="ot">``r&#39;</span>&#39;</span>
<span id="cb356-18"><a href="#cb356-18" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb356-19"><a href="#cb356-19" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> </span></code></pre></div>
</div>
<div id="generalizar-el-comando-para-incluir-múltiples-variables" class="section level3 hasAnchor" number="3.5.9">
<h3 class="hasAnchor"><span class="header-section-number">3.5.9</span> Generalizar el comando para incluir múltiples variables<a href="#generalizar-el-comando-para-incluir-múltiples-variables" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Algunas consideraciones</p>
<ul>
<li>Si quiero ejecutar el programa sobre múltiples variables, es necesario ajustar un poco el programa.</li>
<li>Tengo que indicarle a <code>syntax</code> que hay más de una variable. Además, tengo que indicarle al programa que en caso de que existan más variables muestre los resultados en una tabla.</li>
<li>Guardaremos los resultados en matrices (no escalares) y vamos a aplicar una <strong>función de macro extendida</strong> con el fin de contar el número de filas que esta matriz debiese tener.</li>
<li>Agregaremos también una la opción para cambiar el formato y la opción <code>mat</code> que permite a la matriz ser guardada automáticamente con el nombre indicado.</li>
</ul>
<p>Ejemplo 7</p>
<div class="sourceCode" id="cb357"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb357-1"><a href="#cb357-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> <span class="kw">drop</span> <span class="dt">_all</span> </span>
<span id="cb357-2"><a href="#cb357-2" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> pctrange, rclass</span>
<span id="cb357-3"><a href="#cb357-3" aria-hidden="true" tabindex="-1"></a><span class="kw">version</span> 17 </span>
<span id="cb357-4"><a href="#cb357-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">syntax</span> <span class="kw">varlist</span>(<span class="fu">min</span> = 1 <span class="kw">numeric</span> ts) [<span class="kw">if</span>] [<span class="kw">in</span>] [, noPRINT FORmat(passthru) MATrix(<span class="fu">string</span>)] </span>
<span id="cb357-5"><a href="#cb357-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">marksample</span> touse </span>
<span id="cb357-6"><a href="#cb357-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">quietly</span> <span class="fu">count</span> <span class="kw">if</span> <span class="ot">`touse&#39;</span></span>
<span id="cb357-7"><a href="#cb357-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="ot">`r(N)&#39;</span> == 0 {</span>
<span id="cb357-8"><a href="#cb357-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">error</span> 2000</span>
<span id="cb357-9"><a href="#cb357-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb357-10"><a href="#cb357-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span> nvar: <span class="fu">word</span> <span class="fu">count</span> <span class="ot">`varlist&#39;</span></span>
<span id="cb357-11"><a href="#cb357-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="ot">`nvar&#39;</span> == 1 {</span>
<span id="cb357-12"><a href="#cb357-12" aria-hidden="true" tabindex="-1"></a>        <span class="kw">local</span> res <span class="kw">range</span> p7525 p9010</span>
<span id="cb357-13"><a href="#cb357-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">tempname</span> <span class="ot">`res&#39;</span>    </span>
<span id="cb357-14"><a href="#cb357-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb357-15"><a href="#cb357-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">quietly</span> <span class="kw">summarize</span> <span class="ot">`varlist&#39;</span> <span class="kw">if</span> <span class="ot">`touse&#39;</span>, <span class="kw">detail</span> </span>
<span id="cb357-16"><a href="#cb357-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scalar</span> <span class="ot">`range&#39;</span> = <span class="fu">r</span>(<span class="fu">max</span>) - <span class="fu">r</span>(<span class="fu">min</span>)</span>
<span id="cb357-17"><a href="#cb357-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scalar</span> <span class="ot">`p7525&#39;</span> = <span class="fu">r</span>(p75) - <span class="fu">r</span>(p25)</span>
<span id="cb357-18"><a href="#cb357-18" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scalar</span> <span class="ot">`p9010&#39;</span> = <span class="fu">r</span>(p90) - <span class="fu">r</span>(p10)</span>
<span id="cb357-19"><a href="#cb357-19" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="st">&quot;`print&#39;&quot;</span> != <span class="st">&quot;noprint&quot;</span> {</span>
<span id="cb357-20"><a href="#cb357-20" aria-hidden="true" tabindex="-1"></a>            <span class="kw">display</span> <span class="kw">as</span> result <span class="dt">_n</span> <span class="st">&quot;Rangos de percentiles para `varlist&#39;, N = `r(N)&#39;&quot;</span></span>
<span id="cb357-21"><a href="#cb357-21" aria-hidden="true" tabindex="-1"></a>            <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">&quot;75-25 : &quot;</span> <span class="ot">`p7525&#39;</span></span>
<span id="cb357-22"><a href="#cb357-22" aria-hidden="true" tabindex="-1"></a>            <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">&quot;90-10:  &quot;</span> <span class="ot">`p9010 &#39;</span></span>
<span id="cb357-23"><a href="#cb357-23" aria-hidden="true" tabindex="-1"></a>            <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">&quot;Range: &quot;</span> <span class="ot">`range&#39;</span></span>
<span id="cb357-24"><a href="#cb357-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb357-25"><a href="#cb357-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb357-26"><a href="#cb357-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="fu">r</span> <span class="kw">of</span> <span class="kw">local</span> res {</span>
<span id="cb357-27"><a href="#cb357-27" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span> <span class="fu">scalar</span> <span class="ot">`r&#39;</span> = <span class="ot">``r&#39;</span>&#39;</span>
<span id="cb357-28"><a href="#cb357-28" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb357-29"><a href="#cb357-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span> <span class="fu">scalar</span> <span class="kw">N</span> = <span class="fu">r</span>(<span class="kw">N</span>)</span>
<span id="cb357-30"><a href="#cb357-30" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb357-31"><a href="#cb357-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">else</span> {</span>
<span id="cb357-32"><a href="#cb357-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">tempname</span> rmat </span>
<span id="cb357-33"><a href="#cb357-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">matrix</span> <span class="ot">`rmat&#39;</span> = <span class="fu">J</span>(<span class="ot">`nvar&#39;</span>, 3, .)</span>
<span id="cb357-34"><a href="#cb357-34" aria-hidden="true" tabindex="-1"></a>      <span class="kw">local</span> i 0 </span>
<span id="cb357-35"><a href="#cb357-35" aria-hidden="true" tabindex="-1"></a>        <span class="kw">foreach</span> v <span class="kw">of</span> <span class="kw">varlist</span> <span class="ot">`varlist&#39;</span>{</span>
<span id="cb357-36"><a href="#cb357-36" aria-hidden="true" tabindex="-1"></a>        <span class="kw">local</span> ++i </span>
<span id="cb357-37"><a href="#cb357-37" aria-hidden="true" tabindex="-1"></a>        <span class="kw">quietly</span> <span class="kw">summarize</span> <span class="ot">`v&#39;</span> <span class="kw">if</span> <span class="ot">`touse&#39;</span>, <span class="kw">detail</span> </span>
<span id="cb357-38"><a href="#cb357-38" aria-hidden="true" tabindex="-1"></a>        <span class="fu">matrix</span> <span class="ot">`rmat&#39;</span>[<span class="ot">`i&#39;</span> ,1] = <span class="fu">r</span>(<span class="fu">max</span>) - <span class="fu">r</span>(<span class="fu">min</span>)</span>
<span id="cb357-39"><a href="#cb357-39" aria-hidden="true" tabindex="-1"></a>        <span class="fu">matrix</span> <span class="ot">`rmat&#39;</span>[<span class="ot">`i&#39;</span>, 2] = <span class="fu">r</span>(p75) - <span class="fu">r</span>(p25)</span>
<span id="cb357-40"><a href="#cb357-40" aria-hidden="true" tabindex="-1"></a>        <span class="fu">matrix</span> <span class="ot">`rmat&#39;</span>[<span class="ot">`i&#39;</span>, 3] = <span class="fu">r</span>(p90) - <span class="fu">r</span>(p10)</span>
<span id="cb357-41"><a href="#cb357-41" aria-hidden="true" tabindex="-1"></a>        <span class="kw">local</span> <span class="ot">rown</span> <span class="ot">`rown&#39;</span> <span class="ot">`v&#39;</span></span>
<span id="cb357-42"><a href="#cb357-42" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb357-43"><a href="#cb357-43" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb357-44"><a href="#cb357-44" aria-hidden="true" tabindex="-1"></a>      <span class="fu">matrix</span> <span class="ot">colnames</span> <span class="ot">`rmat&#39;</span> = Range P75-P25 P90-P10 </span>
<span id="cb357-45"><a href="#cb357-45" aria-hidden="true" tabindex="-1"></a>      <span class="fu">matrix</span> <span class="ot">rownames</span> <span class="ot">`rmat&#39;</span> = <span class="ot">`rown&#39;</span> </span>
<span id="cb357-46"><a href="#cb357-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb357-47"><a href="#cb357-47" aria-hidden="true" tabindex="-1"></a>      <span class="kw">if</span> <span class="st">&quot;`print&#39;&quot;</span> != <span class="st">&quot;noprint&quot;</span> {</span>
<span id="cb357-48"><a href="#cb357-48" aria-hidden="true" tabindex="-1"></a>          <span class="kw">local</span> form <span class="st">&quot;, noheader&quot;</span></span>
<span id="cb357-49"><a href="#cb357-49" aria-hidden="true" tabindex="-1"></a>          <span class="kw">if</span> <span class="st">&quot;`format&#39;&quot;</span> != <span class="st">&quot;&quot;</span> {</span>
<span id="cb357-50"><a href="#cb357-50" aria-hidden="true" tabindex="-1"></a>                <span class="kw">local</span> form <span class="st">&quot;`form&#39; `format&#39;&quot;</span> </span>
<span id="cb357-51"><a href="#cb357-51" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb357-52"><a href="#cb357-52" aria-hidden="true" tabindex="-1"></a>          <span class="fu">matrix</span> <span class="ot">list</span> <span class="ot">`rmat&#39;</span> <span class="ot">`form&#39;</span></span>
<span id="cb357-53"><a href="#cb357-53" aria-hidden="true" tabindex="-1"></a>                                }</span>
<span id="cb357-54"><a href="#cb357-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb357-55"><a href="#cb357-55" aria-hidden="true" tabindex="-1"></a>      <span class="kw">if</span> <span class="st">&quot;`matrix&#39;&quot;</span> != <span class="st">&quot;&quot;</span> {</span>
<span id="cb357-56"><a href="#cb357-56" aria-hidden="true" tabindex="-1"></a>            <span class="fu">matrix</span> <span class="ot">`matrix&#39;</span> = <span class="ot">`rmat&#39;</span></span>
<span id="cb357-57"><a href="#cb357-57" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb357-58"><a href="#cb357-58" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span> <span class="fu">matrix</span> rmat = <span class="ot">`rmat&#39;</span></span>
<span id="cb357-59"><a href="#cb357-59" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb357-60"><a href="#cb357-60" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span> <span class="kw">local</span> varname <span class="ot">`varlist&#39;</span></span>
<span id="cb357-61"><a href="#cb357-61" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> </span></code></pre></div>
</div>
<div id="agregar-prefijos-a-los-programas" class="section level3 hasAnchor" number="3.5.10">
<h3 class="hasAnchor"><span class="header-section-number">3.5.10</span> Agregar prefijos a los programas<a href="#agregar-prefijos-a-los-programas" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Prefijo by</p>
<ul>
<li>Ahora vamos a hacer que nuestro programa pueda utilizar el prefijo <code>by</code>.</li>
<li>Para agregar esta opción simplemente hay qyue modificar <code>program</code>.</li>
</ul>
<div class="sourceCode" id="cb358"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb358-1"><a href="#cb358-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> pctrange, rclass byable(recall)</span></code></pre></div>
<p>También podemos permitir que la lista de variables incluya <strong>operadores de series de tiempo</strong> (ej. <code>L.pib</code>, <code>D.ingreso</code>). Para incorporar estos elementos tenemos que modificar <code>syntax</code>.</p>
<div class="sourceCode" id="cb359"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb359-1"><a href="#cb359-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">syntax</span> <span class="kw">varlist</span>(<span class="fu">min</span> = 1 <span class="kw">numeric</span> ts) [<span class="kw">if</span>] [<span class="kw">in</span>] <span class="co">///</span></span>
<span id="cb359-2"><a href="#cb359-2" aria-hidden="true" tabindex="-1"></a>    [, noPRINT  FORmat(passthru) MATrix(<span class="fu">string</span>)]</span></code></pre></div>
</div>
<div id="programas-para-complementar-función-egen" class="section level3 hasAnchor" number="3.5.11">
<h3 class="hasAnchor"><span class="header-section-number">3.5.11</span> Programas para complementar función egen<a href="#programas-para-complementar-función-egen" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Es posible programar funciones adicionales de <code>egen</code>. El nombre de estos programas deben empezar con <code>_g</code>. Una diferencia importante entre este tipo de programas y los que ya hemos escrito guarda relación con el hecho de que hay que tener en cuenta la nueva variable que se va a crear. La sintaxis es la siguiente:</p>
<div class="sourceCode" id="cb360"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb360-1"><a href="#cb360-1" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> [<span class="dv">type</span>] newvarname = fcn(arguments) [<span class="kw">if</span>] [<span class="kw">in</span>] [, options]</span></code></pre></div>
<p>El cambio que haremos en la sintaxis del programa será que incluiremos un <code>touse</code> para hacer la nueva variable.</p>
<p>Ejemplo 8: programa función egen</p>
<div class="sourceCode" id="cb361"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb361-1"><a href="#cb361-1" aria-hidden="true" tabindex="-1"></a>* Programas <span class="kw">de</span> <span class="kw">egen</span> </span>
<span id="cb361-2"><a href="#cb361-2" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> <span class="kw">drop</span> <span class="dt">_all</span></span>
<span id="cb361-3"><a href="#cb361-3" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> _gpct9010</span>
<span id="cb361-4"><a href="#cb361-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">syntax</span> newvarname =/<span class="fu">exp</span> [<span class="kw">if</span>] [<span class="kw">in</span>] </span>
<span id="cb361-5"><a href="#cb361-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">tempvar</span> touse </span>
<span id="cb361-6"><a href="#cb361-6" aria-hidden="true" tabindex="-1"></a>    mark <span class="ot">`touse&#39;</span> <span class="ot">`if&#39;</span> <span class="ot">`in&#39;</span> </span>
<span id="cb361-7"><a href="#cb361-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">quietly</span> <span class="kw">summarize</span> <span class="ot">`exp&#39;</span> <span class="kw">if</span> <span class="ot">`touse&#39;</span>, <span class="kw">detail</span> </span>
<span id="cb361-8"><a href="#cb361-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">quietly</span> <span class="kw">generate</span> <span class="ot">`typlist&#39;</span> <span class="ot">`varlist&#39;</span> = <span class="fu">r</span>(p90) - <span class="fu">r</span>(p10) <span class="kw">if</span> <span class="ot">`touse&#39;</span></span>
<span id="cb361-9"><a href="#cb361-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb361-10"><a href="#cb361-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb361-11"><a href="#cb361-11" aria-hidden="true" tabindex="-1"></a>* Aplicación del programa</span>
<span id="cb361-12"><a href="#cb361-12" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto, <span class="kw">clear</span></span>
<span id="cb361-13"><a href="#cb361-13" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> rango9010 = pct9010(price)</span></code></pre></div>
<p>Programas con funciones de egen con prefijo by</p>
<ul>
<li>Agregamos <code>[, *]</code> que corresponde a las opciones. En <code>egen</code> el prefijo <code>by</code> es una opción.</li>
<li>Con el fin de permitirle al programa que pueda producir un rango de percentil separado para cada grupos utilizaremos <code>pctile</code> en vez de <code>summarize</code>.</li>
<li>El cambio que haremos en la sintaxis del programa será que incluiremos un <code>touse</code> para hacer la nueva variable.</li>
</ul>
<p>Ejemplo 9: programa función egen con prefijo by</p>
<div class="sourceCode" id="cb362"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb362-1"><a href="#cb362-1" aria-hidden="true" tabindex="-1"></a>* Programa con opción <span class="kw">by</span>. </span>
<span id="cb362-2"><a href="#cb362-2" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> <span class="kw">drop</span> <span class="dt">_all</span></span>
<span id="cb362-3"><a href="#cb362-3" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> _gpct9010</span>
<span id="cb362-4"><a href="#cb362-4" aria-hidden="true" tabindex="-1"></a><span class="kw">syntax</span> newvarname =/<span class="fu">exp</span> [<span class="kw">if</span>] [<span class="kw">in</span>] [, *] </span>
<span id="cb362-5"><a href="#cb362-5" aria-hidden="true" tabindex="-1"></a><span class="kw">tempvar</span> touse p90 p10 </span>
<span id="cb362-6"><a href="#cb362-6" aria-hidden="true" tabindex="-1"></a>mark <span class="ot">`touse&#39;</span> <span class="ot">`if&#39;</span> <span class="ot">`in&#39;</span> </span>
<span id="cb362-7"><a href="#cb362-7" aria-hidden="true" tabindex="-1"></a><span class="kw">quietly</span> {</span>
<span id="cb362-8"><a href="#cb362-8" aria-hidden="true" tabindex="-1"></a>          <span class="kw">egen</span> <span class="kw">double</span> <span class="ot">`p90&#39;</span> = <span class="kw">pctile</span>(<span class="ot">`exp&#39;</span>) <span class="kw">if</span> <span class="ot">`touse&#39;</span>, <span class="ot">`options&#39;</span> <span class="kw">p</span>(90) </span>
<span id="cb362-9"><a href="#cb362-9" aria-hidden="true" tabindex="-1"></a>          <span class="kw">egen</span> <span class="kw">double</span> <span class="ot">`p10&#39;</span> = <span class="kw">pctile</span>(<span class="ot">`exp&#39;</span>) <span class="kw">if</span> <span class="ot">`touse&#39;</span>, <span class="ot">`options&#39;</span> <span class="kw">p</span>(10)</span>
<span id="cb362-10"><a href="#cb362-10" aria-hidden="true" tabindex="-1"></a>          <span class="kw">generate</span> <span class="ot">`typlist&#39;</span> <span class="ot">`varlist&#39;</span> = <span class="ot">`p90&#39;</span> - <span class="ot">`p10&#39;</span> <span class="kw">if</span> <span class="ot">`touse&#39;</span> } </span>
<span id="cb362-11"><a href="#cb362-11" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb362-12"><a href="#cb362-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb362-13"><a href="#cb362-13" aria-hidden="true" tabindex="-1"></a>* Aplicación del programa</span>
<span id="cb362-14"><a href="#cb362-14" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto, <span class="kw">clear</span></span>
<span id="cb362-15"><a href="#cb362-15" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> rango9010 = pct9010(price)</span>
<span id="cb362-16"><a href="#cb362-16" aria-hidden="true" tabindex="-1"></a><span class="kw">bysort</span> rep78 foreign: <span class="kw">egen</span> rango9010_prefijoby = pct9010(price)</span></code></pre></div>
<p>Generalización de la función egen para soportar todos los pares de cuantiles</p>
<ul>
<li>Hemos desarrollado una función de <code>egen</code> que permite calcular un rango entre percentiles para una lista de variables especifica.</li>
<li>Puede ser util tomar ventaja de <code>egen pctile()</code> para poder calcular cualquier percentil de la lista de variables especificadas.</li>
<li>Vamos a agregar dos opciones a la función <code>egen</code> : <code>lo()</code> y <code>hi()</code>. En caso de que no especifiquemos, por defecto se calcula el rango interquartil. La función de <code>egen</code> ahora se llamará <code>_gpctrange.ado</code>.</li>
</ul>
<p>Ejemplo 10: función <code>egen</code> más general</p>
<div class="sourceCode" id="cb363"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb363-1"><a href="#cb363-1" aria-hidden="true" tabindex="-1"></a>* Programa con opción <span class="kw">by</span>. </span>
<span id="cb363-2"><a href="#cb363-2" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> <span class="kw">drop</span> <span class="dt">_all</span></span>
<span id="cb363-3"><a href="#cb363-3" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> _gpctrange</span>
<span id="cb363-4"><a href="#cb363-4" aria-hidden="true" tabindex="-1"></a><span class="kw">syntax</span> newvarname =/<span class="fu">exp</span> [<span class="kw">if</span>] [<span class="kw">in</span>] [, LO(integer 25) HI(integer 75) *] </span>
<span id="cb363-5"><a href="#cb363-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb363-6"><a href="#cb363-6" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="ot">`hi&#39;</span> &gt; 99 | <span class="ot">`lo&#39;</span> &lt; 1 {</span>
<span id="cb363-7"><a href="#cb363-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> <span class="kw">error</span> <span class="co">///</span></span>
<span id="cb363-8"><a href="#cb363-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Percentiles `lo&#39; `hi&#39; deben estar entre 1 y 99.&quot;</span> </span>
<span id="cb363-9"><a href="#cb363-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">error</span> 198 </span>
<span id="cb363-10"><a href="#cb363-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb363-11"><a href="#cb363-11" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="ot">`hi&#39;</span> &lt;= <span class="ot">`lo&#39;</span> {</span>
<span id="cb363-12"><a href="#cb363-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> <span class="kw">error</span> <span class="co">///</span></span>
<span id="cb363-13"><a href="#cb363-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Percentiles `lo&#39; `hi&#39; deben estar en orden ascendente&quot;</span></span>
<span id="cb363-14"><a href="#cb363-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">error</span> 198 </span>
<span id="cb363-15"><a href="#cb363-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb363-16"><a href="#cb363-16" aria-hidden="true" tabindex="-1"></a><span class="kw">tempvar</span> touse phi plo </span>
<span id="cb363-17"><a href="#cb363-17" aria-hidden="true" tabindex="-1"></a>mark <span class="ot">`touse&#39;</span> <span class="ot">`if&#39;</span> <span class="ot">`in&#39;</span> </span>
<span id="cb363-18"><a href="#cb363-18" aria-hidden="true" tabindex="-1"></a><span class="kw">quietly</span> {</span>
<span id="cb363-19"><a href="#cb363-19" aria-hidden="true" tabindex="-1"></a>          <span class="kw">egen</span> <span class="kw">double</span> <span class="ot">`phi&#39;</span> = <span class="kw">pctile</span>(<span class="ot">`exp&#39;</span>) <span class="kw">if</span> <span class="ot">`touse&#39;</span>, <span class="ot">`options&#39;</span> <span class="kw">p</span>(<span class="ot">`hi&#39;</span>) </span>
<span id="cb363-20"><a href="#cb363-20" aria-hidden="true" tabindex="-1"></a>          <span class="kw">egen</span> <span class="kw">double</span> <span class="ot">`plo&#39;</span> = <span class="kw">pctile</span>(<span class="ot">`exp&#39;</span>) <span class="kw">if</span> <span class="ot">`touse&#39;</span>, <span class="ot">`options&#39;</span> <span class="kw">p</span>(<span class="ot">`lo&#39;</span>)</span>
<span id="cb363-21"><a href="#cb363-21" aria-hidden="true" tabindex="-1"></a>          <span class="kw">generate</span> <span class="ot">`typlist&#39;</span> <span class="ot">`varlist&#39;</span> = <span class="ot">`phi&#39;</span> - <span class="ot">`plo&#39;</span> <span class="kw">if</span> <span class="ot">`touse&#39;</span> </span>
<span id="cb363-22"><a href="#cb363-22" aria-hidden="true" tabindex="-1"></a>          } </span>
<span id="cb363-23"><a href="#cb363-23" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb363-24"><a href="#cb363-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb363-25"><a href="#cb363-25" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto, <span class="kw">clear</span></span>
<span id="cb363-26"><a href="#cb363-26" aria-hidden="true" tabindex="-1"></a><span class="kw">bysort</span> rep78: <span class="kw">egen</span> <span class="fu">iqr</span> = pctrange(price) <span class="kw">if</span> <span class="fu">inrange</span>(rep78,3,5)</span>
<span id="cb363-27"><a href="#cb363-27" aria-hidden="true" tabindex="-1"></a><span class="kw">bysort</span> rep78: <span class="kw">egen</span> p8020 = pctrange(price) <span class="kw">if</span> <span class="fu">inrange</span>(rep78,3,5), hi(80) lo(20)</span>
<span id="cb363-28"><a href="#cb363-28" aria-hidden="true" tabindex="-1"></a><span class="kw">tabstat</span> <span class="fu">iqr</span> <span class="kw">if</span> <span class="fu">inrange</span>(rep78, 3, 5), <span class="kw">by</span>(rep78)</span>
<span id="cb363-29"><a href="#cb363-29" aria-hidden="true" tabindex="-1"></a><span class="kw">tabstat</span> p8020 <span class="kw">if</span> <span class="fu">inrange</span>(rep78, 3, 5), <span class="kw">by</span>(rep78)</span></code></pre></div>
</div>
</div>
<div id="programar-ado---files-parte-ii" class="section level2 hasAnchor" number="3.6">
<h2 class="hasAnchor"><span class="header-section-number">3.6</span> Programar ado - files (Parte II)<a href="#programar-ado---files-parte-ii" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="syntax" class="section level3 hasAnchor" number="3.6.1">
<h3 class="hasAnchor"><span class="header-section-number">3.6.1</span> Syntax<a href="#syntax" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Algunas consideraciones</p>
<ul>
<li>Como hemos visto hay dos formas en los que un programa de Stata puede interpretar lo que ingresamos.</li>
<li>Por posición tal como lo hace <code>args</code> o como lo hicimos con los números entre las comillas.<br />
</li>
<li>De acuerdo a la gramática del programa utilizando <code>syntax</code>.</li>
<li><code>syntax</code> guarda los componentes en macros locales particulares a las cuales podemos acceder posteriormente.</li>
<li>Por ejemplo <code>'if'</code> <code>'in'</code> <code>'varlist'</code> son macros locales a las que podemos acceder tal como vimos la clase pasada.</li>
<li>Ahora vamos a ver algunas opciones de <code>syntax</code> que nos permitirán tener más herramientas para escribir nuestros programas.</li>
<li>Al utilizar dentro de un programa paréntesis cuadrados estoy indicando que esas partes son opcionales.</li>
<li>Por ejemplo, estas dos versiones son equivalentes, salvo que en la segunda linea todo es opcional:</li>
</ul>
<div class="sourceCode" id="cb364"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb364-1"><a href="#cb364-1" aria-hidden="true" tabindex="-1"></a>    * Nada opcional</span>
<span id="cb364-2"><a href="#cb364-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">syntax</span> <span class="kw">varlist</span> <span class="kw">if</span> <span class="kw">in</span> <span class="bn">title</span>(<span class="fu">string</span>) <span class="kw">adjust</span>(<span class="fu">real</span> 1) </span>
<span id="cb364-3"><a href="#cb364-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb364-4"><a href="#cb364-4" aria-hidden="true" tabindex="-1"></a>    * Todo opcional</span>
<span id="cb364-5"><a href="#cb364-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">syntax</span> [<span class="kw">varlist</span>] [<span class="kw">if</span>] [, <span class="kw">adjust</span> (<span class="fu">real</span> 1) <span class="bn">title</span>(<span class="fu">string</span>)]</span></code></pre></div>
<p>Vamos a mirar las macros generadas por syntax:</p>
<div class="sourceCode" id="cb365"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb365-1"><a href="#cb365-1" aria-hidden="true" tabindex="-1"></a><span class="kw">capture</span> <span class="kw">program</span> <span class="kw">drop</span> myprog</span>
<span id="cb365-2"><a href="#cb365-2" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> myprog </span>
<span id="cb365-3"><a href="#cb365-3" aria-hidden="true" tabindex="-1"></a><span class="kw">syntax</span> <span class="kw">varlist</span> [<span class="kw">if</span>] [<span class="kw">in</span>] [, <span class="kw">adjust</span>(<span class="fu">real</span> 1) <span class="bn">title</span>(<span class="fu">string</span>)] </span>
<span id="cb365-4"><a href="#cb365-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="st">&quot;varlist contiene |`varlist&#39;|&quot;</span> </span>
<span id="cb365-5"><a href="#cb365-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="st">&quot;if contiene |`if&#39;|&quot;</span> </span>
<span id="cb365-6"><a href="#cb365-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="st">&quot;in contiene |`in&#39;|&quot;</span> </span>
<span id="cb365-7"><a href="#cb365-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="st">&quot;adjust contiene |`adjust&#39;|&quot;</span> </span>
<span id="cb365-8"><a href="#cb365-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="st">&quot;title contiene |`title&#39;|&quot;</span> </span>
<span id="cb365-9"><a href="#cb365-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p>Vamos a aplicar lo aprendido en un ejemplo sencillo:</p>
<div class="sourceCode" id="cb366"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb366-1"><a href="#cb366-1" aria-hidden="true" tabindex="-1"></a><span class="kw">capture</span> <span class="kw">program</span> <span class="kw">drop</span> miprograma</span>
<span id="cb366-2"><a href="#cb366-2" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> miprograma</span>
<span id="cb366-3"><a href="#cb366-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">syntax</span> <span class="kw">varlist</span> [<span class="kw">if</span>] [<span class="kw">in</span>] [, <span class="kw">adjust</span>(<span class="fu">real</span> 1) <span class="bn">title</span>(<span class="fu">string</span>)]</span>
<span id="cb366-4"><a href="#cb366-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> </span>
<span id="cb366-5"><a href="#cb366-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="st">&quot;`title&#39;&quot;</span> != <span class="st">&quot;&quot;</span> {</span>
<span id="cb366-6"><a href="#cb366-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">display</span> <span class="st">&quot;`title&#39;:&quot;</span></span>
<span id="cb366-7"><a href="#cb366-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb366-8"><a href="#cb366-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="kw">var</span> <span class="kw">of</span> <span class="kw">local</span> <span class="kw">varlist</span>{</span>
<span id="cb366-9"><a href="#cb366-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">quietly</span> <span class="kw">summarize</span> <span class="ot">`var&#39;</span> <span class="ot">`if&#39;</span> <span class="ot">`in&#39;</span></span>
<span id="cb366-10"><a href="#cb366-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">display</span> <span class="st">&quot;`var&#39;&quot;</span> <span class="st">&quot; &quot;</span>%9.0g <span class="fu">r</span>(<span class="kw">mean</span>)*<span class="ot">`adjust&#39;</span></span>
<span id="cb366-11"><a href="#cb366-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb366-12"><a href="#cb366-12" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p><code>marksample</code> y <code>touse</code>: Un error común es utilizar una muestra en una parte del programa y otra distinta en otra parte. La solución es crear una variable que contiene un 1 si la observación fue utilizada y un 0 en caso contrario.</p>
<div class="sourceCode" id="cb367"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb367-1"><a href="#cb367-1" aria-hidden="true" tabindex="-1"></a><span class="kw">capture</span> <span class="kw">program</span> <span class="kw">drop</span> miprograma</span>
<span id="cb367-2"><a href="#cb367-2" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> miprograma</span>
<span id="cb367-3"><a href="#cb367-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">syntax</span> <span class="kw">varlist</span> [<span class="kw">if</span>] [<span class="kw">in</span>] [, <span class="kw">adjust</span>(<span class="fu">real</span> 1) <span class="bn">title</span>(<span class="fu">string</span>)]</span>
<span id="cb367-4"><a href="#cb367-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">marksample</span> touse</span>
<span id="cb367-5"><a href="#cb367-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> </span>
<span id="cb367-6"><a href="#cb367-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="st">&quot;`title&#39;&quot;</span> != <span class="st">&quot;&quot;</span> {</span>
<span id="cb367-7"><a href="#cb367-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">display</span> <span class="st">&quot;`title&#39;:&quot;</span></span>
<span id="cb367-8"><a href="#cb367-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb367-9"><a href="#cb367-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="kw">var</span> <span class="kw">of</span> <span class="kw">local</span> <span class="kw">varlist</span>{</span>
<span id="cb367-10"><a href="#cb367-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">quietly</span> <span class="kw">summarize</span> <span class="ot">`var&#39;</span> <span class="ot">`if&#39;</span> <span class="ot">`touse&#39;</span></span>
<span id="cb367-11"><a href="#cb367-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">display</span> <span class="st">&quot;`var&#39;&quot;</span> <span class="st">&quot; &quot;</span> <span class="fu">r</span>(<span class="kw">mean</span>)*<span class="ot">`adjust&#39;</span></span>
<span id="cb367-12"><a href="#cb367-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb367-13"><a href="#cb367-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
</div>
<div id="varlist" class="section level3 hasAnchor" number="3.6.2">
<h3 class="hasAnchor"><span class="header-section-number">3.6.2</span> Varlist<a href="#varlist" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>varlist</code> específica la macro que contiene las variables que van a ingresar al programa como <em>inputs</em>. Las opciones de <code>varlist</code> son:
* <code>default = none</code>. Especifica como la <code>varlist</code> se va a llenar. Por defecto se llena con todas las variables.
* <code>min</code>, <code>max</code> especifica el número de variables permitidas.
* <code>numeric</code>, <code>string</code> especifican que criterio deben cumplir <strong>todas</strong> las variables que ingresas al programa.
* <code>ts</code> permite que la <code>varlist</code> contenga operadores de series de tiempo.
* <code>fv</code> permite que la <code>varlist</code> contenga variables categóricas.</p>
</div>
<div id="opciones" class="section level3 hasAnchor" number="3.6.3">
<h3 class="hasAnchor"><span class="header-section-number">3.6.3</span> Opciones<a href="#opciones" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Las opciones permiten hacer requeridos o opcionales. Por ejemplo, <code>regress, noconstant</code>. Las opciones pueden ser una <code>numlist</code>, una <code>varlist</code> (ej. <code>by(varlist) option</code>, una <code>namelist</code> tal como el nombre de una matriz o de una nueva variable. Como regla general, cualquier característica que pudieran encontrar en un comando de Stata, la pueden agregar en un programa. Para las opciones es importante recordar que las mayúsculas indican la menor abreviación posible.</p>
<ul>
<li><code>replace</code>, <code>detail</code>, <code>constant</code> son opciones de <strong>on</strong>.</li>
<li><code>noreplace</code>, <code>nodetail</code>, <code>noconstant</code> son opciones de <strong>off</strong>. Ojo las macros que retornan tienen los mismos nombres que en el caso anterior.</li>
<li><code>title</code> y <code>adjust</code> también son otros opcionales. El primero permite ingresar un título al comando mientras que el segundo permite ajustar los resultados por algún escalar.</li>
<li>Hay muchas otras. Veamos un ejemplo…</li>
</ul>
<div class="sourceCode" id="cb368"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb368-1"><a href="#cb368-1" aria-hidden="true" tabindex="-1"></a><span class="kw">capture</span> <span class="kw">program</span> <span class="kw">drop</span> miprograma</span>
<span id="cb368-2"><a href="#cb368-2" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> miprograma</span>
<span id="cb368-3"><a href="#cb368-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">syntax</span> <span class="kw">varlist</span> [<span class="kw">if</span>] [<span class="kw">in</span>] [, <span class="kw">adjust</span>(<span class="fu">real</span> 1) <span class="bn">title</span>(<span class="fu">string</span>)]</span>
<span id="cb368-4"><a href="#cb368-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> </span>
<span id="cb368-5"><a href="#cb368-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="st">&quot;`title&#39;&quot;</span> != <span class="st">&quot;&quot;</span> {</span>
<span id="cb368-6"><a href="#cb368-6" aria-hidden="true" tabindex="-1"></a>        displa <span class="st">&quot;`title&#39;:&quot;</span></span>
<span id="cb368-7"><a href="#cb368-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb368-8"><a href="#cb368-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="kw">var</span> <span class="kw">of</span> <span class="kw">local</span> <span class="kw">varlist</span>{</span>
<span id="cb368-9"><a href="#cb368-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">quietly</span> <span class="kw">summarize</span> <span class="ot">`var&#39;</span> <span class="ot">`if&#39;</span> <span class="ot">`in&#39;</span></span>
<span id="cb368-10"><a href="#cb368-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">display</span> <span class="st">&quot;`var&#39;&quot;</span> <span class="st">&quot; &quot;</span>%9.0g <span class="fu">r</span>(<span class="kw">mean</span>)*<span class="ot">`adjust&#39;</span></span>
<span id="cb368-11"><a href="#cb368-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb368-12"><a href="#cb368-12" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
</div>
<div id="programa-para-calcular-percentiles" class="section level3 hasAnchor" number="3.6.4">
<h3 class="hasAnchor"><span class="header-section-number">3.6.4</span> Programa para calcular percentiles<a href="#programa-para-calcular-percentiles" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Una versión simple para una variable:</p>
<div class="sourceCode" id="cb369"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb369-1"><a href="#cb369-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> pctrange, rclass </span>
<span id="cb369-2"><a href="#cb369-2" aria-hidden="true" tabindex="-1"></a><span class="kw">version</span> 17 </span>
<span id="cb369-3"><a href="#cb369-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">syntax</span> <span class="kw">varlist</span>(<span class="fu">max</span> = 1 <span class="kw">numeric</span>)</span>
<span id="cb369-4"><a href="#cb369-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">quietly</span> <span class="kw">summarize</span> <span class="ot">`varlist&#39;</span>, <span class="kw">detail</span> </span>
<span id="cb369-5"><a href="#cb369-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="kw">range</span> = <span class="fu">r</span>(<span class="fu">max</span>) - <span class="fu">r</span>(<span class="fu">min</span>)</span>
<span id="cb369-6"><a href="#cb369-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> p7525 = <span class="fu">r</span>(p75) - <span class="fu">r</span>(p25)</span>
<span id="cb369-7"><a href="#cb369-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> p9010 = <span class="fu">r</span>(p90) - <span class="fu">r</span>(p10)</span>
<span id="cb369-8"><a href="#cb369-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> result <span class="dt">_n</span> <span class="st">&quot;Rangos de percentiles para `varlist&#39;&quot;</span></span>
<span id="cb369-9"><a href="#cb369-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">&quot;75-25 : &quot;</span> p7525</span>
<span id="cb369-10"><a href="#cb369-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">&quot;90-10:  &quot;</span> p9010 </span>
<span id="cb369-11"><a href="#cb369-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">&quot;Range: &quot;</span> <span class="kw">range</span></span>
<span id="cb369-12"><a href="#cb369-12" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> </span></code></pre></div>
<p>Algunas consideraciones</p>
<ul>
<li>El programa anterior nos permite obtener los percentiles de alguna variable al mismo tiempo que los muestra en la consola.</li>
<li>Noten que también he incluido que tipo de comando es. En este caso es un comando <code>r-class</code>.</li>
<li>Los escalares definidos en el programa se pueden utilizar. Esto no siempre es conveniente.</li>
<li>Como recomendación es bueno <strong>guardar los resultados esperados de los programas como variables temporales</strong>.</li>
</ul>
<p>Versión que incluye variables guardadas localmente:</p>
<div class="sourceCode" id="cb370"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb370-1"><a href="#cb370-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> pctrange, rclass </span>
<span id="cb370-2"><a href="#cb370-2" aria-hidden="true" tabindex="-1"></a><span class="kw">version</span> 17 </span>
<span id="cb370-3"><a href="#cb370-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">syntax</span> <span class="kw">varlist</span>(<span class="fu">max</span> = 1 <span class="kw">numeric</span>)</span>
<span id="cb370-4"><a href="#cb370-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span> res <span class="st">&quot;range p7525 p9010&quot;</span></span>
<span id="cb370-5"><a href="#cb370-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">tempname</span> <span class="ot">`res&#39;</span>    </span>
<span id="cb370-6"><a href="#cb370-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> result <span class="dt">_n</span> <span class="st">&quot;Rangos de percentiles para `varlist&#39;&quot;</span></span>
<span id="cb370-7"><a href="#cb370-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">quietly</span> <span class="kw">summarize</span> <span class="ot">`varlist&#39;</span>, <span class="kw">detail</span> </span>
<span id="cb370-8"><a href="#cb370-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`range&#39;</span> = <span class="fu">r</span>(<span class="fu">max</span>) - <span class="fu">r</span>(<span class="fu">min</span>)</span>
<span id="cb370-9"><a href="#cb370-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`p7525&#39;</span> = <span class="fu">r</span>(p75) - <span class="fu">r</span>(p25)</span>
<span id="cb370-10"><a href="#cb370-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`p9010&#39;</span> = <span class="fu">r</span>(p90) - <span class="fu">r</span>(p10)</span>
<span id="cb370-11"><a href="#cb370-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">&quot;75-25 : &quot;</span> <span class="ot">`p7525&#39;</span></span>
<span id="cb370-12"><a href="#cb370-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">&quot;90-10:  &quot;</span> <span class="ot">`p9010&#39;</span></span>
<span id="cb370-13"><a href="#cb370-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">&quot;Range: &quot;</span> <span class="ot">`range&#39;</span></span></code></pre></div>
</div>
<div id="programa-con-opción-return" class="section level3 hasAnchor" number="3.6.5">
<h3 class="hasAnchor"><span class="header-section-number">3.6.5</span> Programa con opción return<a href="#programa-con-opción-return" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Una característica importante de los comandos de Stata es su <strong>capacidad de reportar los resultados</strong> de forma tal de que los usuarios y usuarias podamos utilizarlos posteriormente. El comando <code>return</code> nos permite guardar los escalares y hacerlos accesibles, sin tener el problema de los escalares que vimos en los ejemplos anteriores.</p>
<p>Programa para calcular percentiles con return:</p>
<div class="sourceCode" id="cb371"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb371-1"><a href="#cb371-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> pctrange, rclass </span>
<span id="cb371-2"><a href="#cb371-2" aria-hidden="true" tabindex="-1"></a><span class="kw">version</span> 17 </span>
<span id="cb371-3"><a href="#cb371-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">syntax</span> <span class="kw">varlist</span>(<span class="fu">max</span> = 1 <span class="kw">numeric</span>)</span>
<span id="cb371-4"><a href="#cb371-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span> res <span class="st">&quot;range p7525 p9010&quot;</span></span>
<span id="cb371-5"><a href="#cb371-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">tempname</span> <span class="ot">`res&#39;</span>    </span>
<span id="cb371-6"><a href="#cb371-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> result <span class="dt">_n</span> <span class="st">&quot;Rangos de percentiles para `varlist&#39;&quot;</span></span>
<span id="cb371-7"><a href="#cb371-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">quietly</span> <span class="kw">summarize</span> <span class="ot">`varlist&#39;</span>, <span class="kw">detail</span> </span>
<span id="cb371-8"><a href="#cb371-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`range&#39;</span> = <span class="fu">r</span>(<span class="fu">max</span>) - <span class="fu">r</span>(<span class="fu">min</span>)</span>
<span id="cb371-9"><a href="#cb371-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`p7525&#39;</span> = <span class="fu">r</span>(p75) - <span class="fu">r</span>(p25)</span>
<span id="cb371-10"><a href="#cb371-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`p9010&#39;</span> = <span class="fu">r</span>(p90) - <span class="fu">r</span>(p10)</span>
<span id="cb371-11"><a href="#cb371-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">&quot;75-25 : &quot;</span> <span class="ot">`p7525&#39;</span></span>
<span id="cb371-12"><a href="#cb371-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">&quot;90-10:  &quot;</span> <span class="ot">`p9010 &#39;</span></span>
<span id="cb371-13"><a href="#cb371-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">&quot;Range: &quot;</span> <span class="ot">`range&#39;</span></span>
<span id="cb371-14"><a href="#cb371-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="fu">r</span> <span class="kw">of</span> <span class="kw">local</span> res {</span>
<span id="cb371-15"><a href="#cb371-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span> <span class="fu">scalar</span> <span class="ot">`r&#39;</span> = <span class="ot">``r&#39;</span>&#39;</span>
<span id="cb371-16"><a href="#cb371-16" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb371-17"><a href="#cb371-17" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> </span></code></pre></div>
<p>Sobre la forma en que llamamos a return:</p>
<div class="sourceCode" id="cb372"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb372-1"><a href="#cb372-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="fu">r</span> <span class="kw">of</span> <span class="kw">local</span> res {</span>
<span id="cb372-2"><a href="#cb372-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span> <span class="fu">scalar</span> <span class="ot">`r&#39;</span> = <span class="ot">``r&#39;</span>&#39;</span>
<span id="cb372-3"><a href="#cb372-3" aria-hidden="true" tabindex="-1"></a>    }</span></code></pre></div>
<p>Notar que el lado izquierdo de <code>scalar('r')</code> se refiere al nombre de los elementos de la macro <code>res</code>. El lado derecho hace referencia a la macro una vez más para extraer el valor almacenado en ese nombre. En este caso es importante notar que se deben utilizar dos comillas (ej. <code>"range"</code>). Noten también que si utilizamos <code>scalar list</code> no hay resultados, sin embargo, al utilizar la opción <strong>return</strong> ahora podemos rescatar los resultados con <code>return list</code>.</p>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.6.3: </b></p>
<p>Preguntas</p>
<ol style="list-style-type: decimal">
<li>Escriba un programa llamado <code>misuma</code> que sea del tipo <code>r-class</code>.</li>
<li>Este programa debe entregar en la lista de <code>return list</code> el número total de observaciones, la suma total y el promedio de la variable.</li>
<li>Aplicarla en <code>auto.dta</code>.</li>
</ol>
</div>
</div>
<div id="agregar-opciones-al-programa" class="section level3 hasAnchor" number="3.6.6">
<h3 class="hasAnchor"><span class="header-section-number">3.6.6</span> Agregar opciones al programa<a href="#agregar-opciones-al-programa" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Podemos agregar distintas opciones al programa. Para este ejemplo vamos a agregar como opcional que el programa de un resultado en la consola. Recordemos que incluir <span class="math inline">\([ ]\)</span> en <code>syntax</code> significa un componente <strong>opcional</strong> en el comando.</p>
<p>Implementar opciones al programa (imprimir por defecto):</p>
<div class="sourceCode" id="cb373"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb373-1"><a href="#cb373-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> pctrange, rclass </span>
<span id="cb373-2"><a href="#cb373-2" aria-hidden="true" tabindex="-1"></a><span class="kw">version</span> 17 </span>
<span id="cb373-3"><a href="#cb373-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">syntax</span> <span class="kw">varlist</span>(<span class="fu">max</span> = 1 <span class="kw">numeric</span>) [, PRINT]</span>
<span id="cb373-4"><a href="#cb373-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span> res <span class="st">&quot;range p7525 p9010&quot;</span></span>
<span id="cb373-5"><a href="#cb373-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">tempname</span> <span class="ot">`res&#39;</span>    </span>
<span id="cb373-6"><a href="#cb373-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> result <span class="dt">_n</span> <span class="st">&quot;Rangos de percentiles para `varlist&#39;&quot;</span></span>
<span id="cb373-7"><a href="#cb373-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">quietly</span> <span class="kw">summarize</span> <span class="ot">`varlist&#39;</span>, <span class="kw">detail</span> </span>
<span id="cb373-8"><a href="#cb373-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`range&#39;</span> = <span class="fu">r</span>(<span class="fu">max</span>) - <span class="fu">r</span>(<span class="fu">min</span>)</span>
<span id="cb373-9"><a href="#cb373-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`p7525&#39;</span> = <span class="fu">r</span>(p75) - <span class="fu">r</span>(p25)</span>
<span id="cb373-10"><a href="#cb373-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`p9010&#39;</span> = <span class="fu">r</span>(p90) - <span class="fu">r</span>(p10)</span>
<span id="cb373-11"><a href="#cb373-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="st">&quot;`print&#39;&quot;</span> == <span class="st">&quot;print&quot;</span> {</span>
<span id="cb373-12"><a href="#cb373-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">&quot;75-25 : &quot;</span> <span class="ot">`p7525&#39;</span></span>
<span id="cb373-13"><a href="#cb373-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">&quot;90-10:  &quot;</span> <span class="ot">`p9010 &#39;</span></span>
<span id="cb373-14"><a href="#cb373-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">&quot;Range: &quot;</span> <span class="ot">`range&#39;</span></span>
<span id="cb373-15"><a href="#cb373-15" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb373-16"><a href="#cb373-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="fu">r</span> <span class="kw">of</span> <span class="kw">local</span> res {</span>
<span id="cb373-17"><a href="#cb373-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span> <span class="fu">scalar</span> <span class="ot">`r&#39;</span> = <span class="ot">``r&#39;</span>&#39;</span>
<span id="cb373-18"><a href="#cb373-18" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb373-19"><a href="#cb373-19" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> </span></code></pre></div>
<p>Implementar opciones al programa (no imprimir por defecto):</p>
<div class="sourceCode" id="cb374"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb374-1"><a href="#cb374-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> pctrange, rclass </span>
<span id="cb374-2"><a href="#cb374-2" aria-hidden="true" tabindex="-1"></a><span class="kw">version</span> 17 </span>
<span id="cb374-3"><a href="#cb374-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">syntax</span> <span class="kw">varlist</span>(<span class="fu">max</span> = 1 <span class="kw">numeric</span>) [, noPRINT]</span>
<span id="cb374-4"><a href="#cb374-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span> res <span class="st">&quot;range p7525 p9010&quot;</span></span>
<span id="cb374-5"><a href="#cb374-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">tempname</span> <span class="ot">`res&#39;</span>    </span>
<span id="cb374-6"><a href="#cb374-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> result <span class="dt">_n</span> <span class="st">&quot;Rangos de percentiles para `varlist&#39;&quot;</span></span>
<span id="cb374-7"><a href="#cb374-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">quietly</span> <span class="kw">summarize</span> <span class="ot">`varlist&#39;</span>, <span class="kw">detail</span> </span>
<span id="cb374-8"><a href="#cb374-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`range&#39;</span> = <span class="fu">r</span>(<span class="fu">max</span>) - <span class="fu">r</span>(<span class="fu">min</span>)</span>
<span id="cb374-9"><a href="#cb374-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`p7525&#39;</span> = <span class="fu">r</span>(p75) - <span class="fu">r</span>(p25)</span>
<span id="cb374-10"><a href="#cb374-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`p9010&#39;</span> = <span class="fu">r</span>(p90) - <span class="fu">r</span>(p10)</span>
<span id="cb374-11"><a href="#cb374-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="st">&quot;`print&#39;&quot;</span> != <span class="st">&quot;noprint&quot;</span> {</span>
<span id="cb374-12"><a href="#cb374-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">&quot;75-25 : &quot;</span> <span class="ot">`p7525&#39;</span></span>
<span id="cb374-13"><a href="#cb374-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">&quot;90-10:  &quot;</span> <span class="ot">`p9010 &#39;</span></span>
<span id="cb374-14"><a href="#cb374-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">&quot;Range: &quot;</span> <span class="ot">`range&#39;</span></span>
<span id="cb374-15"><a href="#cb374-15" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb374-16"><a href="#cb374-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="fu">r</span> <span class="kw">of</span> <span class="kw">local</span> res {</span>
<span id="cb374-17"><a href="#cb374-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span> <span class="fu">scalar</span> <span class="ot">`r&#39;</span> = <span class="ot">``r&#39;</span>&#39;</span>
<span id="cb374-18"><a href="#cb374-18" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb374-19"><a href="#cb374-19" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> </span></code></pre></div>
<p>Incluir un subconjunto de observaciones</p>
<ul>
<li>Cualquier comando debiese incluir <code>if</code> o <code>in range</code>.</li>
<li>Nuevamente, estas opciones son manejadas dentro del comando <code>syntax</code>. Para incluir estas opciones hay que agregar <code>[if]</code> y <code>[in]</code>.</li>
<li>Con estos comandos puedo ejecutar el programa para sub-muestras. Es importante asegurar que la sub-muestra no este vacía.</li>
<li>Para ello es importante calcular <code>r(N)</code>, chequear que sea distinto de cero y agregar un título que lo indique.</li>
<li>El comando <code>marksample touse</code> utiliza la información provista por <code>if</code> o <code>in</code> en caso de que estos sean indicados en el programa.</li>
<li>Este comando genera una variable local <code>touse</code> que es igual a 1 si las variables entran en el calculo que hace el programa y 0 en caso contrario.</li>
<li>Utilizaremos `<code>touse'</code> para calcular el número de observaciones que se utilizan después de aplicar los condicionales.</li>
<li>Es necesario agregar `<code>touse'</code> en cada parte del programa que trabaje con la variable de <em>input</em>.</li>
</ul>
<p>Incluir un subconjunto de observaciones:</p>
<div class="sourceCode" id="cb375"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb375-1"><a href="#cb375-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> <span class="kw">drop</span> <span class="dt">_all</span> </span>
<span id="cb375-2"><a href="#cb375-2" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> pctrange, rclass </span>
<span id="cb375-3"><a href="#cb375-3" aria-hidden="true" tabindex="-1"></a><span class="kw">syntax</span> <span class="kw">varlist</span>(<span class="fu">max</span> = 1 <span class="kw">numeric</span>) [<span class="kw">if</span>] [<span class="kw">in</span>] [, noPRINT]</span>
<span id="cb375-4"><a href="#cb375-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">marksample</span> touse </span>
<span id="cb375-5"><a href="#cb375-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">quietly</span> <span class="fu">count</span> <span class="kw">if</span> <span class="ot">`touse&#39;</span></span>
<span id="cb375-6"><a href="#cb375-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="ot">`r(N)&#39;</span> == 0 {</span>
<span id="cb375-7"><a href="#cb375-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">error</span> 2000</span>
<span id="cb375-8"><a href="#cb375-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb375-9"><a href="#cb375-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span> res <span class="kw">range</span> p7525 p9010</span>
<span id="cb375-10"><a href="#cb375-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">tempname</span> <span class="ot">`res&#39;</span>    </span>
<span id="cb375-11"><a href="#cb375-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb375-12"><a href="#cb375-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">quietly</span> <span class="kw">summarize</span> <span class="ot">`varlist&#39;</span> <span class="kw">if</span> <span class="ot">`touse&#39;</span>, <span class="kw">detail</span> </span>
<span id="cb375-13"><a href="#cb375-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`range&#39;</span> = <span class="fu">r</span>(<span class="fu">max</span>) - <span class="fu">r</span>(<span class="fu">min</span>)</span>
<span id="cb375-14"><a href="#cb375-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`p7525&#39;</span> = <span class="fu">r</span>(p75) - <span class="fu">r</span>(p25)</span>
<span id="cb375-15"><a href="#cb375-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`p9010&#39;</span> = <span class="fu">r</span>(p90) - <span class="fu">r</span>(p10)</span>
<span id="cb375-16"><a href="#cb375-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="st">&quot;`print&#39;&quot;</span> != <span class="st">&quot;noprint&quot;</span> {</span>
<span id="cb375-17"><a href="#cb375-17" aria-hidden="true" tabindex="-1"></a>        <span class="kw">display</span> <span class="kw">as</span> result <span class="dt">_n</span> <span class="st">&quot;Rangos de percentiles para `varlist&#39;, N = `r(N)&#39;&quot;</span></span>
<span id="cb375-18"><a href="#cb375-18" aria-hidden="true" tabindex="-1"></a>        <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">&quot;75-25 : &quot;</span> <span class="ot">`p7525&#39;</span></span>
<span id="cb375-19"><a href="#cb375-19" aria-hidden="true" tabindex="-1"></a>        <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">&quot;90-10:  &quot;</span> <span class="ot">`p9010 &#39;</span></span>
<span id="cb375-20"><a href="#cb375-20" aria-hidden="true" tabindex="-1"></a>        <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">&quot;Range: &quot;</span> <span class="ot">`range&#39;</span></span>
<span id="cb375-21"><a href="#cb375-21" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb375-22"><a href="#cb375-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="fu">r</span> <span class="kw">of</span> <span class="kw">local</span> res {</span>
<span id="cb375-23"><a href="#cb375-23" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span> <span class="fu">scalar</span> <span class="ot">`r&#39;</span> = <span class="ot">``r&#39;</span>&#39;</span>
<span id="cb375-24"><a href="#cb375-24" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb375-25"><a href="#cb375-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span> <span class="fu">scalar</span> <span class="kw">N</span> = <span class="fu">r</span>(<span class="kw">N</span>)</span>
<span id="cb375-26"><a href="#cb375-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span> <span class="kw">local</span> varname <span class="ot">`varlist&#39;</span></span>
<span id="cb375-27"><a href="#cb375-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb375-28"><a href="#cb375-28" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> </span></code></pre></div>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.6.2: </b></p>
<p>Preguntas</p>
<ol style="list-style-type: decimal">
<li>Ajuste el programa del ejercicio 1 con el fin de incluir la opción <code>if</code>. Guárdelo como <code>misuma2</code>.</li>
<li>Aplicarla en <code>auto.dta</code>.</li>
</ol>
</div>
</div>
<div id="generalizar-el-comando-para-incluir-múltiples-variables-1" class="section level3 hasAnchor" number="3.6.7">
<h3 class="hasAnchor"><span class="header-section-number">3.6.7</span> Generalizar el comando para incluir múltiples variables<a href="#generalizar-el-comando-para-incluir-múltiples-variables-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Algunas consideraciones</p>
<ul>
<li>Si quiero ejecutar el programa sobre múltiples variables, es necesario ajustar un poco el programa.</li>
<li>Tengo que indicarle a <code>syntax</code> que hay más de una variable. Además, tengo que indicarle al programa que en caso de que existan más variables muestre los resultados en una tabla.</li>
<li>Guardaremos los resultados en matrices (no escalares) y vamos a aplicar una <strong>función de macro extendida</strong> con el fin de contar el número de filas que esta matriz debiese tener.</li>
<li>Agregaremos también una la opción <code>format</code> para cambiar el formato y la opción <code>mat</code> que permite a la matriz ser guardada automáticamente con el nombre indicado.</li>
</ul>
<div class="sourceCode" id="cb376"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb376-1"><a href="#cb376-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> <span class="kw">drop</span> <span class="dt">_all</span> </span>
<span id="cb376-2"><a href="#cb376-2" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> pctrange, rclass</span>
<span id="cb376-3"><a href="#cb376-3" aria-hidden="true" tabindex="-1"></a><span class="kw">version</span> 17 </span>
<span id="cb376-4"><a href="#cb376-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">syntax</span> <span class="kw">varlist</span>(<span class="fu">min</span> = 1 <span class="kw">numeric</span> ts) [<span class="kw">if</span>] [<span class="kw">in</span>] [, noPRINT FORmat(passthru) MATrix(<span class="fu">string</span>)] </span>
<span id="cb376-5"><a href="#cb376-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">marksample</span> touse </span>
<span id="cb376-6"><a href="#cb376-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">quietly</span> <span class="fu">count</span> <span class="kw">if</span> <span class="ot">`touse&#39;</span></span>
<span id="cb376-7"><a href="#cb376-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="ot">`r(N)&#39;</span> == 0 {</span>
<span id="cb376-8"><a href="#cb376-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">error</span> 2000</span>
<span id="cb376-9"><a href="#cb376-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb376-10"><a href="#cb376-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span> nvar: <span class="fu">word</span> <span class="fu">count</span> <span class="ot">`varlist&#39;</span></span>
<span id="cb376-11"><a href="#cb376-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="ot">`nvar&#39;</span> == 1 {</span>
<span id="cb376-12"><a href="#cb376-12" aria-hidden="true" tabindex="-1"></a>        <span class="kw">local</span> res <span class="kw">range</span> p7525 p9010</span>
<span id="cb376-13"><a href="#cb376-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">tempname</span> <span class="ot">`res&#39;</span>    </span>
<span id="cb376-14"><a href="#cb376-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb376-15"><a href="#cb376-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">quietly</span> <span class="kw">summarize</span> <span class="ot">`varlist&#39;</span> <span class="kw">if</span> <span class="ot">`touse&#39;</span>, <span class="kw">detail</span> </span>
<span id="cb376-16"><a href="#cb376-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scalar</span> <span class="ot">`range&#39;</span> = <span class="fu">r</span>(<span class="fu">max</span>) - <span class="fu">r</span>(<span class="fu">min</span>)</span>
<span id="cb376-17"><a href="#cb376-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scalar</span> <span class="ot">`p7525&#39;</span> = <span class="fu">r</span>(p75) - <span class="fu">r</span>(p25)</span>
<span id="cb376-18"><a href="#cb376-18" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scalar</span> <span class="ot">`p9010&#39;</span> = <span class="fu">r</span>(p90) - <span class="fu">r</span>(p10)</span>
<span id="cb376-19"><a href="#cb376-19" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="st">&quot;`print&#39;&quot;</span> != <span class="st">&quot;noprint&quot;</span> {</span>
<span id="cb376-20"><a href="#cb376-20" aria-hidden="true" tabindex="-1"></a>            <span class="kw">display</span> <span class="kw">as</span> result <span class="dt">_n</span> <span class="st">&quot;Rangos de percentiles para `varlist&#39;, N = `r(N)&#39;&quot;</span></span>
<span id="cb376-21"><a href="#cb376-21" aria-hidden="true" tabindex="-1"></a>            <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">&quot;75-25 : &quot;</span> <span class="ot">`p7525&#39;</span></span>
<span id="cb376-22"><a href="#cb376-22" aria-hidden="true" tabindex="-1"></a>            <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">&quot;90-10:  &quot;</span> <span class="ot">`p9010 &#39;</span></span>
<span id="cb376-23"><a href="#cb376-23" aria-hidden="true" tabindex="-1"></a>            <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">&quot;Range: &quot;</span> <span class="ot">`range&#39;</span></span>
<span id="cb376-24"><a href="#cb376-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb376-25"><a href="#cb376-25" aria-hidden="true" tabindex="-1"></a>        <span class="kw">foreach</span> <span class="fu">r</span> <span class="kw">of</span> <span class="kw">local</span> res {</span>
<span id="cb376-26"><a href="#cb376-26" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span> <span class="fu">scalar</span> <span class="ot">`r&#39;</span> = <span class="ot">``r&#39;</span>&#39;</span>
<span id="cb376-27"><a href="#cb376-27" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb376-28"><a href="#cb376-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span> <span class="fu">scalar</span> <span class="kw">N</span> = <span class="fu">r</span>(<span class="kw">N</span>)</span>
<span id="cb376-29"><a href="#cb376-29" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb376-30"><a href="#cb376-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">else</span> {</span>
<span id="cb376-31"><a href="#cb376-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">tempname</span> rmat </span>
<span id="cb376-32"><a href="#cb376-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">matrix</span> <span class="ot">`rmat&#39;</span> = <span class="fu">J</span>(<span class="ot">`nvar&#39;</span>, 3, .)</span>
<span id="cb376-33"><a href="#cb376-33" aria-hidden="true" tabindex="-1"></a>      <span class="kw">local</span> i 0 </span>
<span id="cb376-34"><a href="#cb376-34" aria-hidden="true" tabindex="-1"></a>        <span class="kw">foreach</span> v <span class="kw">of</span> <span class="kw">varlist</span> <span class="ot">`varlist&#39;</span>{</span>
<span id="cb376-35"><a href="#cb376-35" aria-hidden="true" tabindex="-1"></a>        <span class="kw">local</span> ++i </span>
<span id="cb376-36"><a href="#cb376-36" aria-hidden="true" tabindex="-1"></a>        <span class="kw">quietly</span> <span class="kw">summarize</span> <span class="ot">`v&#39;</span> <span class="kw">if</span> <span class="ot">`touse&#39;</span>, <span class="kw">detail</span> </span>
<span id="cb376-37"><a href="#cb376-37" aria-hidden="true" tabindex="-1"></a>        <span class="fu">matrix</span> <span class="ot">`rmat&#39;</span>[<span class="ot">`i&#39;</span> ,1] = <span class="fu">r</span>(<span class="fu">max</span>) - <span class="fu">r</span>(<span class="fu">min</span>)</span>
<span id="cb376-38"><a href="#cb376-38" aria-hidden="true" tabindex="-1"></a>        <span class="fu">matrix</span> <span class="ot">`rmat&#39;</span>[<span class="ot">`i&#39;</span>, 2] = <span class="fu">r</span>(p75) - <span class="fu">r</span>(p25)</span>
<span id="cb376-39"><a href="#cb376-39" aria-hidden="true" tabindex="-1"></a>        <span class="fu">matrix</span> <span class="ot">`rmat&#39;</span>[<span class="ot">`i&#39;</span>, 3] = <span class="fu">r</span>(p90) - <span class="fu">r</span>(p10)</span>
<span id="cb376-40"><a href="#cb376-40" aria-hidden="true" tabindex="-1"></a>        <span class="kw">local</span> <span class="ot">rown</span> <span class="ot">`rown&#39;</span> <span class="ot">`v&#39;</span></span>
<span id="cb376-41"><a href="#cb376-41" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb376-42"><a href="#cb376-42" aria-hidden="true" tabindex="-1"></a>      <span class="fu">matrix</span> <span class="ot">colnames</span> <span class="ot">`rmat&#39;</span> = Range P75-P25 P90-P10 </span>
<span id="cb376-43"><a href="#cb376-43" aria-hidden="true" tabindex="-1"></a>      <span class="fu">matrix</span> <span class="ot">rownames</span> <span class="ot">`rmat&#39;</span> = <span class="ot">`rown&#39;</span> </span>
<span id="cb376-44"><a href="#cb376-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb376-45"><a href="#cb376-45" aria-hidden="true" tabindex="-1"></a>      <span class="kw">if</span> <span class="st">&quot;`print&#39;&quot;</span> != <span class="st">&quot;noprint&quot;</span> {</span>
<span id="cb376-46"><a href="#cb376-46" aria-hidden="true" tabindex="-1"></a>          <span class="kw">local</span> form <span class="st">&quot;, noheader&quot;</span></span>
<span id="cb376-47"><a href="#cb376-47" aria-hidden="true" tabindex="-1"></a>          <span class="kw">if</span> <span class="st">&quot;`format&#39;&quot;</span> != <span class="st">&quot;&quot;</span> {</span>
<span id="cb376-48"><a href="#cb376-48" aria-hidden="true" tabindex="-1"></a>                <span class="kw">local</span> form <span class="st">&quot;`form&#39; `format&#39;&quot;</span> </span>
<span id="cb376-49"><a href="#cb376-49" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb376-50"><a href="#cb376-50" aria-hidden="true" tabindex="-1"></a>          <span class="fu">matrix</span> <span class="ot">list</span> <span class="ot">`rmat&#39;</span> <span class="ot">`form&#39;</span></span>
<span id="cb376-51"><a href="#cb376-51" aria-hidden="true" tabindex="-1"></a>                                }</span>
<span id="cb376-52"><a href="#cb376-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb376-53"><a href="#cb376-53" aria-hidden="true" tabindex="-1"></a>      <span class="kw">if</span> <span class="st">&quot;`matrix&#39;&quot;</span> != <span class="st">&quot;&quot;</span> {</span>
<span id="cb376-54"><a href="#cb376-54" aria-hidden="true" tabindex="-1"></a>            <span class="fu">matrix</span> <span class="ot">`matrix&#39;</span> = <span class="ot">`rmat&#39;</span></span>
<span id="cb376-55"><a href="#cb376-55" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb376-56"><a href="#cb376-56" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span> <span class="fu">matrix</span> rmat = <span class="ot">`rmat&#39;</span></span>
<span id="cb376-57"><a href="#cb376-57" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb376-58"><a href="#cb376-58" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span> <span class="kw">local</span> varname <span class="ot">`varlist&#39;</span></span>
<span id="cb376-59"><a href="#cb376-59" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
</div>
<div id="agregar-prefijos-a-los-programas-1" class="section level3 hasAnchor" number="3.6.8">
<h3 class="hasAnchor"><span class="header-section-number">3.6.8</span> Agregar prefijos a los programas<a href="#agregar-prefijos-a-los-programas-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>prefijo by: Ahora vamos a hacer que nuestro programa pueda utilizar el prefijo <code>by</code>. Para agregar esta opción simplemente hay que modificar <code>program</code>.</p>
<div class="sourceCode" id="cb377"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb377-1"><a href="#cb377-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> pctrange, rclass byable(recall)</span></code></pre></div>
<p>También podemos permitir que la lista de variables incluya <strong>operadores de series de tiempo</strong> (ej. <code>L.pib</code>, <code>D.ingreso</code>).</p>
<div class="sourceCode" id="cb378"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb378-1"><a href="#cb378-1" aria-hidden="true" tabindex="-1"></a><span class="kw">syntax</span> <span class="kw">varlist</span>(<span class="fu">min</span> = 1 <span class="kw">numeric</span> ts) </span></code></pre></div>
</div>
<div id="programas-para-complementar-función-egen-1" class="section level3 hasAnchor" number="3.6.9">
<h3 class="hasAnchor"><span class="header-section-number">3.6.9</span> Programas para complementar función egen<a href="#programas-para-complementar-función-egen-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Es posible programar funciones adicionales de <code>egen</code> (<em>extended generate</em>). El nombre de estos programas deben empezar con <code>_g</code>. Una diferencia entre este tipo de programas y los ya hechos es que en estos hay que tener en cuenta la nueva variable que se va a crear. La sintaxis es la siguiente:</p>
<div class="sourceCode" id="cb379"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb379-1"><a href="#cb379-1" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> [<span class="dv">type</span>] newvarname = fcn(arguments) [<span class="kw">if</span>] [<span class="kw">in</span>] [, options]</span></code></pre></div>
<p>El cambio que vamos a hacer en la sintaxis del programa será que incluiremos un <code>touse</code> para hacer la nueva variable.</p>
<p>Vamos a escribir un programa para calcular un rango en particular:</p>
<div class="sourceCode" id="cb380"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb380-1"><a href="#cb380-1" aria-hidden="true" tabindex="-1"></a>* Programas <span class="kw">de</span> <span class="kw">egen</span> </span>
<span id="cb380-2"><a href="#cb380-2" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> <span class="kw">drop</span> <span class="dt">_all</span></span>
<span id="cb380-3"><a href="#cb380-3" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> _gpct9010</span>
<span id="cb380-4"><a href="#cb380-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">syntax</span> newvarname =/<span class="fu">exp</span> [<span class="kw">if</span>] [<span class="kw">in</span>] </span>
<span id="cb380-5"><a href="#cb380-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">tempvar</span> touse </span>
<span id="cb380-6"><a href="#cb380-6" aria-hidden="true" tabindex="-1"></a>    mark <span class="ot">`touse&#39;</span> <span class="ot">`if&#39;</span> <span class="ot">`in&#39;</span> </span>
<span id="cb380-7"><a href="#cb380-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">quietly</span> <span class="kw">summarize</span> <span class="ot">`exp&#39;</span> <span class="kw">if</span> <span class="ot">`touse&#39;</span>, <span class="kw">detail</span> </span>
<span id="cb380-8"><a href="#cb380-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">quietly</span> <span class="kw">generate</span> <span class="ot">`typlist&#39;</span> <span class="ot">`varlist&#39;</span> = <span class="fu">r</span>(p90) - <span class="fu">r</span>(p10) <span class="kw">if</span> <span class="ot">`touse&#39;</span></span>
<span id="cb380-9"><a href="#cb380-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb380-10"><a href="#cb380-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb380-11"><a href="#cb380-11" aria-hidden="true" tabindex="-1"></a>* Aplicación del programa</span>
<span id="cb380-12"><a href="#cb380-12" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto, <span class="kw">clear</span></span>
<span id="cb380-13"><a href="#cb380-13" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> rango9010 = pct9010(price)</span></code></pre></div>
<p>Programas con funciones de egen con prefijo by:</p>
<ul>
<li>Agregamos [, *] que corresponde a las opciones. En <code>egen</code>el prefijo <code>by</code> es una opción.</li>
<li>Con el fin de permitirle al programa que pueda producir un rango de percentil separado para distintos grupos utilizaremos <code>pctile</code> en vez de <code>summarize</code>.</li>
</ul>
<div class="sourceCode" id="cb381"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb381-1"><a href="#cb381-1" aria-hidden="true" tabindex="-1"></a>* Programa con opción <span class="kw">by</span>. </span>
<span id="cb381-2"><a href="#cb381-2" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> <span class="kw">drop</span> <span class="dt">_all</span></span>
<span id="cb381-3"><a href="#cb381-3" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> _gpct9010</span>
<span id="cb381-4"><a href="#cb381-4" aria-hidden="true" tabindex="-1"></a><span class="kw">syntax</span> newvarname =/<span class="fu">exp</span> [<span class="kw">if</span>] [<span class="kw">in</span>] [, *] </span>
<span id="cb381-5"><a href="#cb381-5" aria-hidden="true" tabindex="-1"></a><span class="kw">tempvar</span> touse p90 p10 </span>
<span id="cb381-6"><a href="#cb381-6" aria-hidden="true" tabindex="-1"></a>mark <span class="ot">`touse&#39;</span> <span class="ot">`if&#39;</span> <span class="ot">`in&#39;</span> </span>
<span id="cb381-7"><a href="#cb381-7" aria-hidden="true" tabindex="-1"></a><span class="kw">quietly</span> {</span>
<span id="cb381-8"><a href="#cb381-8" aria-hidden="true" tabindex="-1"></a>          <span class="kw">egen</span> <span class="kw">double</span> <span class="ot">`p90&#39;</span> = <span class="kw">pctile</span>(<span class="ot">`exp&#39;</span>) <span class="kw">if</span> <span class="ot">`touse&#39;</span>, <span class="ot">`options&#39;</span> <span class="kw">p</span>(90) </span>
<span id="cb381-9"><a href="#cb381-9" aria-hidden="true" tabindex="-1"></a>          <span class="kw">egen</span> <span class="kw">double</span> <span class="ot">`p10&#39;</span> = <span class="kw">pctile</span>(<span class="ot">`exp&#39;</span>) <span class="kw">if</span> <span class="ot">`touse&#39;</span>, <span class="ot">`options&#39;</span> <span class="kw">p</span>(10)</span>
<span id="cb381-10"><a href="#cb381-10" aria-hidden="true" tabindex="-1"></a>          <span class="kw">generate</span> <span class="ot">`typlist&#39;</span> <span class="ot">`varlist&#39;</span> = <span class="ot">`p90&#39;</span> - <span class="ot">`p10&#39;</span> <span class="kw">if</span> <span class="ot">`touse&#39;</span> } </span>
<span id="cb381-11"><a href="#cb381-11" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb381-12"><a href="#cb381-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb381-13"><a href="#cb381-13" aria-hidden="true" tabindex="-1"></a>* Aplicación del programa</span>
<span id="cb381-14"><a href="#cb381-14" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto, <span class="kw">clear</span></span>
<span id="cb381-15"><a href="#cb381-15" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> rango9010 = pct9010(price)</span>
<span id="cb381-16"><a href="#cb381-16" aria-hidden="true" tabindex="-1"></a><span class="kw">bysort</span> rep78 foreign: <span class="kw">egen</span> rango9010_prefijoby = pct9010(price)</span></code></pre></div>
</div>
<div id="generalización-de-la-función-egen" class="section level3 hasAnchor" number="3.6.10">
<h3 class="hasAnchor"><span class="header-section-number">3.6.10</span> Generalización de la función egen<a href="#generalización-de-la-función-egen" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Hemos desarrollado una función de <code>egen</code> que permite calcular un rango entre percentiles para una lista de variables especifica. Puede ser útil tomar ventaja de <code>egen pctile()</code> para poder calcular cualquier percentil de la lista de variables especificadas. Vamos a agregar dos opciones a la función <code>egen</code> : <code>lo()</code> y <code>hi()</code>. En caso de que no especifiquemos, por defecto se calcula el rango interquartil. La función de <code>egen</code> ahora se llamará <code>_gpctrange.ado</code>.</p>
<p>Función egen más general para percentiles:</p>
<div class="sourceCode" id="cb382"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb382-1"><a href="#cb382-1" aria-hidden="true" tabindex="-1"></a>* Programa con opción <span class="kw">by</span>. </span>
<span id="cb382-2"><a href="#cb382-2" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> <span class="kw">drop</span> <span class="dt">_all</span></span>
<span id="cb382-3"><a href="#cb382-3" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> _gpctrange</span>
<span id="cb382-4"><a href="#cb382-4" aria-hidden="true" tabindex="-1"></a><span class="kw">syntax</span> newvarname =/<span class="fu">exp</span> [<span class="kw">if</span>] [<span class="kw">in</span>] [, LO(integer 25) HI(integer 75) *] </span>
<span id="cb382-5"><a href="#cb382-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb382-6"><a href="#cb382-6" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="ot">`hi&#39;</span> &gt; 99 | <span class="ot">`lo&#39;</span> &lt; 1 {</span>
<span id="cb382-7"><a href="#cb382-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> <span class="kw">error</span> <span class="co">///</span></span>
<span id="cb382-8"><a href="#cb382-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Percentiles `lo&#39; `hi&#39; deben estar entre 1 y 99.&quot;</span> </span>
<span id="cb382-9"><a href="#cb382-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">error</span> 198 </span>
<span id="cb382-10"><a href="#cb382-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb382-11"><a href="#cb382-11" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="ot">`hi&#39;</span> &lt;= <span class="ot">`lo&#39;</span> {</span>
<span id="cb382-12"><a href="#cb382-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> <span class="kw">error</span> <span class="co">///</span></span>
<span id="cb382-13"><a href="#cb382-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Percentiles `lo&#39; `hi&#39; deben estar en orden ascendente&quot;</span></span>
<span id="cb382-14"><a href="#cb382-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">error</span> 198 </span>
<span id="cb382-15"><a href="#cb382-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb382-16"><a href="#cb382-16" aria-hidden="true" tabindex="-1"></a><span class="kw">tempvar</span> touse phi plo </span>
<span id="cb382-17"><a href="#cb382-17" aria-hidden="true" tabindex="-1"></a>mark <span class="ot">`touse&#39;</span> <span class="ot">`if&#39;</span> <span class="ot">`in&#39;</span> </span>
<span id="cb382-18"><a href="#cb382-18" aria-hidden="true" tabindex="-1"></a><span class="kw">quietly</span> {</span>
<span id="cb382-19"><a href="#cb382-19" aria-hidden="true" tabindex="-1"></a>          <span class="kw">egen</span> <span class="kw">double</span> <span class="ot">`phi&#39;</span> = <span class="kw">pctile</span>(<span class="ot">`exp&#39;</span>) <span class="kw">if</span> <span class="ot">`touse&#39;</span>, <span class="ot">`options&#39;</span> <span class="kw">p</span>(<span class="ot">`hi&#39;</span>) </span>
<span id="cb382-20"><a href="#cb382-20" aria-hidden="true" tabindex="-1"></a>          <span class="kw">egen</span> <span class="kw">double</span> <span class="ot">`plo&#39;</span> = <span class="kw">pctile</span>(<span class="ot">`exp&#39;</span>) <span class="kw">if</span> <span class="ot">`touse&#39;</span>, <span class="ot">`options&#39;</span> <span class="kw">p</span>(<span class="ot">`lo&#39;</span>)</span>
<span id="cb382-21"><a href="#cb382-21" aria-hidden="true" tabindex="-1"></a>          <span class="kw">generate</span> <span class="ot">`typlist&#39;</span> <span class="ot">`varlist&#39;</span> = <span class="ot">`phi&#39;</span> - <span class="ot">`plo&#39;</span> <span class="kw">if</span> <span class="ot">`touse&#39;</span> </span>
<span id="cb382-22"><a href="#cb382-22" aria-hidden="true" tabindex="-1"></a>          } </span>
<span id="cb382-23"><a href="#cb382-23" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb382-24"><a href="#cb382-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb382-25"><a href="#cb382-25" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto, <span class="kw">clear</span></span>
<span id="cb382-26"><a href="#cb382-26" aria-hidden="true" tabindex="-1"></a><span class="kw">bysort</span> rep78: <span class="kw">egen</span> <span class="fu">iqr</span> = pctrange(price) <span class="kw">if</span> <span class="fu">inrange</span>(rep78,3,5)</span>
<span id="cb382-27"><a href="#cb382-27" aria-hidden="true" tabindex="-1"></a><span class="kw">bysort</span> rep78: <span class="kw">egen</span> p8020 = pctrange(price) <span class="kw">if</span> <span class="fu">inrange</span>(rep78,3,5), hi(80) lo(20)</span>
<span id="cb382-28"><a href="#cb382-28" aria-hidden="true" tabindex="-1"></a><span class="kw">bysort</span> rep78: <span class="kw">egen</span> p8020 = pctrange(price) <span class="kw">if</span> <span class="fu">inrange</span>(rep78,3,5) <span class="co">///</span></span>
<span id="cb382-29"><a href="#cb382-29" aria-hidden="true" tabindex="-1"></a>&amp; foreign==1, hi(80) lo(20)</span>
<span id="cb382-30"><a href="#cb382-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb382-31"><a href="#cb382-31" aria-hidden="true" tabindex="-1"></a>* Utilizar estas nuevas variables con otros comandos</span>
<span id="cb382-32"><a href="#cb382-32" aria-hidden="true" tabindex="-1"></a><span class="kw">tabstat</span> <span class="fu">iqr</span> <span class="kw">if</span> <span class="fu">inrange</span>(rep78, 3, 5), <span class="kw">by</span>(rep78)</span>
<span id="cb382-33"><a href="#cb382-33" aria-hidden="true" tabindex="-1"></a><span class="kw">tabstat</span> p8020 <span class="kw">if</span> <span class="fu">inrange</span>(rep78, 3, 5), <span class="kw">by</span>(rep78)</span></code></pre></div>
</div>
<div id="documentar-tu-programa" class="section level3 hasAnchor" number="3.6.11">
<h3 class="hasAnchor"><span class="header-section-number">3.6.11</span> Documentar tu programa<a href="#documentar-tu-programa" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Escribir un help</p>
<ul>
<li>Es necesario y recomendado mantener una documentación de los programas que se escriban para un proyecto.</li>
<li>Esta documentación debe estar actualizada e incluir cualquier modificación. <strong>Importante hacerlo mientras se hace el programa y no al final</strong>.</li>
<li>Vamos a aprender un poco de SMCL (<em>Stata Markup and Control Language file</em>). Básicamente es el lenguaje con el que se escriben los <code>help</code> en Stata. También es el lenguaje con el que se muestran los resultados de <code>display</code>.</li>
<li>Los archivos se pueden escribir en cualquier procesador de texto, pero deben ser guardados en formato <code>.smcl</code>. También deben ser guardados en la misma carpeta en donde se encuentra el <code>ado-file</code> relacionado con el archivo.</li>
<li>Hay que empezar los códigos con <span class="math inline">\(\{smcl\}\)</span> con el fin de indicarle a Stata que el texto que viene será en formato SMCL.</li>
<li>Las etiquetas de SMCL van entre llaves (<span class="math inline">\(\{\}\)</span>) y se pueden leer de dos formas principalmente:
<ul>
<li><span class="math inline">\(\{tag:text\}\)</span> etiquetar el texto que se esta escribiendo.</li>
<li><span class="math inline">\(\{tag\}\)</span> etiquetar todo lo que viene hasta que se cambie en otra parte del texto.</li>
</ul></li>
</ul>
<p>Por ejemplo, si quiero poner texto en <em>itálica</em> tengo que ocupar la <strong>etiqueta</strong> <em>it</em>:</p>
<div class="sourceCode" id="cb383"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb383-1"><a href="#cb383-1" aria-hidden="true" tabindex="-1"></a>* Una palabra/frase en particular</span>
<span id="cb383-2"><a href="#cb383-2" aria-hidden="true" tabindex="-1"></a>{it:este texto aparecerá en itálica}</span>
<span id="cb383-3"><a href="#cb383-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb383-4"><a href="#cb383-4" aria-hidden="true" tabindex="-1"></a>* Todo <span class="fu">el</span> bloque <span class="kw">de</span> texto</span>
<span id="cb383-5"><a href="#cb383-5" aria-hidden="true" tabindex="-1"></a>{it} Todo lo que este aquí aparecerá en itálica. <span class="co">///</span></span>
<span id="cb383-6"><a href="#cb383-6" aria-hidden="true" tabindex="-1"></a>Esto va a ocurrir hasta que aparezca un nuevo <span class="co">///</span></span>
<span id="cb383-7"><a href="#cb383-7" aria-hidden="true" tabindex="-1"></a>tipo <span class="kw">de</span> etiqueta. </span></code></pre></div>
<p>Etiquetas de SMCL</p>
<ul>
<li><strong>Texto:</strong> {it}, {bf}, {sf}, {ul}. Itálica, negrita, texto normal, subrayado, repectivamente.</li>
<li><strong>Texto en formato Stata:</strong> {cmd}, {error}, {result}, {text}.</li>
<li><strong>{Destacar una referencia:</strong> {hi}.</li>
<li><strong>Opciones de comando:</strong> {opt}.</li>
<li><strong>Insertar linea horizontal:</strong> {hline}.</li>
<li><strong>Volver a dejar el texto a su estado normal:</strong> {reset}.</li>
<li><strong>Formato de documento:</strong> {title:text}, {center}, {ralign}, {lalign}, {tab}.</li>
<li><strong>Párrafos:</strong> Hay dos opciones para escribirlos.
<ul>
<li>{p #1 #2 #3 #4}.<br />
</li>
<li>{p} = {p 0 0 0 0}</li>
</ul></li>
<li>Los números indican los siguientes elementos de un párrafo:
<ul>
<li>El primer número (#1) es cuántos caracteres hay que sangrar en la primera línea.</li>
<li>El segundo número (#2) es cuántos caracteres hay que sangrar en la segunda y tercera línea.</li>
<li>El tercer número (#3) es cuán lejos de la derecha debe estar el margen.</li>
<li>El cuarto número (#4) es para el ancho total del párrafo.</li>
<li>{phang}: es equivalente a {p 4 8 2}.</li>
<li>{pstd}: es equivalente a {p 4 4 2}.</li>
<li>{phang2}: es equivalente a {p 8 12 2}.</li>
<li>{p2col}: Para separar el texto en dos columnas.</li>
<li>{p_end}: Para terminar un párrafo. Útil cuando tienes dos parrafos en formatos distintos.</li>
</ul></li>
</ul>
</div>
<div id="escribir-programas-e-class" class="section level3 hasAnchor" number="3.6.12">
<h3 class="hasAnchor"><span class="header-section-number">3.6.12</span> Escribir programas e-class<a href="#escribir-programas-e-class" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Vamos a aprender algunos elementos que nos van a permitir escribir nuestros propios comandos de estimación en Stata. Muchos de los conceptos que hemos visto aplican también para este tipo de comandos. Es necesario recordar algunas convenciones que nos van a ser útiles para poder escribir nuestros programas.</p>
<ul>
<li>Los resultados se guardan en <code>|e()</code> y se puede acceder a ellos con <code>ereturn list</code>.</li>
<li>El número de observaciones es <code>e(N)</code> y para identificar que observaciones fueron incluidas en la estimación es necesario utilizar la función <code>e(sample)</code>.</li>
<li>Los coeficientes estimados se guardan en un vector <code>e(b)</code> y la matriz de varianza covarianza se guarda en <code>e(V)</code>.</li>
<li>El comando <code>ereturn name = exp</code> retorna un escalar, mientras que <code>ereturn local name value</code> y <code>ereturn matrix name matname</code> retorna una macro y una matriz respectivamente.</li>
<li>El comando <code>ereturn post</code> envía las estimaciones de <code>b</code> y <code>V</code> a sus ubicaciones oficiales.</li>
<li>Para devolver el vector de coeficientes y su matriz de varianza, es necesario crear el vector de coeficientes, digamos <span class="math inline">\(beta\)</span>, y su matriz de varianza-covarianza, digamos <span class="math inline">\(vce\)</span>.</li>
</ul>
<div class="sourceCode" id="cb384"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb384-1"><a href="#cb384-1" aria-hidden="true" tabindex="-1"></a><span class="kw">ereturn</span> <span class="kw">post</span> <span class="ot">`beta&#39;</span> &#39;vce&#39;, <span class="kw">esample</span>(<span class="ot">`touse&#39;</span>)</span></code></pre></div>
<p>También podemos definir la muestra de estimación incluida en la estimación con <code>touse</code>. Ahora es posible guardar los elementos en <code>e()</code>. Por ejemplo, es posible utilizar <code>ereturn scalar</code>, <code>ereturn local</code> o <code>ereturn matrix</code>.</p>
<p>Es conveniente utilizar los nombres típicamente asignados para guardar resultados de los programas <code>e(df_m)</code> o <code>e(df_r)</code>. Sin embargo, se pueden nombrar como deseen.</p>
</div>
</div>
<div id="programar-ado---files-parte-iii" class="section level2 hasAnchor" number="3.7">
<h2 class="hasAnchor"><span class="header-section-number">3.7</span> Programar ado - files (Parte III)<a href="#programar-ado---files-parte-iii" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="marksample-mark-y-markout" class="section level3 hasAnchor" number="3.7.1">
<h3 class="hasAnchor"><span class="header-section-number">3.7.1</span> Marksample, Mark y Markout<a href="#marksample-mark-y-markout" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>marksample</code> y <code>mark</code> son alternativas. <code>mark</code> no es muy utilizado. Ambos comandos crean un indicador que marcan que observaciones será utilizadas. Los ocupadmos en los programas en Stata. La idea es indicarle al programa la muestra relevante. <code>markout</code> marca la variable con un indicador igual a 0 si cualquier variable en <code>varlist</code> indicada contiene un <em>missing</em>.</p>
<p>Marksample</p>
<ul>
<li><code>marksample</code> se utiliza en programas en los que los argumentos se analizan mediante el comando <code>syntax</code>.</li>
<li>Crea una variable temporal, almacena el nombre de la variable temporal en un local, y rellena la variable temporal con 0 y 1 según si la observación debe ser utilizada.</li>
</ul>
<div class="sourceCode" id="cb385"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb385-1"><a href="#cb385-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> ....</span>
<span id="cb385-2"><a href="#cb385-2" aria-hidden="true" tabindex="-1"></a><span class="kw">syntax</span> ...</span>
<span id="cb385-3"><a href="#cb385-3" aria-hidden="true" tabindex="-1"></a><span class="kw">marksample</span> touse</span>
<span id="cb385-4"><a href="#cb385-4" aria-hidden="true" tabindex="-1"></a>rest <span class="kw">of</span> code .... <span class="kw">if</span> <span class="ot">`touse&#39;</span></span>
<span id="cb385-5"><a href="#cb385-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p>Mark</p>
<ul>
<li><code>mark</code> utiliza la variable temporal <code>touse</code> basada en las expresiones de <code>if</code> e <code>in</code>.</li>
<li>Si no hay expresiones de <code>if</code> e <code>in</code>, <code>touse</code> será 1 para cada observación en los datos.</li>
<li>Si indico una condición, solo las observaciones que cumplan esta condición tendrán un 1 en <code>touse</code>.</li>
<li><code>Mark</code> actualiza <code>touse</code> de forma tal de que revisa <em>missing</em>.</li>
</ul>
<p>Mark y Markout</p>
<ul>
<li><code>mark</code> parte con una variable temporal previamente creada.<br />
</li>
<li><code>markout</code> modifica la variable creada por <code>mark</code> poniéndola a cero en las observaciones que tienen valores perdidos registrados para cualquiera de las variables en <em>varlist</em>.</li>
</ul>
<div class="sourceCode" id="cb386"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb386-1"><a href="#cb386-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> ....</span>
<span id="cb386-2"><a href="#cb386-2" aria-hidden="true" tabindex="-1"></a><span class="kw">tempvar</span> touse</span>
<span id="cb386-3"><a href="#cb386-3" aria-hidden="true" tabindex="-1"></a>mark <span class="ot">`touse&#39;</span> ...</span>
<span id="cb386-4"><a href="#cb386-4" aria-hidden="true" tabindex="-1"></a><span class="kw">markout</span> <span class="ot">`touse&#39;</span> ...</span>
<span id="cb386-5"><a href="#cb386-5" aria-hidden="true" tabindex="-1"></a>rest <span class="kw">of</span> code ... <span class="kw">if</span> <span class="ot">`touse&#39;</span></span>
<span id="cb386-6"><a href="#cb386-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p>Marksample vs. Markout</p>
<ul>
<li><code>marksample</code> es mejor que <code>mark</code>. Disminuye la probabilidad de que se olvide alguna restricción.</li>
<li><code>markout</code> puede ser utilizados después de <code>mark</code> o bien <code>marksample</code>.</li>
</ul>
<div class="sourceCode" id="cb387"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb387-1"><a href="#cb387-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> ...</span>
<span id="cb387-2"><a href="#cb387-2" aria-hidden="true" tabindex="-1"></a><span class="kw">tempvar</span> touse</span>
<span id="cb387-3"><a href="#cb387-3" aria-hidden="true" tabindex="-1"></a>mark <span class="ot">`touse&#39;</span> ...</span>
<span id="cb387-4"><a href="#cb387-4" aria-hidden="true" tabindex="-1"></a><span class="kw">markout</span> <span class="ot">`touse&#39;</span> ...</span>
<span id="cb387-5"><a href="#cb387-5" aria-hidden="true" tabindex="-1"></a>rest <span class="kw">of</span> code ... <span class="kw">if</span> <span class="ot">`touse&#39;</span></span>
<span id="cb387-6"><a href="#cb387-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb387-7"><a href="#cb387-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-8"><a href="#cb387-8" aria-hidden="true" tabindex="-1"></a>prgraom myprog</span>
<span id="cb387-9"><a href="#cb387-9" aria-hidden="true" tabindex="-1"></a><span class="kw">syntax</span> <span class="kw">varlist</span> [<span class="kw">if</span>] [<span class="kw">in</span>]</span>
<span id="cb387-10"><a href="#cb387-10" aria-hidden="true" tabindex="-1"></a><span class="kw">marksample</span> touse</span>
<span id="cb387-11"><a href="#cb387-11" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb387-12"><a href="#cb387-12" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb387-13"><a href="#cb387-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-14"><a href="#cb387-14" aria-hidden="true" tabindex="-1"></a>* Equivale a: </span>
<span id="cb387-15"><a href="#cb387-15" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> myprog</span>
<span id="cb387-16"><a href="#cb387-16" aria-hidden="true" tabindex="-1"></a><span class="kw">version</span> 17.0</span>
<span id="cb387-17"><a href="#cb387-17" aria-hidden="true" tabindex="-1"></a><span class="kw">syntax</span> <span class="kw">varlist</span> [<span class="kw">if</span>] [<span class="kw">in</span>]</span>
<span id="cb387-18"><a href="#cb387-18" aria-hidden="true" tabindex="-1"></a><span class="kw">tempvar</span> touse</span>
<span id="cb387-19"><a href="#cb387-19" aria-hidden="true" tabindex="-1"></a>mark <span class="ot">`touse&#39;</span> <span class="ot">`if&#39;</span> <span class="ot">`in&#39;</span></span>
<span id="cb387-20"><a href="#cb387-20" aria-hidden="true" tabindex="-1"></a><span class="kw">markout</span> <span class="ot">`touse&#39;</span> <span class="ot">`varlist&#39;</span></span>
<span id="cb387-21"><a href="#cb387-21" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb387-22"><a href="#cb387-22" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p><code>markout</code> también puede ser usado con <code>marksample</code>:</p>
<div class="sourceCode" id="cb388"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb388-1"><a href="#cb388-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> ...</span>
<span id="cb388-2"><a href="#cb388-2" aria-hidden="true" tabindex="-1"></a><span class="kw">syntax</span> ... [, Denom(varname) ... ]</span>
<span id="cb388-3"><a href="#cb388-3" aria-hidden="true" tabindex="-1"></a><span class="kw">marksample</span> touse</span>
<span id="cb388-4"><a href="#cb388-4" aria-hidden="true" tabindex="-1"></a><span class="kw">markout</span> <span class="ot">`touse&#39;</span> <span class="ot">`denom&#39;</span></span>
<span id="cb388-5"><a href="#cb388-5" aria-hidden="true" tabindex="-1"></a>rest <span class="kw">of</span> code ... <span class="kw">if</span> <span class="ot">`touse&#39;</span></span>
<span id="cb388-6"><a href="#cb388-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p>Ejemplo Marksample y Markout:</p>
<div class="sourceCode" id="cb389"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb389-1"><a href="#cb389-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> cwsumm</span>
<span id="cb389-2"><a href="#cb389-2" aria-hidden="true" tabindex="-1"></a><span class="kw">syntax</span> [<span class="kw">varlist</span>(fv ts)] [<span class="kw">if</span>] [<span class="kw">in</span>] [<span class="kw">aweight</span> <span class="kw">fweight</span>] [, Detail noFormat]</span>
<span id="cb389-3"><a href="#cb389-3" aria-hidden="true" tabindex="-1"></a><span class="kw">marksample</span> touse</span>
<span id="cb389-4"><a href="#cb389-4" aria-hidden="true" tabindex="-1"></a><span class="kw">summarize</span> <span class="ot">`varlist&#39;</span> [<span class="ot">`weight&#39;`exp&#39;</span>] <span class="kw">if</span> <span class="ot">`touse&#39;</span>, <span class="ot">`detail&#39;</span> <span class="ot">`format&#39;</span></span>
<span id="cb389-5"><a href="#cb389-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
</div>
<div id="sortpreserve" class="section level3 hasAnchor" number="3.7.2">
<h3 class="hasAnchor"><span class="header-section-number">3.7.2</span> Sortpreserve<a href="#sortpreserve" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Si está escribiendo un programa de Stata que cambia temporalmente el orden de los datos y quieres que los datos se ordenen en su orden original al final de la ejecución, puede ahorrar un poco de programación incluyendo <code>sortpreserve</code>. Para ellos debemos escribir: <code>program miprograma, sortpreserve</code>. Stata automáticamente reordenara las variables como estaban originalmente. Al agregar esta opción se genera una variable temporal llamada <code>_sortindex</code> la que contiene el orden original de los datos.</p>
</div>
<div id="mata" class="section level3 hasAnchor" number="3.7.3">
<h3 class="hasAnchor"><span class="header-section-number">3.7.3</span> Mata<a href="#mata" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="qué-es-mata" class="section level4 hasAnchor" number="3.7.3.1">
<h4 class="hasAnchor"><span class="header-section-number">3.7.3.1</span> ¿Qué es Mata?<a href="#qué-es-mata" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Esta introducción esta basada en la guía de <a href="https://medium.com/the-stata-guide/mata-statas-end-game-5983c0ee11bd">Asjad Naqvi</a>.</p>
<ul>
<li>Mata es un lenguaje de programación matricial.</li>
<li>Es más rápido que Stata, pero necesita más precisión (ej. dimensiones de las matrices).</li>
<li>Muchos de los operadores de Mata son similares a R o Matlab. Adicionalmente, incluye sus propios optimizadores y funciones útiles.</li>
<li>Esta sección será una pequeña introducción al lenguaje. Tiene como objetivo mostrarles el abanico de herramientas que Mata posee con el fin de que puedan utilizarlo para hacer sus propios programas.</li>
</ul>
<p>La sintaxis básica de Mata</p>
<div class="sourceCode" id="cb390"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb390-1"><a href="#cb390-1" aria-hidden="true" tabindex="-1"></a>* Opción 1 </span>
<span id="cb390-2"><a href="#cb390-2" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> </span>
<span id="cb390-3"><a href="#cb390-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb390-4"><a href="#cb390-4" aria-hidden="true" tabindex="-1"></a>&lt; comando <span class="kw">de</span> <span class="kw">mata</span> 1 &gt; </span>
<span id="cb390-5"><a href="#cb390-5" aria-hidden="true" tabindex="-1"></a>&lt; comando <span class="kw">de</span> <span class="kw">mata</span> 2 &gt;</span>
<span id="cb390-6"><a href="#cb390-6" aria-hidden="true" tabindex="-1"></a>&lt; <span class="fu">y</span> así .... &gt; </span>
<span id="cb390-7"><a href="#cb390-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> </span>
<span id="cb390-8"><a href="#cb390-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb390-9"><a href="#cb390-9" aria-hidden="true" tabindex="-1"></a>* Opción 2 </span>
<span id="cb390-10"><a href="#cb390-10" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> &lt;un comando <span class="kw">de</span> <span class="kw">mata</span>&gt;</span>
<span id="cb390-11"><a href="#cb390-11" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb390-12"><a href="#cb390-12" aria-hidden="true" tabindex="-1"></a>* Opción 3 : la versión estricta</span>
<span id="cb390-13"><a href="#cb390-13" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span>: &lt;un comando <span class="kw">de</span> <span class="kw">mata</span>&gt; </span>
<span id="cb390-14"><a href="#cb390-14" aria-hidden="true" tabindex="-1"></a>  </span></code></pre></div>
<p>Si son utilizados dos puntos y <strong>ocurre</strong> un error, Mata será abortado, volverá a Stata y aparecerá un mensaje de error.</p>
<div class="sourceCode" id="cb391"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb391-1"><a href="#cb391-1" aria-hidden="true" tabindex="-1"></a>* Ejemplo 1</span>
<span id="cb391-2"><a href="#cb391-2" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> </span>
<span id="cb391-3"><a href="#cb391-3" aria-hidden="true" tabindex="-1"></a>emat = 7 + 3</span>
<span id="cb391-4"><a href="#cb391-4" aria-hidden="true" tabindex="-1"></a>emat </span>
<span id="cb391-5"><a href="#cb391-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb391-6"><a href="#cb391-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb391-7"><a href="#cb391-7" aria-hidden="true" tabindex="-1"></a>* Ejemplo 2</span>
<span id="cb391-8"><a href="#cb391-8" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> </span>
<span id="cb391-9"><a href="#cb391-9" aria-hidden="true" tabindex="-1"></a>emat = (<span class="st">&quot;Josefa&quot;</span>, <span class="st">&quot;Perez&quot;</span>)</span>
<span id="cb391-10"><a href="#cb391-10" aria-hidden="true" tabindex="-1"></a>emat = (21\8)</span>
<span id="cb391-11"><a href="#cb391-11" aria-hidden="true" tabindex="-1"></a>mmat = (17\6)</span>
<span id="cb391-12"><a href="#cb391-12" aria-hidden="true" tabindex="-1"></a>vmat = (25,3\3,11)</span>
<span id="cb391-13"><a href="#cb391-13" aria-hidden="true" tabindex="-1"></a>emat, mmat, vmat </span>
<span id="cb391-14"><a href="#cb391-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p>Para buscar ayuda, podemos hacer:</p>
<div class="sourceCode" id="cb392"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb392-1"><a href="#cb392-1" aria-hidden="true" tabindex="-1"></a>* Ejemplo 1</span>
<span id="cb392-2"><a href="#cb392-2" aria-hidden="true" tabindex="-1"></a><span class="kw">help</span> <span class="kw">mata</span> comando</span>
<span id="cb392-3"><a href="#cb392-3" aria-hidden="true" tabindex="-1"></a><span class="kw">help</span> <span class="kw">mata</span> <span class="fu">cholesky</span>()</span></code></pre></div>
<p>Comandos básicos:Al igual que Stata, Mata posee sus propios comandos. Algunos útiles de recordar son:</p>
<div class="sourceCode" id="cb393"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb393-1"><a href="#cb393-1" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> <span class="kw">describe</span> </span>
<span id="cb393-2"><a href="#cb393-2" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> <span class="kw">clear</span> </span>
<span id="cb393-3"><a href="#cb393-3" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> <span class="kw">rename</span> nombre</span>
<span id="cb393-4"><a href="#cb393-4" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> <span class="kw">drop</span> nombre1 nombre2</span>
<span id="cb393-5"><a href="#cb393-5" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> stata</span>
<span id="cb393-6"><a href="#cb393-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb393-7"><a href="#cb393-7" aria-hidden="true" tabindex="-1"></a>* Ejemplo</span>
<span id="cb393-8"><a href="#cb393-8" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> </span>
<span id="cb393-9"><a href="#cb393-9" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> <span class="kw">clear</span> </span>
<span id="cb393-10"><a href="#cb393-10" aria-hidden="true" tabindex="-1"></a>emat = (<span class="st">&quot;Josefa&quot;</span>, <span class="st">&quot;Perez&quot;</span>)</span>
<span id="cb393-11"><a href="#cb393-11" aria-hidden="true" tabindex="-1"></a>emat = (21\8)</span>
<span id="cb393-12"><a href="#cb393-12" aria-hidden="true" tabindex="-1"></a>mmat = (17\6)</span>
<span id="cb393-13"><a href="#cb393-13" aria-hidden="true" tabindex="-1"></a>vmat = (25,3\3,11)</span>
<span id="cb393-14"><a href="#cb393-14" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> <span class="kw">describe</span> </span>
<span id="cb393-15"><a href="#cb393-15" aria-hidden="true" tabindex="-1"></a>emat, mmat, vmat</span>
<span id="cb393-16"><a href="#cb393-16" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> <span class="kw">rename</span> vmat vmat_renombrada</span>
<span id="cb393-17"><a href="#cb393-17" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> <span class="kw">drop</span> mmat</span>
<span id="cb393-18"><a href="#cb393-18" aria-hidden="true" tabindex="-1"></a>emat, vmat_renombrada</span>
<span id="cb393-19"><a href="#cb393-19" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p><strong>Para hacer comentarios</strong> en Mata hay que utilizar <code>//</code>. No funcionan los asteriscos como en Stata. Todo los que se genera en Mata queda en la memoria a menos que Stata se cierre, se use <code>clear all</code>en Stata o bien <code>mata: mata clear</code>. Todas las matrices y funciones definidas se mantienen en el espacio de trabajo de Mata espacio de trabajo cuando se termina mata y se puede acceder a ellas cuando se vuelve a entrar en
mata.</p>
</div>
<div id="matrices-2" class="section level4 hasAnchor" number="3.7.3.2">
<h4 class="hasAnchor"><span class="header-section-number">3.7.3.2</span> Matrices<a href="#matrices-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Una forma común de generar una matriz en Mata es importándola desde los datos de Stata.</p>
<div class="sourceCode" id="cb394"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb394-1"><a href="#cb394-1" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span>: X = st_data(.,(<span class="st">&quot;var1&quot;</span>, <span class="st">&quot;var2&quot;</span>))</span></code></pre></div>
<p>Definimos la matriz X, que tiene todas las observaciones (filas) y dos columnas <code>var1</code> y <code>var2</code>. <code>st_</code> permite a Mata interactuar con la interfaz de Stata con el fin de pasar información de un lado a otro. Revisar <code>help m4_stata</code>.</p>
<div class="sourceCode" id="cb395"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb395-1"><a href="#cb395-1" aria-hidden="true" tabindex="-1"></a>* Ejemplo 4: confeccionar matrices en base a <span class="kw">mata</span></span>
<span id="cb395-2"><a href="#cb395-2" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto.dta</span>
<span id="cb395-3"><a href="#cb395-3" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span></span>
<span id="cb395-4"><a href="#cb395-4" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> <span class="kw">clear</span> </span>
<span id="cb395-5"><a href="#cb395-5" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span>: X = st_data(.,(<span class="st">&quot;price&quot;</span>, <span class="st">&quot;mpg&quot;</span>))</span>
<span id="cb395-6"><a href="#cb395-6" aria-hidden="true" tabindex="-1"></a>X</span>
<span id="cb395-7"><a href="#cb395-7" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> <span class="kw">describe</span></span>
<span id="cb395-8"><a href="#cb395-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> </span></code></pre></div>
<p>Otra opción es definir matrices dentro de Mata.</p>
<div class="sourceCode" id="cb396"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb396-1"><a href="#cb396-1" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> A = (1,2 \ 3,4)</span></code></pre></div>
<p>Definimos la matriz A, la cual podemos ver escribiendo <code>mata A</code>. Veremos una matriz cuadrada de 2x2. Notar que la coma separa elementos <strong>entre columnas</strong> mientras que el <em>slash</em> mueve elementos <strong>entre filas</strong>. El uso de paréntesis es opcional en Mata, pero es más conveniente y es una buena práctica de estilo utilizarlos. También se pueden definir matrices especiales.</p>
<div class="sourceCode" id="cb397"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb397-1"><a href="#cb397-1" aria-hidden="true" tabindex="-1"></a>* Vector fila o Vector columna</span>
<span id="cb397-2"><a href="#cb397-2" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> 1,2,3</span>
<span id="cb397-3"><a href="#cb397-3" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> 1\2\3</span>
<span id="cb397-4"><a href="#cb397-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb397-5"><a href="#cb397-5" aria-hidden="true" tabindex="-1"></a>* Vector fila o Vector columna del 1 al 4</span>
<span id="cb397-6"><a href="#cb397-6" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> 1..4</span>
<span id="cb397-7"><a href="#cb397-7" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> 1::4</span></code></pre></div>
<p>Finalmente, uno puede generar matrices similar a lo que se hace en Stata.</p>
<div class="sourceCode" id="cb398"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb398-1"><a href="#cb398-1" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> <span class="fu">J</span>(2,2,1)</span></code></pre></div>
<p>Este comando genera una matriz de 2x2 rellena de unos. La sintaxis genérica es: <code>mata J(filas, columnas, constante)</code>. Para definir una matriz identidad: <code>mata I(5)</code>.</p>
<p>Otro operador útil es <code>range</code>:</p>
<div class="sourceCode" id="cb399"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb399-1"><a href="#cb399-1" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> <span class="kw">range</span>(1,7,2)</span></code></pre></div>
<p>Crea un vector que empieza en 1 y termina en 7 saltándose de 2 en 2 (es decir, <code>(1,3,5,7)</code>). Si quiero generar una matriz con números aleatorios provenientes de una distribución uniforme (0,1) : <code>mata runiform(3,3)</code>.</p>
<p>Accediendo a los elementos de una matriz</p>
<ul>
<li>Podemos acceder a los elementos de una matriz.
<ul>
<li><code>mata A[1,2]</code>: fila 1, columna 2.</li>
<li><code>mata A[1,.]</code>: <strong>Todas las columnas</strong> de la fila 1.</li>
<li><code>mata A[.,2]</code>: <strong>Todas las filas</strong> de la columna 2.</li>
</ul></li>
<li>También podemos extraer sub-conjuntos de elementos:</li>
</ul>
<div class="sourceCode" id="cb400"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb400-1"><a href="#cb400-1" aria-hidden="true" tabindex="-1"></a>* Empezar <span class="kw">de</span> fila 2 columna 1 hasta fila 3 columna 3</span>
<span id="cb400-2"><a href="#cb400-2" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> A[|2,1\3,3|]       </span>
<span id="cb400-3"><a href="#cb400-3" aria-hidden="true" tabindex="-1"></a>* Tomar filas 2 <span class="fu">y</span> 3 <span class="fu">y</span> columnas <span class="kw">de</span> la 1 a la 3.</span>
<span id="cb400-4"><a href="#cb400-4" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> A[(2::3),(1..3)]   </span></code></pre></div>
<p>Pegando elementos de matrices:</p>
<div class="sourceCode" id="cb401"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb401-1"><a href="#cb401-1" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span></span>
<span id="cb401-2"><a href="#cb401-2" aria-hidden="true" tabindex="-1"></a>A = runiform(1,2)</span>
<span id="cb401-3"><a href="#cb401-3" aria-hidden="true" tabindex="-1"></a>B = runiform(1,2)</span>
<span id="cb401-4"><a href="#cb401-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb401-5"><a href="#cb401-5" aria-hidden="true" tabindex="-1"></a>* Opción 1 : pegar horizontalmente</span>
<span id="cb401-6"><a href="#cb401-6" aria-hidden="true" tabindex="-1"></a>A,B   </span>
<span id="cb401-7"><a href="#cb401-7" aria-hidden="true" tabindex="-1"></a>* Opción 2 : pegar verticalmente</span>
<span id="cb401-8"><a href="#cb401-8" aria-hidden="true" tabindex="-1"></a>A\B   </span>
<span id="cb401-9"><a href="#cb401-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p><code>A,B</code> las pega horizontalmente, es decir por columnas (filas son las mismas). <code>A\B</code> las pega vertical, es decir por filas (columnas son las mismas).</p>
<p>Operaciones básicas entre matrices y por elementos: Una vez definidas las matrices, también se dedica bastante tiempo a sumar, restar, multiplicar y dividir matrices entre sí. Vamos a ver algunas operaciones entre matrices y también entre elementos.</p>
<div class="sourceCode" id="cb402"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb402-1"><a href="#cb402-1" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span></span>
<span id="cb402-2"><a href="#cb402-2" aria-hidden="true" tabindex="-1"></a> A = (1,2,3\4,5,6)</span>
<span id="cb402-3"><a href="#cb402-3" aria-hidden="true" tabindex="-1"></a> B = (2,3\4,5\6,7)</span>
<span id="cb402-4"><a href="#cb402-4" aria-hidden="true" tabindex="-1"></a> A * B</span>
<span id="cb402-5"><a href="#cb402-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p><code>A * B</code> es una operación entre matrices, de forma tal que el número de filas de A debe ser igual al número de columnas de B. Si queremos que cada elemento de A sea multiplicado por el mismo elemento en B, es necesario trasponer alguna matriz y cambiar el operador.</p>
<div class="sourceCode" id="cb403"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb403-1"><a href="#cb403-1" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span></span>
<span id="cb403-2"><a href="#cb403-2" aria-hidden="true" tabindex="-1"></a> A = (1,2,3\4,5,6)</span>
<span id="cb403-3"><a href="#cb403-3" aria-hidden="true" tabindex="-1"></a> B = (2,3\4,5\6,7)</span>
<span id="cb403-4"><a href="#cb403-4" aria-hidden="true" tabindex="-1"></a>  A&#39; :* B</span>
<span id="cb403-5"><a href="#cb403-5" aria-hidden="true" tabindex="-1"></a>  A  :* B&#39;</span>
<span id="cb403-6"><a href="#cb403-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p>En el primer caso la matriz resultante corresponde a una matriz de 3x2, en el segundo caso es una matriz de 2x3.</p>
<p>Operadores lógicos y funciones sobre escalares: Las matrices también pueden ser comparadas a través de operadores lógicos. <code>A == B</code> chequea si dos matrices son iguales. Esto también puede hacerse elemento por elemento (por ejemplo <code>A:&gt;=B</code>). Tambien se puede utilizar <code>!=</code>.</p>
<p>Mata también tiene funciones sobre escalares:</p>
<div class="sourceCode" id="cb404"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb404-1"><a href="#cb404-1" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span></span>
<span id="cb404-2"><a href="#cb404-2" aria-hidden="true" tabindex="-1"></a>  X = (-2, 1 \ 0, 5)</span>
<span id="cb404-3"><a href="#cb404-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abs</span>(X)   <span class="co">// valor absoluto de cada elemento</span></span>
<span id="cb404-4"><a href="#cb404-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sign</span>(X)  <span class="co">// signo de cada elemento</span></span>
<span id="cb404-5"><a href="#cb404-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">exp</span>(X)   <span class="co">// exponencial de cada elemento</span></span>
<span id="cb404-6"><a href="#cb404-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sqrt</span>(X)  <span class="co">// raíz cuadrada de cada elemento</span></span>
<span id="cb404-7"><a href="#cb404-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sin</span>(X)   <span class="co">// seno de cada elemento</span></span>
<span id="cb404-8"><a href="#cb404-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p>Algunas funciones para operar en matrices son:</p>
<div class="sourceCode" id="cb405"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb405-1"><a href="#cb405-1" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span></span>
<span id="cb405-2"><a href="#cb405-2" aria-hidden="true" tabindex="-1"></a>A = (5,4\6,7)</span>
<span id="cb405-3"><a href="#cb405-3" aria-hidden="true" tabindex="-1"></a>B = (1,6\3,2)</span>
<span id="cb405-4"><a href="#cb405-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb405-5"><a href="#cb405-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb405-6"><a href="#cb405-6" aria-hidden="true" tabindex="-1"></a>* Número <span class="kw">de</span> filas <span class="fu">y</span> columnas </span>
<span id="cb405-7"><a href="#cb405-7" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> <span class="bn">rows</span>(A)</span>
<span id="cb405-8"><a href="#cb405-8" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> <span class="bn">cols</span>(A)</span>
<span id="cb405-9"><a href="#cb405-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb405-10"><a href="#cb405-10" aria-hidden="true" tabindex="-1"></a>* Suma <span class="kw">de</span> las filas/columnas</span>
<span id="cb405-11"><a href="#cb405-11" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> rowsum(B)</span>
<span id="cb405-12"><a href="#cb405-12" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> colsum(B)</span>
<span id="cb405-13"><a href="#cb405-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb405-14"><a href="#cb405-14" aria-hidden="true" tabindex="-1"></a>* Calcular <span class="fu">el</span> promedio (retorna un <span class="kw">vector</span> fila)</span>
<span id="cb405-15"><a href="#cb405-15" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> <span class="kw">mean</span>(B&#39;)&#39; </span>
<span id="cb405-16"><a href="#cb405-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb405-17"><a href="#cb405-17" aria-hidden="true" tabindex="-1"></a>* Seleccionar todas las columnas <span class="fu">sin</span> ceros</span>
<span id="cb405-18"><a href="#cb405-18" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> D = (1,0,2,3,0)</span>
<span id="cb405-19"><a href="#cb405-19" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> selectindex(D) </span>
<span id="cb405-20"><a href="#cb405-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb405-21"><a href="#cb405-21" aria-hidden="true" tabindex="-1"></a>* Select para condiciones más flexibles</span>
<span id="cb405-22"><a href="#cb405-22" aria-hidden="true" tabindex="-1"></a>select(B, B[.,1]:&gt;2)</span>
<span id="cb405-23"><a href="#cb405-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb405-24"><a href="#cb405-24" aria-hidden="true" tabindex="-1"></a>* Ordenar matrices </span>
<span id="cb405-25"><a href="#cb405-25" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> <span class="kw">sort</span>(B,2)  <span class="co">// Ordena según la columna 2 de B</span></span>
<span id="cb405-26"><a href="#cb405-26" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> <span class="kw">jumble</span>(B) <span class="co">// Aleatoriza las filas de B</span></span></code></pre></div>
<p>Mata contiene varias funciones para extraer propiedades de las matrices:</p>
<div class="sourceCode" id="cb406"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb406-1"><a href="#cb406-1" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span></span>
<span id="cb406-2"><a href="#cb406-2" aria-hidden="true" tabindex="-1"></a>A = (5,4\6,7)</span>
<span id="cb406-3"><a href="#cb406-3" aria-hidden="true" tabindex="-1"></a><span class="fu">det</span>(A)         <span class="co">// Determinante de A</span></span>
<span id="cb406-4"><a href="#cb406-4" aria-hidden="true" tabindex="-1"></a><span class="fu">invsym</span>(A)      <span class="co">// Ibversa de A</span></span>
<span id="cb406-5"><a href="#cb406-5" aria-hidden="true" tabindex="-1"></a><span class="fu">trace</span>(A)       <span class="co">// Traza de A</span></span>
<span id="cb406-6"><a href="#cb406-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rank</span>(A)        <span class="co">// Rango de A</span></span>
<span id="cb406-7"><a href="#cb406-7" aria-hidden="true" tabindex="-1"></a><span class="fu">norm</span>(A)        <span class="co">// Norma de A</span></span>
<span id="cb406-8"><a href="#cb406-8" aria-hidden="true" tabindex="-1"></a>X=.            <span class="co">// Vectores propios</span></span>
<span id="cb406-9"><a href="#cb406-9" aria-hidden="true" tabindex="-1"></a>L=.            <span class="co">// Valores propios</span></span>
<span id="cb406-10"><a href="#cb406-10" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p>Mata contiene varias funciones para operar o manipular dos matrices:</p>
<div class="sourceCode" id="cb407"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb407-1"><a href="#cb407-1" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span></span>
<span id="cb407-2"><a href="#cb407-2" aria-hidden="true" tabindex="-1"></a>A = (5,4\6,7)</span>
<span id="cb407-3"><a href="#cb407-3" aria-hidden="true" tabindex="-1"></a>B = (1,6\3,2)</span>
<span id="cb407-4"><a href="#cb407-4" aria-hidden="true" tabindex="-1"></a>A&#39; * B            <span class="co">// A x B</span></span>
<span id="cb407-5"><a href="#cb407-5" aria-hidden="true" tabindex="-1"></a><span class="kw">cross</span>(A,B)        <span class="co">// A x B using a solver (faster)</span></span>
<span id="cb407-6"><a href="#cb407-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p>Al igual que Stata, Mata puede utilizar iteradores. While loop:</p>
<div class="sourceCode" id="cb408"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb408-1"><a href="#cb408-1" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span></span>
<span id="cb408-2"><a href="#cb408-2" aria-hidden="true" tabindex="-1"></a>  x = 1                  <span class="co">// Valor inicial</span></span>
<span id="cb408-3"><a href="#cb408-3" aria-hidden="true" tabindex="-1"></a>  X = 4                  <span class="co">// Valor final</span></span>
<span id="cb408-4"><a href="#cb408-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">while</span> (x &lt;= X) {       <span class="co">// Iniciar condición del while</span></span>
<span id="cb408-5"><a href="#cb408-5" aria-hidden="true" tabindex="-1"></a>  printf(<span class="st">&quot;\%g </span><span class="ch">\n</span><span class="st">&quot;</span>, x)     <span class="co">// Alguna operación de Mata aquí</span></span>
<span id="cb408-6"><a href="#cb408-6" aria-hidden="true" tabindex="-1"></a>  x++                    <span class="co">// Incremental</span></span>
<span id="cb408-7"><a href="#cb408-7" aria-hidden="true" tabindex="-1"></a>  }                      <span class="co">// Terminar el while</span></span>
<span id="cb408-8"><a href="#cb408-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p>For Loops:</p>
<div class="sourceCode" id="cb409"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb409-1"><a href="#cb409-1" aria-hidden="true" tabindex="-1"></a>* Este <span class="kw">for</span></span>
<span id="cb409-2"><a href="#cb409-2" aria-hidden="true" tabindex="-1"></a><span class="kw">for</span> (expr1; expr2; expr3) {</span>
<span id="cb409-3"><a href="#cb409-3" aria-hidden="true" tabindex="-1"></a>stmts</span>
<span id="cb409-4"><a href="#cb409-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb409-5"><a href="#cb409-5" aria-hidden="true" tabindex="-1"></a>* Es equivalente a </span>
<span id="cb409-6"><a href="#cb409-6" aria-hidden="true" tabindex="-1"></a>expr1</span>
<span id="cb409-7"><a href="#cb409-7" aria-hidden="true" tabindex="-1"></a><span class="kw">while</span> (expr2) {</span>
<span id="cb409-8"><a href="#cb409-8" aria-hidden="true" tabindex="-1"></a>stmt</span>
<span id="cb409-9"><a href="#cb409-9" aria-hidden="true" tabindex="-1"></a>expr3</span>
<span id="cb409-10"><a href="#cb409-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Los valores iniciales y finales pueden extraerse de algunas declaraciones condicionales como las dimensiones de las matrices. Mata sólo permite incrementos de 1.</p>
<p>Notar que aquí es bien distinto a Stata:</p>
<div class="sourceCode" id="cb410"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb410-1"><a href="#cb410-1" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span></span>
<span id="cb410-2"><a href="#cb410-2" aria-hidden="true" tabindex="-1"></a>   <span class="kw">N</span> = 4                      <span class="co">// Valor final</span></span>
<span id="cb410-3"><a href="#cb410-3" aria-hidden="true" tabindex="-1"></a>   <span class="kw">for</span> (i=1; i&lt;=<span class="kw">N</span>; i++) {     <span class="co">// for loop </span></span>
<span id="cb410-4"><a href="#cb410-4" aria-hidden="true" tabindex="-1"></a>   printf(<span class="st">&quot;%g </span><span class="ch">\n</span><span class="st">&quot;</span>, i)         <span class="co">// some Mata operation here</span></span>
<span id="cb410-5"><a href="#cb410-5" aria-hidden="true" tabindex="-1"></a>   }                          <span class="co">// end for loop</span></span>
<span id="cb410-6"><a href="#cb410-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p>If/else son:</p>
<div class="sourceCode" id="cb411"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb411-1"><a href="#cb411-1" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span></span>
<span id="cb411-2"><a href="#cb411-2" aria-hidden="true" tabindex="-1"></a> x = 3                       <span class="co">// Valor de x</span></span>
<span id="cb411-3"><a href="#cb411-3" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb411-4"><a href="#cb411-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">for</span> (i=1; i&lt;=5; i++) {     <span class="co">// Empezar el loop</span></span>
<span id="cb411-5"><a href="#cb411-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> (x &gt; i) {             <span class="co">// if</span></span>
<span id="cb411-6"><a href="#cb411-6" aria-hidden="true" tabindex="-1"></a>      printf(<span class="st">&quot;\%g</span><span class="ch">\n</span><span class="st">&quot;</span>, 0)      <span class="co">// Comando de mata si la condición se cumple</span></span>
<span id="cb411-7"><a href="#cb411-7" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb411-8"><a href="#cb411-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">else</span> {                   <span class="co">//  en caso contrario</span></span>
<span id="cb411-9"><a href="#cb411-9" aria-hidden="true" tabindex="-1"></a>      printf(<span class="st">&quot;\%g</span><span class="ch">\n</span><span class="st">&quot;</span>, 1)      <span class="co">// ejecutar este comando de mata</span></span>
<span id="cb411-10"><a href="#cb411-10" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb411-11"><a href="#cb411-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb411-12"><a href="#cb411-12" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p>Mata también permite abreviar la sintaxis en caso de que existan dos o mas condiciones.</p>
<div class="sourceCode" id="cb412"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb412-1"><a href="#cb412-1" aria-hidden="true" tabindex="-1"></a>(a ? b : c)</span></code></pre></div>
<p>“a” es la condición, “b” es el valor en caso de que sea verdadero y “c” en caso de que sea falsa. Para el ejemplo, la condición sería: <code>(x &gt; i ? 1 : 0)</code>.</p>
</div>
<div id="de-stata-a-mata" class="section level4 hasAnchor" number="3.7.3.3">
<h4 class="hasAnchor"><span class="header-section-number">3.7.3.3</span> De Stata a Mata<a href="#de-stata-a-mata" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Estimar un MCO: Un ejemplo estándar es hacer un simple OLS en Mata.</p>
<div class="sourceCode" id="cb413"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb413-1"><a href="#cb413-1" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto, <span class="kw">clear</span></span>
<span id="cb413-2"><a href="#cb413-2" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span></span>
<span id="cb413-3"><a href="#cb413-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">y</span> = st_data(.,<span class="st">&quot;price&quot;</span>)</span>
<span id="cb413-4"><a href="#cb413-4" aria-hidden="true" tabindex="-1"></a> X = st_data(.,(<span class="st">&quot;mpg&quot;</span>, <span class="st">&quot;weight&quot;</span>))</span>
<span id="cb413-5"><a href="#cb413-5" aria-hidden="true" tabindex="-1"></a> X = X, <span class="fu">J</span>(<span class="bn">rows</span>(X),1,1)</span>
<span id="cb413-6"><a href="#cb413-6" aria-hidden="true" tabindex="-1"></a>    beta   = <span class="fu">invsym</span>(<span class="kw">cross</span>(X,X))*<span class="kw">cross</span>(X,<span class="fu">y</span>)</span>
<span id="cb413-7"><a href="#cb413-7" aria-hidden="true" tabindex="-1"></a>    esq    = (<span class="fu">y</span> - X*beta) :^ 2</span>
<span id="cb413-8"><a href="#cb413-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">V</span>      = (<span class="kw">sum</span>(esq)/(<span class="bn">rows</span>(X)-<span class="bn">cols</span>(X)))*<span class="fu">invsym</span>(<span class="kw">cross</span>(X,X))</span>
<span id="cb413-9"><a href="#cb413-9" aria-hidden="true" tabindex="-1"></a>    stderr = <span class="fu">sqrt</span>(diagonal(<span class="kw">V</span>))</span>
<span id="cb413-10"><a href="#cb413-10" aria-hidden="true" tabindex="-1"></a>      st_matrix(<span class="st">&quot;b&quot;</span>, beta)</span>
<span id="cb413-11"><a href="#cb413-11" aria-hidden="true" tabindex="-1"></a>      st_matrix(<span class="st">&quot;se&quot;</span>, stderr)</span>
<span id="cb413-12"><a href="#cb413-12" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p>For Loops</p>
<ul>
<li>En Mata, la variable dependiente se importa como el vector y las variables independientes se importan como la matriz X. A esta matriz X se le añade un vector columna de unos para el intercepto.</li>
<li>Como el vector de unos debe tener el mismo número de filas que la matriz X, nótese el uso del operador J().</li>
<li>En el último paso, las betas y los errores estándar se exportan a Stata como matrices de Stata.</li>
</ul>
</div>
<div id="funciones-en-mata" class="section level4 hasAnchor" number="3.7.3.4">
<h4 class="hasAnchor"><span class="header-section-number">3.7.3.4</span> Funciones en Mata<a href="#funciones-en-mata" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Vector: Un ejemplo estándar es hacer un simple OLS en Mata.</p>
<div class="sourceCode" id="cb414"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb414-1"><a href="#cb414-1" aria-hidden="true" tabindex="-1"></a>* Generar un <span class="kw">vector</span> </span>
<span id="cb414-2"><a href="#cb414-2" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> </span>
<span id="cb414-3"><a href="#cb414-3" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> zeros(c)</span>
<span id="cb414-4"><a href="#cb414-4" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb414-5"><a href="#cb414-5" aria-hidden="true" tabindex="-1"></a>    a = <span class="fu">J</span>(c, 1, 0)</span>
<span id="cb414-6"><a href="#cb414-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(a)</span>
<span id="cb414-7"><a href="#cb414-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb414-8"><a href="#cb414-8" aria-hidden="true" tabindex="-1"></a>b = zeros(3)</span>
<span id="cb414-9"><a href="#cb414-9" aria-hidden="true" tabindex="-1"></a>b</span>
<span id="cb414-10"><a href="#cb414-10" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> </span></code></pre></div>
<p>Matriz:</p>
<div class="sourceCode" id="cb415"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb415-1"><a href="#cb415-1" aria-hidden="true" tabindex="-1"></a>* Generar una matriz</span>
<span id="cb415-2"><a href="#cb415-2" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> </span>
<span id="cb415-3"><a href="#cb415-3" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> zerosv1(<span class="fu">real</span> <span class="fu">scalar</span> c, <span class="fu">real</span> <span class="fu">scalar</span> <span class="fu">r</span>)</span>
<span id="cb415-4"><a href="#cb415-4" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb415-5"><a href="#cb415-5" aria-hidden="true" tabindex="-1"></a><span class="fu">real</span> <span class="fu">matrix</span> A </span>
<span id="cb415-6"><a href="#cb415-6" aria-hidden="true" tabindex="-1"></a>A = <span class="fu">J</span>(c,<span class="fu">r</span>,0)</span>
<span id="cb415-7"><a href="#cb415-7" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(A)</span>
<span id="cb415-8"><a href="#cb415-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb415-9"><a href="#cb415-9" aria-hidden="true" tabindex="-1"></a>b = zerosv1(3,2)</span>
<span id="cb415-10"><a href="#cb415-10" aria-hidden="true" tabindex="-1"></a>b</span>
<span id="cb415-11"><a href="#cb415-11" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> </span></code></pre></div>
<p>Hacer opcionales:</p>
<div class="sourceCode" id="cb416"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb416-1"><a href="#cb416-1" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> </span>
<span id="cb416-2"><a href="#cb416-2" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> zerosv2(<span class="fu">real</span> <span class="fu">scalar</span> c,| <span class="fu">real</span> <span class="fu">scalar</span> <span class="fu">r</span>)</span>
<span id="cb416-3"><a href="#cb416-3" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb416-4"><a href="#cb416-4" aria-hidden="true" tabindex="-1"></a><span class="fu">real</span> <span class="fu">matrix</span> A</span>
<span id="cb416-5"><a href="#cb416-5" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> (<span class="kw">args</span>()==1) <span class="fu">r</span> = 1</span>
<span id="cb416-6"><a href="#cb416-6" aria-hidden="true" tabindex="-1"></a>A = <span class="fu">J</span>(c, <span class="fu">r</span>, 0)</span>
<span id="cb416-7"><a href="#cb416-7" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(A)</span>
<span id="cb416-8"><a href="#cb416-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb416-9"><a href="#cb416-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> </span>
<span id="cb416-10"><a href="#cb416-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb416-11"><a href="#cb416-11" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> </span>
<span id="cb416-12"><a href="#cb416-12" aria-hidden="true" tabindex="-1"></a>zerosv2(3,2)</span>
<span id="cb416-13"><a href="#cb416-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb416-14"><a href="#cb416-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb416-15"><a href="#cb416-15" aria-hidden="true" tabindex="-1"></a><span class="kw">help</span> m2 <span class="kw">syntax</span></span></code></pre></div>
<p>Guardar:</p>
<div class="sourceCode" id="cb417"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb417-1"><a href="#cb417-1" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> </span>
<span id="cb417-2"><a href="#cb417-2" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> zerosfinal(<span class="fu">real</span> <span class="fu">scalar</span> c,| <span class="fu">real</span> <span class="fu">scalar</span> <span class="fu">r</span>)</span>
<span id="cb417-3"><a href="#cb417-3" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb417-4"><a href="#cb417-4" aria-hidden="true" tabindex="-1"></a><span class="fu">real</span> <span class="fu">matrix</span> A</span>
<span id="cb417-5"><a href="#cb417-5" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> (<span class="kw">args</span>()==1) <span class="fu">r</span> = 1</span>
<span id="cb417-6"><a href="#cb417-6" aria-hidden="true" tabindex="-1"></a>A = <span class="fu">J</span>(c, <span class="fu">r</span>, 0)</span>
<span id="cb417-7"><a href="#cb417-7" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(A)</span>
<span id="cb417-8"><a href="#cb417-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb417-9"><a href="#cb417-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb417-10"><a href="#cb417-10" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> stata cd <span class="st">&quot;\$ejercicios&quot;</span></span>
<span id="cb417-11"><a href="#cb417-11" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> mosave zerosfinal(), <span class="kw">replace</span></span>
<span id="cb417-12"><a href="#cb417-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb417-13"><a href="#cb417-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> </span></code></pre></div>
<p>Dos referencias recomendadas para profundizar en Mata:</p>
<ul>
<li>An Introduction to Stata Programming, Second Edition ()</li>
<li>The Mata Book: A Book for Serious Programmers and Those Who Want to Be ()</li>
</ul>
</div>
</div>
</div>
<div id="exportar-información" class="section level2 hasAnchor" number="3.8">
<h2 class="hasAnchor"><span class="header-section-number">3.8</span> Exportar Información<a href="#exportar-información" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Exportar información es parte importante del proceso de análisis de datos. En esta sección veremos algunas herramientas que permiten conectar los resultados del análisis hecho en Stata con los reportes que queremos crear en Word.</p>
<div id="stata-markdown" class="section level3 hasAnchor" number="3.8.1">
<h3 class="hasAnchor"><span class="header-section-number">3.8.1</span> Stata Markdown<a href="#stata-markdown" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Herramienta para crear informes que sean reproducibles y en donde los datos, códigos y operaciones están conectadas.<br />
</li>
<li>Básicamente una intersección entre texto narrativo y</li>
<li>Es posible generar informes en distintos formatos (ej. html, docx, pdf). Hoy veremos como generar un informe en Word y una presentación en HTML.</li>
<li>Stata Markdown es especialmente útil para:
<ul>
<li><strong>Informes rutinarios:</strong> Informe semanas/mensual sobre un conjunto de datos que se actualizan constantemente.</li>
<li><strong>Documentar análisis:</strong> Es posible integrar reportes intermedios en un trabajo de análisis de datos. Estos informes pueden ser de utilidad para detectar errores y para supervisión en equipos de trabajo.</li>
</ul></li>
</ul>
<p>Stata Markdown y otras herramientas similares son claves para mejorar en términos de . Algunos argumentos basados en :</p>
<ul>
<li><strong>Ayuda a documentación:</strong> En la fase de procesamiento de datos podemos describir todos los pasos utilizados para convertir los datos brutos en variables de análisis, produciendo un documento con un buen formato, más claro y legible. Es posible pensar en estos informes como productos intermedios.</li>
<li>En la fase de análisis de los datos, podemos incluir el código, explicar las razones para probar determinados modelos, incluir los resultados, las tablas y las figuras, y comentar los resultados, todo ello sin tener que cortar y pegar de forma tediosa y propensa a errores.</li>
<li>En la fase de presentación, podemos elaborar un informe centrado en los resultados, con la opción de ocultar los comandos reales utilizados para que no aparezcan en el documento final.</li>
</ul>
<p>Algunos conceptos</p>
<ul>
<li><strong>Markdown:</strong> Es un lenguaje que permite escribir documentos en texto plano. Los archivos escritos en Markdown tienen la extensión <code>md</code>.</li>
<li><strong>Stata Markdown:</strong> Es la variación especifica para Stata. Se implementa a través del comando <code>markstat</code> hecho por <a href="https://data.princeton.edu/stata/markdown">Germán Rodriguez</a>. Estos archivos tiene extensión <code>.stmd</code>.</li>
</ul>
<div id="instalación" class="section level4 hasAnchor" number="3.8.1.1">
<h4 class="hasAnchor"><span class="header-section-number">3.8.1.1</span> Instalación<a href="#instalación" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>En Stata, ejecuta estos comandos:</p>
<ul>
<li><code>ssc install</code> markstat</li>
<li><code>ssc install</code> whereis<br />
</li>
<li>Instalar padcoc desde <code>pandoc.org/installing</code></li>
<li>Decirle a <code>markstat</code> donde encontrar pandoc. En mi caso es:</li>
</ul>
<div class="sourceCode" id="cb418"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb418-1"><a href="#cb418-1" aria-hidden="true" tabindex="-1"></a>whereis pandoc <span class="st">&quot;C:\Users</span><span class="ch">\n</span><span class="st">icol\AppData\Local\Pandoc\pandoc.exe&quot;</span></span></code></pre></div>
</div>
<div id="funcionalidades" class="section level4 hasAnchor" number="3.8.1.2">
<h4 class="hasAnchor"><span class="header-section-number">3.8.1.2</span> Funcionalidades<a href="#funcionalidades" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Algunos elementos que vamos a utilizar en Stata Markdown:</p>
<ul>
<li>Ecuaciones y notación matemática utilizando (para los que lo sepan utilizar).</li>
<li>Hacer títulos y encabezados.</li>
<li>Enfatizar texto (negritas e itálicas).</li>
<li>Armas listas numeradas y no numeradas.</li>
<li>Poder mostrar líneas de código, resultados directamente de Stata. Esto incluye Mata.</li>
<li>Insertar quiebres de páginas: <code>\newpage</code>.</li>
</ul>
</div>
<div id="generar-un-documento" class="section level4 hasAnchor" number="3.8.1.3">
<h4 class="hasAnchor"><span class="header-section-number">3.8.1.3</span> Generar un documento<a href="#generar-un-documento" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Como mencionamos anteriormente es posible generar un documento de word, pdf o html que contenga todos los códigos, resultados, tablas y figuras hechas en Stata. Para generar un documento es necesario:</p>
<ul>
<li>Escribir en tu editor de códigos preferido un archivo en formato <code>stmd</code>. En nuestro caso escribiremos un archivo que se llama <code>ejemplo1.stmd</code>. Guardar el archivo en tu carpeta de trabajo.</li>
<li>Ejecutar el comando <code>markstat</code> según el tipo de archivo que desee generar. En nuestro caso será:</li>
</ul>
<div class="sourceCode" id="cb419"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb419-1"><a href="#cb419-1" aria-hidden="true" tabindex="-1"></a>markstat <span class="kw">using</span> ejemplo1, <span class="ot">strict</span> docx</span></code></pre></div>
</div>
</div>
<div id="putdocx" class="section level3 hasAnchor" number="3.8.2">
<h3 class="hasAnchor"><span class="header-section-number">3.8.2</span> Putdocx<a href="#putdocx" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>La ventaja de <code>putdocx</code> radica en que es posible personalizar un poco más las tablas. Esto permite conectar el informe final con el trabajo de análisis de datos.</p>
<div id="algunos-comandos-útiles" class="section level4 hasAnchor" number="3.8.2.1">
<h4 class="hasAnchor"><span class="header-section-number">3.8.2.1</span> Algunos comandos útiles<a href="#algunos-comandos-útiles" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Crear, pegar y guardar documentos:</p>
<ul>
<li><code>putdocx begin</code>: Crea un archivo docx para exportar.</li>
<li><code>putdocx describe</code>: Describe los contenidos de archivo.</li>
<li><code>putdocx save</code>: Guarda y cierra el archivo.</li>
<li><code>putdocx clear</code>: Cierra el archivo sin guardar.</li>
<li><code>putdocx append</code>: Combina el contenido de múltiples archivos.</li>
</ul>
<p>Insertar quiebres de páginas:
* <code>putdocx pagebreak</code>: Agrega una nueva página.
* <code>putdocx sectionbreak</code>: Agrega una nueva sección.</p>
<p>Agregar párrafos con texto e imágenes:
* <code>putdocx paragraph</code>: Agrega un nuevo párrafo.
* <code>putdocx text</code>: Agrega un bloque de texto a un párrafo.
* <code>putdocx image</code>: Agrega una imagen al párrafo.</p>
</div>
<div id="tablas" class="section level4 hasAnchor" number="3.8.2.2">
<h4 class="hasAnchor"><span class="header-section-number">3.8.2.2</span> Tablas:<a href="#tablas" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>putdocx table</code>: Crea una nueva tabla en el documento la que puede contener resultados de estimaciones, estadística descriptiva o datos.
<code>putdocx sectionbreak</code>: Agrega una nueva sección.</p>
</div>
</div>
</div>
<div id="manejo-de-grandes-bases-de-datos-en-stata" class="section level2 hasAnchor" number="3.9">
<h2 class="hasAnchor"><span class="header-section-number">3.9</span> Manejo de grandes bases de datos en Stata<a href="#manejo-de-grandes-bases-de-datos-en-stata" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="estilo-de-codificación-mejorar-velocidad-y-eficiencia" class="section level3 hasAnchor" number="3.9.1">
<h3 class="hasAnchor"><span class="header-section-number">3.9.1</span> Estilo de codificación: mejorar velocidad y eficiencia<a href="#estilo-de-codificación-mejorar-velocidad-y-eficiencia" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Esta introducción esta basada en <strong>Suggestions on Stata programming style</strong> de Nicholas J. Cox.</p>
<p>Un buen estilo de codificación es por sobre todo <strong>claridad</strong>. Lo más importante es tener una <strong>estrategia</strong> y seguirla. En esta sección nos enfocaremos en algunos consejos de codificación que nos van a permitir mejorar la velocidad y eficiencia en el uso de Stata. Este punto es especialmente relevante cuando se trabaja con grandes bases de datos. Una lista de formas básicas de <strong>aumentar la velocidad y eficiencia</strong> al manejar grandes bases de datos:</p>
<ul>
<li>Testear siempre las condiciones claves. Hacerlo lo antes posible.</li>
<li>Utilizar <code>summarize, meanonly</code> cuando solo necesite este valor. Como regla general siempre he de preguntarme si lo que estoy obteniendo es útil o no.</li>
<li>Preferir <code>foreach</code> y <code>forvalues</code> sobre <code>while</code>. Son más rápidos.<br />
</li>
<li>Evitar el uso de <code>macro shift</code>. Con muchas variables, se vuelve muy lento. Mejor ocuapar un <code>forvalues</code>.</li>
<li>Evitar siempre que sea posible iterar sobre observaciones. Mata puede ser útil en este aspecto.</li>
<li>Evite usar <code>preserve</code> si es posible. Es atractivo para el programar pero puede ser costoso en tiempo cuando se utilizan grandes bases de datos. Es bueno profundizar en el uso de <code>marksample</code> con el fin de hacer programas efectivos.</li>
<li>Las variables temporales se eliminarán automáticamente al final de un programa, pero también considere la posibilidad de eliminarlas cuando ya no sean necesarias para minimizar la sobrecarga de memoria y reducir las posibilidades de que su programa se detenga porque no hay espacio para añadir más variables.<br />
</li>
<li>Especifique el tipo de las variables temporales para minimizar la sobrecarga de memoria. Si se puede utilizar una variable de <code>bytes</code>, especifique: <code>generate bytes 'myvar'</code> en lugar de dejar que se utilice el tipo por defecto, que desperdiciaría espacio de almacenamiento.</li>
<li>Evite utilizar una variable para mantener una constante; una macro o un escalar suele ser todo lo que se necesita.</li>
</ul>
</div>
<div id="cargar-grandes-bases-de-datos" class="section level3 hasAnchor" number="3.9.2">
<h3 class="hasAnchor"><span class="header-section-number">3.9.2</span> Cargar grandes bases de datos<a href="#cargar-grandes-bases-de-datos" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Cuatro aspectos que considerar siempre que se desee cargar en Stata alguna base de datos de un tamaño considerable:</p>
<ol style="list-style-type: decimal">
<li>¿Necesita todas las variables del conjunto de datos? Si no es así, cargue sólo las variables que necesite:</li>
</ol>
<div class="sourceCode" id="cb420"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb420-1"><a href="#cb420-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> var1 var2 var3 var4 <span class="kw">using</span> data1, <span class="kw">clear</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>¿Necesita todas las observaciones del conjunto de datos? Si no es así, importe sólo las observaciones que necesite:</li>
</ol>
<div class="sourceCode" id="cb421"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb421-1"><a href="#cb421-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> data1 <span class="kw">if</span> state &lt;= 9, <span class="kw">clear</span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>¿Su conjunto de datos ocupa más espacio de almacenamiento del necesario?:</li>
</ol>
<ul>
<li>Intenta leer tu conjunto de datos poco a poco y optimizarlo.</li>
<li>Además de solo importar determinadas observaciones o variables, se optimiza el espacio de almacenamiento utilizado <code>compress</code>.</li>
<li>Es posible inspeccionar la base de datos sin cargarla.</li>
</ul>
<div class="sourceCode" id="cb422"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb422-1"><a href="#cb422-1" aria-hidden="true" tabindex="-1"></a><span class="kw">describe</span> <span class="kw">using</span> <span class="kw">data</span>.1.dta</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>¿Su conjunto de datos contiene muchas observaciones idénticas?: Debe transformar el conjunto de datos en un conjunto de datos ponderado por frecuencia.</li>
</ol>
</div>
<div id="reducir-el-uso-de-memoria" class="section level3 hasAnchor" number="3.9.3">
<h3 class="hasAnchor"><span class="header-section-number">3.9.3</span> Reducir el uso de memoria<a href="#reducir-el-uso-de-memoria" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Cuando usted trabaja con un conjunto de datos en Stata, Stata debe cargar todo el conjunto de datos en la memoria de la computadora (RAM). Afortunadamente, las computadoras portátiles de hoy tienen más memoria que la mayoría de los servidores de hace 20 años, y la mayoría de la gente nunca tiene que preocuparse por la cantidad de memoria que Stata está utilizando.</p>
<p>¿Me tengo que preocupar de la memoria?</p>
<ul>
<li>Sólo tienes que preocuparte por la memoria si el tamaño de tu conjunto de datos se aproxima a la cantidad de memoria del ordenador que utilizas, y si es mayor, definitivamente tienes un problema.</li>
<li>Si usted trabaja con grandes conjuntos de datos, debe tener cuidado: tratar de usar más memoria de la que tiene terminará mal.</li>
<li>¿Cuando es mucho?: un Laptop tipico tiene 16gb.</li>
</ul>
</div>
<div id="reducir-el-tamaño-de-la-base-de-datos" class="section level3 hasAnchor" number="3.9.4">
<h3 class="hasAnchor"><span class="header-section-number">3.9.4</span> Reducir el tamaño de la base de datos<a href="#reducir-el-tamaño-de-la-base-de-datos" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Elimina datos innecesarios. Utiliza tipos de variables pequeños: <code>help datatypes</code>. Siempre que crees una variable es una buena practica especificar el tipo de dato. Acortar cadenas o codificarlas: <code>strings</code> requieren un byte por caracteres.</p>
<p>Sin embargo, para las observaciones todas tienen el mismo tamaño. Si tengo una variable que contiene: “Si”, “No”, “No lo se”. La variable utilizara 8 bytes por observación tal como si solo tuviese “No lo se”. Si tu cambias “no lo se” por “ns”. Ahora solo se utilizaran 2 bytes por observacion. Si tu cambias a: “S”, “N”, “I” solo utilizara un byte por observación.</p>
<p>Codificar la variable de <code>string</code> como una variable númerica tambien reduce el espacio en memerio a un byte por observación. Se recomiendo agregar <code>labels</code> y trabajar los <code>string</code> de esta forma cuando sea posible.</p>
</div>
<div id="eliminar-siempre-resultados-intermedios-incluso-temporales" class="section level3 hasAnchor" number="3.9.5">
<h3 class="hasAnchor"><span class="header-section-number">3.9.5</span> Eliminar siempre resultados intermedios, incluso temporales<a href="#eliminar-siempre-resultados-intermedios-incluso-temporales" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Elimina resultados intermedios. Si creas variables para almacenar resultados intermedios, elimínelas tan pronto como haya terminado con ellas.</p>
<p>Por ejemplo, el siguiente código crea una variable llamada incomePovertyRatio sólo para poder crear una variable indicadora lowIncome que identifica a los sujetos cuyos ingresos son inferiores al 150% del nivel de pobreza</p>
<div class="sourceCode" id="cb423"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb423-1"><a href="#cb423-1" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> incomePovertyRatio = income/povertyLevel</span>
<span id="cb423-2"><a href="#cb423-2" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> lowIncome = (incomePovertyRatio &lt; 1.5)</span>
<span id="cb423-3"><a href="#cb423-3" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> incomePovertyRatio</span></code></pre></div>
<p>Debes eliminar la variable que no utilizas. Hacer esto siempre.</p>
</div>
<div id="dividir-en-trozos-cuando-sea-posible" class="section level3 hasAnchor" number="3.9.6">
<h3 class="hasAnchor"><span class="header-section-number">3.9.6</span> Dividir en trozos cuando sea posible<a href="#dividir-en-trozos-cuando-sea-posible" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Si un conjunto de datos es demasiado grande para cargarlo en la memoria, para algunas tareas puede dividirlo en un conjunto de conjuntos de datos más pequeños y trabajar con ellos de uno en uno. Puede haber una variable categórica en el conjunto de datos de tal manera que un conjunto de datos separado para cada categoría funcionaría bien, o puede dividirlo por número de observación.</p>
<p>Dividir el conjunto de datos en trozos más pequeños probablemente sólo tiene sentido si puedes reducir el tamaño de cada trozo para que al final puedas combinarlos todos en un único conjunto de datos que pueda cargarse en la memoria.</p>
</div>
<div id="sort" class="section level3 hasAnchor" number="3.9.7">
<h3 class="hasAnchor"><span class="header-section-number">3.9.7</span> Sort<a href="#sort" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>sort</code> en Stata es razonablemente eficiente: un millón de valores aleatorios pueden ponerse en orden creciente en menos de 3 segundos con <code>sort x</code>. Sin embargo, el comando no tiene una opción inversa para ordenar de mayor a menor.</p>
<p><code>gsort</code> hace una ordenación decreciente de forma ineficiente - ordena de forma creciente en x, y luego ordena de forma creciente en menos <code>_n</code>. Esencialmente está haciendo:</p>
<div class="sourceCode" id="cb424"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb424-1"><a href="#cb424-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">sort</span> x</span>
<span id="cb424-2"><a href="#cb424-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">gen</span> <span class="kw">long</span> sortvar = -<span class="dt">_n</span></span>
<span id="cb424-3"><a href="#cb424-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">sort</span> sortvar</span>
<span id="cb424-4"><a href="#cb424-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">drop</span> sortvar</span></code></pre></div>
<p>Es mejor negar por usted mismo antes de una ordenación creciente:</p>
<div class="sourceCode" id="cb425"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb425-1"><a href="#cb425-1" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> negx = -x</span>
<span id="cb425-2"><a href="#cb425-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">sort</span> negx</span></code></pre></div>
</div>
<div id="selección-de-muestra" class="section level3 hasAnchor" number="3.9.8">
<h3 class="hasAnchor"><span class="header-section-number">3.9.8</span> Selección de muestra<a href="#selección-de-muestra" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Separar la selección de variables de la inclusión. Para minimizar la cantidad de memoria utilizada, necesitamos separar la decisión de selección de la muestra de la decisión de inclusión de la variable.</p>
</div>
<div id="precaución-con-reshape" class="section level3 hasAnchor" number="3.9.9">
<h3 class="hasAnchor"><span class="header-section-number">3.9.9</span> Precaución con reshape<a href="#precaución-con-reshape" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>El comando <code>reshape</code> es inexplicablemente lento. 13 segundos por millón de observaciones en mi computadora. Es importante pensar en codificación y buscar más opciones para hacer <code>reshape</code>. Se puede escribir un archivo separado para cada año de datos, y luego concatenarlos en un largo conjunto de datos en unos 2 segundos.</p>
</div>
<div id="subexpresiones-comunes" class="section level3 hasAnchor" number="3.9.10">
<h3 class="hasAnchor"><span class="header-section-number">3.9.10</span> Subexpresiones comunes<a href="#subexpresiones-comunes" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A menudo, varias sentencias generate o replace tendrán subexpresiones comunes.</p>
<div class="sourceCode" id="cb426"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb426-1"><a href="#cb426-1" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> <span class="fu">y</span> = a <span class="kw">if</span> c==<span class="kw">d</span> &amp; <span class="fu">e</span>==f</span>
<span id="cb426-2"><a href="#cb426-2" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> x = b <span class="kw">if</span> c==<span class="kw">d</span> &amp; <span class="fu">e</span>==f</span></code></pre></div>
<p>Una mejor opcion es precalcularlo.</p>
<div class="sourceCode" id="cb427"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb427-1"><a href="#cb427-1" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> smpl = c==<span class="kw">d</span> &amp; <span class="fu">e</span>==f</span>
<span id="cb427-2"><a href="#cb427-2" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> <span class="fu">y</span> = a <span class="kw">if</span> smpl</span>
<span id="cb427-3"><a href="#cb427-3" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> x = b <span class="kw">if</span> smpl</span></code></pre></div>
</div>
<div id="recomendaciones-adicionales" class="section level3 hasAnchor" number="3.9.11">
<h3 class="hasAnchor"><span class="header-section-number">3.9.11</span> Recomendaciones Adicionales<a href="#recomendaciones-adicionales" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="collapse" class="section level4 hasAnchor" number="3.9.11.1">
<h4 class="hasAnchor"><span class="header-section-number">3.9.11.1</span> Collapse<a href="#collapse" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>collapse</code> no es muy rápido. El autor, sin duda, supuso que aunque se utilizara con grandes conjuntos de datos, no estaría dentro de una iteración. Pero a veces lo está, y puede convertirse en el paso limitante de la velocidad en un programa de larga duración. Se puede reemplazar fácilmente con código más rápido, pero el beneficio total no es tan grande como uno esperaría. Mejor ocupar <code>gtools</code>.</p>
</div>
<div id="egen" class="section level4 hasAnchor" number="3.9.11.2">
<h4 class="hasAnchor"><span class="header-section-number">3.9.11.2</span> Egen<a href="#egen" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>egen</code> tambien puede ser adecuado para que funcione más rapido. Vamos a ver un ejemplo calculando el máximo de una variable.</p>
</div>
<div id="regresiones-en-sub-grupos" class="section level4 hasAnchor" number="3.9.11.3">
<h4 class="hasAnchor"><span class="header-section-number">3.9.11.3</span> Regresiones en sub-grupos<a href="#regresiones-en-sub-grupos" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Exiten varias opciones para calcular regresiones según el tipo de datos que queramos incluir en nuestra muestra. Vamos a ver distintas opciones y ver su desempeño en bases de datos grandes.</p>
</div>
<div id="recode" class="section level4 hasAnchor" number="3.9.11.4">
<h4 class="hasAnchor"><span class="header-section-number">3.9.11.4</span> Recode<a href="#recode" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>recode</code> puede ser modificado utilizando matrices. Otra opción es utilizar <code>ggtools</code></p>
</div>
</div>
<div id="resumen" class="section level3 hasAnchor" number="3.9.12">
<h3 class="hasAnchor"><span class="header-section-number">3.9.12</span> Resumen<a href="#resumen" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Utilizar <code>compress</code>.
</li>
<li>Mantener solo las variables que se van a utilizar.</li>
<li>Mantener solo las observaciones que se van a utilizar.</li>
<li>Cargar solo las variables y observaciones necesarias.</li>
<li><code>keepusing</code> y <code>nogen</code> siempre para <code>merge</code>.</li>
<li><code>ftools</code> y <code>gtools</code> (más detalles sección final).</li>
<li>Utilizar <code>parallel</code> (más detalles sección final).</li>
</ul>
<!--chapter:end:02-curso2.Rmd-->
</div>
</div>
</div>
<div id="análisis-de-datos-con-python" class="section level1 hasAnchor" number="4">
<h1 class="hasAnchor"><span class="header-section-number">4</span> Análisis de Datos con Python<a href="#análisis-de-datos-con-python" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="introducción-al-análisis-de-datos-con-python" class="section level2 hasAnchor" number="4.1">
<h2 class="hasAnchor"><span class="header-section-number">4.1</span> Introducción al análisis de datos con Python<a href="#introducción-al-análisis-de-datos-con-python" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>Objetivos de este curso:</strong></p>
<ul>
<li>Perderle el miedo a Python.</li>
<li>Complementar el análisis de datos utilizando las ventajas que da Python.</li>
<li>Introducirlos al programa de forma tal de que puedan ir aprendiendo cosas nuevas por su cuenta.</li>
</ul>
<p><strong>Ventajas de Python respecto a otros programas</strong></p>
<ul>
<li>Código abierto.</li>
<li>Paquetes muy potentes y en continua actualización.</li>
<li>Múltiples usos: astronomía, física, diseños sitios web, economía, análisis de datos.<br />
</li>
<li>Muy demandando en el mercado laboral.</li>
<li>Rapido e intuitivo</li>
<li>Potente con grandes bases de datos: conectar a servidores externos como Google Cloud.</li>
</ul>
<p><strong>Algunas referencias</strong>:</p>
<ol style="list-style-type: decimal">
<li><strong>The Python Data Science Handbook by Jake VanderPlas (O’Reilly)</strong>. Copyright 2016 Jake VanderPlas, 978-1-491-91205-8.</li>
</ol>
<div id="antes-de-partir-con-python" class="section level3 hasAnchor" number="4.1.1">
<h3 class="hasAnchor"><span class="header-section-number">4.1.1</span> Antes de partir con Python…<a href="#antes-de-partir-con-python" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="instalar-python-jupyter-notebook-y-spyder" class="section level4 hasAnchor" number="4.1.1.1">
<h4 class="hasAnchor"><span class="header-section-number">4.1.1.1</span> Instalar Python, Jupyter Notebook y Spyder<a href="#instalar-python-jupyter-notebook-y-spyder" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li><p>Utilizaremos Anaconda y Python 3.</p></li>
<li><p>Aunque hay varias maneras de instalar Python, la que yo sugeriría es a través de la distribución multiplataforma Anaconda. Pueden encontrarlo en la página de [Anaconda] (<a href="https://www.continuum.io/downloads" class="uri">https://www.continuum.io/downloads</a>). Incluye tanto Python y otros paquetes preinstalados orientados a la computación científica.</p></li>
<li><p>Si tuvieron algún problema con la instalación, les recomiendo ver <a href="https://www.youtube.com/watch?v=FZ5baopI_mo&amp;list=PLdxk1ngcg7fUKn1J2mpT0x0x4DuxCNXdU&amp;index=12">video.</a>. Explica detalladamente comom instalar Python con Ananconda.</p></li>
<li><p>Para programas vamos a utilizar Jupyter Notebook para algunas clases y Spyder para otras clases. Pueden instalar Spyder directamente desde el navegador de Anaconda. La idea es que se familiarizen con la interfaz de ambos programas. Jupyter Notebook es útil para trabajar interactivamente, conectarse a servidores y trabajar en equipo más sencillmente. Spyder es útil cuando trabajamos con bases de datos debido a que la interfaz permite una programación y análisis mucho más cómodos.</p></li>
<li><p><a href="https://jupyter.org/">Jupyter Notebook</a> es útil para desarrollar, compartir y generar procesos reproducibles, pero a mi me molesta no poder ver los datos. Por lo que hay ocasiones en la que prefiero utilizar Spyder, más cuando estoy haciendo algún trabajo más exploratorio.</p></li>
</ol>
</div>
<div id="markdown-para-jupyter-notebook" class="section level4 hasAnchor" number="4.1.1.2">
<h4 class="hasAnchor"><span class="header-section-number">4.1.1.2</span> Markdown para Jupyter Notebook<a href="#markdown-para-jupyter-notebook" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>Markdown es un lenguage de programación de texto plano.</li>
<li>Se puede utilizar en múltiples lenguajes de programación: por ejemplo, <strong>R Markdown y Stata Markdown</strong>.</li>
<li>Permite combinar texto plano, codificación y resultados del análisis de datos como figuras y/o tablas en un solo lugar.</li>
<li>Aprenderemos a escribir en Markdown de forma tal de mejorar la presentación de los códigos. Les servirá tambíen si es que utilzan R o Stata.</li>
<li>Es preferible ver esto al inicio de forma tal de que podamos ir incorporando esta codificación a lo largo del curso.</li>
</ol>
<p><strong>1. Títulos</strong></p>
<p>Los títulos pueden ser creados utilizando
los símbolos ‘##’. Estos símbolos determinan el tamaño del título. Van de 1 a 6.</p>
<hr />
<ol start="2" style="list-style-type: decimal">
<li><strong>Enfatizar texto</strong></li>
</ol>
<p>Para enfatizar texto tenemos las opciones más típicas</p>
<ol style="list-style-type: lower-alpha">
<li><p><code>codigo aquí</code> para escribir códigos. Lo que hacen estos símbolos es que <code>esto paresca una función o comando escrita como codigo</code>. Esto es útil si es que quieres escribir nombres de paquetes en un informe. <code>Nombre del paquete.</code> <strong>Por ejemplo</strong> paquete <code>statsmodel</code>.</p></li>
<li><p>Para utilizar <i>itálicas</i> y <u>subrayar</u>.</p></li>
<li><p>Tambien se pueden escribir de otra forma <strong>negrita</strong>, <em>negrita</em>, <em>italica</em> o bien <em>italica</em>, o bien <strong><em>negrita e itálica</em></strong> o <strong><em>negritaeitalica</em></strong>.</p></li>
<li><p><del>Para tachar texto</del></p></li>
</ol>
<hr />
<ol start="3" style="list-style-type: decimal">
<li><strong>Escribir parrafos</strong>:</li>
</ol>
<p>Para escribir parrafos tengo que colocar <code>&lt;p&gt;</code> al inicio y <code>&lt;/p&gt;</code> al final. Para hacer espacios entre parrafos simplemente presionar <code>enter</code>.
___
4. <strong>Escribir ecuaciones</strong></p>
<p>Se pueden escribir ecuaciones (para los/as que manejan Latex)</p>
<p><span class="math display">\[A = \pi*r^{2}\]</span></p>
<hr />
<ol start="5" style="list-style-type: decimal">
<li><strong>Colocar citas anidadas</strong></li>
</ol>
<blockquote>
<p>Todo lo que ponga aquí se vera como una cita
&gt; Todo lo que ponga aquí se vera como una cita
&gt;&gt; Todo lo que ponga aquí se vera como una cita</p>
</blockquote>
<ol start="6" style="list-style-type: decimal">
<li><strong>Lineas horizontales</strong></li>
</ol>
<p>Estas líneas sirven para separar los parrafos y así tener un texto mucho más ordenado.</p>
<hr />
<hr />
<hr />
<ol start="7" style="list-style-type: decimal">
<li><strong>Crear listas</strong></li>
</ol>
<p><em>Listas no ordenadas</em></p>
<ul>
<li>item 1</li>
<li>item 2</li>
<li>importante agregar un espacio entre <code>+</code>! . Sino R no lo reconocerá.</li>
<li>item 3
<ul>
<li>sub - item 1</li>
</ul></li>
</ul>
<p><em>Listas ordenadas</em></p>
<ol style="list-style-type: decimal">
<li>item 1</li>
<li>item 2</li>
</ol>
<p>Ejemplo 3: Letras no funcionan para listas</p>
<p>A. List
B. List
+ item</p>
<ol style="list-style-type: lower-alpha">
<li>List</li>
<li>List</li>
</ol>
<hr />
<p><strong>6. Agregar un link</strong></p>
<p>Opción 1: Mostrar link</p>
<p><a href="https://rmarkdown.rstudio.com/authoring_quick_tour.html#Using_Parameters" class="uri">https://rmarkdown.rstudio.com/authoring_quick_tour.html#Using_Parameters</a></p>
<p>Opción 2: Ocultar link
<a href="https://rmarkdown.rstudio.com/authoring_quick_tour.html#Using_Parameters">aquí</a></p>
<hr />
<p><strong>7. Agregar una imagen</strong></p>
<p><img src="https://www.python.org/static/community_logos/python-logo-master-v3-TM.png" /> <br></p>
<hr />
<p><strong>8. Cambiar colores de frases</strong></p>
<p><span style="color: #14F7CE;"> Cambiar el color del texto </span> <br>
<span style="color: #88BE1E;"> Tambien se puede especificar el color con códigos.</span> (<i> Nota </i>: Paletas de colores pueden encontrar ([aquí.])(<a href="https://www.colourlovers.com/" class="uri">https://www.colourlovers.com/</a>) <br>
<strong>Otros colores</strong>: blue|red|green|pink|yellow.</p>
<p><strong>9. Agregar listas de tareas</strong></p>
<ul>
<li><input type="checkbox" disabled="" checked="" />alguna tarea</li>
<li><a href="indica%20que%20buscar%20exactamente%20dentro%20de%20un%20lugar."></a> otra tarea</li>
</ul>
<p><strong>10. Tablas</strong></p>
<p>Para hacer tablas se utilizan “|” y “-”.</p>
<table>
<thead>
<tr class="header">
<th>Titulo</th>
<th>Titulo</th>
<th>Titulo</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A</td>
<td>B</td>
<td>C</td>
</tr>
<tr class="even">
<td>X</td>
<td>Y</td>
<td>Z</td>
</tr>
</tbody>
</table>
<p>Para cambiar manualmente la jusfiticación del texto:
<code>:-:</code>
1. Usar <code>:-:</code> para centrar
2. Usar <code>—</code> para la derecha
3. Usar <code>:-</code> para la izquierda</p>
<p><strong>11. Cajas de colores</strong></p>
<div class="alert alert-block alert-info">
<b>Tips:</b> Usar cajas azules para destacar cosas y/o hacer notas.
</div>
<div class="alert alert-block alert-warning">
<p><b>Ejemplos o advertencias:</b> Utilice los cuadros amarillos para los ejemplos que no están dentro de las celdas de código, o utilícelos para las fórmulas matemáticas si es necesario. Normalmente también se utiliza para mostrar mensajes de advertencia.</p>
</div>
<div class="alert alert-block alert-success">
<p><b>Algo positivo:</b> Este cuadro de alerta indica una acción exitosa o positiva.</p>
</div>
<div class="alert alert-block alert-danger">
<p><b>Peligro:</b> Este cuadro de alerta indica una acción peligrosa o potencialmente negativa.</p>
</div>
<p><strong>12. Destacar alguna línea</strong></p>
<p><code style="background:yellow;color:black">Útil para resaltar y captar la atención del lector hacia determinados puntos.</code></p>
<p><strong>13. Marcar algún texto con un color determinado</strong></p>
<p>No olvides comprar <mark>leche</mark> hoy.</p>
<p><strong>14. Menu de navegación</strong></p>
<nav>
<a href=”https://www.google.com">LinkedIn</a> |
<a href=”/css/”>Github</a> |
<a href=”/js/”>Medium</a> |
</nav>
</div>
</div>
<div id="atajos" class="section level3 hasAnchor" number="4.1.2">
<h3 class="hasAnchor"><span class="header-section-number">4.1.2</span> Atajos<a href="#atajos" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li>Muy necesarios para ganar tiempo y no duplicar tareas, por ejemplo, cambiar de Markdown a código.<br />
</li>
<li>Nos vamos a ir acostumbrando poco a poco con la práctica.</li>
</ol>
<p><strong>Para usuarios de Mac</strong></p>
<ol style="list-style-type: decimal">
<li>Ctrl: command key ⌘</li>
<li>Shift: Shift ⇧</li>
<li>Alt: option ⌥</li>
</ol>
<p><strong>Modos</strong></p>
<ol style="list-style-type: decimal">
<li><strong>Existen dos modos</strong>: <mark>comando</mark> y <mark>edición</mark>.</li>
<li>El modo de edición le permite escribir código o texto en una celda y se indica con un borde de celda verde.</li>
<li>El modo de comando vincula el teclado a los comandos del nivel del cuaderno y se indica con un borde de celda gris con un margen izquierdo azul.</li>
</ol>
<p><strong>Algunos atajos que funcionan en ambos modos</strong></p>
<ol style="list-style-type: decimal">
<li><code>Shift + Enter</code>: ejecuta la celda seleccionada y pasa a la de abajo.</li>
<li><code>Ctrl + Enter</code>: ejecuta todas las celdas seleccionadas.</li>
<li><code>Alt + Enter</code>: ejecuta una celda, pero <strong>inserta</strong> una abajo.</li>
<li><code>Ctrl + S</code>: guardar el código.</li>
</ol>
<p><strong>Atajos: modo comando (presionar <code>esc</code> para activar)</strong></p>
<ol style="list-style-type: decimal">
<li><code>H</code> : mostrar todos los accesos directos.</li>
<li><code>arriba</code>: seleccionar la celda de arriba.</li>
<li><code>abajo</code>: seleccionar la celda de abajo.</li>
<li><code>Shift + arriba</code>: extender las celdas seleccionadas arriba.</li>
<li><code>Shift + abajo</code> : extender las celdas seleccionadas por debajo.</li>
<li><code>A</code>: insertar celda arriba.</li>
<li><code>B</code>: insertar celda abajo.</li>
<li><code>X</code>: cortar las celdas seleccionadas.</li>
<li><code>C</code>: copiar celdas seleccionadas.</li>
<li><code>V</code> : pegar celdas abajo.</li>
<li><code>Shift + V</code> : pegar celdas arriba.</li>
<li><code>D</code>: (pulsar la tecla dos veces) borrar las celdas seleccionadas.</li>
<li><code>Z</code>: deshacer el borrado de celdas.</li>
<li><code>S</code>: guardar y comprobar.</li>
<li><code>Y</code>: cambiar el tipo de celda a Código.</li>
<li><code>M</code>: cambiar el tipo de celda a Markdown.</li>
<li><code>P</code>: abrir la paleta de comandos. Muy útil para ejecutar directamente atajos.</li>
<li><code>Shift + espacio</code>: desplazar el cuaderno hacia arriba.</li>
<li><code>espacio</code>: para desplazar el cuaderno hacia abajo.</li>
<li><code>Alt + enter</code>: ejecutar linea y agregar una nueva.</li>
</ol>
<p><strong>Atajos: modo edicion(presionar <code>enter</code> para activar)</strong></p>
<ol style="list-style-type: decimal">
<li><code>Esc</code> : te lleva al modo comando.</li>
<li><code>tab</code> : para completar el código o la sangría.</li>
<li><code>Ctrl + A</code>: seleccionar todo.</li>
<li><code>Ctrl + Z</code>: deshacer.</li>
<li><code>Ctrl + Y</code>: rehacer.</li>
<li><code>Ctrl + flecha izquierda</code>: ir una palabra a la izquierda.</li>
<li><code>Ctrl + flecha derecha</code>: ir una palabra a la derecha.</li>
<li><code>Ctrl + Shift + p</code> abrir la paleta de comandos.</li>
</ol>
<p><strong>Agregar tus propios atajos</strong></p>
<p>Help &gt; Edit Keyboard Shortcuts</p>
</div>
<div id="extensiones-de-jupyter-notebook" class="section level3 hasAnchor" number="4.1.3">
<h3 class="hasAnchor"><span class="header-section-number">4.1.3</span> Extensiones de Jupyter Notebook<a href="#extensiones-de-jupyter-notebook" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li>Es posible agregar caracteristicas adicionales a Jupyter Notebook.</li>
<li>Para ello inclimos en el Promp lo siguiente:</li>
</ol>
<p><code>pip install jupyter_contrib_nbextensions &amp;&amp; jupyter contrib nbextension install</code></p>
<ol start="3" style="list-style-type: decimal">
<li>Varias extensiones útiles e interesantes: índice, ocultar código, observar variables, etc.</li>
</ol>
</div>
<div id="sintaxis-básica" class="section level3 hasAnchor" number="4.1.4">
<h3 class="hasAnchor"><span class="header-section-number">4.1.4</span> Sintaxis básica<a href="#sintaxis-básica" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb428"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb428-1"><a href="#cb428-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb428-2"><a href="#cb428-2" aria-hidden="true" tabindex="-1"></a>a</span>
<span id="cb428-3"><a href="#cb428-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(a)</span>
<span id="cb428-4"><a href="#cb428-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb428-5"><a href="#cb428-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Ejemplo introductorio: vamos a ver una ejemplo sencillo, que involucra una </span></span>
<span id="cb428-6"><a href="#cb428-6" aria-hidden="true" tabindex="-1"></a><span class="co"># típica tarea de programación. </span></span>
<span id="cb428-7"><a href="#cb428-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb428-8"><a href="#cb428-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 1.Generamos una variable</span></span>
<span id="cb428-9"><a href="#cb428-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb428-10"><a href="#cb428-10" aria-hidden="true" tabindex="-1"></a>variable <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb428-11"><a href="#cb428-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb428-12"><a href="#cb428-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Generamos dos listas vacias</span></span>
<span id="cb428-13"><a href="#cb428-13" aria-hidden="true" tabindex="-1"></a>inferior <span class="op">=</span> []<span class="op">;</span> superior <span class="op">=</span> []</span>
<span id="cb428-14"><a href="#cb428-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb428-15"><a href="#cb428-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Distribuimos los números entre las dos listas</span></span>
<span id="cb428-16"><a href="#cb428-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>):</span>
<span id="cb428-17"><a href="#cb428-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (i <span class="op">&lt;</span> variable):</span>
<span id="cb428-18"><a href="#cb428-18" aria-hidden="true" tabindex="-1"></a>        inferior.append(i)</span>
<span id="cb428-19"><a href="#cb428-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb428-20"><a href="#cb428-20" aria-hidden="true" tabindex="-1"></a>        superior.append(i)</span>
<span id="cb428-21"><a href="#cb428-21" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb428-22"><a href="#cb428-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;inferior:&quot;</span>, inferior)</span>
<span id="cb428-23"><a href="#cb428-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;superior:&quot;</span>, superior)</span></code></pre></div>
<ol style="list-style-type: decimal">
<li>Comentarios marcados con #. Notar que tambíen se pueden escribir al lado derecho de los códigos.</li>
<li>Se asignan variables con <strong>signo igual</strong>. Similar a Stata, casi similar a R.</li>
<li>En Python, si quiero avanzar a la línea de abajo tengo que ocupar slach. Entre parentesis no es necesario.</li>
</ol>
<div class="sourceCode" id="cb429"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb429-1"><a href="#cb429-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Quebrar un código en dos. </span></span>
<span id="cb429-2"><a href="#cb429-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb429-3"><a href="#cb429-3" aria-hidden="true" tabindex="-1"></a><span class="co">### Sin parentesis</span></span>
<span id="cb429-4"><a href="#cb429-4" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> <span class="dv">2</span> <span class="op">+</span> <span class="dv">3</span> <span class="op">+</span> <span class="dv">4</span> <span class="op">+</span> <span class="dv">5</span> <span class="op">+</span> <span class="op">\</span></span>
<span id="cb429-5"><a href="#cb429-5" aria-hidden="true" tabindex="-1"></a>    <span class="dv">6</span> <span class="op">+</span> <span class="dv">7</span> </span>
<span id="cb429-6"><a href="#cb429-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x)</span>
<span id="cb429-7"><a href="#cb429-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb429-8"><a href="#cb429-8" aria-hidden="true" tabindex="-1"></a><span class="co">### Con parentesis </span></span>
<span id="cb429-9"><a href="#cb429-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb429-10"><a href="#cb429-10" aria-hidden="true" tabindex="-1"></a>y<span class="op">=</span> (<span class="dv">1</span> <span class="op">+</span> <span class="dv">2</span> <span class="op">+</span> <span class="dv">3</span> <span class="op">+</span> <span class="dv">4</span> <span class="op">+</span></span>
<span id="cb429-11"><a href="#cb429-11" aria-hidden="true" tabindex="-1"></a>     <span class="dv">5</span> <span class="op">+</span> <span class="dv">6</span> <span class="op">+</span> <span class="dv">7</span> <span class="op">+</span> <span class="dv">8</span>)</span>
<span id="cb429-12"><a href="#cb429-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb429-13"><a href="#cb429-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y)</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>El punto y coma puede terminar opcionalmente un enunciado. Esto es útil cuando quiero funciones y/o tareas en una línea.</li>
<li>El espacio en blanco es importante en Python. <strong>Muy importante</strong> Los bloques de código con sangría siempre van precedidos de dos puntos (:) en la línea anterior. En el ejemplo siguiente el resultado es distinto unicamente por los espacios en blanco.</li>
</ol>
<div class="sourceCode" id="cb430"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb430-1"><a href="#cb430-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ejemplo 1: los espacios en blanco importan</span></span>
<span id="cb430-2"><a href="#cb430-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb430-3"><a href="#cb430-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> x <span class="op">&lt;</span> <span class="dv">4</span>: </span>
<span id="cb430-4"><a href="#cb430-4" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> x <span class="op">*</span> <span class="dv">2</span> </span>
<span id="cb430-5"><a href="#cb430-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(x)</span>
<span id="cb430-6"><a href="#cb430-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb430-7"><a href="#cb430-7" aria-hidden="true" tabindex="-1"></a><span class="co">### Ejemplo 2: los espacios en blanco verdaderamente importan. </span></span>
<span id="cb430-8"><a href="#cb430-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb430-9"><a href="#cb430-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> x <span class="op">&lt;</span> <span class="dv">4</span>: </span>
<span id="cb430-10"><a href="#cb430-10" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> x <span class="op">*</span> <span class="dv">2</span></span>
<span id="cb430-11"><a href="#cb430-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x)</span>
<span id="cb430-12"><a href="#cb430-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb430-13"><a href="#cb430-13" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;6. A pesar de lo anterior, es importante notar que **los espacios en blanco dentro de las líneas no importan**&quot;&quot;&quot;</span></span>
<span id="cb430-14"><a href="#cb430-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb430-15"><a href="#cb430-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Los espacio en blanco el interior de una linea no importan, por ejemplo, estas tres expresiones son equivalentes: </span></span>
<span id="cb430-16"><a href="#cb430-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb430-17"><a href="#cb430-17" aria-hidden="true" tabindex="-1"></a>x<span class="op">=</span><span class="dv">1</span><span class="op">+</span><span class="dv">2</span></span>
<span id="cb430-18"><a href="#cb430-18" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> <span class="dv">2</span></span>
<span id="cb430-19"><a href="#cb430-19" aria-hidden="true" tabindex="-1"></a>z             <span class="op">=</span>        <span class="dv">1</span>    <span class="op">+</span>                <span class="dv">2</span></span>
<span id="cb430-20"><a href="#cb430-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb430-21"><a href="#cb430-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x,y,z)</span></code></pre></div>
<ol start="7" style="list-style-type: decimal">
<li>Los paréntesis son para agrupar, llamar valores o ocupar funciones.</li>
</ol>
<div class="sourceCode" id="cb431"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb431-1"><a href="#cb431-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Agrupar </span></span>
<span id="cb431-2"><a href="#cb431-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb431-3"><a href="#cb431-3" aria-hidden="true" tabindex="-1"></a>(<span class="dv">2</span> <span class="op">*</span> <span class="dv">3</span>) <span class="op">+</span> <span class="dv">3</span></span>
<span id="cb431-4"><a href="#cb431-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb431-5"><a href="#cb431-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Llamar </span></span>
<span id="cb431-6"><a href="#cb431-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb431-7"><a href="#cb431-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;valor:&quot;</span>, <span class="dv">1</span>)</span>
<span id="cb431-8"><a href="#cb431-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb431-9"><a href="#cb431-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Funciones </span></span>
<span id="cb431-10"><a href="#cb431-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb431-11"><a href="#cb431-11" aria-hidden="true" tabindex="-1"></a>L <span class="op">=</span> [<span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">1</span>]</span>
<span id="cb431-12"><a href="#cb431-12" aria-hidden="true" tabindex="-1"></a>L.sort()</span>
<span id="cb431-13"><a href="#cb431-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(L)</span>
<span id="cb431-14"><a href="#cb431-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb431-15"><a href="#cb431-15" aria-hidden="true" tabindex="-1"></a><span class="co"># El patentesis en blanco indica que la función debe ser ejecutada. </span></span>
<span id="cb431-16"><a href="#cb431-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Estos se llaman metodos, los veremos con detalle más adelante.</span></span></code></pre></div>
</div>
<div id="variables-y-objetos" class="section level3 hasAnchor" number="4.1.5">
<h3 class="hasAnchor"><span class="header-section-number">4.1.5</span> Variables y objetos<a href="#variables-y-objetos" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="escalares-1" class="section level4 hasAnchor" number="4.1.5.1">
<h4 class="hasAnchor"><span class="header-section-number">4.1.5.1</span> Escalares<a href="#escalares-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb432"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb432-1"><a href="#cb432-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Se asignan variables utilizando signo &quot;=&quot;</span></span>
<span id="cb432-2"><a href="#cb432-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb432-3"><a href="#cb432-3" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> <span class="dv">3</span> <span class="op">+</span> <span class="dv">10</span> </span>
<span id="cb432-4"><a href="#cb432-4" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> <span class="dv">4</span></span>
<span id="cb432-5"><a href="#cb432-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(a,b)</span>
<span id="cb432-6"><a href="#cb432-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb432-7"><a href="#cb432-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Luego, podemos operar con ellas y definir nuevas variables</span></span>
<span id="cb432-8"><a href="#cb432-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb432-9"><a href="#cb432-9" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> a <span class="op">**</span> b <span class="op">*</span> <span class="fl">1.002</span></span>
<span id="cb432-10"><a href="#cb432-10" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> a <span class="op">**</span> b <span class="op">*</span> <span class="fl">1.2</span></span>
<span id="cb432-11"><a href="#cb432-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(c,d)</span>
<span id="cb432-12"><a href="#cb432-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb432-13"><a href="#cb432-13" aria-hidden="true" tabindex="-1"></a>e  <span class="op">=</span> <span class="st">&quot;Hola&quot;</span></span>
<span id="cb432-14"><a href="#cb432-14" aria-hidden="true" tabindex="-1"></a>e1 <span class="op">=</span> <span class="st">&#39;Hola&#39;</span></span>
<span id="cb432-15"><a href="#cb432-15" aria-hidden="true" tabindex="-1"></a>f  <span class="op">=</span> <span class="va">True</span> </span>
<span id="cb432-16"><a href="#cb432-16" aria-hidden="true" tabindex="-1"></a>f1 <span class="op">=</span> <span class="va">False</span></span>
<span id="cb432-17"><a href="#cb432-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(e,e1,f,f1)</span>
<span id="cb432-18"><a href="#cb432-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb432-19"><a href="#cb432-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Nota: ¿Qué ocurre con los separadores de decimales?</span></span></code></pre></div>
</div>
<div id="tipos-de-escalaresvalores-en-python" class="section level4 hasAnchor" number="4.1.5.2">
<h4 class="hasAnchor"><span class="header-section-number">4.1.5.2</span> Tipos de escalares/valores en Python<a href="#tipos-de-escalaresvalores-en-python" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li><p>Existen distintos tipos de objetos en Python, para saber cuales existen podemos
utilizar <strong>type()</strong>.</p></li>
<li><p>Cada vez que escriba un () me estaré refieriendo a una función.</p></li>
</ol>
<div id="float" class="section level5 hasAnchor" number="4.1.5.2.1">
<h5 class="hasAnchor"><span class="header-section-number">4.1.5.2.1</span> Float<a href="#float" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<ul>
<li>Representa un número real. Tiene una parte entera u una fracción</li>
</ul>
<div class="sourceCode" id="cb433"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb433-1"><a href="#cb433-1" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="fl">3.14126</span> <span class="op">*</span> <span class="fl">3.1416</span> </span>
<span id="cb433-2"><a href="#cb433-2" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(n)</span></code></pre></div>
<ul>
<li>Importante tener cuidado con la precisión. Si queremos hacer algo muy preciso, es importante tener ojo con esta caracteristica del formato float.</li>
</ul>
<div class="sourceCode" id="cb434"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb434-1"><a href="#cb434-1" aria-hidden="true" tabindex="-1"></a><span class="fl">0.1</span> <span class="op">+</span> <span class="fl">0.2</span> <span class="op">==</span> <span class="fl">0.3</span></span>
<span id="cb434-2"><a href="#cb434-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb434-3"><a href="#cb434-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;0.1 = </span><span class="sc">{0:.17f}</span><span class="st">&quot;</span>.<span class="bu">format</span>(<span class="fl">0.1</span>))</span>
<span id="cb434-4"><a href="#cb434-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;0.2 = </span><span class="sc">{0:.17f}</span><span class="st">&quot;</span>.<span class="bu">format</span>(<span class="fl">0.2</span>))</span>
<span id="cb434-5"><a href="#cb434-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;0.3 = </span><span class="sc">{0:.17f}</span><span class="st">&quot;</span>.<span class="bu">format</span>(<span class="fl">0.3</span>))</span></code></pre></div>
</div>
<div id="números-complejos." class="section level5 hasAnchor" number="4.1.5.2.2">
<h5 class="hasAnchor"><span class="header-section-number">4.1.5.2.2</span> Números complejos.<a href="#números-complejos." class="anchor-section" aria-label="Anchor link to header"></a></h5>
<ul>
<li>Números con una parte real y la otra imaginaria.</li>
</ul>
<div class="sourceCode" id="cb435"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb435-1"><a href="#cb435-1" aria-hidden="true" tabindex="-1"></a><span class="bu">complex</span>(<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb435-2"><a href="#cb435-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb435-3"><a href="#cb435-3" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> <span class="dv">3</span> <span class="op">+</span> <span class="ot">4j</span></span>
<span id="cb435-4"><a href="#cb435-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb435-5"><a href="#cb435-5" aria-hidden="true" tabindex="-1"></a>c.real</span>
<span id="cb435-6"><a href="#cb435-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb435-7"><a href="#cb435-7" aria-hidden="true" tabindex="-1"></a>c.imag</span>
<span id="cb435-8"><a href="#cb435-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb435-9"><a href="#cb435-9" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(c.real)</span>
<span id="cb435-10"><a href="#cb435-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb435-11"><a href="#cb435-11" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(c)</span></code></pre></div>
</div>
<div id="integers" class="section level5 hasAnchor" number="4.1.5.2.3">
<h5 class="hasAnchor"><span class="header-section-number">4.1.5.2.3</span> Integers<a href="#integers" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<ul>
<li>Números enteros</li>
</ul>
<div class="sourceCode" id="cb436"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb436-1"><a href="#cb436-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. int: números enteros</span></span>
<span id="cb436-2"><a href="#cb436-2" aria-hidden="true" tabindex="-1"></a>dias_semana <span class="op">=</span> <span class="dv">7</span> </span>
<span id="cb436-3"><a href="#cb436-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dias_semana)</span>
<span id="cb436-4"><a href="#cb436-4" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(dias_semana)</span></code></pre></div>
</div>
<div id="boolean" class="section level5 hasAnchor" number="4.1.5.2.4">
<h5 class="hasAnchor"><span class="header-section-number">4.1.5.2.4</span> Boolean<a href="#boolean" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Variables que toman como valor verdadero o falso. Estos resultados se obtienen al utilizar comparadores. Muy importantes para programar correctamente.</p>
<div class="sourceCode" id="cb437"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb437-1"><a href="#cb437-1" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> <span class="va">True</span> </span>
<span id="cb437-2"><a href="#cb437-2" aria-hidden="true" tabindex="-1"></a>z1 <span class="op">=</span> <span class="va">False</span> </span>
<span id="cb437-3"><a href="#cb437-3" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(z)</span>
<span id="cb437-4"><a href="#cb437-4" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(z1)</span>
<span id="cb437-5"><a href="#cb437-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb437-6"><a href="#cb437-6" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> (<span class="dv">4</span> <span class="op">&lt;</span> <span class="dv">5</span>)</span>
<span id="cb437-7"><a href="#cb437-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(result)</span>
<span id="cb437-8"><a href="#cb437-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">type</span>(result))</span>
<span id="cb437-9"><a href="#cb437-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb437-10"><a href="#cb437-10" aria-hidden="true" tabindex="-1"></a><span class="co"># La función bool() tambíen sirve para crear estos objetos. </span></span>
<span id="cb437-11"><a href="#cb437-11" aria-hidden="true" tabindex="-1"></a><span class="bu">bool</span>(<span class="dv">2022</span>)</span>
<span id="cb437-12"><a href="#cb437-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb437-13"><a href="#cb437-13" aria-hidden="true" tabindex="-1"></a><span class="bu">bool</span>(<span class="dv">0</span>)</span>
<span id="cb437-14"><a href="#cb437-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb437-15"><a href="#cb437-15" aria-hidden="true" tabindex="-1"></a><span class="bu">bool</span>(<span class="va">None</span>)</span>
<span id="cb437-16"><a href="#cb437-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb437-17"><a href="#cb437-17" aria-hidden="true" tabindex="-1"></a><span class="bu">bool</span>(<span class="st">&quot;&quot;</span>)</span>
<span id="cb437-18"><a href="#cb437-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb437-19"><a href="#cb437-19" aria-hidden="true" tabindex="-1"></a><span class="bu">bool</span>(<span class="st">&quot;Nico&quot;</span>)</span></code></pre></div>
</div>
<div id="strings" class="section level5 hasAnchor" number="4.1.5.2.5">
<h5 class="hasAnchor"><span class="header-section-number">4.1.5.2.5</span> Strings<a href="#strings" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<ul>
<li>Texto. Se creo con dos comillas. Recordar que la versión “missing” en string son dos comillas sin texto.</li>
</ul>
<div class="sourceCode" id="cb438"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb438-1"><a href="#cb438-1" aria-hidden="true" tabindex="-1"></a>minombre <span class="op">=</span> <span class="st">&#39;nico&#39;</span></span>
<span id="cb438-2"><a href="#cb438-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb438-3"><a href="#cb438-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenar texto</span></span>
<span id="cb438-4"><a href="#cb438-4" aria-hidden="true" tabindex="-1"></a>texto <span class="op">=</span> <span class="st">&#39;a&#39;</span> <span class="op">+</span> <span class="st">&#39;b&#39;</span></span>
<span id="cb438-5"><a href="#cb438-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(texto)</span>
<span id="cb438-6"><a href="#cb438-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb438-7"><a href="#cb438-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Concater multiples veces </span></span>
<span id="cb438-8"><a href="#cb438-8" aria-hidden="true" tabindex="-1"></a>texto_multiplicado <span class="op">=</span> <span class="st">&quot;a&quot;</span> <span class="op">*</span> <span class="dv">10</span></span>
<span id="cb438-9"><a href="#cb438-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(texto_multiplicado)</span>
<span id="cb438-10"><a href="#cb438-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb438-11"><a href="#cb438-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Tamaño </span></span>
<span id="cb438-12"><a href="#cb438-12" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(texto)</span>
<span id="cb438-13"><a href="#cb438-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb438-14"><a href="#cb438-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Acceder a una letra en particular</span></span>
<span id="cb438-15"><a href="#cb438-15" aria-hidden="true" tabindex="-1"></a>texto[<span class="dv">0</span>]</span></code></pre></div>
<div class="alert alert-block alert-danger">
<p><b>Alerta:</b> Los distintos tipos de datos importan debido a que se comportan distinto cuando operamos con ellos.</p>
</div>
</div>
<div id="none" class="section level5 hasAnchor" number="4.1.5.2.6">
<h5 class="hasAnchor"><span class="header-section-number">4.1.5.2.6</span> None<a href="#none" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Python incluye un tipo especial <strong>NoneType</strong> que solo tiene un valor posible “None”.</p>
<div class="sourceCode" id="cb439"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb439-1"><a href="#cb439-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(<span class="va">None</span>)</span></code></pre></div>
</div>
</div>
</div>
<div id="operadores" class="section level3 hasAnchor" number="4.1.6">
<h3 class="hasAnchor"><span class="header-section-number">4.1.6</span> Operadores<a href="#operadores" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Como todo lenguaje de programación Python permite hacer operaciones de distinto tipo.</li>
</ul>
<div id="operaciones-básicas" class="section level4 hasAnchor" number="4.1.6.1">
<h4 class="hasAnchor"><span class="header-section-number">4.1.6.1</span> Operaciones básicas<a href="#operaciones-básicas" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th>Operador</th>
<th>Nombre</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>a + b</td>
<td>Suma</td>
<td>Suma de a y b</td>
</tr>
<tr class="even">
<td>a - b</td>
<td>Sustracción</td>
<td>Diferencia de a y b</td>
</tr>
<tr class="odd">
<td>a * b</td>
<td>Multiplicación</td>
<td>Producto de a y b</td>
</tr>
<tr class="even">
<td>a / b</td>
<td>División verdadera</td>
<td>Cociente de a y b</td>
</tr>
<tr class="odd">
<td>a // b</td>
<td>División mínima</td>
<td>Cociente de a y b, eliminando las partes fraccionarias</td>
</tr>
<tr class="even">
<td>a % b</td>
<td>Módulo</td>
<td>Resto entero tras la división de a entre b</td>
</tr>
<tr class="odd">
<td>a ** b</td>
<td>Exponenciación</td>
<td>a elevado a la potencia de b</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb440"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb440-1"><a href="#cb440-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Suma </span></span>
<span id="cb440-2"><a href="#cb440-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="dv">7</span> <span class="op">+</span> <span class="dv">3</span>)</span>
<span id="cb440-3"><a href="#cb440-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb440-4"><a href="#cb440-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Resta </span></span>
<span id="cb440-5"><a href="#cb440-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="dv">10</span> <span class="op">-</span> <span class="dv">2</span>)</span>
<span id="cb440-6"><a href="#cb440-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb440-7"><a href="#cb440-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Division </span></span>
<span id="cb440-8"><a href="#cb440-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="dv">5</span> <span class="op">/</span> <span class="dv">10</span>)</span>
<span id="cb440-9"><a href="#cb440-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb440-10"><a href="#cb440-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Multiplicación </span></span>
<span id="cb440-11"><a href="#cb440-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="dv">5</span> <span class="op">*</span> <span class="dv">3</span>) </span>
<span id="cb440-12"><a href="#cb440-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb440-13"><a href="#cb440-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Modulo: retorna el resto de la división entre estos dos elementos</span></span>
<span id="cb440-14"><a href="#cb440-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="dv">15</span> <span class="op">%</span> <span class="dv">7</span>)</span>
<span id="cb440-15"><a href="#cb440-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb440-16"><a href="#cb440-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. Exponencial: para elevar en potencia. Esto es distinto a R o Stata, ojo ahí. </span></span>
<span id="cb440-17"><a href="#cb440-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="dv">4</span> <span class="op">**</span> <span class="dv">10</span>)</span>
<span id="cb440-18"><a href="#cb440-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb440-19"><a href="#cb440-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 7. Incluir mensajes</span></span>
<span id="cb440-20"><a href="#cb440-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;el resultado es&quot;</span>, <span class="dv">44</span><span class="op">**</span><span class="dv">3</span>)</span>
<span id="cb440-21"><a href="#cb440-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb440-22"><a href="#cb440-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 8. División mínima </span></span>
<span id="cb440-23"><a href="#cb440-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Floor division</span></span>
<span id="cb440-24"><a href="#cb440-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="dv">11</span> <span class="op">//</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="alert alert-block alert-danger">
<p><b>Alerta:</b> La forma de hacer el exponencial en Python es distinto a R o Stata.</p>
</div>
</div>
<div id="operadores-de-asignación" class="section level4 hasAnchor" number="4.1.6.2">
<h4 class="hasAnchor"><span class="header-section-number">4.1.6.2</span> Operadores de asignación<a href="#operadores-de-asignación" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb441"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb441-1"><a href="#cb441-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Asignar valor</span></span>
<span id="cb441-2"><a href="#cb441-2" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> <span class="dv">24</span></span>
<span id="cb441-3"><a href="#cb441-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(a)</span>
<span id="cb441-4"><a href="#cb441-4" aria-hidden="true" tabindex="-1"></a>a <span class="op">+</span> <span class="dv">2</span></span>
<span id="cb441-5"><a href="#cb441-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb441-6"><a href="#cb441-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Actualizar valor</span></span>
<span id="cb441-7"><a href="#cb441-7" aria-hidden="true" tabindex="-1"></a>a <span class="op">+=</span> <span class="dv">2</span>  <span class="co"># equivalente a &quot;a = a + 2&quot;</span></span>
<span id="cb441-8"><a href="#cb441-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(a)</span></code></pre></div>
</div>
<div id="operadores-de-comparación" class="section level4 hasAnchor" number="4.1.6.3">
<h4 class="hasAnchor"><span class="header-section-number">4.1.6.3</span> Operadores de comparación<a href="#operadores-de-comparación" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<table>
<thead>
<tr class="header">
<th>Operación</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>a == b</td>
<td>a igual a b</td>
</tr>
<tr class="even">
<td>a != b</td>
<td>a no igual a b</td>
</tr>
<tr class="odd">
<td>a &lt; b</td>
<td>a menor que b</td>
</tr>
<tr class="even">
<td>a &gt; b</td>
<td>a mayor que b</td>
</tr>
<tr class="odd">
<td>a &lt;= b</td>
<td>a menor o igual que b</td>
</tr>
<tr class="even">
<td>a &gt;= b</td>
<td>a mayor o igual que b</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb442"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb442-1"><a href="#cb442-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 25 es impar</span></span>
<span id="cb442-2"><a href="#cb442-2" aria-hidden="true" tabindex="-1"></a><span class="dv">25</span> <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">1</span></span>
<span id="cb442-3"><a href="#cb442-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb442-4"><a href="#cb442-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 66 is impar</span></span>
<span id="cb442-5"><a href="#cb442-5" aria-hidden="true" tabindex="-1"></a><span class="dv">66</span> <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">1</span></span>
<span id="cb442-6"><a href="#cb442-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb442-7"><a href="#cb442-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Esta entre 15 y 30?</span></span>
<span id="cb442-8"><a href="#cb442-8" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> <span class="dv">25</span></span>
<span id="cb442-9"><a href="#cb442-9" aria-hidden="true" tabindex="-1"></a><span class="dv">15</span> <span class="op">&lt;</span> a <span class="op">&lt;</span> <span class="dv">30</span></span>
<span id="cb442-10"><a href="#cb442-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb442-11"><a href="#cb442-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Es una negativo la negación del cero? </span></span>
<span id="cb442-12"><a href="#cb442-12" aria-hidden="true" tabindex="-1"></a><span class="op">-</span><span class="dv">1</span> <span class="op">==</span> <span class="op">~</span><span class="dv">0</span></span></code></pre></div>
</div>
<div id="operadores-lógicos" class="section level4 hasAnchor" number="4.1.6.4">
<h4 class="hasAnchor"><span class="header-section-number">4.1.6.4</span> Operadores lógicos<a href="#operadores-lógicos" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Cuando se trabaja con valores booleanos, Python proporciona operadores para combinar los valores utilizando los conceptos estándar de “and”, “or” y “not”. Como es de esperar, estos operadores se expresan utilizando estas palabras.</p>
<div class="sourceCode" id="cb443"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb443-1"><a href="#cb443-1" aria-hidden="true" tabindex="-1"></a><span class="co"># y</span></span>
<span id="cb443-2"><a href="#cb443-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb443-3"><a href="#cb443-3" aria-hidden="true" tabindex="-1"></a>(x <span class="op">&lt;</span> <span class="dv">6</span>) <span class="kw">and</span> (x <span class="op">&gt;</span> <span class="dv">2</span>)</span>
<span id="cb443-4"><a href="#cb443-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb443-5"><a href="#cb443-5" aria-hidden="true" tabindex="-1"></a><span class="co"># o</span></span>
<span id="cb443-6"><a href="#cb443-6" aria-hidden="true" tabindex="-1"></a>(x <span class="op">&gt;</span> <span class="dv">10</span>) <span class="kw">or</span> (x <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span>)</span>
<span id="cb443-7"><a href="#cb443-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb443-8"><a href="#cb443-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Negación</span></span>
<span id="cb443-9"><a href="#cb443-9" aria-hidden="true" tabindex="-1"></a><span class="kw">not</span> (x <span class="op">&lt;</span> <span class="dv">6</span>)</span>
<span id="cb443-10"><a href="#cb443-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb443-11"><a href="#cb443-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Distinto a </span></span>
<span id="cb443-12"><a href="#cb443-12" aria-hidden="true" tabindex="-1"></a>(x <span class="op">&gt;</span> <span class="dv">1</span>) <span class="op">!=</span> (x <span class="op">&lt;</span> <span class="dv">10</span>)</span></code></pre></div>
</div>
<div id="operadores-de-identidad-y-afiliación" class="section level4 hasAnchor" number="4.1.6.5">
<h4 class="hasAnchor"><span class="header-section-number">4.1.6.5</span> Operadores de Identidad y Afiliación<a href="#operadores-de-identidad-y-afiliación" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<table>
<thead>
<tr class="header">
<th>Operador</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>a is b</td>
<td>Verdadero si a y b son objetos idénticos</td>
</tr>
<tr class="even">
<td>a is not b</td>
<td>Verdadero si a y b no son objetos idénticos</td>
</tr>
<tr class="odd">
<td>a in b</td>
<td>Verdadero si a es un miembro de b</td>
</tr>
<tr class="even">
<td>a not in b</td>
<td>Verdadero si a no es miembro de b</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb444"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb444-1"><a href="#cb444-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]</span>
<span id="cb444-2"><a href="#cb444-2" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]</span>
<span id="cb444-3"><a href="#cb444-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb444-4"><a href="#cb444-4" aria-hidden="true" tabindex="-1"></a>a <span class="op">==</span> b</span>
<span id="cb444-5"><a href="#cb444-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb444-6"><a href="#cb444-6" aria-hidden="true" tabindex="-1"></a>a <span class="kw">is</span> b</span>
<span id="cb444-7"><a href="#cb444-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb444-8"><a href="#cb444-8" aria-hidden="true" tabindex="-1"></a>a <span class="kw">is</span> <span class="kw">not</span> b</span>
<span id="cb444-9"><a href="#cb444-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb444-10"><a href="#cb444-10" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]</span>
<span id="cb444-11"><a href="#cb444-11" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> a</span>
<span id="cb444-12"><a href="#cb444-12" aria-hidden="true" tabindex="-1"></a>a <span class="kw">is</span> b</span>
<span id="cb444-13"><a href="#cb444-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb444-14"><a href="#cb444-14" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="kw">in</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]</span>
<span id="cb444-15"><a href="#cb444-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb444-16"><a href="#cb444-16" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="kw">not</span> <span class="kw">in</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]</span></code></pre></div>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 4.1.1: </b> Genere un vecto llamado II igual a 100, un interes igual a un 1% diario y un horizonte temporal de un año. Calcule la ganancia que tendría al final del periodo si es paciente. Finalmente, genere un mensaje que diga “Partí con”YY” y ahora tengo “XX” en ganancias, donde “YY” y “XX” son los montos.</p>
</div>
</div>
</div>
<div id="estructuras-de-datos-listas-tuplas-conjuntos-diccionarios" class="section level3 hasAnchor" number="4.1.7">
<h3 class="hasAnchor"><span class="header-section-number">4.1.7</span> Estructuras de datos: listas, tuplas, conjuntos, diccionarios<a href="#estructuras-de-datos-listas-tuplas-conjuntos-diccionarios" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>De momento hemos visto distintos tipos de variables y algunas funciones asociadas a ellas. Ahora vamos a ver estructuras que nos serás de mucha utilidad a lo largo del curso. La siguiente tabla muestra todos los tipos:</li>
</ul>
<table>
<thead>
<tr class="header">
<th>Tipo</th>
<th>Ejemplo</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>list</td>
<td>[1, 2, 3]</td>
<td>Colección ordenada</td>
</tr>
<tr class="even">
<td>tuple</td>
<td>(1, 2, 3)</td>
<td>Colección ordenada inmutable</td>
</tr>
<tr class="odd">
<td>dict</td>
<td>{‘a’:1, ‘b’:2, ‘c’:3}</td>
<td>Mapeo desordenado (clave,valor)</td>
</tr>
<tr class="even">
<td>set</td>
<td>{1, 2, 3}</td>
<td>Colección desordenada de valores únicos</td>
</tr>
</tbody>
</table>
<div id="listas-2" class="section level4 hasAnchor" number="4.1.7.1">
<h4 class="hasAnchor"><span class="header-section-number">4.1.7.1</span> Listas<a href="#listas-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>Las listas son el tipo básico de colección de datos ordenados en Python. Se pueden definir con valores separados por comas entre corchetes cuiadrados</li>
</ul>
<div class="sourceCode" id="cb445"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb445-1"><a href="#cb445-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> [<span class="fl">1.5</span>, <span class="fl">1.3</span>, <span class="fl">1.4</span>, ] </span>
<span id="cb445-2"><a href="#cb445-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(a)</span>
<span id="cb445-3"><a href="#cb445-3" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(a) <span class="co"># tamaño de la lista</span></span>
<span id="cb445-4"><a href="#cb445-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb445-5"><a href="#cb445-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Estas listas pueden incluir distintos tipos de variables en la lista, por ejemplo incluir númerico y texto </span></span>
<span id="cb445-6"><a href="#cb445-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb445-7"><a href="#cb445-7" aria-hidden="true" tabindex="-1"></a>numtext <span class="op">=</span> [<span class="st">&quot;pepe&quot;</span>, <span class="fl">1.3</span>, <span class="st">&quot;pepa&quot;</span>, <span class="fl">1.4</span>]</span>
<span id="cb445-8"><a href="#cb445-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(numtext)</span>
<span id="cb445-9"><a href="#cb445-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb445-10"><a href="#cb445-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Pueden tambíen incluir listas anidadas y valores lógicos (lista de listas)</span></span>
<span id="cb445-11"><a href="#cb445-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb445-12"><a href="#cb445-12" aria-hidden="true" tabindex="-1"></a>listasanidadas <span class="op">=</span> [[<span class="fl">1.3</span>, <span class="dv">1</span>,<span class="dv">2</span>], [<span class="st">&quot;pepita&quot;</span>, <span class="st">&quot;pepito&quot;</span>], <span class="va">True</span>]</span>
<span id="cb445-13"><a href="#cb445-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb445-14"><a href="#cb445-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(listasanidadas)</span></code></pre></div>
<div class="alert alert-block alert-danger">
<p><b>Alerta:</b> Una lista anidada es una lista de listas.</p>
</div>
<div class="sourceCode" id="cb446"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb446-1"><a href="#cb446-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ahora veamos el tipo de la lista</span></span>
<span id="cb446-2"><a href="#cb446-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb446-3"><a href="#cb446-3" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(listasanidadas)</span>
<span id="cb446-4"><a href="#cb446-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">type</span>(listasanidadas))</span>
<span id="cb446-5"><a href="#cb446-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb446-6"><a href="#cb446-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Tambíen podemos incluir operaciones dentro</span></span>
<span id="cb446-7"><a href="#cb446-7" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span> <span class="op">+</span> <span class="dv">2</span>, <span class="st">&quot;a&quot;</span> <span class="op">*</span> <span class="dv">5</span>, <span class="dv">3</span>]</span></code></pre></div>
<div id="subconjuntos-de-listas" class="section level5 hasAnchor" number="4.1.7.1.1">
<h5 class="hasAnchor"><span class="header-section-number">4.1.7.1.1</span> Subconjuntos de listas<a href="#subconjuntos-de-listas" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb447"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb447-1"><a href="#cb447-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Vamos a ver como acceder a los elememetos de una lista. </span></span>
<span id="cb447-2"><a href="#cb447-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb447-3"><a href="#cb447-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Creamos lista de ejemplo</span></span>
<span id="cb447-4"><a href="#cb447-4" aria-hidden="true" tabindex="-1"></a>lista <span class="op">=</span> [<span class="va">True</span>, <span class="st">&quot;pepa&quot;</span>, [<span class="dv">1</span>,<span class="dv">3</span>], <span class="dv">2</span>]</span>
<span id="cb447-5"><a href="#cb447-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb447-6"><a href="#cb447-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Ahora vamos a ver distintos subconjuntos </span></span>
<span id="cb447-7"><a href="#cb447-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb447-8"><a href="#cb447-8" aria-hidden="true" tabindex="-1"></a>lista[<span class="dv">1</span>] <span class="co"># Segundo elemento!</span></span></code></pre></div>
<div class="alert alert-block alert-danger">
<p><b>Alerta:</b> Python cuenta el primer elemento como un cero!</p>
</div>
<div class="sourceCode" id="cb448"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb448-1"><a href="#cb448-1" aria-hidden="true" tabindex="-1"></a>lista[<span class="dv">0</span>] <span class="co"># primer elemento de la lista</span></span>
<span id="cb448-2"><a href="#cb448-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb448-3"><a href="#cb448-3" aria-hidden="true" tabindex="-1"></a>lista[<span class="dv">2</span>] <span class="co"># tercer elemento de la lista</span></span>
<span id="cb448-4"><a href="#cb448-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb448-5"><a href="#cb448-5" aria-hidden="true" tabindex="-1"></a>lista[<span class="dv">3</span>] <span class="co"># cuarto elemento de la lista</span></span>
<span id="cb448-6"><a href="#cb448-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb448-7"><a href="#cb448-7" aria-hidden="true" tabindex="-1"></a>lista[<span class="op">-</span><span class="dv">1</span>] <span class="co"># primer elemento de derecha a izquierda!</span></span>
<span id="cb448-8"><a href="#cb448-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb448-9"><a href="#cb448-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Tambien podemos hacer subconjuntos indicado el inicio y el fin </span></span>
<span id="cb448-10"><a href="#cb448-10" aria-hidden="true" tabindex="-1"></a>lista[<span class="dv">0</span>:<span class="dv">2</span>]</span></code></pre></div>
<div class="alert alert-block alert-danger">
<p><b>Alerta:</b> El primero es incluyente mientras que el segundo excluye</p>
</div>
<div class="sourceCode" id="cb449"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb449-1"><a href="#cb449-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tambíen se le puede decir a Python que el inicio sea por defecto</span></span>
<span id="cb449-2"><a href="#cb449-2" aria-hidden="true" tabindex="-1"></a>lista[:<span class="dv">2</span>]</span></code></pre></div>
<p>Finalmente, es posible especificar un tercer entero que representa el tamaño del paso; por ejemplo, para seleccionar cada segundo elemento de la lista, podemos escribir</p>
<div class="sourceCode" id="cb450"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb450-1"><a href="#cb450-1" aria-hidden="true" tabindex="-1"></a>L <span class="op">=</span> [<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">11</span>]</span>
<span id="cb450-2"><a href="#cb450-2" aria-hidden="true" tabindex="-1"></a>L[::<span class="dv">2</span>]  <span class="co"># equivalent to lista[0:len(lista):2]</span></span>
<span id="cb450-3"><a href="#cb450-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb450-4"><a href="#cb450-4" aria-hidden="true" tabindex="-1"></a><span class="co"># El tercer elemento es quien nos muestra el salto. Distinto a Stata donde es: inicio(paso)final</span></span>
<span id="cb450-5"><a href="#cb450-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb450-6"><a href="#cb450-6" aria-hidden="true" tabindex="-1"></a><span class="co">#  Pregunta: ¿Qué ocurre en este caso? </span></span>
<span id="cb450-7"><a href="#cb450-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb450-8"><a href="#cb450-8" aria-hidden="true" tabindex="-1"></a>lista2 <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="st">&quot;pepe&quot;</span>,<span class="st">&quot;pepa&quot;</span>]</span>
<span id="cb450-9"><a href="#cb450-9" aria-hidden="true" tabindex="-1"></a>lista2[<span class="dv">2</span>:]</span>
<span id="cb450-10"><a href="#cb450-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb450-11"><a href="#cb450-11" aria-hidden="true" tabindex="-1"></a><span class="co"># R: Selecciona hasta final!</span></span></code></pre></div>
<div class="figure">
<img src="attachment:image.png" alt="" />
<p class="caption">image.png</p>
</div>
</div>
<div id="operar-con-listas-anidadas" class="section level5 hasAnchor" number="4.1.7.1.2">
<h5 class="hasAnchor"><span class="header-section-number">4.1.7.1.2</span> Operar con listas anidadas<a href="#operar-con-listas-anidadas" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb451"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb451-1"><a href="#cb451-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Podemos operar con los subconjuntos incluso cuando tienen listas </span></span>
<span id="cb451-2"><a href="#cb451-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb451-3"><a href="#cb451-3" aria-hidden="true" tabindex="-1"></a>lista3 <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>, [<span class="dv">4</span>,<span class="dv">5</span>],<span class="dv">7</span>]</span>
<span id="cb451-4"><a href="#cb451-4" aria-hidden="true" tabindex="-1"></a>v1 <span class="op">=</span> lista3[<span class="dv">1</span>]</span>
<span id="cb451-5"><a href="#cb451-5" aria-hidden="true" tabindex="-1"></a>v2 <span class="op">=</span> lista3[<span class="dv">3</span>]</span>
<span id="cb451-6"><a href="#cb451-6" aria-hidden="true" tabindex="-1"></a>v3 <span class="op">=</span> v2[<span class="dv">1</span>]</span>
<span id="cb451-7"><a href="#cb451-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb451-8"><a href="#cb451-8" aria-hidden="true" tabindex="-1"></a>v4 <span class="op">=</span> v1 <span class="op">*</span> v3 </span>
<span id="cb451-9"><a href="#cb451-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(v4)</span>
<span id="cb451-10"><a href="#cb451-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb451-11"><a href="#cb451-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Pregunta: ¿Cómo llegamos al 10? ¿Qué paso con v3?</span></span>
<span id="cb451-12"><a href="#cb451-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb451-13"><a href="#cb451-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Para seleccionar los elementos de una lista de listas debemos utilziar dos parentesis cuadrados</span></span>
<span id="cb451-14"><a href="#cb451-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Por ejemplo, si quiero seleccionar el segundo elemento </span></span>
<span id="cb451-15"><a href="#cb451-15" aria-hidden="true" tabindex="-1"></a><span class="co"># del tercer elemento de la lista que hemos creado </span></span>
<span id="cb451-16"><a href="#cb451-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb451-17"><a href="#cb451-17" aria-hidden="true" tabindex="-1"></a>lista_anidada <span class="op">=</span> [[<span class="dv">1</span>,<span class="dv">3</span>], [<span class="dv">4</span>,<span class="dv">5</span>,<span class="st">&quot;pepa&quot;</span>]]</span>
<span id="cb451-18"><a href="#cb451-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb451-19"><a href="#cb451-19" aria-hidden="true" tabindex="-1"></a>segundalista_tercerelemento  <span class="op">=</span> lista_anidada[<span class="dv">1</span>][<span class="dv">2</span>]</span>
<span id="cb451-20"><a href="#cb451-20" aria-hidden="true" tabindex="-1"></a>primeralista_segundoelemento <span class="op">=</span> lista_anidada[<span class="dv">0</span>][<span class="dv">1</span>]</span>
<span id="cb451-21"><a href="#cb451-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb451-22"><a href="#cb451-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(segundalista_tercerelemento)</span>
<span id="cb451-23"><a href="#cb451-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(primeralista_segundoelemento)</span></code></pre></div>
</div>
<div id="manipulación-de-listas" class="section level5 hasAnchor" number="4.1.7.1.3">
<h5 class="hasAnchor"><span class="header-section-number">4.1.7.1.3</span> Manipulación de listas<a href="#manipulación-de-listas" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb452"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb452-1"><a href="#cb452-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Podemos cambiar los elementos de una lista, pro ejemplo cambiemos el útilmo </span></span>
<span id="cb452-2"><a href="#cb452-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb452-3"><a href="#cb452-3" aria-hidden="true" tabindex="-1"></a>lista <span class="op">=</span> [<span class="va">True</span>, <span class="st">&quot;pepa&quot;</span>, [<span class="dv">1</span>,<span class="dv">3</span>], <span class="dv">2</span>]</span>
<span id="cb452-4"><a href="#cb452-4" aria-hidden="true" tabindex="-1"></a>lista[<span class="dv">3</span>] <span class="op">=</span> <span class="st">&quot;pepito&quot;</span></span>
<span id="cb452-5"><a href="#cb452-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(lista)</span>
<span id="cb452-6"><a href="#cb452-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb452-7"><a href="#cb452-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Agregar elementos </span></span>
<span id="cb452-8"><a href="#cb452-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb452-9"><a href="#cb452-9" aria-hidden="true" tabindex="-1"></a>listaconmascosas <span class="op">=</span> lista <span class="op">+</span> [<span class="st">&quot;nico&quot;</span>, <span class="fl">1.7</span>]</span>
<span id="cb452-10"><a href="#cb452-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(listaconmascosas)</span>
<span id="cb452-11"><a href="#cb452-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb452-12"><a href="#cb452-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Noten que es muy parecido a cuando concatenamos valores en strings.</span></span>
<span id="cb452-13"><a href="#cb452-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb452-14"><a href="#cb452-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Remover elementos</span></span>
<span id="cb452-15"><a href="#cb452-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb452-16"><a href="#cb452-16" aria-hidden="true" tabindex="-1"></a>l <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">10</span>)) <span class="co"># range: para generar 10 valores (desde el cero)</span></span>
<span id="cb452-17"><a href="#cb452-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(l)</span>
<span id="cb452-18"><a href="#cb452-18" aria-hidden="true" tabindex="-1"></a><span class="kw">del</span> l[<span class="dv">0</span>]</span>
<span id="cb452-19"><a href="#cb452-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(l)</span>
<span id="cb452-20"><a href="#cb452-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb452-21"><a href="#cb452-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Notar que cuando borramos un elemento de la lista, cambian los índices!</span></span>
<span id="cb452-22"><a href="#cb452-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb452-23"><a href="#cb452-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Ordenar listas </span></span>
<span id="cb452-24"><a href="#cb452-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb452-25"><a href="#cb452-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Creamos listas</span></span>
<span id="cb452-26"><a href="#cb452-26" aria-hidden="true" tabindex="-1"></a>listaA <span class="op">=</span> [<span class="fl">11.25</span>, <span class="fl">18.0</span>, <span class="fl">20.0</span>]</span>
<span id="cb452-27"><a href="#cb452-27" aria-hidden="true" tabindex="-1"></a>listaB <span class="op">=</span> [<span class="fl">10.75</span>, <span class="fl">9.50</span>]</span>
<span id="cb452-28"><a href="#cb452-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb452-29"><a href="#cb452-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Paste together first and second: full</span></span>
<span id="cb452-30"><a href="#cb452-30" aria-hidden="true" tabindex="-1"></a>juntas <span class="op">=</span> listaA <span class="op">+</span> listaB</span>
<span id="cb452-31"><a href="#cb452-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb452-32"><a href="#cb452-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort full in descending order: full_sorted</span></span>
<span id="cb452-33"><a href="#cb452-33" aria-hidden="true" tabindex="-1"></a>ordenarjuntas <span class="op">=</span> <span class="bu">sorted</span>(juntas, reverse <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb452-34"><a href="#cb452-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb452-35"><a href="#cb452-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Print out full_sorted</span></span>
<span id="cb452-36"><a href="#cb452-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ordenarjuntas)</span>
<span id="cb452-37"><a href="#cb452-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb452-38"><a href="#cb452-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Es importante tener cuidado al manipular listas y/o generamos nuevas </span></span>
<span id="cb452-39"><a href="#cb452-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb452-40"><a href="#cb452-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Ejemplo 1: cambia original</span></span>
<span id="cb452-41"><a href="#cb452-41" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> [<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span> , <span class="st">&quot;c&quot;</span>]</span>
<span id="cb452-42"><a href="#cb452-42" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> x <span class="co"># Guardamos la lista x en una lista nueva</span></span>
<span id="cb452-43"><a href="#cb452-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb452-44"><a href="#cb452-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Ahora vamos a cambiar la lista y </span></span>
<span id="cb452-45"><a href="#cb452-45" aria-hidden="true" tabindex="-1"></a>y[<span class="dv">1</span>] <span class="op">=</span> <span class="st">&quot;z&quot;</span></span>
<span id="cb452-46"><a href="#cb452-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb452-47"><a href="#cb452-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Miremos las listas</span></span>
<span id="cb452-48"><a href="#cb452-48" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x) </span>
<span id="cb452-49"><a href="#cb452-49" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y)</span>
<span id="cb452-50"><a href="#cb452-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb452-51"><a href="#cb452-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Ejemplo 2: no cambia original </span></span>
<span id="cb452-52"><a href="#cb452-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb452-53"><a href="#cb452-53" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb452-54"><a href="#cb452-54" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> x</span>
<span id="cb452-55"><a href="#cb452-55" aria-hidden="true" tabindex="-1"></a>x <span class="op">+=</span> <span class="dv">5</span>  <span class="co"># Agrego 5 al valor de 5, pero no modifico x! </span></span>
<span id="cb452-56"><a href="#cb452-56" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;x =&quot;</span>, x)</span>
<span id="cb452-57"><a href="#cb452-57" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;y =&quot;</span>, y)</span>
<span id="cb452-58"><a href="#cb452-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb452-59"><a href="#cb452-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb452-60"><a href="#cb452-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Cuando llamamos a x += 5, no estamos modificando el valor del objeto 10 apuntado por x; </span></span>
<span id="cb452-61"><a href="#cb452-61" aria-hidden="true" tabindex="-1"></a><span class="co"># más bien estamos cambiando la variable x para que apunte a un nuevo objeto entero con valor 15. </span></span>
<span id="cb452-62"><a href="#cb452-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Por esta razón, el valor de y no se ve afectado por la operación.</span></span>
<span id="cb452-63"><a href="#cb452-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb452-64"><a href="#cb452-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Para evitar este problema es necesario crear listas de otra forma</span></span>
<span id="cb452-65"><a href="#cb452-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb452-66"><a href="#cb452-66" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> [<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>]</span>
<span id="cb452-67"><a href="#cb452-67" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> <span class="bu">list</span>(x) <span class="co"># list() sirve para hacer una lista en base a otra</span></span>
<span id="cb452-68"><a href="#cb452-68" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> x[:]    <span class="co"># Subcionjunto considerando todos los elementos</span></span>
<span id="cb452-69"><a href="#cb452-69" aria-hidden="true" tabindex="-1"></a>y[<span class="dv">1</span>] <span class="op">=</span> <span class="st">&quot;z&quot;</span></span>
<span id="cb452-70"><a href="#cb452-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb452-71"><a href="#cb452-71" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x)</span>
<span id="cb452-72"><a href="#cb452-72" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y)</span>
<span id="cb452-73"><a href="#cb452-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb452-74"><a href="#cb452-74" aria-hidden="true" tabindex="-1"></a><span class="co"># Noten que ahora cambio la lista x, pero no la lista y.</span></span></code></pre></div>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 4.1.2:</b></p>
<ol style="list-style-type: decimal">
<li>Genere una lista llamada cada con la siguiente información:</li>
</ol>
<table>
<thead>
<tr class="header">
<th>Zona</th>
<th>Tamaño (m2)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>comedor</td>
<td>11.25</td>
</tr>
<tr class="even">
<td>cocina</td>
<td>18.0</td>
</tr>
<tr class="odd">
<td>living</td>
<td>20.0</td>
</tr>
<tr class="even">
<td>pieza principal</td>
<td>10.75</td>
</tr>
<tr class="odd">
<td>baño</td>
<td>9.50</td>
</tr>
</tbody>
</table>
<ol start="2" style="list-style-type: decimal">
<li>Seleccione la siguiente información desde la lista casa:</li>
</ol>
<ul>
<li>Primeros 6 elementos</li>
<li>Últimos 4 elementos</li>
<li>Cocina y living junto a sus medidas</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>Confeccione una lista llamada <code>casa_dos_pisos</code> que contenga dos listas: piso 1 y piso 2. En el piso 1 deje cocina, living y comedor mientras que en el segundo piso deje pieza principal y baño.</li>
</ol>
</div>
</div>
</div>
<div id="tuplas" class="section level4 hasAnchor" number="4.1.7.2">
<h4 class="hasAnchor"><span class="header-section-number">4.1.7.2</span> Tuplas<a href="#tuplas" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Las tuplas son en muchos aspectos similares a las listas, pero se definen con paréntesis en lugar de corchetes. Tambíen pueden ser generadas sin los parentesis.</p>
<div class="sourceCode" id="cb453"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb453-1"><a href="#cb453-1" aria-hidden="true" tabindex="-1"></a>tupla <span class="op">=</span> (<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb453-2"><a href="#cb453-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tupla)</span>
<span id="cb453-3"><a href="#cb453-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb453-4"><a href="#cb453-4" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(tupla)</span>
<span id="cb453-5"><a href="#cb453-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb453-6"><a href="#cb453-6" aria-hidden="true" tabindex="-1"></a>tupla <span class="op">=</span> <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span></span>
<span id="cb453-7"><a href="#cb453-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tupla)</span>
<span id="cb453-8"><a href="#cb453-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb453-9"><a href="#cb453-9" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(tupla) <span class="co"># tamaño</span></span>
<span id="cb453-10"><a href="#cb453-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb453-11"><a href="#cb453-11" aria-hidden="true" tabindex="-1"></a>tupla[<span class="dv">0</span>]  <span class="co"># Posicion</span></span></code></pre></div>
<p><strong>¿Qué diferencia entonces a las tuplas de las listas?</strong></p>
<p>La principal característica de las tuplas es que son inmutables: esto significa que, una vez creadas, su tamaño y contenido <strong>no pueden modificarse</strong>.</p>
<div class="sourceCode" id="cb454"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb454-1"><a href="#cb454-1" aria-hidden="true" tabindex="-1"></a>tupla[<span class="dv">1</span>] <span class="op">=</span> <span class="dv">4</span></span></code></pre></div>
<ul>
<li>De este modo, las listas son <em>mutables</em> mientras que las tuplas son <em>inmutables</em>.</li>
</ul>
</div>
<div id="diccionarios" class="section level4 hasAnchor" number="4.1.7.3">
<h4 class="hasAnchor"><span class="header-section-number">4.1.7.3</span> Diccionarios<a href="#diccionarios" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Los diccionarios son mapeos extremadamente flexibles de claves a valores, y forman la base de gran parte de la implementación interna de Python. Pueden crearse mediante una lista separada por comas de pares clave:valor entre llaves.</p>
<div class="sourceCode" id="cb455"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb455-1"><a href="#cb455-1" aria-hidden="true" tabindex="-1"></a>numeros <span class="op">=</span> {<span class="st">&quot;uno&quot;</span>:<span class="dv">1</span>, <span class="st">&quot;dos&quot;</span>:<span class="dv">2</span>, <span class="st">&quot;tres&quot;</span>:<span class="dv">3</span>, <span class="st">&quot;cuatro&quot;</span>: <span class="dv">4</span>}</span>
<span id="cb455-2"><a href="#cb455-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(numeros)</span>
<span id="cb455-3"><a href="#cb455-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb455-4"><a href="#cb455-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Para accesder debo llamar al nombre, de allí que sean como un diccionario. Son &quot;similares&quot; a las listas en R. </span></span>
<span id="cb455-5"><a href="#cb455-5" aria-hidden="true" tabindex="-1"></a>numeros[<span class="st">&quot;dos&quot;</span>]</span>
<span id="cb455-6"><a href="#cb455-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb455-7"><a href="#cb455-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Agregar nuevos elementos al diccionario</span></span>
<span id="cb455-8"><a href="#cb455-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb455-9"><a href="#cb455-9" aria-hidden="true" tabindex="-1"></a>numeros[<span class="st">&#39;cero&#39;</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb455-10"><a href="#cb455-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(numeros)</span>
<span id="cb455-11"><a href="#cb455-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb455-12"><a href="#cb455-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Noten que no hay necesarimente un sendito del orden en los diccionarios. El cero esta al final por ejemplo.</span></span></code></pre></div>
</div>
<div id="conjuntos-sets" class="section level4 hasAnchor" number="4.1.7.4">
<h4 class="hasAnchor"><span class="header-section-number">4.1.7.4</span> Conjuntos (sets)<a href="#conjuntos-sets" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Se definen de forma similar a las listas y las tuplas, salvo que utilizan las llaves de los diccionarios.</p>
<div class="sourceCode" id="cb456"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb456-1"><a href="#cb456-1" aria-hidden="true" tabindex="-1"></a>primos <span class="op">=</span> {<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>}</span>
<span id="cb456-2"><a href="#cb456-2" aria-hidden="true" tabindex="-1"></a>impares <span class="op">=</span> {<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">9</span>}</span>
<span id="cb456-3"><a href="#cb456-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb456-4"><a href="#cb456-4" aria-hidden="true" tabindex="-1"></a><span class="co"># unión</span></span>
<span id="cb456-5"><a href="#cb456-5" aria-hidden="true" tabindex="-1"></a>primos <span class="op">|</span> impares      <span class="co"># with an operator</span></span>
<span id="cb456-6"><a href="#cb456-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb456-7"><a href="#cb456-7" aria-hidden="true" tabindex="-1"></a><span class="co"># intersección</span></span>
<span id="cb456-8"><a href="#cb456-8" aria-hidden="true" tabindex="-1"></a>primos <span class="op">&amp;</span> impares</span>
<span id="cb456-9"><a href="#cb456-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb456-10"><a href="#cb456-10" aria-hidden="true" tabindex="-1"></a><span class="co"># diferencia: que estan en el primer grupo, pero no en el segundo </span></span>
<span id="cb456-11"><a href="#cb456-11" aria-hidden="true" tabindex="-1"></a>primos <span class="op">-</span> impares</span>
<span id="cb456-12"><a href="#cb456-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb456-13"><a href="#cb456-13" aria-hidden="true" tabindex="-1"></a><span class="co"># diferencia simetrica: solo aparecen en un conjunto (cualquiera de los dos)</span></span>
<span id="cb456-14"><a href="#cb456-14" aria-hidden="true" tabindex="-1"></a>primos <span class="op">^</span> impares</span></code></pre></div>
</div>
</div>
<div id="funciones-2" class="section level3 hasAnchor" number="4.1.8">
<h3 class="hasAnchor"><span class="header-section-number">4.1.8</span> Funciones<a href="#funciones-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li><p>Una función es básicamente un conjunto de tareas que podemos reutilizar a lo largo de un código. Es una buena practica de programación, permite evitar repetición.</p></li>
<li><p>Ya hemos visto varias: print(), type(), str(), int(), bool(), float().</p></li>
<li><p>En todos los programas existen funciones predeterminadas (<strong><em>Buil-in function</em></strong>). Veamos algunmos ejemplos y tambíen veamos como buscar ayuda.</p></li>
</ol>
<div class="sourceCode" id="cb457"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb457-1"><a href="#cb457-1" aria-hidden="true" tabindex="-1"></a>lista <span class="op">=</span> [<span class="fl">1.5</span>, <span class="fl">1.3</span>, <span class="fl">1.2</span>]</span>
<span id="cb457-2"><a href="#cb457-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb457-3"><a href="#cb457-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Algunas funciones para explorar datos</span></span>
<span id="cb457-4"><a href="#cb457-4" aria-hidden="true" tabindex="-1"></a>minimo <span class="op">=</span> <span class="bu">min</span>(lista)</span>
<span id="cb457-5"><a href="#cb457-5" aria-hidden="true" tabindex="-1"></a>maximo <span class="op">=</span> <span class="bu">max</span>(lista)</span>
<span id="cb457-6"><a href="#cb457-6" aria-hidden="true" tabindex="-1"></a>suma <span class="op">=</span> <span class="bu">sum</span>(lista)</span>
<span id="cb457-7"><a href="#cb457-7" aria-hidden="true" tabindex="-1"></a>potencia <span class="op">=</span> <span class="bu">pow</span>(<span class="dv">2</span>,<span class="dv">3</span>)</span>
<span id="cb457-8"><a href="#cb457-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(minimo, maximo, suma, potencia)</span>
<span id="cb457-9"><a href="#cb457-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb457-10"><a href="#cb457-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Redondear escalares  </span></span>
<span id="cb457-11"><a href="#cb457-11" aria-hidden="true" tabindex="-1"></a>escalar <span class="op">=</span> <span class="fl">5.3233232</span></span>
<span id="cb457-12"><a href="#cb457-12" aria-hidden="true" tabindex="-1"></a>redondear <span class="op">=</span> <span class="bu">round</span>(escalar,<span class="dv">2</span>)</span>
<span id="cb457-13"><a href="#cb457-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb457-14"><a href="#cb457-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Otras para ordenar listas  y medirlas</span></span>
<span id="cb457-15"><a href="#cb457-15" aria-hidden="true" tabindex="-1"></a>tamaño <span class="op">=</span> <span class="bu">len</span>(lista)</span>
<span id="cb457-16"><a href="#cb457-16" aria-hidden="true" tabindex="-1"></a>ordenar <span class="op">=</span> <span class="bu">sorted</span>(lista)  <span class="co"># Por defecto ascendente</span></span>
<span id="cb457-17"><a href="#cb457-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb457-18"><a href="#cb457-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tamaño)</span>
<span id="cb457-19"><a href="#cb457-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ordenar)</span>
<span id="cb457-20"><a href="#cb457-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb457-21"><a href="#cb457-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Ayuda! : la más importante de todas</span></span>
<span id="cb457-22"><a href="#cb457-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb457-23"><a href="#cb457-23" aria-hidden="true" tabindex="-1"></a><span class="bu">help</span>(<span class="bu">len</span>)</span>
<span id="cb457-24"><a href="#cb457-24" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>?</span>
<span id="cb457-25"><a href="#cb457-25" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>??</span></code></pre></div>
</div>
<div id="methods" class="section level3 hasAnchor" number="4.1.9">
<h3 class="hasAnchor"><span class="header-section-number">4.1.9</span> Methods<a href="#methods" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li>Un <em>method</em> es una función que pertenece a un cierto objeto. Vamos a ver varios ejemplos para listas y strings.</li>
</ol>
<div id="methods-para-listas" class="section level4 hasAnchor" number="4.1.9.1">
<h4 class="hasAnchor"><span class="header-section-number">4.1.9.1</span> Methods para listas<a href="#methods-para-listas" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb458"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb458-1"><a href="#cb458-1" aria-hidden="true" tabindex="-1"></a>lista <span class="op">=</span> [<span class="st">&quot;pepa&quot;</span>, <span class="fl">1.45</span>, <span class="st">&quot;pepe&quot;</span>, <span class="fl">1.32</span>, <span class="st">&quot;ema&quot;</span>, <span class="fl">1.45</span>]</span>
<span id="cb458-2"><a href="#cb458-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb458-3"><a href="#cb458-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Indicador de un valor determinado</span></span>
<span id="cb458-4"><a href="#cb458-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(lista.index(<span class="st">&quot;ema&quot;</span>))</span>
<span id="cb458-5"><a href="#cb458-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb458-6"><a href="#cb458-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Contemos valores</span></span>
<span id="cb458-7"><a href="#cb458-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(lista.count(<span class="fl">1.45</span>))</span>
<span id="cb458-8"><a href="#cb458-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb458-9"><a href="#cb458-9" aria-hidden="true" tabindex="-1"></a>areas <span class="op">=</span> [<span class="fl">11.25</span>, <span class="fl">18.0</span>, <span class="fl">20.0</span>, <span class="fl">10.75</span>, <span class="fl">9.50</span>]</span>
<span id="cb458-10"><a href="#cb458-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb458-11"><a href="#cb458-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Agregar elementos </span></span>
<span id="cb458-12"><a href="#cb458-12" aria-hidden="true" tabindex="-1"></a>areas.append(<span class="fl">24.5</span>)</span>
<span id="cb458-13"><a href="#cb458-13" aria-hidden="true" tabindex="-1"></a>areas.append(<span class="fl">15.45</span>)</span>
<span id="cb458-14"><a href="#cb458-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(areas)</span>
<span id="cb458-15"><a href="#cb458-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb458-16"><a href="#cb458-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Revertir order</span></span>
<span id="cb458-17"><a href="#cb458-17" aria-hidden="true" tabindex="-1"></a>areas.reverse</span>
<span id="cb458-18"><a href="#cb458-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(areas)</span></code></pre></div>
</div>
<div id="methods-para-strings" class="section level4 hasAnchor" number="4.1.9.2">
<h4 class="hasAnchor"><span class="header-section-number">4.1.9.2</span> Methods para strings<a href="#methods-para-strings" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb459"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb459-1"><a href="#cb459-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --------#</span></span>
<span id="cb459-2"><a href="#cb459-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Strings  </span></span>
<span id="cb459-3"><a href="#cb459-3" aria-hidden="true" tabindex="-1"></a><span class="co"># --------#</span></span>
<span id="cb459-4"><a href="#cb459-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb459-5"><a href="#cb459-5" aria-hidden="true" tabindex="-1"></a>string <span class="op">=</span> <span class="st">&quot;pepa&quot;</span></span>
<span id="cb459-6"><a href="#cb459-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb459-7"><a href="#cb459-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Mayusculas la primera letra</span></span>
<span id="cb459-8"><a href="#cb459-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb459-9"><a href="#cb459-9" aria-hidden="true" tabindex="-1"></a>string.capitalize()</span>
<span id="cb459-10"><a href="#cb459-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb459-11"><a href="#cb459-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Remplazamos alguna letra</span></span>
<span id="cb459-12"><a href="#cb459-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb459-13"><a href="#cb459-13" aria-hidden="true" tabindex="-1"></a>string.replace(<span class="st">&quot;e&quot;</span>, <span class="st">&quot;a&quot;</span>)</span>
<span id="cb459-14"><a href="#cb459-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb459-15"><a href="#cb459-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Todas mayusculas </span></span>
<span id="cb459-16"><a href="#cb459-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb459-17"><a href="#cb459-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(string.upper())</span>
<span id="cb459-18"><a href="#cb459-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb459-19"><a href="#cb459-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Contar letras</span></span>
<span id="cb459-20"><a href="#cb459-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb459-21"><a href="#cb459-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(string.count(<span class="st">&quot;a&quot;</span>))b</span>
<span id="cb459-22"><a href="#cb459-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb459-23"><a href="#cb459-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Para buscar ayuda en metodos</span></span>
<span id="cb459-24"><a href="#cb459-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb459-25"><a href="#cb459-25" aria-hidden="true" tabindex="-1"></a>L <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]</span>
<span id="cb459-26"><a href="#cb459-26" aria-hidden="true" tabindex="-1"></a>L.insert?</span>
<span id="cb459-27"><a href="#cb459-27" aria-hidden="true" tabindex="-1"></a>L?</span>
<span id="cb459-28"><a href="#cb459-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb459-29"><a href="#cb459-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Tab Completation </span></span>
<span id="cb459-30"><a href="#cb459-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb459-31"><a href="#cb459-31" aria-hidden="true" tabindex="-1"></a><span class="co"># ¿Cómo se los métodos disponibles? Nombre objeto + &quot;.&quot; + &quot;tab&quot;. Si pongo una letra al inicio puedo </span></span>
<span id="cb459-32"><a href="#cb459-32" aria-hidden="true" tabindex="-1"></a><span class="co"># ver cuales estan disponibles. </span></span>
<span id="cb459-33"><a href="#cb459-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb459-34"><a href="#cb459-34" aria-hidden="true" tabindex="-1"></a><span class="co">#L.</span></span>
<span id="cb459-35"><a href="#cb459-35" aria-hidden="true" tabindex="-1"></a><span class="co">#L.c</span></span>
<span id="cb459-36"><a href="#cb459-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb459-37"><a href="#cb459-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Tambien es util para importar funciones desde paquetes. </span></span>
<span id="cb459-38"><a href="#cb459-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb459-39"><a href="#cb459-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Más allá del Tab, puedo utilizar * para hacer busquedas más especiales!</span></span>
<span id="cb459-40"><a href="#cb459-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb459-41"><a href="#cb459-41" aria-hidden="true" tabindex="-1"></a><span class="bu">str</span>.<span class="op">*</span>find?</span></code></pre></div>
<p><strong>En resumen…</strong></p>
<ol style="list-style-type: decimal">
<li>En <mark>Python</mark> todo es un objeto. Dependen del tipo de objeto.</li>
<li>Cada objeto tiene <mark> métodos </mark> especificos asociados.</li>
<li>Hay algunos metodos comunes en todos los objetos (ej. index), pero otros no (ej. replace).</li>
</ol>
<div class="sourceCode" id="cb460"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb460-1"><a href="#cb460-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Algunos metodos pueden cambiar los objetos. Veamos un ejemplo. </span></span>
<span id="cb460-2"><a href="#cb460-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb460-3"><a href="#cb460-3" aria-hidden="true" tabindex="-1"></a>lista <span class="op">=</span> [<span class="st">&quot;pepa&quot;</span>, <span class="fl">1.45</span>, <span class="st">&quot;pepe&quot;</span>, <span class="fl">1.32</span>, <span class="st">&quot;ema&quot;</span>, <span class="fl">1.45</span>]</span>
<span id="cb460-4"><a href="#cb460-4" aria-hidden="true" tabindex="-1"></a>lista.append(<span class="st">&quot;nicolas&quot;</span>)</span>
<span id="cb460-5"><a href="#cb460-5" aria-hidden="true" tabindex="-1"></a>lista</span>
<span id="cb460-6"><a href="#cb460-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb460-7"><a href="#cb460-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Otros &quot;methods&quot; para números reales </span></span>
<span id="cb460-8"><a href="#cb460-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb460-9"><a href="#cb460-9" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="fl">4.5</span></span>
<span id="cb460-10"><a href="#cb460-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x.real, <span class="st">&quot;+&quot;</span>, x.imag, <span class="st">&#39;i&#39;</span>)</span>
<span id="cb460-11"><a href="#cb460-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb460-12"><a href="#cb460-12" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="fl">4.5</span></span>
<span id="cb460-13"><a href="#cb460-13" aria-hidden="true" tabindex="-1"></a>x.is_integer()</span>
<span id="cb460-14"><a href="#cb460-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb460-15"><a href="#cb460-15" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="fl">4.0</span></span>
<span id="cb460-16"><a href="#cb460-16" aria-hidden="true" tabindex="-1"></a>x.is_integer()</span>
<span id="cb460-17"><a href="#cb460-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb460-18"><a href="#cb460-18" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(x.is_integer)</span></code></pre></div>
</div>
</div>
<div id="paquetes" class="section level3 hasAnchor" number="4.1.10">
<h3 class="hasAnchor"><span class="header-section-number">4.1.10</span> Paquetes<a href="#paquetes" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li><p>Como cualquier lenguaje de programación existen paquetes. Los paquetes son conjuntos de funciones que cumplen un objetivo común. En las clases siguientes veremos en detalles varios de ellos.</p></li>
<li><p>Estos paquetes tienen funciones y metodos especificos.</p></li>
<li><p>No todos los paquetes estan disponibles en Python. Hay que instalarlos.</p></li>
<li><p>Es posible colocar el nombre que uno quiera a los paquetes. Por ejemplo</p></li>
</ol>
<div class="sourceCode" id="cb461"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb461-1"><a href="#cb461-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np </span>
<span id="cb461-2"><a href="#cb461-2" aria-hidden="true" tabindex="-1"></a>np.array([<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>])</span>
<span id="cb461-3"><a href="#cb461-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb461-4"><a href="#cb461-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Tambíen es posible importar solo una función de un paquete. </span></span>
<span id="cb461-5"><a href="#cb461-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numpy <span class="im">import</span> array</span>
<span id="cb461-6"><a href="#cb461-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb461-7"><a href="#cb461-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Hay ocasiones en las que hay paquetes y subpaquetes</span></span>
<span id="cb461-8"><a href="#cb461-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb461-9"><a href="#cb461-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.linalg <span class="im">import</span> inv <span class="im">as</span> my_inv</span>
<span id="cb461-10"><a href="#cb461-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb461-11"><a href="#cb461-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Es mejor la primer opción. Queda claro cual paquete estamos utilizando.</span></span>
<span id="cb461-12"><a href="#cb461-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb461-13"><a href="#cb461-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Ejemplo: calcular area de una circunferencia </span></span>
<span id="cb461-14"><a href="#cb461-14" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> <span class="fl">0.43</span></span>
<span id="cb461-15"><a href="#cb461-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb461-16"><a href="#cb461-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Importamos paquete math</span></span>
<span id="cb461-17"><a href="#cb461-17" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math <span class="im">as</span> mt</span>
<span id="cb461-18"><a href="#cb461-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb461-19"><a href="#cb461-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcula C</span></span>
<span id="cb461-20"><a href="#cb461-20" aria-hidden="true" tabindex="-1"></a>C <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> mt.pi <span class="op">*</span> r</span>
<span id="cb461-21"><a href="#cb461-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb461-22"><a href="#cb461-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcula A</span></span>
<span id="cb461-23"><a href="#cb461-23" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> mt.pi <span class="op">*</span> r <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb461-24"><a href="#cb461-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb461-25"><a href="#cb461-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Build printout</span></span>
<span id="cb461-26"><a href="#cb461-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Circumferencia: &quot;</span> <span class="op">+</span> <span class="bu">str</span>(C))</span>
<span id="cb461-27"><a href="#cb461-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Area: &quot;</span> <span class="op">+</span> <span class="bu">str</span>(A))</span></code></pre></div>
<div id="algunos-paquete-fundamentales-para-el-análisis-de-datos" class="section level4 hasAnchor" number="4.1.10.1">
<h4 class="hasAnchor"><span class="header-section-number">4.1.10.1</span> Algunos paquete fundamentales para el análisis de datos<a href="#algunos-paquete-fundamentales-para-el-análisis-de-datos" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li><p><code>NumPy</code> proporciona un almacenamiento y cálculo eficientes para matrices de datos multidimensionales.</p></li>
<li><p><code>Pandas</code> proporciona un objeto DataFrame junto con un potente conjunto de métodos para manipular, filtrar, agrupar y transformar datos.</p></li>
<li><p><code>Matplotlib</code> proporciona una interfaz útil para la creación de gráficos y figuras con calidad de publicación.</p></li>
</ol>
</div>
</div>
</div>
<div id="librerias-principales-de-python---numpy-matplotlib-pandas" class="section level2 hasAnchor" number="4.2">
<h2 class="hasAnchor"><span class="header-section-number">4.2</span> Librerías principales de Python - Numpy, Matplotlib, Pandas<a href="#librerias-principales-de-python---numpy-matplotlib-pandas" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>En esta sección revisaremos todo el instrumental básico de Python: operadores, estructuras de datos, funciones y metodos.</li>
<li>Revisaremos una de las principales librerías que se utilizan para el análisis de datos: numpy. Veremos algunos ejemplos muy básicos de matplotlib tambíen.</li>
<li>Con estos elementos, ya pueden sentirse libres para trabajar en Python.</li>
</ul>
<div id="numpy" class="section level3 hasAnchor" number="4.2.1">
<h3 class="hasAnchor"><span class="header-section-number">4.2.1</span> NumPy<a href="#numpy" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Los conjuntos de datos pueden ser de muchos tipos como colecciones de documentos, colecciones de imágenes,
colecciones de clips de sonido, colecciones de medidas numéricas o casi cualquier cosa.<br />
</li>
<li>NumPy nos ayudará a manejar datos pensados como arreglos númericos.</li>
<li>NumPy significa <em>numerical python</em>.</li>
<li>Es una alternativa a las listas y sirve para manipular arreglos.</li>
<li>Las principales librerías de Python estan basadas en numpy: Pandas, SciPy, Matplotlib</li>
</ul>
<div id="sintaxis-básica-y-detalles" class="section level4 hasAnchor" number="4.2.1.1">
<h4 class="hasAnchor"><span class="header-section-number">4.2.1.1</span> Sintaxis básica y detalles<a href="#sintaxis-básica-y-detalles" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb462"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb462-1"><a href="#cb462-1" aria-hidden="true" tabindex="-1"></a>ingreso <span class="op">=</span> [<span class="dv">890</span>, <span class="dv">1023</span>, <span class="dv">2500</span>, <span class="dv">3223</span>, <span class="dv">23434</span>]</span>
<span id="cb462-2"><a href="#cb462-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb462-3"><a href="#cb462-3" aria-hidden="true" tabindex="-1"></a>n_hogar <span class="op">=</span> [<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">9</span>]</span>
<span id="cb462-4"><a href="#cb462-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb462-5"><a href="#cb462-5" aria-hidden="true" tabindex="-1"></a>ingreso_por_persona <span class="op">=</span> ingreso <span class="op">/</span> n_hogar</span>
<span id="cb462-6"><a href="#cb462-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Tenemos un error!</span></span></code></pre></div>
<ul>
<li>Para ver más detalles de la libreria es bueno recordar:
<ul>
<li>Puedo ver el contenido de np aprentando <code>&lt;tab&gt;</code>despues de apretar <code>np.</code></li>
<li>Puedo revisar la documentación con np?</li>
<li>Más información sobre numerical python: <a href="https://numpy.org/" class="uri">https://numpy.org/</a></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb463"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb463-1"><a href="#cb463-1" aria-hidden="true" tabindex="-1"></a><span class="co"># importamos la librería o paquete </span></span>
<span id="cb463-2"><a href="#cb463-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np <span class="co"># importamos</span></span>
<span id="cb463-3"><a href="#cb463-3" aria-hidden="true" tabindex="-1"></a>np_ingreso <span class="op">=</span> np.array(ingreso) </span>
<span id="cb463-4"><a href="#cb463-4" aria-hidden="true" tabindex="-1"></a>np_nhogar <span class="op">=</span> np.array(n_hogar)</span>
<span id="cb463-5"><a href="#cb463-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb463-6"><a href="#cb463-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Ahora, no hay problemas en calcularlo </span></span>
<span id="cb463-7"><a href="#cb463-7" aria-hidden="true" tabindex="-1"></a>ingreso_por_persona <span class="op">=</span> np_ingreso <span class="op">/</span> np_nhogar</span>
<span id="cb463-8"><a href="#cb463-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ingreso_por_persona)</span>
<span id="cb463-9"><a href="#cb463-9" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(ingreso_por_persona)</span></code></pre></div>
<p><strong>En resumen</strong></p>
<ul>
<li>Con listas no se puede operar como nos gustaría, pero con NumPy si.</li>
<li>NumPy asume que la lista contiene los mismos elementos. NumPy es <em>igualador</em>!</li>
<li>Como vimos anteriormente, array es un tipo de objeto. Por lo tanto, sus <em>methods</em> pueden ser distintos.</li>
<li>ndarray: <em>n-dimentional array</em>.</li>
<li>Eje x se denomina axis 0, eje y axis1.</li>
</ul>
<div class="sourceCode" id="cb464"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb464-1"><a href="#cb464-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Numpy es igualador</span></span>
<span id="cb464-2"><a href="#cb464-2" aria-hidden="true" tabindex="-1"></a>np.array([<span class="fl">1.2</span>, <span class="st">&quot;martes&quot;</span>, <span class="va">False</span>])</span>
<span id="cb464-3"><a href="#cb464-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb464-4"><a href="#cb464-4" aria-hidden="true" tabindex="-1"></a><span class="co"># logicos + numeros: todo a números. True se convierte en uno / False en cero. </span></span>
<span id="cb464-5"><a href="#cb464-5" aria-hidden="true" tabindex="-1"></a><span class="co"># logicos/numerico + string: todo a string</span></span>
<span id="cb464-6"><a href="#cb464-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb464-7"><a href="#cb464-7" aria-hidden="true" tabindex="-1"></a><span class="co"># NumPy cambia algunos operadores</span></span>
<span id="cb464-8"><a href="#cb464-8" aria-hidden="true" tabindex="-1"></a>lista_numeros <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]</span>
<span id="cb464-9"><a href="#cb464-9" aria-hidden="true" tabindex="-1"></a>np_numeros <span class="op">=</span> np.array(lista_numeros)</span>
<span id="cb464-10"><a href="#cb464-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np_numeros)</span>
<span id="cb464-11"><a href="#cb464-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb464-12"><a href="#cb464-12" aria-hidden="true" tabindex="-1"></a><span class="co"># En una lista: + concatenar</span></span>
<span id="cb464-13"><a href="#cb464-13" aria-hidden="true" tabindex="-1"></a>lista_numeros <span class="op">+</span> lista_numeros</span>
<span id="cb464-14"><a href="#cb464-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb464-15"><a href="#cb464-15" aria-hidden="true" tabindex="-1"></a><span class="co"># En un arreglo: + suma </span></span>
<span id="cb464-16"><a href="#cb464-16" aria-hidden="true" tabindex="-1"></a>np_numeros <span class="op">+</span> np_numeros</span></code></pre></div>
</div>
<div id="crear-arreglos-con-numpy" class="section level4 hasAnchor" number="4.2.1.2">
<h4 class="hasAnchor"><span class="header-section-number">4.2.1.2</span> Crear arreglos con NumPy<a href="#crear-arreglos-con-numpy" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb465"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb465-1"><a href="#cb465-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Veamos los distintos tipos de arreglos que podemos hacer en numpy</span></span>
<span id="cb465-2"><a href="#cb465-2" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">0</span>)  <span class="co"># Garantizar reproducibilidad</span></span>
<span id="cb465-3"><a href="#cb465-3" aria-hidden="true" tabindex="-1"></a>x1 <span class="op">=</span> np.random.randint(<span class="dv">10</span>, size <span class="op">=</span> <span class="dv">6</span>)  <span class="co"># Arreglo de una dimensión (dimension)</span></span>
<span id="cb465-4"><a href="#cb465-4" aria-hidden="true" tabindex="-1"></a>x2 <span class="op">=</span> np.random.randint(<span class="dv">10</span>, size <span class="op">=</span> (<span class="dv">3</span>, <span class="dv">4</span>))  <span class="co"># Arreglo de dos dimensiones (filas x columnas)</span></span>
<span id="cb465-5"><a href="#cb465-5" aria-hidden="true" tabindex="-1"></a>x3 <span class="op">=</span> np.random.randint(<span class="dv">10</span>, size <span class="op">=</span> (<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>))  <span class="co"># Arreglo de tres dimensiones (numero matrices, filas x columnas)</span></span>
<span id="cb465-6"><a href="#cb465-6" aria-hidden="true" tabindex="-1"></a>x4 <span class="op">=</span> np.random.randint(<span class="dv">10</span>, size <span class="op">=</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>)) <span class="co"># Arreglo de cuatro dimensiones (numero de grupos, numero matrices, filas x columnas)</span></span>
<span id="cb465-7"><a href="#cb465-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb465-8"><a href="#cb465-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x1)</span>
<span id="cb465-9"><a href="#cb465-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb465-10"><a href="#cb465-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x2)</span>
<span id="cb465-11"><a href="#cb465-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb465-12"><a href="#cb465-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x3)</span>
<span id="cb465-13"><a href="#cb465-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb465-14"><a href="#cb465-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x4)</span>
<span id="cb465-15"><a href="#cb465-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb465-16"><a href="#cb465-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Veamos más ejemplos </span></span>
<span id="cb465-17"><a href="#cb465-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Arreglo de una dimensión </span></span>
<span id="cb465-18"><a href="#cb465-18" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.array([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>])</span>
<span id="cb465-19"><a href="#cb465-19" aria-hidden="true" tabindex="-1"></a>x</span>
<span id="cb465-20"><a href="#cb465-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x)</span>
<span id="cb465-21"><a href="#cb465-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb465-22"><a href="#cb465-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Arreglo de dos dimensiones </span></span>
<span id="cb465-23"><a href="#cb465-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb465-24"><a href="#cb465-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Hago una lista de listas</span></span>
<span id="cb465-25"><a href="#cb465-25" aria-hidden="true" tabindex="-1"></a>x_2d <span class="op">=</span>[[<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">5</span>], </span>
<span id="cb465-26"><a href="#cb465-26" aria-hidden="true" tabindex="-1"></a>      [<span class="dv">9</span>,<span class="dv">7</span>,<span class="dv">1</span>], </span>
<span id="cb465-27"><a href="#cb465-27" aria-hidden="true" tabindex="-1"></a>      [<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">6</span>]]</span>
<span id="cb465-28"><a href="#cb465-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb465-29"><a href="#cb465-29" aria-hidden="true" tabindex="-1"></a>x_2d_array <span class="op">=</span> np.array(x_2d)</span>
<span id="cb465-30"><a href="#cb465-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x_2d_array)</span>
<span id="cb465-31"><a href="#cb465-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb465-32"><a href="#cb465-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Arreglo de tres dimensiones </span></span>
<span id="cb465-33"><a href="#cb465-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb465-34"><a href="#cb465-34" aria-hidden="true" tabindex="-1"></a>x_3d <span class="op">=</span> np.array([x_2d_array,x_2d_array, x_2d_array])</span>
<span id="cb465-35"><a href="#cb465-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x_3d)</span></code></pre></div>
<p><strong>Arreglo de 1,2,3 dimensiones</strong></p>
<div class="figure">
<img src="attachment:image.png" alt="" />
<p class="caption">image.png</p>
</div>
<p><strong>Arreglo de 4 dimensiones</strong></p>
<div class="figure">
<img src="attachment:array_4d.png" alt="" />
<p class="caption">array_4d.png</p>
</div>
<div class="sourceCode" id="cb466"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb466-1"><a href="#cb466-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Arreglo de cuatro dimensiones </span></span>
<span id="cb466-2"><a href="#cb466-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb466-3"><a href="#cb466-3" aria-hidden="true" tabindex="-1"></a>x_4d <span class="op">=</span> np.array([x_3d,x_3d, x_3d, x_3d])</span>
<span id="cb466-4"><a href="#cb466-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x_4d)</span></code></pre></div>
</div>
<div id="atributos-de-los-arreglos" class="section level4 hasAnchor" number="4.2.1.3">
<h4 class="hasAnchor"><span class="header-section-number">4.2.1.3</span> Atributos de los arreglos<a href="#atributos-de-los-arreglos" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb467"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb467-1"><a href="#cb467-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Saber la dimensión</span></span>
<span id="cb467-2"><a href="#cb467-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;x3 ndim: &quot;</span>, x3.ndim)</span>
<span id="cb467-3"><a href="#cb467-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb467-4"><a href="#cb467-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Saber detalles de la dimensión</span></span>
<span id="cb467-5"><a href="#cb467-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;x3 shape:&quot;</span>, x3.shape)</span>
<span id="cb467-6"><a href="#cb467-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb467-7"><a href="#cb467-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Saber el número de elementos del objeto</span></span>
<span id="cb467-8"><a href="#cb467-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;x3 size: &quot;</span>, x3.size)</span></code></pre></div>
</div>
<div id="subconjuntos-en-un-arreglo" class="section level4 hasAnchor" number="4.2.1.4">
<h4 class="hasAnchor"><span class="header-section-number">4.2.1.4</span> Subconjuntos en un arreglo<a href="#subconjuntos-en-un-arreglo" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div id="subconjuntos-en-arreglos-unidimensionales" class="section level5 hasAnchor" number="4.2.1.4.1">
<h5 class="hasAnchor"><span class="header-section-number">4.2.1.4.1</span> Subconjuntos en arreglos unidimensionales<a href="#subconjuntos-en-arreglos-unidimensionales" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb468"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb468-1"><a href="#cb468-1" aria-hidden="true" tabindex="-1"></a>np_numeros</span>
<span id="cb468-2"><a href="#cb468-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb468-3"><a href="#cb468-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Puedo seleccionar subconjuntos al igual que en una lista: con la posición.</span></span>
<span id="cb468-4"><a href="#cb468-4" aria-hidden="true" tabindex="-1"></a>np_numeros[<span class="dv">1</span>]</span>
<span id="cb468-5"><a href="#cb468-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb468-6"><a href="#cb468-6" aria-hidden="true" tabindex="-1"></a>np_numeros[<span class="dv">0</span>:<span class="dv">2</span>]</span>
<span id="cb468-7"><a href="#cb468-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb468-8"><a href="#cb468-8" aria-hidden="true" tabindex="-1"></a>np_numeros[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb468-9"><a href="#cb468-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb468-10"><a href="#cb468-10" aria-hidden="true" tabindex="-1"></a>np_numeros[np_numeros <span class="op">&gt;</span> <span class="dv">2</span>]</span>
<span id="cb468-11"><a href="#cb468-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb468-12"><a href="#cb468-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Lo anterior ocurre porque el resultado de un comparador es un valor logico</span></span>
<span id="cb468-13"><a href="#cb468-13" aria-hidden="true" tabindex="-1"></a>np_numeros <span class="op">&gt;</span> <span class="dv">2</span></span></code></pre></div>
<div class="alert alert-block alert-success">
<p><b> Recordar :</b> En cualquier subconjunto: parentesis cuadrados y utilizar valores lógicos.</p>
</div>
<div class="sourceCode" id="cb469"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb469-1"><a href="#cb469-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Podemos escribirlo más general </span></span>
<span id="cb469-2"><a href="#cb469-2" aria-hidden="true" tabindex="-1"></a>condicion <span class="op">=</span> np_numeros <span class="op">&gt;</span> <span class="dv">2</span></span>
<span id="cb469-3"><a href="#cb469-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb469-4"><a href="#cb469-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np_numeros[condicion])</span>
<span id="cb469-5"><a href="#cb469-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Noten que obtenemos el mismo resultado que antes</span></span>
<span id="cb469-6"><a href="#cb469-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb469-7"><a href="#cb469-7" aria-hidden="true" tabindex="-1"></a>x1 <span class="op">=</span> np.array([<span class="dv">5</span>, <span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">9</span>])</span>
<span id="cb469-8"><a href="#cb469-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x1)</span>
<span id="cb469-9"><a href="#cb469-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb469-10"><a href="#cb469-10" aria-hidden="true" tabindex="-1"></a>x1[<span class="dv">0</span>]</span>
<span id="cb469-11"><a href="#cb469-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb469-12"><a href="#cb469-12" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.arange(<span class="dv">10</span>)</span>
<span id="cb469-13"><a href="#cb469-13" aria-hidden="true" tabindex="-1"></a>x</span>
<span id="cb469-14"><a href="#cb469-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb469-15"><a href="#cb469-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Primeros cinco elementos</span></span>
<span id="cb469-16"><a href="#cb469-16" aria-hidden="true" tabindex="-1"></a>x[:<span class="dv">5</span>]</span>
<span id="cb469-17"><a href="#cb469-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb469-18"><a href="#cb469-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Elements despúes del indicador cinco</span></span>
<span id="cb469-19"><a href="#cb469-19" aria-hidden="true" tabindex="-1"></a>x[<span class="dv">5</span>:]</span>
<span id="cb469-20"><a href="#cb469-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb469-21"><a href="#cb469-21" aria-hidden="true" tabindex="-1"></a><span class="co"># todos los elementos en posiciones pares</span></span>
<span id="cb469-22"><a href="#cb469-22" aria-hidden="true" tabindex="-1"></a>x[::<span class="dv">2</span>]</span>
<span id="cb469-23"><a href="#cb469-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb469-24"><a href="#cb469-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Todos los elementos, en saltos de 2 en 2, pero partiendo desde el 1</span></span>
<span id="cb469-25"><a href="#cb469-25" aria-hidden="true" tabindex="-1"></a>x[<span class="dv">1</span>::<span class="dv">2</span>]</span>
<span id="cb469-26"><a href="#cb469-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb469-27"><a href="#cb469-27" aria-hidden="true" tabindex="-1"></a>x[::<span class="op">-</span><span class="dv">1</span>]  <span class="co"># Todos los elementos, pero de atras a adelante</span></span></code></pre></div>
</div>
<div id="subconjuntos-en-arreglos-multidimensionales" class="section level5 hasAnchor" number="4.2.1.4.2">
<h5 class="hasAnchor"><span class="header-section-number">4.2.1.4.2</span> Subconjuntos en arreglos multidimensionales<a href="#subconjuntos-en-arreglos-multidimensionales" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb470"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb470-1"><a href="#cb470-1" aria-hidden="true" tabindex="-1"></a>x2 <span class="op">=</span> np.array([[<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">4</span>],</span>
<span id="cb470-2"><a href="#cb470-2" aria-hidden="true" tabindex="-1"></a>       [<span class="dv">7</span>, <span class="dv">6</span>, <span class="dv">8</span>, <span class="dv">8</span>],</span>
<span id="cb470-3"><a href="#cb470-3" aria-hidden="true" tabindex="-1"></a>       [<span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">7</span>]])</span>
<span id="cb470-4"><a href="#cb470-4" aria-hidden="true" tabindex="-1"></a>x2</span>
<span id="cb470-5"><a href="#cb470-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb470-6"><a href="#cb470-6" aria-hidden="true" tabindex="-1"></a>x2[<span class="dv">0</span>, <span class="dv">0</span>]</span>
<span id="cb470-7"><a href="#cb470-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb470-8"><a href="#cb470-8" aria-hidden="true" tabindex="-1"></a>x2[<span class="dv">2</span>, <span class="dv">0</span>]</span>
<span id="cb470-9"><a href="#cb470-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb470-10"><a href="#cb470-10" aria-hidden="true" tabindex="-1"></a>x2[<span class="dv">2</span>, <span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb470-11"><a href="#cb470-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb470-12"><a href="#cb470-12" aria-hidden="true" tabindex="-1"></a>x2</span>
<span id="cb470-13"><a href="#cb470-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb470-14"><a href="#cb470-14" aria-hidden="true" tabindex="-1"></a><span class="co"># dos filas, tres columnas</span></span>
<span id="cb470-15"><a href="#cb470-15" aria-hidden="true" tabindex="-1"></a>x2[:<span class="dv">2</span>, :<span class="dv">3</span>]</span>
<span id="cb470-16"><a href="#cb470-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb470-17"><a href="#cb470-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Dar vuelta todo</span></span>
<span id="cb470-18"><a href="#cb470-18" aria-hidden="true" tabindex="-1"></a>x2[::<span class="op">-</span><span class="dv">1</span>, ::<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb470-19"><a href="#cb470-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb470-20"><a href="#cb470-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x2[:, <span class="dv">0</span>]) <span class="co"># primera columna</span></span>
<span id="cb470-21"><a href="#cb470-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb470-22"><a href="#cb470-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x2[<span class="dv">0</span>, :])  <span class="co"># primera fila</span></span>
<span id="cb470-23"><a href="#cb470-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb470-24"><a href="#cb470-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x2[<span class="dv">0</span>])   <span class="co"># equivalente a x2[0, :]</span></span></code></pre></div>
</div>
</div>
<div id="filtrar-arreglos" class="section level4 hasAnchor" number="4.2.1.5">
<h4 class="hasAnchor"><span class="header-section-number">4.2.1.5</span> Filtrar arreglos<a href="#filtrar-arreglos" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb471"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb471-1"><a href="#cb471-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtros con mascaras</span></span>
<span id="cb471-2"><a href="#cb471-2" aria-hidden="true" tabindex="-1"></a>uno_al_diez <span class="op">=</span> np.arange(<span class="dv">1</span>,<span class="dv">10</span>)</span>
<span id="cb471-3"><a href="#cb471-3" aria-hidden="true" tabindex="-1"></a>uno_al_diez</span>
<span id="cb471-4"><a href="#cb471-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb471-5"><a href="#cb471-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Creo la mascara</span></span>
<span id="cb471-6"><a href="#cb471-6" aria-hidden="true" tabindex="-1"></a>mask <span class="op">=</span> uno_al_diez <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span> </span>
<span id="cb471-7"><a href="#cb471-7" aria-hidden="true" tabindex="-1"></a>mask</span>
<span id="cb471-8"><a href="#cb471-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb471-9"><a href="#cb471-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Va a dejar unicamente los elementos donde la condición </span></span>
<span id="cb471-10"><a href="#cb471-10" aria-hidden="true" tabindex="-1"></a><span class="co"># es cierta </span></span>
<span id="cb471-11"><a href="#cb471-11" aria-hidden="true" tabindex="-1"></a>uno_al_diez[mask]</span>
<span id="cb471-12"><a href="#cb471-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb471-13"><a href="#cb471-13" aria-hidden="true" tabindex="-1"></a>y_2d <span class="op">=</span> np.array([[<span class="dv">1</span>,<span class="dv">22</span>], [<span class="dv">2</span>,<span class="dv">21</span>], [<span class="dv">3</span>,<span class="dv">27</span>], [<span class="dv">4</span>,<span class="dv">26</span>]])</span>
<span id="cb471-14"><a href="#cb471-14" aria-hidden="true" tabindex="-1"></a>y_2d</span>
<span id="cb471-15"><a href="#cb471-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb471-16"><a href="#cb471-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Voy a colocar la condición dentro del subconjunto</span></span>
<span id="cb471-17"><a href="#cb471-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Es analogo a lo que esta arriba </span></span>
<span id="cb471-18"><a href="#cb471-18" aria-hidden="true" tabindex="-1"></a>y_2d[:,<span class="dv">0</span>][y_2d[:,<span class="dv">1</span>] <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span>]</span>
<span id="cb471-19"><a href="#cb471-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb471-20"><a href="#cb471-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Otra opción es utilizar np.where()</span></span>
<span id="cb471-21"><a href="#cb471-21" aria-hidden="true" tabindex="-1"></a>np.where(y_2d[:,<span class="dv">1</span>] <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span>)</span>
<span id="cb471-22"><a href="#cb471-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Retorna un array de INDICES en donde </span></span>
<span id="cb471-23"><a href="#cb471-23" aria-hidden="true" tabindex="-1"></a><span class="co"># se cumplen las condiciones</span></span>
<span id="cb471-24"><a href="#cb471-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb471-25"><a href="#cb471-25" aria-hidden="true" tabindex="-1"></a>np.where(y_2d <span class="op">==</span> <span class="dv">2</span>)</span>
<span id="cb471-26"><a href="#cb471-26" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(np.where(y_2d <span class="op">==</span> <span class="dv">2</span>))</span>
<span id="cb471-27"><a href="#cb471-27" aria-hidden="true" tabindex="-1"></a><span class="co"># El resultado es una tupla! (indice fila, indice columna)</span></span>
<span id="cb471-28"><a href="#cb471-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb471-29"><a href="#cb471-29" aria-hidden="true" tabindex="-1"></a>np.where(y_2d <span class="op">==</span> <span class="dv">2</span>)</span>
<span id="cb471-30"><a href="#cb471-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb471-31"><a href="#cb471-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Puedo ocupar np.where para modificar un arreglo según </span></span>
<span id="cb471-32"><a href="#cb471-32" aria-hidden="true" tabindex="-1"></a><span class="co"># alguna condición </span></span>
<span id="cb471-33"><a href="#cb471-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb471-34"><a href="#cb471-34" aria-hidden="true" tabindex="-1"></a>np.where(y_2d <span class="op">==</span> <span class="dv">2</span>, <span class="st">&quot; &quot;</span>, y_2d)</span>
<span id="cb471-35"><a href="#cb471-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Lo primero indica la condición, lo segundo el remplazo, </span></span>
<span id="cb471-36"><a href="#cb471-36" aria-hidden="true" tabindex="-1"></a><span class="co"># lo tercero donde se remplaza</span></span></code></pre></div>
</div>
<div id="modificar-arreglos" class="section level4 hasAnchor" number="4.2.1.6">
<h4 class="hasAnchor"><span class="header-section-number">4.2.1.6</span> Modificar arreglos<a href="#modificar-arreglos" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>Es importante tener ojo al modificar los arreglos</strong></p>
<div class="sourceCode" id="cb472"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb472-1"><a href="#cb472-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Recordemos el arreglo x2</span></span>
<span id="cb472-2"><a href="#cb472-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x2)</span>
<span id="cb472-3"><a href="#cb472-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb472-4"><a href="#cb472-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Hagamos un subconjunto del arreglo x2</span></span>
<span id="cb472-5"><a href="#cb472-5" aria-hidden="true" tabindex="-1"></a>x2_sub <span class="op">=</span> x2[:<span class="dv">2</span>, :<span class="dv">2</span>]</span>
<span id="cb472-6"><a href="#cb472-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x2_sub)</span>
<span id="cb472-7"><a href="#cb472-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb472-8"><a href="#cb472-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Modifiquemos el arreglo x2</span></span>
<span id="cb472-9"><a href="#cb472-9" aria-hidden="true" tabindex="-1"></a>x2_sub[<span class="dv">0</span>, <span class="dv">0</span>] <span class="op">=</span> <span class="dv">99</span></span>
<span id="cb472-10"><a href="#cb472-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x2_sub)</span>
<span id="cb472-11"><a href="#cb472-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb472-12"><a href="#cb472-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x2) <span class="co"># x2 cambio!!!</span></span>
<span id="cb472-13"><a href="#cb472-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb472-14"><a href="#cb472-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Para evitar que el objeto original se modifique utilizamos el metodo copy()</span></span>
<span id="cb472-15"><a href="#cb472-15" aria-hidden="true" tabindex="-1"></a>x2_sub_copy <span class="op">=</span> x2[:<span class="dv">2</span>, :<span class="dv">2</span>].copy()</span>
<span id="cb472-16"><a href="#cb472-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x2_sub_copy)</span>
<span id="cb472-17"><a href="#cb472-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb472-18"><a href="#cb472-18" aria-hidden="true" tabindex="-1"></a>x2_sub_copy[<span class="dv">0</span>, <span class="dv">0</span>] <span class="op">=</span> <span class="dv">42</span></span>
<span id="cb472-19"><a href="#cb472-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x2_sub_copy)</span>
<span id="cb472-20"><a href="#cb472-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb472-21"><a href="#cb472-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x2) <span class="co"># No se ha modificado!</span></span></code></pre></div>
</div>
<div id="manipular-arreglos" class="section level4 hasAnchor" number="4.2.1.7">
<h4 class="hasAnchor"><span class="header-section-number">4.2.1.7</span> Manipular arreglos<a href="#manipular-arreglos" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>También es posible combinar múltiples arrays en uno solo, y a la inversa, dividir un único array en múltiples arrays. Aquí veremos esas operaciones.</li>
<li>La concatenación, o unión de dos arrays en NumPy, se realiza principalmente utilizando las rutinas <strong>np.concatenate, np.vstack y np.hstack. np.concatenate</strong> toma una tupla o lista de arrays como primer argumento, como podemos ver aquí</li>
</ul>
<div id="concatenar-arreglos" class="section level5 hasAnchor" number="4.2.1.7.1">
<h5 class="hasAnchor"><span class="header-section-number">4.2.1.7.1</span> Concatenar arreglos<a href="#concatenar-arreglos" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb473"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb473-1"><a href="#cb473-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.array([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>])</span>
<span id="cb473-2"><a href="#cb473-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> np.array([<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>])</span>
<span id="cb473-3"><a href="#cb473-3" aria-hidden="true" tabindex="-1"></a>np.concatenate([x, y])</span>
<span id="cb473-4"><a href="#cb473-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-5"><a href="#cb473-5" aria-hidden="true" tabindex="-1"></a><span class="co"># O de otra forma</span></span>
<span id="cb473-6"><a href="#cb473-6" aria-hidden="true" tabindex="-1"></a>np.concatenate((x,y))</span>
<span id="cb473-7"><a href="#cb473-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-8"><a href="#cb473-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Agregar un nuevo arreglo</span></span>
<span id="cb473-9"><a href="#cb473-9" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> [<span class="dv">99</span>, <span class="dv">99</span>, <span class="dv">99</span>]</span>
<span id="cb473-10"><a href="#cb473-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.concatenate([x, y, z]))</span>
<span id="cb473-11"><a href="#cb473-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-12"><a href="#cb473-12" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> np.array([[<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>],</span>
<span id="cb473-13"><a href="#cb473-13" aria-hidden="true" tabindex="-1"></a>                 [<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>]])</span>
<span id="cb473-14"><a href="#cb473-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-15"><a href="#cb473-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenar con matrices de dimensión 2</span></span>
<span id="cb473-16"><a href="#cb473-16" aria-hidden="true" tabindex="-1"></a>np.concatenate([grid, grid])</span>
<span id="cb473-17"><a href="#cb473-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-18"><a href="#cb473-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenar con matrices de dimensión 2</span></span>
<span id="cb473-19"><a href="#cb473-19" aria-hidden="true" tabindex="-1"></a>np.concatenate([grid, grid], axis <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb473-20"><a href="#cb473-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-21"><a href="#cb473-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenar con matrices de dimensión 2</span></span>
<span id="cb473-22"><a href="#cb473-22" aria-hidden="true" tabindex="-1"></a>np.concatenate([grid, grid], axis <span class="op">=</span> <span class="dv">1</span>)</span></code></pre></div>
<ul>
<li>Para trabajar con matrices de dimensiones mixtas, puede ser más claro
utilizar las funciones np.vstack (pila vertical) y np.hstack (pila horizontal):</li>
</ul>
<div class="sourceCode" id="cb474"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb474-1"><a href="#cb474-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pegar arreglos verticalmente</span></span>
<span id="cb474-2"><a href="#cb474-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.array([[<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>], </span>
<span id="cb474-3"><a href="#cb474-3" aria-hidden="true" tabindex="-1"></a>              [<span class="op">-</span><span class="dv">11</span>, <span class="op">-</span><span class="dv">2</span>, <span class="op">-</span><span class="dv">3</span>]])</span>
<span id="cb474-4"><a href="#cb474-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb474-5"><a href="#cb474-5" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> np.array([[<span class="dv">9</span>, <span class="dv">8</span>, <span class="dv">7</span>],</span>
<span id="cb474-6"><a href="#cb474-6" aria-hidden="true" tabindex="-1"></a>                 [<span class="dv">6</span>, <span class="dv">5</span>, <span class="dv">4</span>]])</span>
<span id="cb474-7"><a href="#cb474-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb474-8"><a href="#cb474-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.vstack([x, y]))</span>
<span id="cb474-9"><a href="#cb474-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb474-10"><a href="#cb474-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Pegar arreglos horizontalmente</span></span>
<span id="cb474-11"><a href="#cb474-11" aria-hidden="true" tabindex="-1"></a>np.hstack([y, x])</span></code></pre></div>
</div>
<div id="separar-arreglos" class="section level5 hasAnchor" number="4.2.1.7.2">
<h5 class="hasAnchor"><span class="header-section-number">4.2.1.7.2</span> Separar arreglos<a href="#separar-arreglos" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb475"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb475-1"><a href="#cb475-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Puedo indicarle el numero de grupos </span></span>
<span id="cb475-2"><a href="#cb475-2" aria-hidden="true" tabindex="-1"></a>arr <span class="op">=</span> np.array([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>])</span>
<span id="cb475-3"><a href="#cb475-3" aria-hidden="true" tabindex="-1"></a>newarr <span class="op">=</span> np.array_split(arr, <span class="dv">4</span>)</span>
<span id="cb475-4"><a href="#cb475-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(newarr)</span>
<span id="cb475-5"><a href="#cb475-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb475-6"><a href="#cb475-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Puedo indicarle los indices de los grupos</span></span>
<span id="cb475-7"><a href="#cb475-7" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">99</span>, <span class="dv">99</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>]</span>
<span id="cb475-8"><a href="#cb475-8" aria-hidden="true" tabindex="-1"></a>x1, x2, x3 <span class="op">=</span> np.split(x, [<span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb475-9"><a href="#cb475-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x1, x2, x3)</span></code></pre></div>
</div>
<div id="trasponer-arreglos" class="section level5 hasAnchor" number="4.2.1.7.3">
<h5 class="hasAnchor"><span class="header-section-number">4.2.1.7.3</span> Trasponer arreglos<a href="#trasponer-arreglos" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb476"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb476-1"><a href="#cb476-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x)</span>
<span id="cb476-2"><a href="#cb476-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb476-3"><a href="#cb476-3" aria-hidden="true" tabindex="-1"></a>xT <span class="op">=</span> np.transpose(x)</span>
<span id="cb476-4"><a href="#cb476-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(xT)</span>
<span id="cb476-5"><a href="#cb476-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Noten que ahora es un vector fila</span></span>
<span id="cb476-6"><a href="#cb476-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb476-7"><a href="#cb476-7" aria-hidden="true" tabindex="-1"></a>np_2d_t <span class="op">=</span> np.transpose(np_2d)</span>
<span id="cb476-8"><a href="#cb476-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np_2d_t)</span>
<span id="cb476-9"><a href="#cb476-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb476-10"><a href="#cb476-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Tambien puedo aplicarlo como método. </span></span>
<span id="cb476-11"><a href="#cb476-11" aria-hidden="true" tabindex="-1"></a>np_2d.T</span></code></pre></div>
</div>
<div id="otras-funciones-para-crear-arreglos" class="section level5 hasAnchor" number="4.2.1.7.4">
<h5 class="hasAnchor"><span class="header-section-number">4.2.1.7.4</span> Otras funciones para crear arreglos<a href="#otras-funciones-para-crear-arreglos" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb477"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb477-1"><a href="#cb477-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Crea un arreglo unidimensional de zeros</span></span>
<span id="cb477-2"><a href="#cb477-2" aria-hidden="true" tabindex="-1"></a>np.zeros(<span class="dv">10</span>)</span>
<span id="cb477-3"><a href="#cb477-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb477-4"><a href="#cb477-4" aria-hidden="true" tabindex="-1"></a>np.zeros((<span class="dv">10</span>,<span class="dv">10</span>))</span>
<span id="cb477-5"><a href="#cb477-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb477-6"><a href="#cb477-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear una matriz de las dimensiones que se le indican </span></span>
<span id="cb477-7"><a href="#cb477-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Notar parentesis cuadrado</span></span>
<span id="cb477-8"><a href="#cb477-8" aria-hidden="true" tabindex="-1"></a>np.zeros([<span class="dv">10</span>,<span class="dv">10</span>])</span>
<span id="cb477-9"><a href="#cb477-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb477-10"><a href="#cb477-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Crea una matriz de 3x5 puntos flotantes llena de unos</span></span>
<span id="cb477-11"><a href="#cb477-11" aria-hidden="true" tabindex="-1"></a>np.ones((<span class="dv">3</span>, <span class="dv">5</span>), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb477-12"><a href="#cb477-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb477-13"><a href="#cb477-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Crea una matriz de 3x5 llena de 3,14</span></span>
<span id="cb477-14"><a href="#cb477-14" aria-hidden="true" tabindex="-1"></a>np.full((<span class="dv">3</span>, <span class="dv">5</span>), <span class="fl">3.14</span>)</span>
<span id="cb477-15"><a href="#cb477-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb477-16"><a href="#cb477-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Crea un array lleno de una secuencia lineal</span></span>
<span id="cb477-17"><a href="#cb477-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Empezando en 0, terminando en 20, pasando por 2</span></span>
<span id="cb477-18"><a href="#cb477-18" aria-hidden="true" tabindex="-1"></a><span class="co"># (esto es similar a la función incorporada range())</span></span>
<span id="cb477-19"><a href="#cb477-19" aria-hidden="true" tabindex="-1"></a>np.arange(<span class="dv">0</span>, <span class="dv">20</span>, <span class="dv">2</span>)</span>
<span id="cb477-20"><a href="#cb477-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb477-21"><a href="#cb477-21" aria-hidden="true" tabindex="-1"></a>np.arange(<span class="op">-</span><span class="dv">3</span>,<span class="dv">4</span>)</span>
<span id="cb477-22"><a href="#cb477-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Incluye el primer elemento, pero el último no</span></span>
<span id="cb477-23"><a href="#cb477-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb477-24"><a href="#cb477-24" aria-hidden="true" tabindex="-1"></a>np.arange(<span class="op">-</span><span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">3</span>)</span>
<span id="cb477-25"><a href="#cb477-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb477-26"><a href="#cb477-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear una matriz 3x3 de valores aleatorios normalmente distribuidos</span></span>
<span id="cb477-27"><a href="#cb477-27" aria-hidden="true" tabindex="-1"></a><span class="co"># con media 0 y desviación estándar 1</span></span>
<span id="cb477-28"><a href="#cb477-28" aria-hidden="true" tabindex="-1"></a>np.random.normal(<span class="dv">0</span>, <span class="dv">1</span>, (<span class="dv">3</span>, <span class="dv">3</span>))</span>
<span id="cb477-29"><a href="#cb477-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb477-30"><a href="#cb477-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Crea una matriz 3x3 de enteros aleatorios en el intervalo [0, 10)</span></span>
<span id="cb477-31"><a href="#cb477-31" aria-hidden="true" tabindex="-1"></a>np.random.randint(<span class="dv">0</span>, <span class="dv">10</span>, (<span class="dv">3</span>, <span class="dv">3</span>))</span>
<span id="cb477-32"><a href="#cb477-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb477-33"><a href="#cb477-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Crea una matriz identidad</span></span>
<span id="cb477-34"><a href="#cb477-34" aria-hidden="true" tabindex="-1"></a>np.eye(<span class="dv">3</span>)</span>
<span id="cb477-35"><a href="#cb477-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb477-36"><a href="#cb477-36" aria-hidden="true" tabindex="-1"></a><span class="co">#  Crear una matriz de valores espaciados uniformemente</span></span>
<span id="cb477-37"><a href="#cb477-37" aria-hidden="true" tabindex="-1"></a><span class="co"># espaciados entre sí</span></span>
<span id="cb477-38"><a href="#cb477-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb477-39"><a href="#cb477-39" aria-hidden="true" tabindex="-1"></a>np.linspace(<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">9</span>)</span>
<span id="cb477-40"><a href="#cb477-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb477-41"><a href="#cb477-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Solo valores aleatorios</span></span>
<span id="cb477-42"><a href="#cb477-42" aria-hidden="true" tabindex="-1"></a>np.random.random((<span class="dv">2</span>,<span class="dv">4</span>))</span>
<span id="cb477-43"><a href="#cb477-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb477-44"><a href="#cb477-44" aria-hidden="true" tabindex="-1"></a><span class="co"># La primera parte es el modulo de numpy, el segundo </span></span>
<span id="cb477-45"><a href="#cb477-45" aria-hidden="true" tabindex="-1"></a><span class="co"># es el nombre de la función.</span></span>
<span id="cb477-46"><a href="#cb477-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb477-47"><a href="#cb477-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear un arreglo vacio</span></span>
<span id="cb477-48"><a href="#cb477-48" aria-hidden="true" tabindex="-1"></a>np.empty((<span class="dv">3</span>,<span class="dv">2</span>))</span>
<span id="cb477-49"><a href="#cb477-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb477-50"><a href="#cb477-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape: modifica las dimensiones de un arreglo </span></span>
<span id="cb477-51"><a href="#cb477-51" aria-hidden="true" tabindex="-1"></a>array <span class="op">=</span> np.array([[<span class="dv">1</span>,<span class="dv">2</span>], [<span class="dv">5</span>,<span class="dv">7</span>], [<span class="dv">6</span>,<span class="dv">6</span>]])</span>
<span id="cb477-52"><a href="#cb477-52" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(array)</span>
<span id="cb477-53"><a href="#cb477-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb477-54"><a href="#cb477-54" aria-hidden="true" tabindex="-1"></a>array.reshape((<span class="dv">2</span>,<span class="dv">3</span>))</span>
<span id="cb477-55"><a href="#cb477-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb477-56"><a href="#cb477-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Flatten: toma todos los elementos de un arreglo y los </span></span>
<span id="cb477-57"><a href="#cb477-57" aria-hidden="true" tabindex="-1"></a><span class="co"># deja en una dimensión </span></span>
<span id="cb477-58"><a href="#cb477-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb477-59"><a href="#cb477-59" aria-hidden="true" tabindex="-1"></a>array.flatten()</span>
<span id="cb477-60"><a href="#cb477-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb477-61"><a href="#cb477-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Podemos componer funciones, volver al origina </span></span>
<span id="cb477-62"><a href="#cb477-62" aria-hidden="true" tabindex="-1"></a>array.flatten().reshape((<span class="dv">2</span>,<span class="dv">3</span>))</span></code></pre></div>
</div>
<div id="ordenar-arreglos" class="section level5 hasAnchor" number="4.2.1.7.5">
<h5 class="hasAnchor"><span class="header-section-number">4.2.1.7.5</span> Ordenar arreglos<a href="#ordenar-arreglos" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb478"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb478-1"><a href="#cb478-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Como función</span></span>
<span id="cb478-2"><a href="#cb478-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.array([<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">5</span>])</span>
<span id="cb478-3"><a href="#cb478-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x)</span>
<span id="cb478-4"><a href="#cb478-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb478-5"><a href="#cb478-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.sort(x))</span>
<span id="cb478-6"><a href="#cb478-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb478-7"><a href="#cb478-7" aria-hidden="true" tabindex="-1"></a>np.sort?</span>
<span id="cb478-8"><a href="#cb478-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb478-9"><a href="#cb478-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Como método</span></span>
<span id="cb478-10"><a href="#cb478-10" aria-hidden="true" tabindex="-1"></a>x.sort()</span>
<span id="cb478-11"><a href="#cb478-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x)</span>
<span id="cb478-12"><a href="#cb478-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb478-13"><a href="#cb478-13" aria-hidden="true" tabindex="-1"></a><span class="co"># argsort() retorna los indices</span></span>
<span id="cb478-14"><a href="#cb478-14" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.array([<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">5</span>])</span>
<span id="cb478-15"><a href="#cb478-15" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> np.argsort(x)</span>
<span id="cb478-16"><a href="#cb478-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(i)</span>
<span id="cb478-17"><a href="#cb478-17" aria-hidden="true" tabindex="-1"></a><span class="co"># El primero es el menor</span></span>
<span id="cb478-18"><a href="#cb478-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb478-19"><a href="#cb478-19" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;+ **Si queremos ordenar por filas o columnas?**&quot;&quot;&quot;</span></span>
<span id="cb478-20"><a href="#cb478-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb478-21"><a href="#cb478-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Vamos a utilizar el argumento axis</span></span>
<span id="cb478-22"><a href="#cb478-22" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> np.random.randint(<span class="dv">0</span>, <span class="dv">10</span>, (<span class="dv">3</span>, <span class="dv">3</span>))</span>
<span id="cb478-23"><a href="#cb478-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(a)</span>
<span id="cb478-24"><a href="#cb478-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb478-25"><a href="#cb478-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Ordenamos por columnas</span></span>
<span id="cb478-26"><a href="#cb478-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.sort(a, axis <span class="op">=</span> <span class="dv">0</span>))</span>
<span id="cb478-27"><a href="#cb478-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb478-28"><a href="#cb478-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Ordenamos por filas</span></span>
<span id="cb478-29"><a href="#cb478-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.sort(a, axis <span class="op">=</span> <span class="dv">1</span>))</span></code></pre></div>
<ul>
<li>Notar que trata a cada columna/fila como arreglos independientes.</li>
<li>Cualquier relación entre columnas/filas se pierde al ordenarlos.</li>
</ul>
<div class="sourceCode" id="cb479"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb479-1"><a href="#cb479-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Puedo ordenar con la siguiente regla: </span></span>
<span id="cb479-2"><a href="#cb479-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb479-3"><a href="#cb479-3" aria-hidden="true" tabindex="-1"></a><span class="co"># indica un número: total de elementos a ordenar</span></span>
<span id="cb479-4"><a href="#cb479-4" aria-hidden="true" tabindex="-1"></a><span class="co"># a la izquierda los menores</span></span>
<span id="cb479-5"><a href="#cb479-5" aria-hidden="true" tabindex="-1"></a><span class="co"># a la derecha los mayores</span></span>
<span id="cb479-6"><a href="#cb479-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb479-7"><a href="#cb479-7" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.array([<span class="dv">7</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">5</span>, <span class="dv">4</span>])</span>
<span id="cb479-8"><a href="#cb479-8" aria-hidden="true" tabindex="-1"></a>np.partition(x, <span class="dv">3</span>)</span>
<span id="cb479-9"><a href="#cb479-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb479-10"><a href="#cb479-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Analogo para un 2d </span></span>
<span id="cb479-11"><a href="#cb479-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.partition(a, <span class="dv">2</span>, axis<span class="op">=</span><span class="dv">1</span>))</span></code></pre></div>
</div>
</div>
<div id="broadcasting" class="section level4 hasAnchor" number="4.2.1.8">
<h4 class="hasAnchor"><span class="header-section-number">4.2.1.8</span> Broadcasting<a href="#broadcasting" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p>Es una de las razones de que Python sea tan eficiente.</p></li>
<li><p>Permite operar entre objetos (ej. matrices) que tienen distinta dimensión.</p></li>
<li><p>La transmisión en NumPy sigue un estricto conjunto de reglas para determinar la interacción entre las dos matrices:</p>
<ul>
<li><p>Regla 1: Si las dos matrices difieren en su número de dimensiones, el objeto de la que tiene menos dimensiones se rellena con unos en su lado frontal (izquierdo).</p></li>
<li><p>Regla 2: Si la forma de las dos matrices no coincide en ninguna dimensión, la matriz con forma igual a 1 en esa dimensión se estira para que coincida con la otra forma.</p></li>
<li><p>Regla 3: Si en alguna dimensión los tamaños no coinciden y ninguno es igual a 1, se produce un error.</p></li>
</ul></li>
<li><p>Más info: <a href="https://numpy.org/doc/stable/user/basics.broadcasting.html" class="uri">https://numpy.org/doc/stable/user/basics.broadcasting.html</a></p></li>
</ul>
<div class="figure">
<img src="attachment:image.png" alt="" />
<p class="caption">image.png</p>
</div>
<div class="figure">
<img src="attachment:image.png" alt="" />
<p class="caption">image.png</p>
</div>
<div class="figure">
<img src="attachment:image.png" alt="" />
<p class="caption">image.png</p>
</div>
<div class="sourceCode" id="cb480"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb480-1"><a href="#cb480-1" aria-hidden="true" tabindex="-1"></a>array2_2 <span class="op">=</span> np.array([<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>]).reshape(<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb480-2"><a href="#cb480-2" aria-hidden="true" tabindex="-1"></a>array2_1 <span class="op">=</span> np.array([<span class="dv">0</span>,<span class="dv">1</span>]).reshape((<span class="dv">2</span>,<span class="dv">1</span>))</span>
<span id="cb480-3"><a href="#cb480-3" aria-hidden="true" tabindex="-1"></a>array1_2 <span class="op">=</span> np.array([<span class="dv">0</span>,<span class="dv">1</span>]).reshape((<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb480-4"><a href="#cb480-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-5"><a href="#cb480-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(array2_2)</span>
<span id="cb480-6"><a href="#cb480-6" aria-hidden="true" tabindex="-1"></a>np.shape(array2_2)</span>
<span id="cb480-7"><a href="#cb480-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-8"><a href="#cb480-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(array2_1)</span>
<span id="cb480-9"><a href="#cb480-9" aria-hidden="true" tabindex="-1"></a>np.shape(array2_1)</span>
<span id="cb480-10"><a href="#cb480-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-11"><a href="#cb480-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(array1_2)</span>
<span id="cb480-12"><a href="#cb480-12" aria-hidden="true" tabindex="-1"></a>np.shape(array1_2)</span>
<span id="cb480-13"><a href="#cb480-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-14"><a href="#cb480-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Caso 1: sumo a cada columna</span></span>
<span id="cb480-15"><a href="#cb480-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(array2_2 <span class="op">+</span> array2_1)</span>
<span id="cb480-16"><a href="#cb480-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-17"><a href="#cb480-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Caso 2: sumo a cada fila</span></span>
<span id="cb480-18"><a href="#cb480-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(array2_2 <span class="op">+</span> array1_2)</span>
<span id="cb480-19"><a href="#cb480-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-20"><a href="#cb480-20" aria-hidden="true" tabindex="-1"></a><span class="co"># ¿Que hizo python? : respeto siempre las filas.</span></span>
<span id="cb480-21"><a href="#cb480-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-22"><a href="#cb480-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Todo lo anterior aplica para otras operaciones.</span></span>
<span id="cb480-23"><a href="#cb480-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-24"><a href="#cb480-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Aquí tambien hay de alguna forma bc</span></span>
<span id="cb480-25"><a href="#cb480-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-26"><a href="#cb480-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(a)</span>
<span id="cb480-27"><a href="#cb480-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-28"><a href="#cb480-28" aria-hidden="true" tabindex="-1"></a>a <span class="op">+</span> <span class="dv">5</span></span>
<span id="cb480-29"><a href="#cb480-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Es similar a transformar 5 en [5,5,5]</span></span>
<span id="cb480-30"><a href="#cb480-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-31"><a href="#cb480-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Otro ejemplo</span></span>
<span id="cb480-32"><a href="#cb480-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-33"><a href="#cb480-33" aria-hidden="true" tabindex="-1"></a>M <span class="op">=</span> np.ones((<span class="dv">3</span>, <span class="dv">3</span>))</span>
<span id="cb480-34"><a href="#cb480-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(M)</span>
<span id="cb480-35"><a href="#cb480-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-36"><a href="#cb480-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(a)</span>
<span id="cb480-37"><a href="#cb480-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-38"><a href="#cb480-38" aria-hidden="true" tabindex="-1"></a>M <span class="op">+</span> a</span></code></pre></div>
<div class="figure">
<img src="attachment:image.png" alt="" />
<p class="caption">image.png</p>
</div>
<div class="sourceCode" id="cb481"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb481-1"><a href="#cb481-1" aria-hidden="true" tabindex="-1"></a>M <span class="op">=</span> np.ones((<span class="dv">2</span>, <span class="dv">3</span>))</span>
<span id="cb481-2"><a href="#cb481-2" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> np.arange(<span class="dv">3</span>)</span>
<span id="cb481-3"><a href="#cb481-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb481-4"><a href="#cb481-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(M)</span>
<span id="cb481-5"><a href="#cb481-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb481-6"><a href="#cb481-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(a)</span>
<span id="cb481-7"><a href="#cb481-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb481-8"><a href="#cb481-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(M.shape)</span>
<span id="cb481-9"><a href="#cb481-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(a.shape)</span></code></pre></div>
<ul>
<li>Regla 1: a tiene menos dimension, por lo tanto, a la izquierda con 1.</li>
</ul>
<p>M -&gt; (2,3)
a -&gt;(1,3)</p>
<ul>
<li>Regla 2: como difieren en la primera dimensión, estiramos la más pequeña hasta hacerla coincidir</li>
</ul>
<div class="sourceCode" id="cb482"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb482-1"><a href="#cb482-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(M <span class="op">+</span> a)</span>
<span id="cb482-2"><a href="#cb482-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb482-3"><a href="#cb482-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Ejemplo 2: Cuando ambos tienen que hacer broadcasting</span></span>
<span id="cb482-4"><a href="#cb482-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb482-5"><a href="#cb482-5" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> np.arange(<span class="dv">3</span>).reshape((<span class="dv">3</span>, <span class="dv">1</span>))</span>
<span id="cb482-6"><a href="#cb482-6" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> np.arange(<span class="dv">3</span>)</span>
<span id="cb482-7"><a href="#cb482-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb482-8"><a href="#cb482-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(a)</span>
<span id="cb482-9"><a href="#cb482-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb482-10"><a href="#cb482-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(b)</span>
<span id="cb482-11"><a href="#cb482-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb482-12"><a href="#cb482-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(a.shape)</span>
<span id="cb482-13"><a href="#cb482-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(b.shape)</span></code></pre></div>
<ul>
<li>Regla 1: el de dimensión más baja con 1 a la izquierda</li>
</ul>
<p>(3,1)
(1,3)</p>
<ul>
<li>Regla 2: ambos deben coincidir
(3,3) y (3,3).</li>
</ul>
<div class="sourceCode" id="cb483"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb483-1"><a href="#cb483-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(a <span class="op">+</span> b)</span>
<span id="cb483-2"><a href="#cb483-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb483-3"><a href="#cb483-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Ejemplo 3</span></span>
<span id="cb483-4"><a href="#cb483-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb483-5"><a href="#cb483-5" aria-hidden="true" tabindex="-1"></a>M <span class="op">=</span> np.ones((<span class="dv">3</span>, <span class="dv">2</span>))</span>
<span id="cb483-6"><a href="#cb483-6" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> np.arange(<span class="dv">3</span>)</span></code></pre></div>
<ul>
<li>Regla 1:</li>
</ul>
<p>M -&gt; 3,2
a -&gt; 1,3</p>
<ul>
<li>Regla 2: La dimensión 1 se modifica hasta que sean iguales</li>
</ul>
<p>M -&gt; 3,2
a -&gt; 3,3</p>
<div class="sourceCode" id="cb484"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb484-1"><a href="#cb484-1" aria-hidden="true" tabindex="-1"></a>M <span class="op">+</span> a</span></code></pre></div>
</div>
<div id="operaciones-matematicas-en-arreglos" class="section level4 hasAnchor" number="4.2.1.9">
<h4 class="hasAnchor"><span class="header-section-number">4.2.1.9</span> Operaciones matematicas en arreglos<a href="#operaciones-matematicas-en-arreglos" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb485"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb485-1"><a href="#cb485-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Para hacer operaciones</span></span>
<span id="cb485-2"><a href="#cb485-2" aria-hidden="true" tabindex="-1"></a>np_mat <span class="op">=</span> np.array([[<span class="dv">1</span>, <span class="dv">2</span>],</span>
<span id="cb485-3"><a href="#cb485-3" aria-hidden="true" tabindex="-1"></a>                   [<span class="dv">3</span>, <span class="dv">4</span>],</span>
<span id="cb485-4"><a href="#cb485-4" aria-hidden="true" tabindex="-1"></a>                   [<span class="dv">5</span>, <span class="dv">6</span>]])</span>
<span id="cb485-5"><a href="#cb485-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np_mat <span class="op">**</span> <span class="dv">1</span>)</span>
<span id="cb485-6"><a href="#cb485-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb485-7"><a href="#cb485-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.array([<span class="dv">10</span>, <span class="dv">10</span>]))</span>
<span id="cb485-8"><a href="#cb485-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb485-9"><a href="#cb485-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np_mat <span class="op">+</span> np.array([<span class="dv">10</span>, <span class="dv">10</span>]))</span>
<span id="cb485-10"><a href="#cb485-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb485-11"><a href="#cb485-11" aria-hidden="true" tabindex="-1"></a>np_mat <span class="op">+</span> np_mat</span></code></pre></div>
<div id="operaciones-vectorizadas-en-python" class="section level5 hasAnchor" number="4.2.1.9.1">
<h5 class="hasAnchor"><span class="header-section-number">4.2.1.9.1</span> Operaciones vectorizadas en Python<a href="#operaciones-vectorizadas-en-python" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb486"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb486-1"><a href="#cb486-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dividirporvalores(valores):</span>
<span id="cb486-2"><a href="#cb486-2" aria-hidden="true" tabindex="-1"></a>    output <span class="op">=</span> np.empty(<span class="bu">len</span>(valores))</span>
<span id="cb486-3"><a href="#cb486-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(valores)):</span>
<span id="cb486-4"><a href="#cb486-4" aria-hidden="true" tabindex="-1"></a>        output[i] <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> valores[i]</span>
<span id="cb486-5"><a href="#cb486-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> output</span>
<span id="cb486-6"><a href="#cb486-6" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb486-7"><a href="#cb486-7" aria-hidden="true" tabindex="-1"></a>arreglo <span class="op">=</span> np.random.randint(<span class="dv">1</span>, <span class="dv">20</span>, size<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb486-8"><a href="#cb486-8" aria-hidden="true" tabindex="-1"></a>dividirporvalores(arreglo)</span>
<span id="cb486-9"><a href="#cb486-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb486-10"><a href="#cb486-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Commented out IPython magic to ensure Python compatibility.</span></span>
<span id="cb486-11"><a href="#cb486-11" aria-hidden="true" tabindex="-1"></a>arreglo_muygrande <span class="op">=</span> np.random.randint(<span class="dv">1</span>, <span class="dv">100</span>, size<span class="op">=</span><span class="dv">1000000</span>)</span>
<span id="cb486-12"><a href="#cb486-12" aria-hidden="true" tabindex="-1"></a><span class="co"># %timeit dividirporvalores(arreglo_muygrande)</span></span></code></pre></div>
<ul>
<li>Al vectorizar operaciones se reduce el tiempo de ejecución.</li>
<li>Las típicas operaciones que realizamos muchas veces en estos lenguajes son las que permiten disminuir el tiempo de ejecución en los programas.</li>
</ul>
<div class="sourceCode" id="cb487"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb487-1"><a href="#cb487-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dividirporvalores(arreglo))</span>
<span id="cb487-2"><a href="#cb487-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="fl">1.0</span> <span class="op">/</span> arreglo)</span>
<span id="cb487-3"><a href="#cb487-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb487-4"><a href="#cb487-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Commented out IPython magic to ensure Python compatibility.</span></span>
<span id="cb487-5"><a href="#cb487-5" aria-hidden="true" tabindex="-1"></a><span class="co"># %timeit (1.0 / arreglo_muygrande)</span></span>
<span id="cb487-6"><a href="#cb487-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb487-7"><a href="#cb487-7" aria-hidden="true" tabindex="-1"></a>np.arange(<span class="dv">5</span>) <span class="op">/</span> np.arange(<span class="dv">1</span>, <span class="dv">6</span>)</span>
<span id="cb487-8"><a href="#cb487-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb487-9"><a href="#cb487-9" aria-hidden="true" tabindex="-1"></a>np.arange(<span class="dv">100000</span>) <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb487-10"><a href="#cb487-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb487-11"><a href="#cb487-11" aria-hidden="true" tabindex="-1"></a>np.arange(<span class="dv">100000</span>).<span class="bu">sum</span>()</span></code></pre></div>
</div>
<div id="operaciones-básicas-y-funciones-básicas" class="section level5 hasAnchor" number="4.2.1.9.2">
<h5 class="hasAnchor"><span class="header-section-number">4.2.1.9.2</span> Operaciones básicas y funciones básicas<a href="#operaciones-básicas-y-funciones-básicas" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb488"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb488-1"><a href="#cb488-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.arange(<span class="dv">4</span>)</span>
<span id="cb488-2"><a href="#cb488-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;x     =&quot;</span>, x)</span>
<span id="cb488-3"><a href="#cb488-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;x + 5 =&quot;</span>, x <span class="op">+</span> <span class="dv">5</span>)</span>
<span id="cb488-4"><a href="#cb488-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;x - 5 =&quot;</span>, x <span class="op">-</span> <span class="dv">5</span>)</span>
<span id="cb488-5"><a href="#cb488-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;x * 2 =&quot;</span>, x <span class="op">*</span> <span class="dv">2</span>)</span>
<span id="cb488-6"><a href="#cb488-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;x / 2 =&quot;</span>, x <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb488-7"><a href="#cb488-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;x // 2 =&quot;</span>, x <span class="op">//</span> <span class="dv">2</span>)  <span class="co"># floor division</span></span>
<span id="cb488-8"><a href="#cb488-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;-x     = &quot;</span>, <span class="op">-</span>x)</span>
<span id="cb488-9"><a href="#cb488-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;x ** 2 = &quot;</span>, x <span class="op">**</span> <span class="dv">2</span>)</span>
<span id="cb488-10"><a href="#cb488-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;x % 2  = &quot;</span>, x <span class="op">%</span> <span class="dv">2</span>)</span>
<span id="cb488-11"><a href="#cb488-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Todas estas funciones/operadores se encuentran como metodos</span></span>
<span id="cb488-12"><a href="#cb488-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-13"><a href="#cb488-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Funciones como metodos</span></span>
<span id="cb488-14"><a href="#cb488-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.add(x, <span class="dv">2</span>))</span>
<span id="cb488-15"><a href="#cb488-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.multiply(x,<span class="dv">2</span>))</span>
<span id="cb488-16"><a href="#cb488-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.divide(x,<span class="dv">2</span>))</span>
<span id="cb488-17"><a href="#cb488-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.subtract(x,<span class="dv">2</span>))</span>
<span id="cb488-18"><a href="#cb488-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-19"><a href="#cb488-19" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> np.array([<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>])</span>
<span id="cb488-20"><a href="#cb488-20" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> np.array([[<span class="fl">1.5</span>,<span class="op">-</span><span class="dv">32</span>,<span class="op">-</span><span class="dv">33</span>], [<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>]])</span>
<span id="cb488-21"><a href="#cb488-21" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb488-22"><a href="#cb488-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-23"><a href="#cb488-23" aria-hidden="true" tabindex="-1"></a>np.absolute(b)</span>
<span id="cb488-24"><a href="#cb488-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-25"><a href="#cb488-25" aria-hidden="true" tabindex="-1"></a>np.exp(b)</span>
<span id="cb488-26"><a href="#cb488-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-27"><a href="#cb488-27" aria-hidden="true" tabindex="-1"></a>np.sqrt(b)</span>
<span id="cb488-28"><a href="#cb488-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-29"><a href="#cb488-29" aria-hidden="true" tabindex="-1"></a>np.sin(a)</span>
<span id="cb488-30"><a href="#cb488-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-31"><a href="#cb488-31" aria-hidden="true" tabindex="-1"></a>np.cos(b)</span>
<span id="cb488-32"><a href="#cb488-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-33"><a href="#cb488-33" aria-hidden="true" tabindex="-1"></a>np.log(a)</span></code></pre></div>
</div>
<div id="operaciones-entre-distintos-tipos-de-objeto" class="section level5 hasAnchor" number="4.2.1.9.3">
<h5 class="hasAnchor"><span class="header-section-number">4.2.1.9.3</span> Operaciones entre distintos tipos de objeto<a href="#operaciones-entre-distintos-tipos-de-objeto" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb489"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb489-1"><a href="#cb489-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> np.array([<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>])</span>
<span id="cb489-2"><a href="#cb489-2" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> np.array([[<span class="fl">1.5</span>,<span class="dv">2</span>,<span class="dv">3</span>], [<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>]]).reshape(<span class="dv">2</span>,<span class="dv">3</span>)</span>
<span id="cb489-3"><a href="#cb489-3" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> np.array([[<span class="dv">2</span>,<span class="dv">3</span>],[<span class="dv">3</span>,<span class="dv">3</span>],[<span class="dv">3</span>,<span class="dv">5</span>]]).reshape(<span class="dv">3</span>,<span class="dv">2</span>)</span>
<span id="cb489-4"><a href="#cb489-4" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb489-5"><a href="#cb489-5" aria-hidden="true" tabindex="-1"></a>e <span class="op">=</span> np.array([[<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">3</span>]])</span>
<span id="cb489-6"><a href="#cb489-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-7"><a href="#cb489-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(a)</span>
<span id="cb489-8"><a href="#cb489-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-9"><a href="#cb489-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(b)</span>
<span id="cb489-10"><a href="#cb489-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-11"><a href="#cb489-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(c)</span>
<span id="cb489-12"><a href="#cb489-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-13"><a href="#cb489-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(d)</span>
<span id="cb489-14"><a href="#cb489-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-15"><a href="#cb489-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(e)</span>
<span id="cb489-16"><a href="#cb489-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-17"><a href="#cb489-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Vector con escalar</span></span>
<span id="cb489-18"><a href="#cb489-18" aria-hidden="true" tabindex="-1"></a>a <span class="op">+</span> d</span>
<span id="cb489-19"><a href="#cb489-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-20"><a href="#cb489-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Matriz con escalar</span></span>
<span id="cb489-21"><a href="#cb489-21" aria-hidden="true" tabindex="-1"></a>b <span class="op">-</span> d</span>
<span id="cb489-22"><a href="#cb489-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-23"><a href="#cb489-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Matriz con matriz (suma)</span></span>
<span id="cb489-24"><a href="#cb489-24" aria-hidden="true" tabindex="-1"></a>b <span class="op">+</span> b</span>
<span id="cb489-25"><a href="#cb489-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-26"><a href="#cb489-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Matriz con matriz (producto)</span></span>
<span id="cb489-27"><a href="#cb489-27" aria-hidden="true" tabindex="-1"></a>b <span class="op">*</span> c</span>
<span id="cb489-28"><a href="#cb489-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-29"><a href="#cb489-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Si quiero multiplicar matrices normalmente</span></span>
<span id="cb489-30"><a href="#cb489-30" aria-hidden="true" tabindex="-1"></a>np.dot(b,c)</span>
<span id="cb489-31"><a href="#cb489-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-32"><a href="#cb489-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Otro ejemplo</span></span>
<span id="cb489-33"><a href="#cb489-33" aria-hidden="true" tabindex="-1"></a>m1 <span class="op">=</span> np.array([[<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">7</span>],[<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">8</span>]])</span>
<span id="cb489-34"><a href="#cb489-34" aria-hidden="true" tabindex="-1"></a>m2 <span class="op">=</span> np.array([[<span class="dv">1</span>,<span class="dv">4</span>],[<span class="dv">2</span>,<span class="dv">5</span>],[<span class="dv">3</span>,<span class="dv">6</span>]])</span>
<span id="cb489-35"><a href="#cb489-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-36"><a href="#cb489-36" aria-hidden="true" tabindex="-1"></a>np.shape(m1)</span>
<span id="cb489-37"><a href="#cb489-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-38"><a href="#cb489-38" aria-hidden="true" tabindex="-1"></a>np.shape(m2)</span>
<span id="cb489-39"><a href="#cb489-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-40"><a href="#cb489-40" aria-hidden="true" tabindex="-1"></a>m3 <span class="op">=</span> np.dot(m1,m2) </span>
<span id="cb489-41"><a href="#cb489-41" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(m3)</span>
<span id="cb489-42"><a href="#cb489-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-43"><a href="#cb489-43" aria-hidden="true" tabindex="-1"></a><span class="co"># ¿Por qué aquí pudimos multiplicar? </span></span>
<span id="cb489-44"><a href="#cb489-44" aria-hidden="true" tabindex="-1"></a>b <span class="op">*</span> e</span></code></pre></div>
</div>
</div>
<div id="estadistica-exploratoria-con-arreglos" class="section level4 hasAnchor" number="4.2.1.10">
<h4 class="hasAnchor"><span class="header-section-number">4.2.1.10</span> Estadistica exploratoria con arreglos<a href="#estadistica-exploratoria-con-arreglos" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb490"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb490-1"><a href="#cb490-1" aria-hidden="true" tabindex="-1"></a>np_mat <span class="op">=</span> np.array([[<span class="dv">1</span>, <span class="dv">2</span>,<span class="dv">30</span>],</span>
<span id="cb490-2"><a href="#cb490-2" aria-hidden="true" tabindex="-1"></a>                   [<span class="dv">30</span>, <span class="dv">4</span>, <span class="op">-</span><span class="dv">5</span>],</span>
<span id="cb490-3"><a href="#cb490-3" aria-hidden="true" tabindex="-1"></a>                   [<span class="dv">5</span>, <span class="dv">6</span>,<span class="dv">7</span> ]])</span>
<span id="cb490-4"><a href="#cb490-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np_mat)</span>
<span id="cb490-5"><a href="#cb490-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-6"><a href="#cb490-6" aria-hidden="true" tabindex="-1"></a>np_mat[:,<span class="dv">0</span>]</span>
<span id="cb490-7"><a href="#cb490-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-8"><a href="#cb490-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Media</span></span>
<span id="cb490-9"><a href="#cb490-9" aria-hidden="true" tabindex="-1"></a>np.mean(np_mat[:,<span class="dv">0</span>])</span>
<span id="cb490-10"><a href="#cb490-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-11"><a href="#cb490-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Mediana </span></span>
<span id="cb490-12"><a href="#cb490-12" aria-hidden="true" tabindex="-1"></a>np.median(np_mat[:,<span class="dv">0</span>])</span>
<span id="cb490-13"><a href="#cb490-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-14"><a href="#cb490-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Coeficiente de correlación </span></span>
<span id="cb490-15"><a href="#cb490-15" aria-hidden="true" tabindex="-1"></a>np.corrcoef(np_mat[:,<span class="dv">1</span>],np_mat[:,<span class="dv">2</span>] )</span>
<span id="cb490-16"><a href="#cb490-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-17"><a href="#cb490-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Desviación estandar</span></span>
<span id="cb490-18"><a href="#cb490-18" aria-hidden="true" tabindex="-1"></a>np.std(np_mat[:,<span class="dv">1</span>])</span>
<span id="cb490-19"><a href="#cb490-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-20"><a href="#cb490-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Suma </span></span>
<span id="cb490-21"><a href="#cb490-21" aria-hidden="true" tabindex="-1"></a>np.<span class="bu">sum</span>(np_mat[:,<span class="dv">1</span>])</span>
<span id="cb490-22"><a href="#cb490-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-23"><a href="#cb490-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Suma acumulada</span></span>
<span id="cb490-24"><a href="#cb490-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.cumsum(np_mat))</span>
<span id="cb490-25"><a href="#cb490-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-26"><a href="#cb490-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Tambien puedo utilizarlas como metodos</span></span>
<span id="cb490-27"><a href="#cb490-27" aria-hidden="true" tabindex="-1"></a>np_mat.<span class="bu">sum</span>()</span>
<span id="cb490-28"><a href="#cb490-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-29"><a href="#cb490-29" aria-hidden="true" tabindex="-1"></a>np_mat.<span class="bu">min</span>()</span>
<span id="cb490-30"><a href="#cb490-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-31"><a href="#cb490-31" aria-hidden="true" tabindex="-1"></a>np_mat.<span class="bu">max</span>()</span>
<span id="cb490-32"><a href="#cb490-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-33"><a href="#cb490-33" aria-hidden="true" tabindex="-1"></a>np_mat.mean()</span>
<span id="cb490-34"><a href="#cb490-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-35"><a href="#cb490-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Generar datos aleatorios a partir de una distribución normal</span></span>
<span id="cb490-36"><a href="#cb490-36" aria-hidden="true" tabindex="-1"></a>ingreso <span class="op">=</span> np.<span class="bu">round</span>(np.random.normal(<span class="dv">1000</span>,<span class="dv">100</span>,<span class="dv">5000</span>),<span class="dv">1</span>)</span>
<span id="cb490-37"><a href="#cb490-37" aria-hidden="true" tabindex="-1"></a>n_hogar <span class="op">=</span> np.<span class="bu">round</span>(np.random.normal(<span class="dv">5</span>,<span class="dv">2</span>,<span class="dv">5000</span>),<span class="dv">0</span>)</span>
<span id="cb490-38"><a href="#cb490-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-39"><a href="#cb490-39" aria-hidden="true" tabindex="-1"></a>ingreso</span>
<span id="cb490-40"><a href="#cb490-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-41"><a href="#cb490-41" aria-hidden="true" tabindex="-1"></a>ingreso.shape</span>
<span id="cb490-42"><a href="#cb490-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-43"><a href="#cb490-43" aria-hidden="true" tabindex="-1"></a>n_hogar</span>
<span id="cb490-44"><a href="#cb490-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-45"><a href="#cb490-45" aria-hidden="true" tabindex="-1"></a>n_hogar.shape</span>
<span id="cb490-46"><a href="#cb490-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-47"><a href="#cb490-47" aria-hidden="true" tabindex="-1"></a>datos <span class="op">=</span> np.column_stack((ingreso,n_hogar))</span>
<span id="cb490-48"><a href="#cb490-48" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(datos)</span>
<span id="cb490-49"><a href="#cb490-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-50"><a href="#cb490-50" aria-hidden="true" tabindex="-1"></a>datos[:,<span class="dv">0</span>].mean()</span>
<span id="cb490-51"><a href="#cb490-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-52"><a href="#cb490-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Tambien podemos utilizar variables categoricas excluyentes</span></span>
<span id="cb490-53"><a href="#cb490-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Fijemos colores y precios como listas</span></span>
<span id="cb490-54"><a href="#cb490-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-55"><a href="#cb490-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Listas : colores y precios</span></span>
<span id="cb490-56"><a href="#cb490-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-57"><a href="#cb490-57" aria-hidden="true" tabindex="-1"></a>mano <span class="op">=</span> [<span class="st">&quot;diestro&quot;</span>, <span class="st">&quot;zurdo&quot;</span>, <span class="st">&quot;zurdo&quot;</span>, <span class="st">&quot;diestro&quot;</span>, <span class="st">&quot;zurdo&quot;</span>]</span>
<span id="cb490-58"><a href="#cb490-58" aria-hidden="true" tabindex="-1"></a>valor <span class="op">=</span> [<span class="dv">20</span>, <span class="dv">21</span>, <span class="dv">24</span>, <span class="dv">12</span>, <span class="dv">15</span>]</span>
<span id="cb490-59"><a href="#cb490-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-60"><a href="#cb490-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertimos a arreglos</span></span>
<span id="cb490-61"><a href="#cb490-61" aria-hidden="true" tabindex="-1"></a>np_mano <span class="op">=</span> np.array(mano)</span>
<span id="cb490-62"><a href="#cb490-62" aria-hidden="true" tabindex="-1"></a>np_valor <span class="op">=</span> np.array(valor)</span>
<span id="cb490-63"><a href="#cb490-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-64"><a href="#cb490-64" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np_mano, np_valor)</span>
<span id="cb490-65"><a href="#cb490-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-66"><a href="#cb490-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Hacemos una selección solo para diestros</span></span>
<span id="cb490-67"><a href="#cb490-67" aria-hidden="true" tabindex="-1"></a>valores_diestro <span class="op">=</span> np_valor[np_mano <span class="op">==</span> <span class="st">&#39;diestro&#39;</span>]</span>
<span id="cb490-68"><a href="#cb490-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-69"><a href="#cb490-69" aria-hidden="true" tabindex="-1"></a><span class="co"># Hacemos una selección solo para zurdos</span></span>
<span id="cb490-70"><a href="#cb490-70" aria-hidden="true" tabindex="-1"></a>valores_zurdos <span class="op">=</span> np_valor[np_mano <span class="op">!=</span> <span class="st">&#39;diestro&#39;</span>]</span>
<span id="cb490-71"><a href="#cb490-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-72"><a href="#cb490-72" aria-hidden="true" tabindex="-1"></a><span class="co"># Imprimimos los resultados utilizando las estadisticas promedio</span></span>
<span id="cb490-73"><a href="#cb490-73" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Mediana valor diestros: &quot;</span> <span class="op">+</span> <span class="bu">str</span>(np.median(valores_diestro )))</span>
<span id="cb490-74"><a href="#cb490-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-75"><a href="#cb490-75" aria-hidden="true" tabindex="-1"></a><span class="co"># Print out the median height of other players. Replace &#39;None&#39;</span></span>
<span id="cb490-76"><a href="#cb490-76" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Mediana valor zurdos: &quot;</span> <span class="op">+</span> <span class="bu">str</span>(np.median(valores_zurdos)))</span>
<span id="cb490-77"><a href="#cb490-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-78"><a href="#cb490-78" aria-hidden="true" tabindex="-1"></a>np_mat</span>
<span id="cb490-79"><a href="#cb490-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-80"><a href="#cb490-80" aria-hidden="true" tabindex="-1"></a><span class="co"># Ojo que le puedo indicar los ejes</span></span>
<span id="cb490-81"><a href="#cb490-81" aria-hidden="true" tabindex="-1"></a>np_mat.<span class="bu">sum</span>(axis <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb490-82"><a href="#cb490-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-83"><a href="#cb490-83" aria-hidden="true" tabindex="-1"></a><span class="co"># Ojo que le puedo indicar los ejes</span></span>
<span id="cb490-84"><a href="#cb490-84" aria-hidden="true" tabindex="-1"></a>np_mat.<span class="bu">sum</span>(axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb490-85"><a href="#cb490-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-86"><a href="#cb490-86" aria-hidden="true" tabindex="-1"></a>M <span class="op">=</span> np.random.random((<span class="dv">3</span>, <span class="dv">4</span>))</span>
<span id="cb490-87"><a href="#cb490-87" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(M)</span>
<span id="cb490-88"><a href="#cb490-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-89"><a href="#cb490-89" aria-hidden="true" tabindex="-1"></a>M.<span class="bu">sum</span>()</span>
<span id="cb490-90"><a href="#cb490-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-91"><a href="#cb490-91" aria-hidden="true" tabindex="-1"></a>M.<span class="bu">min</span>(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb490-92"><a href="#cb490-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-93"><a href="#cb490-93" aria-hidden="true" tabindex="-1"></a>M.<span class="bu">max</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb490-94"><a href="#cb490-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-95"><a href="#cb490-95" aria-hidden="true" tabindex="-1"></a>np.argmin(M)</span>
<span id="cb490-96"><a href="#cb490-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-97"><a href="#cb490-97" aria-hidden="true" tabindex="-1"></a>np.percentile(M, <span class="dv">10</span>)</span></code></pre></div>
</div>
<div id="comparativos-en-arreglos" class="section level4 hasAnchor" number="4.2.1.11">
<h4 class="hasAnchor"><span class="header-section-number">4.2.1.11</span> Comparativos en arreglos<a href="#comparativos-en-arreglos" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb491"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb491-1"><a href="#cb491-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">==</span> b</span>
<span id="cb491-2"><a href="#cb491-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb491-3"><a href="#cb491-3" aria-hidden="true" tabindex="-1"></a>a <span class="op">&lt;</span> <span class="dv">2</span></span></code></pre></div>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 4.2.1:</b></p>
<ol style="list-style-type: decimal">
<li><p>Genere una lista llamada <code>ejercicio1</code> que contenga cuatro listas. La primera debe tener los números (180, 78.4, 15, 18), la segunda (215, 102.7, 17, 19), la tercera (210, 98.5, 18, 20) y la cuarta (188, 75.2, 22, 21).</p></li>
<li><p>Importe el paquete <code>numpy</code> como <code>np</code>. Transfore <code>ejercicio1</code> en un arreglo llamado np_ejercicio1. Finalmente, imprima el tipo de arreglo y el tamaño de este (<em>shape</em>.)</p></li>
<li><p>Cree un arreglo que contenga unicamente la segunda columna de <code>ejercicio1</code>. Llame a este arreglo <code>segunda columna</code>. Haga el mismo procedimiento con la primera fila.</p></li>
<li><p>Múltiplique la segunda columna por la primera fila. Llame a este arreglo resultado.</p></li>
<li><p>Cree un mensaje que le muestre el promedio, la mediana y la desviación estadar de la tercera fila del arreglo <code>ejercicio1</code>.</p></li>
</ol>
</div>
</div>
</div>
<div id="matplotlib" class="section level3 hasAnchor" number="4.2.2">
<h3 class="hasAnchor"><span class="header-section-number">4.2.2</span> Matplotlib<a href="#matplotlib" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Librería de Python para visualizar datos.</li>
<li>Importante para explorar datos y para comunicar efectivamente el análisis de datos.</li>
</ul>
<div id="visualizaciones-básicas" class="section level4 hasAnchor" number="4.2.2.1">
<h4 class="hasAnchor"><span class="header-section-number">4.2.2.1</span> Visualizaciones básicas<a href="#visualizaciones-básicas" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div id="lineas" class="section level5 hasAnchor" number="4.2.2.1.1">
<h5 class="hasAnchor"><span class="header-section-number">4.2.2.1.1</span> Lineas<a href="#lineas" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb492"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb492-1"><a href="#cb492-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt </span>
<span id="cb492-2"><a href="#cb492-2" aria-hidden="true" tabindex="-1"></a>años <span class="op">=</span> [<span class="dv">2010</span>, <span class="dv">2011</span>, <span class="dv">2012</span>, <span class="dv">2013</span>, <span class="dv">2014</span>]</span>
<span id="cb492-3"><a href="#cb492-3" aria-hidden="true" tabindex="-1"></a>pib  <span class="op">=</span> [<span class="dv">1000</span>, <span class="dv">1150</span>, <span class="dv">1090</span>, <span class="dv">1200</span>, <span class="dv">1500</span>]</span>
<span id="cb492-4"><a href="#cb492-4" aria-hidden="true" tabindex="-1"></a>plt.plot(años,pib)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-496-1.png" width="672" /></p>
</div>
<div id="puntos" class="section level5 hasAnchor" number="4.2.2.1.2">
<h5 class="hasAnchor"><span class="header-section-number">4.2.2.1.2</span> Puntos<a href="#puntos" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb493"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb493-1"><a href="#cb493-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt </span>
<span id="cb493-2"><a href="#cb493-2" aria-hidden="true" tabindex="-1"></a>años <span class="op">=</span> [<span class="dv">2010</span>, <span class="dv">2011</span>, <span class="dv">2012</span>, <span class="dv">2013</span>, <span class="dv">2014</span>]</span>
<span id="cb493-3"><a href="#cb493-3" aria-hidden="true" tabindex="-1"></a>pib  <span class="op">=</span> [<span class="dv">1000</span>, <span class="dv">1150</span>, <span class="dv">1090</span>, <span class="dv">1200</span>, <span class="dv">1500</span>]</span>
<span id="cb493-4"><a href="#cb493-4" aria-hidden="true" tabindex="-1"></a>plt.scatter(años,pib)</span>
<span id="cb493-5"><a href="#cb493-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-497-3.png" width="672" /></p>
</div>
<div id="histograma-1" class="section level5 hasAnchor" number="4.2.2.1.3">
<h5 class="hasAnchor"><span class="header-section-number">4.2.2.1.3</span> Histograma<a href="#histograma-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb494"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb494-1"><a href="#cb494-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Histograma de la distribución de la variable ingreso </span></span>
<span id="cb494-2"><a href="#cb494-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb494-3"><a href="#cb494-3" aria-hidden="true" tabindex="-1"></a>ingreso <span class="op">=</span> np.<span class="bu">round</span>(np.random.normal(<span class="dv">1000</span>,<span class="dv">100</span>,<span class="dv">5000</span>),<span class="dv">1</span>)</span></code></pre></div>
<pre><code>## Error: NameError: name &#39;np&#39; is not defined</code></pre>
<div class="sourceCode" id="cb496"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb496-1"><a href="#cb496-1" aria-hidden="true" tabindex="-1"></a>plt.hist(ingreso, bins <span class="op">=</span> <span class="dv">100</span>)</span></code></pre></div>
<pre><code>## Error: NameError: name &#39;ingreso&#39; is not defined</code></pre>
<div class="sourceCode" id="cb498"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb498-1"><a href="#cb498-1" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb498-2"><a href="#cb498-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb498-3"><a href="#cb498-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Por defecto Python selecciona en 10 el número de bins. Muy pocos &quot;bins&quot; sobre simplifican. </span></span>
<span id="cb498-4"><a href="#cb498-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Muchos no permiten ver algún patrón en los datos</span></span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-498-5.png" width="672" /></p>
</div>
<div id="barras" class="section level5 hasAnchor" number="4.2.2.1.4">
<h5 class="hasAnchor"><span class="header-section-number">4.2.2.1.4</span> Barras<a href="#barras" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb499"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb499-1"><a href="#cb499-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Grafico de barras</span></span>
<span id="cb499-2"><a href="#cb499-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> [<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">3</span>,<span class="dv">7</span>,<span class="dv">2</span>]</span>
<span id="cb499-3"><a href="#cb499-3" aria-hidden="true" tabindex="-1"></a>y<span class="op">=</span> [<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>, <span class="st">&quot;D&quot;</span>, <span class="st">&quot;E&quot;</span>]</span>
<span id="cb499-4"><a href="#cb499-4" aria-hidden="true" tabindex="-1"></a>plt.bar(y,x)</span></code></pre></div>
<div class="sourceCode" id="cb500"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb500-1"><a href="#cb500-1" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb500-2"><a href="#cb500-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb500-3"><a href="#cb500-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Grafico de barras horizontal </span></span>
<span id="cb500-4"><a href="#cb500-4" aria-hidden="true" tabindex="-1"></a><span class="co">#create data for plotting</span></span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-499-7.png" width="672" /></p>
<div class="sourceCode" id="cb501"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb501-1"><a href="#cb501-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> [<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">3</span>,<span class="dv">7</span>,<span class="dv">2</span>]</span>
<span id="cb501-2"><a href="#cb501-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> [<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>, <span class="st">&quot;D&quot;</span>, <span class="st">&quot;E&quot;</span>]</span>
<span id="cb501-3"><a href="#cb501-3" aria-hidden="true" tabindex="-1"></a>plt.barh(y,x)</span></code></pre></div>
<div class="sourceCode" id="cb502"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb502-1"><a href="#cb502-1" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-499-8.png" width="672" /></p>
</div>
</div>
<div id="personalizar-gráficos" class="section level4 hasAnchor" number="4.2.2.2">
<h4 class="hasAnchor"><span class="header-section-number">4.2.2.2</span> Personalizar gráficos<a href="#personalizar-gráficos" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb503"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb503-1"><a href="#cb503-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Agregar  escalas logaritmicas </span></span>
<span id="cb503-2"><a href="#cb503-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt </span>
<span id="cb503-3"><a href="#cb503-3" aria-hidden="true" tabindex="-1"></a>años <span class="op">=</span> [<span class="dv">2010</span>, <span class="dv">2011</span>, <span class="dv">2012</span>, <span class="dv">2013</span>, <span class="dv">2014</span>]</span>
<span id="cb503-4"><a href="#cb503-4" aria-hidden="true" tabindex="-1"></a>pib  <span class="op">=</span> [<span class="dv">1000</span>, <span class="dv">1150</span>, <span class="dv">1090</span>, <span class="dv">1200</span>, <span class="dv">1500</span>]</span>
<span id="cb503-5"><a href="#cb503-5" aria-hidden="true" tabindex="-1"></a>plt.scatter(años,pib)</span>
<span id="cb503-6"><a href="#cb503-6" aria-hidden="true" tabindex="-1"></a>plt.yscale(<span class="st">&quot;log&quot;</span>) <span class="co"># Para cambiar las escalas a logaritmos</span></span>
<span id="cb503-7"><a href="#cb503-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb503-8"><a href="#cb503-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb503-9"><a href="#cb503-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Modificar el tamaño</span></span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-500-11.png" width="672" /></p>
<div class="sourceCode" id="cb504"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb504-1"><a href="#cb504-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">6</span>))</span>
<span id="cb504-2"><a href="#cb504-2" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>,<span class="dv">14</span>], [<span class="dv">15</span>,<span class="dv">16</span>,<span class="dv">17</span>,<span class="dv">18</span>,<span class="dv">19</span>])</span>
<span id="cb504-3"><a href="#cb504-3" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb504-4"><a href="#cb504-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb504-5"><a href="#cb504-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb504-6"><a href="#cb504-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Modificar simbolos</span></span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-500-12.png" width="768" /></p>
<div class="sourceCode" id="cb505"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb505-1"><a href="#cb505-1" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>,<span class="dv">14</span>], [<span class="dv">15</span>,<span class="dv">16</span>,<span class="dv">17</span>,<span class="dv">18</span>,<span class="dv">19</span>], <span class="st">&quot;gd&quot;</span>)</span>
<span id="cb505-2"><a href="#cb505-2" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb505-3"><a href="#cb505-3" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb505-4"><a href="#cb505-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb505-5"><a href="#cb505-5" aria-hidden="true" tabindex="-1"></a><span class="co"># gd: green dot.</span></span>
<span id="cb505-6"><a href="#cb505-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb505-7"><a href="#cb505-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Modificar color</span></span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-500-13.png" width="768" /></p>
<div class="sourceCode" id="cb506"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb506-1"><a href="#cb506-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> [<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>]</span>
<span id="cb506-2"><a href="#cb506-2" aria-hidden="true" tabindex="-1"></a>x2 <span class="op">=</span> [<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">9</span>,<span class="dv">16</span>,<span class="dv">25</span>]</span>
<span id="cb506-3"><a href="#cb506-3" aria-hidden="true" tabindex="-1"></a>plt.scatter(x,x2, s<span class="op">=</span><span class="dv">10</span>, color <span class="op">=</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb506-4"><a href="#cb506-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb506-5"><a href="#cb506-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb506-6"><a href="#cb506-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Agregar titulos y nombres de los ejes</span></span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-500-14.png" width="768" /></p>
<div class="sourceCode" id="cb507"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb507-1"><a href="#cb507-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt </span>
<span id="cb507-2"><a href="#cb507-2" aria-hidden="true" tabindex="-1"></a>años <span class="op">=</span> [<span class="dv">2010</span>, <span class="dv">2011</span>, <span class="dv">2012</span>, <span class="dv">2013</span>, <span class="dv">2014</span>]</span>
<span id="cb507-3"><a href="#cb507-3" aria-hidden="true" tabindex="-1"></a>pib  <span class="op">=</span> [<span class="dv">1000</span>, <span class="dv">1150</span>, <span class="dv">1090</span>, <span class="dv">1200</span>, <span class="dv">1500</span>]</span>
<span id="cb507-4"><a href="#cb507-4" aria-hidden="true" tabindex="-1"></a>plt.plot(años,pib)</span>
<span id="cb507-5"><a href="#cb507-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Años&quot;</span>) <span class="co"># Titulo eje x</span></span>
<span id="cb507-6"><a href="#cb507-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;Producto interno bruto&quot;</span>) <span class="co"># Titulo eje y</span></span>
<span id="cb507-7"><a href="#cb507-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Evolución PIB en el tiempo&quot;</span>) <span class="co"># Titulon grafico</span></span>
<span id="cb507-8"><a href="#cb507-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb507-9"><a href="#cb507-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Modificar los números de los ejes</span></span>
<span id="cb507-10"><a href="#cb507-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt </span>
<span id="cb507-11"><a href="#cb507-11" aria-hidden="true" tabindex="-1"></a>años <span class="op">=</span> [<span class="dv">2010</span>, <span class="dv">2011</span>, <span class="dv">2012</span>, <span class="dv">2013</span>, <span class="dv">2014</span>]</span>
<span id="cb507-12"><a href="#cb507-12" aria-hidden="true" tabindex="-1"></a>pib  <span class="op">=</span> [<span class="dv">1000</span>, <span class="dv">1150</span>, <span class="dv">1090</span>, <span class="dv">1200</span>, <span class="dv">1500</span>]</span>
<span id="cb507-13"><a href="#cb507-13" aria-hidden="true" tabindex="-1"></a>plt.plot(años,pib)</span>
<span id="cb507-14"><a href="#cb507-14" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Años&quot;</span>) <span class="co"># Titulo eje x</span></span>
<span id="cb507-15"><a href="#cb507-15" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;Producto interno bruto&quot;</span>) <span class="co"># Titulo eje y</span></span>
<span id="cb507-16"><a href="#cb507-16" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Evolución PIB en el tiempo&quot;</span>) <span class="co"># Titulon grafico</span></span>
<span id="cb507-17"><a href="#cb507-17" aria-hidden="true" tabindex="-1"></a>plt.yticks([<span class="dv">0</span>,<span class="dv">500</span>,<span class="dv">1000</span>,<span class="dv">1500</span>,<span class="dv">2000</span>]) <span class="co"># Eje y</span></span></code></pre></div>
<div class="sourceCode" id="cb508"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb508-1"><a href="#cb508-1" aria-hidden="true" tabindex="-1"></a>plt.xticks([<span class="dv">2010</span>, <span class="dv">2011</span>, <span class="dv">2012</span>, <span class="dv">2013</span>, <span class="dv">2014</span>])<span class="co"># Eje x</span></span>
<span id="cb508-2"><a href="#cb508-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb508-3"><a href="#cb508-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Colocar una etiqueta en el eje</span></span></code></pre></div>
<div class="sourceCode" id="cb509"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb509-1"><a href="#cb509-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt </span>
<span id="cb509-2"><a href="#cb509-2" aria-hidden="true" tabindex="-1"></a>años <span class="op">=</span> [<span class="dv">2010</span>, <span class="dv">2011</span>, <span class="dv">2012</span>, <span class="dv">2013</span>, <span class="dv">2014</span>]</span>
<span id="cb509-3"><a href="#cb509-3" aria-hidden="true" tabindex="-1"></a>pib  <span class="op">=</span> [<span class="dv">1000</span>, <span class="dv">1150</span>, <span class="dv">1090</span>, <span class="dv">1200</span>, <span class="dv">1500</span>]</span>
<span id="cb509-4"><a href="#cb509-4" aria-hidden="true" tabindex="-1"></a>plt.plot(años,pib)</span>
<span id="cb509-5"><a href="#cb509-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Años&quot;</span>) <span class="co"># Titulo eje x</span></span>
<span id="cb509-6"><a href="#cb509-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;Producto interno bruto&quot;</span>) <span class="co"># TItulo eje y</span></span>
<span id="cb509-7"><a href="#cb509-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Evolución PIB en el tiempo&quot;</span>)</span>
<span id="cb509-8"><a href="#cb509-8" aria-hidden="true" tabindex="-1"></a>plt.yticks([<span class="dv">0</span>,<span class="dv">500</span>,<span class="dv">1000</span>,<span class="dv">1500</span>,<span class="dv">2000</span>], [<span class="dv">0</span>, <span class="st">&quot;0.5M&quot;</span>, <span class="st">&quot;1M&quot;</span>, <span class="st">&quot;1.5M&quot;</span>, <span class="st">&quot;2M&quot;</span> ])</span>
<span id="cb509-9"><a href="#cb509-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb509-10"><a href="#cb509-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Cambiar la opacidad </span></span></code></pre></div>
<div class="sourceCode" id="cb510"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb510-1"><a href="#cb510-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> [<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">6</span>,<span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">10</span>,<span class="dv">6</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">7</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">7</span>,<span class="dv">5</span>,<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">9</span>,<span class="dv">2</span>,<span class="dv">1</span>]</span>
<span id="cb510-2"><a href="#cb510-2" aria-hidden="true" tabindex="-1"></a>plt.hist(x, </span>
<span id="cb510-3"><a href="#cb510-3" aria-hidden="true" tabindex="-1"></a>         bins <span class="op">=</span> <span class="dv">10</span>, </span>
<span id="cb510-4"><a href="#cb510-4" aria-hidden="true" tabindex="-1"></a>         color<span class="op">=</span><span class="st">&#39;blue&#39;</span>, </span>
<span id="cb510-5"><a href="#cb510-5" aria-hidden="true" tabindex="-1"></a>         alpha<span class="op">=</span><span class="fl">0.2</span>)</span></code></pre></div>
<div class="sourceCode" id="cb511"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb511-1"><a href="#cb511-1" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb511-2"><a href="#cb511-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb511-3"><a href="#cb511-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Alpha: cambia la opacidad del grafico. Entre 0 y 1.</span></span>
<span id="cb511-4"><a href="#cb511-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb511-5"><a href="#cb511-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Cambiar color</span></span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-500-15.png" width="768" /></p>
<div class="sourceCode" id="cb512"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb512-1"><a href="#cb512-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> [<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">3</span>,<span class="dv">7</span>,<span class="dv">2</span>]</span>
<span id="cb512-2"><a href="#cb512-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> [<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>, <span class="st">&quot;D&quot;</span>, <span class="st">&quot;E&quot;</span>]</span>
<span id="cb512-3"><a href="#cb512-3" aria-hidden="true" tabindex="-1"></a>plt.bar(y,x, color <span class="op">=</span> <span class="st">&quot;green&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb513"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb513-1"><a href="#cb513-1" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb513-2"><a href="#cb513-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb513-3"><a href="#cb513-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Grafico de barras horizontal y con color</span></span>
<span id="cb513-4"><a href="#cb513-4" aria-hidden="true" tabindex="-1"></a><span class="co">#create data for plotting</span></span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-500-16.png" width="768" /></p>
<div class="sourceCode" id="cb514"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb514-1"><a href="#cb514-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> [<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">3</span>,<span class="dv">7</span>,<span class="dv">2</span>]</span>
<span id="cb514-2"><a href="#cb514-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> [<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>, <span class="st">&quot;D&quot;</span>, <span class="st">&quot;E&quot;</span>]</span>
<span id="cb514-3"><a href="#cb514-3" aria-hidden="true" tabindex="-1"></a>plt.barh(y,x, color <span class="op">=</span><span class="st">&quot;yellowgreen&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb515"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb515-1"><a href="#cb515-1" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb515-2"><a href="#cb515-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb515-3"><a href="#cb515-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Agregar texto al grafico</span></span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-500-17.png" width="768" /></p>
<div class="sourceCode" id="cb516"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb516-1"><a href="#cb516-1" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>,<span class="dv">14</span>], [<span class="dv">15</span>,<span class="dv">16</span>,<span class="dv">17</span>,<span class="dv">18</span>,<span class="dv">19</span>], <span class="st">&#39;rd&#39;</span>)</span>
<span id="cb516-2"><a href="#cb516-2" aria-hidden="true" tabindex="-1"></a>plt.axis([<span class="dv">10</span>, <span class="dv">16</span>, <span class="dv">15</span>, <span class="dv">20</span>])</span></code></pre></div>
<div class="sourceCode" id="cb517"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb517-1"><a href="#cb517-1" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Eje x&#39;</span>)</span>
<span id="cb517-2"><a href="#cb517-2" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Eje y&#39;</span>)</span>
<span id="cb517-3"><a href="#cb517-3" aria-hidden="true" tabindex="-1"></a>plt.text(<span class="fl">11.2</span>, <span class="fl">15.9</span>, <span class="vs">r&#39;Este es el segundo punto&#39;</span>)</span>
<span id="cb517-4"><a href="#cb517-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb517-5"><a href="#cb517-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb517-6"><a href="#cb517-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Agregar una linea horizontal</span></span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-500-18.png" width="768" /></p>
<div class="sourceCode" id="cb518"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb518-1"><a href="#cb518-1" aria-hidden="true" tabindex="-1"></a>años <span class="op">=</span> [<span class="dv">2010</span>, <span class="dv">2011</span>, <span class="dv">2012</span>, <span class="dv">2013</span>, <span class="dv">2014</span>]</span>
<span id="cb518-2"><a href="#cb518-2" aria-hidden="true" tabindex="-1"></a>pib  <span class="op">=</span> [<span class="dv">1000</span>, <span class="dv">1150</span>, <span class="dv">1090</span>, <span class="dv">1200</span>, <span class="dv">1500</span>]</span>
<span id="cb518-3"><a href="#cb518-3" aria-hidden="true" tabindex="-1"></a>plt.plot(años,pib)</span>
<span id="cb518-4"><a href="#cb518-4" aria-hidden="true" tabindex="-1"></a>plt.axhline(y<span class="op">=</span><span class="dv">1200</span>, ls<span class="op">=</span><span class="st">&#39;--&#39;</span>, c<span class="op">=</span><span class="st">&#39;r&#39;</span>)</span>
<span id="cb518-5"><a href="#cb518-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb518-6"><a href="#cb518-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb518-7"><a href="#cb518-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Agregar una linea vertical</span></span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-500-19.png" width="768" /></p>
<div class="sourceCode" id="cb519"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb519-1"><a href="#cb519-1" aria-hidden="true" tabindex="-1"></a>años <span class="op">=</span> [<span class="dv">2010</span>, <span class="dv">2011</span>, <span class="dv">2012</span>, <span class="dv">2013</span>, <span class="dv">2014</span>]</span>
<span id="cb519-2"><a href="#cb519-2" aria-hidden="true" tabindex="-1"></a>pib  <span class="op">=</span> [<span class="dv">1000</span>, <span class="dv">1150</span>, <span class="dv">1090</span>, <span class="dv">1200</span>, <span class="dv">1500</span>]</span>
<span id="cb519-3"><a href="#cb519-3" aria-hidden="true" tabindex="-1"></a>plt.plot(años,pib)</span>
<span id="cb519-4"><a href="#cb519-4" aria-hidden="true" tabindex="-1"></a>plt.axvline(x <span class="op">=</span> <span class="dv">2011</span>, ls<span class="op">=</span><span class="st">&#39;--&#39;</span>, c<span class="op">=</span><span class="st">&#39;r&#39;</span>)</span>
<span id="cb519-5"><a href="#cb519-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb519-6"><a href="#cb519-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb519-7"><a href="#cb519-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Agregar caja con nombres </span></span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-500-20.png" width="768" /></p>
<div class="sourceCode" id="cb520"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb520-1"><a href="#cb520-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">30</span>) <span class="co"># Devuelve números espaciados uniformemente en un intervalo especificado.</span></span></code></pre></div>
<pre><code>## Error: NameError: name &#39;np&#39; is not defined</code></pre>
<div class="sourceCode" id="cb522"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb522-1"><a href="#cb522-1" aria-hidden="true" tabindex="-1"></a>plt.plot(x, np.sin(x), label<span class="op">=</span><span class="st">&#39;seno&#39;</span>)</span></code></pre></div>
<pre><code>## Error: NameError: name &#39;np&#39; is not defined</code></pre>
<div class="sourceCode" id="cb524"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb524-1"><a href="#cb524-1" aria-hidden="true" tabindex="-1"></a>plt.plot(x, np.cos(x), label<span class="op">=</span><span class="st">&#39;coseno&#39;</span>)</span></code></pre></div>
<pre><code>## Error: NameError: name &#39;np&#39; is not defined</code></pre>
<div class="sourceCode" id="cb526"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb526-1"><a href="#cb526-1" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb526-2"><a href="#cb526-2" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb526-3"><a href="#cb526-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb526-4"><a href="#cb526-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Otra forma de agregar caja con nombres</span></span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-500-21.png" width="768" /></p>
<div class="sourceCode" id="cb527"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb527-1"><a href="#cb527-1" aria-hidden="true" tabindex="-1"></a>plt.plot(x, np.sin(x))</span></code></pre></div>
<pre><code>## Error: NameError: name &#39;np&#39; is not defined</code></pre>
<div class="sourceCode" id="cb529"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb529-1"><a href="#cb529-1" aria-hidden="true" tabindex="-1"></a>plt.plot(x, np.cos(x))</span></code></pre></div>
<pre><code>## Error: NameError: name &#39;np&#39; is not defined</code></pre>
<div class="sourceCode" id="cb531"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb531-1"><a href="#cb531-1" aria-hidden="true" tabindex="-1"></a>plt.legend([<span class="st">&quot;seno&quot;</span>, <span class="st">&quot;cos&quot;</span>])</span>
<span id="cb531-2"><a href="#cb531-2" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb531-3"><a href="#cb531-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb531-4"><a href="#cb531-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Cambiar la ubicación de la leyenda</span></span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-500-22.png" width="768" /></p>
<div class="sourceCode" id="cb532"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb532-1"><a href="#cb532-1" aria-hidden="true" tabindex="-1"></a>plt.plot(x, np.sin(x))</span></code></pre></div>
<pre><code>## Error: NameError: name &#39;np&#39; is not defined</code></pre>
<div class="sourceCode" id="cb534"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb534-1"><a href="#cb534-1" aria-hidden="true" tabindex="-1"></a>plt.plot(x, np.cos(x))</span></code></pre></div>
<pre><code>## Error: NameError: name &#39;np&#39; is not defined</code></pre>
<div class="sourceCode" id="cb536"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb536-1"><a href="#cb536-1" aria-hidden="true" tabindex="-1"></a>plt.legend([<span class="st">&quot;seno&quot;</span>, <span class="st">&quot;cos&quot;</span>], loc <span class="op">=</span> <span class="st">&quot;upper right&quot;</span>)</span>
<span id="cb536-2"><a href="#cb536-2" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb536-3"><a href="#cb536-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb536-4"><a href="#cb536-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualización más compleja con más de una leyanda</span></span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-500-23.png" width="768" /></p>
<div class="sourceCode" id="cb537"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb537-1"><a href="#cb537-1" aria-hidden="true" tabindex="-1"></a>lines <span class="op">=</span> []</span>
<span id="cb537-2"><a href="#cb537-2" aria-hidden="true" tabindex="-1"></a>line_styles <span class="op">=</span> [<span class="st">&#39;-&#39;</span>, <span class="st">&#39;-.&#39;</span>, <span class="st">&#39;--&#39;</span>, <span class="st">&#39;:&#39;</span>]</span>
<span id="cb537-3"><a href="#cb537-3" aria-hidden="true" tabindex="-1"></a>line_colors <span class="op">=</span> [<span class="st">&#39;red&#39;</span>, <span class="st">&#39;blue&#39;</span>, <span class="st">&#39;green&#39;</span>, <span class="st">&#39;black&#39;</span>]</span>
<span id="cb537-4"><a href="#cb537-4" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">1000</span>)</span></code></pre></div>
<pre><code>## Error: NameError: name &#39;np&#39; is not defined</code></pre>
<div class="sourceCode" id="cb539"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb539-1"><a href="#cb539-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>):</span>
<span id="cb539-2"><a href="#cb539-2" aria-hidden="true" tabindex="-1"></a>    line, <span class="op">=</span> plt.plot(</span>
<span id="cb539-3"><a href="#cb539-3" aria-hidden="true" tabindex="-1"></a>        x, </span>
<span id="cb539-4"><a href="#cb539-4" aria-hidden="true" tabindex="-1"></a>        np.sin(x <span class="op">-</span> i <span class="op">*</span> np.pi <span class="op">/</span> <span class="dv">2</span>), </span>
<span id="cb539-5"><a href="#cb539-5" aria-hidden="true" tabindex="-1"></a>        line_styles[i], </span>
<span id="cb539-6"><a href="#cb539-6" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span>line_colors[i]</span>
<span id="cb539-7"><a href="#cb539-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb539-8"><a href="#cb539-8" aria-hidden="true" tabindex="-1"></a>    lines.append(line)</span></code></pre></div>
<pre><code>## Error: NameError: name &#39;np&#39; is not defined</code></pre>
<div class="sourceCode" id="cb541"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb541-1"><a href="#cb541-1" aria-hidden="true" tabindex="-1"></a>legend1 <span class="op">=</span> plt.legend(lines[:<span class="dv">2</span>], [<span class="st">&#39;part A&#39;</span>, <span class="st">&#39;part B&#39;</span>], loc<span class="op">=</span><span class="st">&#39;upper right&#39;</span>)</span>
<span id="cb541-2"><a href="#cb541-2" aria-hidden="true" tabindex="-1"></a>legend2 <span class="op">=</span> plt.legend(lines[<span class="dv">2</span>:], [<span class="st">&#39;part C&#39;</span>, <span class="st">&#39;part B&#39;</span>], loc<span class="op">=</span><span class="st">&#39;lower right&#39;</span>)</span>
<span id="cb541-3"><a href="#cb541-3" aria-hidden="true" tabindex="-1"></a>plt.gca().add_artist(legend1)</span>
<span id="cb541-4"><a href="#cb541-4" aria-hidden="true" tabindex="-1"></a>plt.gca().add_artist(legend2)</span>
<span id="cb541-5"><a href="#cb541-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb541-6"><a href="#cb541-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb541-7"><a href="#cb541-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualizar cuatro elemento: variable 1 y 2 con los ejes, variable 3 con color y variable 4 con tamaño- </span></span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-500-24.png" width="768" /></p>
<div class="sourceCode" id="cb542"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb542-1"><a href="#cb542-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.random.randn(<span class="dv">100</span>)</span></code></pre></div>
<pre><code>## Error: NameError: name &#39;np&#39; is not defined</code></pre>
<div class="sourceCode" id="cb544"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb544-1"><a href="#cb544-1" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> np.random.randn(<span class="dv">100</span>)</span></code></pre></div>
<pre><code>## Error: NameError: name &#39;np&#39; is not defined</code></pre>
<div class="sourceCode" id="cb546"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb546-1"><a href="#cb546-1" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> np.random.rand(<span class="dv">100</span>)</span></code></pre></div>
<pre><code>## Error: NameError: name &#39;np&#39; is not defined</code></pre>
<div class="sourceCode" id="cb548"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb548-1"><a href="#cb548-1" aria-hidden="true" tabindex="-1"></a>sizes <span class="op">=</span> <span class="dv">100</span> <span class="op">*</span> np.random.rand(<span class="dv">100</span>)</span></code></pre></div>
<pre><code>## Error: NameError: name &#39;np&#39; is not defined</code></pre>
<div class="sourceCode" id="cb550"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb550-1"><a href="#cb550-1" aria-hidden="true" tabindex="-1"></a>plt.scatter(x, y, c<span class="op">=</span>colors, s<span class="op">=</span>sizes, alpha<span class="op">=</span><span class="fl">0.8</span>, cmap<span class="op">=</span><span class="st">&#39;viridis&#39;</span>) <span class="co"># cmap: color maps. Otro ejemplo: plasma</span></span></code></pre></div>
<pre><code>## Error: NameError: name &#39;colors&#39; is not defined</code></pre>
<div class="sourceCode" id="cb552"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb552-1"><a href="#cb552-1" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-500-25.png" width="768" /></p>
<p>Más colores en: <a href="https://matplotlib.org/3.5.0/tutorials/colors/colormaps.html" class="uri">https://matplotlib.org/3.5.0/tutorials/colors/colormaps.html</a></p>
<div class="sourceCode" id="cb553"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb553-1"><a href="#cb553-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Agregar barra de colores</span></span>
<span id="cb553-2"><a href="#cb553-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualizar cuatro elemento: variable 1 y 2 con los ejes, variable 3 con color y variable 4 con tamaño- </span></span>
<span id="cb553-3"><a href="#cb553-3" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.random.randn(<span class="dv">100</span>)</span></code></pre></div>
<pre><code>## Error: NameError: name &#39;np&#39; is not defined</code></pre>
<div class="sourceCode" id="cb555"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb555-1"><a href="#cb555-1" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> np.random.randn(<span class="dv">100</span>)</span></code></pre></div>
<pre><code>## Error: NameError: name &#39;np&#39; is not defined</code></pre>
<div class="sourceCode" id="cb557"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb557-1"><a href="#cb557-1" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> np.random.rand(<span class="dv">100</span>)</span></code></pre></div>
<pre><code>## Error: NameError: name &#39;np&#39; is not defined</code></pre>
<div class="sourceCode" id="cb559"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb559-1"><a href="#cb559-1" aria-hidden="true" tabindex="-1"></a>sizes <span class="op">=</span> <span class="dv">100</span> <span class="op">*</span> np.random.rand(<span class="dv">100</span>)</span></code></pre></div>
<pre><code>## Error: NameError: name &#39;np&#39; is not defined</code></pre>
<div class="sourceCode" id="cb561"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb561-1"><a href="#cb561-1" aria-hidden="true" tabindex="-1"></a>plt.scatter(x, y, c<span class="op">=</span>colors, s<span class="op">=</span>sizes, alpha<span class="op">=</span><span class="fl">0.8</span>, cmap<span class="op">=</span><span class="st">&#39;viridis&#39;</span>) <span class="co"># cmap: color maps. Otro ejemplo: plasma</span></span></code></pre></div>
<pre><code>## Error: NameError: name &#39;colors&#39; is not defined</code></pre>
<div class="sourceCode" id="cb563"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb563-1"><a href="#cb563-1" aria-hidden="true" tabindex="-1"></a>plt.colorbar(orientation <span class="op">=</span> <span class="st">&quot;horizontal&quot;</span>)</span></code></pre></div>
<pre><code>## Error: RuntimeError: No mappable was found to use for colorbar creation. First define a mappable such as an image (with imshow) or a contour set (with contourf).</code></pre>
<div class="sourceCode" id="cb565"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb565-1"><a href="#cb565-1" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-501-41.png" width="768" /></p>
<p>Para ver más opciones de la librería: <a href="https://matplotlib.org/3.5.0/api/" class="uri">https://matplotlib.org/3.5.0/api/</a></p>
<div class="sourceCode" id="cb566"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb566-1"><a href="#cb566-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">11</span>)</span></code></pre></div>
<pre><code>## Error: NameError: name &#39;np&#39; is not defined</code></pre>
<div class="sourceCode" id="cb568"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb568-1"><a href="#cb568-1" aria-hidden="true" tabindex="-1"></a>x</span>
<span id="cb568-2"><a href="#cb568-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb568-3"><a href="#cb568-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Combinar tres histogramas en un grafico</span></span></code></pre></div>
<div class="sourceCode" id="cb569"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb569-1"><a href="#cb569-1" aria-hidden="true" tabindex="-1"></a>h1 <span class="op">=</span> np.random.normal(<span class="dv">0</span>, <span class="fl">0.8</span>, <span class="dv">1000</span>)</span></code></pre></div>
<pre><code>## Error: NameError: name &#39;np&#39; is not defined</code></pre>
<div class="sourceCode" id="cb571"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb571-1"><a href="#cb571-1" aria-hidden="true" tabindex="-1"></a>h2 <span class="op">=</span> np.random.normal(<span class="op">-</span><span class="dv">3</span>, <span class="fl">1.2</span>, <span class="dv">1000</span>)</span></code></pre></div>
<pre><code>## Error: NameError: name &#39;np&#39; is not defined</code></pre>
<div class="sourceCode" id="cb573"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb573-1"><a href="#cb573-1" aria-hidden="true" tabindex="-1"></a>h3 <span class="op">=</span> np.random.normal(<span class="dv">4</span>, <span class="fl">0.5</span>, <span class="dv">1000</span>)</span></code></pre></div>
<pre><code>## Error: NameError: name &#39;np&#39; is not defined</code></pre>
<div class="sourceCode" id="cb575"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb575-1"><a href="#cb575-1" aria-hidden="true" tabindex="-1"></a>plt.hist(h1, bins<span class="op">=</span><span class="dv">40</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span></code></pre></div>
<pre><code>## Error: NameError: name &#39;h1&#39; is not defined</code></pre>
<div class="sourceCode" id="cb577"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb577-1"><a href="#cb577-1" aria-hidden="true" tabindex="-1"></a>plt.hist(h2, bins<span class="op">=</span><span class="dv">40</span>, alpha<span class="op">=</span><span class="fl">0.8</span>)</span></code></pre></div>
<pre><code>## Error: NameError: name &#39;h2&#39; is not defined</code></pre>
<div class="sourceCode" id="cb579"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb579-1"><a href="#cb579-1" aria-hidden="true" tabindex="-1"></a>plt.hist(h3, bins<span class="op">=</span><span class="dv">40</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span></code></pre></div>
<pre><code>## Error: NameError: name &#39;h3&#39; is not defined</code></pre>
<div class="sourceCode" id="cb581"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb581-1"><a href="#cb581-1" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb581-2"><a href="#cb581-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb581-3"><a href="#cb581-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Modificar la opacidad del grafico</span></span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-502-43.png" width="768" /></p>
<div class="sourceCode" id="cb582"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb582-1"><a href="#cb582-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> [<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">6</span>,<span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">10</span>,<span class="dv">6</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">7</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">7</span>,<span class="dv">5</span>,<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">9</span>,<span class="dv">2</span>,<span class="dv">1</span>]</span>
<span id="cb582-2"><a href="#cb582-2" aria-hidden="true" tabindex="-1"></a><span class="co">#plot for a histogram</span></span>
<span id="cb582-3"><a href="#cb582-3" aria-hidden="true" tabindex="-1"></a>plt.hist(x, bins <span class="op">=</span> <span class="dv">10</span>, color<span class="op">=</span><span class="st">&#39;blue&#39;</span>, alpha<span class="op">=</span><span class="fl">0.2</span>)</span></code></pre></div>
<div class="sourceCode" id="cb583"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb583-1"><a href="#cb583-1" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb583-2"><a href="#cb583-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb583-3"><a href="#cb583-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Alpha: cambia la opacidad del grafico. Entre 0 y 1.</span></span>
<span id="cb583-4"><a href="#cb583-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb583-5"><a href="#cb583-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Generar graficos, combinarlos, pero uno despues del otro</span></span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-502-44.png" width="768" /></p>
<div class="sourceCode" id="cb584"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb584-1"><a href="#cb584-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure() <span class="co"># Genero un espacio para la figura</span></span>
<span id="cb584-2"><a href="#cb584-2" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> fig.add_axes([<span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.8</span>, <span class="fl">0.4</span>], ylim<span class="op">=</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb584-3"><a href="#cb584-3" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> fig.add_axes([<span class="fl">0.1</span>, <span class="fl">0.0</span>, <span class="fl">0.8</span>, <span class="fl">0.4</span>], ylim<span class="op">=</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb584-4"><a href="#cb584-4" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## Error: NameError: name &#39;np&#39; is not defined</code></pre>
<div class="sourceCode" id="cb586"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb586-1"><a href="#cb586-1" aria-hidden="true" tabindex="-1"></a>ax1.plot(np.sin(x))</span></code></pre></div>
<pre><code>## Error: NameError: name &#39;np&#39; is not defined</code></pre>
<div class="sourceCode" id="cb588"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb588-1"><a href="#cb588-1" aria-hidden="true" tabindex="-1"></a>ax2.plot(np.cos(x))</span></code></pre></div>
<pre><code>## Error: NameError: name &#39;np&#39; is not defined</code></pre>
<div class="sourceCode" id="cb590"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb590-1"><a href="#cb590-1" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb590-2"><a href="#cb590-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb590-3"><a href="#cb590-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate normal distributed sample points in 2-D</span></span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-502-45.png" width="672" /></p>
<div class="sourceCode" id="cb591"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb591-1"><a href="#cb591-1" aria-hidden="true" tabindex="-1"></a>x, y <span class="op">=</span> np.random.multivariate_normal([<span class="dv">0</span>, <span class="dv">0</span>], [[<span class="dv">1</span>, <span class="dv">1</span>], [<span class="dv">1</span>, <span class="dv">2</span>]], <span class="dv">3000</span>).T</span>
<span id="cb591-2"><a href="#cb591-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Define subplot styles</span></span></code></pre></div>
<pre><code>## Error: NameError: name &#39;np&#39; is not defined</code></pre>
<div class="sourceCode" id="cb593"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb593-1"><a href="#cb593-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">10</span>))</span>
<span id="cb593-2"><a href="#cb593-2" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> plt.GridSpec(<span class="dv">4</span>, <span class="dv">4</span>, hspace<span class="op">=</span><span class="fl">0.2</span>, wspace<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb593-3"><a href="#cb593-3" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> fig.add_subplot(grid[:<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>:])</span>
<span id="cb593-4"><a href="#cb593-4" aria-hidden="true" tabindex="-1"></a>ax_x <span class="op">=</span> fig.add_subplot(grid[<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>:])</span>
<span id="cb593-5"><a href="#cb593-5" aria-hidden="true" tabindex="-1"></a>ax_y <span class="op">=</span> fig.add_subplot(grid[:<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>])</span>
<span id="cb593-6"><a href="#cb593-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the data to subplots</span></span>
<span id="cb593-7"><a href="#cb593-7" aria-hidden="true" tabindex="-1"></a>ax.scatter(x, y, s<span class="op">=</span><span class="dv">3</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span></code></pre></div>
<pre><code>## Error: ValueError: x and y must be the same size</code></pre>
<div class="sourceCode" id="cb595"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb595-1"><a href="#cb595-1" aria-hidden="true" tabindex="-1"></a>ax_x.hist(x, <span class="dv">40</span>, orientation<span class="op">=</span><span class="st">&#39;vertical&#39;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb596"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb596-1"><a href="#cb596-1" aria-hidden="true" tabindex="-1"></a>ax_y.hist(y, <span class="dv">40</span>, orientation<span class="op">=</span><span class="st">&#39;horizontal&#39;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb597"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb597-1"><a href="#cb597-1" aria-hidden="true" tabindex="-1"></a>ax_x.invert_yaxis()</span>
<span id="cb597-2"><a href="#cb597-2" aria-hidden="true" tabindex="-1"></a>ax_y.invert_xaxis()</span>
<span id="cb597-3"><a href="#cb597-3" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-502-46.png" width="960" /></p>
</div>
<div id="ejemplo-de-generación-de-visualizaciones" class="section level4 hasAnchor" number="4.2.2.3">
<h4 class="hasAnchor"><span class="header-section-number">4.2.2.3</span> Ejemplo de generación de visualizaciones<a href="#ejemplo-de-generación-de-visualizaciones" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb598"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb598-1"><a href="#cb598-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preambulo</span></span>
<span id="cb598-2"><a href="#cb598-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb598-3"><a href="#cb598-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd                    <span class="co"># datos</span></span>
<span id="cb598-4"><a href="#cb598-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib <span class="im">as</span> mpl               <span class="co"># graficos</span></span>
<span id="cb598-5"><a href="#cb598-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> datetime <span class="im">as</span> dt                  <span class="co"># fechas</span></span>
<span id="cb598-6"><a href="#cb598-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np                     <span class="co"># arreglos</span></span>
<span id="cb598-7"><a href="#cb598-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb598-8"><a href="#cb598-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Chequear todo</span></span>
<span id="cb598-9"><a href="#cb598-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Pandas version: &#39;</span>, pd.__version__)</span>
<span id="cb598-10"><a href="#cb598-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Matplotlib version: &#39;</span>, mpl.__version__)</span>
<span id="cb598-11"><a href="#cb598-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Today: &#39;</span>, dt.date.today())</span>
<span id="cb598-12"><a href="#cb598-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb598-13"><a href="#cb598-13" aria-hidden="true" tabindex="-1"></a><span class="co"># PIB y consumo USA</span></span>
<span id="cb598-14"><a href="#cb598-14" aria-hidden="true" tabindex="-1"></a>gdp  <span class="op">=</span> [<span class="fl">13271.1</span>, <span class="fl">13773.5</span>, <span class="fl">14234.2</span>, <span class="fl">14613.8</span>, <span class="fl">14873.7</span>, <span class="fl">14830.4</span>, <span class="fl">14418.7</span>,</span>
<span id="cb598-15"><a href="#cb598-15" aria-hidden="true" tabindex="-1"></a>        <span class="fl">14783.8</span>, <span class="fl">15020.6</span>, <span class="fl">15369.2</span>, <span class="fl">15710.3</span>]</span>
<span id="cb598-16"><a href="#cb598-16" aria-hidden="true" tabindex="-1"></a>pce  <span class="op">=</span> [<span class="fl">8867.6</span>, <span class="fl">9208.2</span>, <span class="fl">9531.8</span>, <span class="fl">9821.7</span>, <span class="fl">10041.6</span>, <span class="fl">10007.2</span>, <span class="fl">9847.0</span>, <span class="fl">10036.3</span>,</span>
<span id="cb598-17"><a href="#cb598-17" aria-hidden="true" tabindex="-1"></a>        <span class="fl">10263.5</span>, <span class="fl">10449.7</span>, <span class="fl">10699.7</span>]</span>
<span id="cb598-18"><a href="#cb598-18" aria-hidden="true" tabindex="-1"></a>year <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">2003</span>,<span class="dv">2014</span>))        <span class="co"># use range for years 2003-2013 </span></span>
<span id="cb598-19"><a href="#cb598-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb598-20"><a href="#cb598-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Creamos data frame</span></span>
<span id="cb598-21"><a href="#cb598-21" aria-hidden="true" tabindex="-1"></a>us <span class="op">=</span> pd.DataFrame({<span class="st">&#39;gdp&#39;</span>: gdp, <span class="st">&#39;pce&#39;</span>: pce}, index<span class="op">=</span>year) </span>
<span id="cb598-22"><a href="#cb598-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(us.head(<span class="dv">3</span>))</span>
<span id="cb598-23"><a href="#cb598-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb598-24"><a href="#cb598-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Pib percapita (World Bank data, 2013, thousands of USD) </span></span>
<span id="cb598-25"><a href="#cb598-25" aria-hidden="true" tabindex="-1"></a>code    <span class="op">=</span> [<span class="st">&#39;USA&#39;</span>, <span class="st">&#39;FRA&#39;</span>, <span class="st">&#39;JPN&#39;</span>, <span class="st">&#39;CHN&#39;</span>, <span class="st">&#39;IND&#39;</span>, <span class="st">&#39;BRA&#39;</span>, <span class="st">&#39;MEX&#39;</span>]</span>
<span id="cb598-26"><a href="#cb598-26" aria-hidden="true" tabindex="-1"></a>country <span class="op">=</span> [<span class="st">&#39;United States&#39;</span>, <span class="st">&#39;France&#39;</span>, <span class="st">&#39;Japan&#39;</span>, <span class="st">&#39;China&#39;</span>, <span class="st">&#39;India&#39;</span>,</span>
<span id="cb598-27"><a href="#cb598-27" aria-hidden="true" tabindex="-1"></a>             <span class="st">&#39;Brazil&#39;</span>, <span class="st">&#39;Mexico&#39;</span>]</span>
<span id="cb598-28"><a href="#cb598-28" aria-hidden="true" tabindex="-1"></a>gdppc   <span class="op">=</span> [<span class="fl">53.1</span>, <span class="fl">36.9</span>, <span class="fl">36.3</span>, <span class="fl">11.9</span>, <span class="fl">5.4</span>, <span class="fl">15.0</span>, <span class="fl">16.5</span>]</span>
<span id="cb598-29"><a href="#cb598-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb598-30"><a href="#cb598-30" aria-hidden="true" tabindex="-1"></a>wbdf <span class="op">=</span> pd.DataFrame({<span class="st">&#39;gdppc&#39;</span>: gdppc, <span class="st">&#39;country&#39;</span>: country}, index<span class="op">=</span>code)</span>
<span id="cb598-31"><a href="#cb598-31" aria-hidden="true" tabindex="-1"></a>wbdf</span></code></pre></div>
<p><strong>Método 1: Aplicar plot()</strong></p>
<div class="sourceCode" id="cb599"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb599-1"><a href="#cb599-1" aria-hidden="true" tabindex="-1"></a>us</span>
<span id="cb599-2"><a href="#cb599-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb599-3"><a href="#cb599-3" aria-hidden="true" tabindex="-1"></a>us.plot()</span>
<span id="cb599-4"><a href="#cb599-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb599-5"><a href="#cb599-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Solo pib</span></span>
<span id="cb599-6"><a href="#cb599-6" aria-hidden="true" tabindex="-1"></a>us[<span class="st">&#39;gdp&#39;</span>].plot()</span>
<span id="cb599-7"><a href="#cb599-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb599-8"><a href="#cb599-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ahora en barras</span></span>
<span id="cb599-9"><a href="#cb599-9" aria-hidden="true" tabindex="-1"></a>us.plot(kind<span class="op">=</span><span class="st">&#39;bar&#39;</span>)</span>
<span id="cb599-10"><a href="#cb599-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb599-11"><a href="#cb599-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Comp puntos </span></span>
<span id="cb599-12"><a href="#cb599-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Orden importa </span></span>
<span id="cb599-13"><a href="#cb599-13" aria-hidden="true" tabindex="-1"></a>us.plot.scatter(<span class="st">&#39;pce&#39;</span>, <span class="st">&#39;gdp&#39;</span>)</span></code></pre></div>
<p><strong>Método 2: Aplicar la función plot(x,y)</strong></p>
<div class="sourceCode" id="cb600"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb600-1"><a href="#cb600-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import pyplot module of Matplotlib </span></span>
<span id="cb600-2"><a href="#cb600-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb600-3"><a href="#cb600-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb600-4"><a href="#cb600-4" aria-hidden="true" tabindex="-1"></a>us</span>
<span id="cb600-5"><a href="#cb600-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb600-6"><a href="#cb600-6" aria-hidden="true" tabindex="-1"></a>us.index</span>
<span id="cb600-7"><a href="#cb600-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb600-8"><a href="#cb600-8" aria-hidden="true" tabindex="-1"></a>plt.plot(us.index, us[<span class="st">&#39;pce&#39;</span>])</span>
<span id="cb600-9"><a href="#cb600-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb600-10"><a href="#cb600-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Dos lineas juntas </span></span>
<span id="cb600-11"><a href="#cb600-11" aria-hidden="true" tabindex="-1"></a>plt.plot(us.index, us[<span class="st">&#39;gdp&#39;</span>])</span>
<span id="cb600-12"><a href="#cb600-12" aria-hidden="true" tabindex="-1"></a>plt.plot(us.index, us[<span class="st">&#39;pce&#39;</span>])</span>
<span id="cb600-13"><a href="#cb600-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb600-14"><a href="#cb600-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Noten como python agrega</span></span>
<span id="cb600-15"><a href="#cb600-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb600-16"><a href="#cb600-16" aria-hidden="true" tabindex="-1"></a>us</span>
<span id="cb600-17"><a href="#cb600-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb600-18"><a href="#cb600-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Grafico de barras </span></span>
<span id="cb600-19"><a href="#cb600-19" aria-hidden="true" tabindex="-1"></a>plt.barh(us.index, us[<span class="st">&#39;gdp&#39;</span>], align <span class="op">=</span> <span class="st">&#39;center&#39;</span>)</span>
<span id="cb600-20"><a href="#cb600-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb600-21"><a href="#cb600-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Agregamos nuevos elementos </span></span>
<span id="cb600-22"><a href="#cb600-22" aria-hidden="true" tabindex="-1"></a>plt.plot(us.index, us[<span class="st">&#39;gdp&#39;</span>]) </span>
<span id="cb600-23"><a href="#cb600-23" aria-hidden="true" tabindex="-1"></a>plt.plot(us.index, us[<span class="st">&#39;pce&#39;</span>]) </span>
<span id="cb600-24"><a href="#cb600-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb600-25"><a href="#cb600-25" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;US GDP&#39;</span>, fontsize<span class="op">=</span><span class="dv">12</span>, loc<span class="op">=</span><span class="st">&#39;left&#39;</span>) <span class="co"># Títutlo</span></span>
<span id="cb600-26"><a href="#cb600-26" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Billions of 2009 USD&#39;</span>)           <span class="co"># Eje y</span></span>
<span id="cb600-27"><a href="#cb600-27" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Years&quot;</span>)</span>
<span id="cb600-28"><a href="#cb600-28" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="fl">2002.5</span>, <span class="fl">2013.5</span>)                     <span class="co"># Limites eje x</span></span>
<span id="cb600-29"><a href="#cb600-29" aria-hidden="true" tabindex="-1"></a>plt.tick_params(labelcolor<span class="op">=</span><span class="st">&#39;gray&#39;</span>)            <span class="co"># Colores</span></span>
<span id="cb600-30"><a href="#cb600-30" aria-hidden="true" tabindex="-1"></a>plt.legend([<span class="st">&#39;GDP&#39;</span>, <span class="st">&#39;Consumption&#39;</span>])           <span class="co"># Nombres variables </span></span>
<span id="cb600-31"><a href="#cb600-31" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><strong>Método 3: Crear una figura vacía y aplicar metodos</strong></p>
<div class="sourceCode" id="cb601"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb601-1"><a href="#cb601-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creamos figura vacía</span></span>
<span id="cb601-2"><a href="#cb601-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb601-3"><a href="#cb601-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb601-4"><a href="#cb601-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Creamos con más cosas </span></span>
<span id="cb601-5"><a href="#cb601-5" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb601-6"><a href="#cb601-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb601-7"><a href="#cb601-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Agregamos cosas con metodos de ax</span></span>
<span id="cb601-8"><a href="#cb601-8" aria-hidden="true" tabindex="-1"></a>ax.plot(us.index, us[<span class="st">&#39;gdp&#39;</span>], linewidth<span class="op">=</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">&#39;magenta&#39;</span>)</span>
<span id="cb601-9"><a href="#cb601-9" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">&#39;US GDP&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>, loc<span class="op">=</span><span class="st">&#39;left&#39;</span>)</span>
<span id="cb601-10"><a href="#cb601-10" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">&#39;Billions of USD&#39;</span>)</span>
<span id="cb601-11"><a href="#cb601-11" aria-hidden="true" tabindex="-1"></a>ax.set_xticks([<span class="dv">2004</span>, <span class="dv">2008</span>, <span class="dv">2012</span>])</span>
<span id="cb601-12"><a href="#cb601-12" aria-hidden="true" tabindex="-1"></a>ax.grid(<span class="va">True</span>)</span>
<span id="cb601-13"><a href="#cb601-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb601-14"><a href="#cb601-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Guardamos la figura</span></span>
<span id="cb601-15"><a href="#cb601-15" aria-hidden="true" tabindex="-1"></a>fig.savefig(<span class="st">&#39;resultados</span><span class="ch">\\</span><span class="st">us_gdp.pdf&#39;</span>)</span></code></pre></div>
<p><strong>Múltiples sub-plots</strong></p>
<div class="sourceCode" id="cb602"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb602-1"><a href="#cb602-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creamos un arreglo de 2d </span></span>
<span id="cb602-2"><a href="#cb602-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">2</span>, ncols<span class="op">=</span><span class="dv">1</span>, sharex<span class="op">=</span><span class="va">True</span>)  </span>
<span id="cb602-3"><a href="#cb602-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Objeto ax tiene dimensión&#39;</span>, <span class="bu">len</span>(ax))</span>
<span id="cb602-4"><a href="#cb602-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb602-5"><a href="#cb602-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Agregamos contenido</span></span>
<span id="cb602-6"><a href="#cb602-6" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">2</span>, ncols<span class="op">=</span><span class="dv">1</span>, sharex<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb602-7"><a href="#cb602-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb602-8"><a href="#cb602-8" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].plot(us.index, us[<span class="st">&#39;gdp&#39;</span>], color<span class="op">=</span><span class="st">&#39;green&#39;</span>)   <span class="co"># first plot </span></span>
<span id="cb602-9"><a href="#cb602-9" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].plot(us.index, us[<span class="st">&#39;pce&#39;</span>], color<span class="op">=</span><span class="st">&#39;red&#39;</span>)     <span class="co"># second plot</span></span></code></pre></div>
<ul>
<li>Otro ejemplo: combinación método 1 y método 3</li>
</ul>
<div class="sourceCode" id="cb603"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb603-1"><a href="#cb603-1" aria-hidden="true" tabindex="-1"></a><span class="co"># grab the axis</span></span>
<span id="cb603-2"><a href="#cb603-2" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> us.plot()</span>
<span id="cb603-3"><a href="#cb603-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb603-4"><a href="#cb603-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Aplicamos métodos</span></span>
<span id="cb603-5"><a href="#cb603-5" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> us.plot()  </span>
<span id="cb603-6"><a href="#cb603-6" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">&#39;US GDP and Consumption&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>, loc<span class="op">=</span><span class="st">&#39;left&#39;</span>)</span>
<span id="cb603-7"><a href="#cb603-7" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">&#39;Billions of 2013 USD&#39;</span>)</span>
<span id="cb603-8"><a href="#cb603-8" aria-hidden="true" tabindex="-1"></a>ax.legend(loc<span class="op">=</span><span class="st">&#39;center right&#39;</span>)</span></code></pre></div>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 4.2.1:</b> Escribir una función que pregunte al usuario o usuaria por las ventas de un rango de años y muestre por pantalla un diagrama de líneas con la evolución de las ventas.</p>
</div>
<div class="sourceCode" id="cb604"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb604-1"><a href="#cb604-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Respuesta: </span></span>
<span id="cb604-2"><a href="#cb604-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb604-3"><a href="#cb604-3" aria-hidden="true" tabindex="-1"></a>inicio <span class="op">=</span> <span class="bu">int</span>(<span class="bu">input</span>(<span class="st">&quot;Introduce el año inicial: &quot;</span>))</span>
<span id="cb604-4"><a href="#cb604-4" aria-hidden="true" tabindex="-1"></a>fin    <span class="op">=</span> <span class="bu">int</span>(<span class="bu">input</span>(<span class="st">&quot;Introduce el año final: &quot;</span>))</span>
<span id="cb604-5"><a href="#cb604-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb604-6"><a href="#cb604-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Definimos un diccionario vacio donde ir guardando los datos </span></span>
<span id="cb604-7"><a href="#cb604-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb604-8"><a href="#cb604-8" aria-hidden="true" tabindex="-1"></a>ventas <span class="op">=</span> {}</span>
<span id="cb604-9"><a href="#cb604-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb604-10"><a href="#cb604-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Hacer una iteración </span></span>
<span id="cb604-11"><a href="#cb604-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb604-12"><a href="#cb604-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(inicio, fin <span class="op">+</span> <span class="dv">1</span>): </span>
<span id="cb604-13"><a href="#cb604-13" aria-hidden="true" tabindex="-1"></a>    ventas[i] <span class="op">=</span> <span class="bu">input</span>(<span class="st">&quot;Introduce las ventas del año: &quot;</span> <span class="op">+</span> <span class="bu">str</span>(i))</span>
<span id="cb604-14"><a href="#cb604-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb604-15"><a href="#cb604-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Armamos la figura: </span></span>
<span id="cb604-16"><a href="#cb604-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb604-17"><a href="#cb604-17" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb604-18"><a href="#cb604-18" aria-hidden="true" tabindex="-1"></a>ax.plot(ventas.keys(), ventas.values())</span>
<span id="cb604-19"><a href="#cb604-19" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
</div>
</div>
<div id="pandas" class="section level3 hasAnchor" number="4.2.3">
<h3 class="hasAnchor"><span class="header-section-number">4.2.3</span> Pandas<a href="#pandas" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><p>Esta librería nos permitirá analizar data como tablas, rectangular o <strong>data frames</strong>.</p></li>
<li><p>En las que las filas y columnas se identifican con etiquetas en lugar de con simples índices enteros</p></li>
<li><p>La documentación la encuentra aquí: <a href="https://pandas.pydata.org/docs/" class="uri">https://pandas.pydata.org/docs/</a></p></li>
</ul>
<div id="sintaxis-básica-ejemplo-1" class="section level4 hasAnchor" number="4.2.3.1">
<h4 class="hasAnchor"><span class="header-section-number">4.2.3.1</span> Sintaxis básica: Ejemplo 1<a href="#sintaxis-básica-ejemplo-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb605"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb605-1"><a href="#cb605-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Importamos librería pandas </span></span>
<span id="cb605-2"><a href="#cb605-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb605-3"><a href="#cb605-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb605-4"><a href="#cb605-4" aria-hidden="true" tabindex="-1"></a>columnas <span class="op">=</span> [<span class="st">&quot;ind1&quot;</span>, <span class="st">&quot;ind2&quot;</span>, <span class="st">&quot;ind3&quot;</span>]</span>
<span id="cb605-5"><a href="#cb605-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(columnas)</span>
<span id="cb605-6"><a href="#cb605-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb605-7"><a href="#cb605-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformemoslo </span></span>
<span id="cb605-8"><a href="#cb605-8" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.DataFrame(columnas)</span>
<span id="cb605-9"><a href="#cb605-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb605-10"><a href="#cb605-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Ahora los datos estan en un data.frame</span></span>
<span id="cb605-11"><a href="#cb605-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data)</span>
<span id="cb605-12"><a href="#cb605-12" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(data)</span>
<span id="cb605-13"><a href="#cb605-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb605-14"><a href="#cb605-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Ahora vamos a agregar nombres y nuevas columnas con un diccionario </span></span>
<span id="cb605-15"><a href="#cb605-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb605-16"><a href="#cb605-16" aria-hidden="true" tabindex="-1"></a>nombres_columna <span class="op">=</span> {<span class="st">&quot;nombre&quot;</span>: columnas,</span>
<span id="cb605-17"><a href="#cb605-17" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;altura&quot;</span>: [<span class="fl">1.67</span>, <span class="fl">1.9</span>, <span class="fl">0.23</span>], </span>
<span id="cb605-18"><a href="#cb605-18" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;peso&quot;</span>: [<span class="dv">54</span>, <span class="dv">100</span>, <span class="dv">2</span>]}</span>
<span id="cb605-19"><a href="#cb605-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb605-20"><a href="#cb605-20" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.DataFrame(nombres_columna)</span>
<span id="cb605-21"><a href="#cb605-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data)</span>
<span id="cb605-22"><a href="#cb605-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb605-23"><a href="#cb605-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Si queremos acceder a elementos </span></span>
<span id="cb605-24"><a href="#cb605-24" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&quot;altura&quot;</span>]</span>
<span id="cb605-25"><a href="#cb605-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb605-26"><a href="#cb605-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Si queremos acceder a un valor en particular, similar a las listas</span></span>
<span id="cb605-27"><a href="#cb605-27" aria-hidden="true" tabindex="-1"></a>seleccion_columna <span class="op">=</span> data[<span class="st">&quot;altura&quot;</span>][<span class="dv">2</span>]</span>
<span id="cb605-28"><a href="#cb605-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(seleccion_columna)</span>
<span id="cb605-29"><a href="#cb605-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb605-30"><a href="#cb605-30" aria-hidden="true" tabindex="-1"></a>seleccion_filas <span class="op">=</span> data.iloc[<span class="dv">2</span>]</span>
<span id="cb605-31"><a href="#cb605-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb605-32"><a href="#cb605-32" aria-hidden="true" tabindex="-1"></a><span class="co">#data1.iloc?</span></span>
<span id="cb605-33"><a href="#cb605-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb605-34"><a href="#cb605-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(seleccion_filas)</span>
<span id="cb605-35"><a href="#cb605-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb605-36"><a href="#cb605-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Agregar nueva información</span></span>
<span id="cb605-37"><a href="#cb605-37" aria-hidden="true" tabindex="-1"></a>bmi <span class="op">=</span> []</span>
<span id="cb605-38"><a href="#cb605-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb605-39"><a href="#cb605-39" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(data)): </span>
<span id="cb605-40"><a href="#cb605-40" aria-hidden="true" tabindex="-1"></a>    bmi_score <span class="op">=</span> data[<span class="st">&quot;peso&quot;</span>][i]<span class="op">/</span>(data[<span class="st">&quot;altura&quot;</span>][i]<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb605-41"><a href="#cb605-41" aria-hidden="true" tabindex="-1"></a>    bmi.append(bmi_score)</span>
<span id="cb605-42"><a href="#cb605-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb605-43"><a href="#cb605-43" aria-hidden="true" tabindex="-1"></a>bmi</span>
<span id="cb605-44"><a href="#cb605-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb605-45"><a href="#cb605-45" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&quot;bmi&quot;</span>] <span class="op">=</span> bmi</span>
<span id="cb605-46"><a href="#cb605-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb605-47"><a href="#cb605-47" aria-hidden="true" tabindex="-1"></a>data</span>
<span id="cb605-48"><a href="#cb605-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb605-49"><a href="#cb605-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Guardemos </span></span>
<span id="cb605-50"><a href="#cb605-50" aria-hidden="true" tabindex="-1"></a>data.to_csv(<span class="st">&quot;datos_ejemplo1.csv&quot;</span>)</span></code></pre></div>
</div>
<div id="sintaxis-básica-ejemplo-2" class="section level4 hasAnchor" number="4.2.3.2">
<h4 class="hasAnchor"><span class="header-section-number">4.2.3.2</span> Sintaxis básica: Ejemplo 2<a href="#sintaxis-básica-ejemplo-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb606"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb606-1"><a href="#cb606-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Importamos datos que utilizaremos durante la clase</span></span>
<span id="cb606-2"><a href="#cb606-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> gapminder <span class="im">import</span> gapminder</span>
<span id="cb606-3"><a href="#cb606-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb606-4"><a href="#cb606-4" aria-hidden="true" tabindex="-1"></a>gapminder</span></code></pre></div>
</div>
<div id="inspeccionar-un-data-frame" class="section level4 hasAnchor" number="4.2.3.3">
<h4 class="hasAnchor"><span class="header-section-number">4.2.3.3</span> Inspeccionar un data frame<a href="#inspeccionar-un-data-frame" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb607"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb607-1"><a href="#cb607-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> gapminder </span>
<span id="cb607-2"><a href="#cb607-2" aria-hidden="true" tabindex="-1"></a>df.head(<span class="dv">5</span>)</span>
<span id="cb607-3"><a href="#cb607-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb607-4"><a href="#cb607-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Mirar las primeras 10 filas</span></span>
<span id="cb607-5"><a href="#cb607-5" aria-hidden="true" tabindex="-1"></a>df.head(<span class="dv">5</span>).tail(<span class="dv">2</span>)</span>
<span id="cb607-6"><a href="#cb607-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb607-7"><a href="#cb607-7" aria-hidden="true" tabindex="-1"></a>df.tail()</span>
<span id="cb607-8"><a href="#cb607-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb607-9"><a href="#cb607-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Mirar los tipos de datos</span></span>
<span id="cb607-10"><a href="#cb607-10" aria-hidden="true" tabindex="-1"></a>df.dtypes</span>
<span id="cb607-11"><a href="#cb607-11" aria-hidden="true" tabindex="-1"></a><span class="co"># object se refiere a datos de texto.</span></span>
<span id="cb607-12"><a href="#cb607-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb607-13"><a href="#cb607-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Mirar las columnas</span></span>
<span id="cb607-14"><a href="#cb607-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.columns)</span>
<span id="cb607-15"><a href="#cb607-15" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(df.columns)</span>
<span id="cb607-16"><a href="#cb607-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb607-17"><a href="#cb607-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostrar N fila- M columna</span></span>
<span id="cb607-18"><a href="#cb607-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.shape)</span>
<span id="cb607-19"><a href="#cb607-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb607-20"><a href="#cb607-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Mirar una columna en particular</span></span>
<span id="cb607-21"><a href="#cb607-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Caso 1</span></span>
<span id="cb607-22"><a href="#cb607-22" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;country&#39;</span>]</span>
<span id="cb607-23"><a href="#cb607-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb607-24"><a href="#cb607-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Todas: resumen estadistico</span></span>
<span id="cb607-25"><a href="#cb607-25" aria-hidden="true" tabindex="-1"></a>df.describe()</span>
<span id="cb607-26"><a href="#cb607-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb607-27"><a href="#cb607-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Texto</span></span>
<span id="cb607-28"><a href="#cb607-28" aria-hidden="true" tabindex="-1"></a>df.country.describe()</span>
<span id="cb607-29"><a href="#cb607-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb607-30"><a href="#cb607-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Numerica</span></span>
<span id="cb607-31"><a href="#cb607-31" aria-hidden="true" tabindex="-1"></a>df.lifeExp.describe()</span>
<span id="cb607-32"><a href="#cb607-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb607-33"><a href="#cb607-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;min:&quot;</span>, df.gdpPercap.<span class="bu">min</span>())</span>
<span id="cb607-34"><a href="#cb607-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;max:&quot;</span>, df.gdpPercap.<span class="bu">max</span>())</span>
<span id="cb607-35"><a href="#cb607-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;mean:&quot;</span>, df.gdpPercap.mean())</span>
<span id="cb607-36"><a href="#cb607-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;std:&quot;</span>, df.gdpPercap.std())</span>
<span id="cb607-37"><a href="#cb607-37" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;count:&quot;</span>, df.gdpPercap.count())</span></code></pre></div>
</div>
<div id="manipular" class="section level4 hasAnchor" number="4.2.3.4">
<h4 class="hasAnchor"><span class="header-section-number">4.2.3.4</span> Manipular<a href="#manipular" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Renombrar:</p>
<div class="sourceCode" id="cb608"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb608-1"><a href="#cb608-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Renombrar variables: diccionario + rename </span></span>
<span id="cb608-2"><a href="#cb608-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb608-3"><a href="#cb608-3" aria-hidden="true" tabindex="-1"></a>df.rename(columns <span class="op">=</span> {<span class="st">&#39;country&#39;</span>: <span class="st">&#39;pais&#39;</span>, <span class="st">&#39;continent&#39;</span>:<span class="st">&#39;continent&#39;</span>, </span>
<span id="cb608-4"><a href="#cb608-4" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&#39;year&#39;</span>:<span class="st">&#39;año&#39;</span>, <span class="st">&#39;lifExp&#39;</span>:<span class="st">&#39;esperanza_vida&#39;</span>, </span>
<span id="cb608-5"><a href="#cb608-5" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&#39;pop&#39;</span>:<span class="st">&#39;poblacion&#39;</span>, <span class="st">&#39;gdpPercap&#39;</span>:<span class="st">&#39;pib_percapita&#39;</span>})</span>
<span id="cb608-6"><a href="#cb608-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb608-7"><a href="#cb608-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Ojo que no hemos asignado</span></span>
<span id="cb608-8"><a href="#cb608-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb608-9"><a href="#cb608-9" aria-hidden="true" tabindex="-1"></a>df</span>
<span id="cb608-10"><a href="#cb608-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb608-11"><a href="#cb608-11" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> df.rename(columns <span class="op">=</span> {<span class="st">&#39;country&#39;</span>: <span class="st">&#39;pais&#39;</span>, <span class="st">&#39;continent&#39;</span>:<span class="st">&#39;continente&#39;</span>, </span>
<span id="cb608-12"><a href="#cb608-12" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&#39;year&#39;</span>:<span class="st">&#39;año&#39;</span>, <span class="st">&#39;lifeExp&#39;</span>:<span class="st">&#39;esperanza_vida&#39;</span>, </span>
<span id="cb608-13"><a href="#cb608-13" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&#39;pop&#39;</span>:<span class="st">&#39;poblacion&#39;</span>, <span class="st">&#39;gdpPercap&#39;</span>:<span class="st">&#39;pib_percapita&#39;</span>})</span>
<span id="cb608-14"><a href="#cb608-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb608-15"><a href="#cb608-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Recomendable generar una nueva base de datos, va dejando un registro</span></span>
<span id="cb608-16"><a href="#cb608-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb608-17"><a href="#cb608-17" aria-hidden="true" tabindex="-1"></a>df2</span></code></pre></div>
<p>Filtrar:</p>
<div class="sourceCode" id="cb609"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb609-1"><a href="#cb609-1" aria-hidden="true" tabindex="-1"></a>solo_asia <span class="op">=</span> df[df[<span class="st">&quot;continent&quot;</span>] <span class="op">==</span> <span class="st">&quot;Asia&quot;</span>]</span>
<span id="cb609-2"><a href="#cb609-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb609-3"><a href="#cb609-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Lo que esta adentro es un vecto booleano</span></span>
<span id="cb609-4"><a href="#cb609-4" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;continent&quot;</span>] <span class="op">==</span> <span class="st">&quot;Asia&quot;</span></span>
<span id="cb609-5"><a href="#cb609-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb609-6"><a href="#cb609-6" aria-hidden="true" tabindex="-1"></a>df_asia <span class="op">=</span> solo_asia</span>
<span id="cb609-7"><a href="#cb609-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_asia)</span></code></pre></div>
<p>Reemplazar:</p>
<div class="sourceCode" id="cb610"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb610-1"><a href="#cb610-1" aria-hidden="true" tabindex="-1"></a>datos_remplazados <span class="op">=</span> df.replace(<span class="st">&quot;Asia&quot;</span>, <span class="st">&quot;asia&quot;</span>)</span>
<span id="cb610-2"><a href="#cb610-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb610-3"><a href="#cb610-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(datos_remplazados)</span></code></pre></div>
<p>Remover:</p>
<div class="sourceCode" id="cb611"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb611-1"><a href="#cb611-1" aria-hidden="true" tabindex="-1"></a>remover_columna <span class="op">=</span> df.drop(<span class="st">&quot;pop&quot;</span>, axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb611-2"><a href="#cb611-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb611-3"><a href="#cb611-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(remover_columna)</span>
<span id="cb611-4"><a href="#cb611-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb611-5"><a href="#cb611-5" aria-hidden="true" tabindex="-1"></a>remover_dos_columnas <span class="op">=</span> df.drop([<span class="st">&quot;gdpPercap&quot;</span>, <span class="st">&quot;pop&quot;</span>], axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb611-6"><a href="#cb611-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb611-7"><a href="#cb611-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(remover_dos_columnas)</span>
<span id="cb611-8"><a href="#cb611-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb611-9"><a href="#cb611-9" aria-hidden="true" tabindex="-1"></a>remover_filas <span class="op">=</span> df.iloc[<span class="dv">0</span>:<span class="dv">100</span>]</span>
<span id="cb611-10"><a href="#cb611-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb611-11"><a href="#cb611-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(remover_filas)</span></code></pre></div>
<p>Agregar nuevas filas:</p>
<div class="sourceCode" id="cb612"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb612-1"><a href="#cb612-1" aria-hidden="true" tabindex="-1"></a>nuevas_filas <span class="op">=</span> {<span class="st">&quot;country&quot;</span>: <span class="st">&quot;nuevo&quot;</span>, </span>
<span id="cb612-2"><a href="#cb612-2" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;continent&quot;</span>: <span class="st">&quot;Asia&quot;</span>, </span>
<span id="cb612-3"><a href="#cb612-3" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;year&quot;</span> : <span class="st">&quot;2022&quot;</span>, </span>
<span id="cb612-4"><a href="#cb612-4" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;gdpPercap&quot;</span> : <span class="st">&quot;100000000&quot;</span>}</span>
<span id="cb612-5"><a href="#cb612-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb612-6"><a href="#cb612-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb612-7"><a href="#cb612-7" aria-hidden="true" tabindex="-1"></a>df.append(nuevas_filas, ignore_index <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb612-8"><a href="#cb612-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Para agregar un diccionario es importante la úñtima opción</span></span></code></pre></div>
<p>Describir una base de datos:</p>
<div class="sourceCode" id="cb613"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb613-1"><a href="#cb613-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Agrupar un data frame: group_by </span></span>
<span id="cb613-2"><a href="#cb613-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb613-3"><a href="#cb613-3" aria-hidden="true" tabindex="-1"></a>df_agrupado <span class="op">=</span> df.groupby(<span class="st">&#39;year&#39;</span>)</span>
<span id="cb613-4"><a href="#cb613-4" aria-hidden="true" tabindex="-1"></a>df_agrupado.mean()</span>
<span id="cb613-5"><a href="#cb613-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb613-6"><a href="#cb613-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Sobre una variable en particular</span></span>
<span id="cb613-7"><a href="#cb613-7" aria-hidden="true" tabindex="-1"></a>df_agrupado <span class="op">=</span> df[[<span class="st">&#39;gdpPercap&#39;</span>, <span class="st">&#39;year&#39;</span>]].groupby(<span class="st">&#39;year&#39;</span>)</span>
<span id="cb613-8"><a href="#cb613-8" aria-hidden="true" tabindex="-1"></a>df_agrupado.mean()</span>
<span id="cb613-9"><a href="#cb613-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb613-10"><a href="#cb613-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Podemos agrupar varias operaciones</span></span>
<span id="cb613-11"><a href="#cb613-11" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">&quot;year&quot;</span>).agg({<span class="st">&quot;lifeExp&quot;</span>: np.mean, <span class="st">&quot;gdpPercap&quot;</span>: np.size})</span>
<span id="cb613-12"><a href="#cb613-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb613-13"><a href="#cb613-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Agrupar por mas de una variable: año y continente</span></span>
<span id="cb613-14"><a href="#cb613-14" aria-hidden="true" tabindex="-1"></a>df.groupby([<span class="st">&quot;year&quot;</span>, <span class="st">&quot;continent&quot;</span>]).agg({<span class="st">&quot;lifeExp&quot;</span>: np.mean, <span class="st">&quot;gdpPercap&quot;</span>: np.size})</span></code></pre></div>
</div>
</div>
</div>
<div id="herramientas-de-programación-1" class="section level2 hasAnchor" number="4.3">
<h2 class="hasAnchor"><span class="header-section-number">4.3</span> Herramientas de programación<a href="#herramientas-de-programación-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="controladores-de-flujo" class="section level3 hasAnchor" number="4.3.1">
<h3 class="hasAnchor"><span class="header-section-number">4.3.1</span> Controladores de flujo<a href="#controladores-de-flujo" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Controlar los caminos de los códigos que programamos.</li>
<li>Permite sofisticar procesos de análisis de datos.</li>
<li>Veremos algunos típicos + otros que son propiamente de Python.</li>
</ul>
</div>
<div id="if-elif-else" class="section level3 hasAnchor" number="4.3.2">
<h3 class="hasAnchor"><span class="header-section-number">4.3.2</span> if-elif-else<a href="#if-elif-else" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb614"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb614-1"><a href="#cb614-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sintaxis básica</span></span>
<span id="cb614-2"><a href="#cb614-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb614-3"><a href="#cb614-3" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="op">-</span><span class="dv">100</span></span>
<span id="cb614-4"><a href="#cb614-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb614-5"><a href="#cb614-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> x <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb614-6"><a href="#cb614-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(x, <span class="st">&quot;es cero&quot;</span>)</span>
<span id="cb614-7"><a href="#cb614-7" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> x <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb614-8"><a href="#cb614-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(x, <span class="st">&quot;es positivo&quot;</span>)</span>
<span id="cb614-9"><a href="#cb614-9" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> x <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb614-10"><a href="#cb614-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(x, <span class="st">&quot;es negativo&quot;</span>)</span>
<span id="cb614-11"><a href="#cb614-11" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb614-12"><a href="#cb614-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(x, <span class="st">&quot;cualquier cosa.&quot;</span>)</span></code></pre></div>
<ul>
<li><p>La operación if nos permite evaluar si se cumple una condición.</p></li>
<li><p>Por ejemplo: Iteramos sobre una lista entre (0, 10), si el valor es mayor que 5 muestra el resultado, caso contrario si es que no.</p></li>
</ul>
<div class="sourceCode" id="cb615"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb615-1"><a href="#cb615-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ejemplo sencillo</span></span>
<span id="cb615-2"><a href="#cb615-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">10</span>): <span class="co">#iteración</span></span>
<span id="cb615-3"><a href="#cb615-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">&gt;</span> <span class="dv">5</span>: <span class="co">#condición</span></span>
<span id="cb615-4"><a href="#cb615-4" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(i) <span class="co">#operación</span></span>
<span id="cb615-5"><a href="#cb615-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb615-6"><a href="#cb615-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Puedo puedo definir variables dentro</span></span>
<span id="cb615-7"><a href="#cb615-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb615-8"><a href="#cb615-8" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> <span class="dv">10</span> </span>
<span id="cb615-9"><a href="#cb615-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb615-10"><a href="#cb615-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> a <span class="op">==</span> <span class="dv">10</span>: </span>
<span id="cb615-11"><a href="#cb615-11" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> a</span>
<span id="cb615-12"><a href="#cb615-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x)</span>
<span id="cb615-13"><a href="#cb615-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb615-14"><a href="#cb615-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Otros operadores con texto</span></span>
<span id="cb615-15"><a href="#cb615-15" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> <span class="st">&#39;texto2&#39;</span></span>
<span id="cb615-16"><a href="#cb615-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb615-17"><a href="#cb615-17" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> a <span class="op">!=</span> <span class="st">&#39;texto&#39;</span>:</span>
<span id="cb615-18"><a href="#cb615-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;ok&quot;</span>)</span>
<span id="cb615-19"><a href="#cb615-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb615-20"><a href="#cb615-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Dentro de una lista </span></span>
<span id="cb615-21"><a href="#cb615-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Es importante entender el flujo de los códigos que escribamos</span></span>
<span id="cb615-22"><a href="#cb615-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb615-23"><a href="#cb615-23" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> [<span class="dv">0</span>, <span class="st">&#39;x&#39;</span>, <span class="dv">3</span>]</span>
<span id="cb615-24"><a href="#cb615-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb615-25"><a href="#cb615-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">len</span>(a)): </span>
<span id="cb615-26"><a href="#cb615-26" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(a[i])</span>
<span id="cb615-27"><a href="#cb615-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb615-28"><a href="#cb615-28" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;ok&quot;</span>)</span>
<span id="cb615-29"><a href="#cb615-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> i <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb615-30"><a href="#cb615-30" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;ok2&quot;</span>)</span>
<span id="cb615-31"><a href="#cb615-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb615-32"><a href="#cb615-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Noten lo importante que es la sangria</span></span>
<span id="cb615-33"><a href="#cb615-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb615-34"><a href="#cb615-34" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> a <span class="op">==</span> <span class="dv">10</span>: </span>
<span id="cb615-35"><a href="#cb615-35" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> a</span>
<span id="cb615-36"><a href="#cb615-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x)</span>
<span id="cb615-37"><a href="#cb615-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb615-38"><a href="#cb615-38" aria-hidden="true" tabindex="-1"></a><span class="co"># ¿Qué ocurre si movemos el print()?</span></span></code></pre></div>
<ul>
<li><p>Como vimos en el ejemplo anterior, para poder realizar flujos de códigos que consideren varias situaciones vamos a usar if, elif y else.</p></li>
<li><p>Vamos a crear una lista A utilizando valores de una segunda lista B con valores entre 0-10.</p></li>
<li><p>Vamos a iterar sobre los valores de la lista A y realizar las siguientes operaciones:</p>
<ul>
<li><p>Si el valor está entre 0-3 guardamos ese mismo valor en B</p></li>
<li><p>Si el valor es mayor que 3 y menor que 5 lo multiplicamos por 2</p></li>
<li><p>Si el valor es igual a 5 pedir ingresar un valor con la función <code>input()</code></p></li>
</ul></li>
<li><p>Para todo el resto eleva el número al cuadrado</p></li>
</ul>
<div class="sourceCode" id="cb616"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb616-1"><a href="#cb616-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Cargamos numpy</span></span>
<span id="cb616-2"><a href="#cb616-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb616-3"><a href="#cb616-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb616-4"><a href="#cb616-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Creamos las listas</span></span>
<span id="cb616-5"><a href="#cb616-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb616-6"><a href="#cb616-6" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> np.arange(<span class="dv">0</span>, <span class="dv">11</span>, <span class="dv">1</span>)</span>
<span id="cb616-7"><a href="#cb616-7" aria-hidden="true" tabindex="-1"></a>B <span class="op">=</span> []</span>
<span id="cb616-8"><a href="#cb616-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb616-9"><a href="#cb616-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Iteramos sobre A</span></span>
<span id="cb616-10"><a href="#cb616-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> A: </span>
<span id="cb616-11"><a href="#cb616-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb616-12"><a href="#cb616-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Creamos la primera condición</span></span>
<span id="cb616-13"><a href="#cb616-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">&gt;=</span> <span class="dv">0</span> <span class="kw">and</span> i <span class="op">&lt;=</span> <span class="dv">3</span>: </span>
<span id="cb616-14"><a href="#cb616-14" aria-hidden="true" tabindex="-1"></a>        B.append(i)</span>
<span id="cb616-15"><a href="#cb616-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb616-16"><a href="#cb616-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Segunda condición</span></span>
<span id="cb616-17"><a href="#cb616-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> i <span class="op">&gt;</span> <span class="dv">3</span> <span class="kw">and</span> i <span class="op">&lt;</span> <span class="dv">5</span>: </span>
<span id="cb616-18"><a href="#cb616-18" aria-hidden="true" tabindex="-1"></a>        B.append(i <span class="op">*</span> <span class="dv">2</span>)</span>
<span id="cb616-19"><a href="#cb616-19" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb616-20"><a href="#cb616-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Tercera condición    </span></span>
<span id="cb616-21"><a href="#cb616-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> i <span class="op">==</span> <span class="dv">5</span>:</span>
<span id="cb616-22"><a href="#cb616-22" aria-hidden="true" tabindex="-1"></a>        B.append(<span class="bu">float</span>(<span class="bu">input</span>(<span class="st">&quot;Agregar un valor &quot;</span>)))</span>
<span id="cb616-23"><a href="#cb616-23" aria-hidden="true" tabindex="-1"></a>        B.append(<span class="bu">input</span>(<span class="st">&quot;cualquier cosa: &quot;</span>))</span>
<span id="cb616-24"><a href="#cb616-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb616-25"><a href="#cb616-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Para todo el resto</span></span>
<span id="cb616-26"><a href="#cb616-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: </span>
<span id="cb616-27"><a href="#cb616-27" aria-hidden="true" tabindex="-1"></a>        B.append(i<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb616-28"><a href="#cb616-28" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb616-29"><a href="#cb616-29" aria-hidden="true" tabindex="-1"></a><span class="co"># ¿Qué ocurre de especial con el formato float()?</span></span>
<span id="cb616-30"><a href="#cb616-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb616-31"><a href="#cb616-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;A:&quot;</span>, A)</span>
<span id="cb616-32"><a href="#cb616-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;B:&quot;</span>, B)</span></code></pre></div>
<ul>
<li>La función input() nos va a pedir entregar un valor. Esto es útil cuando necesitamos que el usuario nos reporte algún dato.</li>
</ul>
<div class="sourceCode" id="cb617"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb617-1"><a href="#cb617-1" aria-hidden="true" tabindex="-1"></a><span class="bu">input</span>()</span>
<span id="cb617-2"><a href="#cb617-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb617-3"><a href="#cb617-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Noten que es un string. Tenemos que cambiarle el formato. </span></span>
<span id="cb617-4"><a href="#cb617-4" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="bu">input</span>(<span class="st">&quot;Su edad aquí: &quot;</span>)</span>
<span id="cb617-5"><a href="#cb617-5" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(x)</span>
<span id="cb617-6"><a href="#cb617-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb617-7"><a href="#cb617-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Otro ejemplo con múltiples condiciones </span></span>
<span id="cb617-8"><a href="#cb617-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb617-9"><a href="#cb617-9" aria-hidden="true" tabindex="-1"></a>llueve <span class="op">=</span> <span class="va">True</span></span>
<span id="cb617-10"><a href="#cb617-10" aria-hidden="true" tabindex="-1"></a>salir <span class="op">=</span> <span class="va">True</span></span>
<span id="cb617-11"><a href="#cb617-11" aria-hidden="true" tabindex="-1"></a>temperatura <span class="op">=</span> <span class="dv">30</span></span>
<span id="cb617-12"><a href="#cb617-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb617-13"><a href="#cb617-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Multiples condiciones</span></span>
<span id="cb617-14"><a href="#cb617-14" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> llueve <span class="kw">and</span> salir:</span>
<span id="cb617-15"><a href="#cb617-15" aria-hidden="true" tabindex="-1"></a>    usar_paraguas <span class="op">=</span> <span class="va">True</span></span>
<span id="cb617-16"><a href="#cb617-16" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> llueve <span class="kw">and</span> <span class="kw">not</span> salir:</span>
<span id="cb617-17"><a href="#cb617-17" aria-hidden="true" tabindex="-1"></a>    usar_paraguas <span class="op">=</span> <span class="va">False</span></span>
<span id="cb617-18"><a href="#cb617-18" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> <span class="kw">not</span> llueve <span class="kw">and</span> salir <span class="kw">and</span> temperatura <span class="op">&gt;</span> <span class="dv">25</span>:</span>
<span id="cb617-19"><a href="#cb617-19" aria-hidden="true" tabindex="-1"></a>    usar_bloqueador <span class="op">=</span> <span class="va">True</span></span>
<span id="cb617-20"><a href="#cb617-20" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb617-21"><a href="#cb617-21" aria-hidden="true" tabindex="-1"></a>    vender_paragua <span class="op">=</span> <span class="va">True</span></span>
<span id="cb617-22"><a href="#cb617-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb617-23"><a href="#cb617-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Noten que el if no sigue en caso de que una condición ya esta saldada. </span></span>
<span id="cb617-24"><a href="#cb617-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Paraguas:&quot;</span>, usar_paraguas)</span>
<span id="cb617-25"><a href="#cb617-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Bloqueador:&quot;</span>, usar_bloqueador)</span>
<span id="cb617-26"><a href="#cb617-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb617-27"><a href="#cb617-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Vender Paraguas:&quot;</span>, vender_paragua)</span>
<span id="cb617-28"><a href="#cb617-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb617-29"><a href="#cb617-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Defino variables</span></span>
<span id="cb617-30"><a href="#cb617-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb617-31"><a href="#cb617-31" aria-hidden="true" tabindex="-1"></a>cuarto <span class="op">=</span> <span class="st">&quot;cocina&quot;</span></span>
<span id="cb617-32"><a href="#cb617-32" aria-hidden="true" tabindex="-1"></a>area <span class="op">=</span> <span class="fl">10.0</span></span>
<span id="cb617-33"><a href="#cb617-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb617-34"><a href="#cb617-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Para habitaciones</span></span>
<span id="cb617-35"><a href="#cb617-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb617-36"><a href="#cb617-36" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> cuarto <span class="op">==</span> <span class="st">&quot;cocina&quot;</span> :</span>
<span id="cb617-37"><a href="#cb617-37" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Mira en la cocina&quot;</span>)</span>
<span id="cb617-38"><a href="#cb617-38" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> cuarto <span class="op">==</span> <span class="st">&quot;cuarto&quot;</span>:</span>
<span id="cb617-39"><a href="#cb617-39" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Mira en el cuarto&quot;</span>)</span>
<span id="cb617-40"><a href="#cb617-40" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> :</span>
<span id="cb617-41"><a href="#cb617-41" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Mira en cualquier lugar&quot;</span>)</span>
<span id="cb617-42"><a href="#cb617-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb617-43"><a href="#cb617-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Para areas </span></span>
<span id="cb617-44"><a href="#cb617-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb617-45"><a href="#cb617-45" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> area <span class="op">&gt;</span> <span class="dv">15</span> :</span>
<span id="cb617-46"><a href="#cb617-46" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Gran tamaño&quot;</span>)</span>
<span id="cb617-47"><a href="#cb617-47" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> area <span class="op">&gt;</span> <span class="dv">10</span> :</span>
<span id="cb617-48"><a href="#cb617-48" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Tamaño normal&quot;</span>)</span>
<span id="cb617-49"><a href="#cb617-49" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> :</span>
<span id="cb617-50"><a href="#cb617-50" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Bastante pequeño&quot;</span>)</span></code></pre></div>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 4.3.1:</b> Escriba un programa que tenga como resultado su nombre si la edad ingresada es multiplo de 5. Note que la edad debe ser ingresada por el mismo usuario. Si la edad no es multiplo de 5 el programa debe dar como resultado su apellido.</p>
</div>
<div class="sourceCode" id="cb618"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb618-1"><a href="#cb618-1" aria-hidden="true" tabindex="-1"></a>edad <span class="op">=</span> <span class="bu">int</span>(<span class="bu">input</span>(<span class="st">&quot;Diga su edad: &quot;</span>))</span>
<span id="cb618-2"><a href="#cb618-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> edad <span class="op">%</span> <span class="dv">5</span> <span class="op">==</span> <span class="dv">0</span>: </span>
<span id="cb618-3"><a href="#cb618-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Nicolás&quot;</span>)</span>
<span id="cb618-4"><a href="#cb618-4" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>: </span>
<span id="cb618-5"><a href="#cb618-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Campos&quot;</span>)</span></code></pre></div>
</div>
<div id="iteradores-básicos" class="section level3 hasAnchor" number="4.3.3">
<h3 class="hasAnchor"><span class="header-section-number">4.3.3</span> Iteradores básicos<a href="#iteradores-básicos" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="for-loop" class="section level4 hasAnchor" number="4.3.3.1">
<h4 class="hasAnchor"><span class="header-section-number">4.3.3.1</span> For loop<a href="#for-loop" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb619"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb619-1"><a href="#cb619-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For loops </span></span>
<span id="cb619-2"><a href="#cb619-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> N <span class="kw">in</span> [<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">9</span>, <span class="dv">11</span>]:</span>
<span id="cb619-3"><a href="#cb619-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(N)</span>
<span id="cb619-4"><a href="#cb619-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb619-5"><a href="#cb619-5" aria-hidden="true" tabindex="-1"></a><span class="co"># For </span></span>
<span id="cb619-6"><a href="#cb619-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>):</span>
<span id="cb619-7"><a href="#cb619-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(i, end <span class="op">=</span> <span class="st">&quot; &quot;</span>)</span>
<span id="cb619-8"><a href="#cb619-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb619-9"><a href="#cb619-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Todo en la misma linea</span></span>
<span id="cb619-10"><a href="#cb619-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb619-11"><a href="#cb619-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Podemos iterar sobre una lista: iteramos en el rango de valores que tiene la lista</span></span>
<span id="cb619-12"><a href="#cb619-12" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">1</span>, <span class="st">&#39;a&#39;</span>, <span class="va">True</span>]</span>
<span id="cb619-13"><a href="#cb619-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb619-14"><a href="#cb619-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">len</span>(x)):</span>
<span id="cb619-15"><a href="#cb619-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(i, end <span class="op">=</span> <span class="st">&quot; &quot;</span>)</span>
<span id="cb619-16"><a href="#cb619-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb619-17"><a href="#cb619-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">len</span>(x)):</span>
<span id="cb619-18"><a href="#cb619-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(x[i], end <span class="op">=</span> <span class="st">&quot; &quot;</span>)</span>
<span id="cb619-19"><a href="#cb619-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb619-20"><a href="#cb619-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Podemos iterar sobre un array</span></span>
<span id="cb619-21"><a href="#cb619-21" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb619-22"><a href="#cb619-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb619-23"><a href="#cb619-23" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.array([<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>])</span>
<span id="cb619-24"><a href="#cb619-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb619-25"><a href="#cb619-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">len</span>(x)):</span>
<span id="cb619-26"><a href="#cb619-26" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(i,end <span class="op">=</span> <span class="st">&quot; &quot;</span>)</span>
<span id="cb619-27"><a href="#cb619-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb619-28"><a href="#cb619-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Podemos iterar sobre un string</span></span>
<span id="cb619-29"><a href="#cb619-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb619-30"><a href="#cb619-30" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> a <span class="kw">in</span> <span class="st">&quot;Nicolas&quot;</span> :</span>
<span id="cb619-31"><a href="#cb619-31" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(a.capitalize(), end <span class="op">=</span> <span class="st">&quot; &quot;</span>)</span>
<span id="cb619-32"><a href="#cb619-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb619-33"><a href="#cb619-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Podemos iterar en una lista de listas </span></span>
<span id="cb619-34"><a href="#cb619-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb619-35"><a href="#cb619-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Lista de listas </span></span>
<span id="cb619-36"><a href="#cb619-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb619-37"><a href="#cb619-37" aria-hidden="true" tabindex="-1"></a>casa <span class="op">=</span> [[<span class="st">&quot;living&quot;</span>, <span class="fl">11.25</span>], </span>
<span id="cb619-38"><a href="#cb619-38" aria-hidden="true" tabindex="-1"></a>         [<span class="st">&quot;cocina&quot;</span>, <span class="fl">18.0</span>], </span>
<span id="cb619-39"><a href="#cb619-39" aria-hidden="true" tabindex="-1"></a>         [<span class="st">&quot;comedor&quot;</span>, <span class="fl">20.0</span>], </span>
<span id="cb619-40"><a href="#cb619-40" aria-hidden="true" tabindex="-1"></a>         [<span class="st">&quot;habitacion&quot;</span>, <span class="fl">10.75</span>], </span>
<span id="cb619-41"><a href="#cb619-41" aria-hidden="true" tabindex="-1"></a>         [<span class="st">&quot;baño&quot;</span>, <span class="fl">9.50</span>]]</span>
<span id="cb619-42"><a href="#cb619-42" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(casa)</span>
<span id="cb619-43"><a href="#cb619-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb619-44"><a href="#cb619-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Iteramos</span></span>
<span id="cb619-45"><a href="#cb619-45" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> casa :</span>
<span id="cb619-46"><a href="#cb619-46" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;La &quot;</span> <span class="op">+</span> x[<span class="dv">0</span>] <span class="op">+</span> <span class="st">&quot; es de &quot;</span> <span class="op">+</span> <span class="bu">str</span>(x[<span class="dv">1</span>]) <span class="op">+</span> <span class="st">&quot; m2&quot;</span>)</span>
<span id="cb619-47"><a href="#cb619-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb619-48"><a href="#cb619-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Noten que el x en si mismo es una lista con dos elemenos. </span></span>
<span id="cb619-49"><a href="#cb619-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Utilizando subconjuntos de listas podemos ir llamando a los elemenos del iterador.</span></span>
<span id="cb619-50"><a href="#cb619-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb619-51"><a href="#cb619-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Creamos x y y fuera de la iteración</span></span>
<span id="cb619-52"><a href="#cb619-52" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">0</span> </span>
<span id="cb619-53"><a href="#cb619-53" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb619-54"><a href="#cb619-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb619-55"><a href="#cb619-55" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">5</span>): </span>
<span id="cb619-56"><a href="#cb619-56" aria-hidden="true" tabindex="-1"></a>    z <span class="op">=</span> <span class="dv">0</span> <span class="co"># creamos z dentro de la iteración</span></span>
<span id="cb619-57"><a href="#cb619-57" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> x <span class="op">+</span> i</span>
<span id="cb619-58"><a href="#cb619-58" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> i </span>
<span id="cb619-59"><a href="#cb619-59" aria-hidden="true" tabindex="-1"></a>    z <span class="op">=</span> z <span class="op">+</span> i</span>
<span id="cb619-60"><a href="#cb619-60" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;i:&quot;</span>, i, <span class="st">&quot;, x=&quot;</span>, x, <span class="st">&quot;, y=&quot;</span>, y, <span class="st">&quot;, z=&quot;</span>, z)</span>
<span id="cb619-61"><a href="#cb619-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb619-62"><a href="#cb619-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Podemos generar objetos para ir iterando sobre ellos. Recordar: linspace (inicio, término, cantidad de elementos)</span></span>
<span id="cb619-63"><a href="#cb619-63" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> np.linspace(<span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">5</span>)</span>
<span id="cb619-64"><a href="#cb619-64" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;type de a:&quot;</span>, <span class="bu">type</span>(a))</span>
<span id="cb619-65"><a href="#cb619-65" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;a: &quot;</span>, a)</span>
<span id="cb619-66"><a href="#cb619-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb619-67"><a href="#cb619-67" aria-hidden="true" tabindex="-1"></a><span class="co">#arange(inicio, término, separador)</span></span>
<span id="cb619-68"><a href="#cb619-68" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> np.arange(<span class="dv">1</span>, <span class="dv">10</span>,<span class="dv">1</span>)</span>
<span id="cb619-69"><a href="#cb619-69" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;type de b:&quot;</span>, <span class="bu">type</span>(b))</span>
<span id="cb619-70"><a href="#cb619-70" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;b: &quot;</span>, b)</span></code></pre></div>
<ul>
<li>Veamos dos versiones alternativas de hacer el mismo for, pero anidado</li>
</ul>
<div class="sourceCode" id="cb620"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb620-1"><a href="#cb620-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(a,b)</span>
<span id="cb620-2"><a href="#cb620-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb620-3"><a href="#cb620-3" aria-hidden="true" tabindex="-1"></a><span class="co"># For anidados. </span></span>
<span id="cb620-4"><a href="#cb620-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb620-5"><a href="#cb620-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Creamos una lista</span></span>
<span id="cb620-6"><a href="#cb620-6" aria-hidden="true" tabindex="-1"></a>lista1 <span class="op">=</span> []</span>
<span id="cb620-7"><a href="#cb620-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb620-8"><a href="#cb620-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Iteramos sobre los valoes de a y b</span></span>
<span id="cb620-9"><a href="#cb620-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> a: </span>
<span id="cb620-10"><a href="#cb620-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> b: </span>
<span id="cb620-11"><a href="#cb620-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">#3. Anexamos una operación a la lista</span></span>
<span id="cb620-12"><a href="#cb620-12" aria-hidden="true" tabindex="-1"></a><span class="co">#         print((i, j), &quot;multiplicacion:&quot;, i * j)</span></span>
<span id="cb620-13"><a href="#cb620-13" aria-hidden="true" tabindex="-1"></a>        lista1.append(i <span class="op">*</span> j) </span>
<span id="cb620-14"><a href="#cb620-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(lista1)</span>
<span id="cb620-15"><a href="#cb620-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb620-16"><a href="#cb620-16" aria-hidden="true" tabindex="-1"></a><span class="co">#1. Creamos una lista 2</span></span>
<span id="cb620-17"><a href="#cb620-17" aria-hidden="true" tabindex="-1"></a>lista2 <span class="op">=</span> []</span>
<span id="cb620-18"><a href="#cb620-18" aria-hidden="true" tabindex="-1"></a><span class="co">#2. Iteramos sobre el largo de las listas a y b</span></span>
<span id="cb620-19"><a href="#cb620-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">len</span>(a)): </span>
<span id="cb620-20"><a href="#cb620-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">len</span>(b)): </span>
<span id="cb620-21"><a href="#cb620-21" aria-hidden="true" tabindex="-1"></a>        <span class="co">#3. Anexamos una operación a la lista</span></span>
<span id="cb620-22"><a href="#cb620-22" aria-hidden="true" tabindex="-1"></a>        lista2.append(a[i] <span class="op">*</span> b[j]) </span>
<span id="cb620-23"><a href="#cb620-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(lista2)</span>
<span id="cb620-24"><a href="#cb620-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb620-25"><a href="#cb620-25" aria-hidden="true" tabindex="-1"></a><span class="co">#Podemos sumar los valores de una lista con sum()</span></span>
<span id="cb620-26"><a href="#cb620-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;suma de la lista:&quot;</span>, <span class="bu">sum</span>(lista2))</span>
<span id="cb620-27"><a href="#cb620-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb620-28"><a href="#cb620-28" aria-hidden="true" tabindex="-1"></a>lista1 <span class="op">==</span> lista2</span>
<span id="cb620-29"><a href="#cb620-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb620-30"><a href="#cb620-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Puedo ingresar tuplas de forma tal de recuperar el indice y el resultado! </span></span>
<span id="cb620-31"><a href="#cb620-31" aria-hidden="true" tabindex="-1"></a>lista <span class="op">=</span> [<span class="fl">1.73</span>, <span class="fl">1.68</span>, <span class="fl">1.71</span>, <span class="fl">1.89</span>]</span>
<span id="cb620-32"><a href="#cb620-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb620-33"><a href="#cb620-33" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> index, a <span class="kw">in</span> <span class="bu">enumerate</span>(lista):</span>
<span id="cb620-34"><a href="#cb620-34" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;indice &quot;</span> <span class="op">+</span> <span class="bu">str</span>(index) <span class="op">+</span> <span class="st">&quot;: &quot;</span> <span class="op">+</span> <span class="bu">str</span>(a))</span>
<span id="cb620-35"><a href="#cb620-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb620-36"><a href="#cb620-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Noten que utilizamos un enumerate(). </span></span>
<span id="cb620-37"><a href="#cb620-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Esto es un interador. </span></span>
<span id="cb620-38"><a href="#cb620-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Revisaremos más de estos en la siguiente sección</span></span>
<span id="cb620-39"><a href="#cb620-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Como pueden ver auenta nuestra posibilidades en Python</span></span>
<span id="cb620-40"><a href="#cb620-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Se pueden saltar en saltos de más de uno? (en tuplas?)</span></span></code></pre></div>
</div>
<div id="while-loop-1" class="section level4 hasAnchor" number="4.3.3.2">
<h4 class="hasAnchor"><span class="header-section-number">4.3.3.2</span> While loop<a href="#while-loop-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>No muy común</li>
<li>Útil para resolver problemas de optimización</li>
</ul>
<div class="sourceCode" id="cb621"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb621-1"><a href="#cb621-1" aria-hidden="true" tabindex="-1"></a>error <span class="op">=</span> <span class="dv">50</span> </span>
<span id="cb621-2"><a href="#cb621-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb621-3"><a href="#cb621-3" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> error <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb621-4"><a href="#cb621-4" aria-hidden="true" tabindex="-1"></a>    error <span class="op">=</span> error<span class="op">/</span><span class="dv">4</span></span>
<span id="cb621-5"><a href="#cb621-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(error)</span>
<span id="cb621-6"><a href="#cb621-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb621-7"><a href="#cb621-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Otra forma más típica de hacer la actualización </span></span>
<span id="cb621-8"><a href="#cb621-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb621-9"><a href="#cb621-9" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb621-10"><a href="#cb621-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb621-11"><a href="#cb621-11" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> i <span class="op">&lt;</span> <span class="dv">10</span>:</span>
<span id="cb621-12"><a href="#cb621-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(i, end<span class="op">=</span><span class="st">&#39; &#39;</span>)</span>
<span id="cb621-13"><a href="#cb621-13" aria-hidden="true" tabindex="-1"></a>    i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb621-14"><a href="#cb621-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb621-15"><a href="#cb621-15" aria-hidden="true" tabindex="-1"></a><span class="co"># While loop: pueden ser eternos. ¿Utilidad practica? </span></span>
<span id="cb621-16"><a href="#cb621-16" aria-hidden="true" tabindex="-1"></a> i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb621-17"><a href="#cb621-17" aria-hidden="true" tabindex="-1"></a> <span class="cf">while</span> i <span class="op">&lt;</span> <span class="dv">10</span>:</span>
<span id="cb621-18"><a href="#cb621-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(i, end<span class="op">=</span><span class="st">&#39; &#39;</span>)</span>
<span id="cb621-19"><a href="#cb621-19" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> i <span class="op">+</span>  <span class="dv">1</span></span>
<span id="cb621-20"><a href="#cb621-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb621-21"><a href="#cb621-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Recuerden que puedo agregar condicionales </span></span>
<span id="cb621-22"><a href="#cb621-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb621-23"><a href="#cb621-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Condición inicial</span></span>
<span id="cb621-24"><a href="#cb621-24" aria-hidden="true" tabindex="-1"></a>inicial <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb621-25"><a href="#cb621-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb621-26"><a href="#cb621-26" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> inicial <span class="op">!=</span> <span class="dv">0</span> :</span>
<span id="cb621-27"><a href="#cb621-27" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;corregir...&quot;</span>)</span>
<span id="cb621-28"><a href="#cb621-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> inicial <span class="op">&gt;</span> <span class="dv">0</span> :</span>
<span id="cb621-29"><a href="#cb621-29" aria-hidden="true" tabindex="-1"></a>        inicial <span class="op">=</span> inicial <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb621-30"><a href="#cb621-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb621-31"><a href="#cb621-31" aria-hidden="true" tabindex="-1"></a>        inicial <span class="op">=</span> inicial <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb621-32"><a href="#cb621-32" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(inicial)</span></code></pre></div>
</div>
<div id="opcionales-break-y-continue" class="section level4 hasAnchor" number="4.3.3.3">
<h4 class="hasAnchor"><span class="header-section-number">4.3.3.3</span> Opcionales: break y continue<a href="#opcionales-break-y-continue" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><strong>break</strong>: quiebra loop</li>
<li><strong>continue</strong>: siguiente</li>
</ul>
<div class="sourceCode" id="cb622"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb622-1"><a href="#cb622-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Se lo salta</span></span>
<span id="cb622-2"><a href="#cb622-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>):</span>
<span id="cb622-3"><a href="#cb622-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> n <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb622-4"><a href="#cb622-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb622-5"><a href="#cb622-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(n, end<span class="op">=</span><span class="st">&#39; &#39;</span>)</span>
<span id="cb622-6"><a href="#cb622-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb622-7"><a href="#cb622-7" aria-hidden="true" tabindex="-1"></a><span class="co"># No continua si se llega a un nivel predeterminado </span></span>
<span id="cb622-8"><a href="#cb622-8" aria-hidden="true" tabindex="-1"></a>a, b <span class="op">=</span> <span class="dv">0</span>, <span class="dv">1</span></span>
<span id="cb622-9"><a href="#cb622-9" aria-hidden="true" tabindex="-1"></a>amax <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb622-10"><a href="#cb622-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb622-11"><a href="#cb622-11" aria-hidden="true" tabindex="-1"></a>L <span class="op">=</span> []</span>
<span id="cb622-12"><a href="#cb622-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb622-13"><a href="#cb622-13" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb622-14"><a href="#cb622-14" aria-hidden="true" tabindex="-1"></a>    (a, b) <span class="op">=</span> (b, a <span class="op">+</span> b)</span>
<span id="cb622-15"><a href="#cb622-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> a <span class="op">&gt;</span> amax:</span>
<span id="cb622-16"><a href="#cb622-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb622-17"><a href="#cb622-17" aria-hidden="true" tabindex="-1"></a>    L.append(a)</span>
<span id="cb622-18"><a href="#cb622-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb622-19"><a href="#cb622-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(L)</span></code></pre></div>
</div>
<div id="iterar-sobre-diccionarios-y-arreglos" class="section level4 hasAnchor" number="4.3.3.4">
<h4 class="hasAnchor"><span class="header-section-number">4.3.3.4</span> Iterar sobre diccionarios y arreglos<a href="#iterar-sobre-diccionarios-y-arreglos" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>Hay que tener cuidado al iterar sobre estos objetos</li>
<li>Veamos dos ejemplos</li>
</ul>
<div class="sourceCode" id="cb623"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb623-1"><a href="#cb623-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Diccionarios </span></span>
<span id="cb623-2"><a href="#cb623-2" aria-hidden="true" tabindex="-1"></a>mundo <span class="op">=</span> {<span class="st">&quot;Burgos&quot;</span>: <span class="fl">30.55</span>, </span>
<span id="cb623-3"><a href="#cb623-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Villasana de Mena&quot;</span>: <span class="fl">2.77</span>, </span>
<span id="cb623-4"><a href="#cb623-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Santiago&quot;</span>: <span class="dv">39</span>}</span>
<span id="cb623-5"><a href="#cb623-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb623-6"><a href="#cb623-6" aria-hidden="true" tabindex="-1"></a>mundo</span>
<span id="cb623-7"><a href="#cb623-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb623-8"><a href="#cb623-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key, value <span class="kw">in</span> mundo: </span>
<span id="cb623-9"><a href="#cb623-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(key <span class="op">+</span> <span class="st">&quot;:&quot;</span> <span class="op">+</span> <span class="bu">str</span>(value))</span>
<span id="cb623-10"><a href="#cb623-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb623-11"><a href="#cb623-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Tenemos que utilizar un metodo</span></span>
<span id="cb623-12"><a href="#cb623-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key, value <span class="kw">in</span> mundo.items(): </span>
<span id="cb623-13"><a href="#cb623-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(key <span class="op">+</span> <span class="st">&quot;: &quot;</span> <span class="op">+</span> <span class="bu">str</span>(value))</span>
<span id="cb623-14"><a href="#cb623-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb623-15"><a href="#cb623-15" aria-hidden="true" tabindex="-1"></a>mundo.items()</span>
<span id="cb623-16"><a href="#cb623-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb623-17"><a href="#cb623-17" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(mundo.items())</span>
<span id="cb623-18"><a href="#cb623-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb623-19"><a href="#cb623-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Ejemplo: </span></span>
<span id="cb623-20"><a href="#cb623-20" aria-hidden="true" tabindex="-1"></a>europa <span class="op">=</span> {<span class="st">&#39;spain&#39;</span>:<span class="st">&#39;madrid&#39;</span>, <span class="st">&#39;france&#39;</span>:<span class="st">&#39;paris&#39;</span>, <span class="st">&#39;germany&#39;</span>:<span class="st">&#39;berlin&#39;</span>,</span>
<span id="cb623-21"><a href="#cb623-21" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;norway&#39;</span>:<span class="st">&#39;oslo&#39;</span>, <span class="st">&#39;italy&#39;</span>:<span class="st">&#39;rome&#39;</span>, <span class="st">&#39;poland&#39;</span>:<span class="st">&#39;warsaw&#39;</span>, <span class="st">&#39;austria&#39;</span>:<span class="st">&#39;vienna&#39;</span> }</span>
<span id="cb623-22"><a href="#cb623-22" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb623-23"><a href="#cb623-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterar sobre un diccionario </span></span>
<span id="cb623-24"><a href="#cb623-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key, value <span class="kw">in</span> europa.items() :</span>
<span id="cb623-25"><a href="#cb623-25" aria-hidden="true" tabindex="-1"></a>     <span class="bu">print</span>(<span class="st">&quot;the capital of &quot;</span> <span class="op">+</span> <span class="bu">str</span>(key) <span class="op">+</span> <span class="st">&quot; is &quot;</span> <span class="op">+</span> <span class="bu">str</span>(value))</span>
<span id="cb623-26"><a href="#cb623-26" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb623-27"><a href="#cb623-27" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb623-28"><a href="#cb623-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Noten que hacermos el for con una tupla!</span></span>
<span id="cb623-29"><a href="#cb623-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb623-30"><a href="#cb623-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Arreglo 2d</span></span>
<span id="cb623-31"><a href="#cb623-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb623-32"><a href="#cb623-32" aria-hidden="true" tabindex="-1"></a>np_altura <span class="op">=</span> np.array([<span class="fl">1.73</span>,<span class="fl">1.68</span>,<span class="fl">1.71</span>,<span class="fl">1.89</span>,<span class="fl">1.79</span>])</span>
<span id="cb623-33"><a href="#cb623-33" aria-hidden="true" tabindex="-1"></a>np_peso <span class="op">=</span> np.array([<span class="fl">65.4</span>,<span class="fl">32.2</span>,<span class="fl">42.3</span>,<span class="fl">42.3</span>,<span class="fl">89.2</span>])</span>
<span id="cb623-34"><a href="#cb623-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb623-35"><a href="#cb623-35" aria-hidden="true" tabindex="-1"></a>meas <span class="op">=</span> np.array([np_altura,np_peso])</span>
<span id="cb623-36"><a href="#cb623-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb623-37"><a href="#cb623-37" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(meas)</span>
<span id="cb623-38"><a href="#cb623-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb623-39"><a href="#cb623-39" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> val <span class="kw">in</span> meas: </span>
<span id="cb623-40"><a href="#cb623-40" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(val)</span>
<span id="cb623-41"><a href="#cb623-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb623-42"><a href="#cb623-42" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> val <span class="kw">in</span> np.nditer(meas): </span>
<span id="cb623-43"><a href="#cb623-43" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(val)</span></code></pre></div>
</div>
<div id="iterar-sobre-pandas" class="section level4 hasAnchor" number="4.3.3.5">
<h4 class="hasAnchor"><span class="header-section-number">4.3.3.5</span> Iterar sobre Pandas<a href="#iterar-sobre-pandas" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>Hay que tener cuidado al iterar sobre estos objetos</li>
<li>Veamos dos ejemplos</li>
</ul>
<div class="sourceCode" id="cb624"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb624-1"><a href="#cb624-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> gapminder <span class="im">import</span> gapminder</span>
<span id="cb624-2"><a href="#cb624-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb624-3"><a href="#cb624-3" aria-hidden="true" tabindex="-1"></a>gapminder</span>
<span id="cb624-4"><a href="#cb624-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb624-5"><a href="#cb624-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Primer intento</span></span>
<span id="cb624-6"><a href="#cb624-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> val <span class="kw">in</span> gapminder: </span>
<span id="cb624-7"><a href="#cb624-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(val)</span>
<span id="cb624-8"><a href="#cb624-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb624-9"><a href="#cb624-9" aria-hidden="true" tabindex="-1"></a><span class="co"># No entiende que queremos...</span></span>
<span id="cb624-10"><a href="#cb624-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb624-11"><a href="#cb624-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Utilizamos iterrows method</span></span>
<span id="cb624-12"><a href="#cb624-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> lab,row <span class="kw">in</span> gapminder.iterrows(): </span>
<span id="cb624-13"><a href="#cb624-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(lab)</span>
<span id="cb624-14"><a href="#cb624-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(row)</span>
<span id="cb624-15"><a href="#cb624-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb624-16"><a href="#cb624-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Lab esta asociado al ID de un data frame</span></span>
<span id="cb624-17"><a href="#cb624-17" aria-hidden="true" tabindex="-1"></a><span class="co"># row es toda la fila asociada</span></span>
<span id="cb624-18"><a href="#cb624-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb624-19"><a href="#cb624-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Podemos hacerlo selectivamente</span></span>
<span id="cb624-20"><a href="#cb624-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> lab,row <span class="kw">in</span> gapminder.iterrows(): </span>
<span id="cb624-21"><a href="#cb624-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="bu">str</span>(lab) <span class="op">+</span> <span class="st">&quot;: &quot;</span> <span class="op">+</span> row[<span class="st">&quot;continent&quot;</span>])</span>
<span id="cb624-22"><a href="#cb624-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb624-23"><a href="#cb624-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Agregar una columna con un iterador </span></span>
<span id="cb624-24"><a href="#cb624-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb624-25"><a href="#cb624-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> lab,row <span class="kw">in</span> gapminder.iterrows(): </span>
<span id="cb624-26"><a href="#cb624-26" aria-hidden="true" tabindex="-1"></a>    gapminder.loc[lab, <span class="st">&quot;tamaño_continente&quot;</span>] <span class="op">=</span> <span class="bu">len</span>(row[<span class="st">&quot;continent&quot;</span>])</span>
<span id="cb624-27"><a href="#cb624-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb624-28"><a href="#cb624-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Es solo un ejemplo, no es muy eficiente.</span></span>
<span id="cb624-29"><a href="#cb624-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb624-30"><a href="#cb624-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Otro ejemplo, utilizando una función en vez de un método</span></span>
<span id="cb624-31"><a href="#cb624-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb624-32"><a href="#cb624-32" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> lab,row <span class="kw">in</span> gapminder.iterrows(): </span>
<span id="cb624-33"><a href="#cb624-33" aria-hidden="true" tabindex="-1"></a>    gapminder.loc[lab, <span class="st">&quot;continente_mayus&quot;</span>] <span class="op">=</span> row[<span class="st">&quot;continent&quot;</span>].upper()</span>
<span id="cb624-34"><a href="#cb624-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb624-35"><a href="#cb624-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Es solo un ejemplo, no es muy eficiente.</span></span>
<span id="cb624-36"><a href="#cb624-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb624-37"><a href="#cb624-37" aria-hidden="true" tabindex="-1"></a>gapminder</span>
<span id="cb624-38"><a href="#cb624-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb624-39"><a href="#cb624-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Opcion alternativa: buscar un method y vectorizar</span></span>
<span id="cb624-40"><a href="#cb624-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb624-41"><a href="#cb624-41" aria-hidden="true" tabindex="-1"></a>gapminder[<span class="st">&quot;tamaño_continente_vect&quot;</span>] <span class="op">=</span> gapminder[<span class="st">&quot;continent&quot;</span>].<span class="bu">apply</span>(<span class="bu">len</span>)</span>
<span id="cb624-42"><a href="#cb624-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb624-43"><a href="#cb624-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Esta es la opción eficiente.</span></span>
<span id="cb624-44"><a href="#cb624-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb624-45"><a href="#cb624-45" aria-hidden="true" tabindex="-1"></a>gapminder</span>
<span id="cb624-46"><a href="#cb624-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb624-47"><a href="#cb624-47" aria-hidden="true" tabindex="-1"></a>gapminder[<span class="st">&quot;Cont_mayus_vect&quot;</span>] <span class="op">=</span> gapminder[<span class="st">&quot;continent&quot;</span>].<span class="bu">apply</span>(<span class="bu">str</span>.upper)</span>
<span id="cb624-48"><a href="#cb624-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb624-49"><a href="#cb624-49" aria-hidden="true" tabindex="-1"></a>gapminder</span></code></pre></div>
</div>
</div>
<div id="iteradores-adicionales-en-python" class="section level3 hasAnchor" number="4.3.4">
<h3 class="hasAnchor"><span class="header-section-number">4.3.4</span> Iteradores adicionales en Python<a href="#iteradores-adicionales-en-python" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="enumerate" class="section level4 hasAnchor" number="4.3.4.1">
<h4 class="hasAnchor"><span class="header-section-number">4.3.4.1</span> Enumerate<a href="#enumerate" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><strong>usar cuando</strong>: queremos tener registro tanto del indice como del valor asociado</li>
</ul>
<div class="sourceCode" id="cb625"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb625-1"><a href="#cb625-1" aria-hidden="true" tabindex="-1"></a>L <span class="op">=</span> [<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">8</span>, <span class="dv">10</span>]</span>
<span id="cb625-2"><a href="#cb625-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb625-3"><a href="#cb625-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(L)):</span>
<span id="cb625-4"><a href="#cb625-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(i, L[i])</span>
<span id="cb625-5"><a href="#cb625-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb625-6"><a href="#cb625-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, val <span class="kw">in</span> <span class="bu">enumerate</span>(L):</span>
<span id="cb625-7"><a href="#cb625-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(i, val)</span></code></pre></div>
</div>
<div id="zip" class="section level4 hasAnchor" number="4.3.4.2">
<h4 class="hasAnchor"><span class="header-section-number">4.3.4.2</span> Zip<a href="#zip" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><strong>usar cuando</strong>: Se quiera iterar sobre múltiples listas simultaneamente</li>
</ul>
<div class="sourceCode" id="cb626"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb626-1"><a href="#cb626-1" aria-hidden="true" tabindex="-1"></a>L <span class="op">=</span> [<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">8</span>, <span class="dv">10</span>]</span>
<span id="cb626-2"><a href="#cb626-2" aria-hidden="true" tabindex="-1"></a>R <span class="op">=</span> [<span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">9</span>, <span class="dv">12</span>, <span class="dv">15</span>]</span>
<span id="cb626-3"><a href="#cb626-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb626-4"><a href="#cb626-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> lval, rval <span class="kw">in</span> <span class="bu">zip</span>(L, R):</span>
<span id="cb626-5"><a href="#cb626-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(lval, rval)</span>
<span id="cb626-6"><a href="#cb626-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb626-7"><a href="#cb626-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Si son de distinto tamaño?</span></span>
<span id="cb626-8"><a href="#cb626-8" aria-hidden="true" tabindex="-1"></a>L <span class="op">=</span> [<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">8</span>, <span class="dv">10</span>]</span>
<span id="cb626-9"><a href="#cb626-9" aria-hidden="true" tabindex="-1"></a>R <span class="op">=</span> [<span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">9</span>]</span>
<span id="cb626-10"><a href="#cb626-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> lval, rval <span class="kw">in</span> <span class="bu">zip</span>(L, R):</span>
<span id="cb626-11"><a href="#cb626-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(lval, rval)</span>
<span id="cb626-12"><a href="#cb626-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb626-13"><a href="#cb626-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Va a utilizar como referencia el más corto</span></span></code></pre></div>
</div>
<div id="map" class="section level4 hasAnchor" number="4.3.4.3">
<h4 class="hasAnchor"><span class="header-section-number">4.3.4.3</span> Map<a href="#map" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><strong>usar cuando</strong>: quiera tomar una función y aplicarla al valor dentro de un objeto</li>
</ul>
<div class="sourceCode" id="cb627"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb627-1"><a href="#cb627-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Defino una función</span></span>
<span id="cb627-2"><a href="#cb627-2" aria-hidden="true" tabindex="-1"></a>cuadrado <span class="op">=</span> <span class="kw">lambda</span> x: x <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb627-3"><a href="#cb627-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb627-4"><a href="#cb627-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> val <span class="kw">in</span> <span class="bu">map</span>(cuadrado, <span class="bu">range</span>(<span class="dv">100</span>)):</span>
<span id="cb627-5"><a href="#cb627-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(val, end <span class="op">=</span> <span class="st">&quot; &quot;</span>)</span>
<span id="cb627-6"><a href="#cb627-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb627-7"><a href="#cb627-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Nota: Una función lambda puede tomar cualquier número de argumentos, pero sólo puede tener una expresión.</span></span>
<span id="cb627-8"><a href="#cb627-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb627-9"><a href="#cb627-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Otro ejemplo: importar funciones especificas a una librearía </span></span>
<span id="cb627-10"><a href="#cb627-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb627-11"><a href="#cb627-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb627-12"><a href="#cb627-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> val <span class="kw">in</span> <span class="bu">map</span>(math.sqrt, <span class="bu">range</span>(<span class="dv">100</span>)):</span>
<span id="cb627-13"><a href="#cb627-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(val, end <span class="op">=</span> <span class="st">&quot; &quot;</span>)</span></code></pre></div>
</div>
<div id="filter" class="section level4 hasAnchor" number="4.3.4.4">
<h4 class="hasAnchor"><span class="header-section-number">4.3.4.4</span> Filter<a href="#filter" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>similar a map, excepto que pasa valores que son considerados verdaderos por la función de filtrado</li>
</ul>
<div class="sourceCode" id="cb628"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb628-1"><a href="#cb628-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Itera sobre los valores para los cuales se cumple la condición</span></span>
<span id="cb628-2"><a href="#cb628-2" aria-hidden="true" tabindex="-1"></a>es_par <span class="op">=</span> <span class="kw">lambda</span> x: x <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span></span>
<span id="cb628-3"><a href="#cb628-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb628-4"><a href="#cb628-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> val <span class="kw">in</span> <span class="bu">filter</span>(es_par, <span class="bu">range</span>(<span class="dv">100</span>)):</span>
<span id="cb628-5"><a href="#cb628-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(val, end<span class="op">=</span><span class="st">&#39; &#39;</span>)</span></code></pre></div>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 4.3.2:</b> Genere un código que tome una lista de strings y calcule su tamaño.</p>
</div>
<div class="sourceCode" id="cb629"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb629-1"><a href="#cb629-1" aria-hidden="true" tabindex="-1"></a>lista_strings <span class="op">=</span> [<span class="st">&quot;Rodrigo&quot;</span>, <span class="st">&quot;Santiago&quot;</span>, <span class="st">&quot;Tania&quot;</span>, <span class="st">&quot;Laura&quot;</span>, <span class="st">&quot;Nicolás&quot;</span>]</span>
<span id="cb629-2"><a href="#cb629-2" aria-hidden="true" tabindex="-1"></a>lista_final <span class="op">=</span> <span class="bu">list</span>(<span class="bu">map</span>(<span class="bu">len</span>,lista_strings))</span>
<span id="cb629-3"><a href="#cb629-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(lista_final)</span></code></pre></div>
</div>
</div>
<div id="list-comprehension" class="section level3 hasAnchor" number="4.3.5">
<h3 class="hasAnchor"><span class="header-section-number">4.3.5</span> List Comprehension<a href="#list-comprehension" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Es una forma de comprimir la construcción de un objeto utilizando un iterador.</li>
</ul>
<div class="sourceCode" id="cb630"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb630-1"><a href="#cb630-1" aria-hidden="true" tabindex="-1"></a>[i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">20</span>) <span class="cf">if</span> i <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span>]</span>
<span id="cb630-2"><a href="#cb630-2" aria-hidden="true" tabindex="-1"></a><span class="co"># El resultado es una lista que solo considera los números pares.</span></span>
<span id="cb630-3"><a href="#cb630-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb630-4"><a href="#cb630-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Un for-loop</span></span>
<span id="cb630-5"><a href="#cb630-5" aria-hidden="true" tabindex="-1"></a>L <span class="op">=</span> []</span>
<span id="cb630-6"><a href="#cb630-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb630-7"><a href="#cb630-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">12</span>):</span>
<span id="cb630-8"><a href="#cb630-8" aria-hidden="true" tabindex="-1"></a>    L.append(n <span class="op">**</span> <span class="dv">2</span>)</span>
<span id="cb630-9"><a href="#cb630-9" aria-hidden="true" tabindex="-1"></a>L</span>
<span id="cb630-10"><a href="#cb630-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb630-11"><a href="#cb630-11" aria-hidden="true" tabindex="-1"></a>[n <span class="op">**</span> <span class="dv">2</span> <span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">12</span>)]</span>
<span id="cb630-12"><a href="#cb630-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb630-13"><a href="#cb630-13" aria-hidden="true" tabindex="-1"></a><span class="co"># construir una lista formada por el cuadrado de n para cada n hasta 12</span></span></code></pre></div>
<div class="figure">
<img src="attachment:image.png" alt="" />
<p class="caption">image.png</p>
</div>
<div class="figure">
<img src="attachment:image.png" alt="" />
<p class="caption">image.png</p>
</div>
<div id="iteración-múltiple" class="section level4 hasAnchor" number="4.3.5.1">
<h4 class="hasAnchor"><span class="header-section-number">4.3.5.1</span> Iteración Múltiple<a href="#iteración-múltiple" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><strong>objetivo</strong>: armar for-loops anidados en una linea</li>
</ul>
<div class="sourceCode" id="cb631"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb631-1"><a href="#cb631-1" aria-hidden="true" tabindex="-1"></a>[(i, j) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>) <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>)]</span>
<span id="cb631-2"><a href="#cb631-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb631-3"><a href="#cb631-3" aria-hidden="true" tabindex="-1"></a>[(i, j, z) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>) <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>) <span class="cf">for</span> z <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>)]</span></code></pre></div>
</div>
<div id="condicionales-en-el-iterador" class="section level4 hasAnchor" number="4.3.5.2">
<h4 class="hasAnchor"><span class="header-section-number">4.3.5.2</span> Condicionales en el iterador<a href="#condicionales-en-el-iterador" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><strong>Idea</strong>: agregar condicionales al final de la expresión.</li>
</ul>
<div class="sourceCode" id="cb632"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb632-1"><a href="#cb632-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Construir una lista de valores para cada valor hasta 20, pero sólo si el valor no es divisible por 3&quot;</span></span>
<span id="cb632-2"><a href="#cb632-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb632-3"><a href="#cb632-3" aria-hidden="true" tabindex="-1"></a>[val <span class="cf">for</span> val <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">20</span>) <span class="cf">if</span> val <span class="op">%</span> <span class="dv">3</span> <span class="op">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb632-4"><a href="#cb632-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb632-5"><a href="#cb632-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Equivalente a</span></span>
<span id="cb632-6"><a href="#cb632-6" aria-hidden="true" tabindex="-1"></a>L <span class="op">=</span> []</span>
<span id="cb632-7"><a href="#cb632-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb632-8"><a href="#cb632-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> val <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">20</span>):</span>
<span id="cb632-9"><a href="#cb632-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> val <span class="op">%</span> <span class="dv">3</span> <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb632-10"><a href="#cb632-10" aria-hidden="true" tabindex="-1"></a>        L.append(val)</span>
<span id="cb632-11"><a href="#cb632-11" aria-hidden="true" tabindex="-1"></a>L</span>
<span id="cb632-12"><a href="#cb632-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb632-13"><a href="#cb632-13" aria-hidden="true" tabindex="-1"></a>val <span class="op">=</span> <span class="op">-</span><span class="dv">1000</span></span>
<span id="cb632-14"><a href="#cb632-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb632-15"><a href="#cb632-15" aria-hidden="true" tabindex="-1"></a>val <span class="cf">if</span> val <span class="op">&gt;=</span> <span class="dv">0</span> <span class="cf">else</span> <span class="op">-</span>val</span>
<span id="cb632-16"><a href="#cb632-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb632-17"><a href="#cb632-17" aria-hidden="true" tabindex="-1"></a><span class="co"># ¿Qué función es esta?</span></span>
<span id="cb632-18"><a href="#cb632-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb632-19"><a href="#cb632-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Una más compleja</span></span>
<span id="cb632-20"><a href="#cb632-20" aria-hidden="true" tabindex="-1"></a><span class="co"># construir una lista, dejando fuera los múltiplos de 3, y haciendo negativos todos los múltiplos de 2.</span></span>
<span id="cb632-21"><a href="#cb632-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb632-22"><a href="#cb632-22" aria-hidden="true" tabindex="-1"></a>[val <span class="cf">if</span> val <span class="op">%</span> <span class="dv">2</span> <span class="cf">else</span> <span class="op">-</span>val <span class="cf">for</span> val <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">20</span>) <span class="cf">if</span> val <span class="op">%</span> <span class="dv">3</span>]</span>
<span id="cb632-23"><a href="#cb632-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb632-24"><a href="#cb632-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Se puede extender para otro tipo de objetos, por ejemplo a conjuntos</span></span>
<span id="cb632-25"><a href="#cb632-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb632-26"><a href="#cb632-26" aria-hidden="true" tabindex="-1"></a>{n<span class="op">**</span><span class="dv">2</span> <span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">12</span>)}</span>
<span id="cb632-27"><a href="#cb632-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb632-28"><a href="#cb632-28" aria-hidden="true" tabindex="-1"></a>{a <span class="op">%</span> <span class="dv">3</span> <span class="cf">for</span> a <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1000</span>)}</span></code></pre></div>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 4.3.3:</b> Escriba los siguientes procesos iterativos en formato de <em>list comprehension</em>:</p>
<div class="sourceCode" id="cb633"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb633-1"><a href="#cb633-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parte a</span></span>
<span id="cb633-2"><a href="#cb633-2" aria-hidden="true" tabindex="-1"></a>numeros <span class="op">=</span> [<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">45</span>,<span class="dv">97</span>,<span class="dv">32</span>,<span class="dv">22</span>,<span class="dv">10</span>,<span class="dv">19</span>,<span class="dv">39</span>,<span class="dv">43</span>]</span>
<span id="cb633-3"><a href="#cb633-3" aria-hidden="true" tabindex="-1"></a>resultado <span class="op">=</span> []</span>
<span id="cb633-4"><a href="#cb633-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb633-5"><a href="#cb633-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n <span class="kw">in</span> numeros:</span>
<span id="cb633-6"><a href="#cb633-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> n <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb633-7"><a href="#cb633-7" aria-hidden="true" tabindex="-1"></a>    resultado.append(n)</span>
<span id="cb633-8"><a href="#cb633-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(resultado)</span>
<span id="cb633-9"><a href="#cb633-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb633-10"><a href="#cb633-10" aria-hidden="true" tabindex="-1"></a>[n <span class="cf">for</span> n <span class="kw">in</span> numeros <span class="cf">if</span> n <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span>]</span>
<span id="cb633-11"><a href="#cb633-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb633-12"><a href="#cb633-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Parte b: Cuente el número de espacios en un string cualquiera</span></span>
<span id="cb633-13"><a href="#cb633-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb633-14"><a href="#cb633-14" aria-hidden="true" tabindex="-1"></a>string <span class="op">=</span> <span class="st">&quot;Mi nombre es Nicolás Campos &quot;</span></span>
<span id="cb633-15"><a href="#cb633-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb633-16"><a href="#cb633-16" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>([x <span class="cf">for</span> x <span class="kw">in</span> string <span class="cf">if</span> x <span class="op">==</span> <span class="st">&quot; &quot;</span>])</span></code></pre></div>
</div>
</div>
</div>
<div id="generadores" class="section level3 hasAnchor" number="4.3.6">
<h3 class="hasAnchor"><span class="header-section-number">4.3.6</span> Generadores<a href="#generadores" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Similar a los iteradores de listas, pero ahorra bastate memoria, es eficiente.</li>
</ul>
<div class="sourceCode" id="cb634"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb634-1"><a href="#cb634-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Hasta el momento</span></span>
<span id="cb634-2"><a href="#cb634-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-3"><a href="#cb634-3" aria-hidden="true" tabindex="-1"></a>[n <span class="op">**</span> <span class="dv">3</span> <span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">12</span>)]</span>
<span id="cb634-4"><a href="#cb634-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-5"><a href="#cb634-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Un generador</span></span>
<span id="cb634-6"><a href="#cb634-6" aria-hidden="true" tabindex="-1"></a>(n <span class="op">**</span> <span class="dv">2</span> <span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">12</span>))</span>
<span id="cb634-7"><a href="#cb634-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-8"><a href="#cb634-8" aria-hidden="true" tabindex="-1"></a><span class="co"># No genera el contenido.</span></span>
<span id="cb634-9"><a href="#cb634-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-10"><a href="#cb634-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Si lo quiero expresar</span></span>
<span id="cb634-11"><a href="#cb634-11" aria-hidden="true" tabindex="-1"></a>G <span class="op">=</span> (n <span class="op">**</span> <span class="dv">2</span> <span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">12</span>))</span>
<span id="cb634-12"><a href="#cb634-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-13"><a href="#cb634-13" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(G)</span></code></pre></div>
<ul>
<li>Un generador es básicamente un <em>recipiente</em> en donde se van a colocar valores.</li>
<li>Un generador no calcula los valores a menos que sea necesario, lo cual aumenta su eficiencia.</li>
</ul>
<div class="sourceCode" id="cb635"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb635-1"><a href="#cb635-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generadores utilizan parentesis</span></span>
<span id="cb635-2"><a href="#cb635-2" aria-hidden="true" tabindex="-1"></a>G <span class="op">=</span> (n <span class="op">**</span> <span class="dv">2</span> <span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">12</span>))</span>
<span id="cb635-3"><a href="#cb635-3" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(G)</span>
<span id="cb635-4"><a href="#cb635-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb635-5"><a href="#cb635-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Una lista es una colección de valores</span></span>
<span id="cb635-6"><a href="#cb635-6" aria-hidden="true" tabindex="-1"></a>L <span class="op">=</span> [n <span class="op">**</span> <span class="dv">2</span> <span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">12</span>)]</span>
<span id="cb635-7"><a href="#cb635-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb635-8"><a href="#cb635-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> val <span class="kw">in</span> L:</span>
<span id="cb635-9"><a href="#cb635-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(val, end<span class="op">=</span><span class="st">&#39; &#39;</span>)</span>
<span id="cb635-10"><a href="#cb635-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb635-11"><a href="#cb635-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Un generador es un recipiente para guardar valores</span></span>
<span id="cb635-12"><a href="#cb635-12" aria-hidden="true" tabindex="-1"></a>G <span class="op">=</span> (n <span class="op">**</span> <span class="dv">2</span> <span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">12</span>))</span>
<span id="cb635-13"><a href="#cb635-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb635-14"><a href="#cb635-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> val <span class="kw">in</span> G:</span>
<span id="cb635-15"><a href="#cb635-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(val, end<span class="op">=</span><span class="st">&#39; &#39;</span>)</span>
<span id="cb635-16"><a href="#cb635-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb635-17"><a href="#cb635-17" aria-hidden="true" tabindex="-1"></a><span class="co"># El potencial del generador es mayor</span></span>
<span id="cb635-18"><a href="#cb635-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb635-19"><a href="#cb635-19" aria-hidden="true" tabindex="-1"></a>L1 <span class="op">=</span> [n <span class="op">**</span> <span class="dv">2</span> <span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>)]</span>
<span id="cb635-20"><a href="#cb635-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb635-21"><a href="#cb635-21" aria-hidden="true" tabindex="-1"></a>L2 <span class="op">=</span> []</span>
<span id="cb635-22"><a href="#cb635-22" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>):</span>
<span id="cb635-23"><a href="#cb635-23" aria-hidden="true" tabindex="-1"></a>    L2.append(n <span class="op">**</span> <span class="dv">2</span>)</span>
<span id="cb635-24"><a href="#cb635-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb635-25"><a href="#cb635-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(L1)</span>
<span id="cb635-26"><a href="#cb635-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(L2)</span>
<span id="cb635-27"><a href="#cb635-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb635-28"><a href="#cb635-28" aria-hidden="true" tabindex="-1"></a>G1 <span class="op">=</span> (n <span class="op">**</span> <span class="dv">2</span> <span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>))</span>
<span id="cb635-29"><a href="#cb635-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb635-30"><a href="#cb635-30" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> gen():</span>
<span id="cb635-31"><a href="#cb635-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>):</span>
<span id="cb635-32"><a href="#cb635-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">yield</span> n <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb635-33"><a href="#cb635-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb635-34"><a href="#cb635-34" aria-hidden="true" tabindex="-1"></a>G2 <span class="op">=</span> gen()</span>
<span id="cb635-35"><a href="#cb635-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="op">*</span>G1)</span>
<span id="cb635-36"><a href="#cb635-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="op">*</span>G2)</span>
<span id="cb635-37"><a href="#cb635-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb635-38"><a href="#cb635-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Utiliza yield para representar una secuencia potencialmente infinita de valores</span></span>
<span id="cb635-39"><a href="#cb635-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb635-40"><a href="#cb635-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Recordemos que estos dos aspectos son iguales</span></span>
<span id="cb635-41"><a href="#cb635-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb635-42"><a href="#cb635-42" aria-hidden="true" tabindex="-1"></a>L1 <span class="op">=</span> [n <span class="op">**</span> <span class="dv">2</span> <span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">12</span>)]</span>
<span id="cb635-43"><a href="#cb635-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb635-44"><a href="#cb635-44" aria-hidden="true" tabindex="-1"></a>L2 <span class="op">=</span> []</span>
<span id="cb635-45"><a href="#cb635-45" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">12</span>):</span>
<span id="cb635-46"><a href="#cb635-46" aria-hidden="true" tabindex="-1"></a>    L2.append(n <span class="op">**</span> <span class="dv">2</span>)</span>
<span id="cb635-47"><a href="#cb635-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb635-48"><a href="#cb635-48" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(L1)</span>
<span id="cb635-49"><a href="#cb635-49" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(L2)</span>
<span id="cb635-50"><a href="#cb635-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb635-51"><a href="#cb635-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Si queremos hacer la equivalencia, pero con generadores tenemos</span></span>
<span id="cb635-52"><a href="#cb635-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb635-53"><a href="#cb635-53" aria-hidden="true" tabindex="-1"></a>G1 <span class="op">=</span> (n <span class="op">**</span> <span class="dv">2</span> <span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">12</span>))</span>
<span id="cb635-54"><a href="#cb635-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb635-55"><a href="#cb635-55" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> gen():</span>
<span id="cb635-56"><a href="#cb635-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">12</span>):</span>
<span id="cb635-57"><a href="#cb635-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">yield</span> n <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb635-58"><a href="#cb635-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb635-59"><a href="#cb635-59" aria-hidden="true" tabindex="-1"></a>G2 <span class="op">=</span> gen()</span>
<span id="cb635-60"><a href="#cb635-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb635-61"><a href="#cb635-61" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="op">*</span>G1)</span>
<span id="cb635-62"><a href="#cb635-62" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="op">*</span>G2)</span>
<span id="cb635-63"><a href="#cb635-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb635-64"><a href="#cb635-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Noten que tuve que ingresar la función yield en vez de return. </span></span>
<span id="cb635-65"><a href="#cb635-65" aria-hidden="true" tabindex="-1"></a><span class="co"># La idea es que pueda incluir potencialmente una lista infinita de valores.</span></span></code></pre></div>
<ul>
<li>Un generador se puede utilizar una vez, un iteador normal muchas veces</li>
</ul>
<div class="sourceCode" id="cb636"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb636-1"><a href="#cb636-1" aria-hidden="true" tabindex="-1"></a>L <span class="op">=</span> [n <span class="op">**</span> <span class="dv">2</span> <span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">12</span>)]</span>
<span id="cb636-2"><a href="#cb636-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb636-3"><a href="#cb636-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Normal </span></span>
<span id="cb636-4"><a href="#cb636-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> val <span class="kw">in</span> L:</span>
<span id="cb636-5"><a href="#cb636-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(val, end<span class="op">=</span><span class="st">&#39; &#39;</span>)</span>
<span id="cb636-6"><a href="#cb636-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb636-7"><a href="#cb636-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb636-8"><a href="#cb636-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Generador</span></span>
<span id="cb636-9"><a href="#cb636-9" aria-hidden="true" tabindex="-1"></a>G <span class="op">=</span> (n <span class="op">**</span> <span class="dv">2</span> <span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">12</span>))</span>
<span id="cb636-10"><a href="#cb636-10" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(G)</span>
<span id="cb636-11"><a href="#cb636-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb636-12"><a href="#cb636-12" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(G)</span></code></pre></div>
<div id="algoritmo-de-erastotenes" class="section level4 hasAnchor" number="4.3.6.1">
<h4 class="hasAnchor"><span class="header-section-number">4.3.6.1</span> Algoritmo de erastotenes<a href="#algoritmo-de-erastotenes" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>Vamos a generar un algoritmo que nos permita obtener todos los numeros primos bajo un cierto número natural dado.</li>
</ul>
<div class="sourceCode" id="cb637"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb637-1"><a href="#cb637-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generamos una lista de candidatos </span></span>
<span id="cb637-2"><a href="#cb637-2" aria-hidden="true" tabindex="-1"></a>L <span class="op">=</span> [n <span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>, <span class="dv">10</span>)]</span>
<span id="cb637-3"><a href="#cb637-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(L)</span>
<span id="cb637-4"><a href="#cb637-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb637-5"><a href="#cb637-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Removemos todos los múltiplos de dos salvo si mismo</span></span>
<span id="cb637-6"><a href="#cb637-6" aria-hidden="true" tabindex="-1"></a>L <span class="op">=</span> [n <span class="cf">for</span> n <span class="kw">in</span> L <span class="cf">if</span> n <span class="op">==</span> L[<span class="dv">0</span>] <span class="kw">or</span> n <span class="op">%</span> L[<span class="dv">0</span>] <span class="op">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb637-7"><a href="#cb637-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(L)</span>
<span id="cb637-8"><a href="#cb637-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb637-9"><a href="#cb637-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Removemos todos los múltiplos de tres salvo si mismo</span></span>
<span id="cb637-10"><a href="#cb637-10" aria-hidden="true" tabindex="-1"></a>L <span class="op">=</span> [n <span class="cf">for</span> n <span class="kw">in</span> L <span class="cf">if</span> n <span class="op">==</span> L[<span class="dv">1</span>] <span class="kw">or</span> n <span class="op">%</span> L[<span class="dv">1</span>] <span class="op">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb637-11"><a href="#cb637-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(L)</span>
<span id="cb637-12"><a href="#cb637-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb637-13"><a href="#cb637-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Asi sucesivamente hasta converger</span></span>
<span id="cb637-14"><a href="#cb637-14" aria-hidden="true" tabindex="-1"></a>L <span class="op">=</span> [n <span class="cf">for</span> n <span class="kw">in</span> L <span class="cf">if</span> n <span class="op">==</span> L[<span class="dv">2</span>] <span class="kw">or</span> n <span class="op">%</span> L[<span class="dv">2</span>] <span class="op">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb637-15"><a href="#cb637-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(L)</span>
<span id="cb637-16"><a href="#cb637-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb637-17"><a href="#cb637-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Asi sucesivamente hasta converger</span></span>
<span id="cb637-18"><a href="#cb637-18" aria-hidden="true" tabindex="-1"></a>L <span class="op">=</span> [n <span class="cf">for</span> n <span class="kw">in</span> L <span class="cf">if</span> n <span class="op">==</span> L[<span class="dv">3</span>] <span class="kw">or</span> n <span class="op">%</span> L[<span class="dv">3</span>] <span class="op">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb637-19"><a href="#cb637-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(L)</span>
<span id="cb637-20"><a href="#cb637-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb637-21"><a href="#cb637-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Generamos esto como un generador </span></span>
<span id="cb637-22"><a href="#cb637-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb637-23"><a href="#cb637-23" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> gen_primos(N):</span>
<span id="cb637-24"><a href="#cb637-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Generar primos hasta N&quot;&quot;&quot;</span></span>
<span id="cb637-25"><a href="#cb637-25" aria-hidden="true" tabindex="-1"></a>    primos <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb637-26"><a href="#cb637-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>, N):</span>
<span id="cb637-27"><a href="#cb637-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">all</span>(n <span class="op">%</span> p <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">for</span> p <span class="kw">in</span> primos):</span>
<span id="cb637-28"><a href="#cb637-28" aria-hidden="true" tabindex="-1"></a>            primos.add(n)</span>
<span id="cb637-29"><a href="#cb637-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">yield</span> n</span>
<span id="cb637-30"><a href="#cb637-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb637-31"><a href="#cb637-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="op">*</span>gen_primos(<span class="dv">1000</span>))</span></code></pre></div>
<ul>
<li>Es conveniente utilizar generadores cuando se trabajan con grandes bases de datos.</li>
<li>Es importante recordar que el generador solo puede ser iterado una vez.</li>
<li>No es conveniente utilizar generadores cuando necesitamos los valores previos.
Recuerden que solo itera una vez.</li>
<li>Cuando tengo bases de datos pequeñas no es necesario.</li>
<li>¿Puedo escribir lo anterior con un for? : Si, el generador es por la actualización y el espacio.</li>
</ul>
</div>
</div>
<div id="funciones-3" class="section level3 hasAnchor" number="4.3.7">
<h3 class="hasAnchor"><span class="header-section-number">4.3.7</span> Funciones<a href="#funciones-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><p>Parte importante de cualquier proceso sofisticado de análisis de datos</p></li>
<li><p>Son lo que conocemos como <em>programas</em> en Stata.</p></li>
<li><p>Tres grupos principales:</p>
<ul>
<li><p>Funciones incorporadas, como help() para pedir ayuda, min() para obtener el valor mínimo, print() para imprimir un objeto en la terminal. Listado: <a href="https://docs.python.org/3/library/functions.html" class="uri">https://docs.python.org/3/library/functions.html</a></p></li>
<li><p>Funciones definidas por el usuario (UDFs), que son funciones que los usuarios crean para mejorar sus procesos.</p></li>
<li><p>Funciones anónimas, que también se llaman funciones lambda porque no se declaran con la palabra clave def estándar.</p></li>
</ul></li>
<li><p>Diferencia entre metodos y funciones?</p>
<ul>
<li>Metodo es especifico a una clase de objeto</li>
<li>Todos los metodos son funciones, pero no todas las funciones son metodos.</li>
</ul></li>
</ul>
<div id="sintaxis-básica-y-algunos-ejemplos" class="section level4 hasAnchor" number="4.3.7.1">
<h4 class="hasAnchor"><span class="header-section-number">4.3.7.1</span> Sintaxis básica y algunos ejemplos<a href="#sintaxis-básica-y-algunos-ejemplos" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb638"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb638-1"><a href="#cb638-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> miprimerafuncion(a): <span class="co">#declaramos la función y establecemos el input</span></span>
<span id="cb638-2"><a href="#cb638-2" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> a <span class="op">*</span> <span class="dv">2</span>  <span class="co">#definimos qué hace la función</span></span>
<span id="cb638-3"><a href="#cb638-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> b <span class="co">#Establecemos un output</span></span>
<span id="cb638-4"><a href="#cb638-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb638-5"><a href="#cb638-5" aria-hidden="true" tabindex="-1"></a><span class="co"># llamamos la función</span></span>
<span id="cb638-6"><a href="#cb638-6" aria-hidden="true" tabindex="-1"></a>miprimerafuncion(<span class="st">&quot;nico&quot;</span>)</span>
<span id="cb638-7"><a href="#cb638-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb638-8"><a href="#cb638-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> miprimerafuncion_sr(a):</span>
<span id="cb638-9"><a href="#cb638-9" aria-hidden="true" tabindex="-1"></a>     a <span class="op">*</span> <span class="dv">2</span></span>
<span id="cb638-10"><a href="#cb638-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb638-11"><a href="#cb638-11" aria-hidden="true" tabindex="-1"></a>miprimerafuncion_sr(<span class="dv">15</span>)</span>
<span id="cb638-12"><a href="#cb638-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb638-13"><a href="#cb638-13" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb638-14"><a href="#cb638-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(miprimerafuncion(b))</span>
<span id="cb638-15"><a href="#cb638-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(miprimerafuncion(<span class="dv">1000</span>))</span>
<span id="cb638-16"><a href="#cb638-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb638-17"><a href="#cb638-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Funciones con más de un argumento</span></span>
<span id="cb638-18"><a href="#cb638-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb638-19"><a href="#cb638-19" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ejemplo2(a, b): </span>
<span id="cb638-20"><a href="#cb638-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">*</span> b, a <span class="op">**</span> b</span>
<span id="cb638-21"><a href="#cb638-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb638-22"><a href="#cb638-22" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(ejemplo2(<span class="dv">10</span>,<span class="dv">2</span>))</span>
<span id="cb638-23"><a href="#cb638-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb638-24"><a href="#cb638-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Funciones que puedo asignar como tuplas</span></span>
<span id="cb638-25"><a href="#cb638-25" aria-hidden="true" tabindex="-1"></a>X, Y <span class="op">=</span> ejemplo2(<span class="dv">10</span>,<span class="dv">2</span>)</span>
<span id="cb638-26"><a href="#cb638-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;X =&quot;</span>, X, <span class="st">&quot;Y =&quot;</span>, Y)</span>
<span id="cb638-27"><a href="#cb638-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb638-28"><a href="#cb638-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Funciones sin argumentos </span></span>
<span id="cb638-29"><a href="#cb638-29" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> hello():</span>
<span id="cb638-30"><a href="#cb638-30" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">&quot;Hola mundo&quot;</span>) </span>
<span id="cb638-31"><a href="#cb638-31" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span></span>
<span id="cb638-32"><a href="#cb638-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb638-33"><a href="#cb638-33" aria-hidden="true" tabindex="-1"></a>hello()</span>
<span id="cb638-34"><a href="#cb638-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb638-35"><a href="#cb638-35" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fibonacci(N):</span>
<span id="cb638-36"><a href="#cb638-36" aria-hidden="true" tabindex="-1"></a>    L <span class="op">=</span> []</span>
<span id="cb638-37"><a href="#cb638-37" aria-hidden="true" tabindex="-1"></a>    a, b <span class="op">=</span> <span class="dv">0</span>, <span class="dv">1</span></span>
<span id="cb638-38"><a href="#cb638-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="bu">len</span>(L) <span class="op">&lt;</span> N:</span>
<span id="cb638-39"><a href="#cb638-39" aria-hidden="true" tabindex="-1"></a>        a, b <span class="op">=</span> b, a <span class="op">+</span> b</span>
<span id="cb638-40"><a href="#cb638-40" aria-hidden="true" tabindex="-1"></a>        L.append(a)</span>
<span id="cb638-41"><a href="#cb638-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> L</span>
<span id="cb638-42"><a href="#cb638-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb638-43"><a href="#cb638-43" aria-hidden="true" tabindex="-1"></a>fibonacci()</span>
<span id="cb638-44"><a href="#cb638-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb638-45"><a href="#cb638-45" aria-hidden="true" tabindex="-1"></a><span class="co">## Valores por parametros y opciones por defecto</span></span>
<span id="cb638-46"><a href="#cb638-46" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fibonacci_cd(N, a <span class="op">=</span> <span class="dv">0</span>, b <span class="op">=</span> <span class="dv">1</span>):</span>
<span id="cb638-47"><a href="#cb638-47" aria-hidden="true" tabindex="-1"></a>    L <span class="op">=</span> []</span>
<span id="cb638-48"><a href="#cb638-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="bu">len</span>(L) <span class="op">&lt;</span> N:</span>
<span id="cb638-49"><a href="#cb638-49" aria-hidden="true" tabindex="-1"></a>        a, b <span class="op">=</span> b, a <span class="op">+</span> b</span>
<span id="cb638-50"><a href="#cb638-50" aria-hidden="true" tabindex="-1"></a>        L.append(a)</span>
<span id="cb638-51"><a href="#cb638-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> L</span>
<span id="cb638-52"><a href="#cb638-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb638-53"><a href="#cb638-53" aria-hidden="true" tabindex="-1"></a>fibonacci(<span class="dv">10</span>)</span>
<span id="cb638-54"><a href="#cb638-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb638-55"><a href="#cb638-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Por defecto</span></span>
<span id="cb638-56"><a href="#cb638-56" aria-hidden="true" tabindex="-1"></a>fibonacci_cd(<span class="dv">10</span>)</span>
<span id="cb638-57"><a href="#cb638-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb638-58"><a href="#cb638-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Variables locales y variables globales </span></span>
<span id="cb638-59"><a href="#cb638-59" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ejemplo3(a):</span>
<span id="cb638-60"><a href="#cb638-60" aria-hidden="true" tabindex="-1"></a>    AA <span class="op">=</span> []</span>
<span id="cb638-61"><a href="#cb638-61" aria-hidden="true" tabindex="-1"></a>    AA.append(a)</span>
<span id="cb638-62"><a href="#cb638-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> AA</span>
<span id="cb638-63"><a href="#cb638-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb638-64"><a href="#cb638-64" aria-hidden="true" tabindex="-1"></a>C <span class="op">=</span> ejemplo3(<span class="st">&quot;hola&quot;</span>)</span>
<span id="cb638-65"><a href="#cb638-65" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(C)</span>
<span id="cb638-66"><a href="#cb638-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb638-67"><a href="#cb638-67" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(C)</span></code></pre></div>
<ul>
<li><p>Una variable local va a existir en un lugar específico.</p></li>
<li><p>Dentro de la función ejemplo3(a) definimos A=<a href="indica%20que%20buscar%20exactamente%20dentro%20de%20un%20lugar."></a>, esta variable A existe sólo dentro de la función ejemplo3(), es decir es una <strong>variable local</strong>.</p></li>
<li><p>Cuando decimos que A = ejemplo3(“hola”) estamos definiendo una variable global, que existe en todo el espacio del Jupyter, una vez definida puede ser llamada en en cualquier parte.</p></li>
</ul>
<div class="sourceCode" id="cb639"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb639-1"><a href="#cb639-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ahora vamos a crear una función que nos permita interactuar con los/las usuarias</span></span>
<span id="cb639-2"><a href="#cb639-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb639-3"><a href="#cb639-3" aria-hidden="true" tabindex="-1"></a><span class="co">#1. Creamos la función con un input A</span></span>
<span id="cb639-4"><a href="#cb639-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ejemplo4(A):</span>
<span id="cb639-5"><a href="#cb639-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb639-6"><a href="#cb639-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">#2. Creamos una lista  vacía</span></span>
<span id="cb639-7"><a href="#cb639-7" aria-hidden="true" tabindex="-1"></a>    B <span class="op">=</span> []</span>
<span id="cb639-8"><a href="#cb639-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb639-9"><a href="#cb639-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">#3. Iteramos sobre A</span></span>
<span id="cb639-10"><a href="#cb639-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> A: </span>
<span id="cb639-11"><a href="#cb639-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb639-12"><a href="#cb639-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">#Creamos la primera condición</span></span>
<span id="cb639-13"><a href="#cb639-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">&gt;=</span> <span class="dv">0</span> <span class="kw">and</span> i<span class="op">&lt;=</span> <span class="dv">3</span>: </span>
<span id="cb639-14"><a href="#cb639-14" aria-hidden="true" tabindex="-1"></a>            B.append(i)</span>
<span id="cb639-15"><a href="#cb639-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">#Segunda condición</span></span>
<span id="cb639-16"><a href="#cb639-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> i <span class="op">&gt;</span> <span class="dv">3</span> <span class="kw">and</span> i<span class="op">&lt;</span><span class="dv">5</span>: </span>
<span id="cb639-17"><a href="#cb639-17" aria-hidden="true" tabindex="-1"></a>            B.append(i<span class="op">*</span><span class="dv">2</span>)</span>
<span id="cb639-18"><a href="#cb639-18" aria-hidden="true" tabindex="-1"></a>        <span class="co">#Tercera condición</span></span>
<span id="cb639-19"><a href="#cb639-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> i<span class="op">==</span><span class="dv">5</span>:</span>
<span id="cb639-20"><a href="#cb639-20" aria-hidden="true" tabindex="-1"></a>            B.append(<span class="bu">input</span>(<span class="st">&quot;Agregar un valor&quot;</span>))</span>
<span id="cb639-21"><a href="#cb639-21" aria-hidden="true" tabindex="-1"></a>        <span class="co">#Todo el resto</span></span>
<span id="cb639-22"><a href="#cb639-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>: </span>
<span id="cb639-23"><a href="#cb639-23" aria-hidden="true" tabindex="-1"></a>            B.append(i<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb639-24"><a href="#cb639-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb639-25"><a href="#cb639-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">#4. Output</span></span>
<span id="cb639-26"><a href="#cb639-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> B</span>
<span id="cb639-27"><a href="#cb639-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb639-28"><a href="#cb639-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Creamos una lista entre 0-10</span></span>
<span id="cb639-29"><a href="#cb639-29" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> np.arange(<span class="dv">0</span>, <span class="dv">11</span>, <span class="dv">1</span>)</span>
<span id="cb639-30"><a href="#cb639-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb639-31"><a href="#cb639-31" aria-hidden="true" tabindex="-1"></a><span class="co">#Llamamos la función y guardamos el resultado en una variable global</span></span>
<span id="cb639-32"><a href="#cb639-32" aria-hidden="true" tabindex="-1"></a>B <span class="op">=</span> ejemplo4(A)</span>
<span id="cb639-33"><a href="#cb639-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb639-34"><a href="#cb639-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;A:&quot;</span>, A)</span>
<span id="cb639-35"><a href="#cb639-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;B:&quot;</span>, B)</span>
<span id="cb639-36"><a href="#cb639-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb639-37"><a href="#cb639-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Otro ejemplo</span></span>
<span id="cb639-38"><a href="#cb639-38" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> hello():</span>
<span id="cb639-39"><a href="#cb639-39" aria-hidden="true" tabindex="-1"></a>  name <span class="op">=</span> <span class="bu">str</span>(<span class="bu">input</span>(<span class="st">&quot;Tu nombre aquí: &quot;</span>))</span>
<span id="cb639-40"><a href="#cb639-40" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> name:</span>
<span id="cb639-41"><a href="#cb639-41" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span> (<span class="st">&quot;Hola &quot;</span> <span class="op">+</span> <span class="bu">str</span>(name))</span>
<span id="cb639-42"><a href="#cb639-42" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>:</span>
<span id="cb639-43"><a href="#cb639-43" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Hola no más&quot;</span>) </span>
<span id="cb639-44"><a href="#cb639-44" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> </span>
<span id="cb639-45"><a href="#cb639-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb639-46"><a href="#cb639-46" aria-hidden="true" tabindex="-1"></a>hello()</span>
<span id="cb639-47"><a href="#cb639-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb639-48"><a href="#cb639-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Notemos el uso de return </span></span>
<span id="cb639-49"><a href="#cb639-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb639-50"><a href="#cb639-50" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> hola():</span>
<span id="cb639-51"><a href="#cb639-51" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">&quot;Hola mundo&quot;</span>) </span>
<span id="cb639-52"><a href="#cb639-52" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span>(<span class="st">&quot;hola&quot;</span>)</span>
<span id="cb639-53"><a href="#cb639-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb639-54"><a href="#cb639-54" aria-hidden="true" tabindex="-1"></a>hola() <span class="op">*</span> <span class="dv">2</span></span>
<span id="cb639-55"><a href="#cb639-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb639-56"><a href="#cb639-56" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> hola_sinreturn():</span>
<span id="cb639-57"><a href="#cb639-57" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">&quot;Hola mundo&quot;</span>)</span>
<span id="cb639-58"><a href="#cb639-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb639-59"><a href="#cb639-59" aria-hidden="true" tabindex="-1"></a>hola_sinreturn() <span class="op">*</span> <span class="dv">2</span></span>
<span id="cb639-60"><a href="#cb639-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Arroja un error</span></span>
<span id="cb639-61"><a href="#cb639-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb639-62"><a href="#cb639-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Funciones anidadas (revisar prox clase)</span></span>
<span id="cb639-63"><a href="#cb639-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb639-64"><a href="#cb639-64" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> display(name):</span>
<span id="cb639-65"><a href="#cb639-65" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> message():</span>
<span id="cb639-66"><a href="#cb639-66" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&quot;Hello &quot;</span></span>
<span id="cb639-67"><a href="#cb639-67" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> name</span>
<span id="cb639-68"><a href="#cb639-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb639-69"><a href="#cb639-69" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(message(), display(<span class="st">&quot; Siva&quot;</span>))</span></code></pre></div>
</div>
<div id="argumentos-de-las-funciones-en-python" class="section level4 hasAnchor" number="4.3.7.2">
<h4 class="hasAnchor"><span class="header-section-number">4.3.7.2</span> Argumentos de las funciones en Python<a href="#argumentos-de-las-funciones-en-python" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb640"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb640-1"><a href="#cb640-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Defecto </span></span>
<span id="cb640-2"><a href="#cb640-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plus(a,b <span class="op">=</span> <span class="dv">2</span>):</span>
<span id="cb640-3"><a href="#cb640-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> a <span class="op">+</span> b</span>
<span id="cb640-4"><a href="#cb640-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb640-5"><a href="#cb640-5" aria-hidden="true" tabindex="-1"></a>plus(<span class="dv">1</span>)</span>
<span id="cb640-6"><a href="#cb640-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb640-7"><a href="#cb640-7" aria-hidden="true" tabindex="-1"></a>plus(<span class="dv">1</span>, <span class="dv">3</span>)</span>
<span id="cb640-8"><a href="#cb640-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb640-9"><a href="#cb640-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Requeridos: son los que necesita la funcion</span></span>
<span id="cb640-10"><a href="#cb640-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plus(a,b):</span>
<span id="cb640-11"><a href="#cb640-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> a <span class="op">+</span> b</span>
<span id="cb640-12"><a href="#cb640-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb640-13"><a href="#cb640-13" aria-hidden="true" tabindex="-1"></a>plus()</span>
<span id="cb640-14"><a href="#cb640-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb640-15"><a href="#cb640-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Argumentos clave</span></span>
<span id="cb640-16"><a href="#cb640-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb640-17"><a href="#cb640-17" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plus(a,b):</span>
<span id="cb640-18"><a href="#cb640-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> a <span class="op">-</span> b</span>
<span id="cb640-19"><a href="#cb640-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb640-20"><a href="#cb640-20" aria-hidden="true" tabindex="-1"></a>plus(<span class="dv">2</span>,<span class="dv">3</span>)</span>
<span id="cb640-21"><a href="#cb640-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb640-22"><a href="#cb640-22" aria-hidden="true" tabindex="-1"></a>plus(b <span class="op">=</span> <span class="dv">2</span>, a <span class="op">=</span> <span class="dv">4</span>)</span>
<span id="cb640-23"><a href="#cb640-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb640-24"><a href="#cb640-24" aria-hidden="true" tabindex="-1"></a>plus(<span class="dv">2</span>,<span class="dv">4</span>)</span></code></pre></div>
</div>
<div id="args-and-kwargs-argumentos-flexibles" class="section level4 hasAnchor" number="4.3.7.3">
<h4 class="hasAnchor"><span class="header-section-number">4.3.7.3</span> args and kwargs: argumentos flexibles<a href="#args-and-kwargs-argumentos-flexibles" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><strong>idea:</strong> Querer escribir una función en la que no sepas inicialmente cuántos argumentos va a tener.</li>
<li><code>*args</code> y <code>**kwargs</code> permiten trabajar con este tipo de problemas</li>
</ul>
<div class="sourceCode" id="cb641"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb641-1"><a href="#cb641-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> catch_all(<span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<span id="cb641-2"><a href="#cb641-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;args =&quot;</span>, args)</span>
<span id="cb641-3"><a href="#cb641-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;kwargs = &quot;</span>, kwargs)</span>
<span id="cb641-4"><a href="#cb641-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb641-5"><a href="#cb641-5" aria-hidden="true" tabindex="-1"></a>catch_all(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">65</span>, a <span class="op">=</span> <span class="dv">4</span>, b <span class="op">=</span> <span class="dv">5</span>)</span>
<span id="cb641-6"><a href="#cb641-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb641-7"><a href="#cb641-7" aria-hidden="true" tabindex="-1"></a>catch_all(<span class="st">&#39;a&#39;</span>, keyword<span class="op">=</span><span class="dv">2</span>)</span></code></pre></div>
<ul>
<li><p>Aquí lo importante <strong>no</strong> son los nombres args y kwargs, sino los caracteres * que los preceden.</p></li>
<li><p><code>args</code> y <code>kwargs</code> son sólo los nombres de las variables que se utilizan a menudo por convención, abreviatura de “argumentos” y “argumentos de palabras clave”.</p></li>
<li><p>La diferencia operativa son los caracteres de asterisco: un solo * antes de una variable significa “expandir esto como una secuencia”, mientras que un doble ** antes de una variable significa “expandir esto como un diccionario”.</p></li>
</ul>
<div class="sourceCode" id="cb642"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb642-1"><a href="#cb642-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tambien puedo ocupar esta sintaxis (* y **) al llamar variables dentro de una función</span></span>
<span id="cb642-2"><a href="#cb642-2" aria-hidden="true" tabindex="-1"></a>inputs <span class="op">=</span> (<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb642-3"><a href="#cb642-3" aria-hidden="true" tabindex="-1"></a>keywords <span class="op">=</span> {<span class="st">&#39;pi&#39;</span>: <span class="fl">3.14</span>}</span>
<span id="cb642-4"><a href="#cb642-4" aria-hidden="true" tabindex="-1"></a>catch_all(<span class="op">*</span>inputs, <span class="op">**</span>keywords)</span></code></pre></div>
</div>
<div id="anonymous-lambda-functions" class="section level4 hasAnchor" number="4.3.7.4">
<h4 class="hasAnchor"><span class="header-section-number">4.3.7.4</span> Anonymous (lambda) Functions<a href="#anonymous-lambda-functions" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>Idea: quiero hacer funciones que sean anonimas</li>
</ul>
<div class="sourceCode" id="cb643"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb643-1"><a href="#cb643-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Caso 1</span></span>
<span id="cb643-2"><a href="#cb643-2" aria-hidden="true" tabindex="-1"></a>add <span class="op">=</span> <span class="kw">lambda</span> x, y: x <span class="op">+</span> y</span>
<span id="cb643-3"><a href="#cb643-3" aria-hidden="true" tabindex="-1"></a>add(<span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb643-4"><a href="#cb643-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb643-5"><a href="#cb643-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Caso 2 </span></span>
<span id="cb643-6"><a href="#cb643-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add(x, y):</span>
<span id="cb643-7"><a href="#cb643-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x <span class="op">+</span> y</span>
<span id="cb643-8"><a href="#cb643-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb643-9"><a href="#cb643-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Noten que esta función no tiene nombre</span></span>
<span id="cb643-10"><a href="#cb643-10" aria-hidden="true" tabindex="-1"></a>double <span class="op">=</span> <span class="kw">lambda</span> x: x<span class="op">*</span><span class="dv">2</span></span>
<span id="cb643-11"><a href="#cb643-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb643-12"><a href="#cb643-12" aria-hidden="true" tabindex="-1"></a>double(<span class="dv">5</span>)</span>
<span id="cb643-13"><a href="#cb643-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb643-14"><a href="#cb643-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Con dos argumentos </span></span>
<span id="cb643-15"><a href="#cb643-15" aria-hidden="true" tabindex="-1"></a><span class="bu">sum</span> <span class="op">=</span> <span class="kw">lambda</span> x, y: x <span class="op">+</span> y<span class="op">;</span></span>
<span id="cb643-16"><a href="#cb643-16" aria-hidden="true" tabindex="-1"></a><span class="bu">sum</span>(<span class="dv">4</span>,<span class="dv">5</span>)</span></code></pre></div>
<ul>
<li>Caso 1 y Caso 2 son equivalentes</li>
<li>¿Por qué quiero escribir entonces funciones lambda?:
<ul>
<li>Función por un periodo corto de tiempo.</li>
<li>O cuando tenemos una función que tiene como input otras funciones.</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb644"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb644-1"><a href="#cb644-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> functools <span class="im">import</span> <span class="bu">reduce</span></span>
<span id="cb644-2"><a href="#cb644-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb644-3"><a href="#cb644-3" aria-hidden="true" tabindex="-1"></a>lista <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>]</span>
<span id="cb644-4"><a href="#cb644-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb644-5"><a href="#cb644-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtro: filtra según un criterio. En este caso el criterio es una función creada por mi y anonima </span></span>
<span id="cb644-6"><a href="#cb644-6" aria-hidden="true" tabindex="-1"></a>filtrado_list <span class="op">=</span> <span class="bu">list</span>(<span class="bu">filter</span>(<span class="kw">lambda</span> x: (x<span class="op">*</span><span class="dv">2</span> <span class="op">&gt;</span> <span class="dv">10</span>), lista))</span>
<span id="cb644-7"><a href="#cb644-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb644-8"><a href="#cb644-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Mapeo: aplica una función a un objeto. En este caso una anonima</span></span>
<span id="cb644-9"><a href="#cb644-9" aria-hidden="true" tabindex="-1"></a>mapeo_list <span class="op">=</span> <span class="bu">list</span>(<span class="bu">map</span>(<span class="kw">lambda</span> x: x<span class="op">*</span><span class="dv">2</span>, lista))</span>
<span id="cb644-10"><a href="#cb644-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb644-11"><a href="#cb644-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Reducir: reduce la secuencia a un simple valor. Suma el acumulado finalmente.</span></span>
<span id="cb644-12"><a href="#cb644-12" aria-hidden="true" tabindex="-1"></a>reducedico_list <span class="op">=</span> <span class="bu">reduce</span>(<span class="kw">lambda</span> x, y: x<span class="op">+</span>y, lista)</span>
<span id="cb644-13"><a href="#cb644-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb644-14"><a href="#cb644-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(filtrado_list)</span>
<span id="cb644-15"><a href="#cb644-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(mapeo_list)</span>
<span id="cb644-16"><a href="#cb644-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(reducedico_list)</span>
<span id="cb644-17"><a href="#cb644-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb644-18"><a href="#cb644-18" aria-hidden="true" tabindex="-1"></a><span class="co">#reduce?</span></span></code></pre></div>
</div>
<div id="documentar-funciones" class="section level4 hasAnchor" number="4.3.7.5">
<h4 class="hasAnchor"><span class="header-section-number">4.3.7.5</span> Documentar funciones<a href="#documentar-funciones" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>Es útil documentar lo que hacen las funciones que hacemos</li>
</ul>
<div class="sourceCode" id="cb645"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb645-1"><a href="#cb645-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> count_letter(content, letter):</span>
<span id="cb645-2"><a href="#cb645-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb645-3"><a href="#cb645-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">&quot;&quot;&quot;Cuenta el número de veces que una `letra` aparece en `contenido`.</span></span>
<span id="cb645-4"><a href="#cb645-4" aria-hidden="true" tabindex="-1"></a><span class="co">  </span></span>
<span id="cb645-5"><a href="#cb645-5" aria-hidden="true" tabindex="-1"></a><span class="co">  Argumentos:</span></span>
<span id="cb645-6"><a href="#cb645-6" aria-hidden="true" tabindex="-1"></a><span class="co">    contenido (str): La palabra (string) donde vamos a ir a buscar.</span></span>
<span id="cb645-7"><a href="#cb645-7" aria-hidden="true" tabindex="-1"></a><span class="co">    letra (str): La letra que vamos a ir a buscar. </span></span>
<span id="cb645-8"><a href="#cb645-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb645-9"><a href="#cb645-9" aria-hidden="true" tabindex="-1"></a><span class="co">  Retorna:</span></span>
<span id="cb645-10"><a href="#cb645-10" aria-hidden="true" tabindex="-1"></a><span class="co">    int</span></span>
<span id="cb645-11"><a href="#cb645-11" aria-hidden="true" tabindex="-1"></a><span class="co">  &quot;&quot;&quot;</span></span>
<span id="cb645-12"><a href="#cb645-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">len</span>([char <span class="cf">for</span> char <span class="kw">in</span> content <span class="cf">if</span> char <span class="op">==</span> letter])</span>
<span id="cb645-13"><a href="#cb645-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb645-14"><a href="#cb645-14" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> count_letter(<span class="st">&quot;nicolascampos&quot;</span>, <span class="st">&quot;s&quot;</span>)</span>
<span id="cb645-15"><a href="#cb645-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb645-16"><a href="#cb645-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(result)</span>
<span id="cb645-17"><a href="#cb645-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb645-18"><a href="#cb645-18" aria-hidden="true" tabindex="-1"></a>count_letter?</span></code></pre></div>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 4.3.4:</b></p>
<p>Crear una función que calcule la estimación del ingreso según la ecuación de Mincer:</p>
<p><span class="math inline">\(Ln(Y)=\beta_0+\beta_1S+\beta_2^2 Exp+ Exp2\)</span></p>
<p>Donde:</p>
<p><span class="math inline">\(S\)</span>: años de educación</p>
<p><span class="math inline">\(Exp\)</span>: experiencia</p>
<p><span class="math inline">\(Exp2\)</span>: experiencia al cuadrado</p>
<p>Utilice: _0=9.7, _1=0.14, _2=0.07, _3=−0.001</p>
</div>
<div class="sourceCode" id="cb646"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb646-1"><a href="#cb646-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mincer(S , Exp):</span>
<span id="cb646-2"><a href="#cb646-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb646-3"><a href="#cb646-3" aria-hidden="true" tabindex="-1"></a>    ß<span class="dv">0</span> <span class="op">=</span> <span class="fl">9.7</span></span>
<span id="cb646-4"><a href="#cb646-4" aria-hidden="true" tabindex="-1"></a>    ß<span class="dv">1</span> <span class="op">=</span> <span class="fl">0.14</span></span>
<span id="cb646-5"><a href="#cb646-5" aria-hidden="true" tabindex="-1"></a>    ß<span class="dv">2</span> <span class="op">=</span> <span class="fl">0.07</span></span>
<span id="cb646-6"><a href="#cb646-6" aria-hidden="true" tabindex="-1"></a>    ß<span class="dv">3</span> <span class="op">=</span> <span class="op">-</span><span class="fl">0.001</span></span>
<span id="cb646-7"><a href="#cb646-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ß<span class="dv">0</span> <span class="op">+</span> ß<span class="dv">1</span><span class="op">*</span>S <span class="op">+</span> ß<span class="dv">2</span><span class="op">*</span>Exp <span class="op">+</span> ß<span class="dv">3</span><span class="op">*</span>Exp<span class="op">**</span><span class="dv">2</span></span>
<span id="cb646-8"><a href="#cb646-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb646-9"><a href="#cb646-9" aria-hidden="true" tabindex="-1"></a>educ_list <span class="op">=</span> np.array([<span class="dv">14</span>,<span class="dv">8</span>,<span class="dv">20</span>])</span>
<span id="cb646-10"><a href="#cb646-10" aria-hidden="true" tabindex="-1"></a>exp_list <span class="op">=</span>  np.array([<span class="dv">2</span>,<span class="dv">20</span>,<span class="dv">1</span>])</span>
<span id="cb646-11"><a href="#cb646-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb646-12"><a href="#cb646-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(mincer(educ_list, exp_list))</span></code></pre></div>
</div>
</div>
</div>
<div id="manipulación-de-bases-de-datos-parte-i-1" class="section level2 hasAnchor" number="4.4">
<h2 class="hasAnchor"><span class="header-section-number">4.4</span> Manipulación de bases de datos (Parte I)<a href="#manipulación-de-bases-de-datos-parte-i-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="importar-e-inspeccionar-datos-repaso" class="section level3 hasAnchor" number="4.4.1">
<h3 class="hasAnchor"><span class="header-section-number">4.4.1</span> Importar e inspeccionar datos (repaso)<a href="#importar-e-inspeccionar-datos-repaso" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>¿Cuál es mi directorio?</li>
</ul>
<div class="sourceCode" id="cb647"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb647-1"><a href="#cb647-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb647-2"><a href="#cb647-2" aria-hidden="true" tabindex="-1"></a>os.getcwd()</span>
<span id="cb647-3"><a href="#cb647-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb647-4"><a href="#cb647-4" aria-hidden="true" tabindex="-1"></a>os.listdir()</span>
<span id="cb647-5"><a href="#cb647-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb647-6"><a href="#cb647-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Carpetas </span></span>
<span id="cb647-7"><a href="#cb647-7" aria-hidden="true" tabindex="-1"></a>principal <span class="op">=</span> os.getcwd()</span>
<span id="cb647-8"><a href="#cb647-8" aria-hidden="true" tabindex="-1"></a>datos <span class="op">=</span> principal <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">datos&quot;</span></span>
<span id="cb647-9"><a href="#cb647-9" aria-hidden="true" tabindex="-1"></a>datos</span>
<span id="cb647-10"><a href="#cb647-10" aria-hidden="true" tabindex="-1"></a>resultados <span class="op">=</span> principal <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">resultados&quot;</span></span>
<span id="cb647-11"><a href="#cb647-11" aria-hidden="true" tabindex="-1"></a>resultados</span>
<span id="cb647-12"><a href="#cb647-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb647-13"><a href="#cb647-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Recordar como es un dataframe de pandas </span></span>
<span id="cb647-14"><a href="#cb647-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd </span>
<span id="cb647-15"><a href="#cb647-15" aria-hidden="true" tabindex="-1"></a>exam_data  <span class="op">=</span> {<span class="st">&#39;name&#39;</span>: [<span class="st">&#39;Anastasia&#39;</span>, <span class="st">&#39;Dima&#39;</span>, <span class="st">&#39;Katherine&#39;</span>, <span class="st">&#39;James&#39;</span>, <span class="st">&#39;Emily&#39;</span>, <span class="st">&#39;Michael&#39;</span>, <span class="st">&#39;Matthew&#39;</span>, <span class="st">&#39;Laura&#39;</span>, <span class="st">&#39;Kevin&#39;</span>, <span class="st">&#39;Jonas&#39;</span>],</span>
<span id="cb647-16"><a href="#cb647-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;score&#39;</span>: [<span class="fl">12.5</span>, <span class="dv">9</span>, <span class="fl">16.5</span>, np.nan, <span class="dv">9</span>, <span class="dv">20</span>, <span class="fl">14.5</span>, np.nan, <span class="dv">8</span>, <span class="dv">19</span>],</span>
<span id="cb647-17"><a href="#cb647-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;attempts&#39;</span>: [<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>],</span>
<span id="cb647-18"><a href="#cb647-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;qualify&#39;</span>: [<span class="st">&#39;yes&#39;</span>, <span class="st">&#39;no&#39;</span>, <span class="st">&#39;yes&#39;</span>, <span class="st">&#39;no&#39;</span>, <span class="st">&#39;no&#39;</span>, <span class="st">&#39;yes&#39;</span>, <span class="st">&#39;yes&#39;</span>, <span class="st">&#39;no&#39;</span>, <span class="st">&#39;no&#39;</span>, <span class="st">&#39;yes&#39;</span>]}</span>
<span id="cb647-19"><a href="#cb647-19" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> [<span class="st">&#39;a&#39;</span>, <span class="st">&#39;b&#39;</span>, <span class="st">&#39;c&#39;</span>, <span class="st">&#39;d&#39;</span>, <span class="st">&#39;e&#39;</span>, <span class="st">&#39;f&#39;</span>, <span class="st">&#39;g&#39;</span>, <span class="st">&#39;h&#39;</span>, <span class="st">&#39;i&#39;</span>, <span class="st">&#39;j&#39;</span>]</span>
<span id="cb647-20"><a href="#cb647-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb647-21"><a href="#cb647-21" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(exam_data , index <span class="op">=</span> labels)</span>
<span id="cb647-22"><a href="#cb647-22" aria-hidden="true" tabindex="-1"></a>df</span>
<span id="cb647-23"><a href="#cb647-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb647-24"><a href="#cb647-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Importamos datos que utilizaremos durante la clase</span></span>
<span id="cb647-25"><a href="#cb647-25" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> gapminder <span class="im">import</span> gapminder</span>
<span id="cb647-26"><a href="#cb647-26" aria-hidden="true" tabindex="-1"></a>gapminder</span>
<span id="cb647-27"><a href="#cb647-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb647-28"><a href="#cb647-28" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> gapminder</span>
<span id="cb647-29"><a href="#cb647-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb647-30"><a href="#cb647-30" aria-hidden="true" tabindex="-1"></a>df.head(<span class="dv">10</span>)</span>
<span id="cb647-31"><a href="#cb647-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb647-32"><a href="#cb647-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Acceder al nombre de las columnas</span></span>
<span id="cb647-33"><a href="#cb647-33" aria-hidden="true" tabindex="-1"></a>df.columns</span>
<span id="cb647-34"><a href="#cb647-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb647-35"><a href="#cb647-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Acceder al nombre de las filas </span></span>
<span id="cb647-36"><a href="#cb647-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.index)</span>
<span id="cb647-37"><a href="#cb647-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb647-38"><a href="#cb647-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Acceder a valores</span></span>
<span id="cb647-39"><a href="#cb647-39" aria-hidden="true" tabindex="-1"></a>df.values</span>
<span id="cb647-40"><a href="#cb647-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb647-41"><a href="#cb647-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Nuevamente el tipo </span></span>
<span id="cb647-42"><a href="#cb647-42" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(df)</span>
<span id="cb647-43"><a href="#cb647-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb647-44"><a href="#cb647-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Forma</span></span>
<span id="cb647-45"><a href="#cb647-45" aria-hidden="true" tabindex="-1"></a>df.shape</span>
<span id="cb647-46"><a href="#cb647-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb647-47"><a href="#cb647-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspeccion detallada de las columnas </span></span>
<span id="cb647-48"><a href="#cb647-48" aria-hidden="true" tabindex="-1"></a>df.info()</span>
<span id="cb647-49"><a href="#cb647-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb647-50"><a href="#cb647-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Mirar una sola columna</span></span>
<span id="cb647-51"><a href="#cb647-51" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;country&#39;</span>]</span>
<span id="cb647-52"><a href="#cb647-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb647-53"><a href="#cb647-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear un nuevo dataset</span></span>
<span id="cb647-54"><a href="#cb647-54" aria-hidden="true" tabindex="-1"></a>country_df <span class="op">=</span> df[<span class="st">&quot;country&quot;</span>]</span>
<span id="cb647-55"><a href="#cb647-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb647-56"><a href="#cb647-56" aria-hidden="true" tabindex="-1"></a>country_df</span>
<span id="cb647-57"><a href="#cb647-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb647-58"><a href="#cb647-58" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(country_df)</span>
<span id="cb647-59"><a href="#cb647-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb647-60"><a href="#cb647-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Tenemos una serie: cada columna es una serie para python. Similar a un arreglo 1D.</span></span>
<span id="cb647-61"><a href="#cb647-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb647-62"><a href="#cb647-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Sunconjuntos de variables </span></span>
<span id="cb647-63"><a href="#cb647-63" aria-hidden="true" tabindex="-1"></a>subset <span class="op">=</span> df[[<span class="st">&quot;country&quot;</span>, <span class="st">&quot;continent&quot;</span>, <span class="st">&quot;year&quot;</span>]]</span>
<span id="cb647-64"><a href="#cb647-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb647-65"><a href="#cb647-65" aria-hidden="true" tabindex="-1"></a>subset.head()</span>
<span id="cb647-66"><a href="#cb647-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb647-67"><a href="#cb647-67" aria-hidden="true" tabindex="-1"></a>df</span>
<span id="cb647-68"><a href="#cb647-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb647-69"><a href="#cb647-69" aria-hidden="true" tabindex="-1"></a><span class="co"># Buscamos la fila con el indice 2</span></span>
<span id="cb647-70"><a href="#cb647-70" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="dv">3</span>]</span>
<span id="cb647-71"><a href="#cb647-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb647-72"><a href="#cb647-72" aria-hidden="true" tabindex="-1"></a><span class="co"># Buscamos las filas con el id en 0 u 2</span></span>
<span id="cb647-73"><a href="#cb647-73" aria-hidden="true" tabindex="-1"></a>df.loc[[<span class="dv">3</span>,<span class="dv">0</span>,<span class="dv">100</span>]]</span>
<span id="cb647-74"><a href="#cb647-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb647-75"><a href="#cb647-75" aria-hidden="true" tabindex="-1"></a>df.iloc[<span class="dv">3</span>]</span>
<span id="cb647-76"><a href="#cb647-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb647-77"><a href="#cb647-77" aria-hidden="true" tabindex="-1"></a>df.iloc[[<span class="dv">3</span>,<span class="dv">0</span>,<span class="dv">100</span>]]</span></code></pre></div>
<ul>
<li><strong>loc</strong> se refiere al nombre de la unidad de observación (<em>labeling indexing</em>).</li>
<li><strong>iloc</strong> se refiere al índice (<em>positional indexing</em>).</li>
<li>En este caso son iguales dado que los nombres son efectivamente las posiciones. En casos donde esto
no sea así, es importante considerar la diferencia al utilizar estas funciones.</li>
</ul>
<div class="sourceCode" id="cb648"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb648-1"><a href="#cb648-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Recordar filas y columnas</span></span>
<span id="cb648-2"><a href="#cb648-2" aria-hidden="true" tabindex="-1"></a>subset <span class="op">=</span> df.loc[:,[<span class="st">&quot;year&quot;</span>, <span class="st">&quot;pop&quot;</span>]]</span>
<span id="cb648-3"><a href="#cb648-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb648-4"><a href="#cb648-4" aria-hidden="true" tabindex="-1"></a>subset.head()</span>
<span id="cb648-5"><a href="#cb648-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb648-6"><a href="#cb648-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Para hacer filtros en base a condiciones</span></span>
<span id="cb648-7"><a href="#cb648-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtramos todas las filas que tienen como año 1967</span></span>
<span id="cb648-8"><a href="#cb648-8" aria-hidden="true" tabindex="-1"></a>df.loc[df[<span class="st">&quot;year&quot;</span>] <span class="op">==</span> <span class="dv">1967</span>, [<span class="st">&quot;year&quot;</span>, <span class="st">&quot;pop&quot;</span>]]</span>
<span id="cb648-9"><a href="#cb648-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb648-10"><a href="#cb648-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Ahora con múltiples condiciones</span></span>
<span id="cb648-11"><a href="#cb648-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Ocupar paretesis redondos</span></span>
<span id="cb648-12"><a href="#cb648-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Ocupar entre ellos iperadores de comparación</span></span>
<span id="cb648-13"><a href="#cb648-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Note como escrbimimos el número</span></span>
<span id="cb648-14"><a href="#cb648-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb648-15"><a href="#cb648-15" aria-hidden="true" tabindex="-1"></a>df.loc[(df[<span class="st">&quot;year&quot;</span>] <span class="op">==</span> <span class="dv">1967</span>) <span class="op">&amp;</span> (df[<span class="st">&quot;pop&quot;</span>] <span class="op">&gt;</span> <span class="dv">1_000_000</span>), [<span class="st">&quot;year&quot;</span>, <span class="st">&quot;pop&quot;</span>]]</span>
<span id="cb648-16"><a href="#cb648-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb648-17"><a href="#cb648-17" aria-hidden="true" tabindex="-1"></a><span class="dv">1_000_000</span></span>
<span id="cb648-18"><a href="#cb648-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb648-19"><a href="#cb648-19" aria-hidden="true" tabindex="-1"></a>scientists<span class="op">=</span>pd.DataFrame(</span>
<span id="cb648-20"><a href="#cb648-20" aria-hidden="true" tabindex="-1"></a>data<span class="op">=</span>{<span class="st">&#39;Occupation&#39;</span>:[<span class="st">&#39;Chemist&#39;</span>,<span class="st">&#39;Statistician&#39;</span>],</span>
<span id="cb648-21"><a href="#cb648-21" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;Born&#39;</span>:[<span class="st">&#39;1920-07-25&#39;</span>, <span class="st">&#39;1876-06-13&#39;</span>],</span>
<span id="cb648-22"><a href="#cb648-22" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;Died&#39;</span>:[<span class="st">&#39;1958-04-16&#39;</span>, <span class="st">&#39;1937-10-16&#39;</span>],</span>
<span id="cb648-23"><a href="#cb648-23" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;Age&#39;</span>:[<span class="dv">37</span>,<span class="dv">61</span>]},</span>
<span id="cb648-24"><a href="#cb648-24" aria-hidden="true" tabindex="-1"></a>index<span class="op">=</span>[<span class="st">&#39;Rosaline Franklin&#39;</span>,<span class="st">&#39;William Gosset&#39;</span>],</span>
<span id="cb648-25"><a href="#cb648-25" aria-hidden="true" tabindex="-1"></a>columns<span class="op">=</span>[<span class="st">&#39;Occupation&#39;</span>, <span class="st">&#39;Born&#39;</span>,<span class="st">&#39;Died&#39;</span>,<span class="st">&#39;Age&#39;</span>])</span>
<span id="cb648-26"><a href="#cb648-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb648-27"><a href="#cb648-27" aria-hidden="true" tabindex="-1"></a>scientists</span>
<span id="cb648-28"><a href="#cb648-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb648-29"><a href="#cb648-29" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb648-30"><a href="#cb648-30" aria-hidden="true" tabindex="-1"></a>os.getcwd()</span>
<span id="cb648-31"><a href="#cb648-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb648-32"><a href="#cb648-32" aria-hidden="true" tabindex="-1"></a>os.listdir()</span>
<span id="cb648-33"><a href="#cb648-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb648-34"><a href="#cb648-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Carpetas </span></span>
<span id="cb648-35"><a href="#cb648-35" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os </span>
<span id="cb648-36"><a href="#cb648-36" aria-hidden="true" tabindex="-1"></a>principal <span class="op">=</span> os.getcwd()</span>
<span id="cb648-37"><a href="#cb648-37" aria-hidden="true" tabindex="-1"></a>datos <span class="op">=</span> principal <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">datos&quot;</span></span>
<span id="cb648-38"><a href="#cb648-38" aria-hidden="true" tabindex="-1"></a>datos</span>
<span id="cb648-39"><a href="#cb648-39" aria-hidden="true" tabindex="-1"></a>resultados <span class="op">=</span> principal <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">resultados&quot;</span></span>
<span id="cb648-40"><a href="#cb648-40" aria-hidden="true" tabindex="-1"></a>resultados</span>
<span id="cb648-41"><a href="#cb648-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb648-42"><a href="#cb648-42" aria-hidden="true" tabindex="-1"></a>scientists <span class="op">=</span> pd.read_csv(<span class="st">&#39;datos</span><span class="ch">\\</span><span class="st">scientists.csv&#39;</span>)</span>
<span id="cb648-43"><a href="#cb648-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb648-44"><a href="#cb648-44" aria-hidden="true" tabindex="-1"></a>scientists</span>
<span id="cb648-45"><a href="#cb648-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb648-46"><a href="#cb648-46" aria-hidden="true" tabindex="-1"></a>ages <span class="op">=</span> scientists[<span class="st">&#39;Age&#39;</span>]</span>
<span id="cb648-47"><a href="#cb648-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb648-48"><a href="#cb648-48" aria-hidden="true" tabindex="-1"></a>ages</span>
<span id="cb648-49"><a href="#cb648-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb648-50"><a href="#cb648-50" aria-hidden="true" tabindex="-1"></a>ages <span class="op">=</span> scientists.Age</span>
<span id="cb648-51"><a href="#cb648-51" aria-hidden="true" tabindex="-1"></a>ages</span>
<span id="cb648-52"><a href="#cb648-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb648-53"><a href="#cb648-53" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(ages)</span>
<span id="cb648-54"><a href="#cb648-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb648-55"><a href="#cb648-55" aria-hidden="true" tabindex="-1"></a>ages.mean()</span>
<span id="cb648-56"><a href="#cb648-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb648-57"><a href="#cb648-57" aria-hidden="true" tabindex="-1"></a>ages.shape</span>
<span id="cb648-58"><a href="#cb648-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb648-59"><a href="#cb648-59" aria-hidden="true" tabindex="-1"></a>ages.<span class="bu">min</span>()</span>
<span id="cb648-60"><a href="#cb648-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb648-61"><a href="#cb648-61" aria-hidden="true" tabindex="-1"></a>ages.describe()</span>
<span id="cb648-62"><a href="#cb648-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb648-63"><a href="#cb648-63" aria-hidden="true" tabindex="-1"></a>ages[ages <span class="op">&gt;</span> ages.mean()]</span>
<span id="cb648-64"><a href="#cb648-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb648-65"><a href="#cb648-65" aria-hidden="true" tabindex="-1"></a>ages[(ages <span class="op">&gt;</span> ages.mean()) <span class="op">&amp;</span> (ages <span class="op">&gt;</span> <span class="dv">75</span>)]</span>
<span id="cb648-66"><a href="#cb648-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb648-67"><a href="#cb648-67" aria-hidden="true" tabindex="-1"></a>ages[(ages <span class="op">&gt;</span> ages.mean()) <span class="op">&amp;</span> <span class="op">~</span>(ages <span class="op">&gt;</span> <span class="dv">75</span>)]</span>
<span id="cb648-68"><a href="#cb648-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb648-69"><a href="#cb648-69" aria-hidden="true" tabindex="-1"></a>ages.describe()</span>
<span id="cb648-70"><a href="#cb648-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb648-71"><a href="#cb648-71" aria-hidden="true" tabindex="-1"></a>ages <span class="op">+</span> <span class="dv">100</span></span>
<span id="cb648-72"><a href="#cb648-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb648-73"><a href="#cb648-73" aria-hidden="true" tabindex="-1"></a>scientists</span>
<span id="cb648-74"><a href="#cb648-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb648-75"><a href="#cb648-75" aria-hidden="true" tabindex="-1"></a>scientists[scientists[<span class="st">&#39;Age&#39;</span>] <span class="op">&gt;</span> scientists[<span class="st">&#39;Age&#39;</span>].mean()]</span>
<span id="cb648-76"><a href="#cb648-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb648-77"><a href="#cb648-77" aria-hidden="true" tabindex="-1"></a>scientists[<span class="st">&#39;Age&#39;</span>] <span class="op">&gt;</span> scientists[<span class="st">&#39;Age&#39;</span>].mean()</span>
<span id="cb648-78"><a href="#cb648-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb648-79"><a href="#cb648-79" aria-hidden="true" tabindex="-1"></a>scientists</span>
<span id="cb648-80"><a href="#cb648-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb648-81"><a href="#cb648-81" aria-hidden="true" tabindex="-1"></a><span class="co"># Ordenar valores</span></span>
<span id="cb648-82"><a href="#cb648-82" aria-hidden="true" tabindex="-1"></a>scientists.sort_values(by<span class="op">=</span><span class="st">&quot;Age&quot;</span>, ascending <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb648-83"><a href="#cb648-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb648-84"><a href="#cb648-84" aria-hidden="true" tabindex="-1"></a>scientists.to_csv(<span class="st">&#39;resultados</span><span class="ch">\\</span><span class="st">scientists_clean.csv&#39;</span>, index<span class="op">=</span><span class="va">False</span>)</span></code></pre></div>
</div>
<div id="manipular-repaso" class="section level3 hasAnchor" number="4.4.2">
<h3 class="hasAnchor"><span class="header-section-number">4.4.2</span> Manipular (repaso)<a href="#manipular-repaso" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="renombrar" class="section level4 hasAnchor" number="4.4.2.1">
<h4 class="hasAnchor"><span class="header-section-number">4.4.2.1</span> Renombrar<a href="#renombrar" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb649"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb649-1"><a href="#cb649-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Renombrar variables: diccionario + rename </span></span>
<span id="cb649-2"><a href="#cb649-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb649-3"><a href="#cb649-3" aria-hidden="true" tabindex="-1"></a>df.rename(columns <span class="op">=</span> {<span class="st">&#39;country&#39;</span>: <span class="st">&#39;pais&#39;</span>, <span class="st">&#39;continent&#39;</span>:<span class="st">&#39;continent&#39;</span>, </span>
<span id="cb649-4"><a href="#cb649-4" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&#39;year&#39;</span>:<span class="st">&#39;año&#39;</span>, <span class="st">&#39;lifExp&#39;</span>:<span class="st">&#39;esperanza_vida&#39;</span>, </span>
<span id="cb649-5"><a href="#cb649-5" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&#39;pop&#39;</span>:<span class="st">&#39;poblacion&#39;</span>, <span class="st">&#39;gdpPercap&#39;</span>:<span class="st">&#39;pib_percapita&#39;</span>})</span>
<span id="cb649-6"><a href="#cb649-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb649-7"><a href="#cb649-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Ojo que no hemos asignado</span></span>
<span id="cb649-8"><a href="#cb649-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb649-9"><a href="#cb649-9" aria-hidden="true" tabindex="-1"></a>df</span>
<span id="cb649-10"><a href="#cb649-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb649-11"><a href="#cb649-11" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> df.rename(columns <span class="op">=</span> {<span class="st">&#39;country&#39;</span>: <span class="st">&#39;pais&#39;</span>, <span class="st">&#39;continent&#39;</span>:<span class="st">&#39;continente&#39;</span>, </span>
<span id="cb649-12"><a href="#cb649-12" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&#39;year&#39;</span>:<span class="st">&#39;año&#39;</span>, <span class="st">&#39;lifeExp&#39;</span>:<span class="st">&#39;esperanza_vida&#39;</span>, </span>
<span id="cb649-13"><a href="#cb649-13" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&#39;pop&#39;</span>:<span class="st">&#39;poblacion&#39;</span>, <span class="st">&#39;gdpPercap&#39;</span>:<span class="st">&#39;pib_percapita&#39;</span>})</span>
<span id="cb649-14"><a href="#cb649-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb649-15"><a href="#cb649-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Recomendable generar una nueva base de datos, va dejando un registro</span></span>
<span id="cb649-16"><a href="#cb649-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb649-17"><a href="#cb649-17" aria-hidden="true" tabindex="-1"></a>df2</span></code></pre></div>
</div>
<div id="filtrar" class="section level4 hasAnchor" number="4.4.2.2">
<h4 class="hasAnchor"><span class="header-section-number">4.4.2.2</span> Filtrar<a href="#filtrar" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb650"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb650-1"><a href="#cb650-1" aria-hidden="true" tabindex="-1"></a>solo_asia <span class="op">=</span> df[df[<span class="st">&quot;continent&quot;</span>] <span class="op">==</span> <span class="st">&quot;Asia&quot;</span>]</span>
<span id="cb650-2"><a href="#cb650-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb650-3"><a href="#cb650-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Lo que esta adentro es un vecto booleano</span></span>
<span id="cb650-4"><a href="#cb650-4" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;continent&quot;</span>] <span class="op">==</span> <span class="st">&quot;Asia&quot;</span></span>
<span id="cb650-5"><a href="#cb650-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb650-6"><a href="#cb650-6" aria-hidden="true" tabindex="-1"></a>df_asia <span class="op">=</span> solo_asia</span>
<span id="cb650-7"><a href="#cb650-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_asia)</span></code></pre></div>
</div>
<div id="replazar" class="section level4 hasAnchor" number="4.4.2.3">
<h4 class="hasAnchor"><span class="header-section-number">4.4.2.3</span> Replazar<a href="#replazar" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb651"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb651-1"><a href="#cb651-1" aria-hidden="true" tabindex="-1"></a>datos_remplazados <span class="op">=</span> df.replace(<span class="st">&quot;Asia&quot;</span>, <span class="st">&quot;asia&quot;</span>)</span>
<span id="cb651-2"><a href="#cb651-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb651-3"><a href="#cb651-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(datos_remplazados)</span></code></pre></div>
</div>
<div id="remover" class="section level4 hasAnchor" number="4.4.2.4">
<h4 class="hasAnchor"><span class="header-section-number">4.4.2.4</span> Remover<a href="#remover" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb652"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb652-1"><a href="#cb652-1" aria-hidden="true" tabindex="-1"></a>remover_columna <span class="op">=</span> df.drop(<span class="st">&quot;pop&quot;</span>, axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb652-2"><a href="#cb652-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb652-3"><a href="#cb652-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(remover_columna)</span>
<span id="cb652-4"><a href="#cb652-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb652-5"><a href="#cb652-5" aria-hidden="true" tabindex="-1"></a>remover_dos_columnas <span class="op">=</span> df.drop([<span class="st">&quot;gdpPercap&quot;</span>, <span class="st">&quot;pop&quot;</span>], axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb652-6"><a href="#cb652-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb652-7"><a href="#cb652-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(remover_dos_columnas)</span>
<span id="cb652-8"><a href="#cb652-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb652-9"><a href="#cb652-9" aria-hidden="true" tabindex="-1"></a>remover_filas <span class="op">=</span> df.iloc[<span class="dv">0</span>:<span class="dv">100</span>]</span>
<span id="cb652-10"><a href="#cb652-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb652-11"><a href="#cb652-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(remover_filas)</span>
<span id="cb652-12"><a href="#cb652-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb652-13"><a href="#cb652-13" aria-hidden="true" tabindex="-1"></a><span class="co">#### Agregar nuevas filas</span></span>
<span id="cb652-14"><a href="#cb652-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb652-15"><a href="#cb652-15" aria-hidden="true" tabindex="-1"></a>nuevas_filas <span class="op">=</span> {<span class="st">&quot;country&quot;</span>: <span class="st">&quot;nuevo&quot;</span>, </span>
<span id="cb652-16"><a href="#cb652-16" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;continent&quot;</span>: <span class="st">&quot;Asia&quot;</span>, </span>
<span id="cb652-17"><a href="#cb652-17" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;year&quot;</span> : <span class="st">&quot;2022&quot;</span>, </span>
<span id="cb652-18"><a href="#cb652-18" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;gdpPercap&quot;</span> : <span class="st">&quot;100000000&quot;</span>}</span>
<span id="cb652-19"><a href="#cb652-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb652-20"><a href="#cb652-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb652-21"><a href="#cb652-21" aria-hidden="true" tabindex="-1"></a>df.append(nuevas_filas, ignore_index <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb652-22"><a href="#cb652-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Para agregar un diccionario es importante la úñtima opción</span></span></code></pre></div>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 4.4.1: </b></p>
<ul>
<li>Escriba una función llamada <code>ins_simpl</code> que le permita a usted obtener un resumen exploratorio de su base de datos.</li>
<li>La función debe tener como input un dataframe y retornar 5 outputs:
<ul>
<li>Primerar y últimas 8 filas.</li>
<li>Tipo de datos para todas las columnas</li>
<li>Nombre de las columnas</li>
<li>Descripción completa de la base de datos (metodo: describe)</li>
<li>El mínimo, máximo y el promedio de la columna 4 de la base de datos.</li>
</ul></li>
</ul>
</div>
</div>
</div>
<div id="agrupar-calculos" class="section level3 hasAnchor" number="4.4.3">
<h3 class="hasAnchor"><span class="header-section-number">4.4.3</span> Agrupar calculos<a href="#agrupar-calculos" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb653"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb653-1"><a href="#cb653-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> gapminder</span>
<span id="cb653-2"><a href="#cb653-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb653-3"><a href="#cb653-3" aria-hidden="true" tabindex="-1"></a>df.head()</span>
<span id="cb653-4"><a href="#cb653-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb653-5"><a href="#cb653-5" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">&#39;year&#39;</span>)[<span class="st">&#39;gdpPercap&#39;</span>].mean()</span>
<span id="cb653-6"><a href="#cb653-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb653-7"><a href="#cb653-7" aria-hidden="true" tabindex="-1"></a>df.groupby([<span class="st">&#39;year&#39;</span>, <span class="st">&#39;continent&#39;</span>])[[<span class="st">&#39;lifeExp&#39;</span>, <span class="st">&#39;gdpPercap&#39;</span>]].mean()</span>
<span id="cb653-8"><a href="#cb653-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb653-9"><a href="#cb653-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Otra forma de escribir lo mismo</span></span>
<span id="cb653-10"><a href="#cb653-10" aria-hidden="true" tabindex="-1"></a>df<span class="op">\</span></span>
<span id="cb653-11"><a href="#cb653-11" aria-hidden="true" tabindex="-1"></a>    .groupby([<span class="st">&#39;year&#39;</span>, <span class="st">&#39;continent&#39;</span>])[[<span class="st">&#39;lifeExp&#39;</span>, <span class="st">&#39;gdpPercap&#39;</span>]]<span class="op">\</span></span>
<span id="cb653-12"><a href="#cb653-12" aria-hidden="true" tabindex="-1"></a>    .mean()</span>
<span id="cb653-13"><a href="#cb653-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb653-14"><a href="#cb653-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Para dejarlos como un dataframe -&gt; reset_index</span></span>
<span id="cb653-15"><a href="#cb653-15" aria-hidden="true" tabindex="-1"></a>(df</span>
<span id="cb653-16"><a href="#cb653-16" aria-hidden="true" tabindex="-1"></a>    .groupby([<span class="st">&#39;year&#39;</span>, <span class="st">&#39;continent&#39;</span>])[[<span class="st">&#39;lifeExp&#39;</span>, <span class="st">&#39;gdpPercap&#39;</span>]]</span>
<span id="cb653-17"><a href="#cb653-17" aria-hidden="true" tabindex="-1"></a>    .mean()</span>
<span id="cb653-18"><a href="#cb653-18" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb653-19"><a href="#cb653-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb653-20"><a href="#cb653-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb653-21"><a href="#cb653-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Combinar lo que obtengo con visualizaciones </span></span>
<span id="cb653-22"><a href="#cb653-22" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb653-23"><a href="#cb653-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb653-24"><a href="#cb653-24" aria-hidden="true" tabindex="-1"></a>(df</span>
<span id="cb653-25"><a href="#cb653-25" aria-hidden="true" tabindex="-1"></a>     .groupby([<span class="st">&#39;year&#39;</span>])</span>
<span id="cb653-26"><a href="#cb653-26" aria-hidden="true" tabindex="-1"></a>     [[<span class="st">&#39;lifeExp&#39;</span>]]</span>
<span id="cb653-27"><a href="#cb653-27" aria-hidden="true" tabindex="-1"></a>     .mean()</span>
<span id="cb653-28"><a href="#cb653-28" aria-hidden="true" tabindex="-1"></a>     .plot()</span>
<span id="cb653-29"><a href="#cb653-29" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb653-30"><a href="#cb653-30" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb653-31"><a href="#cb653-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb653-32"><a href="#cb653-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Imprima un subconjunto de datos</span></span>
<span id="cb653-33"><a href="#cb653-33" aria-hidden="true" tabindex="-1"></a>solo_asia <span class="op">=</span> gapminder.groupby(<span class="st">&#39;continent&#39;</span>)</span>
<span id="cb653-34"><a href="#cb653-34" aria-hidden="true" tabindex="-1"></a>asiaDf <span class="op">=</span> solo_asia.get_group(<span class="st">&#39;Asia&#39;</span>)</span>
<span id="cb653-35"><a href="#cb653-35" aria-hidden="true" tabindex="-1"></a>asiaDf</span>
<span id="cb653-36"><a href="#cb653-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb653-37"><a href="#cb653-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Contar valores por grupp</span></span>
<span id="cb653-38"><a href="#cb653-38" aria-hidden="true" tabindex="-1"></a>gapminder[<span class="st">&quot;continent&quot;</span>].value_counts()</span>
<span id="cb653-39"><a href="#cb653-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb653-40"><a href="#cb653-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Agrupar un data frame: group_by </span></span>
<span id="cb653-41"><a href="#cb653-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb653-42"><a href="#cb653-42" aria-hidden="true" tabindex="-1"></a>df_agrupado <span class="op">=</span> df.groupby(<span class="st">&#39;year&#39;</span>)</span>
<span id="cb653-43"><a href="#cb653-43" aria-hidden="true" tabindex="-1"></a>df_agrupado.mean()</span>
<span id="cb653-44"><a href="#cb653-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb653-45"><a href="#cb653-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Sobre una variable en particular</span></span>
<span id="cb653-46"><a href="#cb653-46" aria-hidden="true" tabindex="-1"></a>df_agrupado <span class="op">=</span> df[[<span class="st">&#39;gdpPercap&#39;</span>, <span class="st">&#39;year&#39;</span>]].groupby(<span class="st">&#39;year&#39;</span>)</span>
<span id="cb653-47"><a href="#cb653-47" aria-hidden="true" tabindex="-1"></a>df_agrupado.mean()</span>
<span id="cb653-48"><a href="#cb653-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb653-49"><a href="#cb653-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Podemos agrupar varias operaciones</span></span>
<span id="cb653-50"><a href="#cb653-50" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">&quot;year&quot;</span>).agg({<span class="st">&quot;lifeExp&quot;</span>: np.mean, <span class="st">&quot;gdpPercap&quot;</span>: np.size})</span>
<span id="cb653-51"><a href="#cb653-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb653-52"><a href="#cb653-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Agrupar por mas de una variable: año y continente</span></span>
<span id="cb653-53"><a href="#cb653-53" aria-hidden="true" tabindex="-1"></a>df.groupby([<span class="st">&quot;year&quot;</span>, <span class="st">&quot;continent&quot;</span>]).agg({<span class="st">&quot;lifeExp&quot;</span>: np.mean, <span class="st">&quot;gdpPercap&quot;</span>: np.size})</span></code></pre></div>
</div>
<div id="aplicar-funciones" class="section level3 hasAnchor" number="4.4.4">
<h3 class="hasAnchor"><span class="header-section-number">4.4.4</span> Aplicar funciones<a href="#aplicar-funciones" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><strong>Idea</strong>: Aplicar funciones a columnas de una dataframe</li>
</ul>
<div class="sourceCode" id="cb654"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb654-1"><a href="#cb654-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> my_sq(x):</span>
<span id="cb654-2"><a href="#cb654-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb654-3"><a href="#cb654-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb654-4"><a href="#cb654-4" aria-hidden="true" tabindex="-1"></a>my_sq(<span class="dv">4</span>)</span>
<span id="cb654-5"><a href="#cb654-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb654-6"><a href="#cb654-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> avg_2(x, y):</span>
<span id="cb654-7"><a href="#cb654-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (x <span class="op">+</span> y) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb654-8"><a href="#cb654-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb654-9"><a href="#cb654-9" aria-hidden="true" tabindex="-1"></a>avg_2(<span class="dv">10</span>, <span class="dv">20</span>)</span>
<span id="cb654-10"><a href="#cb654-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb654-11"><a href="#cb654-11" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> avg_2(<span class="dv">10</span>, <span class="dv">20</span>) <span class="op">==</span> <span class="fl">15.0</span></span>
<span id="cb654-12"><a href="#cb654-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb654-13"><a href="#cb654-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Esta es una función muy importante para programar defensivamente!!!</span></span>
<span id="cb654-14"><a href="#cb654-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb654-15"><a href="#cb654-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Apliquemos funciones a un dataframe</span></span>
<span id="cb654-16"><a href="#cb654-16" aria-hidden="true" tabindex="-1"></a>df<span class="op">=</span>pd.DataFrame({<span class="st">&#39;a&#39;</span>:[<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">30</span>],</span>
<span id="cb654-17"><a href="#cb654-17" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&#39;b&#39;</span>:[<span class="dv">20</span>,<span class="dv">30</span>,<span class="dv">40</span>]})</span>
<span id="cb654-18"><a href="#cb654-18" aria-hidden="true" tabindex="-1"></a>df</span>
<span id="cb654-19"><a href="#cb654-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb654-20"><a href="#cb654-20" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;a&#39;</span>] <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb654-21"><a href="#cb654-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb654-22"><a href="#cb654-22" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(df[<span class="st">&#39;a&#39;</span>])</span>
<span id="cb654-23"><a href="#cb654-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb654-24"><a href="#cb654-24" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> my_sq(x):</span>
<span id="cb654-25"><a href="#cb654-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># assert isinstance(x, int)</span></span>
<span id="cb654-26"><a href="#cb654-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb654-27"><a href="#cb654-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb654-28"><a href="#cb654-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Con el metodo apply lo utilizamos </span></span>
<span id="cb654-29"><a href="#cb654-29" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;a&#39;</span>].<span class="bu">apply</span>(my_sq)</span>
<span id="cb654-30"><a href="#cb654-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb654-31"><a href="#cb654-31" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> my_exp(x, e):</span>
<span id="cb654-32"><a href="#cb654-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x <span class="op">**</span> e</span>
<span id="cb654-33"><a href="#cb654-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb654-34"><a href="#cb654-34" aria-hidden="true" tabindex="-1"></a>my_exp(<span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb654-35"><a href="#cb654-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb654-36"><a href="#cb654-36" aria-hidden="true" tabindex="-1"></a>my_exp(<span class="dv">2</span>, <span class="dv">10</span>)</span>
<span id="cb654-37"><a href="#cb654-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb654-38"><a href="#cb654-38" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;a&#39;</span>].<span class="bu">apply</span>(my_exp, e<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb654-39"><a href="#cb654-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb654-40"><a href="#cb654-40" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> print_me(x):</span>
<span id="cb654-41"><a href="#cb654-41" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(x)</span>
<span id="cb654-42"><a href="#cb654-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb654-43"><a href="#cb654-43" aria-hidden="true" tabindex="-1"></a>df</span>
<span id="cb654-44"><a href="#cb654-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb654-45"><a href="#cb654-45" aria-hidden="true" tabindex="-1"></a>df.<span class="bu">apply</span>(print_me, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb654-46"><a href="#cb654-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb654-47"><a href="#cb654-47" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb654-48"><a href="#cb654-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb654-49"><a href="#cb654-49" aria-hidden="true" tabindex="-1"></a>df.<span class="bu">apply</span>(np.mean)</span></code></pre></div>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 4.4.2:</b></p>
<ul>
<li>Importe Automobile data. Llamela df_auto</li>
<li>Imprima las últimas dos filas de las primeras cinco filas</li>
<li>¿Cuál es el auto más caro de la compañía?</li>
<li>Cree un data frame con toda la info de los autos toyota.</li>
<li>¿Cuál es el número total de autos de la compañia?</li>
<li>¿Cuàl es el auto más caro de cada compañia?</li>
<li>¿Cuales son las millas promedio por compañia?</li>
<li>Ordene la base de datos por precio de los autos.</li>
</ul>
</div>
</div>
<div id="datos-como-tablas-problemas-y-soluciones" class="section level3 hasAnchor" number="4.4.5">
<h3 class="hasAnchor"><span class="header-section-number">4.4.5</span> Datos como tablas: problemas y soluciones<a href="#datos-como-tablas-problemas-y-soluciones" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="ejemplo-1-encabezados-de-las-columnas-son-valores-y-no-nombres-de-variables" class="section level4 hasAnchor" number="4.4.5.1">
<h4 class="hasAnchor"><span class="header-section-number">4.4.5.1</span> Ejemplo 1: encabezados de las columnas son valores y no nombres de variables<a href="#ejemplo-1-encabezados-de-las-columnas-son-valores-y-no-nombres-de-variables" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb655"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb655-1"><a href="#cb655-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fijar directorio principal </span></span>
<span id="cb655-2"><a href="#cb655-2" aria-hidden="true" tabindex="-1"></a>main <span class="op">=</span> os.getcwd()</span>
<span id="cb655-3"><a href="#cb655-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb655-4"><a href="#cb655-4" aria-hidden="true" tabindex="-1"></a>main</span>
<span id="cb655-5"><a href="#cb655-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb655-6"><a href="#cb655-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Fijar directorios secundarios en base al principal</span></span>
<span id="cb655-7"><a href="#cb655-7" aria-hidden="true" tabindex="-1"></a>datos <span class="op">=</span> main <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">datos&quot;</span></span>
<span id="cb655-8"><a href="#cb655-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb655-9"><a href="#cb655-9" aria-hidden="true" tabindex="-1"></a>datos</span>
<span id="cb655-10"><a href="#cb655-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb655-11"><a href="#cb655-11" aria-hidden="true" tabindex="-1"></a>pew <span class="op">=</span> pd.read_csv(<span class="st">&#39;datos</span><span class="ch">\\</span><span class="st">pew-raw.csv&#39;</span>)</span>
<span id="cb655-12"><a href="#cb655-12" aria-hidden="true" tabindex="-1"></a>pew</span>
<span id="cb655-13"><a href="#cb655-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb655-14"><a href="#cb655-14" aria-hidden="true" tabindex="-1"></a>pew.head()</span></code></pre></div>
<ul>
<li>Noten que esta es una base de datos donde tenemos información en las columnas</li>
</ul>
<div class="sourceCode" id="cb656"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb656-1"><a href="#cb656-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Formato wide a formato 2 </span></span>
<span id="cb656-2"><a href="#cb656-2" aria-hidden="true" tabindex="-1"></a>pew_long <span class="op">=</span> pd.melt(pew, </span>
<span id="cb656-3"><a href="#cb656-3" aria-hidden="true" tabindex="-1"></a>                   id_vars <span class="op">=</span> <span class="st">&quot;religion&quot;</span>)</span>
<span id="cb656-4"><a href="#cb656-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb656-5"><a href="#cb656-5" aria-hidden="true" tabindex="-1"></a>pew_long.head()</span>
<span id="cb656-6"><a href="#cb656-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb656-7"><a href="#cb656-7" aria-hidden="true" tabindex="-1"></a>pew_long <span class="op">=</span> pd.melt(pew, </span>
<span id="cb656-8"><a href="#cb656-8" aria-hidden="true" tabindex="-1"></a>                   id_vars <span class="op">=</span> <span class="st">&quot;religion&quot;</span>, </span>
<span id="cb656-9"><a href="#cb656-9" aria-hidden="true" tabindex="-1"></a>                   var_name <span class="op">=</span> <span class="st">&quot;ingreso&quot;</span>)</span>
<span id="cb656-10"><a href="#cb656-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb656-11"><a href="#cb656-11" aria-hidden="true" tabindex="-1"></a>pew_long.head()</span>
<span id="cb656-12"><a href="#cb656-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb656-13"><a href="#cb656-13" aria-hidden="true" tabindex="-1"></a>pew_long <span class="op">=</span> pd.melt(pew, </span>
<span id="cb656-14"><a href="#cb656-14" aria-hidden="true" tabindex="-1"></a>                   id_vars <span class="op">=</span> <span class="st">&quot;religion&quot;</span>, </span>
<span id="cb656-15"><a href="#cb656-15" aria-hidden="true" tabindex="-1"></a>                   var_name <span class="op">=</span> <span class="st">&quot;ingreso&quot;</span>, </span>
<span id="cb656-16"><a href="#cb656-16" aria-hidden="true" tabindex="-1"></a>                   value_name <span class="op">=</span> <span class="st">&quot;Casos&quot;</span>)</span>
<span id="cb656-17"><a href="#cb656-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb656-18"><a href="#cb656-18" aria-hidden="true" tabindex="-1"></a>pew_long.head()</span>
<span id="cb656-19"><a href="#cb656-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb656-20"><a href="#cb656-20" aria-hidden="true" tabindex="-1"></a>pew</span>
<span id="cb656-21"><a href="#cb656-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb656-22"><a href="#cb656-22" aria-hidden="true" tabindex="-1"></a>billboard <span class="op">=</span> pd.read_csv(<span class="st">&quot;datos</span><span class="ch">\\</span><span class="st">billboard.csv&quot;</span>)</span>
<span id="cb656-23"><a href="#cb656-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb656-24"><a href="#cb656-24" aria-hidden="true" tabindex="-1"></a>billboard</span>
<span id="cb656-25"><a href="#cb656-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb656-26"><a href="#cb656-26" aria-hidden="true" tabindex="-1"></a>billboard_long <span class="op">=</span> pd.melt(</span>
<span id="cb656-27"><a href="#cb656-27" aria-hidden="true" tabindex="-1"></a>    billboard, </span>
<span id="cb656-28"><a href="#cb656-28" aria-hidden="true" tabindex="-1"></a>    id_vars <span class="op">=</span> [<span class="st">&quot;year&quot;</span>, <span class="st">&quot;artist&quot;</span>, <span class="st">&quot;track&quot;</span>, <span class="st">&quot;time&quot;</span>, <span class="st">&quot;date.entered&quot;</span>],</span>
<span id="cb656-29"><a href="#cb656-29" aria-hidden="true" tabindex="-1"></a>    var_name <span class="op">=</span> <span class="st">&quot;week&quot;</span>, </span>
<span id="cb656-30"><a href="#cb656-30" aria-hidden="true" tabindex="-1"></a>    value_name <span class="op">=</span> <span class="st">&quot;rating&quot;</span></span>
<span id="cb656-31"><a href="#cb656-31" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb656-32"><a href="#cb656-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb656-33"><a href="#cb656-33" aria-hidden="true" tabindex="-1"></a>billboard_long</span>
<span id="cb656-34"><a href="#cb656-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb656-35"><a href="#cb656-35" aria-hidden="true" tabindex="-1"></a>billboard.shape</span>
<span id="cb656-36"><a href="#cb656-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb656-37"><a href="#cb656-37" aria-hidden="true" tabindex="-1"></a>billboard_long.shape</span></code></pre></div>
</div>
<div id="ejemplo-2-múltiples-variables-guardadas-en-la-columna-1" class="section level4 hasAnchor" number="4.4.5.2">
<h4 class="hasAnchor"><span class="header-section-number">4.4.5.2</span> Ejemplo 2: múltiples variables guardadas en la columna 1<a href="#ejemplo-2-múltiples-variables-guardadas-en-la-columna-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb657"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb657-1"><a href="#cb657-1" aria-hidden="true" tabindex="-1"></a>ebola <span class="op">=</span> pd.read_csv(<span class="st">&quot;datos</span><span class="ch">\\</span><span class="st">country_timeseries.csv&quot;</span>)</span>
<span id="cb657-2"><a href="#cb657-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb657-3"><a href="#cb657-3" aria-hidden="true" tabindex="-1"></a>ebola.head()</span>
<span id="cb657-4"><a href="#cb657-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb657-5"><a href="#cb657-5" aria-hidden="true" tabindex="-1"></a>ebola_long <span class="op">=</span> pd.melt(ebola, </span>
<span id="cb657-6"><a href="#cb657-6" aria-hidden="true" tabindex="-1"></a>                     id_vars <span class="op">=</span> [<span class="st">&quot;Date&quot;</span>, <span class="st">&quot;Day&quot;</span>])</span>
<span id="cb657-7"><a href="#cb657-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb657-8"><a href="#cb657-8" aria-hidden="true" tabindex="-1"></a>ebola_long.head()</span>
<span id="cb657-9"><a href="#cb657-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb657-10"><a href="#cb657-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Vamos a quitar &quot;Cases&quot; en variables</span></span>
<span id="cb657-11"><a href="#cb657-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb657-12"><a href="#cb657-12" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;cases_Guinea&quot;</span>.split(<span class="st">&quot;_&quot;</span>)</span>
<span id="cb657-13"><a href="#cb657-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb657-14"><a href="#cb657-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Columna + tipo de acceso + metodo</span></span>
<span id="cb657-15"><a href="#cb657-15" aria-hidden="true" tabindex="-1"></a>variable_split <span class="op">=</span> ebola_long[<span class="st">&quot;variable&quot;</span>].<span class="bu">str</span>.split(<span class="st">&quot;_&quot;</span>)</span>
<span id="cb657-16"><a href="#cb657-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb657-17"><a href="#cb657-17" aria-hidden="true" tabindex="-1"></a>variable_split</span>
<span id="cb657-18"><a href="#cb657-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb657-19"><a href="#cb657-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Veamos que tiene por partes </span></span>
<span id="cb657-20"><a href="#cb657-20" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(variable_split)</span>
<span id="cb657-21"><a href="#cb657-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb657-22"><a href="#cb657-22" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(variable_split[<span class="dv">0</span>])</span>
<span id="cb657-23"><a href="#cb657-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb657-24"><a href="#cb657-24" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(variable_split[<span class="dv">0</span>][<span class="dv">0</span>])</span>
<span id="cb657-25"><a href="#cb657-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb657-26"><a href="#cb657-26" aria-hidden="true" tabindex="-1"></a>variable_split.<span class="bu">str</span>.get(<span class="dv">0</span>)</span>
<span id="cb657-27"><a href="#cb657-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb657-28"><a href="#cb657-28" aria-hidden="true" tabindex="-1"></a>variable_split.<span class="bu">str</span>.get(<span class="dv">1</span>)</span>
<span id="cb657-29"><a href="#cb657-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb657-30"><a href="#cb657-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Ahora vamos a utilizar estos dos para actualizar base de datos </span></span>
<span id="cb657-31"><a href="#cb657-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb657-32"><a href="#cb657-32" aria-hidden="true" tabindex="-1"></a>ebola_long[<span class="st">&quot;stats&quot;</span>] <span class="op">=</span> variable_split.<span class="bu">str</span>.get(<span class="dv">0</span>)</span>
<span id="cb657-33"><a href="#cb657-33" aria-hidden="true" tabindex="-1"></a>ebola_long[<span class="st">&quot;country&quot;</span>] <span class="op">=</span> variable_split.<span class="bu">str</span>.get(<span class="dv">1</span>)</span>
<span id="cb657-34"><a href="#cb657-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb657-35"><a href="#cb657-35" aria-hidden="true" tabindex="-1"></a>ebola_long</span>
<span id="cb657-36"><a href="#cb657-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb657-37"><a href="#cb657-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Otra forma de hacer lo anterior</span></span>
<span id="cb657-38"><a href="#cb657-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb657-39"><a href="#cb657-39" aria-hidden="true" tabindex="-1"></a>ebola_long[[<span class="st">&quot;stats_e&quot;</span>, <span class="st">&quot;country_e&quot;</span>]] <span class="op">=</span> (ebola_long[<span class="st">&quot;variable&quot;</span>].<span class="bu">str</span>.split(<span class="st">&quot;_&quot;</span>, expand <span class="op">=</span> <span class="va">True</span>))</span>
<span id="cb657-40"><a href="#cb657-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb657-41"><a href="#cb657-41" aria-hidden="true" tabindex="-1"></a>ebola_long</span></code></pre></div>
</div>
<div id="ejemplo-3-mútiples-tipos-de-unidades-de-observación-en-la-misma-tabla" class="section level4 hasAnchor" number="4.4.5.3">
<h4 class="hasAnchor"><span class="header-section-number">4.4.5.3</span> Ejemplo 3: Mútiples tipos de unidades de observación en la misma tabla<a href="#ejemplo-3-mútiples-tipos-de-unidades-de-observación-en-la-misma-tabla" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb658"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb658-1"><a href="#cb658-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Variables guradads en filas y columnas </span></span>
<span id="cb658-2"><a href="#cb658-2" aria-hidden="true" tabindex="-1"></a>weather <span class="op">=</span> pd.read_csv(<span class="st">&quot;datos</span><span class="ch">\\</span><span class="st">weather.csv&quot;</span>)</span>
<span id="cb658-3"><a href="#cb658-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb658-4"><a href="#cb658-4" aria-hidden="true" tabindex="-1"></a>weather</span>
<span id="cb658-5"><a href="#cb658-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb658-6"><a href="#cb658-6" aria-hidden="true" tabindex="-1"></a>weather_melt <span class="op">=</span> pd.melt(</span>
<span id="cb658-7"><a href="#cb658-7" aria-hidden="true" tabindex="-1"></a>        weather, </span>
<span id="cb658-8"><a href="#cb658-8" aria-hidden="true" tabindex="-1"></a>        id_vars <span class="op">=</span> [<span class="st">&quot;id&quot;</span>, <span class="st">&quot;year&quot;</span>, <span class="st">&quot;month&quot;</span>, <span class="st">&quot;element&quot;</span>], </span>
<span id="cb658-9"><a href="#cb658-9" aria-hidden="true" tabindex="-1"></a>        var_name <span class="op">=</span> <span class="st">&quot;day&quot;</span>,</span>
<span id="cb658-10"><a href="#cb658-10" aria-hidden="true" tabindex="-1"></a>        value_name <span class="op">=</span> <span class="st">&quot;temp&quot;</span></span>
<span id="cb658-11"><a href="#cb658-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb658-12"><a href="#cb658-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb658-13"><a href="#cb658-13" aria-hidden="true" tabindex="-1"></a>weather_melt</span>
<span id="cb658-14"><a href="#cb658-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb658-15"><a href="#cb658-15" aria-hidden="true" tabindex="-1"></a>weather_tidy <span class="op">=</span> weather_melt.pivot_table(</span>
<span id="cb658-16"><a href="#cb658-16" aria-hidden="true" tabindex="-1"></a>    index <span class="op">=</span> [<span class="st">&quot;id&quot;</span>, <span class="st">&quot;year&quot;</span>, <span class="st">&quot;month&quot;</span>, <span class="st">&quot;day&quot;</span>], </span>
<span id="cb658-17"><a href="#cb658-17" aria-hidden="true" tabindex="-1"></a>    columns <span class="op">=</span> <span class="st">&quot;element&quot;</span>, </span>
<span id="cb658-18"><a href="#cb658-18" aria-hidden="true" tabindex="-1"></a>    values <span class="op">=</span> <span class="st">&quot;temp&quot;</span></span>
<span id="cb658-19"><a href="#cb658-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb658-20"><a href="#cb658-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb658-21"><a href="#cb658-21" aria-hidden="true" tabindex="-1"></a>weather_tidy</span>
<span id="cb658-22"><a href="#cb658-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Nos permite ver la jerarquí ad elos datos que tenemos</span></span>
<span id="cb658-23"><a href="#cb658-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb658-24"><a href="#cb658-24" aria-hidden="true" tabindex="-1"></a>weather_tidy.reset_index()</span>
<span id="cb658-25"><a href="#cb658-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb658-26"><a href="#cb658-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Multiple Types of Observational Unit in Same Table (i.e De-nomalized Table)</span></span>
<span id="cb658-27"><a href="#cb658-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb658-28"><a href="#cb658-28" aria-hidden="true" tabindex="-1"></a>billboard_long.head()</span>
<span id="cb658-29"><a href="#cb658-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb658-30"><a href="#cb658-30" aria-hidden="true" tabindex="-1"></a>billboard_long.loc[billboard_long[<span class="st">&quot;track&quot;</span>] <span class="op">==</span> <span class="st">&quot;Loser&quot;</span>]</span>
<span id="cb658-31"><a href="#cb658-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb658-32"><a href="#cb658-32" aria-hidden="true" tabindex="-1"></a>billboard_songs <span class="op">=</span> billboard_long[[<span class="st">&quot;year&quot;</span>, <span class="st">&quot;artist&quot;</span>, <span class="st">&quot;track&quot;</span>, <span class="st">&quot;time&quot;</span>]]</span>
<span id="cb658-33"><a href="#cb658-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb658-34"><a href="#cb658-34" aria-hidden="true" tabindex="-1"></a>billboard_songs.shape</span>
<span id="cb658-35"><a href="#cb658-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb658-36"><a href="#cb658-36" aria-hidden="true" tabindex="-1"></a>billboard_songs.head()</span>
<span id="cb658-37"><a href="#cb658-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb658-38"><a href="#cb658-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Eliminar duplicados </span></span>
<span id="cb658-39"><a href="#cb658-39" aria-hidden="true" tabindex="-1"></a>billboard_songs <span class="op">=</span> billboard_songs.drop_duplicates()</span>
<span id="cb658-40"><a href="#cb658-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb658-41"><a href="#cb658-41" aria-hidden="true" tabindex="-1"></a>billboard_songs[<span class="st">&quot;id&quot;</span>] <span class="op">=</span> <span class="bu">range</span>(<span class="bu">len</span>(billboard_songs))</span>
<span id="cb658-42"><a href="#cb658-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb658-43"><a href="#cb658-43" aria-hidden="true" tabindex="-1"></a>billboard_songs.head()</span>
<span id="cb658-44"><a href="#cb658-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb658-45"><a href="#cb658-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Guardamos </span></span>
<span id="cb658-46"><a href="#cb658-46" aria-hidden="true" tabindex="-1"></a>resultados <span class="op">=</span> main <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">resultados&quot;</span></span>
<span id="cb658-47"><a href="#cb658-47" aria-hidden="true" tabindex="-1"></a>billboard_songs.to_csv(<span class="st">&quot;resultados</span><span class="ch">\\</span><span class="st">billboard_songs.csv&quot;</span>, index <span class="op">=</span>  <span class="va">False</span>)</span>
<span id="cb658-48"><a href="#cb658-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb658-49"><a href="#cb658-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Combinemos dos bases de datos </span></span>
<span id="cb658-50"><a href="#cb658-50" aria-hidden="true" tabindex="-1"></a>billboard_ratings <span class="op">=</span> billboard_long.merge(</span>
<span id="cb658-51"><a href="#cb658-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb658-52"><a href="#cb658-52" aria-hidden="true" tabindex="-1"></a>    billboard_songs, </span>
<span id="cb658-53"><a href="#cb658-53" aria-hidden="true" tabindex="-1"></a>    on <span class="op">=</span> [<span class="st">&quot;year&quot;</span>, <span class="st">&quot;artist&quot;</span>, <span class="st">&quot;track&quot;</span>, <span class="st">&quot;time&quot;</span>]</span>
<span id="cb658-54"><a href="#cb658-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb658-55"><a href="#cb658-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb658-56"><a href="#cb658-56" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb658-57"><a href="#cb658-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb658-58"><a href="#cb658-58" aria-hidden="true" tabindex="-1"></a>billboard_ratings.head()</span>
<span id="cb658-59"><a href="#cb658-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb658-60"><a href="#cb658-60" aria-hidden="true" tabindex="-1"></a>billboard_ratings <span class="op">=</span> billboard_ratings[[<span class="st">&quot;id&quot;</span>, <span class="st">&quot;date.entered&quot;</span>, <span class="st">&quot;week&quot;</span>, <span class="st">&quot;rating&quot;</span>]]</span>
<span id="cb658-61"><a href="#cb658-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb658-62"><a href="#cb658-62" aria-hidden="true" tabindex="-1"></a>billboard_ratings.head()</span>
<span id="cb658-63"><a href="#cb658-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb658-64"><a href="#cb658-64" aria-hidden="true" tabindex="-1"></a>billboard_ratings.sample(<span class="dv">20</span>)</span>
<span id="cb658-65"><a href="#cb658-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb658-66"><a href="#cb658-66" aria-hidden="true" tabindex="-1"></a>billboard_songs.to_csv(<span class="st">&quot;resultados</span><span class="ch">\\</span><span class="st">billboard_ratings.csv&quot;</span>, index <span class="op">=</span>  <span class="va">False</span>)</span>
<span id="cb658-67"><a href="#cb658-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb658-68"><a href="#cb658-68" aria-hidden="true" tabindex="-1"></a>billboard_ratings.info()</span>
<span id="cb658-69"><a href="#cb658-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb658-70"><a href="#cb658-70" aria-hidden="true" tabindex="-1"></a>billboard_long.info()</span></code></pre></div>
</div>
</div>
<div id="concatenar-data-frames" class="section level3 hasAnchor" number="4.4.6">
<h3 class="hasAnchor"><span class="header-section-number">4.4.6</span> Concatenar data frames<a href="#concatenar-data-frames" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb659"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb659-1"><a href="#cb659-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb659-2"><a href="#cb659-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb659-3"><a href="#cb659-3" aria-hidden="true" tabindex="-1"></a>df1 <span class="op">=</span> pd.read_csv(<span class="st">&#39;datos</span><span class="ch">\\</span><span class="st">concat_1.csv&#39;</span>)</span>
<span id="cb659-4"><a href="#cb659-4" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> pd.read_csv(<span class="st">&#39;datos</span><span class="ch">\\</span><span class="st">concat_2.csv&#39;</span>)</span>
<span id="cb659-5"><a href="#cb659-5" aria-hidden="true" tabindex="-1"></a>df3 <span class="op">=</span> pd.read_csv(<span class="st">&#39;datos</span><span class="ch">\\</span><span class="st">concat_3.csv&#39;</span>)</span>
<span id="cb659-6"><a href="#cb659-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb659-7"><a href="#cb659-7" aria-hidden="true" tabindex="-1"></a>df1</span>
<span id="cb659-8"><a href="#cb659-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb659-9"><a href="#cb659-9" aria-hidden="true" tabindex="-1"></a>df2</span>
<span id="cb659-10"><a href="#cb659-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb659-11"><a href="#cb659-11" aria-hidden="true" tabindex="-1"></a>df3</span>
<span id="cb659-12"><a href="#cb659-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb659-13"><a href="#cb659-13" aria-hidden="true" tabindex="-1"></a>row_concat <span class="op">=</span> pd.concat([df1, df2, df3])</span>
<span id="cb659-14"><a href="#cb659-14" aria-hidden="true" tabindex="-1"></a>row_concat</span>
<span id="cb659-15"><a href="#cb659-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb659-16"><a href="#cb659-16" aria-hidden="true" tabindex="-1"></a>row_concat.loc[<span class="dv">0</span>]</span>
<span id="cb659-17"><a href="#cb659-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb659-18"><a href="#cb659-18" aria-hidden="true" tabindex="-1"></a>row_concat.iloc[<span class="dv">0</span>]</span>
<span id="cb659-19"><a href="#cb659-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb659-20"><a href="#cb659-20" aria-hidden="true" tabindex="-1"></a>row_concat.ix[<span class="dv">0</span>]</span>
<span id="cb659-21"><a href="#cb659-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb659-22"><a href="#cb659-22" aria-hidden="true" tabindex="-1"></a>row_concat_reset <span class="op">=</span> pd.concat([df1, df2, df3], ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb659-23"><a href="#cb659-23" aria-hidden="true" tabindex="-1"></a>row_concat_reset</span>
<span id="cb659-24"><a href="#cb659-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb659-25"><a href="#cb659-25" aria-hidden="true" tabindex="-1"></a>new_row_series <span class="op">=</span> pd.Series([<span class="st">&#39;n1&#39;</span>, <span class="st">&#39;n2&#39;</span>, <span class="st">&#39;n3&#39;</span>, <span class="st">&#39;n4&#39;</span>])</span>
<span id="cb659-26"><a href="#cb659-26" aria-hidden="true" tabindex="-1"></a>new_row_series</span>
<span id="cb659-27"><a href="#cb659-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb659-28"><a href="#cb659-28" aria-hidden="true" tabindex="-1"></a>pd.concat([df1, new_row_series])</span>
<span id="cb659-29"><a href="#cb659-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb659-30"><a href="#cb659-30" aria-hidden="true" tabindex="-1"></a>new_row_data <span class="op">=</span> pd.DataFrame([[<span class="st">&#39;n1&#39;</span>, <span class="st">&#39;n2&#39;</span>, <span class="st">&#39;n3&#39;</span>, <span class="st">&#39;n4&#39;</span>]],</span>
<span id="cb659-31"><a href="#cb659-31" aria-hidden="true" tabindex="-1"></a>                            columns<span class="op">=</span>[<span class="st">&#39;A&#39;</span>, <span class="st">&#39;B&#39;</span>, <span class="st">&#39;C&#39;</span>, <span class="st">&#39;D&#39;</span>])</span>
<span id="cb659-32"><a href="#cb659-32" aria-hidden="true" tabindex="-1"></a>new_row_data</span>
<span id="cb659-33"><a href="#cb659-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb659-34"><a href="#cb659-34" aria-hidden="true" tabindex="-1"></a>pd.concat([df1, new_row_data])</span>
<span id="cb659-35"><a href="#cb659-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb659-36"><a href="#cb659-36" aria-hidden="true" tabindex="-1"></a>col_concat <span class="op">=</span> pd.concat([df1, df2, df3], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb659-37"><a href="#cb659-37" aria-hidden="true" tabindex="-1"></a>col_concat</span>
<span id="cb659-38"><a href="#cb659-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb659-39"><a href="#cb659-39" aria-hidden="true" tabindex="-1"></a>col_concat[<span class="st">&#39;A&#39;</span>]</span>
<span id="cb659-40"><a href="#cb659-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb659-41"><a href="#cb659-41" aria-hidden="true" tabindex="-1"></a>col_concat_ignore <span class="op">=</span> pd.concat([df1, df2, df3], axis<span class="op">=</span><span class="dv">1</span>, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb659-42"><a href="#cb659-42" aria-hidden="true" tabindex="-1"></a>col_concat_ignore</span>
<span id="cb659-43"><a href="#cb659-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb659-44"><a href="#cb659-44" aria-hidden="true" tabindex="-1"></a>df1.columns<span class="op">=</span>[<span class="st">&#39;A&#39;</span>,<span class="st">&#39;B&#39;</span>,<span class="st">&#39;C&#39;</span>,<span class="st">&#39;D&#39;</span>]</span>
<span id="cb659-45"><a href="#cb659-45" aria-hidden="true" tabindex="-1"></a>df2.columns<span class="op">=</span>[<span class="st">&#39;E&#39;</span>,<span class="st">&#39;F&#39;</span>,<span class="st">&#39;G&#39;</span>,<span class="st">&#39;H&#39;</span>]</span>
<span id="cb659-46"><a href="#cb659-46" aria-hidden="true" tabindex="-1"></a>df3.columns<span class="op">=</span>[<span class="st">&#39;A&#39;</span>,<span class="st">&#39;H&#39;</span>,<span class="st">&#39;F&#39;</span>,<span class="st">&#39;C&#39;</span>]</span>
<span id="cb659-47"><a href="#cb659-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb659-48"><a href="#cb659-48" aria-hidden="true" tabindex="-1"></a>df1</span>
<span id="cb659-49"><a href="#cb659-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb659-50"><a href="#cb659-50" aria-hidden="true" tabindex="-1"></a>df2</span>
<span id="cb659-51"><a href="#cb659-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb659-52"><a href="#cb659-52" aria-hidden="true" tabindex="-1"></a>df3</span>
<span id="cb659-53"><a href="#cb659-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb659-54"><a href="#cb659-54" aria-hidden="true" tabindex="-1"></a>pd.concat([df1, df2, df3])</span></code></pre></div>
</div>
</div>
<div id="manipulación-de-bases-de-datos-parte-ii-1" class="section level2 hasAnchor" number="4.5">
<h2 class="hasAnchor"><span class="header-section-number">4.5</span> Manipulación de bases de datos (Parte II)<a href="#manipulación-de-bases-de-datos-parte-ii-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb660"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb660-1"><a href="#cb660-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preambulo</span></span>
<span id="cb660-2"><a href="#cb660-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb660-3"><a href="#cb660-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Librerías: </span></span>
<span id="cb660-4"><a href="#cb660-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb660-5"><a href="#cb660-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd                    <span class="co"># datos</span></span>
<span id="cb660-6"><a href="#cb660-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib <span class="im">as</span> mpl               <span class="co"># graficos</span></span>
<span id="cb660-7"><a href="#cb660-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np                     <span class="co"># arreglos</span></span>
<span id="cb660-8"><a href="#cb660-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> datetime <span class="im">as</span> dt                  <span class="co"># fechas </span></span>
<span id="cb660-9"><a href="#cb660-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os                              <span class="co"># directorios </span></span>
<span id="cb660-10"><a href="#cb660-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb660-11"><a href="#cb660-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Fecha</span></span>
<span id="cb660-12"><a href="#cb660-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dt.date.today())</span></code></pre></div>
<div id="aplicar-funciones-a-columnas-de-una-base-de-datos" class="section level3 hasAnchor" number="4.5.1">
<h3 class="hasAnchor"><span class="header-section-number">4.5.1</span> Aplicar funciones a columnas de una base de datos<a href="#aplicar-funciones-a-columnas-de-una-base-de-datos" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><strong>Idea</strong>: Aplicar funciones a columnas de una dataframe</li>
<li>Recuerden todo el instrumental que aprendimos en las clases anteriores respecto al uso de funciones!</li>
</ul>
<div class="sourceCode" id="cb661"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb661-1"><a href="#cb661-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apliquemos funciones a un dataframe</span></span>
<span id="cb661-2"><a href="#cb661-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb661-3"><a href="#cb661-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({<span class="st">&#39;a&#39;</span>:[<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">30</span>],</span>
<span id="cb661-4"><a href="#cb661-4" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&#39;b&#39;</span>:[<span class="dv">20</span>,<span class="dv">30</span>,<span class="dv">40</span>]})</span>
<span id="cb661-5"><a href="#cb661-5" aria-hidden="true" tabindex="-1"></a>df</span>
<span id="cb661-6"><a href="#cb661-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb661-7"><a href="#cb661-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Aplico directamente a una columna, la cual llamo por su nombre</span></span>
<span id="cb661-8"><a href="#cb661-8" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> df[<span class="st">&#39;a&#39;</span>] <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb661-9"><a href="#cb661-9" aria-hidden="true" tabindex="-1"></a>df2</span>
<span id="cb661-10"><a href="#cb661-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb661-11"><a href="#cb661-11" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;b&#39;</span>] <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb661-12"><a href="#cb661-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb661-13"><a href="#cb661-13" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(df[<span class="st">&#39;a&#39;</span>])</span>
<span id="cb661-14"><a href="#cb661-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb661-15"><a href="#cb661-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Defino una función cualquiera, tan compleja como lo desee</span></span>
<span id="cb661-16"><a href="#cb661-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> my_sq(x):</span>
<span id="cb661-17"><a href="#cb661-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb661-18"><a href="#cb661-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb661-19"><a href="#cb661-19" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;b&#39;</span>].<span class="bu">apply</span>(my_sq)</span>
<span id="cb661-20"><a href="#cb661-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb661-21"><a href="#cb661-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Podemos hacer lo mismo con funciones que tengan más de un parámetro</span></span>
<span id="cb661-22"><a href="#cb661-22" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> my_exp(x, e):</span>
<span id="cb661-23"><a href="#cb661-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x <span class="op">**</span> e</span>
<span id="cb661-24"><a href="#cb661-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb661-25"><a href="#cb661-25" aria-hidden="true" tabindex="-1"></a>my_exp(<span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb661-26"><a href="#cb661-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb661-27"><a href="#cb661-27" aria-hidden="true" tabindex="-1"></a>my_exp(<span class="dv">2</span>, <span class="dv">10</span>)</span>
<span id="cb661-28"><a href="#cb661-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb661-29"><a href="#cb661-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Noten que puedo incluir valores para los argumentos adicionales al principal! </span></span>
<span id="cb661-30"><a href="#cb661-30" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;a&#39;</span>].<span class="bu">apply</span>(my_exp, e<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb661-31"><a href="#cb661-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb661-32"><a href="#cb661-32" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> print_me(x):</span>
<span id="cb661-33"><a href="#cb661-33" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(x)</span>
<span id="cb661-34"><a href="#cb661-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb661-35"><a href="#cb661-35" aria-hidden="true" tabindex="-1"></a>df</span>
<span id="cb661-36"><a href="#cb661-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb661-37"><a href="#cb661-37" aria-hidden="true" tabindex="-1"></a>df.<span class="bu">apply</span>(print_me, axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb661-38"><a href="#cb661-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb661-39"><a href="#cb661-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Tambien puedo incluir funciones de otras librerías de python </span></span>
<span id="cb661-40"><a href="#cb661-40" aria-hidden="true" tabindex="-1"></a>df.<span class="bu">apply</span>(np.mean)</span></code></pre></div>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 4.5.1: </b> + Escribir una función que reciba una muestra de números en una lista y devuelva un diccionario con su media, varianza y desviación estandar.</p>
</div>
<div class="sourceCode" id="cb662"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb662-1"><a href="#cb662-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb662-2"><a href="#cb662-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> statistics(sample): </span>
<span id="cb662-3"><a href="#cb662-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb662-4"><a href="#cb662-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Función que calcula media, varianza y desv.estandar </span></span>
<span id="cb662-5"><a href="#cb662-5" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb662-6"><a href="#cb662-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Parámetros:</span></span>
<span id="cb662-7"><a href="#cb662-7" aria-hidden="true" tabindex="-1"></a><span class="co">    sample: Es una lista de números </span></span>
<span id="cb662-8"><a href="#cb662-8" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb662-9"><a href="#cb662-9" aria-hidden="true" tabindex="-1"></a><span class="co">    Output </span></span>
<span id="cb662-10"><a href="#cb662-10" aria-hidden="true" tabindex="-1"></a><span class="co">    Diccionario con media, varianza y desv. estandar. </span></span>
<span id="cb662-11"><a href="#cb662-11" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb662-12"><a href="#cb662-12" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb662-13"><a href="#cb662-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb662-14"><a href="#cb662-14" aria-hidden="true" tabindex="-1"></a>    stat <span class="op">=</span> {}</span>
<span id="cb662-15"><a href="#cb662-15" aria-hidden="true" tabindex="-1"></a>    stat[<span class="st">&#39;media&#39;</span>] <span class="op">=</span> <span class="bu">sum</span>(sample)<span class="op">/</span><span class="bu">len</span>(sample)</span>
<span id="cb662-16"><a href="#cb662-16" aria-hidden="true" tabindex="-1"></a>    stat[<span class="st">&#39;varianza&#39;</span>] <span class="op">=</span> <span class="bu">sum</span>(np.square(sample))<span class="op">/</span><span class="bu">len</span>(sample)<span class="op">-</span>stat[<span class="st">&#39;media&#39;</span>]<span class="op">**</span><span class="dv">2</span></span>
<span id="cb662-17"><a href="#cb662-17" aria-hidden="true" tabindex="-1"></a>    stat[<span class="st">&#39;desviacion estandar&#39;</span>] <span class="op">=</span> stat[<span class="st">&#39;varianza&#39;</span>]<span class="op">**</span><span class="fl">0.5</span></span>
<span id="cb662-18"><a href="#cb662-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> stat</span>
<span id="cb662-19"><a href="#cb662-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb662-20"><a href="#cb662-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(statistics([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>]))</span></code></pre></div>
</div>
<div id="dividir-una-base-de-datos-por-grupos" class="section level3 hasAnchor" number="4.5.2">
<h3 class="hasAnchor"><span class="header-section-number">4.5.2</span> Dividir una base de datos por grupos<a href="#dividir-una-base-de-datos-por-grupos" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb663"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb663-1"><a href="#cb663-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(</span>
<span id="cb663-2"><a href="#cb663-2" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;https://raw.githubusercontent.com/asalber/manual-python/master/datos/colesterol.csv&#39;</span>)</span>
<span id="cb663-3"><a href="#cb663-3" aria-hidden="true" tabindex="-1"></a>df</span>
<span id="cb663-4"><a href="#cb663-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb663-5"><a href="#cb663-5" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">&#39;sexo&#39;</span>).groups</span>
<span id="cb663-6"><a href="#cb663-6" aria-hidden="true" tabindex="-1"></a><span class="co"># groups devuelve un diccionario cuyas claves categoricas y valores son indices</span></span>
<span id="cb663-7"><a href="#cb663-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb663-8"><a href="#cb663-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Si quiero obtener uno de estos grupos utilizo get_group</span></span>
<span id="cb663-9"><a href="#cb663-9" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">&#39;sexo&#39;</span>).get_group(<span class="st">&#39;M&#39;</span>)</span>
<span id="cb663-10"><a href="#cb663-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb663-11"><a href="#cb663-11" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">&#39;sexo&#39;</span>).get_group(<span class="st">&#39;H&#39;</span>)</span>
<span id="cb663-12"><a href="#cb663-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb663-13"><a href="#cb663-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Hacer esto es útil si es que quiero aplicar una función a ciertos subconjuntos de observaciones </span></span>
<span id="cb663-14"><a href="#cb663-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb663-15"><a href="#cb663-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Voy a agrupar por sexo y voy a calcular el promedio de cada variable</span></span>
<span id="cb663-16"><a href="#cb663-16" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">&#39;sexo&#39;</span>).agg(np.mean)</span>
<span id="cb663-17"><a href="#cb663-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb663-18"><a href="#cb663-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Noten que utilizamos agg. Este metodo aplica la función a todo el dataframe</span></span>
<span id="cb663-19"><a href="#cb663-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb663-20"><a href="#cb663-20" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">&#39;sexo&#39;</span>).agg(np.<span class="bu">sum</span>)</span>
<span id="cb663-21"><a href="#cb663-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb663-22"><a href="#cb663-22" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">&#39;sexo&#39;</span>).agg(np.std)</span></code></pre></div>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 4.5.2:</b> Análisis exploratorio de una base de datos</p>
<ol style="list-style-type: decimal">
<li>Importe desde su carpeta de trabajo <code>auto.csv</code>, llame a esta base de datos <code>df</code>.</li>
<li>Imprima las últimas dos filas de las primeras cinco filas de <code>df</code>.</li>
<li>¿Cuál es el auto más caro de la compañía?</li>
<li>Cree un data frame con toda la información disponible para los autos toyota.</li>
<li>¿Cuál es el número total de autos de la compañia?</li>
<li>¿Cuál es el auto más caro de cada compañia?</li>
<li>¿Cuales son las millas promedio por compañia?</li>
<li>Ordene la base de datos por precio de los autos.</li>
</ol>
</div>
<div class="sourceCode" id="cb664"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb664-1"><a href="#cb664-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Importar datos </span></span>
<span id="cb664-2"><a href="#cb664-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb664-3"><a href="#cb664-3" aria-hidden="true" tabindex="-1"></a>main <span class="op">=</span> os.getcwd()</span>
<span id="cb664-4"><a href="#cb664-4" aria-hidden="true" tabindex="-1"></a>datos <span class="op">=</span> main <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">datos&quot;</span></span>
<span id="cb664-5"><a href="#cb664-5" aria-hidden="true" tabindex="-1"></a>datos</span>
<span id="cb664-6"><a href="#cb664-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb664-7"><a href="#cb664-7" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&quot;datos</span><span class="ch">\\</span><span class="st">auto.csv&quot;</span>)</span>
<span id="cb664-8"><a href="#cb664-8" aria-hidden="true" tabindex="-1"></a>df</span>
<span id="cb664-9"><a href="#cb664-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb664-10"><a href="#cb664-10" aria-hidden="true" tabindex="-1"></a>df.tail()</span>
<span id="cb664-11"><a href="#cb664-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb664-12"><a href="#cb664-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Inspeccionar </span></span>
<span id="cb664-13"><a href="#cb664-13" aria-hidden="true" tabindex="-1"></a>df.head(<span class="dv">5</span>).tail(<span class="dv">2</span>)</span>
<span id="cb664-14"><a href="#cb664-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb664-15"><a href="#cb664-15" aria-hidden="true" tabindex="-1"></a><span class="co"># El auto más caro </span></span>
<span id="cb664-16"><a href="#cb664-16" aria-hidden="true" tabindex="-1"></a>df[[<span class="st">&#39;company&#39;</span>,<span class="st">&#39;price&#39;</span>]][df.price<span class="op">==</span>df[<span class="st">&#39;price&#39;</span>].<span class="bu">max</span>()]</span>
<span id="cb664-17"><a href="#cb664-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb664-18"><a href="#cb664-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Imprima todos los autos de toyota y su información</span></span>
<span id="cb664-19"><a href="#cb664-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb664-20"><a href="#cb664-20" aria-hidden="true" tabindex="-1"></a>toyotaDf <span class="op">=</span> df.groupby(<span class="st">&#39;company&#39;</span>).get_group(<span class="st">&#39;toyota&#39;</span>)</span>
<span id="cb664-21"><a href="#cb664-21" aria-hidden="true" tabindex="-1"></a>toyotaDf</span>
<span id="cb664-22"><a href="#cb664-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb664-23"><a href="#cb664-23" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. ¿Cuál es el número total de autos por compañia? </span></span>
<span id="cb664-24"><a href="#cb664-24" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;company&#39;</span>].value_counts()</span>
<span id="cb664-25"><a href="#cb664-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb664-26"><a href="#cb664-26" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. ¿Cuál es el auto más caro de cada compañia?</span></span>
<span id="cb664-27"><a href="#cb664-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb664-28"><a href="#cb664-28" aria-hidden="true" tabindex="-1"></a>companias <span class="op">=</span> df.groupby(<span class="st">&#39;company&#39;</span>)</span>
<span id="cb664-29"><a href="#cb664-29" aria-hidden="true" tabindex="-1"></a>precioMaxComp <span class="op">=</span> companias[<span class="st">&#39;price&#39;</span>].<span class="bu">max</span>()</span>
<span id="cb664-30"><a href="#cb664-30" aria-hidden="true" tabindex="-1"></a>precioMaxComp</span>
<span id="cb664-31"><a href="#cb664-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb664-32"><a href="#cb664-32" aria-hidden="true" tabindex="-1"></a><span class="co"># 7. Millas promedio por cada compañia </span></span>
<span id="cb664-33"><a href="#cb664-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb664-34"><a href="#cb664-34" aria-hidden="true" tabindex="-1"></a>grupo <span class="op">=</span> df.groupby(<span class="st">&#39;company&#39;</span>)</span>
<span id="cb664-35"><a href="#cb664-35" aria-hidden="true" tabindex="-1"></a>millasDF <span class="op">=</span> grupo[<span class="st">&#39;company&#39;</span>,<span class="st">&#39;average-mileage&#39;</span>].mean()</span>
<span id="cb664-36"><a href="#cb664-36" aria-hidden="true" tabindex="-1"></a>millasDF</span>
<span id="cb664-37"><a href="#cb664-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb664-38"><a href="#cb664-38" aria-hidden="true" tabindex="-1"></a><span class="co"># 8. Ordene por precio columna </span></span>
<span id="cb664-39"><a href="#cb664-39" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.sort_values(by<span class="op">=</span>[<span class="st">&#39;price&#39;</span>], ascending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb664-40"><a href="#cb664-40" aria-hidden="true" tabindex="-1"></a>df.head(<span class="dv">5</span>)</span></code></pre></div>
</div>
<div id="librería-datetime" class="section level3 hasAnchor" number="4.5.3">
<h3 class="hasAnchor"><span class="header-section-number">4.5.3</span> Librería datetime<a href="#librería-datetime" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><p>Para manejar fechas en Python se suele utilizar la librería <strong>datetime</strong></p></li>
<li><p>Esta incluye los tipos de datos date, time y datetime para representar fechas y funciones para manejarlas.</p></li>
<li><p>Algunas de las operaciones más habituales que permite son:</p></li>
<li><p>Acceder a los distintos componentes de una fecha (año, mes, día, hora, minutos, segundos y microsegundos).</p></li>
<li><p>Convertir cadenas con formato de fecha en los tipos date, time o datetime.</p></li>
<li><p>Convertir fechas de los tipos date, time o datetime en cadenas formateadas de acuerdo a diferentes formatos de fechas.</p></li>
<li><p>Hacer aritmética de fechas (sumar o restar fechas).</p></li>
<li><p>Comparar fechas.</p></li>
<li><p>Los tipos de datos date, time y datetime</p></li>
<li><p>date(año, mes, dia) : Devuelve un objeto de tipo date que representa la fecha con el año, mes y dia indicados.</p></li>
<li><p>time(hora, minutos, segundos, microsegundos) : Devuelve un objeto de tipo time que representa un tiempo la hora, minutos, segundos y microsegundos indicados.</p></li>
<li><p>datetime(año, mes, dia, hora, minutos, segundos, microsegundos) : Devuelve un objeto de tipo datetime que representa una fecha y hora con el año, mes, dia, hora, minutos, segundos y microsegundos indicados.</p></li>
</ul>
<div class="sourceCode" id="cb665"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb665-1"><a href="#cb665-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Devuelve un objeto de tipo date que representa la fecha con el año, mes y dia indicados.</span></span>
<span id="cb665-2"><a href="#cb665-2" aria-hidden="true" tabindex="-1"></a>fecha1 <span class="op">=</span> dt.date(<span class="dv">2020</span>, <span class="dv">12</span>, <span class="dv">25</span>)</span>
<span id="cb665-3"><a href="#cb665-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(fecha1)</span>
<span id="cb665-4"><a href="#cb665-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb665-5"><a href="#cb665-5" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(dt.time(<span class="dv">13</span>,<span class="dv">30</span>,<span class="dv">5</span>))</span>
<span id="cb665-6"><a href="#cb665-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb665-7"><a href="#cb665-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Devuelve un objeto de tipo time que representa un tiempo la hora, minutos, segundos y microsegundos indicados.</span></span>
<span id="cb665-8"><a href="#cb665-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb665-9"><a href="#cb665-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dt.datetime(<span class="dv">2020</span>, <span class="dv">12</span>, <span class="dv">25</span>, <span class="dv">13</span>, <span class="dv">30</span>, <span class="dv">5</span>))</span>
<span id="cb665-10"><a href="#cb665-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Representa una fecha y hora con el año, mes, dia, hora, minutos, segundos y microsegundos indicados.</span></span>
<span id="cb665-11"><a href="#cb665-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb665-12"><a href="#cb665-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Acceder a los elementos de una fecha</span></span>
<span id="cb665-13"><a href="#cb665-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dt.date.today())</span>
<span id="cb665-14"><a href="#cb665-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb665-15"><a href="#cb665-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> date, time, datetime</span>
<span id="cb665-16"><a href="#cb665-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb665-17"><a href="#cb665-17" aria-hidden="true" tabindex="-1"></a>dt.month</span>
<span id="cb665-18"><a href="#cb665-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb665-19"><a href="#cb665-19" aria-hidden="true" tabindex="-1"></a>dt.day</span>
<span id="cb665-20"><a href="#cb665-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb665-21"><a href="#cb665-21" aria-hidden="true" tabindex="-1"></a>dt.hour</span>
<span id="cb665-22"><a href="#cb665-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb665-23"><a href="#cb665-23" aria-hidden="true" tabindex="-1"></a>dt.minute</span>
<span id="cb665-24"><a href="#cb665-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb665-25"><a href="#cb665-25" aria-hidden="true" tabindex="-1"></a>dt.second</span>
<span id="cb665-26"><a href="#cb665-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb665-27"><a href="#cb665-27" aria-hidden="true" tabindex="-1"></a>dt.microsecond</span></code></pre></div>
<ul>
<li><p>Usualmente vamos a querer cambiar formato de fechas, para hacerlo ocupamos marcadores de posición:</p>
<ul>
<li>%Y (año completo),</li>
<li>%y (últimos dos dígitos del año),</li>
<li>%m (mes en número),</li>
<li>%B (mes en palabra),</li>
<li>%d (día),</li>
<li>%A (día de la semana),</li>
<li>%a (día de la semana abrevidado),</li>
<li>%H (hora en formato 24 horas),</li>
<li>%I (hora en formato 12 horas),</li>
<li>%M (minutos), %S (segundos),</li>
<li>%p (AM o PM),</li>
<li>%C (fecha y hora completas),</li>
<li>%x (fecha completa),</li>
<li>%X (hora completa).</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb666"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb666-1"><a href="#cb666-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Conversión de fechas en cadenas con diferentes formatos</span></span>
<span id="cb666-2"><a href="#cb666-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> date, time, datetime</span>
<span id="cb666-3"><a href="#cb666-3" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> datetime.now()</span>
<span id="cb666-4"><a href="#cb666-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(d.strftime(<span class="st">&#39;</span><span class="sc">%d</span><span class="st">-%m-%Y&#39;</span>))</span>
<span id="cb666-5"><a href="#cb666-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(d.strftime(<span class="st">&#39;%A, </span><span class="sc">%d</span><span class="st"> %B, %y&#39;</span>))</span>
<span id="cb666-6"><a href="#cb666-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(d.strftime(<span class="st">&#39;%H:%M:%S&#39;</span>))</span>
<span id="cb666-7"><a href="#cb666-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(d.strftime(<span class="st">&#39;%H horas, %M minutos y %S segundos&#39;</span>))</span>
<span id="cb666-8"><a href="#cb666-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb666-9"><a href="#cb666-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Función strptime(s, formato):</span></span>
<span id="cb666-10"><a href="#cb666-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(datetime.strptime(<span class="st">&#39;15/4/2020&#39;</span>, <span class="st">&#39;</span><span class="sc">%d</span><span class="st">/%m/%Y&#39;</span>))</span>
<span id="cb666-11"><a href="#cb666-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb666-12"><a href="#cb666-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(datetime.strptime(<span class="st">&#39;2020-4-15 20:50:30&#39;</span>, <span class="st">&#39;%Y-%m-</span><span class="sc">%d</span><span class="st"> %H:%M:%S&#39;</span>))</span>
<span id="cb666-13"><a href="#cb666-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb666-14"><a href="#cb666-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Para hacer aritmetica de fechas utilizar </span></span>
<span id="cb666-15"><a href="#cb666-15" aria-hidden="true" tabindex="-1"></a><span class="co"># timedelta(dias, segundos, microsegundos) : intervalo de tiempo con los dias, segundos y micorsegundos indicados.</span></span>
<span id="cb666-16"><a href="#cb666-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> date, time, datetime, timedelta</span>
<span id="cb666-17"><a href="#cb666-17" aria-hidden="true" tabindex="-1"></a>d1 <span class="op">=</span> datetime(<span class="dv">2020</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb666-18"><a href="#cb666-18" aria-hidden="true" tabindex="-1"></a>d2 <span class="op">=</span> d1 <span class="op">+</span> timedelta(<span class="dv">200000</span>, <span class="dv">3600</span>)</span>
<span id="cb666-19"><a href="#cb666-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(d2)</span>
<span id="cb666-20"><a href="#cb666-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb666-21"><a href="#cb666-21" aria-hidden="true" tabindex="-1"></a><span class="co">## Convertir una columna con to_datetime para que sea del tipo fecha</span></span>
<span id="cb666-22"><a href="#cb666-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb666-23"><a href="#cb666-23" aria-hidden="true" tabindex="-1"></a><span class="co"># to_datetime(columna, formato): devuelve la serie que resulta de convertir las cadenas de la columna con el </span></span>
<span id="cb666-24"><a href="#cb666-24" aria-hidden="true" tabindex="-1"></a><span class="co"># nombre columna en fechas del tipo datetime con el formado especificado en formato</span></span>
<span id="cb666-25"><a href="#cb666-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb666-26"><a href="#cb666-26" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({<span class="st">&#39;Name&#39;</span>: [<span class="st">&#39;María&#39;</span>, <span class="st">&#39;Carlos&#39;</span>, <span class="st">&#39;Carmen&#39;</span>], <span class="st">&#39;Nacimiento&#39;</span>:[<span class="st">&#39;05-03-2000&#39;</span>, <span class="st">&#39;20-05-2001&#39;</span>, <span class="st">&#39;10-12-1999&#39;</span>]})</span>
<span id="cb666-27"><a href="#cb666-27" aria-hidden="true" tabindex="-1"></a>df</span>
<span id="cb666-28"><a href="#cb666-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb666-29"><a href="#cb666-29" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;Nacimiento&#39;</span>]</span>
<span id="cb666-30"><a href="#cb666-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb666-31"><a href="#cb666-31" aria-hidden="true" tabindex="-1"></a>df1 <span class="op">=</span> pd.to_datetime(df.Nacimiento, <span class="bu">format</span> <span class="op">=</span> <span class="st">&#39;</span><span class="sc">%d</span><span class="st">-%m-%Y&#39;</span>)</span>
<span id="cb666-32"><a href="#cb666-32" aria-hidden="true" tabindex="-1"></a>df1</span></code></pre></div>
</div>
<div id="reestructurar-un-dataframe" class="section level3 hasAnchor" number="4.5.4">
<h3 class="hasAnchor"><span class="header-section-number">4.5.4</span> Reestructurar un DataFrame<a href="#reestructurar-un-dataframe" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Formato ancho a largo y viceversa</li>
<li>Diferencias entre ambos?</li>
</ul>
<div class="figure">
<img src="attachment:image.png" alt="" />
<p class="caption">image.png</p>
</div>
<div class="sourceCode" id="cb667"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb667-1"><a href="#cb667-1" aria-hidden="true" tabindex="-1"></a>datos <span class="op">=</span> {<span class="st">&#39;nombre&#39;</span>:[<span class="st">&#39;Pepe&#39;</span>, <span class="st">&#39;Pepa&#39;</span>, <span class="st">&#39;Nico&#39;</span>],</span>
<span id="cb667-2"><a href="#cb667-2" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;edad&#39;</span>:[<span class="dv">18</span>, <span class="dv">22</span>, <span class="dv">20</span>],</span>
<span id="cb667-3"><a href="#cb667-3" aria-hidden="true" tabindex="-1"></a> <span class="st">&#39;Matemáticas&#39;</span>:[<span class="fl">8.5</span>, <span class="dv">9</span>, <span class="fl">3.5</span>],</span>
<span id="cb667-4"><a href="#cb667-4" aria-hidden="true" tabindex="-1"></a> <span class="st">&#39;Economía&#39;</span>:[<span class="dv">8</span>, <span class="fl">8.5</span>, <span class="dv">5</span>],</span>
<span id="cb667-5"><a href="#cb667-5" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;Programación&#39;</span>:[<span class="fl">6.5</span>, <span class="fl">9.2</span>, <span class="dv">9</span>]}</span>
<span id="cb667-6"><a href="#cb667-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb667-7"><a href="#cb667-7" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(datos)</span>
<span id="cb667-8"><a href="#cb667-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb667-9"><a href="#cb667-9" aria-hidden="true" tabindex="-1"></a>df</span>
<span id="cb667-10"><a href="#cb667-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Esta en formato ancho</span></span>
<span id="cb667-11"><a href="#cb667-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb667-12"><a href="#cb667-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Para pasar a formato largo utilizo melt()</span></span>
<span id="cb667-13"><a href="#cb667-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb667-14"><a href="#cb667-14" aria-hidden="true" tabindex="-1"></a>df1 <span class="op">=</span> df.melt(id_vars<span class="op">=</span>[<span class="st">&#39;nombre&#39;</span>, <span class="st">&#39;edad&#39;</span>], </span>
<span id="cb667-15"><a href="#cb667-15" aria-hidden="true" tabindex="-1"></a>              var_name<span class="op">=</span><span class="st">&#39;asignatura&#39;</span>, </span>
<span id="cb667-16"><a href="#cb667-16" aria-hidden="true" tabindex="-1"></a>              value_name<span class="op">=</span><span class="st">&#39;nota&#39;</span>)</span>
<span id="cb667-17"><a href="#cb667-17" aria-hidden="true" tabindex="-1"></a>df1</span>
<span id="cb667-18"><a href="#cb667-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb667-19"><a href="#cb667-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Ahora pasemosla de vuelta a un formato ancho el metodo pivot()</span></span>
<span id="cb667-20"><a href="#cb667-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb667-21"><a href="#cb667-21" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> df1.pivot(index<span class="op">=</span>[<span class="st">&#39;nombre&#39;</span>, <span class="st">&#39;edad&#39;</span>],</span>
<span id="cb667-22"><a href="#cb667-22" aria-hidden="true" tabindex="-1"></a>          columns<span class="op">=</span><span class="st">&#39;asignatura&#39;</span>, </span>
<span id="cb667-23"><a href="#cb667-23" aria-hidden="true" tabindex="-1"></a>          values<span class="op">=</span> <span class="st">&quot;nota&quot;</span>)</span>
<span id="cb667-24"><a href="#cb667-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb667-25"><a href="#cb667-25" aria-hidden="true" tabindex="-1"></a>df2</span></code></pre></div>
</div>
<div id="reestructurar-datos-para-arreglar-posibles-problemas" class="section level3 hasAnchor" number="4.5.5">
<h3 class="hasAnchor"><span class="header-section-number">4.5.5</span> Reestructurar datos para arreglar posibles problemas<a href="#reestructurar-datos-para-arreglar-posibles-problemas" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="caso-1-encabezados-de-las-columnas-son-valores-y-no-nombres-de-variables" class="section level4 hasAnchor" number="4.5.5.1">
<h4 class="hasAnchor"><span class="header-section-number">4.5.5.1</span> Caso 1: encabezados de las columnas son valores y no nombres de variables<a href="#caso-1-encabezados-de-las-columnas-son-valores-y-no-nombres-de-variables" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb668"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb668-1"><a href="#cb668-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fijar directorio principal </span></span>
<span id="cb668-2"><a href="#cb668-2" aria-hidden="true" tabindex="-1"></a>main <span class="op">=</span> os.getcwd()</span>
<span id="cb668-3"><a href="#cb668-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb668-4"><a href="#cb668-4" aria-hidden="true" tabindex="-1"></a>main</span>
<span id="cb668-5"><a href="#cb668-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb668-6"><a href="#cb668-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Fijar directorios secundarios en base al principal</span></span>
<span id="cb668-7"><a href="#cb668-7" aria-hidden="true" tabindex="-1"></a>datos <span class="op">=</span> main <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">datos&quot;</span></span>
<span id="cb668-8"><a href="#cb668-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb668-9"><a href="#cb668-9" aria-hidden="true" tabindex="-1"></a>datos</span>
<span id="cb668-10"><a href="#cb668-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb668-11"><a href="#cb668-11" aria-hidden="true" tabindex="-1"></a>pew <span class="op">=</span> pd.read_csv(<span class="st">&#39;datos</span><span class="ch">\\</span><span class="st">pew-raw.csv&#39;</span>)</span>
<span id="cb668-12"><a href="#cb668-12" aria-hidden="true" tabindex="-1"></a>pew</span>
<span id="cb668-13"><a href="#cb668-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb668-14"><a href="#cb668-14" aria-hidden="true" tabindex="-1"></a>pew.head()</span></code></pre></div>
<ul>
<li>Noten que esta es una base de datos donde tenemos información en las columnas</li>
</ul>
<div class="sourceCode" id="cb669"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb669-1"><a href="#cb669-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Formato wide a formato 2 </span></span>
<span id="cb669-2"><a href="#cb669-2" aria-hidden="true" tabindex="-1"></a>pew_long <span class="op">=</span> pd.melt(pew, </span>
<span id="cb669-3"><a href="#cb669-3" aria-hidden="true" tabindex="-1"></a>                   id_vars <span class="op">=</span> <span class="st">&quot;religion&quot;</span>)</span>
<span id="cb669-4"><a href="#cb669-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb669-5"><a href="#cb669-5" aria-hidden="true" tabindex="-1"></a>pew_long.head(<span class="dv">10</span>)</span>
<span id="cb669-6"><a href="#cb669-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb669-7"><a href="#cb669-7" aria-hidden="true" tabindex="-1"></a>pew_long <span class="op">=</span> pd.melt(pew, </span>
<span id="cb669-8"><a href="#cb669-8" aria-hidden="true" tabindex="-1"></a>                   id_vars <span class="op">=</span> <span class="st">&quot;religion&quot;</span>, </span>
<span id="cb669-9"><a href="#cb669-9" aria-hidden="true" tabindex="-1"></a>                   var_name <span class="op">=</span> <span class="st">&quot;ingreso&quot;</span>)</span>
<span id="cb669-10"><a href="#cb669-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb669-11"><a href="#cb669-11" aria-hidden="true" tabindex="-1"></a>pew_long.head()</span>
<span id="cb669-12"><a href="#cb669-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb669-13"><a href="#cb669-13" aria-hidden="true" tabindex="-1"></a>pew_long <span class="op">=</span> pd.melt(pew, </span>
<span id="cb669-14"><a href="#cb669-14" aria-hidden="true" tabindex="-1"></a>                   id_vars <span class="op">=</span> <span class="st">&quot;religion&quot;</span>, </span>
<span id="cb669-15"><a href="#cb669-15" aria-hidden="true" tabindex="-1"></a>                   var_name <span class="op">=</span> <span class="st">&quot;ingreso&quot;</span>, </span>
<span id="cb669-16"><a href="#cb669-16" aria-hidden="true" tabindex="-1"></a>                   value_name <span class="op">=</span> <span class="st">&quot;Casos&quot;</span>)</span>
<span id="cb669-17"><a href="#cb669-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb669-18"><a href="#cb669-18" aria-hidden="true" tabindex="-1"></a>pew_long.head()</span>
<span id="cb669-19"><a href="#cb669-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb669-20"><a href="#cb669-20" aria-hidden="true" tabindex="-1"></a>pew</span>
<span id="cb669-21"><a href="#cb669-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb669-22"><a href="#cb669-22" aria-hidden="true" tabindex="-1"></a>billboard <span class="op">=</span> pd.read_csv(<span class="st">&quot;datos</span><span class="ch">\\</span><span class="st">billboard.csv&quot;</span>)</span>
<span id="cb669-23"><a href="#cb669-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb669-24"><a href="#cb669-24" aria-hidden="true" tabindex="-1"></a>billboard</span>
<span id="cb669-25"><a href="#cb669-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb669-26"><a href="#cb669-26" aria-hidden="true" tabindex="-1"></a>billboard_long <span class="op">=</span> pd.melt(</span>
<span id="cb669-27"><a href="#cb669-27" aria-hidden="true" tabindex="-1"></a>    billboard, </span>
<span id="cb669-28"><a href="#cb669-28" aria-hidden="true" tabindex="-1"></a>    id_vars <span class="op">=</span> [<span class="st">&quot;year&quot;</span>, <span class="st">&quot;artist&quot;</span>, <span class="st">&quot;track&quot;</span>, <span class="st">&quot;time&quot;</span>, <span class="st">&quot;date.entered&quot;</span>],</span>
<span id="cb669-29"><a href="#cb669-29" aria-hidden="true" tabindex="-1"></a>    var_name <span class="op">=</span> <span class="st">&quot;week&quot;</span>, </span>
<span id="cb669-30"><a href="#cb669-30" aria-hidden="true" tabindex="-1"></a>    value_name <span class="op">=</span> <span class="st">&quot;rating&quot;</span></span>
<span id="cb669-31"><a href="#cb669-31" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb669-32"><a href="#cb669-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb669-33"><a href="#cb669-33" aria-hidden="true" tabindex="-1"></a>billboard_long</span>
<span id="cb669-34"><a href="#cb669-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb669-35"><a href="#cb669-35" aria-hidden="true" tabindex="-1"></a>billboard.shape</span>
<span id="cb669-36"><a href="#cb669-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb669-37"><a href="#cb669-37" aria-hidden="true" tabindex="-1"></a>billboard_long.shape</span>
<span id="cb669-38"><a href="#cb669-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb669-39"><a href="#cb669-39" aria-hidden="true" tabindex="-1"></a><span class="dv">317</span><span class="op">*</span><span class="dv">76</span></span></code></pre></div>
</div>
<div id="caso-2-múltiples-tipos-de-datos-en-una-misma-columna" class="section level4 hasAnchor" number="4.5.5.2">
<h4 class="hasAnchor"><span class="header-section-number">4.5.5.2</span> Caso 2: múltiples tipos de datos en una misma columna<a href="#caso-2-múltiples-tipos-de-datos-en-una-misma-columna" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb670"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb670-1"><a href="#cb670-1" aria-hidden="true" tabindex="-1"></a>ebola <span class="op">=</span> pd.read_csv(<span class="st">&quot;datos</span><span class="ch">\\</span><span class="st">country_timeseries.csv&quot;</span>)</span>
<span id="cb670-2"><a href="#cb670-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb670-3"><a href="#cb670-3" aria-hidden="true" tabindex="-1"></a>ebola.head()</span>
<span id="cb670-4"><a href="#cb670-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb670-5"><a href="#cb670-5" aria-hidden="true" tabindex="-1"></a>ebola_long <span class="op">=</span> pd.melt(ebola, </span>
<span id="cb670-6"><a href="#cb670-6" aria-hidden="true" tabindex="-1"></a>                     id_vars <span class="op">=</span> [<span class="st">&quot;Date&quot;</span>, <span class="st">&quot;Day&quot;</span>])</span>
<span id="cb670-7"><a href="#cb670-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb670-8"><a href="#cb670-8" aria-hidden="true" tabindex="-1"></a>ebola_long</span>
<span id="cb670-9"><a href="#cb670-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb670-10"><a href="#cb670-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Vamos a quitar &quot;Cases&quot; en variables</span></span>
<span id="cb670-11"><a href="#cb670-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb670-12"><a href="#cb670-12" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;cases_Guinea&quot;</span>.split(<span class="st">&quot;_&quot;</span>)</span>
<span id="cb670-13"><a href="#cb670-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb670-14"><a href="#cb670-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Columna + tipo de acceso + metodo</span></span>
<span id="cb670-15"><a href="#cb670-15" aria-hidden="true" tabindex="-1"></a>variable_split <span class="op">=</span> ebola_long[<span class="st">&quot;variable&quot;</span>].<span class="bu">str</span>.split(<span class="st">&quot;_&quot;</span>)</span>
<span id="cb670-16"><a href="#cb670-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb670-17"><a href="#cb670-17" aria-hidden="true" tabindex="-1"></a>variable_split</span>
<span id="cb670-18"><a href="#cb670-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb670-19"><a href="#cb670-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Veamos que tiene por partes </span></span>
<span id="cb670-20"><a href="#cb670-20" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(variable_split)</span>
<span id="cb670-21"><a href="#cb670-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb670-22"><a href="#cb670-22" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(variable_split[<span class="dv">0</span>])</span>
<span id="cb670-23"><a href="#cb670-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb670-24"><a href="#cb670-24" aria-hidden="true" tabindex="-1"></a>variable_split[<span class="dv">0</span>][<span class="dv">1</span>]</span>
<span id="cb670-25"><a href="#cb670-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb670-26"><a href="#cb670-26" aria-hidden="true" tabindex="-1"></a>variable_split.<span class="bu">str</span>.get(<span class="dv">0</span>)</span>
<span id="cb670-27"><a href="#cb670-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb670-28"><a href="#cb670-28" aria-hidden="true" tabindex="-1"></a>variable_split.<span class="bu">str</span>.get(<span class="dv">1</span>)</span>
<span id="cb670-29"><a href="#cb670-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb670-30"><a href="#cb670-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Ahora vamos a utilizar estos dos para actualizar base de datos </span></span>
<span id="cb670-31"><a href="#cb670-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb670-32"><a href="#cb670-32" aria-hidden="true" tabindex="-1"></a>ebola_long[<span class="st">&quot;stats&quot;</span>] <span class="op">=</span> variable_split.<span class="bu">str</span>.get(<span class="dv">0</span>)</span>
<span id="cb670-33"><a href="#cb670-33" aria-hidden="true" tabindex="-1"></a>ebola_long[<span class="st">&quot;country&quot;</span>] <span class="op">=</span> variable_split.<span class="bu">str</span>.get(<span class="dv">1</span>)</span>
<span id="cb670-34"><a href="#cb670-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb670-35"><a href="#cb670-35" aria-hidden="true" tabindex="-1"></a>ebola_long</span>
<span id="cb670-36"><a href="#cb670-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb670-37"><a href="#cb670-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Otra forma de hacer lo anterior</span></span>
<span id="cb670-38"><a href="#cb670-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb670-39"><a href="#cb670-39" aria-hidden="true" tabindex="-1"></a>ebola_long[[<span class="st">&quot;stats_e&quot;</span>, <span class="st">&quot;country_e&quot;</span>]] <span class="op">=</span> (ebola_long[<span class="st">&quot;variable&quot;</span>].<span class="bu">str</span>.split(<span class="st">&quot;_&quot;</span>, expand <span class="op">=</span> <span class="va">True</span>))</span>
<span id="cb670-40"><a href="#cb670-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb670-41"><a href="#cb670-41" aria-hidden="true" tabindex="-1"></a>ebola_long</span></code></pre></div>
</div>
<div id="caso-3-multiples-variables-guardadas-en-una-columna" class="section level4 hasAnchor" number="4.5.5.3">
<h4 class="hasAnchor"><span class="header-section-number">4.5.5.3</span> Caso 3: Multiples variables guardadas en una columna<a href="#caso-3-multiples-variables-guardadas-en-una-columna" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>A few notes on the raw data set:</p>
<ul>
<li>The columns starting with “m” or “f” contain multiple variables:
<ul>
<li>Sex (“m” or “f”)</li>
<li>Age Group (“0-14”,“15-24”, “25-34”, “45-54”, “55-64”, “65”, “unknown”)</li>
</ul></li>
<li>Mixture of 0s and missing values(“NaN”). This is due to the data collection process and the distinction is important for this dataset.</li>
</ul>
<div class="sourceCode" id="cb671"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb671-1"><a href="#cb671-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&quot;datos</span><span class="ch">\\</span><span class="st">tb-raw.csv&quot;</span>)</span>
<span id="cb671-2"><a href="#cb671-2" aria-hidden="true" tabindex="-1"></a>df</span>
<span id="cb671-3"><a href="#cb671-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb671-4"><a href="#cb671-4" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.melt(df, id_vars<span class="op">=</span>[<span class="st">&quot;country&quot;</span>,<span class="st">&quot;year&quot;</span>], value_name<span class="op">=</span><span class="st">&quot;cases&quot;</span>, var_name<span class="op">=</span><span class="st">&quot;sex_and_age&quot;</span>)</span>
<span id="cb671-5"><a href="#cb671-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb671-6"><a href="#cb671-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract Sex, Age lower bound and Age upper bound group</span></span>
<span id="cb671-7"><a href="#cb671-7" aria-hidden="true" tabindex="-1"></a>tmp_df <span class="op">=</span> df[<span class="st">&quot;sex_and_age&quot;</span>].<span class="bu">str</span>.extract(<span class="st">&quot;(\D)(\d+)(\d</span><span class="sc">{2}</span><span class="st">)&quot;</span>, expand<span class="op">=</span><span class="va">False</span>)    </span>
<span id="cb671-8"><a href="#cb671-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb671-9"><a href="#cb671-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Name columns</span></span>
<span id="cb671-10"><a href="#cb671-10" aria-hidden="true" tabindex="-1"></a>tmp_df.columns <span class="op">=</span> [<span class="st">&quot;sex&quot;</span>, <span class="st">&quot;age_lower&quot;</span>, <span class="st">&quot;age_upper&quot;</span>]</span>
<span id="cb671-11"><a href="#cb671-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb671-12"><a href="#cb671-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Create `age`column based on `age_lower` and `age_upper`</span></span>
<span id="cb671-13"><a href="#cb671-13" aria-hidden="true" tabindex="-1"></a>tmp_df[<span class="st">&quot;age&quot;</span>] <span class="op">=</span> tmp_df[<span class="st">&quot;age_lower&quot;</span>] <span class="op">+</span> <span class="st">&quot;-&quot;</span> <span class="op">+</span> tmp_df[<span class="st">&quot;age_upper&quot;</span>]</span>
<span id="cb671-14"><a href="#cb671-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb671-15"><a href="#cb671-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge </span></span>
<span id="cb671-16"><a href="#cb671-16" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.concat([df, tmp_df], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb671-17"><a href="#cb671-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb671-18"><a href="#cb671-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop unnecessary columns and rows</span></span>
<span id="cb671-19"><a href="#cb671-19" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop([<span class="st">&#39;sex_and_age&#39;</span>,<span class="st">&quot;age_lower&quot;</span>,<span class="st">&quot;age_upper&quot;</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb671-20"><a href="#cb671-20" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.dropna()</span>
<span id="cb671-21"><a href="#cb671-21" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.sort_values(ascending<span class="op">=</span><span class="va">True</span>,by<span class="op">=</span>[<span class="st">&quot;country&quot;</span>, <span class="st">&quot;year&quot;</span>, <span class="st">&quot;sex&quot;</span>, <span class="st">&quot;age&quot;</span>])</span>
<span id="cb671-22"><a href="#cb671-22" aria-hidden="true" tabindex="-1"></a>df.head(<span class="dv">10</span>)</span></code></pre></div>
</div>
<div id="caso-4-variables-guardadas-en-filas-y-columnas" class="section level4 hasAnchor" number="4.5.5.4">
<h4 class="hasAnchor"><span class="header-section-number">4.5.5.4</span> Caso 4: Variables guardadas en filas y columnas<a href="#caso-4-variables-guardadas-en-filas-y-columnas" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb672"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb672-1"><a href="#cb672-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Variables guradads en filas y columnas </span></span>
<span id="cb672-2"><a href="#cb672-2" aria-hidden="true" tabindex="-1"></a>weather <span class="op">=</span> pd.read_csv(<span class="st">&quot;datos</span><span class="ch">\\</span><span class="st">weather.csv&quot;</span>)</span>
<span id="cb672-3"><a href="#cb672-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb672-4"><a href="#cb672-4" aria-hidden="true" tabindex="-1"></a>weather</span>
<span id="cb672-5"><a href="#cb672-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb672-6"><a href="#cb672-6" aria-hidden="true" tabindex="-1"></a>weather_melt <span class="op">=</span> pd.melt(</span>
<span id="cb672-7"><a href="#cb672-7" aria-hidden="true" tabindex="-1"></a>        weather, </span>
<span id="cb672-8"><a href="#cb672-8" aria-hidden="true" tabindex="-1"></a>        id_vars <span class="op">=</span> [<span class="st">&quot;id&quot;</span>, <span class="st">&quot;year&quot;</span>, <span class="st">&quot;month&quot;</span>, <span class="st">&quot;element&quot;</span>], </span>
<span id="cb672-9"><a href="#cb672-9" aria-hidden="true" tabindex="-1"></a>        var_name <span class="op">=</span> <span class="st">&quot;day&quot;</span>,</span>
<span id="cb672-10"><a href="#cb672-10" aria-hidden="true" tabindex="-1"></a>        value_name <span class="op">=</span> <span class="st">&quot;temp&quot;</span></span>
<span id="cb672-11"><a href="#cb672-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb672-12"><a href="#cb672-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb672-13"><a href="#cb672-13" aria-hidden="true" tabindex="-1"></a>weather_melt</span>
<span id="cb672-14"><a href="#cb672-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb672-15"><a href="#cb672-15" aria-hidden="true" tabindex="-1"></a>weather_tidy <span class="op">=</span> weather_melt.pivot_table(</span>
<span id="cb672-16"><a href="#cb672-16" aria-hidden="true" tabindex="-1"></a>    index <span class="op">=</span> [<span class="st">&quot;id&quot;</span>, <span class="st">&quot;year&quot;</span>, <span class="st">&quot;month&quot;</span>, <span class="st">&quot;day&quot;</span>], </span>
<span id="cb672-17"><a href="#cb672-17" aria-hidden="true" tabindex="-1"></a>    columns <span class="op">=</span> <span class="st">&quot;element&quot;</span>, </span>
<span id="cb672-18"><a href="#cb672-18" aria-hidden="true" tabindex="-1"></a>    values <span class="op">=</span> <span class="st">&quot;temp&quot;</span></span>
<span id="cb672-19"><a href="#cb672-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb672-20"><a href="#cb672-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb672-21"><a href="#cb672-21" aria-hidden="true" tabindex="-1"></a>weather_tidy</span>
<span id="cb672-22"><a href="#cb672-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Nos permite ver la jerarquí ad elos datos que tenemos</span></span>
<span id="cb672-23"><a href="#cb672-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb672-24"><a href="#cb672-24" aria-hidden="true" tabindex="-1"></a>weather_tidy.reset_index()</span></code></pre></div>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 4.5.3:</b> Reestructurar datos</p>
<ul>
<li>Cree una base de datos llamada <code>productos</code> con la siguiente información</li>
</ul>
<table>
<thead>
<tr class="header">
<th>categoría</th>
<th>tienda</th>
<th>precio</th>
<th>puntaje</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Limpieza</td>
<td>Walmart</td>
<td>1132</td>
<td>4</td>
</tr>
<tr class="even">
<td>Limpieza</td>
<td>Dia</td>
<td>2350</td>
<td>3</td>
</tr>
<tr class="odd">
<td>Entretenimiento</td>
<td>Walmart</td>
<td>1999</td>
<td>5</td>
</tr>
<tr class="even">
<td>Entretenimiento</td>
<td>Fnac</td>
<td>1595</td>
<td>7</td>
</tr>
<tr class="odd">
<td>Tecnología</td>
<td>Dia</td>
<td>5575</td>
<td>5</td>
</tr>
<tr class="even">
<td>Tecnología</td>
<td>Walmart</td>
<td>11134</td>
<td>8</td>
</tr>
</tbody>
</table>
<ul>
<li>Transforme la base de datos de formato largo a formato ancho.</li>
</ul>
</div>
<div class="sourceCode" id="cb673"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb673-1"><a href="#cb673-1" aria-hidden="true" tabindex="-1"></a>productos <span class="op">=</span> pd.DataFrame({<span class="st">&#39;categoria&#39;</span>: [<span class="st">&#39;Cleaning&#39;</span>, <span class="st">&#39;Cleaning&#39;</span>, <span class="st">&#39;Entertainment&#39;</span>, <span class="st">&#39;Entertainment&#39;</span>, <span class="st">&#39;Tech&#39;</span>, <span class="st">&#39;Tech&#39;</span>],</span>
<span id="cb673-2"><a href="#cb673-2" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;tienda&#39;</span>: [<span class="st">&#39;Walmart&#39;</span>, <span class="st">&#39;Dia&#39;</span>, <span class="st">&#39;Walmart&#39;</span>, <span class="st">&#39;Fnac&#39;</span>, <span class="st">&#39;Dia&#39;</span>,<span class="st">&#39;Walmart&#39;</span>],</span>
<span id="cb673-3"><a href="#cb673-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;precio&#39;</span>:[<span class="dv">1142</span>, <span class="dv">2350</span>, <span class="dv">1999</span>, <span class="dv">1595</span>, <span class="dv">5575</span>, <span class="dv">11134</span>],</span>
<span id="cb673-4"><a href="#cb673-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;puntaje&#39;</span>: [<span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">5</span>, <span class="dv">8</span>]})</span>
<span id="cb673-5"><a href="#cb673-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb673-6"><a href="#cb673-6" aria-hidden="true" tabindex="-1"></a>productos</span>
<span id="cb673-7"><a href="#cb673-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb673-8"><a href="#cb673-8" aria-hidden="true" tabindex="-1"></a>productos_ancho <span class="op">=</span> productos.pivot(index <span class="op">=</span> <span class="st">&quot;categoria&quot;</span>, </span>
<span id="cb673-9"><a href="#cb673-9" aria-hidden="true" tabindex="-1"></a>                                  columns <span class="op">=</span> <span class="st">&quot;tienda&quot;</span>, </span>
<span id="cb673-10"><a href="#cb673-10" aria-hidden="true" tabindex="-1"></a>                                  values <span class="op">=</span> <span class="st">&quot;precio&quot;</span>)</span>
<span id="cb673-11"><a href="#cb673-11" aria-hidden="true" tabindex="-1"></a>productos_ancho</span></code></pre></div>
</div>
</div>
<div id="missing-values-2" class="section level3 hasAnchor" number="4.5.6">
<h3 class="hasAnchor"><span class="header-section-number">4.5.6</span> Missing values<a href="#missing-values-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Datos del mundo real rara vez son homogeneos.</li>
<li>Muchos valores no van a encontrarse por múltiples razones.</li>
<li>Vamos a discutir un poco sobre este tipo de valores en la librería de pandas.</li>
<li>NaN puede utilizarse como valor numérico en operaciones matemáticas, mientras que None no puede</li>
<li>NaN es un valor numérico flotantes None es un tipo interno de Python ( NoneType ) y sería más como “inexistente” o “vacío” que “numéricamente inválido” en este contexto.</li>
</ul>
<div id="realidad-cuando-importamos-datos" class="section level4 hasAnchor" number="4.5.6.1">
<h4 class="hasAnchor"><span class="header-section-number">4.5.6.1</span> Realidad cuando importamos datos<a href="#realidad-cuando-importamos-datos" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb674"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb674-1"><a href="#cb674-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&#39;datos//survey_visited.csv&#39;</span>)</span>
<span id="cb674-2"><a href="#cb674-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb674-3"><a href="#cb674-3" aria-hidden="true" tabindex="-1"></a>pd.read_csv(<span class="st">&#39;datos//survey_visited.csv&#39;</span>, keep_default_na<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb674-4"><a href="#cb674-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb674-5"><a href="#cb674-5" aria-hidden="true" tabindex="-1"></a>pd.read_csv(<span class="st">&#39;datos//survey_visited.csv&#39;</span>, </span>
<span id="cb674-6"><a href="#cb674-6" aria-hidden="true" tabindex="-1"></a>            na_values<span class="op">=</span>[<span class="dv">619</span>, <span class="dv">622</span>])</span></code></pre></div>
</div>
<div id="dos-funciones-claves" class="section level4 hasAnchor" number="4.5.6.2">
<h4 class="hasAnchor"><span class="header-section-number">4.5.6.2</span> Dos funciones claves<a href="#dos-funciones-claves" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb675"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb675-1"><a href="#cb675-1" aria-hidden="true" tabindex="-1"></a>df</span>
<span id="cb675-2"><a href="#cb675-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb675-3"><a href="#cb675-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Funciones is.na() y notna()</span></span>
<span id="cb675-4"><a href="#cb675-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb675-5"><a href="#cb675-5" aria-hidden="true" tabindex="-1"></a>pd.isna(df[<span class="st">&quot;dated&quot;</span>])</span>
<span id="cb675-6"><a href="#cb675-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb675-7"><a href="#cb675-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Resultado: valor booleano donde me indica que valores son na</span></span>
<span id="cb675-8"><a href="#cb675-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb675-9"><a href="#cb675-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Toda la base de datos </span></span>
<span id="cb675-10"><a href="#cb675-10" aria-hidden="true" tabindex="-1"></a>pd.isna(df)</span>
<span id="cb675-11"><a href="#cb675-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb675-12"><a href="#cb675-12" aria-hidden="true" tabindex="-1"></a>pd.notna(df[<span class="st">&quot;dated&quot;</span>])</span>
<span id="cb675-13"><a href="#cb675-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb675-14"><a href="#cb675-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Resultado: inverso de lo anterior</span></span>
<span id="cb675-15"><a href="#cb675-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb675-16"><a href="#cb675-16" aria-hidden="true" tabindex="-1"></a>pd.notna(df)</span>
<span id="cb675-17"><a href="#cb675-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb675-18"><a href="#cb675-18" aria-hidden="true" tabindex="-1"></a>df.notna()</span>
<span id="cb675-19"><a href="#cb675-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb675-20"><a href="#cb675-20" aria-hidden="true" tabindex="-1"></a>df.isna()</span></code></pre></div>
</div>
<div id="calculos-con-missing-values" class="section level4 hasAnchor" number="4.5.6.3">
<h4 class="hasAnchor"><span class="header-section-number">4.5.6.3</span> Calculos con missing values<a href="#calculos-con-missing-values" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb676"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb676-1"><a href="#cb676-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> pd.DataFrame({<span class="st">&quot;one&quot;</span>: [<span class="va">None</span>, <span class="va">None</span>, <span class="fl">0.11</span>, <span class="op">-</span><span class="fl">2.1</span>, <span class="op">-</span><span class="fl">2.2</span>], </span>
<span id="cb676-2"><a href="#cb676-2" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;two&quot;</span>:[<span class="dv">32</span>, <span class="dv">4</span>, <span class="fl">0.11</span>, <span class="op">-</span><span class="fl">2.1</span>, <span class="op">-</span><span class="fl">2.2</span>] })</span>
<span id="cb676-3"><a href="#cb676-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb676-4"><a href="#cb676-4" aria-hidden="true" tabindex="-1"></a>a</span>
<span id="cb676-5"><a href="#cb676-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb676-6"><a href="#cb676-6" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> pd.DataFrame({<span class="st">&quot;one&quot;</span>: [<span class="va">None</span>, <span class="va">None</span>, <span class="fl">0.11</span>, <span class="op">-</span><span class="fl">2.1</span>, <span class="va">None</span>], </span>
<span id="cb676-7"><a href="#cb676-7" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;two&quot;</span>:[<span class="dv">32</span>, <span class="dv">4</span>, <span class="fl">0.11</span>, <span class="va">None</span>, <span class="op">-</span><span class="fl">2.2</span>], </span>
<span id="cb676-8"><a href="#cb676-8" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;three&quot;</span>:[<span class="dv">322</span>, <span class="dv">43</span>, <span class="fl">1.3</span>, <span class="fl">2.1</span>, <span class="fl">2.2</span>]})</span>
<span id="cb676-9"><a href="#cb676-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb676-10"><a href="#cb676-10" aria-hidden="true" tabindex="-1"></a>b</span>
<span id="cb676-11"><a href="#cb676-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb676-12"><a href="#cb676-12" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> a <span class="op">+</span> b</span>
<span id="cb676-13"><a href="#cb676-13" aria-hidden="true" tabindex="-1"></a>c</span></code></pre></div>
<ul>
<li>Entre objetos los <strong>missing values</strong> se traspasan. No se tratan como un cero.</li>
</ul>
<div class="sourceCode" id="cb677"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb677-1"><a href="#cb677-1" aria-hidden="true" tabindex="-1"></a>a</span>
<span id="cb677-2"><a href="#cb677-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb677-3"><a href="#cb677-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ¿Qué ocurre cuando queremos hacer estadistica descriptiva? </span></span>
<span id="cb677-4"><a href="#cb677-4" aria-hidden="true" tabindex="-1"></a>a[<span class="st">&quot;one&quot;</span>].<span class="bu">sum</span>()</span>
<span id="cb677-5"><a href="#cb677-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Cuando sumamos todos los valores son tratados como ceros.</span></span>
<span id="cb677-6"><a href="#cb677-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb677-7"><a href="#cb677-7" aria-hidden="true" tabindex="-1"></a>c</span>
<span id="cb677-8"><a href="#cb677-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb677-9"><a href="#cb677-9" aria-hidden="true" tabindex="-1"></a>c[<span class="st">&quot;three&quot;</span>].<span class="bu">sum</span>()</span>
<span id="cb677-10"><a href="#cb677-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb677-11"><a href="#cb677-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Si todos los valors son NA la suma será cero.</span></span>
<span id="cb677-12"><a href="#cb677-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb677-13"><a href="#cb677-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Otros tipos de funciones, por ejemplo, cumsum() ignoar NA por defecto, </span></span>
<span id="cb677-14"><a href="#cb677-14" aria-hidden="true" tabindex="-1"></a><span class="co"># pero los preservan en los resultados </span></span>
<span id="cb677-15"><a href="#cb677-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb677-16"><a href="#cb677-16" aria-hidden="true" tabindex="-1"></a>a</span>
<span id="cb677-17"><a href="#cb677-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb677-18"><a href="#cb677-18" aria-hidden="true" tabindex="-1"></a>a.cumsum()</span>
<span id="cb677-19"><a href="#cb677-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb677-20"><a href="#cb677-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Si quiero incorporar el hecho de que existen missing values, ocupo la opción skipna = False</span></span>
<span id="cb677-21"><a href="#cb677-21" aria-hidden="true" tabindex="-1"></a>a.cumsum(skipna <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb677-22"><a href="#cb677-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb677-23"><a href="#cb677-23" aria-hidden="true" tabindex="-1"></a>a</span></code></pre></div>
</div>
<div id="qué-hacer-con-los-missing-values" class="section level4 hasAnchor" number="4.5.6.4">
<h4 class="hasAnchor"><span class="header-section-number">4.5.6.4</span> ¿Qué hacer con los missing values?<a href="#qué-hacer-con-los-missing-values" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb678"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb678-1"><a href="#cb678-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&#39;datos//banglore.csv&#39;</span>)</span>
<span id="cb678-2"><a href="#cb678-2" aria-hidden="true" tabindex="-1"></a>df.head(<span class="dv">10</span>)</span>
<span id="cb678-3"><a href="#cb678-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb678-4"><a href="#cb678-4" aria-hidden="true" tabindex="-1"></a>df.shape</span>
<span id="cb678-5"><a href="#cb678-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb678-6"><a href="#cb678-6" aria-hidden="true" tabindex="-1"></a>df.isnull().head(<span class="dv">10</span>)</span>
<span id="cb678-7"><a href="#cb678-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Verdadero: significa NaN</span></span>
<span id="cb678-8"><a href="#cb678-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb678-9"><a href="#cb678-9" aria-hidden="true" tabindex="-1"></a>df.isnull?</span>
<span id="cb678-10"><a href="#cb678-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb678-11"><a href="#cb678-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Ahora vamos a sumar los missing values por columna</span></span>
<span id="cb678-12"><a href="#cb678-12" aria-hidden="true" tabindex="-1"></a>df.isna().<span class="bu">sum</span>()</span>
<span id="cb678-13"><a href="#cb678-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb678-14"><a href="#cb678-14" aria-hidden="true" tabindex="-1"></a><span class="dv">5502</span><span class="op">/</span><span class="dv">13320</span></span>
<span id="cb678-15"><a href="#cb678-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb678-16"><a href="#cb678-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Contamos el total</span></span>
<span id="cb678-17"><a href="#cb678-17" aria-hidden="true" tabindex="-1"></a>df.isnull().<span class="bu">sum</span>().<span class="bu">sum</span>()</span></code></pre></div>
</div>
<div id="fillna" class="section level4 hasAnchor" number="4.5.6.5">
<h4 class="hasAnchor"><span class="header-section-number">4.5.6.5</span> fillna()<a href="#fillna" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb679"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb679-1"><a href="#cb679-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Vamos a remplazar los valores missing por alguno arbitrario</span></span>
<span id="cb679-2"><a href="#cb679-2" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> df.fillna(value <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb679-3"><a href="#cb679-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb679-4"><a href="#cb679-4" aria-hidden="true" tabindex="-1"></a>df.head(<span class="dv">10</span>)</span>
<span id="cb679-5"><a href="#cb679-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb679-6"><a href="#cb679-6" aria-hidden="true" tabindex="-1"></a>df2.head(<span class="dv">10</span>)</span>
<span id="cb679-7"><a href="#cb679-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb679-8"><a href="#cb679-8" aria-hidden="true" tabindex="-1"></a>df2.isnull().<span class="bu">sum</span>().<span class="bu">sum</span>()</span>
<span id="cb679-9"><a href="#cb679-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb679-10"><a href="#cb679-10" aria-hidden="true" tabindex="-1"></a>df3 <span class="op">=</span> df.fillna(value <span class="op">=</span> <span class="dv">5</span>)</span>
<span id="cb679-11"><a href="#cb679-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb679-12"><a href="#cb679-12" aria-hidden="true" tabindex="-1"></a>df3.isnull().<span class="bu">sum</span>().<span class="bu">sum</span>()</span>
<span id="cb679-13"><a href="#cb679-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb679-14"><a href="#cb679-14" aria-hidden="true" tabindex="-1"></a>df.head(<span class="dv">10</span>)</span>
<span id="cb679-15"><a href="#cb679-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb679-16"><a href="#cb679-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Llenar valores con alguno previo</span></span>
<span id="cb679-17"><a href="#cb679-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb679-18"><a href="#cb679-18" aria-hidden="true" tabindex="-1"></a>df4 <span class="op">=</span> df.fillna(method <span class="op">=</span> <span class="st">&quot;pad&quot;</span>)</span>
<span id="cb679-19"><a href="#cb679-19" aria-hidden="true" tabindex="-1"></a>df4.head(<span class="dv">10</span>)</span>
<span id="cb679-20"><a href="#cb679-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb679-21"><a href="#cb679-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Llenar valores con algun valor posterior</span></span>
<span id="cb679-22"><a href="#cb679-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb679-23"><a href="#cb679-23" aria-hidden="true" tabindex="-1"></a>df5 <span class="op">=</span> df.fillna(method <span class="op">=</span> <span class="st">&quot;bfill&quot;</span>)</span>
<span id="cb679-24"><a href="#cb679-24" aria-hidden="true" tabindex="-1"></a>df5.head(<span class="dv">10</span>)</span>
<span id="cb679-25"><a href="#cb679-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb679-26"><a href="#cb679-26" aria-hidden="true" tabindex="-1"></a>df.head(<span class="dv">10</span>)</span>
<span id="cb679-27"><a href="#cb679-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb679-28"><a href="#cb679-28" aria-hidden="true" tabindex="-1"></a>df6 <span class="op">=</span> df.fillna(method <span class="op">=</span> <span class="st">&quot;pad&quot;</span>, axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb679-29"><a href="#cb679-29" aria-hidden="true" tabindex="-1"></a>df6.head(<span class="dv">10</span>)</span>
<span id="cb679-30"><a href="#cb679-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb679-31"><a href="#cb679-31" aria-hidden="true" tabindex="-1"></a>df7 <span class="op">=</span> df.fillna(method <span class="op">=</span> <span class="st">&quot;bfill&quot;</span>, axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb679-32"><a href="#cb679-32" aria-hidden="true" tabindex="-1"></a>df7.head(<span class="dv">10</span>)</span>
<span id="cb679-33"><a href="#cb679-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb679-34"><a href="#cb679-34" aria-hidden="true" tabindex="-1"></a>df.head(<span class="dv">10</span>)</span>
<span id="cb679-35"><a href="#cb679-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb679-36"><a href="#cb679-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Llenar diferentes valores en diferentes columnas</span></span>
<span id="cb679-37"><a href="#cb679-37" aria-hidden="true" tabindex="-1"></a>df8 <span class="op">=</span> df.fillna({<span class="st">&quot;society&quot;</span>:<span class="st">&quot;abc&quot;</span>, </span>
<span id="cb679-38"><a href="#cb679-38" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&quot;balcony&quot;</span>: <span class="st">&quot;defg&quot;</span>})</span>
<span id="cb679-39"><a href="#cb679-39" aria-hidden="true" tabindex="-1"></a>df8.tail(<span class="dv">10</span>)</span>
<span id="cb679-40"><a href="#cb679-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb679-41"><a href="#cb679-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Ahora vamos a completarlo con el promedio de la columna </span></span>
<span id="cb679-42"><a href="#cb679-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb679-43"><a href="#cb679-43" aria-hidden="true" tabindex="-1"></a>df9 <span class="op">=</span> df.fillna(value <span class="op">=</span> df[<span class="st">&quot;balcony&quot;</span>].mean())</span>
<span id="cb679-44"><a href="#cb679-44" aria-hidden="true" tabindex="-1"></a>df9.head(<span class="dv">10</span>)</span>
<span id="cb679-45"><a href="#cb679-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb679-46"><a href="#cb679-46" aria-hidden="true" tabindex="-1"></a><span class="co"># alternativamente podemos ocupar max() o min()</span></span></code></pre></div>
</div>
<div id="drop-na" class="section level4 hasAnchor" number="4.5.6.6">
<h4 class="hasAnchor"><span class="header-section-number">4.5.6.6</span> Drop na ()<a href="#drop-na" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb680"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb680-1"><a href="#cb680-1" aria-hidden="true" tabindex="-1"></a>df</span>
<span id="cb680-2"><a href="#cb680-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb680-3"><a href="#cb680-3" aria-hidden="true" tabindex="-1"></a>df10 <span class="op">=</span> df.dropna()</span>
<span id="cb680-4"><a href="#cb680-4" aria-hidden="true" tabindex="-1"></a>df10</span>
<span id="cb680-5"><a href="#cb680-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb680-6"><a href="#cb680-6" aria-hidden="true" tabindex="-1"></a>df11 <span class="op">=</span> df.dropna(how <span class="op">=</span> <span class="st">&quot;all&quot;</span>)</span>
<span id="cb680-7"><a href="#cb680-7" aria-hidden="true" tabindex="-1"></a>df11.shape</span>
<span id="cb680-8"><a href="#cb680-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb680-9"><a href="#cb680-9" aria-hidden="true" tabindex="-1"></a>df11a <span class="op">=</span> df.dropna(how <span class="op">=</span> <span class="st">&quot;any&quot;</span>)</span>
<span id="cb680-10"><a href="#cb680-10" aria-hidden="true" tabindex="-1"></a>df11a.shape</span></code></pre></div>
</div>
<div id="replace" class="section level4 hasAnchor" number="4.5.6.7">
<h4 class="hasAnchor"><span class="header-section-number">4.5.6.7</span> replace ()<a href="#replace" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb681"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb681-1"><a href="#cb681-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remplaza cualquier valor</span></span>
<span id="cb681-2"><a href="#cb681-2" aria-hidden="true" tabindex="-1"></a>df12 <span class="op">=</span> df.replace(to_replace <span class="op">=</span> np.nan, value <span class="op">=</span> <span class="dv">343434</span>)</span>
<span id="cb681-3"><a href="#cb681-3" aria-hidden="true" tabindex="-1"></a>df12</span>
<span id="cb681-4"><a href="#cb681-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb681-5"><a href="#cb681-5" aria-hidden="true" tabindex="-1"></a>df13 <span class="op">=</span> df.replace(to_replace <span class="op">=</span> <span class="fl">3.0</span>, value <span class="op">=</span> <span class="dv">343434</span>)</span>
<span id="cb681-6"><a href="#cb681-6" aria-hidden="true" tabindex="-1"></a>df13</span></code></pre></div>
</div>
<div id="interpolate" class="section level4 hasAnchor" number="4.5.6.8">
<h4 class="hasAnchor"><span class="header-section-number">4.5.6.8</span> interpolate()<a href="#interpolate" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>Cambia por el promedio de una lista ordenada</li>
</ul>
<div class="sourceCode" id="cb682"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb682-1"><a href="#cb682-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;balcony&quot;</span>] <span class="op">=</span> df[<span class="st">&quot;balcony&quot;</span>].interpolate(method <span class="op">=</span> <span class="st">&quot;linear&quot;</span>)</span>
<span id="cb682-2"><a href="#cb682-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb682-3"><a href="#cb682-3" aria-hidden="true" tabindex="-1"></a>df.head(<span class="dv">10</span>)</span></code></pre></div>
</div>
</div>
<div id="juntar-bases-de-datos-merge-y-append" class="section level3 hasAnchor" number="4.5.7">
<h3 class="hasAnchor"><span class="header-section-number">4.5.7</span> Juntar bases de datos: merge y append<a href="#juntar-bases-de-datos-merge-y-append" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="figure">
<img src="attachment:image.png" alt="" />
<p class="caption">image.png</p>
</div>
<div class="figure">
<img src="attachment:image.png" alt="" />
<p class="caption">image.png</p>
</div>
<div id="ejemplo-1-juntar-por-filas-append" class="section level4 hasAnchor" number="4.5.7.1">
<h4 class="hasAnchor"><span class="header-section-number">4.5.7.1</span> Ejemplo 1: Juntar por filas (append)<a href="#ejemplo-1-juntar-por-filas-append" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb683"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb683-1"><a href="#cb683-1" aria-hidden="true" tabindex="-1"></a>df1 <span class="op">=</span> pd.DataFrame({<span class="st">&quot;Nombre&quot;</span>:[<span class="st">&quot;Carmen&quot;</span>, <span class="st">&quot;Luis&quot;</span>], </span>
<span id="cb683-2"><a href="#cb683-2" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;Sexo&quot;</span>:[<span class="st">&quot;Mujer&quot;</span>, <span class="st">&quot;Hombre&quot;</span>], <span class="st">&quot;Edad&quot;</span>:[<span class="dv">22</span>, <span class="dv">18</span>]}).set_index(<span class="st">&quot;Nombre&quot;</span>)</span>
<span id="cb683-3"><a href="#cb683-3" aria-hidden="true" tabindex="-1"></a>df1</span>
<span id="cb683-4"><a href="#cb683-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb683-5"><a href="#cb683-5" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> pd.DataFrame({<span class="st">&quot;Nombre&quot;</span>:[<span class="st">&quot;María&quot;</span>, <span class="st">&quot;Pedro&quot;</span>, <span class="st">&quot;Carmen&quot;</span>], </span>
<span id="cb683-6"><a href="#cb683-6" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;Sexo&quot;</span>:[<span class="st">&quot;Mujer&quot;</span>, <span class="st">&quot;Hombre&quot;</span>, <span class="st">&quot;Mujer&quot;</span>], <span class="st">&quot;Edad&quot;</span>:[<span class="dv">25</span>, <span class="dv">30</span>, <span class="dv">22</span>], <span class="st">&quot;FT&quot;</span>: [<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>]}).set_index(<span class="st">&quot;Nombre&quot;</span>)</span>
<span id="cb683-7"><a href="#cb683-7" aria-hidden="true" tabindex="-1"></a>df2</span>
<span id="cb683-8"><a href="#cb683-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb683-9"><a href="#cb683-9" aria-hidden="true" tabindex="-1"></a>df3 <span class="op">=</span> pd.DataFrame({<span class="st">&quot;Nombre&quot;</span>:[<span class="st">&quot;María&quot;</span>, <span class="st">&quot;Pedro&quot;</span>, <span class="st">&quot;Carmen&quot;</span>], </span>
<span id="cb683-10"><a href="#cb683-10" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;Sexo&quot;</span>:[<span class="st">&quot;Mujer&quot;</span>, <span class="st">&quot;Hombre&quot;</span>, <span class="st">&quot;Mujer&quot;</span>], <span class="st">&quot;Edad&quot;</span>:[<span class="dv">25</span>, <span class="dv">30</span>, <span class="dv">22</span>]}).set_index(<span class="st">&quot;Nombre&quot;</span>)</span>
<span id="cb683-11"><a href="#cb683-11" aria-hidden="true" tabindex="-1"></a>df3</span>
<span id="cb683-12"><a href="#cb683-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb683-13"><a href="#cb683-13" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.concat([df1, df3])</span>
<span id="cb683-14"><a href="#cb683-14" aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div>
</div>
<div id="ejemplo-2-juntar-por-columnas-merge" class="section level4 hasAnchor" number="4.5.7.2">
<h4 class="hasAnchor"><span class="header-section-number">4.5.7.2</span> Ejemplo 2: Juntar por columnas (merge)<a href="#ejemplo-2-juntar-por-columnas-merge" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>Sintaxis básica</li>
</ul>
<p><code>df.merge(df1, df2, on = clave, how = tipo)</code></p>
<ul>
<li><p>Tipos</p></li>
<li><p><strong>inner (por defecto)</strong>: El DataFrame resultante solo contiene las filas cuyos valores en la clave están en los <strong>dos</strong> DataFrames</p></li>
</ul>
<div class="figure">
<img src="attachment:inner-join.gif" alt="" />
<p class="caption">inner-join.gif</p>
</div>
<p><strong>outer</strong>:
+ El DataFrame resultante contiene todas las filas de los dos DataFrames.
+ Si una fila de un DataFrame no puede emparejarse con otra los mismos valores en la clave en el otro DataFrame, la fila se añade igualmente al DataFrame resultante rellenando las columnas del otro DataFrame con el valor NaN.
+ Es equivalente a la unión de conjuntos.</p>
<div class="figure">
<img src="attachment:full-join.gif" alt="" />
<p class="caption">full-join.gif</p>
</div>
<p><strong>left</strong>:</p>
<ul>
<li>El DataFrame resultante contiene todas las filas del primer DataFrame.</li>
<li>Descarta las filas del segundo DataFrame que no pueden emparejarse con alguna fila del primero-</li>
</ul>
<div class="figure">
<img src="attachment:left-join.gif" alt="" />
<p class="caption">left-join.gif</p>
</div>
<p><strong>right</strong>:</p>
<ul>
<li>El DataFrame resultante contiene todas las filas del segundo DataFrame</li>
<li>Descarta las filas del primer DataFrame que no pueden emparejarse con alguna fila del segundo DataFrame a través de la clave.</li>
</ul>
<div class="figure">
<img src="attachment:right-join.gif" alt="" />
<p class="caption">right-join.gif</p>
</div>
</div>
<div id="aplicaciones-a-bases-de-datos-append" class="section level4 hasAnchor" number="4.5.7.3">
<h4 class="hasAnchor"><span class="header-section-number">4.5.7.3</span> Aplicaciones a bases de datos : append<a href="#aplicaciones-a-bases-de-datos-append" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb684"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb684-1"><a href="#cb684-1" aria-hidden="true" tabindex="-1"></a>df1 <span class="op">=</span> pd.read_csv(<span class="st">&#39;datos</span><span class="ch">\\</span><span class="st">concat_1.csv&#39;</span>)</span>
<span id="cb684-2"><a href="#cb684-2" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> pd.read_csv(<span class="st">&#39;datos</span><span class="ch">\\</span><span class="st">concat_2.csv&#39;</span>)</span>
<span id="cb684-3"><a href="#cb684-3" aria-hidden="true" tabindex="-1"></a>df3 <span class="op">=</span> pd.read_csv(<span class="st">&#39;datos</span><span class="ch">\\</span><span class="st">concat_3.csv&#39;</span>)</span>
<span id="cb684-4"><a href="#cb684-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb684-5"><a href="#cb684-5" aria-hidden="true" tabindex="-1"></a>df1</span>
<span id="cb684-6"><a href="#cb684-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb684-7"><a href="#cb684-7" aria-hidden="true" tabindex="-1"></a>df2</span>
<span id="cb684-8"><a href="#cb684-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb684-9"><a href="#cb684-9" aria-hidden="true" tabindex="-1"></a>df3</span>
<span id="cb684-10"><a href="#cb684-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb684-11"><a href="#cb684-11" aria-hidden="true" tabindex="-1"></a>row_concat <span class="op">=</span> pd.concat([df1, df2, df3])</span>
<span id="cb684-12"><a href="#cb684-12" aria-hidden="true" tabindex="-1"></a>row_concat</span>
<span id="cb684-13"><a href="#cb684-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb684-14"><a href="#cb684-14" aria-hidden="true" tabindex="-1"></a>row_concat.loc[<span class="dv">0</span>]</span>
<span id="cb684-15"><a href="#cb684-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb684-16"><a href="#cb684-16" aria-hidden="true" tabindex="-1"></a>row_concat.iloc[<span class="dv">0</span>]</span>
<span id="cb684-17"><a href="#cb684-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb684-18"><a href="#cb684-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Si quiero resetear el indice utilizo opcion ignore_index = True</span></span>
<span id="cb684-19"><a href="#cb684-19" aria-hidden="true" tabindex="-1"></a>row_concat_reset <span class="op">=</span> pd.concat([df1, df2, df3], ignore_index <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb684-20"><a href="#cb684-20" aria-hidden="true" tabindex="-1"></a>row_concat_reset</span>
<span id="cb684-21"><a href="#cb684-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb684-22"><a href="#cb684-22" aria-hidden="true" tabindex="-1"></a>row_concat_reset.loc[<span class="dv">0</span>]</span>
<span id="cb684-23"><a href="#cb684-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb684-24"><a href="#cb684-24" aria-hidden="true" tabindex="-1"></a><span class="co"># ¿Qué ocurre si es que pego un data frame con una serie?</span></span>
<span id="cb684-25"><a href="#cb684-25" aria-hidden="true" tabindex="-1"></a>new_row_series <span class="op">=</span> pd.Series([<span class="st">&#39;n1&#39;</span>, <span class="st">&#39;n2&#39;</span>, <span class="st">&#39;n3&#39;</span>, <span class="st">&#39;n4&#39;</span>])</span>
<span id="cb684-26"><a href="#cb684-26" aria-hidden="true" tabindex="-1"></a>new_row_series</span>
<span id="cb684-27"><a href="#cb684-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb684-28"><a href="#cb684-28" aria-hidden="true" tabindex="-1"></a>df1</span>
<span id="cb684-29"><a href="#cb684-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb684-30"><a href="#cb684-30" aria-hidden="true" tabindex="-1"></a>pd.concat([df1, new_row_series])</span>
<span id="cb684-31"><a href="#cb684-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb684-32"><a href="#cb684-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Miren lo que ocurre si ahora defino columnas similares</span></span>
<span id="cb684-33"><a href="#cb684-33" aria-hidden="true" tabindex="-1"></a>new_row_data <span class="op">=</span> pd.DataFrame([[<span class="st">&#39;n1&#39;</span>, <span class="st">&#39;n2&#39;</span>, <span class="st">&#39;n3&#39;</span>, <span class="st">&#39;n4&#39;</span>]],</span>
<span id="cb684-34"><a href="#cb684-34" aria-hidden="true" tabindex="-1"></a>                            columns<span class="op">=</span>[<span class="st">&#39;A&#39;</span>, <span class="st">&#39;B&#39;</span>, <span class="st">&#39;C&#39;</span>, <span class="st">&#39;D&#39;</span>])</span>
<span id="cb684-35"><a href="#cb684-35" aria-hidden="true" tabindex="-1"></a>new_row_data</span>
<span id="cb684-36"><a href="#cb684-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb684-37"><a href="#cb684-37" aria-hidden="true" tabindex="-1"></a>pd.concat([df1, new_row_data])</span>
<span id="cb684-38"><a href="#cb684-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb684-39"><a href="#cb684-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Tambien puedo modificar los ejes de forma tal de pegar hacia el lado</span></span>
<span id="cb684-40"><a href="#cb684-40" aria-hidden="true" tabindex="-1"></a>col_concat <span class="op">=</span> pd.concat([df1, df2, df3], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb684-41"><a href="#cb684-41" aria-hidden="true" tabindex="-1"></a>col_concat</span>
<span id="cb684-42"><a href="#cb684-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb684-43"><a href="#cb684-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Puedo hacer algunas selecciones que pueden generar tablas de interes </span></span>
<span id="cb684-44"><a href="#cb684-44" aria-hidden="true" tabindex="-1"></a>col_concat[<span class="st">&#39;A&#39;</span>]</span>
<span id="cb684-45"><a href="#cb684-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb684-46"><a href="#cb684-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Tambien puedo resetear los indices, en este caso el de las columnmas </span></span>
<span id="cb684-47"><a href="#cb684-47" aria-hidden="true" tabindex="-1"></a>col_concat_ignore <span class="op">=</span> pd.concat([df1, df2, df3], axis<span class="op">=</span><span class="dv">1</span>, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb684-48"><a href="#cb684-48" aria-hidden="true" tabindex="-1"></a>col_concat_ignore</span>
<span id="cb684-49"><a href="#cb684-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb684-50"><a href="#cb684-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Miremos un ultimo ejemplo: junta lo común, genera nuevos en caso de que no lo sean</span></span>
<span id="cb684-51"><a href="#cb684-51" aria-hidden="true" tabindex="-1"></a>df1.columns<span class="op">=</span>[<span class="st">&#39;A&#39;</span>,<span class="st">&#39;B&#39;</span>,<span class="st">&#39;C&#39;</span>,<span class="st">&#39;D&#39;</span>]</span>
<span id="cb684-52"><a href="#cb684-52" aria-hidden="true" tabindex="-1"></a>df2.columns<span class="op">=</span>[<span class="st">&#39;E&#39;</span>,<span class="st">&#39;F&#39;</span>,<span class="st">&#39;G&#39;</span>,<span class="st">&#39;H&#39;</span>]</span>
<span id="cb684-53"><a href="#cb684-53" aria-hidden="true" tabindex="-1"></a>df3.columns<span class="op">=</span>[<span class="st">&#39;A&#39;</span>,<span class="st">&#39;H&#39;</span>,<span class="st">&#39;F&#39;</span>,<span class="st">&#39;C&#39;</span>]</span>
<span id="cb684-54"><a href="#cb684-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb684-55"><a href="#cb684-55" aria-hidden="true" tabindex="-1"></a>df1</span>
<span id="cb684-56"><a href="#cb684-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb684-57"><a href="#cb684-57" aria-hidden="true" tabindex="-1"></a>df2</span>
<span id="cb684-58"><a href="#cb684-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb684-59"><a href="#cb684-59" aria-hidden="true" tabindex="-1"></a>df3</span>
<span id="cb684-60"><a href="#cb684-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb684-61"><a href="#cb684-61" aria-hidden="true" tabindex="-1"></a>pd.concat([df1, df2, df3])</span></code></pre></div>
</div>
<div id="aplicaciones-a-bases-de-datos-merge" class="section level4 hasAnchor" number="4.5.7.4">
<h4 class="hasAnchor"><span class="header-section-number">4.5.7.4</span> Aplicaciones a bases de datos : merge<a href="#aplicaciones-a-bases-de-datos-merge" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb685"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb685-1"><a href="#cb685-1" aria-hidden="true" tabindex="-1"></a>person<span class="op">=</span>pd.read_csv(<span class="st">&#39;datos</span><span class="ch">\\</span><span class="st">survey_person.csv&#39;</span>)</span>
<span id="cb685-2"><a href="#cb685-2" aria-hidden="true" tabindex="-1"></a>site<span class="op">=</span>pd.read_csv(<span class="st">&#39;datos</span><span class="ch">\\</span><span class="st">survey_site.csv&#39;</span>)</span>
<span id="cb685-3"><a href="#cb685-3" aria-hidden="true" tabindex="-1"></a>survey<span class="op">=</span>pd.read_csv(<span class="st">&#39;datos</span><span class="ch">\\</span><span class="st">survey_survey.csv&#39;</span>)</span>
<span id="cb685-4"><a href="#cb685-4" aria-hidden="true" tabindex="-1"></a>visited<span class="op">=</span>pd.read_csv(<span class="st">&#39;datos</span><span class="ch">\\</span><span class="st">survey_visited.csv&#39;</span>)</span>
<span id="cb685-5"><a href="#cb685-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb685-6"><a href="#cb685-6" aria-hidden="true" tabindex="-1"></a>person</span>
<span id="cb685-7"><a href="#cb685-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb685-8"><a href="#cb685-8" aria-hidden="true" tabindex="-1"></a>site</span>
<span id="cb685-9"><a href="#cb685-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb685-10"><a href="#cb685-10" aria-hidden="true" tabindex="-1"></a>survey</span>
<span id="cb685-11"><a href="#cb685-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb685-12"><a href="#cb685-12" aria-hidden="true" tabindex="-1"></a>visited</span>
<span id="cb685-13"><a href="#cb685-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb685-14"><a href="#cb685-14" aria-hidden="true" tabindex="-1"></a>visited_sub <span class="op">=</span> visited.loc[[<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">6</span>]]</span>
<span id="cb685-15"><a href="#cb685-15" aria-hidden="true" tabindex="-1"></a>visited_sub</span>
<span id="cb685-16"><a href="#cb685-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb685-17"><a href="#cb685-17" aria-hidden="true" tabindex="-1"></a>site</span>
<span id="cb685-18"><a href="#cb685-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb685-19"><a href="#cb685-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Por defecto va a ser inner, noten que le indico left_on y right_on. ¿Razón? </span></span>
<span id="cb685-20"><a href="#cb685-20" aria-hidden="true" tabindex="-1"></a>o2o <span class="op">=</span> site.merge(visited_sub, </span>
<span id="cb685-21"><a href="#cb685-21" aria-hidden="true" tabindex="-1"></a>                 left_on<span class="op">=</span>[<span class="st">&#39;name&#39;</span>], </span>
<span id="cb685-22"><a href="#cb685-22" aria-hidden="true" tabindex="-1"></a>                 right_on<span class="op">=</span><span class="st">&#39;site&#39;</span>)</span>
<span id="cb685-23"><a href="#cb685-23" aria-hidden="true" tabindex="-1"></a>o2o</span>
<span id="cb685-24"><a href="#cb685-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb685-25"><a href="#cb685-25" aria-hidden="true" tabindex="-1"></a>o2o.shape</span>
<span id="cb685-26"><a href="#cb685-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb685-27"><a href="#cb685-27" aria-hidden="true" tabindex="-1"></a>visited</span>
<span id="cb685-28"><a href="#cb685-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb685-29"><a href="#cb685-29" aria-hidden="true" tabindex="-1"></a>site</span>
<span id="cb685-30"><a href="#cb685-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb685-31"><a href="#cb685-31" aria-hidden="true" tabindex="-1"></a>m2o <span class="op">=</span> site.merge(visited, </span>
<span id="cb685-32"><a href="#cb685-32" aria-hidden="true" tabindex="-1"></a>                 left_on<span class="op">=</span><span class="st">&#39;name&#39;</span>, </span>
<span id="cb685-33"><a href="#cb685-33" aria-hidden="true" tabindex="-1"></a>                 right_on<span class="op">=</span><span class="st">&#39;site&#39;</span>)</span>
<span id="cb685-34"><a href="#cb685-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb685-35"><a href="#cb685-35" aria-hidden="true" tabindex="-1"></a>m2o</span></code></pre></div>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 4.5.4: </b></p>
<ul>
<li>Genere dos bases de datos (df1 y df2) con la siguiente información:</li>
</ul>
<p><strong>df1</strong></p>
<table>
<thead>
<tr class="header">
<th>Nombre</th>
<th>Género</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Carmen</td>
<td>Walmart</td>
</tr>
<tr class="even">
<td>Luis</td>
<td>Dia</td>
</tr>
<tr class="odd">
<td>María</td>
<td>Walmart</td>
</tr>
</tbody>
</table>
<p><strong>df2</strong></p>
<table>
<thead>
<tr class="header">
<th>Nombre</th>
<th>Género</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>María</td>
<td>Fnac</td>
</tr>
<tr class="even">
<td>Pedro</td>
<td>Dia</td>
</tr>
<tr class="odd">
<td>Luis</td>
<td>Walmart</td>
</tr>
</tbody>
</table>
<ul>
<li>Aplique los cuatro tipos de “join”: inner, outer, left y right. Compare sus resultados</li>
</ul>
</div>
<div class="sourceCode" id="cb686"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb686-1"><a href="#cb686-1" aria-hidden="true" tabindex="-1"></a>df1 <span class="op">=</span> pd.DataFrame({<span class="st">&quot;Nombre&quot;</span>:[<span class="st">&quot;Carmen&quot;</span>, <span class="st">&quot;Luis&quot;</span>, <span class="st">&quot;María&quot;</span>],  <span class="st">&quot;Sexo&quot;</span>:[<span class="st">&quot;Mujer&quot;</span>, <span class="st">&quot;Hombre&quot;</span>, <span class="st">&quot;Mujer&quot;</span>]})</span>
<span id="cb686-2"><a href="#cb686-2" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> pd.DataFrame({<span class="st">&quot;Nombre&quot;</span>:[<span class="st">&quot;María&quot;</span>, <span class="st">&quot;Pedro&quot;</span>, <span class="st">&quot;Luis&quot;</span>], <span class="st">&quot;Edad&quot;</span>:[<span class="dv">25</span>, <span class="dv">30</span>, <span class="dv">18</span>]})</span>
<span id="cb686-3"><a href="#cb686-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb686-4"><a href="#cb686-4" aria-hidden="true" tabindex="-1"></a>df1</span>
<span id="cb686-5"><a href="#cb686-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb686-6"><a href="#cb686-6" aria-hidden="true" tabindex="-1"></a>df2</span>
<span id="cb686-7"><a href="#cb686-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb686-8"><a href="#cb686-8" aria-hidden="true" tabindex="-1"></a>df_inner <span class="op">=</span> pd.merge(df1, df2, on<span class="op">=</span><span class="st">&quot;Nombre&quot;</span>)</span>
<span id="cb686-9"><a href="#cb686-9" aria-hidden="true" tabindex="-1"></a>df_outer <span class="op">=</span> pd.merge(df1, df2, on<span class="op">=</span><span class="st">&quot;Nombre&quot;</span>, how<span class="op">=</span><span class="st">&quot;outer&quot;</span>)</span>
<span id="cb686-10"><a href="#cb686-10" aria-hidden="true" tabindex="-1"></a>df_left <span class="op">=</span> pd.merge(df1, df2, on<span class="op">=</span><span class="st">&quot;Nombre&quot;</span>, how<span class="op">=</span><span class="st">&quot;left&quot;</span>)</span>
<span id="cb686-11"><a href="#cb686-11" aria-hidden="true" tabindex="-1"></a>df_right <span class="op">=</span> pd.merge(df1, df2, on<span class="op">=</span><span class="st">&quot;Nombre&quot;</span>, how<span class="op">=</span><span class="st">&quot;right&quot;</span>)</span>
<span id="cb686-12"><a href="#cb686-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb686-13"><a href="#cb686-13" aria-hidden="true" tabindex="-1"></a>df_inner</span>
<span id="cb686-14"><a href="#cb686-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb686-15"><a href="#cb686-15" aria-hidden="true" tabindex="-1"></a>df_outer</span>
<span id="cb686-16"><a href="#cb686-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb686-17"><a href="#cb686-17" aria-hidden="true" tabindex="-1"></a>df_left</span>
<span id="cb686-18"><a href="#cb686-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb686-19"><a href="#cb686-19" aria-hidden="true" tabindex="-1"></a>df_right</span></code></pre></div>
</div>
</div>
</div>
<div id="análisis-de-datos-parte-i" class="section level2 hasAnchor" number="4.6">
<h2 class="hasAnchor"><span class="header-section-number">4.6</span> Análisis de datos (Parte I)<a href="#análisis-de-datos-parte-i" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>La clase de hoy tiene como objetivo revisar algunos elementos releacionados con análisis estadístico.</li>
<li>Veremos algunos concepts básicos y su aplicación en python.</li>
<li>En la segunda parte de la clase revisaremos varios ejemplos.</li>
</ul>
<div class="sourceCode" id="cb687"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb687-1"><a href="#cb687-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preambulo</span></span>
<span id="cb687-2"><a href="#cb687-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb687-3"><a href="#cb687-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Librerías: </span></span>
<span id="cb687-4"><a href="#cb687-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb687-5"><a href="#cb687-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd                    <span class="co"># datos/dataframes</span></span>
<span id="cb687-6"><a href="#cb687-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np                     <span class="co"># arreglos</span></span>
<span id="cb687-7"><a href="#cb687-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> datetime <span class="im">as</span> dt                  <span class="co"># fechas </span></span>
<span id="cb687-8"><a href="#cb687-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os                              <span class="co"># directorios </span></span>
<span id="cb687-9"><a href="#cb687-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt        <span class="co"># Visualización básicas y no tan básicas</span></span>
<span id="cb687-10"><a href="#cb687-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.stats <span class="im">as</span> stats            <span class="co"># Librería estadística</span></span>
<span id="cb687-11"><a href="#cb687-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random                          <span class="co"># Números aleatorios</span></span>
<span id="cb687-12"><a href="#cb687-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math                            <span class="co"># Operaciones matemáticas</span></span>
<span id="cb687-13"><a href="#cb687-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb687-14"><a href="#cb687-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Fecha de hoy</span></span>
<span id="cb687-15"><a href="#cb687-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dt.date.today())</span>
<span id="cb687-16"><a href="#cb687-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb687-17"><a href="#cb687-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Carpetas</span></span>
<span id="cb687-18"><a href="#cb687-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb687-19"><a href="#cb687-19" aria-hidden="true" tabindex="-1"></a>main <span class="op">=</span> os.getcwd()</span>
<span id="cb687-20"><a href="#cb687-20" aria-hidden="true" tabindex="-1"></a>datos <span class="op">=</span> main <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">datos&quot;</span></span>
<span id="cb687-21"><a href="#cb687-21" aria-hidden="true" tabindex="-1"></a>resultados <span class="op">=</span> main <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">resultados&quot;</span></span>
<span id="cb687-22"><a href="#cb687-22" aria-hidden="true" tabindex="-1"></a>tablas <span class="op">=</span> resultados <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">tablas&quot;</span></span>
<span id="cb687-23"><a href="#cb687-23" aria-hidden="true" tabindex="-1"></a>figuras <span class="op">=</span> resultados <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">figuras&quot;</span></span>
<span id="cb687-24"><a href="#cb687-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb687-25"><a href="#cb687-25" aria-hidden="true" tabindex="-1"></a>main</span></code></pre></div>
<div id="estadistica-descriptiva" class="section level3 hasAnchor" number="4.6.1">
<h3 class="hasAnchor"><span class="header-section-number">4.6.1</span> Estadistica Descriptiva<a href="#estadistica-descriptiva" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><p>Las estadísticas descriptivas son medidas que resumen características importantes de los datos.</p></li>
<li><p>La elaboración de estadísticas descriptivas es un primer paso común después de limpiar y preparar un conjunto de datos para su análisis.</p></li>
<li><p>Ya hemos visto varios ejemplos de estadísticas descriptivas en clases anteriores, en esta clase formalizaremos algunos temas y veremos muchos ejemplos.</p></li>
</ul>
<div id="medidas-de-tendencia-central-media-mediana-y-moda" class="section level4 hasAnchor" number="4.6.1.1">
<h4 class="hasAnchor"><span class="header-section-number">4.6.1.1</span> Medidas de tendencia central : media, mediana y moda<a href="#medidas-de-tendencia-central-media-mediana-y-moda" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p>Las medidas de centralidad son estadísticas que nos dan una idea del “centro” de una variable numérica.</p></li>
<li><p>En otras palabras, las medidas de centralidad dan una idea del valor típico que se espera ver en una distribución de datos.</p></li>
<li><p>Las medidas de centralidad más comunes son la media, la mediana y la moda.</p></li>
<li><p>La media es simplemente un promedio: la suma de los valores dividida por el número total de registros. Como hemos visto en lecciones anteriores, podemos utilizar <em>df.mean()</em> para obtener la media de cada columna de un DataFrame:</p></li>
</ul>
<div class="sourceCode" id="cb688"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb688-1"><a href="#cb688-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Importamos datos</span></span>
<span id="cb688-2"><a href="#cb688-2" aria-hidden="true" tabindex="-1"></a>mtcars <span class="op">=</span> pd.read_csv(<span class="st">&quot;datos</span><span class="ch">\\</span><span class="st">mtcars.csv&quot;</span>)</span>
<span id="cb688-3"><a href="#cb688-3" aria-hidden="true" tabindex="-1"></a>mtcars</span>
<span id="cb688-4"><a href="#cb688-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb688-5"><a href="#cb688-5" aria-hidden="true" tabindex="-1"></a><span class="kw">del</span> mtcars[<span class="st">&quot;model&quot;</span>]</span>
<span id="cb688-6"><a href="#cb688-6" aria-hidden="true" tabindex="-1"></a>mtcars</span>
<span id="cb688-7"><a href="#cb688-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb688-8"><a href="#cb688-8" aria-hidden="true" tabindex="-1"></a>mtcars.head(<span class="dv">10</span>)</span>
<span id="cb688-9"><a href="#cb688-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb688-10"><a href="#cb688-10" aria-hidden="true" tabindex="-1"></a>mtcars.tail()</span>
<span id="cb688-11"><a href="#cb688-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb688-12"><a href="#cb688-12" aria-hidden="true" tabindex="-1"></a>mtcars.columns</span>
<span id="cb688-13"><a href="#cb688-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb688-14"><a href="#cb688-14" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(mtcars.columns)</span>
<span id="cb688-15"><a href="#cb688-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb688-16"><a href="#cb688-16" aria-hidden="true" tabindex="-1"></a><span class="bu">sorted</span>(mtcars.columns)</span>
<span id="cb688-17"><a href="#cb688-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb688-18"><a href="#cb688-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Promedio cada columna</span></span>
<span id="cb688-19"><a href="#cb688-19" aria-hidden="true" tabindex="-1"></a>promedio <span class="op">=</span> mtcars.mean()   </span>
<span id="cb688-20"><a href="#cb688-20" aria-hidden="true" tabindex="-1"></a>promedio</span>
<span id="cb688-21"><a href="#cb688-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb688-22"><a href="#cb688-22" aria-hidden="true" tabindex="-1"></a>t1 <span class="op">=</span> pd.DataFrame(promedio) </span>
<span id="cb688-23"><a href="#cb688-23" aria-hidden="true" tabindex="-1"></a>t1</span>
<span id="cb688-24"><a href="#cb688-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb688-25"><a href="#cb688-25" aria-hidden="true" tabindex="-1"></a>t1 <span class="op">=</span> t1.rename(columns <span class="op">=</span> {<span class="dv">0</span>: <span class="st">&quot;Promedio&quot;</span>})</span>
<span id="cb688-26"><a href="#cb688-26" aria-hidden="true" tabindex="-1"></a>t1</span>
<span id="cb688-27"><a href="#cb688-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb688-28"><a href="#cb688-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Guardamos nuestra T1</span></span>
<span id="cb688-29"><a href="#cb688-29" aria-hidden="true" tabindex="-1"></a>os.chdir(tablas)</span>
<span id="cb688-30"><a href="#cb688-30" aria-hidden="true" tabindex="-1"></a>t1.to_excel(<span class="st">&quot;t1.xlsx&quot;</span>, </span>
<span id="cb688-31"><a href="#cb688-31" aria-hidden="true" tabindex="-1"></a>            sheet_name<span class="op">=</span><span class="st">&#39;t1&#39;</span>, </span>
<span id="cb688-32"><a href="#cb688-32" aria-hidden="true" tabindex="-1"></a>            index<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<ul>
<li>Recuerden que también podemos incluir el promedio por fila</li>
</ul>
<div class="sourceCode" id="cb689"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb689-1"><a href="#cb689-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Promedio por fila </span></span>
<span id="cb689-2"><a href="#cb689-2" aria-hidden="true" tabindex="-1"></a>mtcars.mean(axis<span class="op">=</span><span class="dv">1</span>)</span></code></pre></div>
<ul>
<li>La mediana de una distribución es el valor en el que el 50% de los datos se encuentra por debajo y el 50% por encima.</li>
<li>En esencia, la mediana divide los datos por la mitad.</li>
<li>La mediana también se conoce como el percentil del 50%, ya que el 50% de las observaciones se encuentran por debajo de ella.</li>
<li>Se puede obtener la mediana utilizando la función df.median():</li>
</ul>
<div class="sourceCode" id="cb690"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb690-1"><a href="#cb690-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mediana</span></span>
<span id="cb690-2"><a href="#cb690-2" aria-hidden="true" tabindex="-1"></a>mediana <span class="op">=</span> mtcars.median()  </span>
<span id="cb690-3"><a href="#cb690-3" aria-hidden="true" tabindex="-1"></a>t2 <span class="op">=</span> pd.DataFrame(mediana) </span>
<span id="cb690-4"><a href="#cb690-4" aria-hidden="true" tabindex="-1"></a>t2 <span class="op">=</span> t2.rename(columns <span class="op">=</span> {<span class="dv">0</span>: <span class="st">&quot;Mediana&quot;</span>})</span>
<span id="cb690-5"><a href="#cb690-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb690-6"><a href="#cb690-6" aria-hidden="true" tabindex="-1"></a>t2</span>
<span id="cb690-7"><a href="#cb690-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb690-8"><a href="#cb690-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Guardamos nuestra T2</span></span>
<span id="cb690-9"><a href="#cb690-9" aria-hidden="true" tabindex="-1"></a>os.chdir(tablas)</span>
<span id="cb690-10"><a href="#cb690-10" aria-hidden="true" tabindex="-1"></a>t2.to_excel(<span class="st">&quot;t2.xlsx&quot;</span>, </span>
<span id="cb690-11"><a href="#cb690-11" aria-hidden="true" tabindex="-1"></a>            sheet_name<span class="op">=</span><span class="st">&#39;t2&#39;</span>, </span>
<span id="cb690-12"><a href="#cb690-12" aria-hidden="true" tabindex="-1"></a>            index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb690-13"><a href="#cb690-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb690-14"><a href="#cb690-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ¿Si queremos juntar? </span></span>
<span id="cb690-15"><a href="#cb690-15" aria-hidden="true" tabindex="-1"></a>t3 <span class="op">=</span> pd.concat([t1, t2], axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb690-16"><a href="#cb690-16" aria-hidden="true" tabindex="-1"></a>t3</span>
<span id="cb690-17"><a href="#cb690-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb690-18"><a href="#cb690-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Guardamos nuestra T3</span></span>
<span id="cb690-19"><a href="#cb690-19" aria-hidden="true" tabindex="-1"></a>os.chdir(tablas)</span>
<span id="cb690-20"><a href="#cb690-20" aria-hidden="true" tabindex="-1"></a>t3.to_excel(<span class="st">&quot;t3.xlsx&quot;</span>, </span>
<span id="cb690-21"><a href="#cb690-21" aria-hidden="true" tabindex="-1"></a>            sheet_name<span class="op">=</span><span class="st">&#39;t3&#39;</span>, </span>
<span id="cb690-22"><a href="#cb690-22" aria-hidden="true" tabindex="-1"></a>            index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb690-23"><a href="#cb690-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb690-24"><a href="#cb690-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Index = True/False me permite incluir el nombre de las filas.</span></span></code></pre></div>
<ul>
<li><p>Aunque la media y la mediana nos dan una idea del centro de una distribución, no siempre son iguales.</p></li>
<li><p>La mediana siempre nos da un valor que divide los datos en dos mitades, mientras que la media es un promedio numérico, por lo que <strong>los valores extremos</strong> pueden tener un impacto significativo en la media.</p></li>
<li><p>En una distribución simétrica, la media y la mediana serán iguales.</p></li>
</ul>
<div class="sourceCode" id="cb691"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb691-1"><a href="#cb691-1" aria-hidden="true" tabindex="-1"></a>norm_data <span class="op">=</span> pd.DataFrame(np.random.normal(size<span class="op">=</span><span class="dv">100000</span>))</span>
<span id="cb691-2"><a href="#cb691-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb691-3"><a href="#cb691-3" aria-hidden="true" tabindex="-1"></a>norm_data.plot(kind<span class="op">=</span><span class="st">&quot;density&quot;</span>,</span>
<span id="cb691-4"><a href="#cb691-4" aria-hidden="true" tabindex="-1"></a>              figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))<span class="op">;</span></span>
<span id="cb691-5"><a href="#cb691-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb691-6"><a href="#cb691-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb691-7"><a href="#cb691-7" aria-hidden="true" tabindex="-1"></a>plt.vlines(norm_data.mean(),     <span class="co"># Media</span></span>
<span id="cb691-8"><a href="#cb691-8" aria-hidden="true" tabindex="-1"></a>           ymin<span class="op">=</span><span class="dv">0</span>, </span>
<span id="cb691-9"><a href="#cb691-9" aria-hidden="true" tabindex="-1"></a>           ymax<span class="op">=</span><span class="fl">0.4</span>,</span>
<span id="cb691-10"><a href="#cb691-10" aria-hidden="true" tabindex="-1"></a>           linewidth<span class="op">=</span><span class="fl">5.0</span>)<span class="op">;</span></span>
<span id="cb691-11"><a href="#cb691-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb691-12"><a href="#cb691-12" aria-hidden="true" tabindex="-1"></a>plt.vlines(norm_data.median(),   <span class="co"># Mediana</span></span>
<span id="cb691-13"><a href="#cb691-13" aria-hidden="true" tabindex="-1"></a>           ymin<span class="op">=</span><span class="dv">0</span>, </span>
<span id="cb691-14"><a href="#cb691-14" aria-hidden="true" tabindex="-1"></a>           ymax<span class="op">=</span><span class="fl">0.4</span>, </span>
<span id="cb691-15"><a href="#cb691-15" aria-hidden="true" tabindex="-1"></a>           linewidth<span class="op">=</span><span class="fl">2.0</span>,</span>
<span id="cb691-16"><a href="#cb691-16" aria-hidden="true" tabindex="-1"></a>           color<span class="op">=</span><span class="st">&quot;red&quot;</span>)<span class="op">;</span></span></code></pre></div>
<ul>
<li>En una distribución simetrica (como la normal) la media y la mediana son iguales</li>
</ul>
<div class="sourceCode" id="cb692"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb692-1"><a href="#cb692-1" aria-hidden="true" tabindex="-1"></a>skewed_data <span class="op">=</span> pd.DataFrame(np.random.exponential(size<span class="op">=</span><span class="dv">100000</span>))</span>
<span id="cb692-2"><a href="#cb692-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb692-3"><a href="#cb692-3" aria-hidden="true" tabindex="-1"></a>skewed_data.plot(kind<span class="op">=</span><span class="st">&quot;density&quot;</span>,</span>
<span id="cb692-4"><a href="#cb692-4" aria-hidden="true" tabindex="-1"></a>              figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>),</span>
<span id="cb692-5"><a href="#cb692-5" aria-hidden="true" tabindex="-1"></a>              xlim<span class="op">=</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">5</span>))<span class="op">;</span></span>
<span id="cb692-6"><a href="#cb692-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb692-7"><a href="#cb692-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb692-8"><a href="#cb692-8" aria-hidden="true" tabindex="-1"></a>plt.vlines(skewed_data.mean(),     <span class="co"># Media</span></span>
<span id="cb692-9"><a href="#cb692-9" aria-hidden="true" tabindex="-1"></a>           ymin<span class="op">=</span><span class="dv">0</span>, </span>
<span id="cb692-10"><a href="#cb692-10" aria-hidden="true" tabindex="-1"></a>           ymax<span class="op">=</span><span class="fl">0.8</span>,</span>
<span id="cb692-11"><a href="#cb692-11" aria-hidden="true" tabindex="-1"></a>           linewidth<span class="op">=</span><span class="fl">5.0</span>)<span class="op">;</span></span>
<span id="cb692-12"><a href="#cb692-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb692-13"><a href="#cb692-13" aria-hidden="true" tabindex="-1"></a>plt.vlines(skewed_data.median(),   <span class="co"># Mediana</span></span>
<span id="cb692-14"><a href="#cb692-14" aria-hidden="true" tabindex="-1"></a>           ymin<span class="op">=</span><span class="dv">0</span>, </span>
<span id="cb692-15"><a href="#cb692-15" aria-hidden="true" tabindex="-1"></a>           ymax<span class="op">=</span><span class="fl">0.8</span>, </span>
<span id="cb692-16"><a href="#cb692-16" aria-hidden="true" tabindex="-1"></a>           linewidth<span class="op">=</span><span class="fl">2.0</span>,</span>
<span id="cb692-17"><a href="#cb692-17" aria-hidden="true" tabindex="-1"></a>           color<span class="op">=</span><span class="st">&quot;red&quot;</span>)<span class="op">;</span></span></code></pre></div>
<ul>
<li>En una distribución asimétrica, la media y la mediana difieren.</li>
<li>La media también está muy influenciada por los valores atípicos, mientras que la mediana resiste la influencia de los mismos:</li>
</ul>
<div class="sourceCode" id="cb693"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb693-1"><a href="#cb693-1" aria-hidden="true" tabindex="-1"></a>norm_data <span class="op">=</span> np.random.normal(size<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb693-2"><a href="#cb693-2" aria-hidden="true" tabindex="-1"></a>outliers <span class="op">=</span> np.random.normal(<span class="dv">15</span>, size<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb693-3"><a href="#cb693-3" aria-hidden="true" tabindex="-1"></a>combined_data <span class="op">=</span> pd.DataFrame(np.concatenate((norm_data, outliers), axis<span class="op">=</span><span class="dv">0</span>))</span>
<span id="cb693-4"><a href="#cb693-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb693-5"><a href="#cb693-5" aria-hidden="true" tabindex="-1"></a>combined_data.plot(kind<span class="op">=</span><span class="st">&quot;density&quot;</span>,</span>
<span id="cb693-6"><a href="#cb693-6" aria-hidden="true" tabindex="-1"></a>              figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>),</span>
<span id="cb693-7"><a href="#cb693-7" aria-hidden="true" tabindex="-1"></a>              xlim<span class="op">=</span>(<span class="op">-</span><span class="dv">5</span>,<span class="dv">20</span>))<span class="op">;</span></span>
<span id="cb693-8"><a href="#cb693-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb693-9"><a href="#cb693-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb693-10"><a href="#cb693-10" aria-hidden="true" tabindex="-1"></a>plt.vlines(combined_data.mean(),     <span class="co"># Media (azul)</span></span>
<span id="cb693-11"><a href="#cb693-11" aria-hidden="true" tabindex="-1"></a>           ymin<span class="op">=</span><span class="dv">0</span>, </span>
<span id="cb693-12"><a href="#cb693-12" aria-hidden="true" tabindex="-1"></a>           ymax<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb693-13"><a href="#cb693-13" aria-hidden="true" tabindex="-1"></a>           linewidth<span class="op">=</span><span class="fl">5.0</span>)<span class="op">;</span></span>
<span id="cb693-14"><a href="#cb693-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb693-15"><a href="#cb693-15" aria-hidden="true" tabindex="-1"></a>plt.vlines(combined_data.median(),   <span class="co"># Mediana (rojo)</span></span>
<span id="cb693-16"><a href="#cb693-16" aria-hidden="true" tabindex="-1"></a>           ymin<span class="op">=</span><span class="dv">0</span>, </span>
<span id="cb693-17"><a href="#cb693-17" aria-hidden="true" tabindex="-1"></a>           ymax<span class="op">=</span><span class="fl">0.2</span>, </span>
<span id="cb693-18"><a href="#cb693-18" aria-hidden="true" tabindex="-1"></a>           linewidth<span class="op">=</span><span class="fl">2.0</span>,</span>
<span id="cb693-19"><a href="#cb693-19" aria-hidden="true" tabindex="-1"></a>           color<span class="op">=</span><span class="st">&quot;red&quot;</span>)<span class="op">;</span></span></code></pre></div>
<ul>
<li><p>Dado que la mediana tiende a resistir <strong>los efectos de la asimetría y los valores atípicos</strong>, se conoce como una estadística “robusta”.</p></li>
<li><p>La mediana suele dar una mejor idea del valor típico en una distribución con asimetrías o valores atípicos significativos.</p></li>
<li><p>Finalmente, la moda de una variable es simplemente el valor que aparece con más frecuencia. A diferencia de la media y la mediana, se puede tomar el modo de una variable categórica y es posible tener múltiples modas.</p></li>
</ul>
<div class="sourceCode" id="cb694"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb694-1"><a href="#cb694-1" aria-hidden="true" tabindex="-1"></a>moda <span class="op">=</span> mtcars.mode()</span>
<span id="cb694-2"><a href="#cb694-2" aria-hidden="true" tabindex="-1"></a>moda</span></code></pre></div>
<ul>
<li>Las columnas con modas múltiples (valores múltiples con la misma cuenta) devuelven valores múltiples como el modo.</li>
<li>Las columnas sin moda (ningún valor que aparezca más de una vez) devuelven NaN.</li>
</ul>
<div class="sourceCode" id="cb695"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb695-1"><a href="#cb695-1" aria-hidden="true" tabindex="-1"></a>moda.dropna(axis <span class="op">=</span> <span class="dv">0</span>, </span>
<span id="cb695-2"><a href="#cb695-2" aria-hidden="true" tabindex="-1"></a>            how <span class="op">=</span> <span class="st">&#39;any&#39;</span>, </span>
<span id="cb695-3"><a href="#cb695-3" aria-hidden="true" tabindex="-1"></a>            inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb695-4"><a href="#cb695-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb695-5"><a href="#cb695-5" aria-hidden="true" tabindex="-1"></a>moda</span>
<span id="cb695-6"><a href="#cb695-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb695-7"><a href="#cb695-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Guardamos nuestra T4</span></span>
<span id="cb695-8"><a href="#cb695-8" aria-hidden="true" tabindex="-1"></a>os.chdir(tablas)</span>
<span id="cb695-9"><a href="#cb695-9" aria-hidden="true" tabindex="-1"></a>moda.to_excel(<span class="st">&quot;t4.xlsx&quot;</span>, </span>
<span id="cb695-10"><a href="#cb695-10" aria-hidden="true" tabindex="-1"></a>            sheet_name<span class="op">=</span><span class="st">&#39;t4&#39;</span>, </span>
<span id="cb695-11"><a href="#cb695-11" aria-hidden="true" tabindex="-1"></a>            index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb695-12"><a href="#cb695-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb695-13"><a href="#cb695-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Index = True/False me permite incluir el nombre de las filas.</span></span></code></pre></div>
<ul>
<li>En resumen…</li>
</ul>
<div class="figure">
<img src="attachment:image.png" alt="" />
<p class="caption">image.png</p>
</div>
<div class="figure">
<img src="attachment:image.png" alt="" />
<p class="caption">image.png</p>
</div>
<div class="figure">
<img src="attachment:image.png" alt="" />
<p class="caption">image.png</p>
</div>
</div>
<div id="medidas-de-dispersión" class="section level4 hasAnchor" number="4.6.1.2">
<h4 class="hasAnchor"><span class="header-section-number">4.6.1.2</span> Medidas de dispersión<a href="#medidas-de-dispersión" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p>Las medidas de dispersión son estadísticas que describen cómo varían los datos.</p></li>
<li><p>Mientras que las medidas de centro nos dan una idea del valor típico, las medidas de dispersión nos dan una idea de cuánto tienden a divergir los datos del valor típico.</p></li>
<li><p>Una de las medidas de dispersión más sencillas es el rango.</p></li>
<li><p>El rango es la distancia entre las observaciones máxima y mínima:</p></li>
</ul>
<div class="sourceCode" id="cb696"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb696-1"><a href="#cb696-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rango</span></span>
<span id="cb696-2"><a href="#cb696-2" aria-hidden="true" tabindex="-1"></a>rango <span class="op">=</span> <span class="bu">max</span>(mtcars[<span class="st">&quot;mpg&quot;</span>]) <span class="op">-</span> <span class="bu">min</span>(mtcars[<span class="st">&quot;mpg&quot;</span>])</span>
<span id="cb696-3"><a href="#cb696-3" aria-hidden="true" tabindex="-1"></a>rango</span></code></pre></div>
<ul>
<li>Como se ha señalado anteriormente, la mediana representa el percentil 50 de un conjunto de datos.</li>
<li>Se puede utilizar un resumen de varios percentiles para describir la dispersión de una variable.</li>
<li>Podemos extraer el valor mínimo (percentil 0), el primer cuartil (percentil 25), la mediana, el tercer cuartil (percentil 75) y el valor máximo (percentil 100) utilizando el método <em>quantile()</em>:</li>
</ul>
<div class="sourceCode" id="cb697"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb697-1"><a href="#cb697-1" aria-hidden="true" tabindex="-1"></a>five_num <span class="op">=</span> [mtcars[<span class="st">&quot;mpg&quot;</span>].quantile(<span class="dv">0</span>),   </span>
<span id="cb697-2"><a href="#cb697-2" aria-hidden="true" tabindex="-1"></a>            mtcars[<span class="st">&quot;mpg&quot;</span>].quantile(<span class="fl">0.25</span>),</span>
<span id="cb697-3"><a href="#cb697-3" aria-hidden="true" tabindex="-1"></a>            mtcars[<span class="st">&quot;mpg&quot;</span>].quantile(<span class="fl">0.50</span>),</span>
<span id="cb697-4"><a href="#cb697-4" aria-hidden="true" tabindex="-1"></a>            mtcars[<span class="st">&quot;mpg&quot;</span>].quantile(<span class="fl">0.75</span>),</span>
<span id="cb697-5"><a href="#cb697-5" aria-hidden="true" tabindex="-1"></a>            mtcars[<span class="st">&quot;mpg&quot;</span>].quantile(<span class="dv">1</span>)]</span>
<span id="cb697-6"><a href="#cb697-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb697-7"><a href="#cb697-7" aria-hidden="true" tabindex="-1"></a>five_num</span>
<span id="cb697-8"><a href="#cb697-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb697-9"><a href="#cb697-9" aria-hidden="true" tabindex="-1"></a>t5 <span class="op">=</span> pd.DataFrame(mtcars.describe())</span>
<span id="cb697-10"><a href="#cb697-10" aria-hidden="true" tabindex="-1"></a>t5</span>
<span id="cb697-11"><a href="#cb697-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb697-12"><a href="#cb697-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Guardamos nuestra T4</span></span>
<span id="cb697-13"><a href="#cb697-13" aria-hidden="true" tabindex="-1"></a>os.chdir(tablas)</span>
<span id="cb697-14"><a href="#cb697-14" aria-hidden="true" tabindex="-1"></a>moda.to_excel(<span class="st">&quot;t5.xlsx&quot;</span>, </span>
<span id="cb697-15"><a href="#cb697-15" aria-hidden="true" tabindex="-1"></a>            sheet_name<span class="op">=</span><span class="st">&#39;t5&#39;</span>, </span>
<span id="cb697-16"><a href="#cb697-16" aria-hidden="true" tabindex="-1"></a>            index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb697-17"><a href="#cb697-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb697-18"><a href="#cb697-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Index = True/False me permite incluir el nombre de las filas.</span></span></code></pre></div>
<p>El rango intercuartil (IQR) es otra medida común de dispersión. El IQR es la distancia entre el tercer cuartil y el primer cuartil:</p>
<div class="sourceCode" id="cb698"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb698-1"><a href="#cb698-1" aria-hidden="true" tabindex="-1"></a>IQR <span class="op">=</span> mtcars[<span class="st">&quot;mpg&quot;</span>].quantile(<span class="fl">0.75</span>) <span class="op">-</span> mtcars[<span class="st">&quot;mpg&quot;</span>].quantile(<span class="fl">0.25</span>)</span>
<span id="cb698-2"><a href="#cb698-2" aria-hidden="true" tabindex="-1"></a>IQR</span></code></pre></div>
<p>En un grafico de caja y bigote es posible ver estas medidas de dispersión de forma gráfica:</p>
<div class="sourceCode" id="cb699"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb699-1"><a href="#cb699-1" aria-hidden="true" tabindex="-1"></a>mtcars.boxplot(column<span class="op">=</span><span class="st">&quot;mpg&quot;</span>,</span>
<span id="cb699-2"><a href="#cb699-2" aria-hidden="true" tabindex="-1"></a>               return_type<span class="op">=</span><span class="st">&#39;axes&#39;</span>,</span>
<span id="cb699-3"><a href="#cb699-3" aria-hidden="true" tabindex="-1"></a>               figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">8</span>))</span>
<span id="cb699-4"><a href="#cb699-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb699-5"><a href="#cb699-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Agregar texto</span></span>
<span id="cb699-6"><a href="#cb699-6" aria-hidden="true" tabindex="-1"></a>plt.text(x<span class="op">=</span><span class="fl">0.74</span>, y<span class="op">=</span><span class="fl">22.25</span>, s<span class="op">=</span><span class="st">&quot;3er cuartil&quot;</span>)</span>
<span id="cb699-7"><a href="#cb699-7" aria-hidden="true" tabindex="-1"></a>plt.text(x<span class="op">=</span><span class="fl">0.8</span>, y<span class="op">=</span><span class="fl">18.75</span>, s<span class="op">=</span><span class="st">&quot;Mediana&quot;</span>)</span>
<span id="cb699-8"><a href="#cb699-8" aria-hidden="true" tabindex="-1"></a>plt.text(x<span class="op">=</span><span class="fl">0.75</span>, y<span class="op">=</span><span class="fl">15.5</span>, s<span class="op">=</span><span class="st">&quot;Primer cuartil&quot;</span>)</span>
<span id="cb699-9"><a href="#cb699-9" aria-hidden="true" tabindex="-1"></a>plt.text(x<span class="op">=</span><span class="fl">0.9</span>, y<span class="op">=</span><span class="dv">10</span>, s<span class="op">=</span><span class="st">&quot;Min&quot;</span>)</span>
<span id="cb699-10"><a href="#cb699-10" aria-hidden="true" tabindex="-1"></a>plt.text(x<span class="op">=</span><span class="fl">0.9</span>, y<span class="op">=</span><span class="fl">33.5</span>, s<span class="op">=</span><span class="st">&quot;Max&quot;</span>)</span>
<span id="cb699-11"><a href="#cb699-11" aria-hidden="true" tabindex="-1"></a>plt.text(x<span class="op">=</span><span class="fl">0.7</span>, y<span class="op">=</span><span class="fl">19.5</span>, s<span class="op">=</span><span class="st">&quot;IQR&quot;</span>, rotation<span class="op">=</span><span class="dv">360</span>, size<span class="op">=</span><span class="dv">15</span>)<span class="op">;</span></span></code></pre></div>
<ul>
<li>La varianza y la desviación estándar son otras dos medidas comunes de la dispersión.</li>
<li>La varianza de una distribución es la media de las desviaciones (diferencias) al cuadrado de la media.</li>
<li>Utilice df.var() para comprobar la varianza:</li>
</ul>
<div class="sourceCode" id="cb700"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb700-1"><a href="#cb700-1" aria-hidden="true" tabindex="-1"></a>mtcars[<span class="st">&quot;mpg&quot;</span>].var()</span></code></pre></div>
<ul>
<li><p>La desviación estandar es la raíz cuadrada de la varianza.</p></li>
<li><p>La desviación estándar puede ser más interpretable que la varianza, ya que la desviación estándar se expresa en términos de las mismas unidades que la variable en cuestión, mientras que la varianza se expresa en términos de unidades al cuadrado.</p></li>
<li><p>Utilice df.std() para comprobar la desviación estándar:</p></li>
</ul>
<div class="sourceCode" id="cb701"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb701-1"><a href="#cb701-1" aria-hidden="true" tabindex="-1"></a>mtcars[<span class="st">&quot;mpg&quot;</span>].std()</span></code></pre></div>
<ul>
<li><p>Dado que tanto la varianza como la desviación estándar se derivan de la media, <strong>son susceptibles a la influencia de la asimetría de los datos y de los valores atípicos</strong>.</p></li>
<li><p>La desviación absoluta de la mediana es una medida alternativa de la dispersión basada en la mediana, que hereda la solidez de la mediana frente a la influencia de la asimetría y los valores atípicos.</p></li>
<li><p>Es la mediana del valor absoluto de las desviaciones de la mediana:</p></li>
</ul>
<div class="sourceCode" id="cb702"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb702-1"><a href="#cb702-1" aria-hidden="true" tabindex="-1"></a>abs_median_devs <span class="op">=</span> <span class="bu">abs</span>(mtcars[<span class="st">&quot;mpg&quot;</span>] <span class="op">-</span> mtcars[<span class="st">&quot;mpg&quot;</span>].median())</span>
<span id="cb702-2"><a href="#cb702-2" aria-hidden="true" tabindex="-1"></a>abs_median_devs.median()</span></code></pre></div>
</div>
<div id="asimetría-y-curtosis" class="section level4 hasAnchor" number="4.6.1.3">
<h4 class="hasAnchor"><span class="header-section-number">4.6.1.3</span> Asimetría y curtosis<a href="#asimetría-y-curtosis" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p>Además de las medidas de centro y dispersión, las estadísticas descriptivas incluyen medidas que dan una idea de la forma de una distribución.</p></li>
<li><p>La simetría mide el sesgo o la asimetría de una distribución, mientras que la curtosis mide la cantidad de datos que se encuentran en las colas de una distribución en comparación con el centro.</p></li>
<li><p>No vamos a entrar en los cálculos exactos que hay detrás de la asimetría y la curtosis, pero son esencialmente estadísticas que llevan la idea de la varianza un paso más allá: mientras que la varianza implica elevar al cuadrado las desviaciones de la media, la asimetría implica elevar al cubo las desviaciones de la media y la curtosis implica elevar las desviaciones de la media a la cuarta potencia.</p></li>
<li><p>Pandas ha incorporado funciones para comprobar la asimetría y la curtosis, df.skew() y df.kurt() respectivamente:</p></li>
</ul>
<div class="sourceCode" id="cb703"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb703-1"><a href="#cb703-1" aria-hidden="true" tabindex="-1"></a>mtcars[<span class="st">&quot;mpg&quot;</span>].skew()  <span class="co"># Simetría</span></span>
<span id="cb703-2"><a href="#cb703-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb703-3"><a href="#cb703-3" aria-hidden="true" tabindex="-1"></a>mtcars[<span class="st">&quot;mpg&quot;</span>].kurt()  <span class="co"># Kurtosis</span></span>
<span id="cb703-4"><a href="#cb703-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb703-5"><a href="#cb703-5" aria-hidden="true" tabindex="-1"></a>norm_data <span class="op">=</span> np.random.normal(size<span class="op">=</span><span class="dv">100000</span>)</span>
<span id="cb703-6"><a href="#cb703-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb703-7"><a href="#cb703-7" aria-hidden="true" tabindex="-1"></a>skewed_data <span class="op">=</span> np.concatenate((np.random.normal(size<span class="op">=</span><span class="dv">35000</span>)<span class="op">+</span><span class="dv">2</span>, </span>
<span id="cb703-8"><a href="#cb703-8" aria-hidden="true" tabindex="-1"></a>                             np.random.exponential(size<span class="op">=</span><span class="dv">65000</span>)), </span>
<span id="cb703-9"><a href="#cb703-9" aria-hidden="true" tabindex="-1"></a>                             axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb703-10"><a href="#cb703-10" aria-hidden="true" tabindex="-1"></a>uniform_data <span class="op">=</span> np.random.uniform(<span class="dv">0</span>,<span class="dv">2</span>, size<span class="op">=</span><span class="dv">100000</span>)</span>
<span id="cb703-11"><a href="#cb703-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb703-12"><a href="#cb703-12" aria-hidden="true" tabindex="-1"></a>peaked_data <span class="op">=</span> np.concatenate((np.random.exponential(size<span class="op">=</span><span class="dv">50000</span>),</span>
<span id="cb703-13"><a href="#cb703-13" aria-hidden="true" tabindex="-1"></a>                             np.random.exponential(size<span class="op">=</span><span class="dv">50000</span>)<span class="op">*</span>(<span class="op">-</span><span class="dv">1</span>)),</span>
<span id="cb703-14"><a href="#cb703-14" aria-hidden="true" tabindex="-1"></a>                             axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb703-15"><a href="#cb703-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb703-16"><a href="#cb703-16" aria-hidden="true" tabindex="-1"></a>data_df <span class="op">=</span> pd.DataFrame({<span class="st">&quot;norm&quot;</span>:norm_data,</span>
<span id="cb703-17"><a href="#cb703-17" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;skewed&quot;</span>:skewed_data,</span>
<span id="cb703-18"><a href="#cb703-18" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;uniform&quot;</span>:uniform_data,</span>
<span id="cb703-19"><a href="#cb703-19" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;peaked&quot;</span>:peaked_data})</span>
<span id="cb703-20"><a href="#cb703-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb703-21"><a href="#cb703-21" aria-hidden="true" tabindex="-1"></a>data_df.plot(kind<span class="op">=</span><span class="st">&quot;density&quot;</span>,</span>
<span id="cb703-22"><a href="#cb703-22" aria-hidden="true" tabindex="-1"></a>            figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>),</span>
<span id="cb703-23"><a href="#cb703-23" aria-hidden="true" tabindex="-1"></a>            xlim<span class="op">=</span>(<span class="op">-</span><span class="dv">5</span>,<span class="dv">5</span>))<span class="op">;</span></span></code></pre></div>
<p>Ahora vamos a comprobar la asimetría de cada una de las distribuciones. Dado que la simetría se mide con la asimetría, esperaríamos ver una asimetría baja para todas las distribuciones excepto la asimétrica, porque todas las demás son aproximadamente simétricas:</p>
<div class="sourceCode" id="cb704"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb704-1"><a href="#cb704-1" aria-hidden="true" tabindex="-1"></a>data_df.skew()</span></code></pre></div>
<p>Veamos la curtosis:</p>
<div class="sourceCode" id="cb705"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb705-1"><a href="#cb705-1" aria-hidden="true" tabindex="-1"></a>data_df.kurt()</span></code></pre></div>
<p>Como podemos ver en el resultado, los datos con distribución normal tienen una curtosis cercana a cero, la distribución plana tiene una curtosis negativa y las dos distribuciones con más datos en las colas frente al centro tienen mayor curtosis.</p>
<div class="figure">
<img src="attachment:image.png" alt="" />
<p class="caption">image.png</p>
</div>
</div>
<div id="resumen-sección-1" class="section level4 hasAnchor" number="4.6.1.4">
<h4 class="hasAnchor"><span class="header-section-number">4.6.1.4</span> Resumen sección 1<a href="#resumen-sección-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p>Las estadísticas descriptivas le ayudan a explorar las características de sus datos, como el centro, la dispersión y la forma, resumiéndolas con medidas numéricas.</p></li>
<li><p>Los estadísticos descriptivos ayudan a informar sobre la dirección de un análisis y le permiten comunicar sus ideas a otros de forma rápida y sencilla. Además, ciertos valores, como la media y la varianza, se utilizan en todo tipo de pruebas estadísticas y modelos predictivos.</p></li>
<li><p>Es importante hacer siempre una tabla con estos estadisticos al inicio de cualquier ejercicio de análisis de datos.</p></li>
</ul>
</div>
</div>
<div id="la-distribución-normal" class="section level3 hasAnchor" number="4.6.2">
<h3 class="hasAnchor"><span class="header-section-number">4.6.2</span> La distribución normal<a href="#la-distribución-normal" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><p>La normal o <a href="https://en.wikipedia.org/wiki/Normal_distribution">distribución gaussiana</a> es una distribución de probabilidad continua caracterizada por una curva simétrica en forma de campana.</p></li>
<li><p>Una distribución normal se define por su centro (media) y su dispersión (desviación estándar). La mayor parte de las observaciones generadas a partir de una distribución normal se sitúan cerca de la media, que se encuentra en el centro exacto de la distribución: como regla general, aproximadamente el 68% de los datos se sitúan dentro de una desviación estándar de la media, el 95% dentro de dos desviaciones estándar y el 99,8% dentro de tres desviaciones estándar.</p></li>
<li><p>La distribución normal es quizá la más importante de toda la estadística. Resulta que muchos fenómenos del mundo real, como las puntuaciones de los tests de inteligencia y las alturas humanas, siguen aproximadamente una distribución normal, por lo que se utiliza a menudo para modelar variables aleatorias. Muchas pruebas estadísticas comunes asumen que las distribuciones son normales.</p></li>
<li><p>El apodo de scipy para la distribución normal es norm. Vamos a investigar la distribución normal:</p></li>
</ul>
<div class="sourceCode" id="cb706"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb706-1"><a href="#cb706-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estas caracteristicas matematicas nos permiten saber la posición de ciertos valores</span></span>
<span id="cb706-2"><a href="#cb706-2" aria-hidden="true" tabindex="-1"></a>prob_under_minus1 <span class="op">=</span> stats.norm.cdf(x<span class="op">=</span> <span class="op">-</span><span class="dv">1</span>,  </span>
<span id="cb706-3"><a href="#cb706-3" aria-hidden="true" tabindex="-1"></a>                                loc <span class="op">=</span> <span class="dv">0</span>,               </span>
<span id="cb706-4"><a href="#cb706-4" aria-hidden="true" tabindex="-1"></a>                                scale <span class="op">=</span> <span class="dv">1</span>)     </span>
<span id="cb706-5"><a href="#cb706-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb706-6"><a href="#cb706-6" aria-hidden="true" tabindex="-1"></a>prob_over_1 <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> stats.norm.cdf(x <span class="op">=</span> <span class="dv">1</span>,  </span>
<span id="cb706-7"><a href="#cb706-7" aria-hidden="true" tabindex="-1"></a>                                loc <span class="op">=</span> <span class="dv">0</span>,               </span>
<span id="cb706-8"><a href="#cb706-8" aria-hidden="true" tabindex="-1"></a>                                scale<span class="op">=</span> <span class="dv">1</span>) </span>
<span id="cb706-9"><a href="#cb706-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb706-10"><a href="#cb706-10" aria-hidden="true" tabindex="-1"></a>between_prob <span class="op">=</span> <span class="dv">1</span><span class="op">-</span>(prob_under_minus1 <span class="op">+</span> prob_over_1)</span>
<span id="cb706-11"><a href="#cb706-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb706-12"><a href="#cb706-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(prob_under_minus1, prob_over_1, between_prob)</span></code></pre></div>
<p>El resultado muesta muestra que:</p>
<ul>
<li><p>Aproximadamente el 16% de los datos generados por una distribución normal con media 0 y desviación estándar 1 está por debajo de -1,</p></li>
<li><p>El 16% está por encima de 1 y el 68% se encuentra entre -1 y 1.</p></li>
<li><p>Lo anterior es coherente con la regla 68, 95, 99,7.</p></li>
<li><p>Grafiquemos la distribución normal e inspeccionemos las áreas que hemos calculado:</p></li>
</ul>
<div class="sourceCode" id="cb707"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb707-1"><a href="#cb707-1" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">&quot;figure.figsize&quot;</span>] <span class="op">=</span> (<span class="dv">9</span>,<span class="dv">9</span>)</span>
<span id="cb707-2"><a href="#cb707-2" aria-hidden="true" tabindex="-1"></a>                                  </span>
<span id="cb707-3"><a href="#cb707-3" aria-hidden="true" tabindex="-1"></a>plt.fill_between(x<span class="op">=</span>np.arange(<span class="op">-</span><span class="dv">4</span>,<span class="op">-</span><span class="dv">1</span>,<span class="fl">0.01</span>), </span>
<span id="cb707-4"><a href="#cb707-4" aria-hidden="true" tabindex="-1"></a>                 y1<span class="op">=</span> stats.norm.pdf(np.arange(<span class="op">-</span><span class="dv">4</span>,<span class="op">-</span><span class="dv">1</span>,<span class="fl">0.01</span>)) ,</span>
<span id="cb707-5"><a href="#cb707-5" aria-hidden="true" tabindex="-1"></a>                 facecolor<span class="op">=</span><span class="st">&#39;red&#39;</span>,</span>
<span id="cb707-6"><a href="#cb707-6" aria-hidden="true" tabindex="-1"></a>                 alpha<span class="op">=</span><span class="fl">0.35</span>)</span>
<span id="cb707-7"><a href="#cb707-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb707-8"><a href="#cb707-8" aria-hidden="true" tabindex="-1"></a>plt.fill_between(x<span class="op">=</span>np.arange(<span class="dv">1</span>,<span class="dv">4</span>,<span class="fl">0.01</span>), </span>
<span id="cb707-9"><a href="#cb707-9" aria-hidden="true" tabindex="-1"></a>                 y1<span class="op">=</span> stats.norm.pdf(np.arange(<span class="dv">1</span>,<span class="dv">4</span>,<span class="fl">0.01</span>)) ,</span>
<span id="cb707-10"><a href="#cb707-10" aria-hidden="true" tabindex="-1"></a>                 facecolor<span class="op">=</span><span class="st">&#39;red&#39;</span>,</span>
<span id="cb707-11"><a href="#cb707-11" aria-hidden="true" tabindex="-1"></a>                 alpha<span class="op">=</span><span class="fl">0.35</span>)</span>
<span id="cb707-12"><a href="#cb707-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb707-13"><a href="#cb707-13" aria-hidden="true" tabindex="-1"></a>plt.fill_between(x<span class="op">=</span>np.arange(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="fl">0.01</span>), </span>
<span id="cb707-14"><a href="#cb707-14" aria-hidden="true" tabindex="-1"></a>                 y1<span class="op">=</span> stats.norm.pdf(np.arange(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="fl">0.01</span>)) ,</span>
<span id="cb707-15"><a href="#cb707-15" aria-hidden="true" tabindex="-1"></a>                 facecolor<span class="op">=</span><span class="st">&#39;blue&#39;</span>,</span>
<span id="cb707-16"><a href="#cb707-16" aria-hidden="true" tabindex="-1"></a>                 alpha<span class="op">=</span><span class="fl">0.35</span>)</span>
<span id="cb707-17"><a href="#cb707-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb707-18"><a href="#cb707-18" aria-hidden="true" tabindex="-1"></a>plt.text(x<span class="op">=-</span><span class="fl">1.8</span>, y<span class="op">=</span><span class="fl">0.03</span>, s<span class="op">=</span> <span class="bu">round</span>(prob_under_minus1,<span class="dv">3</span>))</span>
<span id="cb707-19"><a href="#cb707-19" aria-hidden="true" tabindex="-1"></a>plt.text(x<span class="op">=-</span><span class="fl">0.2</span>, y<span class="op">=</span><span class="fl">0.1</span>, s<span class="op">=</span> <span class="bu">round</span>(between_prob,<span class="dv">3</span>))</span>
<span id="cb707-20"><a href="#cb707-20" aria-hidden="true" tabindex="-1"></a>plt.text(x<span class="op">=</span><span class="fl">1.4</span>, y<span class="op">=</span><span class="fl">0.03</span>, s<span class="op">=</span> <span class="bu">round</span>(prob_over_1,<span class="dv">3</span>))<span class="op">;</span></span></code></pre></div>
<div class="figure">
<img src="attachment:image.png" alt="" />
<p class="caption">image.png</p>
</div>
<ul>
<li><p>El gráfico anterior muestra la forma de campana de la distribución normal, el área por debajo y por encima de una desviación estándar y el área dentro de una desviación estándar de la media.</p></li>
<li><p>Encontrar los cuantiles de la distribución normal es una tarea común cuando se realizan pruebas estadísticas. Puede comprobar los cuantiles de la distribución normal con stats.norm.ppf():</p></li>
</ul>
<div class="sourceCode" id="cb708"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb708-1"><a href="#cb708-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(stats.norm.ppf(q<span class="op">=</span><span class="fl">0.50</span>))</span>
<span id="cb708-2"><a href="#cb708-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb708-3"><a href="#cb708-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(stats.norm.ppf(q<span class="op">=</span><span class="fl">0.975</span>) )</span></code></pre></div>
<ul>
<li>El resultado del cuantil anterior confirma que aproximadamente el 5% de los datos se encuentra a más de 2 desviaciones estándar de la media.</li>
<li>Esto es conocido como el valor z. Básicamente una medida de cuantas desviaciones estandar un punto esta alejado sobre la media.</li>
</ul>
<div id="de-una-muestra-aleatoria-a-la-población" class="section level4 hasAnchor" number="4.6.2.1">
<h4 class="hasAnchor"><span class="header-section-number">4.6.2.1</span> De una muestra aleatoria a la población<a href="#de-una-muestra-aleatoria-a-la-población" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p>Hasta ahora, esta guía se ha centrado en las funciones y la sintaxis necesarias para manipular, explorar y describir los datos.</p></li>
<li><p>La limpieza de datos y el análisis exploratorio son a menudo pasos preliminares hacia el objetivo final de extraer información de los datos a través de la inferencia estadística o el modelado predictivo.</p></li>
<li><p>La inferencia estadística es el proceso de análisis de datos de muestra para obtener información sobre la población de la que se recogieron los datos y para investigar las diferencias entre las muestras de datos.</p></li>
<li><p>En el análisis de datos, a menudo estamos interesados en las características de alguna población grande, pero recoger datos de toda la población puede ser inviable.</p></li>
</ul>
</div>
<div id="estimaciones-puntuales" class="section level4 hasAnchor" number="4.6.2.2">
<h4 class="hasAnchor"><span class="header-section-number">4.6.2.2</span> Estimaciones puntuales<a href="#estimaciones-puntuales" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p>Las estimaciones puntuales son estimaciones de los parámetros de la población basadas en datos de la muestra.</p></li>
<li><p>Por ejemplo, si quisiéramos saber la edad media de los votantes podríamos realizar una encuesta entre los votantes registrados y utilizar la edad media de los encuestados como una estimación puntual de la edad media de la población en su conjunto. La media de una muestra se conoce como media muestral.</p></li>
<li><p>La media de la muestra no suele ser exactamente igual a la media de la población. Esta diferencia puede deberse a muchos factores, como un diseño deficiente de la encuesta, métodos de muestreo sesgados y la aleatoriedad inherente a la extracción de una muestra de una población.</p></li>
<li><p>Investiguemos las estimaciones puntuales generando una población de datos de edad aleatorios y extrayendo luego una muestra de ella para estimar la media:</p></li>
</ul>
<div class="sourceCode" id="cb709"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb709-1"><a href="#cb709-1" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">10</span>)</span>
<span id="cb709-2"><a href="#cb709-2" aria-hidden="true" tabindex="-1"></a>population_ages1 <span class="op">=</span> stats.poisson.rvs(loc<span class="op">=</span><span class="dv">18</span>, mu<span class="op">=</span><span class="dv">35</span>, size<span class="op">=</span><span class="dv">150000</span>)</span>
<span id="cb709-3"><a href="#cb709-3" aria-hidden="true" tabindex="-1"></a>population_ages2 <span class="op">=</span> stats.poisson.rvs(loc<span class="op">=</span><span class="dv">18</span>, mu<span class="op">=</span><span class="dv">10</span>, size<span class="op">=</span><span class="dv">100000</span>)</span>
<span id="cb709-4"><a href="#cb709-4" aria-hidden="true" tabindex="-1"></a>population_ages <span class="op">=</span> np.concatenate((population_ages1, population_ages2))</span>
<span id="cb709-5"><a href="#cb709-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb709-6"><a href="#cb709-6" aria-hidden="true" tabindex="-1"></a>population_ages</span>
<span id="cb709-7"><a href="#cb709-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb709-8"><a href="#cb709-8" aria-hidden="true" tabindex="-1"></a>population_ages.mean()</span>
<span id="cb709-9"><a href="#cb709-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb709-10"><a href="#cb709-10" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">6</span>)</span>
<span id="cb709-11"><a href="#cb709-11" aria-hidden="true" tabindex="-1"></a>sample_ages <span class="op">=</span> np.random.choice(a<span class="op">=</span> population_ages,</span>
<span id="cb709-12"><a href="#cb709-12" aria-hidden="true" tabindex="-1"></a>                               size<span class="op">=</span><span class="dv">500</span>)            <span class="co"># Muestra aleatoria</span></span>
<span id="cb709-13"><a href="#cb709-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb709-14"><a href="#cb709-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> ( sample_ages.mean() )                         <span class="co"># Media muestral</span></span>
<span id="cb709-15"><a href="#cb709-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb709-16"><a href="#cb709-16" aria-hidden="true" tabindex="-1"></a>population_ages.mean() <span class="op">-</span> sample_ages.mean()   <span class="co"># Miremos la diferencia</span></span></code></pre></div>
<ul>
<li><p>Nuestra estimación puntual basada en una muestra aleatoria de 500 individuos subestima la verdadera media de la población en 0,6 años, pero se aproxima.</p></li>
<li><p>Esto ilustra un punto importante: podemos obtener una estimación bastante precisa de una gran población mediante el muestreo e un subconjunto relativamente pequeño de individuos.</p></li>
<li><p>Otra estimación puntual que puede ser de interés es la proporción de la población que pertenece a alguna categoría o subgrupo.</p></li>
<li><p>Por ejemplo, nos gustaría saber la ocupación de cada votante que encuestamos, para tener una idea de la demografía general de la base de votantes. Se puede hacer una estimación puntual de este tipo de proporción tomando una muestra y comprobando después la proporción en la muestra:</p></li>
</ul>
<div class="sourceCode" id="cb710"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb710-1"><a href="#cb710-1" aria-hidden="true" tabindex="-1"></a>random.seed(<span class="dv">10</span>)</span>
<span id="cb710-2"><a href="#cb710-2" aria-hidden="true" tabindex="-1"></a>population_occ <span class="op">=</span> ([<span class="st">&quot;occ1&quot;</span>]<span class="op">*</span><span class="dv">100000</span>) <span class="op">+</span> ([<span class="st">&quot;occ2&quot;</span>]<span class="op">*</span><span class="dv">50000</span>) <span class="op">+\</span></span>
<span id="cb710-3"><a href="#cb710-3" aria-hidden="true" tabindex="-1"></a>                   ([<span class="st">&quot;occ3&quot;</span>]<span class="op">*</span><span class="dv">50000</span>) <span class="op">+</span> ([<span class="st">&quot;occ4&quot;</span>]<span class="op">*</span><span class="dv">25000</span>) <span class="op">+\</span></span>
<span id="cb710-4"><a href="#cb710-4" aria-hidden="true" tabindex="-1"></a>                   ([<span class="st">&quot;occ5&quot;</span>]<span class="op">*</span><span class="dv">25000</span>)</span>
<span id="cb710-5"><a href="#cb710-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb710-6"><a href="#cb710-6" aria-hidden="true" tabindex="-1"></a>demo_sample <span class="op">=</span> random.sample(population_occ, <span class="dv">1000</span>)   <span class="co"># muestra aleatoria</span></span>
<span id="cb710-7"><a href="#cb710-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb710-8"><a href="#cb710-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> occ <span class="kw">in</span> <span class="bu">set</span>(demo_sample):</span>
<span id="cb710-9"><a href="#cb710-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>( occ <span class="op">+</span> <span class="st">&quot; proportion estimate:&quot;</span> )</span>
<span id="cb710-10"><a href="#cb710-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>( demo_sample.count(occ)<span class="op">/</span><span class="dv">1000</span> )</span></code></pre></div>
<ul>
<li>Obsérvese que las estimaciones de las proporciones se acercan a las verdaderas proporciones de la población subyacente.</li>
</ul>
</div>
<div id="distribuciones-de-muestreo-y-el-teorema-del-límite-central" class="section level4 hasAnchor" number="4.6.2.3">
<h4 class="hasAnchor"><span class="header-section-number">4.6.2.3</span> Distribuciones de muestreo y el teorema del límite central<a href="#distribuciones-de-muestreo-y-el-teorema-del-límite-central" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p>Muchos procedimientos estadísticos asumen que los datos siguen una distribución normal, porque la distribución normal tiene buenas propiedades como la simetría y que la mayoría de los datos se agrupan dentro de unas pocas desviaciones estándar de la media.</p></li>
<li><p>Los datos del mundo real no suelen tener una distribución normal y la distribución de una muestra tiende a reflejar la distribución de la población.</p></li>
<li><p>Esto significa que una muestra tomada de una población con una distribución sesgada también tenderá a ser sesgada. Vamos a investigarlo trazando los datos y la muestra que hemos creado antes y comprobando la inclinación:</p></li>
</ul>
<div class="sourceCode" id="cb711"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb711-1"><a href="#cb711-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(population_ages).hist(bins<span class="op">=</span><span class="dv">58</span>,</span>
<span id="cb711-2"><a href="#cb711-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="bu">range</span><span class="op">=</span>(<span class="fl">17.5</span>,<span class="fl">75.5</span>),</span>
<span id="cb711-3"><a href="#cb711-3" aria-hidden="true" tabindex="-1"></a>                                  figsize<span class="op">=</span>(<span class="dv">9</span>,<span class="dv">9</span>))</span>
<span id="cb711-4"><a href="#cb711-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb711-5"><a href="#cb711-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(stats.skew(population_ages))</span></code></pre></div>
<ul>
<li><p>La distribución tiene poca asimetría, pero el gráfico revela que los datos no son claramente normales:</p>
<ul>
<li>en lugar de una curva de campana simétrica, tiene una distribución bimodal con dos picos de alta densidad.</li>
<li>La muestra que extrajimos de esta población debería tener aproximadamente la misma forma y asimetría:</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb712"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb712-1"><a href="#cb712-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(sample_ages).hist(bins<span class="op">=</span><span class="dv">58</span>,</span>
<span id="cb712-2"><a href="#cb712-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="bu">range</span><span class="op">=</span>(<span class="fl">17.5</span>,<span class="fl">75.5</span>),</span>
<span id="cb712-3"><a href="#cb712-3" aria-hidden="true" tabindex="-1"></a>                                  figsize<span class="op">=</span>(<span class="dv">9</span>,<span class="dv">9</span>))<span class="op">;</span></span>
<span id="cb712-4"><a href="#cb712-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb712-5"><a href="#cb712-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(stats.skew(sample_ages))</span></code></pre></div>
<ul>
<li><p>La muestra tiene aproximadamente la misma forma que la población subyacente. Esto sugiere que no podemos aplicar las técnicas que suponen una distribución normal a este conjunto de datos, ya que no es normal.</p></li>
<li><p>En realidad, sí podemos, gracias al teorema del límite central.</p></li>
<li><p>El teorema del límite central es uno de los resultados más importantes de la teoría de la probabilidad y sirve de base a muchos métodos de análisis estadístico.</p></li>
<li><p>El teorema afirma que la distribución de muchas medias muestrales, conocida como distribución muestral, se distribuirá normalmente. Esta regla es válida incluso si la propia distribución subyacente no está distribuida normalmente. En consecuencia, podemos tratar la media muestral como si se dibujara una distribución normal.</p></li>
<li><p>Para ilustrarlo, creemos una distribución de muestreo tomando 200 muestras de nuestra población y haciendo luego 200 estimaciones puntuales de la media:</p></li>
</ul>
<div class="sourceCode" id="cb713"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb713-1"><a href="#cb713-1" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">10</span>)</span>
<span id="cb713-2"><a href="#cb713-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb713-3"><a href="#cb713-3" aria-hidden="true" tabindex="-1"></a>point_estimates <span class="op">=</span> []         <span class="co"># Lista vacía</span></span>
<span id="cb713-4"><a href="#cb713-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb713-5"><a href="#cb713-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2000</span>):         <span class="co"># Generamos 200 muestras aleatorias </span></span>
<span id="cb713-6"><a href="#cb713-6" aria-hidden="true" tabindex="-1"></a>    sample <span class="op">=</span> np.random.choice(a<span class="op">=</span> population_ages, size<span class="op">=</span><span class="dv">500</span>)</span>
<span id="cb713-7"><a href="#cb713-7" aria-hidden="true" tabindex="-1"></a>    point_estimates.append(sample.mean())</span>
<span id="cb713-8"><a href="#cb713-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb713-9"><a href="#cb713-9" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(point_estimates).plot(kind<span class="op">=</span><span class="st">&quot;density&quot;</span>,  <span class="co"># Graficamos la media</span></span>
<span id="cb713-10"><a href="#cb713-10" aria-hidden="true" tabindex="-1"></a>                                   figsize<span class="op">=</span>(<span class="dv">9</span>,<span class="dv">9</span>),</span>
<span id="cb713-11"><a href="#cb713-11" aria-hidden="true" tabindex="-1"></a>                                   xlim<span class="op">=</span>(<span class="dv">41</span>,<span class="dv">45</span>))<span class="op">;</span></span></code></pre></div>
<ul>
<li><p>La distribución del muestreo parece ser aproximadamente normal, a pesar de la distribución bimodal de la población de la que se extrajeron las muestras.</p></li>
<li><p>Además, la media de la distribución muestral se aproxima a la media real de la población:</p></li>
</ul>
<div class="sourceCode" id="cb714"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb714-1"><a href="#cb714-1" aria-hidden="true" tabindex="-1"></a>population_ages.mean() <span class="op">-</span> np.array(point_estimates).mean()</span></code></pre></div>
<p>Cuantas más muestras tomemos, mejor será nuestra estimación del parámetro poblacional. La media muestral converge a la media poblacional.</p>
<div class="sourceCode" id="cb715"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb715-1"><a href="#cb715-1" aria-hidden="true" tabindex="-1"></a>population_ages.mean()</span></code></pre></div>
</div>
<div id="intervalos-de-confianza" class="section level4 hasAnchor" number="4.6.2.4">
<h4 class="hasAnchor"><span class="header-section-number">4.6.2.4</span> Intervalos de confianza<a href="#intervalos-de-confianza" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p>Una estimación puntual puede dar una idea aproximada de un parámetro de la población, como la media, pero las estimaciones son propensas a errores y puede que no sea factible tomar múltiples muestras para obtener mejores estimaciones.</p></li>
<li><p>Un intervalo de confianza es un rango de valores por encima y por debajo de una estimación puntual que capta el verdadero parámetro de la población con un nivel de confianza predeterminado.</p></li>
<li><p>Por ejemplo, si quiere tener un 95% de posibilidades de capturar el verdadero parámetro de la población con una estimación puntual y un intervalo de confianza correspondiente, establecería su nivel de confianza en el 95%. Los niveles de confianza más altos dan lugar a intervalos de confianza más amplios.</p></li>
<li><p>Calcule un intervalo de confianza tomando una estimación puntual y luego sumando y restando un margen de error para crear un rango. El margen de error se basa en el nivel de confianza deseado, la dispersión de los datos y el tamaño de la muestra. La forma de calcular el margen de error depende de si se conoce la desviación estándar de la población o no.</p></li>
<li><p>El IC resultante nos dice que si repetimos la aleatorización múltiples veces, el 95% de los intervalos de confianza que generemos contendrán el valor real. Un IC de un 95% <strong>no significa</strong> que hay un 95% de probabilidades que el valor real se encuentre en un intervalo de confianza particular.</p></li>
<li><p>Si conoce la desviación estándar de la población, el margen de error es igual a:</p></li>
</ul>
<p><span class="math display">\[z * \frac{\sigma}{\sqrt{n}}\]</span></p>
<ul>
<li><p>Donde σ (sigma) es la desviación estándar de la población, n es el tamaño de la muestra, y z es un número conocido como el valor crítico z.</p></li>
<li><p>El valor z-crítico es el número de desviaciones estándar que habría que alejar de la media de la distribución normal para capturar la proporción de los datos asociada al nivel de confianza deseado. Por ejemplo, sabemos que aproximadamente el 95% de los datos de una distribución normal se encuentra dentro de 2 desviaciones estándar de la media, por lo que podríamos utilizar 2 como valor z-crítico para un intervalo de confianza del 95% (aunque es más exacto obtener los valores z-críticos con stats.norm.ppf().).</p></li>
<li><p>Calculemos un 95% de confianza para nuestra estimación puntual de la media:</p></li>
</ul>
<div class="sourceCode" id="cb716"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb716-1"><a href="#cb716-1" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">10</span>)</span>
<span id="cb716-2"><a href="#cb716-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb716-3"><a href="#cb716-3" aria-hidden="true" tabindex="-1"></a>sample_size <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb716-4"><a href="#cb716-4" aria-hidden="true" tabindex="-1"></a>sample <span class="op">=</span> np.random.choice(a<span class="op">=</span> population_ages, size <span class="op">=</span> sample_size)</span>
<span id="cb716-5"><a href="#cb716-5" aria-hidden="true" tabindex="-1"></a>sample_mean <span class="op">=</span> sample.mean()</span>
<span id="cb716-6"><a href="#cb716-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb716-7"><a href="#cb716-7" aria-hidden="true" tabindex="-1"></a>z_critical <span class="op">=</span> stats.norm.ppf(q <span class="op">=</span> <span class="fl">0.975</span>)  <span class="co"># Valor critico*</span></span>
<span id="cb716-8"><a href="#cb716-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb716-9"><a href="#cb716-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;z-critical value:&quot;</span>)              <span class="co"># Miramos el valor critico</span></span>
<span id="cb716-10"><a href="#cb716-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(z_critical)                        </span>
<span id="cb716-11"><a href="#cb716-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb716-12"><a href="#cb716-12" aria-hidden="true" tabindex="-1"></a>pop_stdev <span class="op">=</span> population_ages.std()  <span class="co"># Get the population standard deviation</span></span>
<span id="cb716-13"><a href="#cb716-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb716-14"><a href="#cb716-14" aria-hidden="true" tabindex="-1"></a>margin_of_error <span class="op">=</span> z_critical <span class="op">*</span> (pop_stdev<span class="op">/</span>math.sqrt(sample_size))</span>
<span id="cb716-15"><a href="#cb716-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb716-16"><a href="#cb716-16" aria-hidden="true" tabindex="-1"></a>confidence_interval <span class="op">=</span> (sample_mean <span class="op">-</span> margin_of_error,</span>
<span id="cb716-17"><a href="#cb716-17" aria-hidden="true" tabindex="-1"></a>                       sample_mean <span class="op">+</span> margin_of_error)  </span>
<span id="cb716-18"><a href="#cb716-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb716-19"><a href="#cb716-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Confidence interval:&quot;</span>)</span>
<span id="cb716-20"><a href="#cb716-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(confidence_interval)</span>
<span id="cb716-21"><a href="#cb716-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb716-22"><a href="#cb716-22" aria-hidden="true" tabindex="-1"></a>sample_mean</span></code></pre></div>
<ul>
<li><p><strong>Nota</strong>: Utilizamos stats.norm.ppf(q = 0,975) para obtener el valor z-crítico deseado en lugar de q = 0,95 porque la distribución tiene dos colas.</p></li>
<li><p>Observa que el intervalo de confianza que hemos calculado captura la verdadera media poblacional de 43,0023.</p></li>
<li><p>Vamos a crear varios intervalos de confianza y a trazarlos para tener una mejor idea de lo que significa “capturar” el verdadero valor</p></li>
</ul>
<div class="sourceCode" id="cb717"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb717-1"><a href="#cb717-1" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">12</span>)</span>
<span id="cb717-2"><a href="#cb717-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb717-3"><a href="#cb717-3" aria-hidden="true" tabindex="-1"></a>sample_size <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb717-4"><a href="#cb717-4" aria-hidden="true" tabindex="-1"></a>intervals <span class="op">=</span> []</span>
<span id="cb717-5"><a href="#cb717-5" aria-hidden="true" tabindex="-1"></a>sample_means <span class="op">=</span> []</span>
<span id="cb717-6"><a href="#cb717-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb717-7"><a href="#cb717-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> sample <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">25</span>):</span>
<span id="cb717-8"><a href="#cb717-8" aria-hidden="true" tabindex="-1"></a>    sample <span class="op">=</span> np.random.choice(a<span class="op">=</span> population_ages, size <span class="op">=</span> sample_size)</span>
<span id="cb717-9"><a href="#cb717-9" aria-hidden="true" tabindex="-1"></a>    sample_mean <span class="op">=</span> sample.mean()</span>
<span id="cb717-10"><a href="#cb717-10" aria-hidden="true" tabindex="-1"></a>    sample_means.append(sample_mean)</span>
<span id="cb717-11"><a href="#cb717-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb717-12"><a href="#cb717-12" aria-hidden="true" tabindex="-1"></a>    z_critical <span class="op">=</span> stats.norm.ppf(q <span class="op">=</span> <span class="fl">0.975</span>)  <span class="co"># Get the z-critical value*         </span></span>
<span id="cb717-13"><a href="#cb717-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb717-14"><a href="#cb717-14" aria-hidden="true" tabindex="-1"></a>    pop_stdev <span class="op">=</span> population_ages.std()  <span class="co"># Get the population standard deviation</span></span>
<span id="cb717-15"><a href="#cb717-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb717-16"><a href="#cb717-16" aria-hidden="true" tabindex="-1"></a>    stats.norm.ppf(q <span class="op">=</span> <span class="fl">0.025</span>)</span>
<span id="cb717-17"><a href="#cb717-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb717-18"><a href="#cb717-18" aria-hidden="true" tabindex="-1"></a>    margin_of_error <span class="op">=</span> z_critical <span class="op">*</span> (pop_stdev<span class="op">/</span>math.sqrt(sample_size))</span>
<span id="cb717-19"><a href="#cb717-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb717-20"><a href="#cb717-20" aria-hidden="true" tabindex="-1"></a>    confidence_interval <span class="op">=</span> (sample_mean <span class="op">-</span> margin_of_error,</span>
<span id="cb717-21"><a href="#cb717-21" aria-hidden="true" tabindex="-1"></a>                           sample_mean <span class="op">+</span> margin_of_error)  </span>
<span id="cb717-22"><a href="#cb717-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb717-23"><a href="#cb717-23" aria-hidden="true" tabindex="-1"></a>    intervals.append(confidence_interval)</span>
<span id="cb717-24"><a href="#cb717-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb717-25"><a href="#cb717-25" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">9</span>,<span class="dv">9</span>))</span>
<span id="cb717-26"><a href="#cb717-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb717-27"><a href="#cb717-27" aria-hidden="true" tabindex="-1"></a>plt.errorbar(x<span class="op">=</span>np.arange(<span class="fl">0.1</span>, <span class="dv">25</span>, <span class="dv">1</span>), </span>
<span id="cb717-28"><a href="#cb717-28" aria-hidden="true" tabindex="-1"></a>             y<span class="op">=</span>sample_means, </span>
<span id="cb717-29"><a href="#cb717-29" aria-hidden="true" tabindex="-1"></a>             yerr<span class="op">=</span>[(top<span class="op">-</span>bot)<span class="op">/</span><span class="dv">2</span> <span class="cf">for</span> top,bot <span class="kw">in</span> intervals],</span>
<span id="cb717-30"><a href="#cb717-30" aria-hidden="true" tabindex="-1"></a>             fmt<span class="op">=</span><span class="st">&#39;o&#39;</span>)</span>
<span id="cb717-31"><a href="#cb717-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb717-32"><a href="#cb717-32" aria-hidden="true" tabindex="-1"></a>plt.hlines(xmin<span class="op">=</span><span class="dv">0</span>, xmax<span class="op">=</span><span class="dv">25</span>,</span>
<span id="cb717-33"><a href="#cb717-33" aria-hidden="true" tabindex="-1"></a>           y<span class="op">=</span><span class="fl">43.0023</span>, </span>
<span id="cb717-34"><a href="#cb717-34" aria-hidden="true" tabindex="-1"></a>           linewidth<span class="op">=</span><span class="fl">2.0</span>,</span>
<span id="cb717-35"><a href="#cb717-35" aria-hidden="true" tabindex="-1"></a>           color<span class="op">=</span><span class="st">&quot;red&quot;</span>)<span class="op">;</span></span></code></pre></div>
<ul>
<li><p>Observe que en el gráfico anterior, todos los intervalos de confianza del 95%, excepto uno, se superponen a la línea roja que marca la media real.</p></li>
<li><p>Esto es de esperar: dado que un intervalo de confianza del 95% capta la media real el 95% de las veces, es de esperar que nuestro intervalo no capte la media real el 5% de las veces.</p></li>
<li><p>Si no se conoce la desviación estandar de la población, hay que utilizar la desviación estandar de la muestra para crear intervalos de confianza.</p></li>
<li><p>Dado que la desviación estándar de la muestra puede no coincidir con el parámetro de la población, el intervalo tendrá más error cuando no se conozca la desviación estándar de la población. Para tener en cuenta este error, utilizamos lo que se conoce como valor crítico t en lugar del valor crítico z.</p></li>
<li><p>El valor crítico t se extrae de lo que se conoce como distribución t, una distribución que se asemeja mucho a la distribución normal pero que se hace cada vez más amplia a medida que disminuye el tamaño de la muestra. La distribución t está disponible en scipy.stats con el nombre de “t” para que podamos obtener los valores críticos de t con stats.t.ppf().</p></li>
<li><p>Tomemos una nueva muestra más pequeña y luego creemos un intervalo de confianza sin la desviación estándar de la población, utilizando la distribución t:</p></li>
</ul>
<div class="sourceCode" id="cb718"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb718-1"><a href="#cb718-1" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">10</span>)</span>
<span id="cb718-2"><a href="#cb718-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb718-3"><a href="#cb718-3" aria-hidden="true" tabindex="-1"></a>sample_size <span class="op">=</span> <span class="dv">25</span></span>
<span id="cb718-4"><a href="#cb718-4" aria-hidden="true" tabindex="-1"></a>sample <span class="op">=</span> np.random.choice(a<span class="op">=</span> population_ages, size <span class="op">=</span> sample_size)</span>
<span id="cb718-5"><a href="#cb718-5" aria-hidden="true" tabindex="-1"></a>sample_mean <span class="op">=</span> sample.mean()</span>
<span id="cb718-6"><a href="#cb718-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb718-7"><a href="#cb718-7" aria-hidden="true" tabindex="-1"></a>t_critical <span class="op">=</span> stats.t.ppf(q <span class="op">=</span> <span class="fl">0.975</span>, df<span class="op">=</span><span class="dv">24</span>)  <span class="co"># Valor t*</span></span>
<span id="cb718-8"><a href="#cb718-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb718-9"><a href="#cb718-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;t-critical value:&quot;</span>)                  <span class="co"># Chequear valor t</span></span>
<span id="cb718-10"><a href="#cb718-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(t_critical)                        </span>
<span id="cb718-11"><a href="#cb718-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb718-12"><a href="#cb718-12" aria-hidden="true" tabindex="-1"></a>sample_stdev <span class="op">=</span> sample.std(ddof<span class="op">=</span><span class="dv">1</span>)    <span class="co"># Obtenemos desv estandar muestral</span></span>
<span id="cb718-13"><a href="#cb718-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb718-14"><a href="#cb718-14" aria-hidden="true" tabindex="-1"></a>sigma <span class="op">=</span> sample_stdev<span class="op">/</span>math.sqrt(sample_size)  <span class="co"># estimamos </span></span>
<span id="cb718-15"><a href="#cb718-15" aria-hidden="true" tabindex="-1"></a>margin_of_error <span class="op">=</span> t_critical <span class="op">*</span> sigma</span>
<span id="cb718-16"><a href="#cb718-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb718-17"><a href="#cb718-17" aria-hidden="true" tabindex="-1"></a>confidence_interval <span class="op">=</span> (sample_mean <span class="op">-</span> margin_of_error,</span>
<span id="cb718-18"><a href="#cb718-18" aria-hidden="true" tabindex="-1"></a>                       sample_mean <span class="op">+</span> margin_of_error)  </span>
<span id="cb718-19"><a href="#cb718-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb718-20"><a href="#cb718-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Confidence interval:&quot;</span>)</span>
<span id="cb718-21"><a href="#cb718-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(confidence_interval)</span></code></pre></div>
<ul>
<li><p><strong>Nota</strong>: cuando se utiliza la distribución t, hay que proporcionar los grados de libertad (df). Para este tipo de prueba, los grados de libertad son iguales al tamaño de la muestra menos 1. Si el tamaño de la muestra es grande, la distribución t se aproxima a la distribución normal.</p></li>
<li><p>Observe que el valor crítico de t es mayor que el valor crítico de z que utilizamos para el intervalo de confianza del 95%. Esto permite que el intervalo de confianza arroje una red más grande para compensar la variabilidad causada por el uso de la desviación estándar de la muestra en lugar de la desviación estándar de la población. El resultado final es un intervalo de confianza mucho más amplio (un intervalo con un mayor margen de error).</p></li>
<li><p>Si tiene una muestra grande, el valor crítico t se acercará al valor crítico z, por lo que hay poca diferencia entre utilizar la distribución normal frente a la distribución t:</p></li>
</ul>
<div class="sourceCode" id="cb719"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb719-1"><a href="#cb719-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Chequeamos la diferencia entre valores criticos con un tamaño muestral de 1000</span></span>
<span id="cb719-2"><a href="#cb719-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb719-3"><a href="#cb719-3" aria-hidden="true" tabindex="-1"></a>stats.t.ppf(q<span class="op">=</span><span class="fl">0.975</span>, df<span class="op">=</span> <span class="dv">999</span>) <span class="op">-</span> stats.norm.ppf(<span class="fl">0.975</span>)</span>
<span id="cb719-4"><a href="#cb719-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb719-5"><a href="#cb719-5" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;En lugar de calcular un intervalo de confianza para una estimación puntual de la media a mano, puede calcularlo utilizando la función de Python stats.t.interval():</span></span></code></pre></div>
<div class="sourceCode" id="cb720"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb720-1"><a href="#cb720-1" aria-hidden="true" tabindex="-1"></a>stats.t.interval(alpha <span class="op">=</span> <span class="fl">0.95</span>,              <span class="co"># Nivel de confianza</span></span>
<span id="cb720-2"><a href="#cb720-2" aria-hidden="true" tabindex="-1"></a>                 df<span class="op">=</span> <span class="dv">24</span>,                    <span class="co"># Grados de libertad</span></span>
<span id="cb720-3"><a href="#cb720-3" aria-hidden="true" tabindex="-1"></a>                 loc <span class="op">=</span> sample_mean,         <span class="co"># Media muestral</span></span>
<span id="cb720-4"><a href="#cb720-4" aria-hidden="true" tabindex="-1"></a>                 scale <span class="op">=</span> sigma)             <span class="co"># Desviación estandar muestral</span></span></code></pre></div>
<p>También podemos hacer un intervalo de confianza para una estimación puntual de una proporción poblacional. En este caso, el margen de error es igual a</p>
<p><span class="math display">\[z * \sqrt{\frac{p(1-p)}{n}}\]</span></p>
<p>Donde z es el valor crítico de z para nuestro nivel de confianza, p es la estimación puntual de la proporción poblacional y n es el tamaño de la muestra. Calculemos un intervalo de confianza del 95% para los de ocupación 3 según la proporción de la muestra que hemos calculado antes (0,192):</p>
<div class="sourceCode" id="cb721"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb721-1"><a href="#cb721-1" aria-hidden="true" tabindex="-1"></a>z_critical <span class="op">=</span> stats.norm.ppf(<span class="fl">0.975</span>)      <span class="co"># Valor critico</span></span>
<span id="cb721-2"><a href="#cb721-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb721-3"><a href="#cb721-3" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="fl">0.192</span>                               <span class="co"># Estimación puntual de la proporción</span></span>
<span id="cb721-4"><a href="#cb721-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb721-5"><a href="#cb721-5" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="dv">1000</span>                                <span class="co"># Tamaño muestral</span></span>
<span id="cb721-6"><a href="#cb721-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb721-7"><a href="#cb721-7" aria-hidden="true" tabindex="-1"></a>margin_of_error <span class="op">=</span> z_critical <span class="op">*</span> math.sqrt((p<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>p))<span class="op">/</span>n)</span>
<span id="cb721-8"><a href="#cb721-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb721-9"><a href="#cb721-9" aria-hidden="true" tabindex="-1"></a>confidence_interval <span class="op">=</span> (p <span class="op">-</span> margin_of_error,  <span class="co"># Intervalo de confianza</span></span>
<span id="cb721-10"><a href="#cb721-10" aria-hidden="true" tabindex="-1"></a>                       p <span class="op">+</span> margin_of_error) </span>
<span id="cb721-11"><a href="#cb721-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb721-12"><a href="#cb721-12" aria-hidden="true" tabindex="-1"></a>confidence_interval</span></code></pre></div>
<ul>
<li><p>El resultado muestra que el intervalo de confianza capturó el verdadero parámetro poblacional de 0,2.</p></li>
<li><p>De forma similar a nuestras estimaciones puntuales de la media de la población, podemos utilizar la función scipy stats.distribution.interval() para calcular un intervalo de confianza para una proporción de la población para nosotros.</p></li>
<li><p>En este caso estamos trabajando con valores z-críticos por lo que queremos trabajar con la distribución normal en lugar de la distribución t:</p></li>
</ul>
<div class="sourceCode" id="cb722"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb722-1"><a href="#cb722-1" aria-hidden="true" tabindex="-1"></a>stats.norm.interval(alpha <span class="op">=</span> <span class="fl">0.95</span>,    <span class="co"># Nivel de confianza           </span></span>
<span id="cb722-2"><a href="#cb722-2" aria-hidden="true" tabindex="-1"></a>                   loc <span class="op">=</span>  <span class="fl">0.192</span>,     <span class="co"># Estimación puntual de la proporción</span></span>
<span id="cb722-3"><a href="#cb722-3" aria-hidden="true" tabindex="-1"></a>                   scale <span class="op">=</span> math.sqrt((p<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>p))<span class="op">/</span>n))  <span class="co"># Escalando</span></span></code></pre></div>
<ul>
<li><p>En resumen…</p></li>
<li><p>La estimación de los parámetros de la población a través del muestreo es una forma de inferencia sencilla, pero potente.</p></li>
<li><p>Las estimaciones puntuales combinadas con los márgenes de error nos permiten crear intervalos de confianza que capturan el verdadero parámetro de la población con una alta probabilidad.</p></li>
<li><p>La próxima vez ampliaremos los conceptos de esta lección aprendiendo sobre las pruebas de hipótesis estadísticas.</p></li>
</ul>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 4.6.1:</b></p>
<ul>
<li><p>Escriba una función que le permita calcular los intervalos de confianza de la media muestral. El input debe ser una columna de una data.frame.</p></li>
<li><p>Utilice la función que acaba de generar junto con un iterador que le permita generar este intervalo de confianza para todas las columnas de una base de datos cualquiera. Pruebe su iterador con la base de datos mtcars.</p></li>
</ul>
</div>
<div class="sourceCode" id="cb723"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb723-1"><a href="#cb723-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mean_confidence_interval(data, confidence<span class="op">=</span><span class="fl">0.05</span>):</span>
<span id="cb723-2"><a href="#cb723-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb723-3"><a href="#cb723-3" aria-hidden="true" tabindex="-1"></a>    mean <span class="op">=</span> data.mean()</span>
<span id="cb723-4"><a href="#cb723-4" aria-hidden="true" tabindex="-1"></a>    sd <span class="op">=</span> data.std()</span>
<span id="cb723-5"><a href="#cb723-5" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="bu">len</span>(data)</span>
<span id="cb723-6"><a href="#cb723-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb723-7"><a href="#cb723-7" aria-hidden="true" tabindex="-1"></a>    tcritico <span class="op">=</span> stats.t.ppf(q <span class="op">=</span> (<span class="dv">1</span> <span class="op">-</span> confidence<span class="op">/</span><span class="dv">2</span>), df<span class="op">=</span> n<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb723-8"><a href="#cb723-8" aria-hidden="true" tabindex="-1"></a>    se <span class="op">=</span>  sd<span class="op">/</span>np.sqrt(n)</span>
<span id="cb723-9"><a href="#cb723-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb723-10"><a href="#cb723-10" aria-hidden="true" tabindex="-1"></a>    lcv <span class="op">=</span> mean <span class="op">-</span> tcritico <span class="op">*</span> se</span>
<span id="cb723-11"><a href="#cb723-11" aria-hidden="true" tabindex="-1"></a>    ucv <span class="op">=</span> mean <span class="op">+</span> tcritico <span class="op">*</span> se</span>
<span id="cb723-12"><a href="#cb723-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb723-13"><a href="#cb723-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> mean, lcv, ucv</span>
<span id="cb723-14"><a href="#cb723-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb723-15"><a href="#cb723-15" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(mean_confidence_interval(mtcars[<span class="st">&quot;mpg&quot;</span>], <span class="fl">0.05</span>))</span>
<span id="cb723-16"><a href="#cb723-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb723-17"><a href="#cb723-17" aria-hidden="true" tabindex="-1"></a>mtcars.columns</span>
<span id="cb723-18"><a href="#cb723-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb723-19"><a href="#cb723-19" aria-hidden="true" tabindex="-1"></a>lista <span class="op">=</span> []</span>
<span id="cb723-20"><a href="#cb723-20" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb723-21"><a href="#cb723-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> mtcars.columns:</span>
<span id="cb723-22"><a href="#cb723-22" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> mean_confidence_interval(mtcars[col], <span class="fl">0.05</span>)</span>
<span id="cb723-23"><a href="#cb723-23" aria-hidden="true" tabindex="-1"></a>    a_list <span class="op">=</span> <span class="bu">list</span>(a)</span>
<span id="cb723-24"><a href="#cb723-24" aria-hidden="true" tabindex="-1"></a>    lista.append(a_list)</span>
<span id="cb723-25"><a href="#cb723-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb723-26"><a href="#cb723-26" aria-hidden="true" tabindex="-1"></a>lista</span>
<span id="cb723-27"><a href="#cb723-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb723-28"><a href="#cb723-28" aria-hidden="true" tabindex="-1"></a>ic <span class="op">=</span> pd.DataFrame(lista, index<span class="op">=</span>mtcars.columns)</span>
<span id="cb723-29"><a href="#cb723-29" aria-hidden="true" tabindex="-1"></a>ic</span>
<span id="cb723-30"><a href="#cb723-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb723-31"><a href="#cb723-31" aria-hidden="true" tabindex="-1"></a>ic <span class="op">=</span> ic.rename(columns <span class="op">=</span> {<span class="dv">0</span>: <span class="st">&quot;Promedio&quot;</span>, <span class="dv">1</span>: <span class="st">&quot;LIC&quot;</span>, <span class="dv">2</span> : <span class="st">&quot;UIC&quot;</span>})</span>
<span id="cb723-32"><a href="#cb723-32" aria-hidden="true" tabindex="-1"></a>ic</span></code></pre></div>
</div>
</div>
<div id="test-de-hipotesis" class="section level3 hasAnchor" number="4.6.3">
<h3 class="hasAnchor"><span class="header-section-number">4.6.3</span> Test de hipotesis<a href="#test-de-hipotesis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><p>Las estimaciones puntuales y los intervalos de confianza son herramientas básicas de inferencia que sirven de base para otra técnica de inferencia: las pruebas de hipótesis estadísticas.</p></li>
<li><p>La prueba de hipótesis estadística es un marco para determinar si los datos observados se desvían de lo esperado. La biblioteca scipy.stats de Python contiene una serie de funciones que facilitan la realización de pruebas de hipótesis.</p></li>
</ul>
<div id="aspectos-básicos" class="section level4 hasAnchor" number="4.6.3.1">
<h4 class="hasAnchor"><span class="header-section-number">4.6.3.1</span> Aspectos básicos<a href="#aspectos-básicos" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p>Las pruebas de hipótesis estadísticas se basan en una afirmación llamada hipótesis nula que supone que no hay nada interesante entre las variables que se están probando (lo que no quiero que ocurra).</p></li>
<li><p>La forma exacta de la hipótesis nula varía de un tipo de prueba a otro: si se está probando si los grupos difieren, la hipótesis nula afirma que los grupos son iguales. Por ejemplo, si quieres comprobar si la edad media de los votantes de tu comuna difiere de la media nacional, la hipótesis nula sería que no hay diferencia entre las edades medias.</p></li>
<li><p>El propósito de una prueba de hipótesis es determinar si es probable que la hipótesis nula sea cierta dados los datos de la muestra. Si hay pocas pruebas en contra de la hipótesis nula teniendo en cuenta los datos, se acepta la hipótesis nula. Si la hipótesis nula es improbable teniendo en cuenta los datos, puede rechazar la hipótesis nula a favor de la hipótesis alternativa.</p></li>
<li><p>La forma exacta de la hipótesis alternativa dependerá de la prueba específica que se realice. Siguiendo con el ejemplo anterior, la hipótesis alternativa sería que la edad media de los votantes de su estado difiere de hecho de la media nacional.</p></li>
<li><p>Una vez que tenga la hipótesis nula y la alternativa en la mano, elija un nivel de significancia (a menudo denotado por la letra griega α.).</p></li>
<li><p>El nivel de significacia es un umbral de probabilidad que determina cuándo se rechaza la hipótesis nula.</p></li>
<li><p>Tras realizar una prueba, si la probabilidad de obtener un resultado tan extremo como el que se observa debido al azar es inferior al nivel, se rechaza la <em>hipótesis nula a favor de la alternativa. Esta probabilidad de ver un resultado tan extremo o más extremo que el observado</em> se conoce como valor p.</p></li>
<li><p>La prueba T es una prueba estadística utilizada para determinar si una muestra de datos numéricos difiere significativamente de la población o si dos muestras difieren entre sí.</p></li>
</ul>
</div>
<div id="test---t-en-una-muestra" class="section level4 hasAnchor" number="4.6.3.2">
<h4 class="hasAnchor"><span class="header-section-number">4.6.3.2</span> Test - T en una muestra<a href="#test---t-en-una-muestra" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>Una prueba t de una muestra comprueba si la media de una muestra difiere de la media de la población.</li>
<li>Creemos algunos datos de edad ficticia para la población de votantes de todo el país y una muestra de votantes de santiago.</li>
<li>Comprobemos si la media de edad de los votantes de santiago difiere de la de la población:</li>
</ul>
<div class="sourceCode" id="cb724"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb724-1"><a href="#cb724-1" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">6</span>)</span>
<span id="cb724-2"><a href="#cb724-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb724-3"><a href="#cb724-3" aria-hidden="true" tabindex="-1"></a>population_ages1 <span class="op">=</span> stats.poisson.rvs(loc<span class="op">=</span><span class="dv">18</span>, mu<span class="op">=</span><span class="dv">35</span>, size<span class="op">=</span><span class="dv">150000</span>)</span>
<span id="cb724-4"><a href="#cb724-4" aria-hidden="true" tabindex="-1"></a>population_ages2 <span class="op">=</span> stats.poisson.rvs(loc<span class="op">=</span><span class="dv">18</span>, mu<span class="op">=</span><span class="dv">10</span>, size<span class="op">=</span><span class="dv">100000</span>)</span>
<span id="cb724-5"><a href="#cb724-5" aria-hidden="true" tabindex="-1"></a>population_ages <span class="op">=</span> np.concatenate((population_ages1, population_ages2))</span>
<span id="cb724-6"><a href="#cb724-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb724-7"><a href="#cb724-7" aria-hidden="true" tabindex="-1"></a>santiago_ages1 <span class="op">=</span> stats.poisson.rvs(loc<span class="op">=</span><span class="dv">18</span>, mu<span class="op">=</span><span class="dv">30</span>, size<span class="op">=</span><span class="dv">30</span>)</span>
<span id="cb724-8"><a href="#cb724-8" aria-hidden="true" tabindex="-1"></a>santiago_ages2 <span class="op">=</span> stats.poisson.rvs(loc<span class="op">=</span><span class="dv">18</span>, mu<span class="op">=</span><span class="dv">10</span>, size<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb724-9"><a href="#cb724-9" aria-hidden="true" tabindex="-1"></a>santiago_ages <span class="op">=</span> np.concatenate((santiago_ages1, santiago_ages2))</span>
<span id="cb724-10"><a href="#cb724-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb724-11"><a href="#cb724-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( population_ages.mean() )</span>
<span id="cb724-12"><a href="#cb724-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( santiago_ages.mean() )</span></code></pre></div>
<ul>
<li><p>Observa que hemos utilizado una combinación de distribuciones ligeramente diferente para generar los datos de la muestra de Santiago, por lo que sabemos que las dos medias son diferentes.</p></li>
<li><p>Realicemos una prueba t con un nivel de confianza del 95% y veamos si rechaza correctamente la hipótesis nula de que la muestra procede de la misma distribución que la población.</p></li>
<li><p>Para realizar una prueba t de una muestra, podemos la función stats.ttest_1samp():</p></li>
</ul>
<div class="sourceCode" id="cb725"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb725-1"><a href="#cb725-1" aria-hidden="true" tabindex="-1"></a>stats.ttest_1samp(a <span class="op">=</span> santiago_ages,               <span class="co"># Datos muestrales</span></span>
<span id="cb725-2"><a href="#cb725-2" aria-hidden="true" tabindex="-1"></a>                 popmean <span class="op">=</span> population_ages.mean())  <span class="co"># Media poblacional</span></span></code></pre></div>
<ul>
<li>El resultado de la prueba muestra que el estadístico de prueba “t” es igual a -2,574.</li>
<li>Este estadístico de prueba nos indica cuánto se desvía la media de la muestra de la hipótesis nula.</li>
<li><strong>Si el estadístico t se encuentra fuera de los cuantiles de la distribución t correspondientes a nuestro nivel de confianza y grados de libertad, rechazamos la hipótesis nula</strong>.</li>
<li>Podemos comprobar los cuantiles con stats.t.ppf():</li>
</ul>
<div class="sourceCode" id="cb726"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb726-1"><a href="#cb726-1" aria-hidden="true" tabindex="-1"></a>stats.t.ppf(q<span class="op">=</span><span class="fl">0.025</span>,  <span class="co"># Cuantile para chequear</span></span>
<span id="cb726-2"><a href="#cb726-2" aria-hidden="true" tabindex="-1"></a>            df<span class="op">=</span><span class="dv">49</span>)  <span class="co"># Grados de libertad</span></span>
<span id="cb726-3"><a href="#cb726-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb726-4"><a href="#cb726-4" aria-hidden="true" tabindex="-1"></a>stats.t.ppf(q<span class="op">=</span><span class="fl">0.975</span>,  <span class="co">#  # Cuantile para chequear</span></span>
<span id="cb726-5"><a href="#cb726-5" aria-hidden="true" tabindex="-1"></a>            df<span class="op">=</span><span class="dv">49</span>)  <span class="co"># Grados de libertad</span></span></code></pre></div>
<p>Podemos calcular las probabilidades de ver un resultado tan extremo como el que observamos (conocido como valor p) pasando el estadístico t como cuantil a la función stats.t.cdf():</p>
<div class="sourceCode" id="cb727"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb727-1"><a href="#cb727-1" aria-hidden="true" tabindex="-1"></a>stats.t.cdf(x <span class="op">=</span> <span class="op">-</span><span class="fl">2.5742</span>,      <span class="co"># Estadistico T</span></span>
<span id="cb727-2"><a href="#cb727-2" aria-hidden="true" tabindex="-1"></a>               df<span class="op">=</span> <span class="dv">49</span>) <span class="op">*</span> <span class="dv">2</span>   <span class="co"># Por dos (dos colas)</span></span></code></pre></div>
<p><strong>Nota</strong>: La hipótesis alternativa que estamos comprobando es si la media de la muestra difiere (no es igual) a la media de la población. Dado que la muestra puede diferir en dirección positiva o negativa, multiplicamos el valor por dos.</p>
<ul>
<li><p>Observe que este valor es el mismo que el valor p que aparece en el resultado de la prueba t original.</p></li>
<li><p>Un valor p de 0,01311 significa que esperaríamos ver datos tan extremos como nuestra muestra debido al azar alrededor del 1,3% de las veces si la hipótesis nula fuera cierta.</p></li>
<li><p>En este caso, el valor p es inferior a nuestro nivel de significacia α (igual a 1-conf.nivel o 0,05), por lo que deberíamos rechazar la hipótesis nula.</p></li>
<li><p>Veamos que ocurre con los intervalos de confianza:</p></li>
</ul>
<div class="sourceCode" id="cb728"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb728-1"><a href="#cb728-1" aria-hidden="true" tabindex="-1"></a>sigma <span class="op">=</span> santiago_ages.std()<span class="op">/</span>math.sqrt(<span class="dv">50</span>)  <span class="co"># Desv. est. muestral</span></span>
<span id="cb728-2"><a href="#cb728-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb728-3"><a href="#cb728-3" aria-hidden="true" tabindex="-1"></a>stats.t.interval(<span class="fl">0.95</span>,                        <span class="co"># Intervalo de confianza</span></span>
<span id="cb728-4"><a href="#cb728-4" aria-hidden="true" tabindex="-1"></a>                 df <span class="op">=</span> <span class="dv">49</span>,                     <span class="co"># Grados libertad</span></span>
<span id="cb728-5"><a href="#cb728-5" aria-hidden="true" tabindex="-1"></a>                 loc <span class="op">=</span> santiago_ages.mean(), <span class="co">#  Media muestral</span></span>
<span id="cb728-6"><a href="#cb728-6" aria-hidden="true" tabindex="-1"></a>                 scale<span class="op">=</span> sigma)                <span class="co"># Desviacion estandar muestral</span></span></code></pre></div>
<p>Por otra parte, dado que hay un 1,3% de posibilidades de ver un resultado tan extremo debido al azar, no es significativo al nivel de confianza del 99%. Esto significa que si construyéramos un intervalo de confianza del 99%, capturaría la media de la población:</p>
<div class="sourceCode" id="cb729"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb729-1"><a href="#cb729-1" aria-hidden="true" tabindex="-1"></a>stats.t.interval(alpha <span class="op">=</span> <span class="fl">0.99</span>,                <span class="co"># Intervalo de confianza</span></span>
<span id="cb729-2"><a href="#cb729-2" aria-hidden="true" tabindex="-1"></a>                 df <span class="op">=</span> <span class="dv">49</span>,                     <span class="co"># Grados libertad</span></span>
<span id="cb729-3"><a href="#cb729-3" aria-hidden="true" tabindex="-1"></a>                 loc <span class="op">=</span> santiago_ages.mean(), <span class="co"># Media muestra</span></span>
<span id="cb729-4"><a href="#cb729-4" aria-hidden="true" tabindex="-1"></a>                 scale<span class="op">=</span> sigma)                <span class="co"># Desviacion estandar muestral</span></span></code></pre></div>
<ul>
<li><p>Con un nivel de confianza más alto, construimos un intervalo de confianza más amplio y aumentamos las probabilidades de que capte la verdadera media, con lo que es menos probable que rechacemos la hipótesis nula.</p></li>
<li><p>En este caso, el valor p de 0,013 es mayor que nuestro nivel de significación de 0,01 y no rechazamos la hipótesis nula.</p></li>
</ul>
</div>
<div id="test-t-en-dos-muestras" class="section level4 hasAnchor" number="4.6.3.3">
<h4 class="hasAnchor"><span class="header-section-number">4.6.3.3</span> Test T en dos muestras<a href="#test-t-en-dos-muestras" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p>Una prueba t de dos muestras investiga si las medias de dos muestras de datos independientes difieren entre sí.</p></li>
<li><p>En una prueba de dos muestras, la hipótesis nula es que las medias de ambos grupos son iguales. A diferencia de la prueba de una muestra, en la que se compara con un parámetro poblacional conocido, la prueba de dos muestras sólo incluye las medias de las muestras.</p></li>
<li><p>Puede realizar una prueba t de dos muestras pasando con la función stats.ttest_ind().</p></li>
<li><p>Vamos a generar una muestra de datos de la edad de los votantes de Valparaiso y a probarla contra la muestra que hicimos antes:</p></li>
</ul>
<div class="sourceCode" id="cb730"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb730-1"><a href="#cb730-1" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">12</span>)</span>
<span id="cb730-2"><a href="#cb730-2" aria-hidden="true" tabindex="-1"></a>valparaiso_ages1 <span class="op">=</span> stats.poisson.rvs(loc<span class="op">=</span><span class="dv">18</span>, mu<span class="op">=</span><span class="dv">33</span>, size<span class="op">=</span><span class="dv">30</span>)</span>
<span id="cb730-3"><a href="#cb730-3" aria-hidden="true" tabindex="-1"></a>valparaiso_ages2 <span class="op">=</span> stats.poisson.rvs(loc<span class="op">=</span><span class="dv">18</span>, mu<span class="op">=</span><span class="dv">13</span>, size<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb730-4"><a href="#cb730-4" aria-hidden="true" tabindex="-1"></a>valparaiso_ages <span class="op">=</span> np.concatenate((valparaiso_ages1, valparaiso_ages2))</span>
<span id="cb730-5"><a href="#cb730-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb730-6"><a href="#cb730-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(valparaiso_ages.mean() )</span>
<span id="cb730-7"><a href="#cb730-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb730-8"><a href="#cb730-8" aria-hidden="true" tabindex="-1"></a>stats.ttest_ind(a<span class="op">=</span> santiago_ages,</span>
<span id="cb730-9"><a href="#cb730-9" aria-hidden="true" tabindex="-1"></a>                b<span class="op">=</span> valparaiso_ages,</span>
<span id="cb730-10"><a href="#cb730-10" aria-hidden="true" tabindex="-1"></a>                equal_var<span class="op">=</span><span class="va">False</span>)    <span class="co"># asumimos que tienen igual varianza?</span></span></code></pre></div>
<ul>
<li><p>La prueba arroja un valor p de 0,0907, lo que significa que hay un 9% de posibilidades de que veamos los datos de la muestra tan separados si los dos grupos analizados son realmente idénticos.</p></li>
<li><p>Si utilizáramos un nivel de confianza del 95%, no podríamos rechazar la hipótesis nula, ya que el valor p es mayor que el nivel de significancia correspondiente del 5%.</p></li>
</ul>
</div>
<div id="t-test-pareados" class="section level4 hasAnchor" number="4.6.3.4">
<h4 class="hasAnchor"><span class="header-section-number">4.6.3.4</span> T-Test pareados<a href="#t-test-pareados" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p>La prueba t básica de dos muestras está diseñada para probar las diferencias entre grupos independientes.</p></li>
<li><p>En algunos casos, puede interesarle probar las diferencias entre muestras del mismo grupo en diferentes momentos. Por ejemplo, un hospital podría querer probar si un medicamento para perder peso funciona comprobando los pesos de los pacientes del mismo grupo antes y después del tratamiento.</p></li>
<li><p>Una prueba t pareada permite comprobar si las medias de las muestras del mismo grupo difieren.</p></li>
<li><p>Podemos realizar una prueba t emparejada utilizando la función scipy stats.ttest_rel(). Generemos algunos datos de peso de pacientes ficticios y hagamos una prueba t pareada:</p></li>
</ul>
<div class="sourceCode" id="cb731"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb731-1"><a href="#cb731-1" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">11</span>)</span>
<span id="cb731-2"><a href="#cb731-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb731-3"><a href="#cb731-3" aria-hidden="true" tabindex="-1"></a>before<span class="op">=</span> stats.norm.rvs(scale<span class="op">=</span><span class="dv">30</span>, loc<span class="op">=</span><span class="dv">250</span>, size<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb731-4"><a href="#cb731-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb731-5"><a href="#cb731-5" aria-hidden="true" tabindex="-1"></a>after <span class="op">=</span> before <span class="op">+</span> stats.norm.rvs(scale<span class="op">=</span><span class="dv">5</span>, loc<span class="op">=-</span><span class="fl">1.25</span>, size<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb731-6"><a href="#cb731-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb731-7"><a href="#cb731-7" aria-hidden="true" tabindex="-1"></a>weight_df <span class="op">=</span> pd.DataFrame({<span class="st">&quot;weight_before&quot;</span>:before,</span>
<span id="cb731-8"><a href="#cb731-8" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot;weight_after&quot;</span>:after,</span>
<span id="cb731-9"><a href="#cb731-9" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot;weight_change&quot;</span>:after<span class="op">-</span>before})</span>
<span id="cb731-10"><a href="#cb731-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb731-11"><a href="#cb731-11" aria-hidden="true" tabindex="-1"></a>weight_df.describe()             <span class="co"># Chequeamos</span></span></code></pre></div>
<p>El resumen muestra que los pacientes perdieron alrededor de 1,23 libras de media después del tratamiento. Realicemos una prueba t pareada para ver si esta diferencia es significativa con un nivel de confianza del 95%:</p>
<div class="sourceCode" id="cb732"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb732-1"><a href="#cb732-1" aria-hidden="true" tabindex="-1"></a>stats.ttest_rel(a <span class="op">=</span> before,</span>
<span id="cb732-2"><a href="#cb732-2" aria-hidden="true" tabindex="-1"></a>                b <span class="op">=</span> after)</span></code></pre></div>
<ul>
<li>Rechazamos la hipotesis nula de que ambos promedios son iguales.</li>
</ul>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 4.6.2: </b></p>
<ul>
<li>Tome los siguientes valores de colesterol de los pacientes antes y despues de una dieta</li>
</ul>
<p>test_results_before_diet=[224, 235, 223, 253, 253, 224, 244, 225, 259, 220, 242, 240, 239, 229, 276, 254, 237, 227]</p>
<p>test_results_after_diet=[198, 195, 213, 190, 246, 206, 225, 199, 214, 210, 188, 205, 200, 220, 190, 199, 191, 218]</p>
<ul>
<li>Realice un test de hipotesis pareado que le permita chequear si los niveles de colesterol han bajado posterior a la dieta utilizando un nivel de significancia del 0.05%. Asuma que efectivamente los datos se distribuyen normalmente.</li>
</ul>
</div>
<div class="sourceCode" id="cb733"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb733-1"><a href="#cb733-1" aria-hidden="true" tabindex="-1"></a>test_results_before_diet<span class="op">=</span>[<span class="dv">224</span>, <span class="dv">235</span>, <span class="dv">223</span>, <span class="dv">253</span>, <span class="dv">253</span>, <span class="dv">224</span>, <span class="dv">244</span>, <span class="dv">225</span>, <span class="dv">259</span>, <span class="dv">220</span>, <span class="dv">242</span>, <span class="dv">240</span>, <span class="dv">239</span>, <span class="dv">229</span>, <span class="dv">276</span>, <span class="dv">254</span>, <span class="dv">237</span>, <span class="dv">227</span>]</span>
<span id="cb733-2"><a href="#cb733-2" aria-hidden="true" tabindex="-1"></a>test_results_after_diet<span class="op">=</span>[<span class="dv">198</span>, <span class="dv">195</span>, <span class="dv">213</span>, <span class="dv">190</span>, <span class="dv">246</span>, <span class="dv">206</span>, <span class="dv">225</span>, <span class="dv">199</span>, <span class="dv">214</span>, <span class="dv">210</span>, <span class="dv">188</span>, <span class="dv">205</span>, <span class="dv">200</span>, <span class="dv">220</span>, <span class="dv">190</span>, <span class="dv">199</span>, <span class="dv">191</span>, <span class="dv">218</span>]</span>
<span id="cb733-3"><a href="#cb733-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb733-4"><a href="#cb733-4" aria-hidden="true" tabindex="-1"></a>test_stat, p_value_paired <span class="op">=</span> stats.ttest_rel(test_results_before_diet,test_results_after_diet)</span>
<span id="cb733-5"><a href="#cb733-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;p value:</span><span class="sc">%.6f</span><span class="st">&quot;</span> <span class="op">%</span> p_value_paired , <span class="st">&quot;one tailed p value:</span><span class="sc">%.6f</span><span class="st">&quot;</span> <span class="op">%</span>(p_value_paired<span class="op">/</span><span class="dv">2</span>))</span>
<span id="cb733-6"><a href="#cb733-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb733-7"><a href="#cb733-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> p_value_paired <span class="op">&lt;</span><span class="fl">0.05</span>:</span>
<span id="cb733-8"><a href="#cb733-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Reject null hypothesis&quot;</span>)</span>
<span id="cb733-9"><a href="#cb733-9" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb733-10"><a href="#cb733-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Fail to reject null hypothesis&quot;</span>)</span></code></pre></div>
</div>
<div id="error-tipo-i-y-tipo-ii" class="section level4 hasAnchor" number="4.6.3.5">
<h4 class="hasAnchor"><span class="header-section-number">4.6.3.5</span> Error tipo I y tipo II<a href="#error-tipo-i-y-tipo-ii" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p>El resultado de una prueba de hipótesis estadística y la correspondiente decisión de rechazar o aceptar la hipótesis nula no son infalibles.</p></li>
<li><p>Una prueba proporciona pruebas a favor o en contra de la hipótesis nula y luego se decide si se acepta o se rechaza en función de esas pruebas, pero éstas pueden carecer de la fuerza necesaria para llegar a la conclusión correcta. Las conclusiones incorrectas obtenidas a partir de las pruebas de hipótesis se clasifican en una de las dos categorías siguientes: error de tipo I y error de tipo II.</p></li>
<li><p>El error de tipo I describe una situación en la que <strong>se rechaza la hipótesis nula cuando en realidad es verdadera</strong>. Este tipo de error también se conoce como “falso positivo” o “falso acierto”. La tasa de error de tipo 1 es igual al nivel de significación α, por lo que establecer un nivel de confianza más alto (y, por tanto, un alfa más bajo) reduce las posibilidades de obtener un falso positivo.</p></li>
<li><p>El error de tipo II describe una situación en la que <strong>no se rechaza la hipótesis nula cuando en realidad es falsa</strong>. El error de tipo II también se conoce como “falso negativo” o “fallo”. Cuanto más alto sea el nivel de confianza, más probabilidades habrá de cometer un error de tipo II.</p></li>
</ul>
<div class="figure">
<img src="attachment:image.png" alt="" />
<p class="caption">image.png</p>
</div>
<ul>
<li><p>H0: No esta embarazada</p></li>
<li><p>H1: Esta embarazada</p></li>
<li><p>ETI: Rechazar la nula (rechazo “no estar embarazada”) cuando es verdadera (“no esta embarazado”).</p></li>
<li><p>ETII: No rechazar la nula (“digo: no esta embarazada”), cuando es falsa (“esta embaradaza”).</p></li>
<li><p>Investiguemos estos errores con un gráfico:</p></li>
</ul>
<div class="sourceCode" id="cb734"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb734-1"><a href="#cb734-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">10</span>))</span>
<span id="cb734-2"><a href="#cb734-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb734-3"><a href="#cb734-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb734-4"><a href="#cb734-4" aria-hidden="true" tabindex="-1"></a>plt.fill_between(x<span class="op">=</span>np.arange(<span class="op">-</span><span class="dv">4</span>,<span class="op">-</span><span class="dv">2</span>,<span class="fl">0.01</span>), </span>
<span id="cb734-5"><a href="#cb734-5" aria-hidden="true" tabindex="-1"></a>                 y1<span class="op">=</span> stats.norm.pdf(np.arange(<span class="op">-</span><span class="dv">4</span>,<span class="op">-</span><span class="dv">2</span>,<span class="fl">0.01</span>)) ,</span>
<span id="cb734-6"><a href="#cb734-6" aria-hidden="true" tabindex="-1"></a>                 facecolor<span class="op">=</span><span class="st">&#39;red&#39;</span>,</span>
<span id="cb734-7"><a href="#cb734-7" aria-hidden="true" tabindex="-1"></a>                 alpha<span class="op">=</span><span class="fl">0.35</span>)</span>
<span id="cb734-8"><a href="#cb734-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb734-9"><a href="#cb734-9" aria-hidden="true" tabindex="-1"></a>plt.fill_between(x<span class="op">=</span>np.arange(<span class="op">-</span><span class="dv">2</span>,<span class="dv">2</span>,<span class="fl">0.01</span>), </span>
<span id="cb734-10"><a href="#cb734-10" aria-hidden="true" tabindex="-1"></a>                 y1<span class="op">=</span> stats.norm.pdf(np.arange(<span class="op">-</span><span class="dv">2</span>,<span class="dv">2</span>,<span class="fl">0.01</span>)) ,</span>
<span id="cb734-11"><a href="#cb734-11" aria-hidden="true" tabindex="-1"></a>                 facecolor<span class="op">=</span><span class="st">&#39;grey&#39;</span>,</span>
<span id="cb734-12"><a href="#cb734-12" aria-hidden="true" tabindex="-1"></a>                 alpha<span class="op">=</span><span class="fl">0.35</span>)</span>
<span id="cb734-13"><a href="#cb734-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb734-14"><a href="#cb734-14" aria-hidden="true" tabindex="-1"></a>plt.fill_between(x<span class="op">=</span>np.arange(<span class="dv">2</span>,<span class="dv">4</span>,<span class="fl">0.01</span>), </span>
<span id="cb734-15"><a href="#cb734-15" aria-hidden="true" tabindex="-1"></a>                 y1<span class="op">=</span> stats.norm.pdf(np.arange(<span class="dv">2</span>,<span class="dv">4</span>,<span class="fl">0.01</span>)) ,</span>
<span id="cb734-16"><a href="#cb734-16" aria-hidden="true" tabindex="-1"></a>                 facecolor<span class="op">=</span><span class="st">&#39;red&#39;</span>,</span>
<span id="cb734-17"><a href="#cb734-17" aria-hidden="true" tabindex="-1"></a>                 alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb734-18"><a href="#cb734-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb734-19"><a href="#cb734-19" aria-hidden="true" tabindex="-1"></a>plt.fill_between(x<span class="op">=</span>np.arange(<span class="op">-</span><span class="dv">4</span>,<span class="op">-</span><span class="dv">2</span>,<span class="fl">0.01</span>), </span>
<span id="cb734-20"><a href="#cb734-20" aria-hidden="true" tabindex="-1"></a>                 y1<span class="op">=</span> stats.norm.pdf(np.arange(<span class="op">-</span><span class="dv">4</span>,<span class="op">-</span><span class="dv">2</span>,<span class="fl">0.01</span>),loc<span class="op">=</span><span class="dv">3</span>, scale<span class="op">=</span><span class="dv">2</span>) ,</span>
<span id="cb734-21"><a href="#cb734-21" aria-hidden="true" tabindex="-1"></a>                 facecolor<span class="op">=</span><span class="st">&#39;grey&#39;</span>,</span>
<span id="cb734-22"><a href="#cb734-22" aria-hidden="true" tabindex="-1"></a>                 alpha<span class="op">=</span><span class="fl">0.35</span>)</span>
<span id="cb734-23"><a href="#cb734-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb734-24"><a href="#cb734-24" aria-hidden="true" tabindex="-1"></a>plt.fill_between(x<span class="op">=</span>np.arange(<span class="op">-</span><span class="dv">2</span>,<span class="dv">2</span>,<span class="fl">0.01</span>), </span>
<span id="cb734-25"><a href="#cb734-25" aria-hidden="true" tabindex="-1"></a>                 y1<span class="op">=</span> stats.norm.pdf(np.arange(<span class="op">-</span><span class="dv">2</span>,<span class="dv">2</span>,<span class="fl">0.01</span>),loc<span class="op">=</span><span class="dv">3</span>, scale<span class="op">=</span><span class="dv">2</span>) ,</span>
<span id="cb734-26"><a href="#cb734-26" aria-hidden="true" tabindex="-1"></a>                 facecolor<span class="op">=</span><span class="st">&#39;blue&#39;</span>,</span>
<span id="cb734-27"><a href="#cb734-27" aria-hidden="true" tabindex="-1"></a>                 alpha<span class="op">=</span><span class="fl">0.35</span>)</span>
<span id="cb734-28"><a href="#cb734-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb734-29"><a href="#cb734-29" aria-hidden="true" tabindex="-1"></a>plt.fill_between(x<span class="op">=</span>np.arange(<span class="dv">2</span>,<span class="dv">10</span>,<span class="fl">0.01</span>), </span>
<span id="cb734-30"><a href="#cb734-30" aria-hidden="true" tabindex="-1"></a>                 y1<span class="op">=</span> stats.norm.pdf(np.arange(<span class="dv">2</span>,<span class="dv">10</span>,<span class="fl">0.01</span>),loc<span class="op">=</span><span class="dv">3</span>, scale<span class="op">=</span><span class="dv">2</span>),</span>
<span id="cb734-31"><a href="#cb734-31" aria-hidden="true" tabindex="-1"></a>                 facecolor<span class="op">=</span><span class="st">&#39;grey&#39;</span>,</span>
<span id="cb734-32"><a href="#cb734-32" aria-hidden="true" tabindex="-1"></a>                 alpha<span class="op">=</span><span class="fl">0.35</span>)</span>
<span id="cb734-33"><a href="#cb734-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb734-34"><a href="#cb734-34" aria-hidden="true" tabindex="-1"></a>plt.text(x<span class="op">=-</span><span class="fl">0.8</span>, y<span class="op">=</span><span class="fl">0.15</span>, s<span class="op">=</span> <span class="st">&quot;Null Hypothesis&quot;</span>)</span>
<span id="cb734-35"><a href="#cb734-35" aria-hidden="true" tabindex="-1"></a>plt.text(x<span class="op">=</span><span class="fl">2.5</span>, y<span class="op">=</span><span class="fl">0.13</span>, s<span class="op">=</span> <span class="st">&quot;Alternative&quot;</span>)</span>
<span id="cb734-36"><a href="#cb734-36" aria-hidden="true" tabindex="-1"></a>plt.text(x<span class="op">=</span><span class="fl">2.1</span>, y<span class="op">=</span><span class="fl">0.01</span>, s<span class="op">=</span> <span class="st">&quot;Type 1 Error&quot;</span>)</span>
<span id="cb734-37"><a href="#cb734-37" aria-hidden="true" tabindex="-1"></a>plt.text(x<span class="op">=-</span><span class="fl">3.2</span>, y<span class="op">=</span><span class="fl">0.01</span>, s<span class="op">=</span> <span class="st">&quot;Type 1 Error&quot;</span>)</span>
<span id="cb734-38"><a href="#cb734-38" aria-hidden="true" tabindex="-1"></a>plt.text(x<span class="op">=</span><span class="dv">0</span>, y<span class="op">=</span><span class="fl">0.02</span>, s<span class="op">=</span> <span class="st">&quot;Type 2 Error&quot;</span>)<span class="op">;</span></span></code></pre></div>
<ul>
<li><p>En el gráfico anterior, las áreas rojas indican los errores de tipo I que se producen cuando la hipótesis alternativa no es diferente de la nula para una prueba de dos caras con un nivel de confianza del 95%.</p></li>
<li><p>El área azul representa los errores de tipo II que se producen cuando la hipótesis alternativa es diferente de la nula, como muestra la distribución de la derecha.</p></li>
<li><p>Tenga en cuenta que la tasa de error de tipo II es el área bajo la distribución alternativa dentro de los cuantiles determinados por la distribución nula y el nivel de confianza.</p></li>
<li><p>Podemos calcular la tasa de error de tipo II para las distribuciones anteriores de la siguiente manera:</p></li>
</ul>
<div class="sourceCode" id="cb735"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb735-1"><a href="#cb735-1" aria-hidden="true" tabindex="-1"></a>lower_quantile <span class="op">=</span> stats.norm.ppf(<span class="fl">0.025</span>)  <span class="co"># Lower cutoff value</span></span>
<span id="cb735-2"><a href="#cb735-2" aria-hidden="true" tabindex="-1"></a>upper_quantile <span class="op">=</span> stats.norm.ppf(<span class="fl">0.975</span>)  <span class="co"># Upper cutoff value</span></span>
<span id="cb735-3"><a href="#cb735-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb735-4"><a href="#cb735-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Area bajo la alternativa,</span></span>
<span id="cb735-5"><a href="#cb735-5" aria-hidden="true" tabindex="-1"></a>low <span class="op">=</span> stats.norm.cdf(lower_quantile,    </span>
<span id="cb735-6"><a href="#cb735-6" aria-hidden="true" tabindex="-1"></a>                     loc<span class="op">=</span><span class="dv">3</span>,             </span>
<span id="cb735-7"><a href="#cb735-7" aria-hidden="true" tabindex="-1"></a>                     scale<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb735-8"><a href="#cb735-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb735-9"><a href="#cb735-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Area under alternative, to the left the upper cutoff value</span></span>
<span id="cb735-10"><a href="#cb735-10" aria-hidden="true" tabindex="-1"></a>high <span class="op">=</span> stats.norm.cdf(upper_quantile, </span>
<span id="cb735-11"><a href="#cb735-11" aria-hidden="true" tabindex="-1"></a>                      loc<span class="op">=</span><span class="dv">3</span>, </span>
<span id="cb735-12"><a href="#cb735-12" aria-hidden="true" tabindex="-1"></a>                      scale<span class="op">=</span><span class="dv">2</span>)          </span>
<span id="cb735-13"><a href="#cb735-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb735-14"><a href="#cb735-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Area under the alternative, between the cutoffs (Type II error)</span></span>
<span id="cb735-15"><a href="#cb735-15" aria-hidden="true" tabindex="-1"></a>high<span class="op">-</span>low</span></code></pre></div>
<ul>
<li>Con las distribuciones normales anteriores, no rechazaríamos la hipótesis nula en un 30% de las ocasiones porque las distribuciones están lo suficientemente cerca como para tener un solapamiento significativo.</li>
</ul>
</div>
<div id="poder-estadístico" class="section level4 hasAnchor" number="4.6.3.6">
<h4 class="hasAnchor"><span class="header-section-number">4.6.3.6</span> Poder estadístico<a href="#poder-estadístico" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p>La <a href="https://en.wikipedia.org/wiki/Power_(statistics)">potencia</a> de una prueba estadística es la probabilidad de que la prueba rechace la hipótesis nula cuando la alternativa es realmente diferente de la nula.</p></li>
<li><p>En otras palabras, la potencia es la probabilidad de que la prueba detecte que hay algo interesante cuando realmente <em>hay</em> algo interesante. La potencia es igual a uno menos la tasa de error de tipo II. La potencia de una prueba estadística está influida por</p></li>
</ul>
<ol style="list-style-type: decimal">
<li>El nivel de significancia elegido para la prueba.</li>
<li>El tamaño de la muestra.</li>
<li>El tamaño del efecto de la prueba.</li>
</ol>
<ul>
<li><p>A la hora de elegir un nivel de significación para una prueba, existe un equilibrio entre el error de tipo I y el de tipo II. Un nivel de significación bajo, como 0,01, hace que sea poco probable que una prueba tenga errores de tipo I (falsos positivos), pero es más probable que tenga errores de tipo II (falsos negativos) que una prueba con un valor mayor del nivel de significancia α. Una convención común es que una prueba estadística debe tener una potencia de al menos 0,8.</p></li>
<li><p>Un mayor tamaño de la muestra reduce la incertidumbre de la estimación puntual, haciendo que la distribución de la muestra se estreche, lo que da lugar a menores tasas de error de tipo II y a una mayor potencia.</p></li>
<li><p><a href="https://en.wikipedia.org/wiki/Effect_size">Tamaño del efecto</a> es un término general que describe una medida numérica del tamaño de algún fenómeno. Hay muchas medidas diferentes del tamaño del efecto que surgen en diferentes contextos. En el contexto de la prueba T, un tamaño del efecto simple es la diferencia entre las medias de las muestras. Este número puede estandarizarse dividiéndolo por la desviación estándar de la población o la desviación estándar conjunta de las muestras. Esto pone el tamaño del efecto en términos de desviaciones estándar, por lo que un tamaño del efecto estandarizado de 0,5 se interpretaría como que la media de una muestra está a 0,5 desviaciones estándar de otra (en general, 0,5 se considera un tamaño del efecto “grande”).</p></li>
<li><p>Dado que la potencia estadística, el nivel de significación, el tamaño del efecto y el tamaño de la muestra están relacionados, es posible calcular cualquiera de ellos para valores dados de los otros tres. Esto puede ser una parte importante del proceso de diseño de una prueba de hipótesis y del análisis de los resultados. Por ejemplo, si quiere realizar una prueba con un nivel de significancia determinado (digamos el estándar 0,05) y una potencia (digamos el estándar 0,8) y está interesado en un tamaño del efecto determinado (digamos 0,5 para la diferencia estandarizada entre las medias de la muestra), podría utilizar esa información para determinar el tamaño de la muestra que necesita.</p></li>
<li><p>En python, la biblioteca statsmodels contiene funciones para resolver cualquier parámetro de la potencia de las pruebas T. Utilice statsmodels.stats.power.tt_solve_power para pruebas t de una muestra y statsmodels.stats.power.tt_ind_solve_power para una prueba t de dos muestras.</p></li>
<li><p>Comprobemos el tamaño de la muestra que debemos utilizar dados los valores de los parámetros estándar anteriores para una prueba t de una muestra:</p></li>
</ul>
<div class="sourceCode" id="cb736"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb736-1"><a href="#cb736-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.stats.power <span class="im">import</span> tt_solve_power</span>
<span id="cb736-2"><a href="#cb736-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb736-3"><a href="#cb736-3" aria-hidden="true" tabindex="-1"></a>tt_solve_power(effect_size <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span id="cb736-4"><a href="#cb736-4" aria-hidden="true" tabindex="-1"></a>               alpha <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span id="cb736-5"><a href="#cb736-5" aria-hidden="true" tabindex="-1"></a>               power <span class="op">=</span> <span class="fl">0.8</span>)</span></code></pre></div>
<p>En este caso, querríamos un tamaño de muestra de al menos 34 para hacer un estudio con la potencia y el nivel de significación deseados capaz de detectar un tamaño de efecto grande.</p>
</div>
</div>
<div id="ejemplo-1-resumen-exploratorio-de-datos" class="section level3 hasAnchor" number="4.6.4">
<h3 class="hasAnchor"><span class="header-section-number">4.6.4</span> Ejemplo 1: resumen exploratorio de datos<a href="#ejemplo-1-resumen-exploratorio-de-datos" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Como sacar la primera impresión de tus datos</li>
<li>No olvidar: <a href="http://www.danielmsullivan.com/pages/tutorial_stata_to_python.html" class="uri">http://www.danielmsullivan.com/pages/tutorial_stata_to_python.html</a></li>
</ul>
<div class="sourceCode" id="cb737"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb737-1"><a href="#cb737-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Basics</span></span>
<span id="cb737-2"><a href="#cb737-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb737-3"><a href="#cb737-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb737-4"><a href="#cb737-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb737-5"><a href="#cb737-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualizations</span></span>
<span id="cb737-6"><a href="#cb737-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb737-7"><a href="#cb737-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code></pre></div>
<div id="datos" class="section level4 hasAnchor" number="4.6.4.1">
<h4 class="hasAnchor"><span class="header-section-number">4.6.4.1</span> Datos<a href="#datos" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb738"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb738-1"><a href="#cb738-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the data</span></span>
<span id="cb738-2"><a href="#cb738-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> sns.load_dataset(<span class="st">&#39;tips&#39;</span>)</span>
<span id="cb738-3"><a href="#cb738-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb738-4"><a href="#cb738-4" aria-hidden="true" tabindex="-1"></a><span class="co"># View first 5 rows</span></span>
<span id="cb738-5"><a href="#cb738-5" aria-hidden="true" tabindex="-1"></a>df.head()</span>
<span id="cb738-6"><a href="#cb738-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb738-7"><a href="#cb738-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Miramos tipos de datos</span></span>
<span id="cb738-8"><a href="#cb738-8" aria-hidden="true" tabindex="-1"></a>df.info()</span>
<span id="cb738-9"><a href="#cb738-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb738-10"><a href="#cb738-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Tamaño</span></span>
<span id="cb738-11"><a href="#cb738-11" aria-hidden="true" tabindex="-1"></a>df.shape</span>
<span id="cb738-12"><a href="#cb738-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb738-13"><a href="#cb738-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Tipos de datos</span></span>
<span id="cb738-14"><a href="#cb738-14" aria-hidden="true" tabindex="-1"></a>df.dtypes</span></code></pre></div>
</div>
<div id="missing-values-3" class="section level4 hasAnchor" number="4.6.4.2">
<h4 class="hasAnchor"><span class="header-section-number">4.6.4.2</span> Missing Values<a href="#missing-values-3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb739"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb739-1"><a href="#cb739-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Contamos missing values por variable</span></span>
<span id="cb739-2"><a href="#cb739-2" aria-hidden="true" tabindex="-1"></a>missing_values <span class="op">=</span> df.isnull().<span class="bu">sum</span>()</span>
<span id="cb739-3"><a href="#cb739-3" aria-hidden="true" tabindex="-1"></a>missing_values</span>
<span id="cb739-4"><a href="#cb739-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb739-5"><a href="#cb739-5" aria-hidden="true" tabindex="-1"></a>missing_values_df <span class="op">=</span> pd.DataFrame(missing_values)</span>
<span id="cb739-6"><a href="#cb739-6" aria-hidden="true" tabindex="-1"></a>missing_values_df.rename(columns <span class="op">=</span> {<span class="dv">0</span> : <span class="st">&quot;Cantidad&quot;</span>})</span>
<span id="cb739-7"><a href="#cb739-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb739-8"><a href="#cb739-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Guardamos nuestra T6</span></span>
<span id="cb739-9"><a href="#cb739-9" aria-hidden="true" tabindex="-1"></a>missing_values_df.to_excel(<span class="st">&quot;t6.xlsx&quot;</span>, sheet_name<span class="op">=</span><span class="st">&#39;t6&#39;</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb739-10"><a href="#cb739-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb739-11"><a href="#cb739-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Insertamos NA para ejemplificar</span></span>
<span id="cb739-12"><a href="#cb739-12" aria-hidden="true" tabindex="-1"></a>dfna <span class="op">=</span> pd.DataFrame([[<span class="dv">10</span>, <span class="fl">1.2</span>, <span class="st">&#39;Female&#39;</span>, np.nan, <span class="st">&#39;?&#39;</span>, <span class="st">&#39;Dinner&#39;</span>, <span class="dv">2</span>]]<span class="op">*</span><span class="dv">4</span>, columns<span class="op">=</span>df.columns)</span>
<span id="cb739-13"><a href="#cb739-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb739-14"><a href="#cb739-14" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> df.append(dfna).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb739-15"><a href="#cb739-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb739-16"><a href="#cb739-16" aria-hidden="true" tabindex="-1"></a><span class="co"># tail of the df2, where NAs and nulls were inserted</span></span>
<span id="cb739-17"><a href="#cb739-17" aria-hidden="true" tabindex="-1"></a>df2.tail()</span>
<span id="cb739-18"><a href="#cb739-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb739-19"><a href="#cb739-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Heatmap to see missing values</span></span>
<span id="cb739-20"><a href="#cb739-20" aria-hidden="true" tabindex="-1"></a>sns.heatmap(df2.isnull(), cbar<span class="op">=</span><span class="va">False</span>)<span class="op">;</span></span>
<span id="cb739-21"><a href="#cb739-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb739-22"><a href="#cb739-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Chequiamos por otros posibles valores nilos - [?.,:*]  solpom columnas de texto </span></span>
<span id="cb739-23"><a href="#cb739-23" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> df2.select_dtypes(exclude<span class="op">=</span><span class="st">&#39;number&#39;</span>).columns:</span>
<span id="cb739-24"><a href="#cb739-24" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>df2[col]<span class="sc">.</span><span class="bu">str</span><span class="sc">.</span>contains(<span class="st">&#39;[?.,:*]&#39;</span>)<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">}</span><span class="ss"> possible null(?.,:*) values&quot;</span>)</span>
<span id="cb739-25"><a href="#cb739-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb739-26"><a href="#cb739-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Remplazamos ? </span></span>
<span id="cb739-27"><a href="#cb739-27" aria-hidden="true" tabindex="-1"></a>df2.replace({<span class="st">&#39;?&#39;</span>:np.nan}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb739-28"><a href="#cb739-28" aria-hidden="true" tabindex="-1"></a>df2.tail(<span class="dv">2</span>)</span>
<span id="cb739-29"><a href="#cb739-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb739-30"><a href="#cb739-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Ahora, vamos a los calores más comunes </span></span>
<span id="cb739-31"><a href="#cb739-31" aria-hidden="true" tabindex="-1"></a>most_common_smoker <span class="op">=</span> df.smoker.value_counts().index[<span class="dv">0</span>]</span>
<span id="cb739-32"><a href="#cb739-32" aria-hidden="true" tabindex="-1"></a>most_common_day <span class="op">=</span> df.day.value_counts().index[<span class="dv">0</span>]</span>
<span id="cb739-33"><a href="#cb739-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb739-34"><a href="#cb739-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill NA Values with the most common value</span></span>
<span id="cb739-35"><a href="#cb739-35" aria-hidden="true" tabindex="-1"></a>df2.fillna(value<span class="op">=</span>{<span class="st">&#39;smoker&#39;</span>:most_common_smoker, <span class="st">&#39;day&#39;</span>:most_common_day})</span>
<span id="cb739-36"><a href="#cb739-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb739-37"><a href="#cb739-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop NA values</span></span>
<span id="cb739-38"><a href="#cb739-38" aria-hidden="true" tabindex="-1"></a>df2.dropna(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb739-39"><a href="#cb739-39" aria-hidden="true" tabindex="-1"></a>df2</span>
<span id="cb739-40"><a href="#cb739-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb739-41"><a href="#cb739-41" aria-hidden="true" tabindex="-1"></a>df2.describe()</span></code></pre></div>
</div>
<div id="análisis-univariado" class="section level4 hasAnchor" number="4.6.4.3">
<h4 class="hasAnchor"><span class="header-section-number">4.6.4.3</span> Análisis univariado<a href="#análisis-univariado" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb740"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb740-1"><a href="#cb740-1" aria-hidden="true" tabindex="-1"></a>df.info()</span></code></pre></div>
<p>Bien, ahora sabemos que <em>factura_total, punta y tamaño</em> son variables numéricas, por lo que podemos analizar de la misma manera, con un boxplot o histograma.</p>
<div class="sourceCode" id="cb741"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb741-1"><a href="#cb741-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Grafico caja y bigote</span></span>
<span id="cb741-2"><a href="#cb741-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb741-3"><a href="#cb741-3" aria-hidden="true" tabindex="-1"></a>fig, g <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">9</span>))</span>
<span id="cb741-4"><a href="#cb741-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb741-5"><a href="#cb741-5" aria-hidden="true" tabindex="-1"></a>g1 <span class="op">=</span> sns.boxplot(data<span class="op">=</span>df, </span>
<span id="cb741-6"><a href="#cb741-6" aria-hidden="true" tabindex="-1"></a>                 y<span class="op">=</span><span class="st">&#39;total_bill&#39;</span>, </span>
<span id="cb741-7"><a href="#cb741-7" aria-hidden="true" tabindex="-1"></a>                 color<span class="op">=</span><span class="st">&#39;royalblue&#39;</span>, </span>
<span id="cb741-8"><a href="#cb741-8" aria-hidden="true" tabindex="-1"></a>                 ax<span class="op">=</span>g[<span class="dv">0</span>])</span>
<span id="cb741-9"><a href="#cb741-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb741-10"><a href="#cb741-10" aria-hidden="true" tabindex="-1"></a>g1.set_title(<span class="st">&#39;Boxplot of Total_Bill&#39;</span>, size<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb741-11"><a href="#cb741-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb741-12"><a href="#cb741-12" aria-hidden="true" tabindex="-1"></a>g2 <span class="op">=</span> sns.boxplot(data<span class="op">=</span>df, </span>
<span id="cb741-13"><a href="#cb741-13" aria-hidden="true" tabindex="-1"></a>                 y<span class="op">=</span><span class="st">&#39;tip&#39;</span>, </span>
<span id="cb741-14"><a href="#cb741-14" aria-hidden="true" tabindex="-1"></a>                 color<span class="op">=</span><span class="st">&#39;coral&#39;</span>, </span>
<span id="cb741-15"><a href="#cb741-15" aria-hidden="true" tabindex="-1"></a>                 ax<span class="op">=</span>g[<span class="dv">1</span>])</span>
<span id="cb741-16"><a href="#cb741-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb741-17"><a href="#cb741-17" aria-hidden="true" tabindex="-1"></a>g2.set_title(<span class="st">&#39;Boxplot of Tip&#39;</span>, </span>
<span id="cb741-18"><a href="#cb741-18" aria-hidden="true" tabindex="-1"></a>             size<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb741-19"><a href="#cb741-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb741-20"><a href="#cb741-20" aria-hidden="true" tabindex="-1"></a>g3 <span class="op">=</span> sns.boxplot(data<span class="op">=</span>df, </span>
<span id="cb741-21"><a href="#cb741-21" aria-hidden="true" tabindex="-1"></a>                 y<span class="op">=</span><span class="st">&#39;size&#39;</span>, </span>
<span id="cb741-22"><a href="#cb741-22" aria-hidden="true" tabindex="-1"></a>                 color<span class="op">=</span><span class="st">&#39;gold&#39;</span>, </span>
<span id="cb741-23"><a href="#cb741-23" aria-hidden="true" tabindex="-1"></a>                 ax<span class="op">=</span>g[<span class="dv">2</span>])</span>
<span id="cb741-24"><a href="#cb741-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb741-25"><a href="#cb741-25" aria-hidden="true" tabindex="-1"></a>g3.set_title(<span class="st">&#39;Boxplot of Size&#39;</span>, size<span class="op">=</span><span class="dv">15</span>)<span class="op">;</span></span></code></pre></div>
<p>Los valores atípicos se confirman y tiran de la media hacia arriba. Ver los <em>bigotes</em> más largos para total_bill y propina.</p>
<ul>
<li>Para las variables categóricas, podemos trazar barras con recuentos.</li>
</ul>
<div class="sourceCode" id="cb742"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb742-1"><a href="#cb742-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Countplots of categorical variables</span></span>
<span id="cb742-2"><a href="#cb742-2" aria-hidden="true" tabindex="-1"></a>fig, g <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">4</span>, figsize<span class="op">=</span>(<span class="dv">28</span>,<span class="dv">9</span>))</span>
<span id="cb742-3"><a href="#cb742-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb742-4"><a href="#cb742-4" aria-hidden="true" tabindex="-1"></a>g1 <span class="op">=</span> sns.countplot(data<span class="op">=</span>df, x<span class="op">=</span><span class="st">&#39;sex&#39;</span>, color<span class="op">=</span><span class="st">&#39;royalblue&#39;</span>, ax<span class="op">=</span>g[<span class="dv">0</span>])</span>
<span id="cb742-5"><a href="#cb742-5" aria-hidden="true" tabindex="-1"></a>g1.set_title(<span class="st">&#39;Countplot of Sex&#39;</span>, size<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb742-6"><a href="#cb742-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb742-7"><a href="#cb742-7" aria-hidden="true" tabindex="-1"></a>g2 <span class="op">=</span> sns.countplot(data<span class="op">=</span>df, x<span class="op">=</span><span class="st">&#39;day&#39;</span>, color<span class="op">=</span><span class="st">&#39;coral&#39;</span>, ax<span class="op">=</span>g[<span class="dv">1</span>])</span>
<span id="cb742-8"><a href="#cb742-8" aria-hidden="true" tabindex="-1"></a>g2.set_title(<span class="st">&#39;Countplot of Day&#39;</span>, size<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb742-9"><a href="#cb742-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb742-10"><a href="#cb742-10" aria-hidden="true" tabindex="-1"></a>g3 <span class="op">=</span> sns.countplot(data<span class="op">=</span>df, x<span class="op">=</span><span class="st">&#39;time&#39;</span>, color<span class="op">=</span><span class="st">&#39;gold&#39;</span>, ax<span class="op">=</span>g[<span class="dv">2</span>])</span>
<span id="cb742-11"><a href="#cb742-11" aria-hidden="true" tabindex="-1"></a>g3.set_title(<span class="st">&#39;Countplot of Time&#39;</span>, size<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb742-12"><a href="#cb742-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb742-13"><a href="#cb742-13" aria-hidden="true" tabindex="-1"></a>g4 <span class="op">=</span> sns.countplot(data<span class="op">=</span>df, x<span class="op">=</span><span class="st">&#39;smoker&#39;</span>, color<span class="op">=</span><span class="st">&#39;gold&#39;</span>, ax<span class="op">=</span>g[<span class="dv">3</span>])</span>
<span id="cb742-14"><a href="#cb742-14" aria-hidden="true" tabindex="-1"></a>g4.set_title(<span class="st">&#39;Countplot of Smoker&#39;</span>, size<span class="op">=</span><span class="dv">15</span>)<span class="op">;</span></span></code></pre></div>
</div>
<div id="correlaciones" class="section level4 hasAnchor" number="4.6.4.4">
<h4 class="hasAnchor"><span class="header-section-number">4.6.4.4</span> Correlaciones<a href="#correlaciones" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p>La correlación es la medida estadística de la relación lineal entre dos variables numéricas.</p></li>
<li><p>Así que, como vamos a hacer un análisis multivariante, creo que es interesante calcular las correlaciones, porque esto puede orientar tus esfuerzos.</p></li>
<li><p>En caso de que tengas muchas variables, será mejor comprobar principalmente (si no sólo) las que tengan correlaciones más altas.</p></li>
</ul>
<div class="sourceCode" id="cb743"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb743-1"><a href="#cb743-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.stats <span class="im">as</span> stats</span>
<span id="cb743-2"><a href="#cb743-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb743-3"><a href="#cb743-3" aria-hidden="true" tabindex="-1"></a>stats.shapiro(mtcars[<span class="st">&quot;mpg&quot;</span>])</span>
<span id="cb743-4"><a href="#cb743-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb743-5"><a href="#cb743-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Test para evaluar normalidad </span></span>
<span id="cb743-6"><a href="#cb743-6" aria-hidden="true" tabindex="-1"></a><span class="co"># H0: normal</span></span>
<span id="cb743-7"><a href="#cb743-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb743-8"><a href="#cb743-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Función para testear normalidad con un alpha de 0.05 </span></span>
<span id="cb743-9"><a href="#cb743-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb743-10"><a href="#cb743-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_normality(data):</span>
<span id="cb743-11"><a href="#cb743-11" aria-hidden="true" tabindex="-1"></a>  stat, p <span class="op">=</span> stats.shapiro(data)</span>
<span id="cb743-12"><a href="#cb743-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> p <span class="op">&lt;</span> <span class="fl">0.05</span>:</span>
<span id="cb743-13"><a href="#cb743-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;p-Value: </span><span class="sc">{</span>p<span class="sc">}</span><span class="ss">. Not normaly distributed.&#39;</span>)</span>
<span id="cb743-14"><a href="#cb743-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>:</span>
<span id="cb743-15"><a href="#cb743-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;p-Value: </span><span class="sc">{</span>p<span class="sc">}</span><span class="ss">. Normaly distributed.&#39;</span>)</span>
<span id="cb743-16"><a href="#cb743-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb743-17"><a href="#cb743-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Tests</span></span>
<span id="cb743-18"><a href="#cb743-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb743-19"><a href="#cb743-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> df.select_dtypes(include<span class="op">=</span>[<span class="st">&#39;int&#39;</span>, <span class="st">&#39;float&#39;</span>]).columns:</span>
<span id="cb743-20"><a href="#cb743-20" aria-hidden="true" tabindex="-1"></a>  test_normality(df[col])</span></code></pre></div>
<p>La prueba estándar es <em>Pearson</em>, pero si los datos no son normales, el método <em>Spearman</em> es más adecuado.</p>
<div class="sourceCode" id="cb744"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb744-1"><a href="#cb744-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data not normal, use Spearman</span></span>
<span id="cb744-2"><a href="#cb744-2" aria-hidden="true" tabindex="-1"></a>correlation_calc <span class="op">=</span> df.corr(method<span class="op">=</span><span class="st">&#39;spearman&#39;</span>)</span>
<span id="cb744-3"><a href="#cb744-3" aria-hidden="true" tabindex="-1"></a>sns.heatmap( correlation_calc , annot<span class="op">=</span><span class="va">True</span>, cmap<span class="op">=</span><span class="st">&#39;RdBu&#39;</span>)<span class="op">;</span></span></code></pre></div>
<ul>
<li><p>Si aplicamos el método de Pearson, los resultados no son tan diferentes. Esto tiene dos razones principales: 1. la muestra es pequeña; 2. lo que probablemente afecta más a la distribución son los valores atípicos.</p></li>
<li><p>En el gráfico anterior, vemos que la factura total está más relacionada con la propina que con el tamaño de la fiesta.</p></li>
</ul>
</div>
</div>
<div id="ejemplo-2-datos-con-precios-de-casas" class="section level3 hasAnchor" number="4.6.5">
<h3 class="hasAnchor"><span class="header-section-number">4.6.5</span> Ejemplo 2: datos con precios de casas<a href="#ejemplo-2-datos-con-precios-de-casas" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb745"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb745-1"><a href="#cb745-1" aria-hidden="true" tabindex="-1"></a>main</span>
<span id="cb745-2"><a href="#cb745-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb745-3"><a href="#cb745-3" aria-hidden="true" tabindex="-1"></a>datos</span>
<span id="cb745-4"><a href="#cb745-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb745-5"><a href="#cb745-5" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&quot;datos</span><span class="ch">\\</span><span class="st">MELBOURNE_HOUSE_PRICES_LESS.csv&quot;</span>)</span>
<span id="cb745-6"><a href="#cb745-6" aria-hidden="true" tabindex="-1"></a>df.head()</span>
<span id="cb745-7"><a href="#cb745-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb745-8"><a href="#cb745-8" aria-hidden="true" tabindex="-1"></a>df.info()</span>
<span id="cb745-9"><a href="#cb745-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb745-10"><a href="#cb745-10" aria-hidden="true" tabindex="-1"></a>average <span class="op">=</span> df[<span class="st">&#39;Price&#39;</span>].mean()</span>
<span id="cb745-11"><a href="#cb745-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(average)</span>
<span id="cb745-12"><a href="#cb745-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb745-13"><a href="#cb745-13" aria-hidden="true" tabindex="-1"></a>med <span class="op">=</span> df[<span class="st">&#39;Price&#39;</span>].median()</span>
<span id="cb745-14"><a href="#cb745-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(med)</span>
<span id="cb745-15"><a href="#cb745-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb745-16"><a href="#cb745-16" aria-hidden="true" tabindex="-1"></a>standard_deviation <span class="op">=</span> df[<span class="st">&#39;Price&#39;</span>].std()</span>
<span id="cb745-17"><a href="#cb745-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(standard_deviation)</span>
<span id="cb745-18"><a href="#cb745-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb745-19"><a href="#cb745-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Commented out IPython magic to ensure Python compatibility.</span></span>
<span id="cb745-20"><a href="#cb745-20" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb745-21"><a href="#cb745-21" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb745-22"><a href="#cb745-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb745-23"><a href="#cb745-23" aria-hidden="true" tabindex="-1"></a><span class="co"># %matplotlib inline</span></span>
<span id="cb745-24"><a href="#cb745-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb745-25"><a href="#cb745-25" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>(style<span class="op">=</span><span class="st">&quot;whitegrid&quot;</span>)</span>
<span id="cb745-26"><a href="#cb745-26" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">8</span>))</span>
<span id="cb745-27"><a href="#cb745-27" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> sns.boxplot(x<span class="op">=</span><span class="st">&#39;Price&#39;</span>, data<span class="op">=</span>df, orient<span class="op">=</span><span class="st">&quot;v&quot;</span>)</span>
<span id="cb745-28"><a href="#cb745-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb745-29"><a href="#cb745-29" aria-hidden="true" tabindex="-1"></a>os.chdir(figuras)</span>
<span id="cb745-30"><a href="#cb745-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb745-31"><a href="#cb745-31" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">10</span>))</span>
<span id="cb745-32"><a href="#cb745-32" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> sns.boxplot(x<span class="op">=</span><span class="st">&#39;Type&#39;</span>, y<span class="op">=</span><span class="st">&#39;Price&#39;</span>, data<span class="op">=</span>df, orient<span class="op">=</span><span class="st">&quot;v&quot;</span>)</span>
<span id="cb745-33"><a href="#cb745-33" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">&quot;f1.pdf&quot;</span>)</span>
<span id="cb745-34"><a href="#cb745-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb745-35"><a href="#cb745-35" aria-hidden="true" tabindex="-1"></a>filter_data <span class="op">=</span> df.dropna(subset<span class="op">=</span>[<span class="st">&#39;Price&#39;</span>])</span>
<span id="cb745-36"><a href="#cb745-36" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">14</span>,<span class="dv">8</span>))</span>
<span id="cb745-37"><a href="#cb745-37" aria-hidden="true" tabindex="-1"></a>sns.distplot(filter_data[<span class="st">&#39;Price&#39;</span>], kde<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb745-38"><a href="#cb745-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb745-39"><a href="#cb745-39" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;Type&#39;</span>].unique()</span>
<span id="cb745-40"><a href="#cb745-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb745-41"><a href="#cb745-41" aria-hidden="true" tabindex="-1"></a>type_counts <span class="op">=</span> df[<span class="st">&#39;Type&#39;</span>].value_counts()</span>
<span id="cb745-42"><a href="#cb745-42" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> pd.DataFrame(</span>
<span id="cb745-43"><a href="#cb745-43" aria-hidden="true" tabindex="-1"></a>                    {<span class="st">&#39;house_type&#39;</span>: type_counts}, </span>
<span id="cb745-44"><a href="#cb745-44" aria-hidden="true" tabindex="-1"></a>                   index <span class="op">=</span> [<span class="st">&#39;t&#39;</span>, <span class="st">&#39;h&#39;</span>, <span class="st">&#39;u&#39;</span>]</span>
<span id="cb745-45"><a href="#cb745-45" aria-hidden="true" tabindex="-1"></a>                  )</span>
<span id="cb745-46"><a href="#cb745-46" aria-hidden="true" tabindex="-1"></a>df2.plot.pie(y<span class="op">=</span><span class="st">&#39;house_type&#39;</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>), autopct<span class="op">=</span><span class="st">&#39;</span><span class="sc">%1.1f%%</span><span class="st">&#39;</span>)</span>
<span id="cb745-47"><a href="#cb745-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb745-48"><a href="#cb745-48" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>(style<span class="op">=</span><span class="st">&#39;darkgrid&#39;</span>)</span>
<span id="cb745-49"><a href="#cb745-49" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">10</span>))</span>
<span id="cb745-50"><a href="#cb745-50" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> sns.countplot(x<span class="op">=</span><span class="st">&#39;Regionname&#39;</span>, data<span class="op">=</span>df)</span></code></pre></div>
</div>
<div id="ejemplo-3" class="section level3 hasAnchor" number="4.6.6">
<h3 class="hasAnchor"><span class="header-section-number">4.6.6</span> Ejemplo 3<a href="#ejemplo-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb746"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb746-1"><a href="#cb746-1" aria-hidden="true" tabindex="-1"></a>os.chdir(datos)</span>
<span id="cb746-2"><a href="#cb746-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&quot;house_prices.csv&quot;</span>)</span>
<span id="cb746-3"><a href="#cb746-3" aria-hidden="true" tabindex="-1"></a>df.head()</span>
<span id="cb746-4"><a href="#cb746-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb746-5"><a href="#cb746-5" aria-hidden="true" tabindex="-1"></a>df.head()</span>
<span id="cb746-6"><a href="#cb746-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb746-7"><a href="#cb746-7" aria-hidden="true" tabindex="-1"></a>df.shape</span>
<span id="cb746-8"><a href="#cb746-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb746-9"><a href="#cb746-9" aria-hidden="true" tabindex="-1"></a>df.info()</span>
<span id="cb746-10"><a href="#cb746-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb746-11"><a href="#cb746-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Histograma básico exploratorio</span></span>
<span id="cb746-12"><a href="#cb746-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb746-13"><a href="#cb746-13" aria-hidden="true" tabindex="-1"></a>saleprice <span class="op">=</span> df[<span class="st">&#39;SalePrice&#39;</span>]</span>
<span id="cb746-14"><a href="#cb746-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb746-15"><a href="#cb746-15" aria-hidden="true" tabindex="-1"></a>mean<span class="op">=</span>saleprice.mean()</span>
<span id="cb746-16"><a href="#cb746-16" aria-hidden="true" tabindex="-1"></a>median<span class="op">=</span>saleprice.median()</span>
<span id="cb746-17"><a href="#cb746-17" aria-hidden="true" tabindex="-1"></a>mode<span class="op">=</span>saleprice.mode()</span>
<span id="cb746-18"><a href="#cb746-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb746-19"><a href="#cb746-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">&#39;Mean: &#39;</span>,mean,<span class="st">&#39;</span><span class="ch">\n</span><span class="st">Median: &#39;</span>,median,<span class="st">&#39;</span><span class="ch">\n</span><span class="st">Mode: &#39;</span>,mode[<span class="dv">0</span>])</span>
<span id="cb746-20"><a href="#cb746-20" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">5</span>))</span>
<span id="cb746-21"><a href="#cb746-21" aria-hidden="true" tabindex="-1"></a>plt.hist(saleprice,bins<span class="op">=</span><span class="dv">100</span>,color<span class="op">=</span><span class="st">&#39;grey&#39;</span>)</span>
<span id="cb746-22"><a href="#cb746-22" aria-hidden="true" tabindex="-1"></a>plt.axvline(mean,color<span class="op">=</span><span class="st">&#39;red&#39;</span>,label<span class="op">=</span><span class="st">&#39;Mean&#39;</span>)</span>
<span id="cb746-23"><a href="#cb746-23" aria-hidden="true" tabindex="-1"></a>plt.axvline(median,color<span class="op">=</span><span class="st">&#39;yellow&#39;</span>,label<span class="op">=</span><span class="st">&#39;Median&#39;</span>)</span>
<span id="cb746-24"><a href="#cb746-24" aria-hidden="true" tabindex="-1"></a>plt.axvline(mode[<span class="dv">0</span>],color<span class="op">=</span><span class="st">&#39;green&#39;</span>,label<span class="op">=</span><span class="st">&#39;Mode&#39;</span>)</span>
<span id="cb746-25"><a href="#cb746-25" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;SalePrice&#39;</span>)</span>
<span id="cb746-26"><a href="#cb746-26" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Frequency&#39;</span>)</span>
<span id="cb746-27"><a href="#cb746-27" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb746-28"><a href="#cb746-28" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb746-29"><a href="#cb746-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb746-30"><a href="#cb746-30" aria-hidden="true" tabindex="-1"></a>saleprice.cumsum().head()</span></code></pre></div>
<ul>
<li>Dispersión</li>
</ul>
<div class="sourceCode" id="cb747"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb747-1"><a href="#cb747-1" aria-hidden="true" tabindex="-1"></a>saleprice.<span class="bu">min</span>()</span>
<span id="cb747-2"><a href="#cb747-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb747-3"><a href="#cb747-3" aria-hidden="true" tabindex="-1"></a>saleprice.<span class="bu">max</span>()</span>
<span id="cb747-4"><a href="#cb747-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb747-5"><a href="#cb747-5" aria-hidden="true" tabindex="-1"></a>saleprice.<span class="bu">max</span>()<span class="op">-</span>saleprice.<span class="bu">min</span>()</span>
<span id="cb747-6"><a href="#cb747-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb747-7"><a href="#cb747-7" aria-hidden="true" tabindex="-1"></a><span class="co">#varianza</span></span>
<span id="cb747-8"><a href="#cb747-8" aria-hidden="true" tabindex="-1"></a>saleprice.var()</span>
<span id="cb747-9"><a href="#cb747-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb747-10"><a href="#cb747-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> math <span class="im">import</span> sqrt</span>
<span id="cb747-11"><a href="#cb747-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb747-12"><a href="#cb747-12" aria-hidden="true" tabindex="-1"></a>std <span class="op">=</span> sqrt(saleprice.var())</span>
<span id="cb747-13"><a href="#cb747-13" aria-hidden="true" tabindex="-1"></a>std</span>
<span id="cb747-14"><a href="#cb747-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb747-15"><a href="#cb747-15" aria-hidden="true" tabindex="-1"></a>saleprice.skew()</span>
<span id="cb747-16"><a href="#cb747-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb747-17"><a href="#cb747-17" aria-hidden="true" tabindex="-1"></a>saleprice.kurt()</span>
<span id="cb747-18"><a href="#cb747-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb747-19"><a href="#cb747-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Pasamos a numpy para ocupar funciones de numpy</span></span>
<span id="cb747-20"><a href="#cb747-20" aria-hidden="true" tabindex="-1"></a>h <span class="op">=</span> np.array(df[<span class="st">&#39;SalePrice&#39;</span>])</span>
<span id="cb747-21"><a href="#cb747-21" aria-hidden="true" tabindex="-1"></a>h <span class="op">=</span> <span class="bu">sorted</span>(h)</span>
<span id="cb747-22"><a href="#cb747-22" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb747-23"><a href="#cb747-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Generamos una distribución normal con la misma media y sd</span></span>
<span id="cb747-24"><a href="#cb747-24" aria-hidden="true" tabindex="-1"></a>fit <span class="op">=</span> stats.norm.pdf(h, np.mean(h), np.std(h)) </span>
<span id="cb747-25"><a href="#cb747-25" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb747-26"><a href="#cb747-26" aria-hidden="true" tabindex="-1"></a><span class="co">#plot both series on the histogram</span></span>
<span id="cb747-27"><a href="#cb747-27" aria-hidden="true" tabindex="-1"></a>plt.plot(h, fit,<span class="st">&#39;-&#39;</span>,linewidth <span class="op">=</span> <span class="dv">4</span>,label<span class="op">=</span><span class="st">&quot;Normal distribution with same mean and var&quot;</span>)</span>
<span id="cb747-28"><a href="#cb747-28" aria-hidden="true" tabindex="-1"></a>plt.hist(h, bins <span class="op">=</span> <span class="dv">100</span>,label<span class="op">=</span><span class="st">&quot;Actual distribution&quot;</span>, density <span class="op">=</span> <span class="va">True</span>)    </span>
<span id="cb747-29"><a href="#cb747-29" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb747-30"><a href="#cb747-30" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb747-31"><a href="#cb747-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb747-32"><a href="#cb747-32" aria-hidden="true" tabindex="-1"></a>fit</span>
<span id="cb747-33"><a href="#cb747-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb747-34"><a href="#cb747-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Chequeamos correlaciones </span></span>
<span id="cb747-35"><a href="#cb747-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb747-36"><a href="#cb747-36" aria-hidden="true" tabindex="-1"></a>corelation<span class="op">=</span>df[[<span class="st">&#39;LotArea&#39;</span>,<span class="st">&#39;GrLivArea&#39;</span>,<span class="st">&#39;GarageArea&#39;</span>,<span class="st">&#39;SalePrice&#39;</span>]].corr()</span>
<span id="cb747-37"><a href="#cb747-37" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (corelation)</span>
<span id="cb747-38"><a href="#cb747-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb747-39"><a href="#cb747-39" aria-hidden="true" tabindex="-1"></a>sns.heatmap(corelation)</span>
<span id="cb747-40"><a href="#cb747-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb747-41"><a href="#cb747-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Chequeamos covarianza</span></span>
<span id="cb747-42"><a href="#cb747-42" aria-hidden="true" tabindex="-1"></a>df[[<span class="st">&#39;LotArea&#39;</span>,<span class="st">&#39;GrLivArea&#39;</span>,<span class="st">&#39;GarageArea&#39;</span>,<span class="st">&#39;SalePrice&#39;</span>]].cov().head()</span>
<span id="cb747-43"><a href="#cb747-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb747-44"><a href="#cb747-44" aria-hidden="true" tabindex="-1"></a><span class="co"># #50 percentile i.e median</span></span>
<span id="cb747-45"><a href="#cb747-45" aria-hidden="true" tabindex="-1"></a><span class="co"># np.percentile(df[&#39;salary&#39;], 50)</span></span>
<span id="cb747-46"><a href="#cb747-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb747-47"><a href="#cb747-47" aria-hidden="true" tabindex="-1"></a>saleprice.quantile(<span class="fl">0.5</span>)</span>
<span id="cb747-48"><a href="#cb747-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb747-49"><a href="#cb747-49" aria-hidden="true" tabindex="-1"></a><span class="co"># q75 = np.percentile(df[&#39;salary&#39;], 75)</span></span>
<span id="cb747-50"><a href="#cb747-50" aria-hidden="true" tabindex="-1"></a><span class="co"># q75</span></span>
<span id="cb747-51"><a href="#cb747-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb747-52"><a href="#cb747-52" aria-hidden="true" tabindex="-1"></a>q3 <span class="op">=</span> saleprice.quantile(<span class="fl">0.75</span>)</span>
<span id="cb747-53"><a href="#cb747-53" aria-hidden="true" tabindex="-1"></a>q3</span>
<span id="cb747-54"><a href="#cb747-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb747-55"><a href="#cb747-55" aria-hidden="true" tabindex="-1"></a><span class="co">#25th percentile</span></span>
<span id="cb747-56"><a href="#cb747-56" aria-hidden="true" tabindex="-1"></a><span class="co"># q25 = np.percentile(df[&#39;salary&#39;], 25)</span></span>
<span id="cb747-57"><a href="#cb747-57" aria-hidden="true" tabindex="-1"></a>q1 <span class="op">=</span> saleprice.quantile(<span class="fl">0.25</span>)</span>
<span id="cb747-58"><a href="#cb747-58" aria-hidden="true" tabindex="-1"></a>q1</span>
<span id="cb747-59"><a href="#cb747-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb747-60"><a href="#cb747-60" aria-hidden="true" tabindex="-1"></a><span class="co">#interquartile range</span></span>
<span id="cb747-61"><a href="#cb747-61" aria-hidden="true" tabindex="-1"></a>IQR <span class="op">=</span> q3  <span class="op">-</span> q1</span>
<span id="cb747-62"><a href="#cb747-62" aria-hidden="true" tabindex="-1"></a>IQR</span>
<span id="cb747-63"><a href="#cb747-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb747-64"><a href="#cb747-64" aria-hidden="true" tabindex="-1"></a>plt.boxplot(saleprice)</span>
<span id="cb747-65"><a href="#cb747-65" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
</div>
<div id="ejemplo-4" class="section level3 hasAnchor" number="4.6.7">
<h3 class="hasAnchor"><span class="header-section-number">4.6.7</span> Ejemplo 4<a href="#ejemplo-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb748"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb748-1"><a href="#cb748-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&#39;insurance.csv&#39;</span>)</span>
<span id="cb748-2"><a href="#cb748-2" aria-hidden="true" tabindex="-1"></a>df</span>
<span id="cb748-3"><a href="#cb748-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb748-4"><a href="#cb748-4" aria-hidden="true" tabindex="-1"></a>df.head()</span>
<span id="cb748-5"><a href="#cb748-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb748-6"><a href="#cb748-6" aria-hidden="true" tabindex="-1"></a>df.info()</span>
<span id="cb748-7"><a href="#cb748-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb748-8"><a href="#cb748-8" aria-hidden="true" tabindex="-1"></a>df.shape</span>
<span id="cb748-9"><a href="#cb748-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb748-10"><a href="#cb748-10" aria-hidden="true" tabindex="-1"></a>df.columns</span>
<span id="cb748-11"><a href="#cb748-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb748-12"><a href="#cb748-12" aria-hidden="true" tabindex="-1"></a>df.describe()</span>
<span id="cb748-13"><a href="#cb748-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb748-14"><a href="#cb748-14" aria-hidden="true" tabindex="-1"></a>df.describe(include<span class="op">=</span><span class="st">&#39;O&#39;</span>)</span>
<span id="cb748-15"><a href="#cb748-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb748-16"><a href="#cb748-16" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(df.sex.unique())</span>
<span id="cb748-17"><a href="#cb748-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb748-18"><a href="#cb748-18" aria-hidden="true" tabindex="-1"></a>df.isnull().<span class="bu">sum</span>()</span>
<span id="cb748-19"><a href="#cb748-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb748-20"><a href="#cb748-20" aria-hidden="true" tabindex="-1"></a>df[df.duplicated(keep<span class="op">=</span><span class="st">&#39;first&#39;</span>)]</span>
<span id="cb748-21"><a href="#cb748-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb748-22"><a href="#cb748-22" aria-hidden="true" tabindex="-1"></a>df.drop_duplicates(keep<span class="op">=</span><span class="st">&#39;first&#39;</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb748-23"><a href="#cb748-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb748-24"><a href="#cb748-24" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">6</span>))</span>
<span id="cb748-25"><a href="#cb748-25" aria-hidden="true" tabindex="-1"></a>sns.distplot(df.expenses,color<span class="op">=</span><span class="st">&#39;r&#39;</span>)</span>
<span id="cb748-26"><a href="#cb748-26" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Expenses Distribution&#39;</span>,size<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb748-27"><a href="#cb748-27" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Expenses&#39;</span>,size<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb748-28"><a href="#cb748-28" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Density&#39;</span>,size<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb748-29"><a href="#cb748-29" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb748-30"><a href="#cb748-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb748-31"><a href="#cb748-31" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">6</span>))</span>
<span id="cb748-32"><a href="#cb748-32" aria-hidden="true" tabindex="-1"></a>sns.histplot(df.age)</span>
<span id="cb748-33"><a href="#cb748-33" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Age Distribution&#39;</span>,size<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb748-34"><a href="#cb748-34" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Age&#39;</span>,size<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb748-35"><a href="#cb748-35" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Count&#39;</span>,size<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb748-36"><a href="#cb748-36" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb748-37"><a href="#cb748-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb748-38"><a href="#cb748-38" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">6</span>))</span>
<span id="cb748-39"><a href="#cb748-39" aria-hidden="true" tabindex="-1"></a>plt.hist(df.bmi,color<span class="op">=</span><span class="st">&#39;y&#39;</span>)</span>
<span id="cb748-40"><a href="#cb748-40" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;BMI Distribution&#39;</span>,size<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb748-41"><a href="#cb748-41" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb748-42"><a href="#cb748-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb748-43"><a href="#cb748-43" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize <span class="op">=</span> (<span class="dv">10</span>,<span class="dv">6</span>))</span>
<span id="cb748-44"><a href="#cb748-44" aria-hidden="true" tabindex="-1"></a>sns.boxplot(df.expenses)</span>
<span id="cb748-45"><a href="#cb748-45" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Distribution Charges&#39;</span>,size<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb748-46"><a href="#cb748-46" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb748-47"><a href="#cb748-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb748-48"><a href="#cb748-48" aria-hidden="true" tabindex="-1"></a>Q1 <span class="op">=</span> df[<span class="st">&#39;expenses&#39;</span>].quantile(<span class="fl">0.25</span>)</span>
<span id="cb748-49"><a href="#cb748-49" aria-hidden="true" tabindex="-1"></a>Q3 <span class="op">=</span> df[<span class="st">&#39;expenses&#39;</span>].quantile(<span class="fl">0.75</span>)</span>
<span id="cb748-50"><a href="#cb748-50" aria-hidden="true" tabindex="-1"></a>IQR <span class="op">=</span> Q3 <span class="op">-</span> Q1</span>
<span id="cb748-51"><a href="#cb748-51" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(IQR)</span>
<span id="cb748-52"><a href="#cb748-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb748-53"><a href="#cb748-53" aria-hidden="true" tabindex="-1"></a>df[(df[<span class="st">&#39;expenses&#39;</span>]<span class="op">&lt;</span> Q1<span class="op">-</span><span class="fl">1.5</span><span class="op">*</span> IQR) <span class="op">|</span> (df[<span class="st">&#39;expenses&#39;</span>]<span class="op">&gt;</span> Q3<span class="op">+</span><span class="fl">1.5</span><span class="op">*</span> IQR)]</span>
<span id="cb748-54"><a href="#cb748-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb748-55"><a href="#cb748-55" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">6</span>))</span>
<span id="cb748-56"><a href="#cb748-56" aria-hidden="true" tabindex="-1"></a>sns.countplot(x <span class="op">=</span> <span class="st">&#39;sex&#39;</span>, data <span class="op">=</span> df)</span>
<span id="cb748-57"><a href="#cb748-57" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Total Number of Male and Female&#39;</span>,size<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb748-58"><a href="#cb748-58" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Sex&#39;</span>,size<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb748-59"><a href="#cb748-59" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb748-60"><a href="#cb748-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb748-61"><a href="#cb748-61" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize <span class="op">=</span> (<span class="dv">10</span>,<span class="dv">6</span>))</span>
<span id="cb748-62"><a href="#cb748-62" aria-hidden="true" tabindex="-1"></a>sns.countplot(df.children)</span>
<span id="cb748-63"><a href="#cb748-63" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Children Distribution&#39;</span>,size<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb748-64"><a href="#cb748-64" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Children&#39;</span>,size<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb748-65"><a href="#cb748-65" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Count&#39;</span>,size<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb748-66"><a href="#cb748-66" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb748-67"><a href="#cb748-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb748-68"><a href="#cb748-68" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize <span class="op">=</span> (<span class="dv">10</span>,<span class="dv">6</span>))</span>
<span id="cb748-69"><a href="#cb748-69" aria-hidden="true" tabindex="-1"></a>sns.countplot(df.smoker)</span>
<span id="cb748-70"><a href="#cb748-70" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Smoker Distribution&#39;</span>,size<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb748-71"><a href="#cb748-71" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Smoker&#39;</span>,size<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb748-72"><a href="#cb748-72" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Count&#39;</span>,size<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb748-73"><a href="#cb748-73" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb748-74"><a href="#cb748-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb748-75"><a href="#cb748-75" aria-hidden="true" tabindex="-1"></a>df.smoker.value_counts()</span>
<span id="cb748-76"><a href="#cb748-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb748-77"><a href="#cb748-77" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize <span class="op">=</span> (<span class="dv">10</span>,<span class="dv">6</span>))</span>
<span id="cb748-78"><a href="#cb748-78" aria-hidden="true" tabindex="-1"></a>sns.countplot(df.region,palette<span class="op">=</span><span class="st">&#39;Blues&#39;</span>)</span>
<span id="cb748-79"><a href="#cb748-79" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Region Distribution&#39;</span>,size<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb748-80"><a href="#cb748-80" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Region&#39;</span>,size<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb748-81"><a href="#cb748-81" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Count&#39;</span>,size<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb748-82"><a href="#cb748-82" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb748-83"><a href="#cb748-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb748-84"><a href="#cb748-84" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize <span class="op">=</span> (<span class="dv">10</span>,<span class="dv">6</span>))</span>
<span id="cb748-85"><a href="#cb748-85" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x<span class="op">=</span><span class="st">&#39;age&#39;</span>,y<span class="op">=</span><span class="st">&#39;expenses&#39;</span>,color<span class="op">=</span><span class="st">&#39;r&#39;</span>,data<span class="op">=</span>df)</span>
<span id="cb748-86"><a href="#cb748-86" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Age vs Charges&#39;</span>,size<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb748-87"><a href="#cb748-87" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Age&#39;</span>,size<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb748-88"><a href="#cb748-88" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Charges&#39;</span>,size<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb748-89"><a href="#cb748-89" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb748-90"><a href="#cb748-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb748-91"><a href="#cb748-91" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Correlation between age and charges is : </span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(<span class="bu">round</span>(df.corr()[<span class="st">&#39;age&#39;</span>][<span class="st">&#39;expenses&#39;</span>],<span class="dv">3</span>)))</span>
<span id="cb748-92"><a href="#cb748-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb748-93"><a href="#cb748-93" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize <span class="op">=</span> (<span class="dv">10</span>,<span class="dv">6</span>))</span>
<span id="cb748-94"><a href="#cb748-94" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">&#39;darkgrid&#39;</span>)</span>
<span id="cb748-95"><a href="#cb748-95" aria-hidden="true" tabindex="-1"></a>sns.boxplot(x<span class="op">=</span><span class="st">&#39;smoker&#39;</span>,y<span class="op">=</span><span class="st">&#39;expenses&#39;</span>,data<span class="op">=</span>df)</span>
<span id="cb748-96"><a href="#cb748-96" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Smoker vs Expenses&#39;</span>,size<span class="op">=</span><span class="dv">18</span>)<span class="op">;</span></span>
<span id="cb748-97"><a href="#cb748-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb748-98"><a href="#cb748-98" aria-hidden="true" tabindex="-1"></a>sns.pairplot(df, </span>
<span id="cb748-99"><a href="#cb748-99" aria-hidden="true" tabindex="-1"></a>                 markers<span class="op">=</span><span class="st">&quot;+&quot;</span>,</span>
<span id="cb748-100"><a href="#cb748-100" aria-hidden="true" tabindex="-1"></a>                 diag_kind<span class="op">=</span><span class="st">&quot;kde&quot;</span>,</span>
<span id="cb748-101"><a href="#cb748-101" aria-hidden="true" tabindex="-1"></a>                 kind<span class="op">=</span><span class="st">&#39;reg&#39;</span>,</span>
<span id="cb748-102"><a href="#cb748-102" aria-hidden="true" tabindex="-1"></a>                 plot_kws<span class="op">=</span>{<span class="st">&#39;line_kws&#39;</span>:{<span class="st">&#39;color&#39;</span>:<span class="st">&#39;#aec6cf&#39;</span>}, </span>
<span id="cb748-103"><a href="#cb748-103" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&#39;scatter_kws&#39;</span>: {<span class="st">&#39;alpha&#39;</span>: <span class="fl">0.7</span>, </span>
<span id="cb748-104"><a href="#cb748-104" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">&#39;color&#39;</span>: <span class="st">&#39;red&#39;</span>}},</span>
<span id="cb748-105"><a href="#cb748-105" aria-hidden="true" tabindex="-1"></a>                 corner<span class="op">=</span><span class="va">True</span>)<span class="op">;</span></span>
<span id="cb748-106"><a href="#cb748-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb748-107"><a href="#cb748-107" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize <span class="op">=</span> (<span class="dv">10</span>,<span class="dv">6</span>))</span>
<span id="cb748-108"><a href="#cb748-108" aria-hidden="true" tabindex="-1"></a>sns.heatmap(df.corr(),annot<span class="op">=</span><span class="va">True</span>,square<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb748-109"><a href="#cb748-109" aria-hidden="true" tabindex="-1"></a>            cmap<span class="op">=</span><span class="st">&#39;RdBu&#39;</span>,</span>
<span id="cb748-110"><a href="#cb748-110" aria-hidden="true" tabindex="-1"></a>            vmax<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb748-111"><a href="#cb748-111" aria-hidden="true" tabindex="-1"></a>            vmin<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb748-112"><a href="#cb748-112" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Correlations Between Variables&#39;</span>,size<span class="op">=</span><span class="dv">18</span>)<span class="op">;</span></span>
<span id="cb748-113"><a href="#cb748-113" aria-hidden="true" tabindex="-1"></a>plt.xticks(size<span class="op">=</span><span class="dv">13</span>)</span>
<span id="cb748-114"><a href="#cb748-114" aria-hidden="true" tabindex="-1"></a>plt.yticks(size<span class="op">=</span><span class="dv">13</span>)</span>
<span id="cb748-115"><a href="#cb748-115" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
</div>
<div id="ejemplo-5-desigualdad-de-ingreso-usando-gapminder" class="section level3 hasAnchor" number="4.6.8">
<h3 class="hasAnchor"><span class="header-section-number">4.6.8</span> Ejemplo 5 : Desigualdad de ingreso usando Gapminder<a href="#ejemplo-5-desigualdad-de-ingreso-usando-gapminder" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<strong>Table of Contents</strong>
<ul>
<li>
<a href="#intro">Introducción</a>
</li>
<li>
<a href="#wrangling">Data Wrangling</a>
</li>
<li>
<a href="#eda">Exploratory Data Analysis</a>
</li>
<li>
<a href="#conclusions">Conclusions</a>
</li>
</ul>
<p><a id='intro'></a></p>
<div id="introducción-1" class="section level4 hasAnchor" number="4.6.8.1">
<h4 class="hasAnchor"><span class="header-section-number">4.6.8.1</span> Introducción<a href="#introducción-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Este análisis se centra en la desigualdad de ingresos medida por el <em>Índice de Gini</em> y su asociación con métricas económicas como el PIB per cápita, las inversiones como % del PIB y los ingresos fiscales como % del PIB. También se incluye una métrica política, el índice de democracia de la EIU.</p>
<p>Esta investigación puede considerarse un punto de partida para cuestiones complejas como</p>
<ol style="list-style-type: decimal">
<li>¿Está asociado un mayor ingreso fiscal como % del PIB con una menor desigualdad de ingresos?</li>
<li>¿Se asocia un mayor índice de democracia de la EIU con una menor desigualdad de ingresos?</li>
<li>¿Se asocia un mayor PIB per cápita con una menor desigualdad de ingresos?</li>
<li>¿Se asocian las inversiones más altas como porcentaje del PIB con una menor desigualdad de ingresos?</li>
</ol>
<p>Este análisis utiliza el conjunto de datos gapminder de la Fundación Gapminder. La Fundación Gapminder es una empresa sin ánimo de lucro registrada en Estocolmo, Suecia, que promueve el desarrollo global sostenible y la consecución de los Objetivos de Desarrollo del Milenio de las Naciones Unidas mediante un mayor uso y comprensión de las estadísticas y otra información sobre el desarrollo social, económico y medioambiental a nivel local, nacional y global.</p>
<p>*El <a href="https://en.wikipedia.org/wiki/Gini_coefficient">Índice de Gini</a> es una medida de dispersión estadística que pretende representar la distribución de la renta o la riqueza de los residentes de una nación, y es la medida de desigualdad más utilizada. Fue desarrollado por el estadístico y sociólogo italiano Corrado Gini y publicado en su documento de 1912 Variabilidad y Mutabilidad.</p>
<div class="sourceCode" id="cb749"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb749-1"><a href="#cb749-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb749-2"><a href="#cb749-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb749-3"><a href="#cb749-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb749-4"><a href="#cb749-4" aria-hidden="true" tabindex="-1"></a><span class="co">#import plotly </span></span>
<span id="cb749-5"><a href="#cb749-5" aria-hidden="true" tabindex="-1"></a><span class="co">#import plotly.express as px</span></span>
<span id="cb749-6"><a href="#cb749-6" aria-hidden="true" tabindex="-1"></a><span class="co">#%matplotlib inline</span></span>
<span id="cb749-7"><a href="#cb749-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb749-8"><a href="#cb749-8" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">&#39;display.max_rows&#39;</span>, <span class="dv">10</span>)</span>
<span id="cb749-9"><a href="#cb749-9" aria-hidden="true" tabindex="-1"></a>pd.options.display.max_columns <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb749-10"><a href="#cb749-10" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">&quot;display.precision&quot;</span>, <span class="dv">2</span>)</span></code></pre></div>
<p><a id='wrangling'></a></p>
</div>
<div id="data-wrangling" class="section level4 hasAnchor" number="4.6.8.2">
<h4 class="hasAnchor"><span class="header-section-number">4.6.8.2</span> Data Wrangling<a href="#data-wrangling" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>En esta sección del informe se han cargado los datos, se ha comprobado su limpieza y se han comunicado los resultados.
##### Propiedades generales</p>
<p>El conjunto de datos contiene datos de los siguientes conjuntos de datos de GapMinder:</p>
<ol style="list-style-type: decimal">
<li>Índice de democracia de la EIU:</li>
</ol>
<p>“Este índice de democracia utiliza los datos de Economist Inteligence Unit para expresar la calidad de las democracias como un número entre 0 y 100. Se basa en 60 aspectos diferentes de las sociedades que son relevantes para la democracia: sufragio universal para todos los adultos, participación de los votantes, percepción de la protección de los derechos humanos y libertad para formar organizaciones y partidos.
El índice de democracia se calcula a partir de los 60 indicadores, divididos en cinco”“subíndices”“, que son</p>
<ol style="list-style-type: decimal">
<li>Índice de pluralismo electoral;</li>
<li>Índice de gobierno;</li>
<li>Índice de participación políticam;</li>
<li>Índice de cultura política;</li>
<li>Índice de libertad civil.</li>
</ol>
<p>Los subíndices se basan en la suma de las puntuaciones de aproximadamente 12 indicadores por subíndice, convertidos en una puntuación entre 0 y 100.
(The Economist publica el índice con una escala de 0 a 10, pero Gapminder lo ha convertido en 0 a 100 para facilitar su comunicación en forma de porcentaje)“.
<a href="https://docs.google.com/spreadsheets/d/1d0noZrwAWxNBTDSfDgG06_aLGWUz4R6fgDhRaUZbDzE/edit#gid=935776888" class="uri">https://docs.google.com/spreadsheets/d/1d0noZrwAWxNBTDSfDgG06_aLGWUz4R6fgDhRaUZbDzE/edit#gid=935776888</a></p>
<ol start="2" style="list-style-type: decimal">
<li><p>Ingresos: PIB per cápita, dólares constantes de la PPA:
El PIB per cápita mide el valor de todo lo producido en un país durante un año, dividido por el número de personas. La unidad está en dólares internacionales, a precios fijos de 2011. Los datos se ajustan para tener en cuenta la inflación y las diferencias en el coste de la vida entre los países, los llamados dólares PPA. El final de la serie temporal, entre 1990 y 2016, utiliza los últimos datos del PIB per cápita del Banco Mundial, procedentes de sus Indicadores de Desarrollo Mundial. Para retroceder en el tiempo antes de que la serie del Banco Mundial comience en 1990, hemos utilizado varias fuentes, como Angus Maddison.
<a href="https://www.gapminder.org/data/documentation/gd001/" class="uri">https://www.gapminder.org/data/documentation/gd001/</a></p></li>
<li><p>Inversiones (% del PIB)
La formación de capital es un término utilizado para describir la acumulación neta de capital durante un período contable para un país determinado. El término se refiere a las adiciones de bienes de capital, como equipos, herramientas, activos de transporte y electricidad. Los países necesitan bienes de capital para sustituir los más antiguos que se utilizan para producir bienes y servicios. Si un país no puede sustituir los bienes de capital cuando llegan al final de su vida útil, la producción disminuye. En general, cuanto mayor sea la formación de capital de una economía, más rápido podrá crecer su renta agregada.</p></li>
<li><p>Ingresos fiscales (% del PIB)
Se refiere a las transferencias obligatorias al gobierno central para fines públicos. No incluye la seguridad social.
<a href="https://data.worldbank.org/indicator/GC.TAX.TOTL.GD.ZS" class="uri">https://data.worldbank.org/indicator/GC.TAX.TOTL.GD.ZS</a></p></li>
</ol>
<div id="initial-analysis-of-the-datasets" class="section level5 hasAnchor" number="4.6.8.2.1">
<h5 class="hasAnchor"><span class="header-section-number">4.6.8.2.1</span> Initial Analysis of the Datasets<a href="#initial-analysis-of-the-datasets" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p><strong>Ingresos fiscales en porcentaje del PIB</strong></p>
<p>A continuación se presentan los resultados de un primer análisis:</p>
<p>Los archivos csv para este análisis se descargaron del sitio web de GapMinder. Pueden encontrarse aquí:</p>
<p><a href="https://github.com/psterk1/data_analytics/tree/master/intro/final_project" class="uri">https://github.com/psterk1/data_analytics/tree/master/intro/final_project</a></p>
<p>El primer archivo es ‘tax_revenue_percent_of_gdp.csv’</p>
<div class="sourceCode" id="cb750"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb750-1"><a href="#cb750-1" aria-hidden="true" tabindex="-1"></a>tax <span class="op">=</span> pd.read_csv(<span class="st">&quot;datos</span><span class="ch">\\</span><span class="st">tax_revenue_percent_of_gdp.csv&quot;</span>)</span>
<span id="cb750-2"><a href="#cb750-2" aria-hidden="true" tabindex="-1"></a>tax</span>
<span id="cb750-3"><a href="#cb750-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb750-4"><a href="#cb750-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;number of rows: &quot;</span>, tax.shape[<span class="dv">0</span>])</span>
<span id="cb750-5"><a href="#cb750-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;number of columns: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(tax.shape[<span class="dv">1</span>]))</span>
<span id="cb750-6"><a href="#cb750-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;number of duplicates: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(tax.duplicated().<span class="bu">sum</span>()))</span>
<span id="cb750-7"><a href="#cb750-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;datatypes:</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb750-8"><a href="#cb750-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tax.dtypes)</span>
<span id="cb750-9"><a href="#cb750-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Sample:&quot;</span>)</span>
<span id="cb750-10"><a href="#cb750-10" aria-hidden="true" tabindex="-1"></a>tax.head(<span class="dv">3</span>)</span></code></pre></div>
<p>Un primer análisis reveló que aproximadamente la mitad de los años con &gt; 0,50 valores perdidos. Véase más abajo:</p>
<p>Debido a los resultados que se presentan a continuación, los años con el menor porcentaje de valores nulos se encontraban en el rango de 10 años de 2006 a 2016. En consecuencia, se seleccionó este intervalo anual para el resto de los conjuntos de datos</p>
<div class="sourceCode" id="cb751"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb751-1"><a href="#cb751-1" aria-hidden="true" tabindex="-1"></a>tax_null <span class="op">=</span> tax.isnull().<span class="bu">sum</span>()<span class="op">/</span>tax.shape[<span class="dv">0</span>]</span>
<span id="cb751-2"><a href="#cb751-2" aria-hidden="true" tabindex="-1"></a>tax_null.to_frame().transpose()</span></code></pre></div>
<p><strong>Renta por persona - PIB per cápita</strong></p>
<p>A continuación se presentan los resultados de un primer análisis:</p>
<div class="sourceCode" id="cb752"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb752-1"><a href="#cb752-1" aria-hidden="true" tabindex="-1"></a>income <span class="op">=</span> pd.read_csv(<span class="st">&#39;datos</span><span class="ch">\\</span><span class="st">income_per_person_gdppercapita_ppp_inflation_adjusted.csv&#39;</span>)</span>
<span id="cb752-2"><a href="#cb752-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb752-3"><a href="#cb752-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;number of rows: &quot;</span>, income.shape[<span class="dv">0</span>])</span>
<span id="cb752-4"><a href="#cb752-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;number of columns: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(income.shape[<span class="dv">1</span>]))</span>
<span id="cb752-5"><a href="#cb752-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;number of duplicates: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(income.duplicated().<span class="bu">sum</span>()))</span>
<span id="cb752-6"><a href="#cb752-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;datatypes:</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb752-7"><a href="#cb752-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(income.dtypes)</span>
<span id="cb752-8"><a href="#cb752-8" aria-hidden="true" tabindex="-1"></a>income.head(<span class="dv">3</span>)</span></code></pre></div>
<p>Los resultados siguientes muestran que no hay nulos.</p>
<div class="sourceCode" id="cb753"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb753-1"><a href="#cb753-1" aria-hidden="true" tabindex="-1"></a>income_null <span class="op">=</span> income.isnull().<span class="bu">sum</span>()<span class="op">/</span>income.shape[<span class="dv">0</span>]</span>
<span id="cb753-2"><a href="#cb753-2" aria-hidden="true" tabindex="-1"></a>income_null.to_frame().transpose()</span></code></pre></div>
<p><strong>Inversión Porcentaje del PIB</strong></p>
<p>A continuación se presentan los resultados de un primer análisis:</p>
<div class="sourceCode" id="cb754"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb754-1"><a href="#cb754-1" aria-hidden="true" tabindex="-1"></a>invest <span class="op">=</span> pd.read_csv(<span class="st">&#39;datos</span><span class="ch">\\</span><span class="st">investments_percent_of_gdp.csv&#39;</span>)</span>
<span id="cb754-2"><a href="#cb754-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb754-3"><a href="#cb754-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;number of rows: &quot;</span>, invest.shape[<span class="dv">0</span>])</span>
<span id="cb754-4"><a href="#cb754-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;number of columns: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(invest.shape[<span class="dv">1</span>]))</span>
<span id="cb754-5"><a href="#cb754-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;number of duplicates: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(invest.duplicated().<span class="bu">sum</span>()))</span>
<span id="cb754-6"><a href="#cb754-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;datatypes:</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb754-7"><a href="#cb754-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(invest.dtypes)</span>
<span id="cb754-8"><a href="#cb754-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Sample:&quot;</span>)</span>
<span id="cb754-9"><a href="#cb754-9" aria-hidden="true" tabindex="-1"></a>invest.head(<span class="dv">3</span>)</span></code></pre></div>
<p>Los resultados que aparecen a continuación muestran que los años con el menor porcentaje de valores nulos se encontraban en el intervalo de 10 años comprendido entre 2006 y 2016. En consecuencia, se seleccionó este intervalo anual para el resto de los conjuntos de datos.</p>
<div class="sourceCode" id="cb755"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb755-1"><a href="#cb755-1" aria-hidden="true" tabindex="-1"></a>invest_null <span class="op">=</span> invest.isnull().<span class="bu">sum</span>()<span class="op">/</span>invest.shape[<span class="dv">0</span>]</span>
<span id="cb755-2"><a href="#cb755-2" aria-hidden="true" tabindex="-1"></a>invest_null.to_frame().transpose()</span></code></pre></div>
<p><strong>Índice de Democracia de la EIU</strong></p>
<p>A continuación se presentan los resultados del análisis inicial:</p>
<div class="sourceCode" id="cb756"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb756-1"><a href="#cb756-1" aria-hidden="true" tabindex="-1"></a>demo <span class="op">=</span> pd.read_csv(<span class="st">&#39;datos</span><span class="ch">\\</span><span class="st">demox_eiu.csv&#39;</span>)</span>
<span id="cb756-2"><a href="#cb756-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb756-3"><a href="#cb756-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;number of rows: &quot;</span>, demo.shape[<span class="dv">0</span>])</span>
<span id="cb756-4"><a href="#cb756-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;number of columns: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(demo.shape[<span class="dv">1</span>]))</span>
<span id="cb756-5"><a href="#cb756-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;number of duplicates: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(demo.duplicated().<span class="bu">sum</span>()))</span>
<span id="cb756-6"><a href="#cb756-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;datatypes:</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb756-7"><a href="#cb756-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(demo.dtypes)</span>
<span id="cb756-8"><a href="#cb756-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Sample:&quot;</span>)</span>
<span id="cb756-9"><a href="#cb756-9" aria-hidden="true" tabindex="-1"></a>demo.head(<span class="dv">3</span>)</span></code></pre></div>
<p>Los resultados que aparecen a continuación muestran que no hay nulos en el conjunto de datos.</p>
<div class="sourceCode" id="cb757"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb757-1"><a href="#cb757-1" aria-hidden="true" tabindex="-1"></a>demo_null <span class="op">=</span> demo.isnull().<span class="bu">sum</span>()<span class="op">/</span>demo.shape[<span class="dv">0</span>]</span>
<span id="cb757-2"><a href="#cb757-2" aria-hidden="true" tabindex="-1"></a>demo_null.to_frame().transpose()</span></code></pre></div>
<p><strong>Conjunto de datos de Gini</strong></p>
<p>A continuación se muestran los resultados del análisis inicial:</p>
<div class="sourceCode" id="cb758"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb758-1"><a href="#cb758-1" aria-hidden="true" tabindex="-1"></a>gini <span class="op">=</span> pd.read_csv(<span class="st">&#39;datos</span><span class="ch">\\</span><span class="st">gini.csv&#39;</span>)</span>
<span id="cb758-2"><a href="#cb758-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb758-3"><a href="#cb758-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;number of rows: &quot;</span>, gini.shape[<span class="dv">0</span>])</span>
<span id="cb758-4"><a href="#cb758-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;number of columns: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(gini.shape[<span class="dv">1</span>]))</span>
<span id="cb758-5"><a href="#cb758-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;number of duplicates: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(gini.duplicated().<span class="bu">sum</span>()))</span>
<span id="cb758-6"><a href="#cb758-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;datatypes:</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb758-7"><a href="#cb758-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(gini.dtypes)</span>
<span id="cb758-8"><a href="#cb758-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Sample:&quot;</span>)</span>
<span id="cb758-9"><a href="#cb758-9" aria-hidden="true" tabindex="-1"></a>gini.head(<span class="dv">3</span>)</span></code></pre></div>
<p>Los resultados que aparecen a continuación muestran que no hay nulos en el conjunto de datos.</p>
<div class="sourceCode" id="cb759"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb759-1"><a href="#cb759-1" aria-hidden="true" tabindex="-1"></a>gini_null <span class="op">=</span> gini.isnull().<span class="bu">sum</span>()<span class="op">/</span>gini.shape[<span class="dv">0</span>]</span>
<span id="cb759-2"><a href="#cb759-2" aria-hidden="true" tabindex="-1"></a>gini_null.to_frame().transpose()</span></code></pre></div>
</div>
<div id="conclusiones-y-próximos-pasos" class="section level5 hasAnchor" number="4.6.8.2.2">
<h5 class="hasAnchor"><span class="header-section-number">4.6.8.2.2</span> Conclusiones y próximos pasos<a href="#conclusiones-y-próximos-pasos" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>A continuación se exponen las conclusiones del análisis inicial:</p>
<ol style="list-style-type: decimal">
<li>Dado que el Índice de Democracia de la EIU solo tiene datos para los años 2006 - 2018, se seleccionará un rango de años similar para los otros conjuntos de datos.</li>
<li>El porcentaje de nulos en los ingresos fiscales como porcentaje del PIB fue menor entre los años 2006 y 2016. La mayoría de los valores fueron nulos para 2017. Como resultado de esto, más el resultado en 1. anterior, el período de años 2006 - 2016 será seleccionado para este conjunto de datos.</li>
</ol>
<p>Próximos pasos</p>
<ol style="list-style-type: decimal">
<li>Los conjuntos de datos anteriores tendrán la columna del país más los años 2006 - 2016.</li>
<li><ol start="2" style="list-style-type: decimal">
<li>Los conjuntos de datos serán pivotados para tener el continente, el país, el año y los conjuntos de datos anteriores. A continuación se muestra un ejemplo de cómo será el conjunto de datos combinado final:</li>
</ol></li>
</ol>
<table>
<colgroup>
<col width="11%" />
<col width="9%" />
<col width="5%" />
<col width="11%" />
<col width="22%" />
<col width="15%" />
<col width="11%" />
<col width="12%" />
</colgroup>
<thead>
<tr class="header">
<th>continent</th>
<th>country</th>
<th>year</th>
<th>demox_eiu</th>
<th>income_per_person</th>
<th>invest_%_gdp</th>
<th>tax_%_gdp</th>
<th>gini_index</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Asia</td>
<td>Afghanistan</td>
<td>2006</td>
<td>30.6</td>
<td>1120</td>
<td>23.40</td>
<td>6.88</td>
<td>36.8</td>
</tr>
<tr class="even">
<td>Asia</td>
<td>Afghanistan</td>
<td>2007</td>
<td>30.4</td>
<td>1250</td>
<td>19.90</td>
<td>5.23</td>
<td>36.8</td>
</tr>
<tr class="odd">
<td>Asia</td>
<td>Afghanistan</td>
<td>2008</td>
<td>30.2</td>
<td>1270</td>
<td>18.90</td>
<td>6.04</td>
<td>36.8</td>
</tr>
</tbody>
</table>
</div>
<div id="reorganizamos-los-datos" class="section level5 hasAnchor" number="4.6.8.2.3">
<h5 class="hasAnchor"><span class="header-section-number">4.6.8.2.3</span> Reorganizamos los datos<a href="#reorganizamos-los-datos" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>EIU Democracy Index</p>
<div class="sourceCode" id="cb760"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb760-1"><a href="#cb760-1" aria-hidden="true" tabindex="-1"></a>demo_last_10 <span class="op">=</span> demo.iloc[:, :<span class="op">-</span><span class="dv">2</span>]</span>
<span id="cb760-2"><a href="#cb760-2" aria-hidden="true" tabindex="-1"></a>demo_last_10.head(<span class="dv">3</span>)</span>
<span id="cb760-3"><a href="#cb760-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb760-4"><a href="#cb760-4" aria-hidden="true" tabindex="-1"></a>demo_last_10 <span class="op">=</span> demo_last_10.melt(id_vars<span class="op">=</span>[<span class="st">&#39;country&#39;</span>], var_name<span class="op">=</span><span class="st">&#39;year&#39;</span>, value_name<span class="op">=</span><span class="st">&#39;demox_eiu&#39;</span>)</span>
<span id="cb760-5"><a href="#cb760-5" aria-hidden="true" tabindex="-1"></a>demo_last_10.sort_values([<span class="st">&#39;country&#39;</span>,<span class="st">&#39;year&#39;</span>], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb760-6"><a href="#cb760-6" aria-hidden="true" tabindex="-1"></a>demo_last_10.head(<span class="dv">3</span>)</span></code></pre></div>
<p>Income Per Person (GDP per Capita)</p>
<div class="sourceCode" id="cb761"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb761-1"><a href="#cb761-1" aria-hidden="true" tabindex="-1"></a>income_last_10 <span class="op">=</span> income.iloc[:, np.r_[:<span class="dv">1</span>, <span class="dv">207</span>:<span class="dv">218</span>]]</span>
<span id="cb761-2"><a href="#cb761-2" aria-hidden="true" tabindex="-1"></a>income_last_10</span>
<span id="cb761-3"><a href="#cb761-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb761-4"><a href="#cb761-4" aria-hidden="true" tabindex="-1"></a>income_last_10 <span class="op">=</span> income_last_10.melt(id_vars<span class="op">=</span>[<span class="st">&#39;country&#39;</span>], var_name<span class="op">=</span><span class="st">&#39;year&#39;</span>, value_name<span class="op">=</span><span class="st">&#39;income_per_person&#39;</span>)</span>
<span id="cb761-5"><a href="#cb761-5" aria-hidden="true" tabindex="-1"></a>income_last_10.sort_values([<span class="st">&#39;country&#39;</span>, <span class="st">&#39;year&#39;</span>], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb761-6"><a href="#cb761-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb761-7"><a href="#cb761-7" aria-hidden="true" tabindex="-1"></a>income_last_10.head(<span class="dv">3</span>)</span></code></pre></div>
<p>Investment Percent of GDP</p>
<div class="sourceCode" id="cb762"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb762-1"><a href="#cb762-1" aria-hidden="true" tabindex="-1"></a>invest_last_10 <span class="op">=</span> invest.iloc[:, np.r_[:<span class="dv">1</span>, <span class="dv">47</span>:<span class="dv">58</span>]]</span>
<span id="cb762-2"><a href="#cb762-2" aria-hidden="true" tabindex="-1"></a>invest_last_10 <span class="op">=</span> invest_last_10.melt(id_vars<span class="op">=</span>[<span class="st">&#39;country&#39;</span>], var_name<span class="op">=</span><span class="st">&#39;year&#39;</span>, value_name<span class="op">=</span><span class="st">&#39;invest_%_gdp&#39;</span>)</span>
<span id="cb762-3"><a href="#cb762-3" aria-hidden="true" tabindex="-1"></a>invest_last_10.sort_values([<span class="st">&#39;country&#39;</span>, <span class="st">&#39;year&#39;</span>], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb762-4"><a href="#cb762-4" aria-hidden="true" tabindex="-1"></a>invest_last_10.head(<span class="dv">3</span>)</span></code></pre></div>
<p>Tax Revenue Percent of GDP</p>
<div class="sourceCode" id="cb763"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb763-1"><a href="#cb763-1" aria-hidden="true" tabindex="-1"></a>tax_last_10 <span class="op">=</span> tax.iloc[:, np.r_[:<span class="dv">1</span>, <span class="dv">35</span>:<span class="dv">46</span>]]</span>
<span id="cb763-2"><a href="#cb763-2" aria-hidden="true" tabindex="-1"></a>tax_last_10 <span class="op">=</span> tax_last_10.melt(id_vars<span class="op">=</span>[<span class="st">&#39;country&#39;</span>], var_name<span class="op">=</span><span class="st">&#39;year&#39;</span>, value_name<span class="op">=</span><span class="st">&#39;tax_%_gdp&#39;</span>)</span>
<span id="cb763-3"><a href="#cb763-3" aria-hidden="true" tabindex="-1"></a>tax_last_10.sort_values([<span class="st">&#39;country&#39;</span>, <span class="st">&#39;year&#39;</span>], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb763-4"><a href="#cb763-4" aria-hidden="true" tabindex="-1"></a>tax_last_10.head(<span class="dv">3</span>)</span></code></pre></div>
<p>Gini Index</p>
<div class="sourceCode" id="cb764"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb764-1"><a href="#cb764-1" aria-hidden="true" tabindex="-1"></a>gini_last_10 <span class="op">=</span> gini.iloc[:, np.r_[:<span class="dv">1</span>, <span class="dv">207</span>:<span class="dv">218</span>]]</span>
<span id="cb764-2"><a href="#cb764-2" aria-hidden="true" tabindex="-1"></a>gini_last_10 <span class="op">=</span> gini_last_10.melt(id_vars<span class="op">=</span>[<span class="st">&#39;country&#39;</span>], var_name<span class="op">=</span><span class="st">&#39;year&#39;</span>, value_name<span class="op">=</span><span class="st">&#39;gini_index&#39;</span>)</span>
<span id="cb764-3"><a href="#cb764-3" aria-hidden="true" tabindex="-1"></a>gini_last_10.sort_values(by<span class="op">=</span>[<span class="st">&#39;country&#39;</span>, <span class="st">&#39;year&#39;</span>], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb764-4"><a href="#cb764-4" aria-hidden="true" tabindex="-1"></a>gini_last_10.head(<span class="dv">3</span>)</span></code></pre></div>
<p>Juntamos las bases de datos</p>
<div class="sourceCode" id="cb765"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb765-1"><a href="#cb765-1" aria-hidden="true" tabindex="-1"></a>combined <span class="op">=</span> demo_last_10.merge(income_last_10, left_on<span class="op">=</span>[<span class="st">&#39;country&#39;</span>, <span class="st">&#39;year&#39;</span>], right_on<span class="op">=</span>[<span class="st">&#39;country&#39;</span>, <span class="st">&#39;year&#39;</span>])</span>
<span id="cb765-2"><a href="#cb765-2" aria-hidden="true" tabindex="-1"></a>combined <span class="op">=</span> combined.merge(invest_last_10, left_on<span class="op">=</span>[<span class="st">&#39;country&#39;</span>, <span class="st">&#39;year&#39;</span>], right_on<span class="op">=</span>[<span class="st">&#39;country&#39;</span>, <span class="st">&#39;year&#39;</span>])</span>
<span id="cb765-3"><a href="#cb765-3" aria-hidden="true" tabindex="-1"></a>combined <span class="op">=</span> combined.merge(tax_last_10, left_on<span class="op">=</span>[<span class="st">&#39;country&#39;</span>, <span class="st">&#39;year&#39;</span>], right_on<span class="op">=</span>[<span class="st">&#39;country&#39;</span>, <span class="st">&#39;year&#39;</span>])</span>
<span id="cb765-4"><a href="#cb765-4" aria-hidden="true" tabindex="-1"></a>combined <span class="op">=</span> combined.merge(gini_last_10, left_on<span class="op">=</span>[<span class="st">&#39;country&#39;</span>, <span class="st">&#39;year&#39;</span>], right_on<span class="op">=</span>[<span class="st">&#39;country&#39;</span>, <span class="st">&#39;year&#39;</span>])</span>
<span id="cb765-5"><a href="#cb765-5" aria-hidden="true" tabindex="-1"></a>combined</span>
<span id="cb765-6"><a href="#cb765-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb765-7"><a href="#cb765-7" aria-hidden="true" tabindex="-1"></a>cont <span class="op">=</span> pd.read_csv(<span class="st">&#39;datos</span><span class="ch">\\</span><span class="st">continent_country.csv&#39;</span>)</span>
<span id="cb765-8"><a href="#cb765-8" aria-hidden="true" tabindex="-1"></a>cont</span></code></pre></div>
<p>Juntamos continente con país. En este paso, emparejamos cada país con su continente. Esto permitirá el análisis a nivel de continente para la detección de tendencias más amplias.</p>
<div class="sourceCode" id="cb766"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb766-1"><a href="#cb766-1" aria-hidden="true" tabindex="-1"></a>combined_final <span class="op">=</span> cont.merge(combined, left_on<span class="op">=</span>[<span class="st">&#39;country&#39;</span>], right_on<span class="op">=</span>[<span class="st">&#39;country&#39;</span>])</span>
<span id="cb766-2"><a href="#cb766-2" aria-hidden="true" tabindex="-1"></a>combined_final</span></code></pre></div>
</div>
<div id="limpieza-de-datos" class="section level5 hasAnchor" number="4.6.8.2.4">
<h5 class="hasAnchor"><span class="header-section-number">4.6.8.2.4</span> Limpieza de datos<a href="#limpieza-de-datos" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>A continuación se detallan las medidas adoptadas para garantizar la calidad del conjunto de datos:</p>
<p>Missing Values: A continuación se muestra un resumen de los valores que faltan (nulos) en el conjunto de datos:</p>
<div class="sourceCode" id="cb767"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb767-1"><a href="#cb767-1" aria-hidden="true" tabindex="-1"></a>combined_final.isna().<span class="bu">sum</span>()</span></code></pre></div>
<p>Una opción para tratar los valores “tax_%_gdp” que faltan sería sustituirlos por la media del país. Sin embargo, algunos de los países tienen todos nulos y otros tienen la mayoría de nulos para esta columna.</p>
<p>Una segunda opción es eliminar las filas con nulos. En aras de la simplicidad, utilizaremos esta opción.</p>
<div class="sourceCode" id="cb768"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb768-1"><a href="#cb768-1" aria-hidden="true" tabindex="-1"></a>combined_final.dropna(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb768-2"><a href="#cb768-2" aria-hidden="true" tabindex="-1"></a>combined_final.isna().<span class="bu">sum</span>()</span></code></pre></div>
<p>Duplicates. No hay duplicados en el conjunto de datos:</p>
<div class="sourceCode" id="cb769"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb769-1"><a href="#cb769-1" aria-hidden="true" tabindex="-1"></a>combined_final.duplicated().<span class="bu">sum</span>()</span></code></pre></div>
</div>
<div id="estadísticas-descriptivas" class="section level5 hasAnchor" number="4.6.8.2.5">
<h5 class="hasAnchor"><span class="header-section-number">4.6.8.2.5</span> Estadísticas descriptivas<a href="#estadísticas-descriptivas" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>A continuación se presentan las estadísticas descriptivas del conjunto de datos. Un examen de los valores indica que los valores mínimo, máximo y medio parecen razonables.</p>
<div class="sourceCode" id="cb770"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb770-1"><a href="#cb770-1" aria-hidden="true" tabindex="-1"></a>combined_final.describe()</span></code></pre></div>
</div>
<div id="resumen-1" class="section level5 hasAnchor" number="4.6.8.2.6">
<h5 class="hasAnchor"><span class="header-section-number">4.6.8.2.6</span> Resumen<a href="#resumen-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Dado que los resultados del análisis inicial indican que el conjunto de datos está limpio, no es necesario realizar más pasos de limpieza.</p>
<div class="sourceCode" id="cb771"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb771-1"><a href="#cb771-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;number of rows: &quot;</span>, combined_final.shape[<span class="dv">0</span>])</span>
<span id="cb771-2"><a href="#cb771-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;number of columns: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(combined_final.shape[<span class="dv">1</span>]))</span>
<span id="cb771-3"><a href="#cb771-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;datatypes:</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb771-4"><a href="#cb771-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(combined_final.dtypes)</span>
<span id="cb771-5"><a href="#cb771-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb771-6"><a href="#cb771-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Estos son los continentes incluidos en el conjunto de datos. Todos los valores parecen razonables.</span></span>
<span id="cb771-7"><a href="#cb771-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb771-8"><a href="#cb771-8" aria-hidden="true" tabindex="-1"></a>combined_final.continent.unique()</span>
<span id="cb771-9"><a href="#cb771-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb771-10"><a href="#cb771-10" aria-hidden="true" tabindex="-1"></a>combined_final.country.unique()</span></code></pre></div>
</div>
<div id="guardar-el-conjunto-de-datos-limpiado" class="section level5 hasAnchor" number="4.6.8.2.7">
<h5 class="hasAnchor"><span class="header-section-number">4.6.8.2.7</span> Guardar el conjunto de datos limpiado<a href="#guardar-el-conjunto-de-datos-limpiado" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb772"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb772-1"><a href="#cb772-1" aria-hidden="true" tabindex="-1"></a>combined_final.to_csv(<span class="st">&#39;datos</span><span class="ch">\\</span><span class="st">combined_final_last_10_years.csv&#39;</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb772-2"><a href="#cb772-2" aria-hidden="true" tabindex="-1"></a>combined_final.to_excel(<span class="st">&#39;datos</span><span class="ch">\\</span><span class="st">combined_final_last_10_years.xlsx&#39;</span>, index<span class="op">=</span><span class="va">False</span>)</span></code></pre></div>
<p><a id='eda'></a></p>
</div>
</div>
<div id="análisis-exploratorio" class="section level4 hasAnchor" number="4.6.8.3">
<h4 class="hasAnchor"><span class="header-section-number">4.6.8.3</span> Análisis exploratorio<a href="#análisis-exploratorio" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>Pregunta de investigación 1 - ¿La desigualdad de ingresos está empeorando o mejorando en los últimos 10 años?</strong></p>
<p>Mejor significa que el índice de Gini está bajando.</p>
<p>Media global de Gini por año:</p>
<div class="sourceCode" id="cb773"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb773-1"><a href="#cb773-1" aria-hidden="true" tabindex="-1"></a>columns <span class="op">=</span> [<span class="st">&#39;year&#39;</span>, <span class="st">&#39;gini_index&#39;</span>]</span>
<span id="cb773-2"><a href="#cb773-2" aria-hidden="true" tabindex="-1"></a>gini <span class="op">=</span> combined_final[columns]</span>
<span id="cb773-3"><a href="#cb773-3" aria-hidden="true" tabindex="-1"></a>gini</span>
<span id="cb773-4"><a href="#cb773-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb773-5"><a href="#cb773-5" aria-hidden="true" tabindex="-1"></a>gini_annual_average <span class="op">=</span> gini.groupby(<span class="st">&#39;year&#39;</span>)[<span class="st">&#39;gini_index&#39;</span>].mean()</span>
<span id="cb773-6"><a href="#cb773-6" aria-hidden="true" tabindex="-1"></a>gini_annual_average</span></code></pre></div>
<p>As the plot below shows, the mean global gini index has been going down over the last 10 years, meaning global income inequality is improving.</p>
<div class="sourceCode" id="cb774"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb774-1"><a href="#cb774-1" aria-hidden="true" tabindex="-1"></a>plt.plot(gini_annual_average.index, gini_annual_average)</span>
<span id="cb774-2"><a href="#cb774-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Mean Global Gini Index by Year&#39;</span>)</span>
<span id="cb774-3"><a href="#cb774-3" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Year&#39;</span>)</span>
<span id="cb774-4"><a href="#cb774-4" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Mean Global Gini Index&#39;</span>)<span class="op">;</span></span></code></pre></div>
<p>Índice de Gini global medio por continente:</p>
<div class="sourceCode" id="cb775"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb775-1"><a href="#cb775-1" aria-hidden="true" tabindex="-1"></a>columns <span class="op">=</span> [<span class="st">&#39;year&#39;</span>, <span class="st">&#39;continent&#39;</span>, <span class="st">&#39;gini_index&#39;</span>]</span>
<span id="cb775-2"><a href="#cb775-2" aria-hidden="true" tabindex="-1"></a>gini <span class="op">=</span> combined_final[columns]</span>
<span id="cb775-3"><a href="#cb775-3" aria-hidden="true" tabindex="-1"></a>gini</span>
<span id="cb775-4"><a href="#cb775-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb775-5"><a href="#cb775-5" aria-hidden="true" tabindex="-1"></a>gini_cont_average <span class="op">=</span> gini.groupby([<span class="st">&#39;year&#39;</span>, <span class="st">&#39;continent&#39;</span>])[<span class="st">&#39;gini_index&#39;</span>].mean()</span>
<span id="cb775-6"><a href="#cb775-6" aria-hidden="true" tabindex="-1"></a>gini_cont_average</span></code></pre></div>
<p>El gráfico siguiente revela que, por continentes, todos disminuyeron o se mantuvieron prácticamente estables, excepto África.</p>
<div class="sourceCode" id="cb776"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb776-1"><a href="#cb776-1" aria-hidden="true" tabindex="-1"></a>gini_cont_average.unstack(level<span class="op">=</span><span class="dv">1</span>).plot(kind<span class="op">=</span><span class="st">&#39;line&#39;</span>, subplots<span class="op">=</span><span class="va">False</span>, <span class="op">\</span></span>
<span id="cb776-2"><a href="#cb776-2" aria-hidden="true" tabindex="-1"></a>                                        title<span class="op">=</span><span class="st">&#39;Mean Global Gini Index by Continent by Year&#39;</span>).<span class="op">\</span></span>
<span id="cb776-3"><a href="#cb776-3" aria-hidden="true" tabindex="-1"></a>                                        set_ylabel(<span class="st">&quot;Gini Index&quot;</span>)<span class="op">;</span></span>
<span id="cb776-4"><a href="#cb776-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb776-5"><a href="#cb776-5" aria-hidden="true" tabindex="-1"></a>columns <span class="op">=</span> [<span class="st">&#39;year&#39;</span>, <span class="st">&#39;continent&#39;</span>, <span class="st">&#39;country&#39;</span>, <span class="st">&#39;gini_index&#39;</span>]</span>
<span id="cb776-6"><a href="#cb776-6" aria-hidden="true" tabindex="-1"></a>gini <span class="op">=</span> combined_final[columns]</span>
<span id="cb776-7"><a href="#cb776-7" aria-hidden="true" tabindex="-1"></a>gini</span></code></pre></div>
<p><strong>Pregunta de investigación 2 - ¿Qué 10 países tienen la menor y la mayor desigualdad de ingresos?</strong></p>
<p>La más baja. En general, la mayoría de los países con menor desigualdad de ingresos se encuentran en Europa.</p>
<div class="sourceCode" id="cb777"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb777-1"><a href="#cb777-1" aria-hidden="true" tabindex="-1"></a>gini.groupby([<span class="st">&#39;country&#39;</span>, <span class="st">&#39;continent&#39;</span>])[<span class="st">&#39;gini_index&#39;</span>].mean().to_frame().sort_values(by<span class="op">=</span>[<span class="st">&#39;gini_index&#39;</span>]).head(<span class="dv">10</span>)</span></code></pre></div>
<p>Más alto: En general, la mayoría de los países con menor desigualdad de ingresos están en África y en América.</p>
<div class="sourceCode" id="cb778"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb778-1"><a href="#cb778-1" aria-hidden="true" tabindex="-1"></a>gini.groupby([<span class="st">&#39;country&#39;</span>, <span class="st">&#39;continent&#39;</span>])[<span class="st">&#39;gini_index&#39;</span>].mean().to_frame().sort_values(by<span class="op">=</span>[<span class="st">&#39;gini_index&#39;</span>], ascending<span class="op">=</span><span class="va">False</span>).head(<span class="dv">10</span>)</span></code></pre></div>
<p><strong>Pregunta de investigación 3 - ¿Se asocia una mayor recaudación fiscal como % del PIB con una menor desigualdad de ingresos?</strong></p>
<p>La hipótesis es que los países con mayores ingresos fiscales en % del PIB están asociados a una menor desigualdad de ingresos. La hipótesis es que los mayores ingresos fiscales se distribuyen a los estratos económicos más bajos en forma de prestaciones sociales. Veamos qué muestran los datos.</p>
<div class="sourceCode" id="cb779"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb779-1"><a href="#cb779-1" aria-hidden="true" tabindex="-1"></a>columns <span class="op">=</span> [<span class="st">&#39;continent&#39;</span>, <span class="st">&#39;country&#39;</span>, <span class="st">&#39;year&#39;</span>, <span class="st">&#39;tax_%_gdp&#39;</span>, <span class="st">&#39;gini_index&#39;</span>]</span>
<span id="cb779-2"><a href="#cb779-2" aria-hidden="true" tabindex="-1"></a>tax <span class="op">=</span> combined_final[columns]</span>
<span id="cb779-3"><a href="#cb779-3" aria-hidden="true" tabindex="-1"></a>tax</span></code></pre></div>
<p>Es difícil ver una tendencia en el gráfico de dispersión de abajo:</p>
<div class="sourceCode" id="cb780"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb780-1"><a href="#cb780-1" aria-hidden="true" tabindex="-1"></a>tax.plot(x<span class="op">=</span><span class="st">&#39;tax_%_gdp&#39;</span>, y<span class="op">=</span><span class="st">&#39;gini_index&#39;</span>, kind<span class="op">=</span><span class="st">&#39;scatter&#39;</span>, title<span class="op">=</span><span class="st">&#39;Mean Global Gini Index by Tax </span><span class="sc">% o</span><span class="st">f GDP&#39;</span>)<span class="op">;</span></span></code></pre></div>
<p>Si se observa el logaritmo de ambos valores, se observa que la correlación entre las dos variables es esencialmente plana: no hay pruebas convincentes de que un mayor porcentaje de impuestos sobre el PIB conduzca a una menor desigualdad de ingresos.</p>
<div class="sourceCode" id="cb781"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb781-1"><a href="#cb781-1" aria-hidden="true" tabindex="-1"></a>tax_plot <span class="op">=</span> tax.plot(x<span class="op">=</span><span class="st">&#39;tax_%_gdp&#39;</span>, y<span class="op">=</span><span class="st">&#39;gini_index&#39;</span>, kind<span class="op">=</span><span class="st">&#39;scatter&#39;</span>, loglog<span class="op">=</span><span class="va">True</span>, <span class="op">\</span></span>
<span id="cb781-2"><a href="#cb781-2" aria-hidden="true" tabindex="-1"></a>                    title<span class="op">=</span><span class="st">&#39;log Mean Global Gini Index by log Tax </span><span class="sc">% o</span><span class="st">f GDP&#39;</span>)</span>
<span id="cb781-3"><a href="#cb781-3" aria-hidden="true" tabindex="-1"></a>tax_plot.set_xlabel(<span class="st">&#39;log(tax </span><span class="sc">% g</span><span class="st">dp)&#39;</span>)</span>
<span id="cb781-4"><a href="#cb781-4" aria-hidden="true" tabindex="-1"></a>tax_plot.set_ylabel(<span class="st">&#39;log(gini index)&#39;</span>)<span class="op">;</span></span></code></pre></div>
<p>La correlación de Pearson es ligeramente negativa: -0,08:</p>
<div class="sourceCode" id="cb782"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb782-1"><a href="#cb782-1" aria-hidden="true" tabindex="-1"></a>tax_log <span class="op">=</span> np.log(tax[<span class="st">&#39;tax_%_gdp&#39;</span>]).to_frame()</span>
<span id="cb782-2"><a href="#cb782-2" aria-hidden="true" tabindex="-1"></a>tax_log[<span class="st">&#39;log_gini_index&#39;</span>] <span class="op">=</span> np.log(tax[<span class="st">&#39;gini_index&#39;</span>])</span>
<span id="cb782-3"><a href="#cb782-3" aria-hidden="true" tabindex="-1"></a>tax_log.corr()</span></code></pre></div>
<p><strong>Pregunta de investigación 4 - ¿Se asocia una mayor renta por persona -PIB per cápita- con una menor desigualdad de ingresos?</strong></p>
<p>La hipótesis es que una mayor renta por persona indica que una mayor parte del PIB del país se distribuye de forma equitativa entre su población.</p>
<div class="sourceCode" id="cb783"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb783-1"><a href="#cb783-1" aria-hidden="true" tabindex="-1"></a>columns <span class="op">=</span> [<span class="st">&#39;continent&#39;</span>, <span class="st">&#39;country&#39;</span>, <span class="st">&#39;year&#39;</span>, <span class="st">&#39;income_per_person&#39;</span>, <span class="st">&#39;gini_index&#39;</span>]</span>
<span id="cb783-2"><a href="#cb783-2" aria-hidden="true" tabindex="-1"></a>income <span class="op">=</span> combined_final[columns]</span>
<span id="cb783-3"><a href="#cb783-3" aria-hidden="true" tabindex="-1"></a>income</span>
<span id="cb783-4"><a href="#cb783-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb783-5"><a href="#cb783-5" aria-hidden="true" tabindex="-1"></a>income.plot(x<span class="op">=</span><span class="st">&#39;income_per_person&#39;</span>, y<span class="op">=</span><span class="st">&#39;gini_index&#39;</span>, kind<span class="op">=</span><span class="st">&#39;scatter&#39;</span>, title<span class="op">=</span><span class="st">&#39;Mean Gini Index by Income Per Person&#39;</span>)<span class="op">;</span></span>
<span id="cb783-6"><a href="#cb783-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb783-7"><a href="#cb783-7" aria-hidden="true" tabindex="-1"></a>income_plot <span class="op">=</span> income.plot(x<span class="op">=</span><span class="st">&#39;income_per_person&#39;</span>, y<span class="op">=</span><span class="st">&#39;gini_index&#39;</span>, kind<span class="op">=</span><span class="st">&#39;scatter&#39;</span>, loglog<span class="op">=</span><span class="va">True</span>, <span class="op">\</span></span>
<span id="cb783-8"><a href="#cb783-8" aria-hidden="true" tabindex="-1"></a>                    title<span class="op">=</span><span class="st">&#39;log Mean Gini Index by Income Per Person&#39;</span>)</span>
<span id="cb783-9"><a href="#cb783-9" aria-hidden="true" tabindex="-1"></a>income_plot.set_xlabel(<span class="st">&#39;log(income_per_person)&#39;</span>)</span>
<span id="cb783-10"><a href="#cb783-10" aria-hidden="true" tabindex="-1"></a>income_plot.set_ylabel(<span class="st">&#39;log(gini index)&#39;</span>)<span class="op">;</span></span></code></pre></div>
<p>En este caso, el coeficiente de correlación de Persona es -0,34, lo que indica que existe una débil correlación entre log(renta_por_persona) y log(índice_gini):</p>
<div class="sourceCode" id="cb784"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb784-1"><a href="#cb784-1" aria-hidden="true" tabindex="-1"></a>income_log <span class="op">=</span> np.log(income[<span class="st">&#39;income_per_person&#39;</span>]).to_frame()</span>
<span id="cb784-2"><a href="#cb784-2" aria-hidden="true" tabindex="-1"></a>income_log[<span class="st">&#39;log_gini_index&#39;</span>] <span class="op">=</span> np.log(tax[<span class="st">&#39;gini_index&#39;</span>])</span>
<span id="cb784-3"><a href="#cb784-3" aria-hidden="true" tabindex="-1"></a>income_log.corr()</span></code></pre></div>
<p><strong>Pregunta de investigación 5 - ¿Se asocia una mayor inversión como porcentaje del PIB con una menor desigualdad de ingresos?</strong></p>
<p>La hipótesis es que una mayor inversión como porcentaje del PIB indica que una mayor parte del PIB del país se invierte en mejoras de capital, lo que distribuye los beneficios de los ingresos entre un amplio segmento de la población, lo que conduce a una mayor igualdad entre su población.</p>
<div class="sourceCode" id="cb785"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb785-1"><a href="#cb785-1" aria-hidden="true" tabindex="-1"></a>columns <span class="op">=</span> [<span class="st">&#39;continent&#39;</span>, <span class="st">&#39;country&#39;</span>, <span class="st">&#39;year&#39;</span>, <span class="st">&#39;invest_%_gdp&#39;</span>, <span class="st">&#39;gini_index&#39;</span>]</span>
<span id="cb785-2"><a href="#cb785-2" aria-hidden="true" tabindex="-1"></a>invest <span class="op">=</span> combined_final[columns]</span>
<span id="cb785-3"><a href="#cb785-3" aria-hidden="true" tabindex="-1"></a>invest</span>
<span id="cb785-4"><a href="#cb785-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb785-5"><a href="#cb785-5" aria-hidden="true" tabindex="-1"></a>invest <span class="op">=</span> invest[invest[<span class="st">&#39;invest_%_gdp&#39;</span>] <span class="op">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb785-6"><a href="#cb785-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb785-7"><a href="#cb785-7" aria-hidden="true" tabindex="-1"></a>invest.plot(x<span class="op">=</span><span class="st">&#39;invest_%_gdp&#39;</span>, y<span class="op">=</span><span class="st">&#39;gini_index&#39;</span>, kind<span class="op">=</span><span class="st">&#39;scatter&#39;</span>, title<span class="op">=</span><span class="st">&#39;Mean Gini Index by Investment </span><span class="sc">% G</span><span class="st">DP&#39;</span>)<span class="op">;</span></span>
<span id="cb785-8"><a href="#cb785-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb785-9"><a href="#cb785-9" aria-hidden="true" tabindex="-1"></a>invest_plot <span class="op">=</span> invest.plot(x<span class="op">=</span><span class="st">&#39;invest_%_gdp&#39;</span>, y<span class="op">=</span><span class="st">&#39;gini_index&#39;</span>, kind<span class="op">=</span><span class="st">&#39;scatter&#39;</span>, loglog<span class="op">=</span><span class="va">True</span>, <span class="op">\</span></span>
<span id="cb785-10"><a href="#cb785-10" aria-hidden="true" tabindex="-1"></a>                    title<span class="op">=</span><span class="st">&#39;log Mean Global Gini Index by log Invest </span><span class="sc">% o</span><span class="st">f GDP&#39;</span>)</span>
<span id="cb785-11"><a href="#cb785-11" aria-hidden="true" tabindex="-1"></a>invest_plot.set_xlabel(<span class="st">&#39;log(invest </span><span class="sc">% g</span><span class="st">dp)&#39;</span>)</span>
<span id="cb785-12"><a href="#cb785-12" aria-hidden="true" tabindex="-1"></a>invest_plot.set_ylabel(<span class="st">&#39;log(gini index)&#39;</span>)<span class="op">;</span></span></code></pre></div>
<p>El coeficiente de Pearson de -0,03 indica que no hay correlación entre estas dos variables.</p>
<div class="sourceCode" id="cb786"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb786-1"><a href="#cb786-1" aria-hidden="true" tabindex="-1"></a>invest_log <span class="op">=</span> np.log(invest[<span class="st">&#39;invest_%_gdp&#39;</span>]).to_frame()</span>
<span id="cb786-2"><a href="#cb786-2" aria-hidden="true" tabindex="-1"></a>invest_log[<span class="st">&#39;log_gini_index&#39;</span>] <span class="op">=</span> np.log(tax[<span class="st">&#39;gini_index&#39;</span>])</span>
<span id="cb786-3"><a href="#cb786-3" aria-hidden="true" tabindex="-1"></a>invest_log.corr()</span></code></pre></div>
<p><strong>Pregunta de investigación 6 - ¿Un mayor Índice de Democracia de la EIU está asociado a una menor desigualdad de ingresos?</strong></p>
<p>La hipótesis es que los países con un mayor Índice de Democracia de la EIU atienden las necesidades de un segmento más amplio de la población, lo que conduce a una menor desigualdad de ingresos.</p>
<div class="sourceCode" id="cb787"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb787-1"><a href="#cb787-1" aria-hidden="true" tabindex="-1"></a>columns <span class="op">=</span> [<span class="st">&#39;continent&#39;</span>, <span class="st">&#39;country&#39;</span>, <span class="st">&#39;year&#39;</span>, <span class="st">&#39;demox_eiu&#39;</span>, <span class="st">&#39;gini_index&#39;</span>]</span>
<span id="cb787-2"><a href="#cb787-2" aria-hidden="true" tabindex="-1"></a>demo <span class="op">=</span> combined_final[columns]</span>
<span id="cb787-3"><a href="#cb787-3" aria-hidden="true" tabindex="-1"></a>demo</span>
<span id="cb787-4"><a href="#cb787-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb787-5"><a href="#cb787-5" aria-hidden="true" tabindex="-1"></a>demo.plot(x<span class="op">=</span><span class="st">&#39;demox_eiu&#39;</span>, y<span class="op">=</span><span class="st">&#39;gini_index&#39;</span>, kind<span class="op">=</span><span class="st">&#39;scatter&#39;</span>, title<span class="op">=</span><span class="st">&#39;Mean Gini Index by EIU Democracy Index&#39;</span>)<span class="op">;</span></span>
<span id="cb787-6"><a href="#cb787-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb787-7"><a href="#cb787-7" aria-hidden="true" tabindex="-1"></a>demo_plot <span class="op">=</span> demo.plot(x<span class="op">=</span><span class="st">&#39;demox_eiu&#39;</span>, y<span class="op">=</span><span class="st">&#39;gini_index&#39;</span>, kind<span class="op">=</span><span class="st">&#39;scatter&#39;</span>, loglog<span class="op">=</span><span class="va">True</span>, <span class="op">\</span></span>
<span id="cb787-8"><a href="#cb787-8" aria-hidden="true" tabindex="-1"></a>                    title<span class="op">=</span><span class="st">&#39;log Mean Global Gini Index by log EIU Democracy Index&#39;</span>)</span>
<span id="cb787-9"><a href="#cb787-9" aria-hidden="true" tabindex="-1"></a>demo_plot.set_xlabel(<span class="st">&#39;log(demox_eiu)&#39;</span>)</span>
<span id="cb787-10"><a href="#cb787-10" aria-hidden="true" tabindex="-1"></a>demo_plot.set_ylabel(<span class="st">&#39;log(gini index)&#39;</span>)<span class="op">;</span></span></code></pre></div>
<p>En este caso, el coeficiente de correlación de Person es -0,2, lo que indica que existe una débil correlación entre log(demox_eiu) y log(gini_index):</p>
<div class="sourceCode" id="cb788"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb788-1"><a href="#cb788-1" aria-hidden="true" tabindex="-1"></a>demo_log <span class="op">=</span> np.log(demo[<span class="st">&#39;demox_eiu&#39;</span>]).to_frame()</span>
<span id="cb788-2"><a href="#cb788-2" aria-hidden="true" tabindex="-1"></a>demo_log[<span class="st">&#39;log_gini_index&#39;</span>] <span class="op">=</span> np.log(tax[<span class="st">&#39;gini_index&#39;</span>])</span>
<span id="cb788-3"><a href="#cb788-3" aria-hidden="true" tabindex="-1"></a>demo_log.corr()</span></code></pre></div>
<p><a id='conclusions'></a></p>
</div>
<div id="conclusiones" class="section level4 hasAnchor" number="4.6.8.4">
<h4 class="hasAnchor"><span class="header-section-number">4.6.8.4</span> Conclusiones<a href="#conclusiones" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Las conclusiones de este análisis son las siguientes:</p>
<p><strong>Pregunta de investigación 1:</strong> ¿Ha empeorado o mejorado la desigualdad de ingresos en los últimos 10 años?</p>
<p>Respuesta:</p>
<p>Sí, está mejorando, pasando del 38,7 al 37,3</p>
<p>En cuanto a los continentes, todos han disminuido o se han mantenido estables, excepto África.</p>
<p><strong>Pregunta de investigación 2:</strong> ¿Qué 10 países tienen la menor y la mayor desigualdad de ingresos?</p>
<p>Respuesta:</p>
<p>La más baja: Eslovenia, Ucrania, República Checa, Noruega, República Eslovaca, Dinamarca, Kazajstán, Finlandia, Bielorrusia, República Kirguisa</p>
<p>La más alta: Colombia, Lesoto, Honduras, Bolivia, República Centroafricana, Zambia, Surinam, Namibia, Botsuana, Sudáfrica</p>
<p><strong>Pregunta de investigación 3:</strong> ¿Se asocia una mayor recaudación fiscal como porcentaje del PIB con una menor desigualdad de ingresos?</p>
<p>Respuesta: No</p>
<p><strong>Pregunta de investigación 4:</strong> - ¿Se asocia una mayor renta por persona - PIB per cápita con una menor desigualdad de ingresos?</p>
<p>Respuesta: No, pero sí una débil correlación negativa.</p>
<p>*<strong>Pregunta de investigación 5:</strong> - ¿Se asocia una mayor inversión como porcentaje del PIB con una menor desigualdad de ingresos?</p>
<p>Respuesta: No</p>
<p>*<strong>Pregunta de investigación 6:</strong> - ¿Se asocia un mayor índice de democracia de la EIU con una menor desigualdad de ingresos?</p>
<p>Respuesta: No, pero sí una débil correlación negativa.</p>
<p>Los resultados anteriores sugieren que hay otros factores que impulsan la reducción general de la desigualdad de ingresos. Deberían realizarse más análisis de los factores adicionales.</p>
<ul>
<li>Firm Level Innovation and CEO Compensation
<ul>
<li>Utilizando los datos de panel sobre las patentes de Estados Unidos de 1992 a 2006 y los datos sobre el valor de las opciones sobre acciones concedidas a los directores ejecutivos (CEO) de las empresas estadounidenses emparejadas, este estudio tiene como objetivo investigar la relación entre el valor de las opciones sobre acciones concedidas a los CEO y la actividad de innovación a nivel de empresa, medida por el número de patentes concedidas cada año.</li>
<li>Este estudio tiene como objetivo proporcionar evidencia empírica para la teoría de Manso(2011), que predice que el esquema de incentivos óptimos presenta una tolerancia sustancial al fracaso temprano la recompensa por el éxito a largo plazo y el compromiso con un plan de compensación a largo plazo para directores generales por parte del consejo de administración</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb789"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb789-1"><a href="#cb789-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Commented out IPython magic to ensure Python compatibility.</span></span>
<span id="cb789-2"><a href="#cb789-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb789-3"><a href="#cb789-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb789-4"><a href="#cb789-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb789-5"><a href="#cb789-5" aria-hidden="true" tabindex="-1"></a><span class="co">#import qeds</span></span>
<span id="cb789-6"><a href="#cb789-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb789-7"><a href="#cb789-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="cb789-8"><a href="#cb789-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb789-9"><a href="#cb789-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb789-10"><a href="#cb789-10" aria-hidden="true" tabindex="-1"></a><span class="co"># %matplotlib inline</span></span></code></pre></div>
<p>Data Cleaning: Los datos primarios de este estudio proceden de la <a href="https://sites.google.com/site/patentdataproject/Home/downloads">base de datos de patentes de la Oficina Nacional de Investigación Económica (NBER)</a> y de la base de datos de compensación de ejecutivos de Wharton Research Data Service (WRDS) Compustat.</p>
<p>Datos de la patente: Los datos de patentes <code>patsic06_mar09_ip.csv</code> contienen información sobre el año de solicitud y de concesión, la clase de patente estadounidense, junto con todos los IPC originales de la patente, el número de cesionario original y todos los números pdpass que resultan de la división de patentes de propiedad conjunta, la estandarización de nombres, etc.</p>
<div class="sourceCode" id="cb790"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb790-1"><a href="#cb790-1" aria-hidden="true" tabindex="-1"></a>datos</span>
<span id="cb790-2"><a href="#cb790-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb790-3"><a href="#cb790-3" aria-hidden="true" tabindex="-1"></a>pats <span class="op">=</span> pd.read_stata(<span class="st">&quot;datos</span><span class="ch">\\</span><span class="st">pat76_06_ipc.dta&quot;</span>)</span>
<span id="cb790-4"><a href="#cb790-4" aria-hidden="true" tabindex="-1"></a>pats.head()</span></code></pre></div>
<p>Descripción de la variable</p>
<ul>
<li>Datos de patentes</li>
</ul>
<p><code>appyear</code> registra el año de presentación y solicitud de la patente; <code>gyear</code> es el año de concesión de la patente. Cada patente concedida tiene un número de patente único como <code>patent</code>. Los datos <code>cat</code>, <code>icl_class</code>, <code>icl_maingroup</code>, <code>nclass</code>, <code>subcat</code>, <code>subclass</code> son la clase de patente o la clase de tecnología de cada patente, que son menos relevantes en mi estudio</p>
<ul>
<li>Identificador del cesionario. El <code>assignee</code> es el número que se asigna a una empresa al solicitar o conceder una patente, creado originalmente por la Oficina de Patentes de los Estados Unidos (U.S.P.O). El <code>pdpass</code> es también un número único de cesionario y se utiliza para cotejar los datos con los de Compustat. Un <code>pdpass</code> puede ser asignado por varios números de <code>asignatario</code>.</li>
</ul>
<p>Tratamiento del cesionario no emparejado</p>
<ul>
<li>Hay patentes que no coinciden con el cesionario mediante el algoritmo de coincidencia de nombres desarrollado por la base de datos de patentes NBER, estas observaciones se muestran como <code>cesionario = 0</code> o <code>pdpass = NaN</code>. Estas observaciones se eliminan automáticamente
““”</li>
</ul>
<div class="sourceCode" id="cb791"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb791-1"><a href="#cb791-1" aria-hidden="true" tabindex="-1"></a><span class="co"># observations with pdpass not missing </span></span>
<span id="cb791-2"><a href="#cb791-2" aria-hidden="true" tabindex="-1"></a>pats <span class="op">=</span> pats[pats[<span class="st">&#39;pdpass&#39;</span>].notnull()]</span>
<span id="cb791-3"><a href="#cb791-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb791-4"><a href="#cb791-4" aria-hidden="true" tabindex="-1"></a><span class="co"># count number of unique patent numbers to have patent count for a assignee in a year</span></span>
<span id="cb791-5"><a href="#cb791-5" aria-hidden="true" tabindex="-1"></a>pat_yc1 <span class="op">=</span> pats.groupby([<span class="st">&quot;pdpass&quot;</span>,<span class="st">&quot;gyear&quot;</span>])[<span class="st">&quot;patent&quot;</span>].nunique().to_frame().reset_index()<span class="op">\</span></span>
<span id="cb791-6"><a href="#cb791-6" aria-hidden="true" tabindex="-1"></a>.rename(columns<span class="op">=</span>{<span class="st">&quot;patent&quot;</span>:<span class="st">&quot;patent_count&quot;</span>})</span>
<span id="cb791-7"><a href="#cb791-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb791-8"><a href="#cb791-8" aria-hidden="true" tabindex="-1"></a>pat_yc1.head()</span>
<span id="cb791-9"><a href="#cb791-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb791-10"><a href="#cb791-10" aria-hidden="true" tabindex="-1"></a>pat_yc1.info()</span></code></pre></div>
<p>Añadir <code>gvkey</code></p>
<ul>
<li><p>La <code>gvkey</code> es el identificador de empresas del Wharton Rearch Data Service (WRDS)</p></li>
<li><p>El archivo <code>dynasscsv.csv</code> mantiene un registro de todos los cambios dinámicos en la propiedad de las patentes. Los cambios en la titularidad de las patentes pueden deberse a la fusión y adquisición de empresas, o a la venta de patentes. En este estudio, sólo me centro en el cesionario original (como <code>pdpco1</code> y <code>gvkey1</code>) de la patente y no tengo en cuenta ningún cambio dinámico en la propiedad de la patente. Esto se debe a que estoy más interesado en la relación entre la patente y la compensación a través de la decisión de los ejecutivos sobre el propio proyecto de investigación de la empresa y el proceso de exploración de nuevas ideas, no a través de la compra de patentes o la adquisición de patentes de otras empresas, ya que la compra de patentes es una decisión con recompensas conocidas</p></li>
</ul>
<div class="sourceCode" id="cb792"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb792-1"><a href="#cb792-1" aria-hidden="true" tabindex="-1"></a>dynass <span class="op">=</span> pd.read_stata(<span class="st">&quot;datos</span><span class="ch">\\</span><span class="st">dynass.dta&quot;</span>)</span>
<span id="cb792-2"><a href="#cb792-2" aria-hidden="true" tabindex="-1"></a>dynass <span class="op">=</span> dynass[[<span class="st">&quot;pdpass&quot;</span>,<span class="st">&quot;pdpco1&quot;</span>,<span class="st">&quot;gvkey1&quot;</span>]] </span>
<span id="cb792-3"><a href="#cb792-3" aria-hidden="true" tabindex="-1"></a>dynass <span class="op">=</span> dynass.rename(columns <span class="op">=</span> {<span class="st">&quot;pdpco1&quot;</span>:<span class="st">&quot;pdpco&quot;</span>, <span class="st">&quot;gvkey1&quot;</span>:<span class="st">&quot;gvkey&quot;</span>})</span>
<span id="cb792-4"><a href="#cb792-4" aria-hidden="true" tabindex="-1"></a>dynass <span class="op">=</span> dynass.astype({<span class="st">&quot;pdpass&quot;</span>: <span class="bu">float</span>})</span>
<span id="cb792-5"><a href="#cb792-5" aria-hidden="true" tabindex="-1"></a>dynass.head()</span></code></pre></div>
<p>En muchos casos, <code>pdpass</code> es igual a <code>gvkey</code> para una empresa. Mi objetivo es que la “clave de acceso” sea el identificador único de las empresas, por lo que elimino cualquier “paso de acceso” que no coincida con una “clave de acceso” y realizo la fusión interna. Además, nos gustaría investigar cualquier cambio en el recuento de patentes después de que los ejecutivos hayan concedido alguna opción de compra de acciones; dado que el rango de datos para la opción de compra de acciones de los ejecutivos es de 1992 a 2006, sólo nos centraríamos en el subconjunto del recuento de patentes que es posterior a 1992</p>
<div class="sourceCode" id="cb793"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb793-1"><a href="#cb793-1" aria-hidden="true" tabindex="-1"></a>pgvkey <span class="op">=</span> pd.merge(pat_yc1, dynass, on<span class="op">=</span><span class="st">&quot;pdpass&quot;</span>,how<span class="op">=</span><span class="st">&quot;inner&quot;</span>)</span>
<span id="cb793-2"><a href="#cb793-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb793-3"><a href="#cb793-3" aria-hidden="true" tabindex="-1"></a><span class="co"># align with executive compensation data (1992 onwards)</span></span>
<span id="cb793-4"><a href="#cb793-4" aria-hidden="true" tabindex="-1"></a>pgvkey1 <span class="op">=</span> pgvkey.loc[pgvkey[<span class="st">&quot;gyear&quot;</span>]<span class="op">&gt;=</span><span class="dv">1992</span>]</span>
<span id="cb793-5"><a href="#cb793-5" aria-hidden="true" tabindex="-1"></a>pgvkey1.head()</span></code></pre></div>
<p>Tratamiento del recuento de patentes del año que falta</p>
<ul>
<li>Para cada empresa (identificada por gvkey), la razón del valor que falta en el recuento de patentes puede ser 1) que haya patentes concedidas en ese año, pero que no coincidan con el pdpass y, por tanto, no con la empresa en la base de datos de patentes del NBER; 2) que simplemente no haya ninguna patente concedida en ese año. En consecuencia, la regla general para tratar el valor faltante del recuento de patentes cada año es simplemente sustituirlo por 0 en este estudio</li>
</ul>
<div class="sourceCode" id="cb794"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb794-1"><a href="#cb794-1" aria-hidden="true" tabindex="-1"></a>pgvkey2 <span class="op">=</span> pgvkey1[[<span class="st">&quot;gvkey&quot;</span>,<span class="st">&quot;gyear&quot;</span>,<span class="st">&quot;patent_count&quot;</span>]]</span>
<span id="cb794-2"><a href="#cb794-2" aria-hidden="true" tabindex="-1"></a>pgvkey3 <span class="op">=</span> pgvkey2.pivot_table(index<span class="op">=</span><span class="st">&quot;gvkey&quot;</span>, columns <span class="op">=</span><span class="st">&quot;gyear&quot;</span>, values<span class="op">=</span><span class="st">&quot;patent_count&quot;</span>,</span>
<span id="cb794-3"><a href="#cb794-3" aria-hidden="true" tabindex="-1"></a>                             aggfunc<span class="op">=</span> <span class="st">&quot;sum&quot;</span>)</span>
<span id="cb794-4"><a href="#cb794-4" aria-hidden="true" tabindex="-1"></a>pgvkey3.head()</span>
<span id="cb794-5"><a href="#cb794-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb794-6"><a href="#cb794-6" aria-hidden="true" tabindex="-1"></a>pgvkey3 <span class="op">=</span> pgvkey3.stack(<span class="st">&quot;gyear&quot;</span>,dropna<span class="op">=</span><span class="va">False</span>).to_frame().reset_index()<span class="op">\</span></span>
<span id="cb794-7"><a href="#cb794-7" aria-hidden="true" tabindex="-1"></a>    .rename(columns<span class="op">=</span>{<span class="dv">0</span>: <span class="st">&#39;patent_count&#39;</span>})</span>
<span id="cb794-8"><a href="#cb794-8" aria-hidden="true" tabindex="-1"></a>pgvkey3.head()</span>
<span id="cb794-9"><a href="#cb794-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb794-10"><a href="#cb794-10" aria-hidden="true" tabindex="-1"></a>pgvkey3[<span class="st">&quot;patent_count&quot;</span>] <span class="op">=</span> pgvkey3[<span class="st">&quot;patent_count&quot;</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb794-11"><a href="#cb794-11" aria-hidden="true" tabindex="-1"></a>pgvkey3.head()</span>
<span id="cb794-12"><a href="#cb794-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb794-13"><a href="#cb794-13" aria-hidden="true" tabindex="-1"></a>pgvkey3.info()</span>
<span id="cb794-14"><a href="#cb794-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb794-15"><a href="#cb794-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np </span>
<span id="cb794-16"><a href="#cb794-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb794-17"><a href="#cb794-17" aria-hidden="true" tabindex="-1"></a><span class="co">#import geopandas as gpd</span></span>
<span id="cb794-18"><a href="#cb794-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb794-19"><a href="#cb794-19" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb794-20"><a href="#cb794-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> pearsonr</span>
<span id="cb794-21"><a href="#cb794-21" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> LeaveOneOut</span>
<span id="cb794-22"><a href="#cb794-22" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb794-23"><a href="#cb794-23" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sklearn.metrics <span class="im">as</span> sklm</span>
<span id="cb794-24"><a href="#cb794-24" aria-hidden="true" tabindex="-1"></a>pd.options.mode.chained_assignment <span class="op">=</span> <span class="va">None</span></span>
<span id="cb794-25"><a href="#cb794-25" aria-hidden="true" tabindex="-1"></a>pd.options.display.float_format <span class="op">=</span> <span class="st">&#39;</span><span class="sc">{:.4f}</span><span class="st">&#39;</span>.<span class="bu">format</span></span>
<span id="cb794-26"><a href="#cb794-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb794-27"><a href="#cb794-27" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_csv(<span class="st">&#39;datos</span><span class="ch">\\</span><span class="st">final_demographics_data.csv&#39;</span>)</span></code></pre></div>
<p>Preprocessing</p>
<div class="sourceCode" id="cb795"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb795-1"><a href="#cb795-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;log GDP per worker&#39;</span>] <span class="op">=</span> np.log(data[<span class="st">&#39;GDP (constant 2010 US$)&#39;</span>]<span class="op">/</span>data[<span class="st">&#39;Labor force, total&#39;</span>])</span>
<span id="cb795-2"><a href="#cb795-2" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;Urban population (%)&#39;</span>] <span class="op">=</span> (data[<span class="st">&#39;Urban population&#39;</span>]<span class="op">/</span>data[<span class="st">&#39;Population, total&#39;</span>]) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb795-3"><a href="#cb795-3" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;log population&#39;</span>] <span class="op">=</span> np.log(data[<span class="st">&#39;Population, total&#39;</span>])</span>
<span id="cb795-4"><a href="#cb795-4" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data[data[<span class="st">&#39;log GDP per worker&#39;</span>].notna()]</span>
<span id="cb795-5"><a href="#cb795-5" aria-hidden="true" tabindex="-1"></a>gdp_per_worker <span class="op">=</span> data[<span class="st">&#39;GDP (constant 2010 US$)&#39;</span>]<span class="op">/</span>data[<span class="st">&#39;Labor force, total&#39;</span>]</span>
<span id="cb795-6"><a href="#cb795-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb795-7"><a href="#cb795-7" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">15</span>))</span>
<span id="cb795-8"><a href="#cb795-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Heatmap of Missing Values&#39;</span>)</span>
<span id="cb795-9"><a href="#cb795-9" aria-hidden="true" tabindex="-1"></a>sns.heatmap(data.isna())</span>
<span id="cb795-10"><a href="#cb795-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p>Sólo consideré las características con menos de 10 valores perdidos. Rellené el resto de los valores que faltaban con los últimos datos disponibles en <a href="https://data.worldbank.org/" class="uri">https://data.worldbank.org/</a>. Los valores de Canadá y Etiopía para la característica “Crédito nacional al sector privado por parte de los bancos (% del PIB)” son, con mucho, los más antiguos. Son de 2008.</p>
<div class="sourceCode" id="cb796"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb796-1"><a href="#cb796-1" aria-hidden="true" tabindex="-1"></a><span class="co"># only considerng features with less than 10 missing values and a sensible relationship with the producitivity</span></span>
<span id="cb796-2"><a href="#cb796-2" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> [<span class="st">&#39;country&#39;</span>, <span class="st">&#39;log GDP per worker&#39;</span>, <span class="st">&#39;Urban population (%)&#39;</span>, <span class="st">&#39;Domestic credit to private sector by banks (</span><span class="sc">% o</span><span class="st">f GDP)&#39;</span>, </span>
<span id="cb796-3"><a href="#cb796-3" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;Fixed broadband subscriptions (per 100 people)&#39;</span>, <span class="st">&#39;Age dependency ratio, old (</span><span class="sc">% o</span><span class="st">f working-age population)&#39;</span>, </span>
<span id="cb796-4"><a href="#cb796-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;Age dependency ratio, young (</span><span class="sc">% o</span><span class="st">f working-age population)&#39;</span>, <span class="st">&#39;Unemployment, total (</span><span class="sc">% o</span><span class="st">f total labor force) (modeled ILO estimate)&#39;</span>, </span>
<span id="cb796-5"><a href="#cb796-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;Final consumption expenditure (</span><span class="sc">% o</span><span class="st">f GDP)&#39;</span>] </span>
<span id="cb796-6"><a href="#cb796-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb796-7"><a href="#cb796-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Filling nan with last available data from https://data.worldbank.org/</span></span>
<span id="cb796-8"><a href="#cb796-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb796-9"><a href="#cb796-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Domestic credit to private sector by banks (% of GDP) </span></span>
<span id="cb796-10"><a href="#cb796-10" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;Domestic credit to private sector by banks (</span><span class="sc">% o</span><span class="st">f GDP)&#39;</span>].iloc[data[<span class="st">&#39;country&#39;</span>] <span class="op">==</span> <span class="st">&#39;Argentina&#39;</span>] <span class="op">=</span> <span class="fl">15.4</span> <span class="co"># 2017</span></span>
<span id="cb796-11"><a href="#cb796-11" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;Domestic credit to private sector by banks (</span><span class="sc">% o</span><span class="st">f GDP)&#39;</span>].iloc[data[<span class="st">&#39;country&#39;</span>] <span class="op">==</span> <span class="st">&#39;Ethiopia&#39;</span>] <span class="op">=</span> <span class="fl">17.6</span> <span class="co"># 2008</span></span>
<span id="cb796-12"><a href="#cb796-12" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;Domestic credit to private sector by banks (</span><span class="sc">% o</span><span class="st">f GDP)&#39;</span>].iloc[data[<span class="st">&#39;country&#39;</span>] <span class="op">==</span> <span class="st">&#39;Canada&#39;</span>] <span class="op">=</span> <span class="fl">124.1</span> <span class="co"># 2008</span></span>
<span id="cb796-13"><a href="#cb796-13" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;Domestic credit to private sector by banks (</span><span class="sc">% o</span><span class="st">f GDP)&#39;</span>].iloc[data[<span class="st">&#39;country&#39;</span>] <span class="op">==</span> <span class="st">&#39;Iraq&#39;</span>] <span class="op">=</span> <span class="fl">9.2</span> <span class="co"># 2018</span></span>
<span id="cb796-14"><a href="#cb796-14" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;Domestic credit to private sector by banks (</span><span class="sc">% o</span><span class="st">f GDP)&#39;</span>].iloc[data[<span class="st">&#39;country&#39;</span>] <span class="op">==</span> <span class="st">&#39;Saudi Arabia&#39;</span>] <span class="op">=</span> <span class="fl">54.0</span> <span class="co"># 2018</span></span>
<span id="cb796-15"><a href="#cb796-15" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;Domestic credit to private sector by banks (</span><span class="sc">% o</span><span class="st">f GDP)&#39;</span>].iloc[data[<span class="st">&#39;country&#39;</span>] <span class="op">==</span> <span class="st">&#39;Switzerland&#39;</span>] <span class="op">=</span> <span class="fl">168.5</span> <span class="co"># 2016</span></span>
<span id="cb796-16"><a href="#cb796-16" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;Domestic credit to private sector by banks (</span><span class="sc">% o</span><span class="st">f GDP)&#39;</span>].iloc[data[<span class="st">&#39;country&#39;</span>] <span class="op">==</span> <span class="st">&#39;Viet Nam&#39;</span>] <span class="op">=</span> <span class="fl">137.9</span> <span class="co">#2019</span></span>
<span id="cb796-17"><a href="#cb796-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb796-18"><a href="#cb796-18" aria-hidden="true" tabindex="-1"></a><span class="co"># fixed broadband</span></span>
<span id="cb796-19"><a href="#cb796-19" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;Fixed broadband subscriptions (per 100 people)&#39;</span>].iloc[data[<span class="st">&#39;country&#39;</span>] <span class="op">==</span> <span class="st">&#39;Peru&#39;</span>] <span class="op">=</span> <span class="fl">7.93</span> <span class="co"># 2018</span></span>
<span id="cb796-20"><a href="#cb796-20" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;Fixed broadband subscriptions (per 100 people)&#39;</span>].iloc[data[<span class="st">&#39;country&#39;</span>] <span class="op">==</span> <span class="st">&#39;Philippines&#39;</span>] <span class="op">=</span> <span class="fl">5.48</span> <span class="co"># 2019</span></span>
<span id="cb796-21"><a href="#cb796-21" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;Fixed broadband subscriptions (per 100 people)&#39;</span>].iloc[data[<span class="st">&#39;country&#39;</span>] <span class="op">==</span> <span class="st">&#39;Ethiopia&#39;</span>] <span class="op">=</span> <span class="fl">0.06</span> <span class="co"># 2017</span></span>
<span id="cb796-22"><a href="#cb796-22" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;Fixed broadband subscriptions (per 100 people)&#39;</span>].iloc[data[<span class="st">&#39;country&#39;</span>] <span class="op">==</span> <span class="st">&#39;Nepal&#39;</span>] <span class="op">=</span> <span class="fl">2.82</span> <span class="co"># 2018</span></span>
<span id="cb796-23"><a href="#cb796-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb796-24"><a href="#cb796-24" aria-hidden="true" tabindex="-1"></a><span class="co"># final consumption</span></span>
<span id="cb796-25"><a href="#cb796-25" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;Final consumption expenditure (</span><span class="sc">% o</span><span class="st">f GDP)&#39;</span>].iloc[data[<span class="st">&#39;country&#39;</span>] <span class="op">==</span> <span class="st">&#39;China&#39;</span>] <span class="op">=</span> <span class="fl">56.0</span> <span class="co"># 2019</span></span>
<span id="cb796-26"><a href="#cb796-26" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;Final consumption expenditure (</span><span class="sc">% o</span><span class="st">f GDP)&#39;</span>].iloc[data[<span class="st">&#39;country&#39;</span>] <span class="op">==</span> <span class="st">&#39;Ghana&#39;</span>] <span class="op">=</span> <span class="fl">77.6</span> <span class="co"># 2019</span></span>
<span id="cb796-27"><a href="#cb796-27" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;Final consumption expenditure (</span><span class="sc">% o</span><span class="st">f GDP)&#39;</span>].iloc[data[<span class="st">&#39;country&#39;</span>] <span class="op">==</span> <span class="st">&#39;Iraq&#39;</span>] <span class="op">=</span> <span class="fl">65.4</span> <span class="co"># 2019</span></span>
<span id="cb796-28"><a href="#cb796-28" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;Final consumption expenditure (</span><span class="sc">% o</span><span class="st">f GDP)&#39;</span>].iloc[data[<span class="st">&#39;country&#39;</span>] <span class="op">==</span> <span class="st">&#39;Kazakhstan&#39;</span>] <span class="op">=</span> <span class="fl">61.4</span> <span class="co"># 2019</span></span>
<span id="cb796-29"><a href="#cb796-29" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;Final consumption expenditure (</span><span class="sc">% o</span><span class="st">f GDP)&#39;</span>].iloc[data[<span class="st">&#39;country&#39;</span>] <span class="op">==</span> <span class="st">&#39;Kenya&#39;</span>] <span class="op">=</span> <span class="fl">95.5</span> <span class="co"># 2019</span></span>
<span id="cb796-30"><a href="#cb796-30" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;Final consumption expenditure (</span><span class="sc">% o</span><span class="st">f GDP)&#39;</span>].iloc[data[<span class="st">&#39;country&#39;</span>] <span class="op">==</span> <span class="st">&#39;Tunisia&#39;</span>] <span class="op">=</span> <span class="fl">92.9</span> <span class="co"># 2019</span></span>
<span id="cb796-31"><a href="#cb796-31" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;Final consumption expenditure (</span><span class="sc">% o</span><span class="st">f GDP)&#39;</span>].iloc[data[<span class="st">&#39;country&#39;</span>] <span class="op">==</span> <span class="st">&#39;United States of America&#39;</span>] <span class="op">=</span> <span class="fl">81.8</span> <span class="co"># 2020</span></span>
<span id="cb796-32"><a href="#cb796-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb796-33"><a href="#cb796-33" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data[features]</span>
<span id="cb796-34"><a href="#cb796-34" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.dropna()</span>
<span id="cb796-35"><a href="#cb796-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb796-36"><a href="#cb796-36" aria-hidden="true" tabindex="-1"></a>data</span></code></pre></div>
<p>Pib por trabajador: El PIB per cápita es una medida útil cuando queremos evaluar la riqueza de un país. Sin embargo, yo quería identificar predictores de la productividad de un país. Una medida mejor sería en este caso el PIB por trabajador, ya que sólo tiene en cuenta a la población activa. La medida ideal sería el PIB por horas trabajadas, pero este conjunto de datos no incluye la información necesaria para construir esta característica y el PIB por trabajador también es ya suficiente.</p>
<div class="sourceCode" id="cb797"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb797-1"><a href="#cb797-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>,<span class="dv">6</span>))</span>
<span id="cb797-2"><a href="#cb797-2" aria-hidden="true" tabindex="-1"></a>sns.histplot(gdp_per_worker, ax<span class="op">=</span>ax1, color<span class="op">=</span><span class="st">&#39;salmon&#39;</span>)</span>
<span id="cb797-3"><a href="#cb797-3" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">&#39;GDP per worker&#39;</span>)</span>
<span id="cb797-4"><a href="#cb797-4" aria-hidden="true" tabindex="-1"></a>sns.histplot(data[<span class="st">&#39;log GDP per worker&#39;</span>], ax<span class="op">=</span>ax2, color<span class="op">=</span><span class="st">&#39;salmon&#39;</span>)</span>
<span id="cb797-5"><a href="#cb797-5" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">&#39;Log GDP per worker&#39;</span>)</span>
<span id="cb797-6"><a href="#cb797-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p>Urban Population: La característica “Población urbana (%)” describe qué porcentaje de la población vive en las ciudades.</p>
<div class="sourceCode" id="cb798"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb798-1"><a href="#cb798-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>,<span class="dv">6</span>))</span>
<span id="cb798-2"><a href="#cb798-2" aria-hidden="true" tabindex="-1"></a>sns.regplot(ax<span class="op">=</span>ax1, x<span class="op">=</span><span class="st">&#39;Urban population (%)&#39;</span>, y<span class="op">=</span><span class="st">&#39;log GDP per worker&#39;</span>, data<span class="op">=</span>data, color <span class="op">=</span> <span class="st">&#39;salmon&#39;</span>)</span>
<span id="cb798-3"><a href="#cb798-3" aria-hidden="true" tabindex="-1"></a>sns.histplot(data[<span class="st">&#39;Urban population (%)&#39;</span>], ax<span class="op">=</span>ax2, color<span class="op">=</span><span class="st">&#39;salmon&#39;</span>)</span>
<span id="cb798-4"><a href="#cb798-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb798-5"><a href="#cb798-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb798-6"><a href="#cb798-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Pearson-r and P-Value: &#39;</span> <span class="op">+</span> <span class="bu">str</span>(pearsonr(data[<span class="st">&#39;Urban population (%)&#39;</span>], data[<span class="st">&#39;log GDP per worker&#39;</span>])))</span></code></pre></div>
<p>Domestic credit to private sector by banks (% of GDP): Esta característica describe la cantidad de recursos financieros proporcionados al sector privado por los bancos en relación con el PIB.</p>
<div class="sourceCode" id="cb799"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb799-1"><a href="#cb799-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>,<span class="dv">6</span>))</span>
<span id="cb799-2"><a href="#cb799-2" aria-hidden="true" tabindex="-1"></a>sns.regplot(ax<span class="op">=</span>ax1, x<span class="op">=</span><span class="st">&#39;Domestic credit to private sector by banks (</span><span class="sc">% o</span><span class="st">f GDP)&#39;</span>, y<span class="op">=</span><span class="st">&#39;log GDP per worker&#39;</span>, data<span class="op">=</span>data, color <span class="op">=</span> <span class="st">&#39;salmon&#39;</span>)</span>
<span id="cb799-3"><a href="#cb799-3" aria-hidden="true" tabindex="-1"></a>sns.histplot(data[<span class="st">&#39;Domestic credit to private sector by banks (</span><span class="sc">% o</span><span class="st">f GDP)&#39;</span>], ax<span class="op">=</span>ax2, color<span class="op">=</span><span class="st">&#39;salmon&#39;</span>)</span>
<span id="cb799-4"><a href="#cb799-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb799-5"><a href="#cb799-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb799-6"><a href="#cb799-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Pearson-r and P-Value: &#39;</span> <span class="op">+</span> <span class="bu">str</span>(pearsonr(data[<span class="st">&#39;Domestic credit to private sector by banks (</span><span class="sc">% o</span><span class="st">f GDP)&#39;</span>], data[<span class="st">&#39;log GDP per worker&#39;</span>])))</span></code></pre></div>
<p>Fixed broadband subscriptions (per 100 people): Suscripciones para el acceso de alta velocidad a la Internet pública.</p>
<div class="sourceCode" id="cb800"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb800-1"><a href="#cb800-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>,<span class="dv">6</span>))</span>
<span id="cb800-2"><a href="#cb800-2" aria-hidden="true" tabindex="-1"></a>sns.regplot(ax<span class="op">=</span>ax1, x<span class="op">=</span><span class="st">&#39;Fixed broadband subscriptions (per 100 people)&#39;</span>, y<span class="op">=</span><span class="st">&#39;log GDP per worker&#39;</span>, data<span class="op">=</span>data, color <span class="op">=</span> <span class="st">&#39;salmon&#39;</span>)</span>
<span id="cb800-3"><a href="#cb800-3" aria-hidden="true" tabindex="-1"></a>sns.histplot(data[<span class="st">&#39;Fixed broadband subscriptions (per 100 people)&#39;</span>], ax<span class="op">=</span>ax2, color<span class="op">=</span><span class="st">&#39;salmon&#39;</span>)</span>
<span id="cb800-4"><a href="#cb800-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb800-5"><a href="#cb800-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb800-6"><a href="#cb800-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Pearson-r and P-Value: &#39;</span> <span class="op">+</span> <span class="bu">str</span>(pearsonr(data[<span class="st">&#39;Fixed broadband subscriptions (per 100 people)&#39;</span>], data[<span class="st">&#39;log GDP per worker&#39;</span>])))</span></code></pre></div>
<p>Age dependency ratio, old (% of working-age population): Número de personas mayores de 64 años en relación con el número de personas entre 15 y 64 años.</p>
<div class="sourceCode" id="cb801"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb801-1"><a href="#cb801-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>,<span class="dv">6</span>))</span>
<span id="cb801-2"><a href="#cb801-2" aria-hidden="true" tabindex="-1"></a>sns.regplot(ax<span class="op">=</span>ax1, x<span class="op">=</span><span class="st">&#39;Age dependency ratio, old (</span><span class="sc">% o</span><span class="st">f working-age population)&#39;</span>, y<span class="op">=</span><span class="st">&#39;log GDP per worker&#39;</span>, data<span class="op">=</span>data, color <span class="op">=</span> <span class="st">&#39;salmon&#39;</span>)</span>
<span id="cb801-3"><a href="#cb801-3" aria-hidden="true" tabindex="-1"></a>sns.histplot(data[<span class="st">&#39;Age dependency ratio, old (</span><span class="sc">% o</span><span class="st">f working-age population)&#39;</span>], ax<span class="op">=</span>ax2, color<span class="op">=</span><span class="st">&#39;salmon&#39;</span>)</span>
<span id="cb801-4"><a href="#cb801-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb801-5"><a href="#cb801-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb801-6"><a href="#cb801-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Pearson-r and P-Value: &#39;</span> <span class="op">+</span> <span class="bu">str</span>(pearsonr(data[<span class="st">&#39;Age dependency ratio, old (</span><span class="sc">% o</span><span class="st">f working-age population)&#39;</span>], data[<span class="st">&#39;log GDP per worker&#39;</span>])))</span></code></pre></div>
<p>Age dependency ratio, young (% of working-age population): Number of people who are younger than 15 in relation to the number of people between 15 and 64.</p>
<div class="sourceCode" id="cb802"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb802-1"><a href="#cb802-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>,<span class="dv">6</span>))</span>
<span id="cb802-2"><a href="#cb802-2" aria-hidden="true" tabindex="-1"></a>sns.regplot(ax<span class="op">=</span>ax1, x<span class="op">=</span><span class="st">&#39;Age dependency ratio, young (</span><span class="sc">% o</span><span class="st">f working-age population)&#39;</span>, y<span class="op">=</span><span class="st">&#39;log GDP per worker&#39;</span>, data<span class="op">=</span>data, color <span class="op">=</span> <span class="st">&#39;salmon&#39;</span>)</span>
<span id="cb802-3"><a href="#cb802-3" aria-hidden="true" tabindex="-1"></a>sns.histplot(data[<span class="st">&#39;Age dependency ratio, young (</span><span class="sc">% o</span><span class="st">f working-age population)&#39;</span>], ax<span class="op">=</span>ax2, color<span class="op">=</span><span class="st">&#39;salmon&#39;</span>)</span>
<span id="cb802-4"><a href="#cb802-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb802-5"><a href="#cb802-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb802-6"><a href="#cb802-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Pearson-r and P-Value: &#39;</span> <span class="op">+</span> <span class="bu">str</span>(pearsonr(data[<span class="st">&#39;Age dependency ratio, young (</span><span class="sc">% o</span><span class="st">f working-age population)&#39;</span>], data[<span class="st">&#39;log GDP per worker&#39;</span>])))</span></code></pre></div>
<p>Unemployment, total (% of total labor force) (modeled ILO estimate): Unemployment estimate modeled by the Iternational Labor Organization.</p>
<div class="sourceCode" id="cb803"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb803-1"><a href="#cb803-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>,<span class="dv">6</span>))</span>
<span id="cb803-2"><a href="#cb803-2" aria-hidden="true" tabindex="-1"></a>sns.regplot(ax<span class="op">=</span>ax1, x<span class="op">=</span><span class="st">&#39;Unemployment, total (</span><span class="sc">% o</span><span class="st">f total labor force) (modeled ILO estimate)&#39;</span>, y<span class="op">=</span><span class="st">&#39;log GDP per worker&#39;</span>, data<span class="op">=</span>data, color <span class="op">=</span> <span class="st">&#39;salmon&#39;</span>)</span>
<span id="cb803-3"><a href="#cb803-3" aria-hidden="true" tabindex="-1"></a>sns.histplot(data[<span class="st">&#39;Unemployment, total (</span><span class="sc">% o</span><span class="st">f total labor force) (modeled ILO estimate)&#39;</span>], ax<span class="op">=</span>ax2, color<span class="op">=</span><span class="st">&#39;salmon&#39;</span>)</span>
<span id="cb803-4"><a href="#cb803-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb803-5"><a href="#cb803-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb803-6"><a href="#cb803-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Pearson-r and P-Value: &#39;</span> <span class="op">+</span> <span class="bu">str</span>(pearsonr(data[<span class="st">&#39;Unemployment, total (</span><span class="sc">% o</span><span class="st">f total labor force) (modeled ILO estimate)&#39;</span>], data[<span class="st">&#39;log GDP per worker&#39;</span>])))</span></code></pre></div>
<p>Final consumption expenditure (% of GDP): Final household and government consumption expenditure relative to the GDP.</p>
<div class="sourceCode" id="cb804"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb804-1"><a href="#cb804-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>,<span class="dv">6</span>))</span>
<span id="cb804-2"><a href="#cb804-2" aria-hidden="true" tabindex="-1"></a>sns.regplot(ax<span class="op">=</span>ax1, x<span class="op">=</span><span class="st">&#39;Final consumption expenditure (</span><span class="sc">% o</span><span class="st">f GDP)&#39;</span>, y<span class="op">=</span><span class="st">&#39;log GDP per worker&#39;</span>, data<span class="op">=</span>data, color <span class="op">=</span> <span class="st">&#39;salmon&#39;</span>)</span>
<span id="cb804-3"><a href="#cb804-3" aria-hidden="true" tabindex="-1"></a>sns.histplot(data[<span class="st">&#39;Final consumption expenditure (</span><span class="sc">% o</span><span class="st">f GDP)&#39;</span>], ax<span class="op">=</span>ax2, color<span class="op">=</span><span class="st">&#39;salmon&#39;</span>)</span>
<span id="cb804-4"><a href="#cb804-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb804-5"><a href="#cb804-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb804-6"><a href="#cb804-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Pearson-r and P-Value: &#39;</span> <span class="op">+</span> <span class="bu">str</span>(pearsonr(data[<span class="st">&#39;Final consumption expenditure (</span><span class="sc">% o</span><span class="st">f GDP)&#39;</span>], data[<span class="st">&#39;log GDP per worker&#39;</span>])))</span></code></pre></div>
<p>Análisis de regresión (intro)</p>
<div class="sourceCode" id="cb805"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb805-1"><a href="#cb805-1" aria-hidden="true" tabindex="-1"></a>data.corr().style.background_gradient(cmap<span class="op">=</span><span class="st">&#39;coolwarm&#39;</span>)</span></code></pre></div>
<p>Existe una fuerte correlación entre “Tasa de dependencia de la edad, ancianos (% de la población en edad de trabajar)” y “Abonados a la banda ancha fija (por cada 100 personas)”, ya que el coeficiente de correlación de Pearson es de 0,897830. Esto puede causar problemas a la hora de interpretar el modelo de regresión. Intento resolver este problema construyendo tres modelos. El primero tendrá en cuenta todas las características, para el segundo modelo dejaré fuera la “Tasa de dependencia de la edad, ancianos (% de la población en edad de trabajar)” y el tercer modelo no incluirá las “Suscripciones a la banda ancha fija (por cada 100 personas)”.</p>
<div class="sourceCode" id="cb806"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb806-1"><a href="#cb806-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> data.drop([<span class="st">&#39;country&#39;</span>], axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb806-2"><a href="#cb806-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> X.pop(<span class="st">&#39;log GDP per worker&#39;</span>)</span>
<span id="cb806-3"><a href="#cb806-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb806-4"><a href="#cb806-4" aria-hidden="true" tabindex="-1"></a><span class="co"># columns for model 2</span></span>
<span id="cb806-5"><a href="#cb806-5" aria-hidden="true" tabindex="-1"></a>model2_l <span class="op">=</span> [<span class="st">&#39;const&#39;</span>,<span class="st">&#39;Urban population (%)&#39;</span>, <span class="st">&#39;Domestic credit to private sector by banks (</span><span class="sc">% o</span><span class="st">f GDP)&#39;</span>, </span>
<span id="cb806-6"><a href="#cb806-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;Fixed broadband subscriptions (per 100 people)&#39;</span>, <span class="st">&#39;Final consumption expenditure (</span><span class="sc">% o</span><span class="st">f GDP)&#39;</span>,</span>
<span id="cb806-7"><a href="#cb806-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;Age dependency ratio, young (</span><span class="sc">% o</span><span class="st">f working-age population)&#39;</span>, <span class="st">&#39;Unemployment, total (</span><span class="sc">% o</span><span class="st">f total labor force) (modeled ILO estimate)&#39;</span>]</span>
<span id="cb806-8"><a href="#cb806-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb806-9"><a href="#cb806-9" aria-hidden="true" tabindex="-1"></a><span class="co"># columns for model 3</span></span>
<span id="cb806-10"><a href="#cb806-10" aria-hidden="true" tabindex="-1"></a>model3_l <span class="op">=</span> [<span class="st">&#39;const&#39;</span>, <span class="st">&#39;Urban population (%)&#39;</span>, <span class="st">&#39;Domestic credit to private sector by banks (</span><span class="sc">% o</span><span class="st">f GDP)&#39;</span>, </span>
<span id="cb806-11"><a href="#cb806-11" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;Age dependency ratio, old (</span><span class="sc">% o</span><span class="st">f working-age population)&#39;</span>, <span class="st">&#39;Final consumption expenditure (</span><span class="sc">% o</span><span class="st">f GDP)&#39;</span>,</span>
<span id="cb806-12"><a href="#cb806-12" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;Age dependency ratio, young (</span><span class="sc">% o</span><span class="st">f working-age population)&#39;</span>, <span class="st">&#39;Unemployment, total (</span><span class="sc">% o</span><span class="st">f total labor force) (modeled ILO estimate)&#39;</span>]</span>
<span id="cb806-13"><a href="#cb806-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb806-14"><a href="#cb806-14" aria-hidden="true" tabindex="-1"></a>X_lin <span class="op">=</span> sm.tools.add_constant(X)</span>
<span id="cb806-15"><a href="#cb806-15" aria-hidden="true" tabindex="-1"></a>model1 <span class="op">=</span> sm.OLS(y, X_lin.astype(<span class="st">&#39;float&#39;</span>)).fit()</span>
<span id="cb806-16"><a href="#cb806-16" aria-hidden="true" tabindex="-1"></a>model2 <span class="op">=</span> sm.OLS(y, X_lin[model2_l].astype(<span class="st">&#39;float&#39;</span>)).fit()</span>
<span id="cb806-17"><a href="#cb806-17" aria-hidden="true" tabindex="-1"></a>model3 <span class="op">=</span> sm.OLS(y, X_lin[model3_l].astype(<span class="st">&#39;float&#39;</span>)).fit()</span>
<span id="cb806-18"><a href="#cb806-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb806-19"><a href="#cb806-19" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> return_results(model, model_list):</span>
<span id="cb806-20"><a href="#cb806-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [model.pvalues[i] <span class="cf">for</span> i <span class="kw">in</span> model_list]</span>
<span id="cb806-21"><a href="#cb806-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb806-22"><a href="#cb806-22" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> pd.DataFrame(index<span class="op">=</span>X_lin.columns)</span>
<span id="cb806-23"><a href="#cb806-23" aria-hidden="true" tabindex="-1"></a>results[<span class="st">&#39;Model 1 Coeff.&#39;</span>] <span class="op">=</span> pd.Series(model1.params)</span>
<span id="cb806-24"><a href="#cb806-24" aria-hidden="true" tabindex="-1"></a>results[<span class="st">&#39;Model 1 P-Values&#39;</span>] <span class="op">=</span> pd.Series(return_results(model1, X_lin.columns), index <span class="op">=</span> X_lin.columns)</span>
<span id="cb806-25"><a href="#cb806-25" aria-hidden="true" tabindex="-1"></a>results[<span class="st">&#39;Model 2 Coeff.&#39;</span>] <span class="op">=</span> pd.Series(model2.params)</span>
<span id="cb806-26"><a href="#cb806-26" aria-hidden="true" tabindex="-1"></a>results[<span class="st">&#39;Model 2 P-Values&#39;</span>] <span class="op">=</span> pd.Series(return_results(model2, model2_l), index <span class="op">=</span> model2_l)</span>
<span id="cb806-27"><a href="#cb806-27" aria-hidden="true" tabindex="-1"></a>results[<span class="st">&#39;Model 3 Coeff.&#39;</span>] <span class="op">=</span> pd.Series(model3.params)</span>
<span id="cb806-28"><a href="#cb806-28" aria-hidden="true" tabindex="-1"></a>results[<span class="st">&#39;Model 3 P-Values&#39;</span>] <span class="op">=</span> pd.Series(return_results(model3, model3_l), index <span class="op">=</span> model3_l)</span>
<span id="cb806-29"><a href="#cb806-29" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> results.fillna(<span class="st">&#39;---&#39;</span>)</span>
<span id="cb806-30"><a href="#cb806-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb806-31"><a href="#cb806-31" aria-hidden="true" tabindex="-1"></a>results</span></code></pre></div>
<p>El coeficiente de “Población urbana (%)” es positivo y el efecto es significativo en los tres modelos. El efecto de “Crédito interno al sector privado por parte de los bancos (% del PIB)” no es significativo en ninguno de los modelos. “Abonados a la banda ancha fija (por cada 100 personas)” sólo se incluyó en los modelos 1 y 2 y el efecto es positivo y significativo en ambos. “Tasa de dependencia de la edad, mayores (% de la población en edad de trabajar)” tiene un efecto positivo y significativo en el modelo 1 y el modelo 3, mientras que “Tasa de dependencia de la edad, jóvenes (% de la población en edad de trabajar)” no tiene un efecto significativo en ningún modelo. Lo mismo puede decirse de “Desempleo, total (% de la población activa total) (estimación modelada de la OIT)”. Sin embargo, el “Gasto en consumo final (% del PIB)” muestra un efecto negativo y altamente significativo en todos los modelos. La falta de significación de algunas de las variables puede deberse a la multicolinealidad, especialmente en lo que respecta a “Dependencia de la edad, jóvenes”.</p>
<p>Por último, examinaremos la eficacia de cada modelo para predecir el PIB por trabajador de un país. El pequeño tamaño de la muestra no es ideal para construir un modelo de predicción, pero permite la validación cruzada “Leave-one-out”, que llevaría mucho tiempo en el caso de grandes conjuntos de datos.</p>
<div class="sourceCode" id="cb807"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb807-1"><a href="#cb807-1" aria-hidden="true" tabindex="-1"></a>loo <span class="op">=</span> LeaveOneOut()</span>
<span id="cb807-2"><a href="#cb807-2" aria-hidden="true" tabindex="-1"></a>m1_score <span class="op">=</span> []</span>
<span id="cb807-3"><a href="#cb807-3" aria-hidden="true" tabindex="-1"></a>m2_score <span class="op">=</span> []</span>
<span id="cb807-4"><a href="#cb807-4" aria-hidden="true" tabindex="-1"></a>m3_score <span class="op">=</span> []</span>
<span id="cb807-5"><a href="#cb807-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> train_index, test_index <span class="kw">in</span> loo.split(X_lin, gdp_per_worker[X_lin.index]):</span>
<span id="cb807-6"><a href="#cb807-6" aria-hidden="true" tabindex="-1"></a>    X_train, X_test <span class="op">=</span> X_lin.iloc[train_index], X_lin.iloc[test_index]</span>
<span id="cb807-7"><a href="#cb807-7" aria-hidden="true" tabindex="-1"></a>    y_train, y_test <span class="op">=</span> gdp_per_worker.iloc[train_index], gdp_per_worker.iloc[test_index]</span>
<span id="cb807-8"><a href="#cb807-8" aria-hidden="true" tabindex="-1"></a>    model1 <span class="op">=</span> sm.OLS(<span class="bu">list</span>(y_train), X_train.astype(<span class="st">&#39;float&#39;</span>)).fit()</span>
<span id="cb807-9"><a href="#cb807-9" aria-hidden="true" tabindex="-1"></a>    model2 <span class="op">=</span> sm.OLS(<span class="bu">list</span>(y_train), X_train[model2_l].astype(<span class="st">&#39;float&#39;</span>)).fit()</span>
<span id="cb807-10"><a href="#cb807-10" aria-hidden="true" tabindex="-1"></a>    model3 <span class="op">=</span> sm.OLS(<span class="bu">list</span>(y_train), X_train[model3_l].astype(<span class="st">&#39;float&#39;</span>)).fit()</span>
<span id="cb807-11"><a href="#cb807-11" aria-hidden="true" tabindex="-1"></a>    m1_score.append(np.sqrt(sklm.mean_squared_error(y_test, model1.predict(X_test.astype(<span class="st">&#39;float&#39;</span>)))))</span>
<span id="cb807-12"><a href="#cb807-12" aria-hidden="true" tabindex="-1"></a>    m2_score.append(np.sqrt(sklm.mean_squared_error(y_test, model2.predict(X_test[model2_l].astype(<span class="st">&#39;float&#39;</span>)))))</span>
<span id="cb807-13"><a href="#cb807-13" aria-hidden="true" tabindex="-1"></a>    m3_score.append(np.sqrt(sklm.mean_squared_error(y_test, model3.predict(X_test[model3_l].astype(<span class="st">&#39;float&#39;</span>)))))</span>
<span id="cb807-14"><a href="#cb807-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb807-15"><a href="#cb807-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;GDP per worker std.:        &#39;</span> <span class="op">+</span> <span class="bu">str</span>(np.std(gdp_per_worker[X_lin.index])))</span>
<span id="cb807-16"><a href="#cb807-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Model 1 LOOCV Error (RMSE): &#39;</span> <span class="op">+</span> <span class="bu">str</span>(np.mean(m1_score)))</span>
<span id="cb807-17"><a href="#cb807-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Model 2 LOOCV Error (RMSE): &#39;</span> <span class="op">+</span> <span class="bu">str</span>(np.mean(m2_score)))</span>
<span id="cb807-18"><a href="#cb807-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Model 3 LOOCV Error (RMSE): &#39;</span> <span class="op">+</span> <span class="bu">str</span>(np.mean(m3_score)))</span></code></pre></div>
</div>
</div>
</div>
<div id="análisis-de-datos-parte-ii" class="section level2 hasAnchor" number="4.7">
<h2 class="hasAnchor"><span class="header-section-number">4.7</span> Análisis de datos (Parte II)<a href="#análisis-de-datos-parte-ii" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="optimización-con-scipy" class="section level3 hasAnchor" number="4.7.1">
<h3 class="hasAnchor"><span class="header-section-number">4.7.1</span> Optimización con Scipy<a href="#optimización-con-scipy" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb808"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb808-1"><a href="#cb808-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb808-2"><a href="#cb808-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> linalg</span>
<span id="cb808-3"><a href="#cb808-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb808-4"><a href="#cb808-4" aria-hidden="true" tabindex="-1"></a>arr <span class="op">=</span> np.array([[<span class="dv">1</span>, <span class="dv">2</span>],</span>
<span id="cb808-5"><a href="#cb808-5" aria-hidden="true" tabindex="-1"></a>               [<span class="dv">3</span>, <span class="dv">4</span>]])</span>
<span id="cb808-6"><a href="#cb808-6" aria-hidden="true" tabindex="-1"></a>linalg.</span>
<span id="cb808-7"><a href="#cb808-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb808-8"><a href="#cb808-8" aria-hidden="true" tabindex="-1"></a>arr</span>
<span id="cb808-9"><a href="#cb808-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb808-10"><a href="#cb808-10" aria-hidden="true" tabindex="-1"></a>arr <span class="op">=</span> np.array([[<span class="dv">3</span>, <span class="dv">2</span>],</span>
<span id="cb808-11"><a href="#cb808-11" aria-hidden="true" tabindex="-1"></a>                [<span class="dv">6</span>, <span class="dv">4</span>]])</span>
<span id="cb808-12"><a href="#cb808-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb808-13"><a href="#cb808-13" aria-hidden="true" tabindex="-1"></a>linalg.det(arr)</span>
<span id="cb808-14"><a href="#cb808-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb808-15"><a href="#cb808-15" aria-hidden="true" tabindex="-1"></a><span class="co">#2. Inversa de una matriz</span></span>
<span id="cb808-16"><a href="#cb808-16" aria-hidden="true" tabindex="-1"></a>linalg.inv(arr)</span>
<span id="cb808-17"><a href="#cb808-17" aria-hidden="true" tabindex="-1"></a><span class="co"># calcular la inversa de una matriz singular (su determinante es cero) generará un error</span></span>
<span id="cb808-18"><a href="#cb808-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb808-19"><a href="#cb808-19" aria-hidden="true" tabindex="-1"></a>arr <span class="op">=</span> np.array([[<span class="dv">1</span>, <span class="dv">2</span>],</span>
<span id="cb808-20"><a href="#cb808-20" aria-hidden="true" tabindex="-1"></a>               [<span class="dv">3</span>, <span class="dv">4</span>]])</span>
<span id="cb808-21"><a href="#cb808-21" aria-hidden="true" tabindex="-1"></a>linalg.inv(arr)</span>
<span id="cb808-22"><a href="#cb808-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb808-23"><a href="#cb808-23" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> optimize</span>
<span id="cb808-24"><a href="#cb808-24" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb808-25"><a href="#cb808-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb808-26"><a href="#cb808-26" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> f(x):</span>
<span id="cb808-27"><a href="#cb808-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> <span class="dv">10</span><span class="op">*</span>np.sin(x)</span>
<span id="cb808-28"><a href="#cb808-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb808-29"><a href="#cb808-29" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.arange(<span class="op">-</span><span class="dv">10</span>, <span class="dv">10</span>, <span class="fl">0.1</span>)</span>
<span id="cb808-30"><a href="#cb808-30" aria-hidden="true" tabindex="-1"></a>plt.plot(x, f(x)) </span>
<span id="cb808-31"><a href="#cb808-31" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<ul>
<li><p>Mínimo global: corresponde al valor mínimo en el dominio de la función.</p></li>
<li><p>Mínimo local: corresponde al valor mínimo en una región particular de la curva.</p></li>
<li><p>En el ejemplo tenemos un mínimo local y un mínimo global.</p></li>
<li><p>Mediante un algoritmo de scipy podemos encontrar estos valores, por ejemplo podemos usar la función fmin_bfgs (método BFGS) para encontrar el mínimo.</p></li>
</ul>
<div class="sourceCode" id="cb809"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb809-1"><a href="#cb809-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Usamos el código optmize, la función fmin_bfgs</span></span>
<span id="cb809-2"><a href="#cb809-2" aria-hidden="true" tabindex="-1"></a><span class="co"># La sintaxis es fmin_bfgs(función a optimizar, valor inicial)</span></span>
<span id="cb809-3"><a href="#cb809-3" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> optimize.fmin_bfgs(f, <span class="dv">0</span>)</span>
<span id="cb809-4"><a href="#cb809-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(opt)</span>
<span id="cb809-5"><a href="#cb809-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb809-6"><a href="#cb809-6" aria-hidden="true" tabindex="-1"></a><span class="co">#El resultado nos entrega: </span></span>
<span id="cb809-7"><a href="#cb809-7" aria-hidden="true" tabindex="-1"></a><span class="co">#1) Valor de la función evaluada en el punto mínimo</span></span>
<span id="cb809-8"><a href="#cb809-8" aria-hidden="true" tabindex="-1"></a><span class="co">#2) Número de iteraciones que se demoró en encontrar el mínimo</span></span>
<span id="cb809-9"><a href="#cb809-9" aria-hidden="true" tabindex="-1"></a><span class="co">#3) Número de evaluaciones de la función</span></span>
<span id="cb809-10"><a href="#cb809-10" aria-hidden="true" tabindex="-1"></a><span class="co">#4) Número de evaluaciones del gradiente</span></span>
<span id="cb809-11"><a href="#cb809-11" aria-hidden="true" tabindex="-1"></a><span class="co">#5) Parámetro que minimiza la función</span></span></code></pre></div>
<ul>
<li>Por la naturaleza del método podemos quedar en el mínimo local si no partimos del “lado correcto”</li>
</ul>
<div class="sourceCode" id="cb810"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb810-1"><a href="#cb810-1" aria-hidden="true" tabindex="-1"></a>optimize.fmin_bfgs(f, <span class="dv">3</span>)</span></code></pre></div>
<ul>
<li>Podemos encontrar un mínimo local (dentro de un intervalo), usando fminbound</li>
</ul>
<div class="sourceCode" id="cb811"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb811-1"><a href="#cb811-1" aria-hidden="true" tabindex="-1"></a>xmin_local <span class="op">=</span> optimize.fminbound(f, <span class="dv">0</span>, <span class="dv">10</span>)    </span>
<span id="cb811-2"><a href="#cb811-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(xmin_local)</span>
<span id="cb811-3"><a href="#cb811-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb811-4"><a href="#cb811-4" aria-hidden="true" tabindex="-1"></a>root <span class="op">=</span> optimize.fsolve(f, <span class="dv">1</span>)  <span class="co"># our initial guess is 1</span></span>
<span id="cb811-5"><a href="#cb811-5" aria-hidden="true" tabindex="-1"></a>root</span></code></pre></div>
<ul>
<li>Si la función tiene más de una raíz, tenemos que cambiar el valor inicial para partir de un punto que nos lleve a la segunda (tercera…) solución</li>
</ul>
<div class="sourceCode" id="cb812"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb812-1"><a href="#cb812-1" aria-hidden="true" tabindex="-1"></a>root2 <span class="op">=</span> optimize.fsolve(f, <span class="op">-</span><span class="fl">2.5</span>)</span>
<span id="cb812-2"><a href="#cb812-2" aria-hidden="true" tabindex="-1"></a>root2</span>
<span id="cb812-3"><a href="#cb812-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb812-4"><a href="#cb812-4" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure()</span>
<span id="cb812-5"><a href="#cb812-5" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> fig.add_subplot(<span class="dv">111</span>)</span>
<span id="cb812-6"><a href="#cb812-6" aria-hidden="true" tabindex="-1"></a>ax.plot(x, f(x), <span class="st">&#39;b-&#39;</span>, label<span class="op">=</span><span class="st">&quot;f(x)&quot;</span>)</span>
<span id="cb812-7"><a href="#cb812-7" aria-hidden="true" tabindex="-1"></a>xmins <span class="op">=</span> np.array([xmin_global[<span class="dv">0</span>], xmin_local])</span>
<span id="cb812-8"><a href="#cb812-8" aria-hidden="true" tabindex="-1"></a>ax.plot(xmins, f(xmins), <span class="st">&#39;go&#39;</span>, label<span class="op">=</span><span class="st">&quot;Minima&quot;</span>)</span>
<span id="cb812-9"><a href="#cb812-9" aria-hidden="true" tabindex="-1"></a>roots <span class="op">=</span> np.array([root, root2])</span>
<span id="cb812-10"><a href="#cb812-10" aria-hidden="true" tabindex="-1"></a>ax.plot(roots, f(roots), <span class="st">&#39;kv&#39;</span>, label<span class="op">=</span><span class="st">&quot;Roots&quot;</span>)</span>
<span id="cb812-11"><a href="#cb812-11" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb812-12"><a href="#cb812-12" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">&#39;x&#39;</span>)</span>
<span id="cb812-13"><a href="#cb812-13" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">&#39;f(x)&#39;</span>)</span></code></pre></div>
<ul>
<li>Supongamos que f tiene un poco de ruido</li>
</ul>
<div class="sourceCode" id="cb813"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb813-1"><a href="#cb813-1" aria-hidden="true" tabindex="-1"></a>xdata <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">10</span>, <span class="dv">10</span>, num<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb813-2"><a href="#cb813-2" aria-hidden="true" tabindex="-1"></a>ydata <span class="op">=</span> f(xdata) <span class="op">+</span> np.random.randn(xdata.size)</span>
<span id="cb813-3"><a href="#cb813-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb813-4"><a href="#cb813-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb813-5"><a href="#cb813-5" aria-hidden="true" tabindex="-1"></a>plt.plot(x, f(x), <span class="st">&#39;b-&#39;</span>, label<span class="op">=</span><span class="st">&quot;f(x)&quot;</span>)</span>
<span id="cb813-6"><a href="#cb813-6" aria-hidden="true" tabindex="-1"></a>plt.plot(xdata, ydata, color<span class="op">=</span><span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p>La forma funcional original es <span class="math inline">\(f(x)=x2+10∗sin(x)\)</span></p>
<p>Entonces podemos generalizar mediante</p>
<p><span class="math display">\[f(x,a,b)=a∗x^2+b∗sin(x)\]</span></p>
<p>Mediante curve_fit() podemos encontrar los valores de a y b.</p>
<div class="sourceCode" id="cb814"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb814-1"><a href="#cb814-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> f2(x,a ,b):</span>
<span id="cb814-2"><a href="#cb814-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a<span class="op">*</span>x<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> b<span class="op">**</span>np.sin(x)</span>
<span id="cb814-3"><a href="#cb814-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb814-4"><a href="#cb814-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Valor inicial</span></span>
<span id="cb814-5"><a href="#cb814-5" aria-hidden="true" tabindex="-1"></a>guess <span class="op">=</span> [<span class="dv">2</span>,<span class="dv">2</span>]</span>
<span id="cb814-6"><a href="#cb814-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb814-7"><a href="#cb814-7" aria-hidden="true" tabindex="-1"></a><span class="co"># curve_fit(f, xdata, ydata, valor inicial)</span></span>
<span id="cb814-8"><a href="#cb814-8" aria-hidden="true" tabindex="-1"></a>params, params_covariance <span class="op">=</span> optimize.curve_fit(f2, xdata, ydata, guess)</span>
<span id="cb814-9"><a href="#cb814-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb814-10"><a href="#cb814-10" aria-hidden="true" tabindex="-1"></a><span class="co"># retorna: </span></span>
<span id="cb814-11"><a href="#cb814-11" aria-hidden="true" tabindex="-1"></a><span class="co">#1) Valores óptimos que minimizan f(xdata) - ydata</span></span>
<span id="cb814-12"><a href="#cb814-12" aria-hidden="true" tabindex="-1"></a><span class="co">#2) Covarianza estimada de valores óptimos</span></span>
<span id="cb814-13"><a href="#cb814-13" aria-hidden="true" tabindex="-1"></a>params</span>
<span id="cb814-14"><a href="#cb814-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb814-15"><a href="#cb814-15" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure()</span>
<span id="cb814-16"><a href="#cb814-16" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> fig.add_subplot(<span class="dv">111</span>)</span>
<span id="cb814-17"><a href="#cb814-17" aria-hidden="true" tabindex="-1"></a>ax.plot(x, f(x), <span class="st">&#39;b-&#39;</span>, label<span class="op">=</span><span class="st">&quot;f(x)&quot;</span>)</span>
<span id="cb814-18"><a href="#cb814-18" aria-hidden="true" tabindex="-1"></a>ax.plot(x, f2(x, <span class="op">*</span>params), <span class="st">&#39;r--&#39;</span>, label<span class="op">=</span><span class="st">&quot;Curve fit result&quot;</span>)</span>
<span id="cb814-19"><a href="#cb814-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb814-20"><a href="#cb814-20" aria-hidden="true" tabindex="-1"></a>xmins <span class="op">=</span> np.array([xmin_global[<span class="dv">0</span>], xmin_local])</span>
<span id="cb814-21"><a href="#cb814-21" aria-hidden="true" tabindex="-1"></a>ax.plot(xmins, f(xmins), <span class="st">&#39;go&#39;</span>, label<span class="op">=</span><span class="st">&quot;Minima&quot;</span>)</span>
<span id="cb814-22"><a href="#cb814-22" aria-hidden="true" tabindex="-1"></a>roots <span class="op">=</span> np.array([root, root2])</span>
<span id="cb814-23"><a href="#cb814-23" aria-hidden="true" tabindex="-1"></a>ax.plot(roots, f(roots), <span class="st">&#39;kv&#39;</span>, label<span class="op">=</span><span class="st">&quot;Roots&quot;</span>)</span>
<span id="cb814-24"><a href="#cb814-24" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb814-25"><a href="#cb814-25" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">&#39;x&#39;</span>)</span>
<span id="cb814-26"><a href="#cb814-26" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">&#39;f(x)&#39;</span>)</span></code></pre></div>
<div id="aplicación-de-predicción" class="section level4 hasAnchor" number="4.7.1.1">
<h4 class="hasAnchor"><span class="header-section-number">4.7.1.1</span> Aplicación de predicción<a href="#aplicación-de-predicción" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb815"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb815-1"><a href="#cb815-1" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> [[<span class="dv">1</span>, <span class="dv">2</span>],    </span>
<span id="cb815-2"><a href="#cb815-2" aria-hidden="true" tabindex="-1"></a>     [<span class="dv">3</span>, <span class="dv">4</span>]]</span>
<span id="cb815-3"><a href="#cb815-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb815-4"><a href="#cb815-4" aria-hidden="true" tabindex="-1"></a>B <span class="op">=</span> [[<span class="dv">11</span>, <span class="dv">12</span>],</span>
<span id="cb815-5"><a href="#cb815-5" aria-hidden="true" tabindex="-1"></a>     [<span class="dv">13</span>, <span class="dv">14</span>]]</span>
<span id="cb815-6"><a href="#cb815-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb815-7"><a href="#cb815-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(A)</span>
<span id="cb815-8"><a href="#cb815-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb815-9"><a href="#cb815-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(B)</span>
<span id="cb815-10"><a href="#cb815-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb815-11"><a href="#cb815-11" aria-hidden="true" tabindex="-1"></a>A_np <span class="op">=</span> np.array(A)</span>
<span id="cb815-12"><a href="#cb815-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb815-13"><a href="#cb815-13" aria-hidden="true" tabindex="-1"></a>B_np <span class="op">=</span> np.array(B)</span>
<span id="cb815-14"><a href="#cb815-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb815-15"><a href="#cb815-15" aria-hidden="true" tabindex="-1"></a>A_np <span class="op">*</span> B_np</span>
<span id="cb815-16"><a href="#cb815-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb815-17"><a href="#cb815-17" aria-hidden="true" tabindex="-1"></a>A_np<span class="op">@</span>B_np</span>
<span id="cb815-18"><a href="#cb815-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb815-19"><a href="#cb815-19" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb815-20"><a href="#cb815-20" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb815-21"><a href="#cb815-21" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">0</span>)</span></code></pre></div>
<p><span class="math inline">\(y_i = 0.5 + x_i - 0.1x^2 + \epsilon_i\)</span></p>
<div class="sourceCode" id="cb816"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb816-1"><a href="#cb816-1" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> <span class="dv">2000</span></span>
<span id="cb816-2"><a href="#cb816-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.random.normal(<span class="dv">5</span>,<span class="dv">2</span>,T)  <span class="co">## media, sd, largo de serie</span></span>
<span id="cb816-3"><a href="#cb816-3" aria-hidden="true" tabindex="-1"></a>ϵ <span class="op">=</span> np.random.normal(<span class="dv">0</span>,<span class="dv">1</span>,T)</span>
<span id="cb816-4"><a href="#cb816-4" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> <span class="fl">0.5</span> <span class="op">+</span> x <span class="op">-</span> <span class="fl">0.1</span><span class="op">*</span>x<span class="op">**</span><span class="dv">2</span><span class="op">+</span>ϵ</span>
<span id="cb816-5"><a href="#cb816-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb816-6"><a href="#cb816-6" aria-hidden="true" tabindex="-1"></a>y</span>
<span id="cb816-7"><a href="#cb816-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb816-8"><a href="#cb816-8" aria-hidden="true" tabindex="-1"></a>plt.scatter(x,y,s<span class="op">=</span><span class="dv">5</span>,color<span class="op">=</span><span class="st">&#39;blue&#39;</span>)</span>
<span id="cb816-9"><a href="#cb816-9" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;x&#39;</span>)</span>
<span id="cb816-10"><a href="#cb816-10" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;y&#39;</span>)</span></code></pre></div>
</div>
<div id="polonomio-de-orden-1" class="section level4 hasAnchor" number="4.7.1.2">
<h4 class="hasAnchor"><span class="header-section-number">4.7.1.2</span> Polonomio de orden 1<a href="#polonomio-de-orden-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb817"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb817-1"><a href="#cb817-1" aria-hidden="true" tabindex="-1"></a>X_1 <span class="op">=</span> np.column_stack([np.ones_like(x),x])</span>
<span id="cb817-2"><a href="#cb817-2" aria-hidden="true" tabindex="-1"></a>X_1[<span class="dv">0</span>:<span class="dv">3</span>,:]</span></code></pre></div>
<p>np.linalg.lstq -&gt; Return the least-squares solution to a linear matrix equation.
<a href="https://numpy.org/doc/stable/reference/generated/numpy.linalg.lstsq.html" class="uri">https://numpy.org/doc/stable/reference/generated/numpy.linalg.lstsq.html</a></p>
<div class="sourceCode" id="cb818"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb818-1"><a href="#cb818-1" aria-hidden="true" tabindex="-1"></a>β_1 <span class="op">=</span> np.linalg.lstsq(X_1,y,rcond<span class="op">=</span><span class="va">None</span>)[<span class="dv">0</span>]</span>
<span id="cb818-2"><a href="#cb818-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(β_1)</span>
<span id="cb818-3"><a href="#cb818-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb818-4"><a href="#cb818-4" aria-hidden="true" tabindex="-1"></a>plt.scatter(x,y,s<span class="op">=</span><span class="dv">5</span>,color<span class="op">=</span><span class="st">&#39;blue&#39;</span>)</span>
<span id="cb818-5"><a href="#cb818-5" aria-hidden="true" tabindex="-1"></a>plt.scatter(x,X_1<span class="op">@</span>β_1,s<span class="op">=</span><span class="dv">5</span>,color<span class="op">=</span><span class="st">&#39;red&#39;</span>)</span></code></pre></div>
</div>
<div id="polinomio-de-orden-2" class="section level4 hasAnchor" number="4.7.1.3">
<h4 class="hasAnchor"><span class="header-section-number">4.7.1.3</span> Polinomio de orden 2<a href="#polinomio-de-orden-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb819"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb819-1"><a href="#cb819-1" aria-hidden="true" tabindex="-1"></a>X_2 <span class="op">=</span> np.column_stack([np.ones_like(x),x,x<span class="op">**</span><span class="dv">2</span>])</span>
<span id="cb819-2"><a href="#cb819-2" aria-hidden="true" tabindex="-1"></a>X_2[<span class="dv">0</span>:<span class="dv">3</span>,:]</span>
<span id="cb819-3"><a href="#cb819-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb819-4"><a href="#cb819-4" aria-hidden="true" tabindex="-1"></a>β_2 <span class="op">=</span> np.linalg.lstsq(X_2,y,rcond<span class="op">=</span><span class="va">None</span>)[<span class="dv">0</span>]</span>
<span id="cb819-5"><a href="#cb819-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(β_2)</span>
<span id="cb819-6"><a href="#cb819-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb819-7"><a href="#cb819-7" aria-hidden="true" tabindex="-1"></a>plt.scatter(x,y,s<span class="op">=</span><span class="dv">5</span>,color<span class="op">=</span><span class="st">&#39;blue&#39;</span>)</span>
<span id="cb819-8"><a href="#cb819-8" aria-hidden="true" tabindex="-1"></a>plt.scatter(x,X_2<span class="op">@</span>β_2,s<span class="op">=</span><span class="dv">5</span>,color<span class="op">=</span><span class="st">&#39;black&#39;</span>)</span>
<span id="cb819-9"><a href="#cb819-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb819-10"><a href="#cb819-10" aria-hidden="true" tabindex="-1"></a>K <span class="op">=</span><span class="dv">10</span></span>
<span id="cb819-11"><a href="#cb819-11" aria-hidden="true" tabindex="-1"></a>X_K <span class="op">=</span> np.column_stack([x<span class="op">**</span>k <span class="cf">for</span> k <span class="kw">in</span> <span class="bu">range</span>(K<span class="op">+</span><span class="dv">1</span>)])</span>
<span id="cb819-12"><a href="#cb819-12" aria-hidden="true" tabindex="-1"></a><span class="co">#X_K[0:3,:]</span></span>
<span id="cb819-13"><a href="#cb819-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb819-14"><a href="#cb819-14" aria-hidden="true" tabindex="-1"></a>β_K <span class="op">=</span> np.linalg.lstsq(X_K,y,rcond<span class="op">=</span><span class="va">None</span>)[<span class="dv">0</span>]</span>
<span id="cb819-15"><a href="#cb819-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(β_K)</span>
<span id="cb819-16"><a href="#cb819-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb819-17"><a href="#cb819-17" aria-hidden="true" tabindex="-1"></a>plt.scatter(x,y,s<span class="op">=</span><span class="dv">5</span>,color<span class="op">=</span><span class="st">&#39;blue&#39;</span>)</span>
<span id="cb819-18"><a href="#cb819-18" aria-hidden="true" tabindex="-1"></a>plt.scatter(x,X_K<span class="op">@</span>β_K,s<span class="op">=</span><span class="dv">5</span>,color<span class="op">=</span><span class="st">&#39;orange&#39;</span>)</span>
<span id="cb819-19"><a href="#cb819-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb819-20"><a href="#cb819-20" aria-hidden="true" tabindex="-1"></a>ECM_1 <span class="op">=</span> np.mean((y<span class="op">-</span>X_1<span class="op">@</span>β_1)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb819-21"><a href="#cb819-21" aria-hidden="true" tabindex="-1"></a>ECM_2 <span class="op">=</span> np.mean((y<span class="op">-</span>X_2<span class="op">@</span>β_2)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb819-22"><a href="#cb819-22" aria-hidden="true" tabindex="-1"></a>ECM_K <span class="op">=</span> np.mean((y<span class="op">-</span>X_K<span class="op">@</span>β_K)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb819-23"><a href="#cb819-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ECM_1,ECM_2,ECM_K)</span></code></pre></div>
</div>
</div>
<div id="modelo-de-regresión-lineal" class="section level3 hasAnchor" number="4.7.2">
<h3 class="hasAnchor"><span class="header-section-number">4.7.2</span> Modelo de regresión lineal<a href="#modelo-de-regresión-lineal" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="introducción-2" class="section level4 hasAnchor" number="4.7.2.1">
<h4 class="hasAnchor"><span class="header-section-number">4.7.2.1</span> Introducción<a href="#introducción-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb820"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb820-1"><a href="#cb820-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb820-2"><a href="#cb820-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb820-3"><a href="#cb820-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb820-4"><a href="#cb820-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib</span>
<span id="cb820-5"><a href="#cb820-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb820-6"><a href="#cb820-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.stats <span class="im">as</span> stats</span>
<span id="cb820-7"><a href="#cb820-7" aria-hidden="true" tabindex="-1"></a>matplotlib.style.use(<span class="st">&#39;ggplot&#39;</span>)</span>
<span id="cb820-8"><a href="#cb820-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb820-9"><a href="#cb820-9" aria-hidden="true" tabindex="-1"></a>mtcars.head()</span>
<span id="cb820-10"><a href="#cb820-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb820-11"><a href="#cb820-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Load mtcars data set</span></span>
<span id="cb820-12"><a href="#cb820-12" aria-hidden="true" tabindex="-1"></a>mtcars <span class="op">=</span> pd.read_csv(<span class="st">&quot;mtcars.csv&quot;</span>)</span>
<span id="cb820-13"><a href="#cb820-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb820-14"><a href="#cb820-14" aria-hidden="true" tabindex="-1"></a>mtcars.plot(kind<span class="op">=</span><span class="st">&quot;scatter&quot;</span>,</span>
<span id="cb820-15"><a href="#cb820-15" aria-hidden="true" tabindex="-1"></a>           x<span class="op">=</span><span class="st">&quot;wt&quot;</span>,</span>
<span id="cb820-16"><a href="#cb820-16" aria-hidden="true" tabindex="-1"></a>           y<span class="op">=</span><span class="st">&quot;mpg&quot;</span>,</span>
<span id="cb820-17"><a href="#cb820-17" aria-hidden="true" tabindex="-1"></a>           figsize<span class="op">=</span>(<span class="dv">9</span>,<span class="dv">9</span>),</span>
<span id="cb820-18"><a href="#cb820-18" aria-hidden="true" tabindex="-1"></a>           color<span class="op">=</span><span class="st">&quot;black&quot;</span>)<span class="op">;</span></span></code></pre></div>
<ul>
<li>La biblioteca scikit-learn de Python contiene una amplia gama de funciones para el modelado predictivo. Vamos a cargar su función de entrenamiento de regresión lineal y a ajustar una línea a los datos de mtcars:</li>
</ul>
<div class="sourceCode" id="cb821"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb821-1"><a href="#cb821-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> linear_model</span>
<span id="cb821-2"><a href="#cb821-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb821-3"><a href="#cb821-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Modelo inicial</span></span>
<span id="cb821-4"><a href="#cb821-4" aria-hidden="true" tabindex="-1"></a>regression_model <span class="op">=</span> linear_model.LinearRegression()</span>
<span id="cb821-5"><a href="#cb821-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb821-6"><a href="#cb821-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Entrenar al modelo</span></span>
<span id="cb821-7"><a href="#cb821-7" aria-hidden="true" tabindex="-1"></a>regression_model.fit(X <span class="op">=</span> pd.DataFrame(mtcars[<span class="st">&quot;wt&quot;</span>]), </span>
<span id="cb821-8"><a href="#cb821-8" aria-hidden="true" tabindex="-1"></a>                     y <span class="op">=</span> mtcars[<span class="st">&quot;mpg&quot;</span>])</span>
<span id="cb821-9"><a href="#cb821-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb821-10"><a href="#cb821-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Chequear coeficientes</span></span>
<span id="cb821-11"><a href="#cb821-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(regression_model.intercept_)</span>
<span id="cb821-12"><a href="#cb821-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb821-13"><a href="#cb821-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(regression_model.coef_)</span></code></pre></div>
<p>Podemos tener una idea de la parte de la varianza de la variable de respuesta que explica el modelo utilizando la función model.score():</p>
<div class="sourceCode" id="cb822"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb822-1"><a href="#cb822-1" aria-hidden="true" tabindex="-1"></a>regression_model.score(X <span class="op">=</span> pd.DataFrame(mtcars[<span class="st">&quot;wt&quot;</span>]), </span>
<span id="cb822-2"><a href="#cb822-2" aria-hidden="true" tabindex="-1"></a>                       y <span class="op">=</span> mtcars[<span class="st">&quot;mpg&quot;</span>])</span></code></pre></div>
<ul>
<li><p>El resultado de la función de puntuación para la regresión lineal es el “R-cuadrado”, un valor que va de 0 a 1 y que describe la proporción de la varianza de la variable de respuesta que explica el modelo. En este caso, el peso del coche explica aproximadamente el 75% de la varianza en mpg.</p></li>
<li><p>La medida R-cuadrado se basa en los residuos: las diferencias entre lo que el modelo predice para cada punto de datos y el valor real de cada punto de datos. Podemos extraer los residuos del modelo haciendo una predicción con el modelo sobre los datos y luego restando el valor real de cada predicción:</p></li>
</ul>
<div class="sourceCode" id="cb823"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb823-1"><a href="#cb823-1" aria-hidden="true" tabindex="-1"></a>train_prediction <span class="op">=</span> regression_model.predict(X <span class="op">=</span> pd.DataFrame(mtcars[<span class="st">&quot;wt&quot;</span>]))</span>
<span id="cb823-2"><a href="#cb823-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb823-3"><a href="#cb823-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Actual - prediction = residuals</span></span>
<span id="cb823-4"><a href="#cb823-4" aria-hidden="true" tabindex="-1"></a>residuals <span class="op">=</span> mtcars[<span class="st">&quot;mpg&quot;</span>] <span class="op">-</span> train_prediction</span>
<span id="cb823-5"><a href="#cb823-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb823-6"><a href="#cb823-6" aria-hidden="true" tabindex="-1"></a>residuals.describe()</span>
<span id="cb823-7"><a href="#cb823-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb823-8"><a href="#cb823-8" aria-hidden="true" tabindex="-1"></a>SSResiduals <span class="op">=</span> (residuals<span class="op">**</span><span class="dv">2</span>).<span class="bu">sum</span>()</span>
<span id="cb823-9"><a href="#cb823-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb823-10"><a href="#cb823-10" aria-hidden="true" tabindex="-1"></a>SSTotal <span class="op">=</span> ((mtcars[<span class="st">&quot;mpg&quot;</span>] <span class="op">-</span> mtcars[<span class="st">&quot;mpg&quot;</span>].mean())<span class="op">**</span><span class="dv">2</span>).<span class="bu">sum</span>()</span>
<span id="cb823-11"><a href="#cb823-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb823-12"><a href="#cb823-12" aria-hidden="true" tabindex="-1"></a><span class="co"># R-squared</span></span>
<span id="cb823-13"><a href="#cb823-13" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="op">-</span> (SSResiduals<span class="op">/</span>SSTotal)</span></code></pre></div>
<p>Ahora que tenemos un modelo lineal, vamos a trazar la línea a la que se ajusta en nuestro gráfico de dispersión para tener una idea de lo bien que se ajusta a los datos:</p>
<div class="sourceCode" id="cb824"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb824-1"><a href="#cb824-1" aria-hidden="true" tabindex="-1"></a>mtcars.plot(kind<span class="op">=</span><span class="st">&quot;scatter&quot;</span>,</span>
<span id="cb824-2"><a href="#cb824-2" aria-hidden="true" tabindex="-1"></a>           x<span class="op">=</span><span class="st">&quot;wt&quot;</span>,</span>
<span id="cb824-3"><a href="#cb824-3" aria-hidden="true" tabindex="-1"></a>           y<span class="op">=</span><span class="st">&quot;mpg&quot;</span>,</span>
<span id="cb824-4"><a href="#cb824-4" aria-hidden="true" tabindex="-1"></a>           figsize<span class="op">=</span>(<span class="dv">9</span>,<span class="dv">9</span>),</span>
<span id="cb824-5"><a href="#cb824-5" aria-hidden="true" tabindex="-1"></a>           color<span class="op">=</span><span class="st">&quot;black&quot;</span>,</span>
<span id="cb824-6"><a href="#cb824-6" aria-hidden="true" tabindex="-1"></a>           xlim <span class="op">=</span> (<span class="dv">0</span>,<span class="dv">7</span>))</span>
<span id="cb824-7"><a href="#cb824-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb824-8"><a href="#cb824-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Graficamos</span></span>
<span id="cb824-9"><a href="#cb824-9" aria-hidden="true" tabindex="-1"></a>plt.plot(mtcars[<span class="st">&quot;wt&quot;</span>],      <span class="co"># Variables explicativas</span></span>
<span id="cb824-10"><a href="#cb824-10" aria-hidden="true" tabindex="-1"></a>         train_prediction,  <span class="co"># Variables predichas</span></span>
<span id="cb824-11"><a href="#cb824-11" aria-hidden="true" tabindex="-1"></a>         color<span class="op">=</span><span class="st">&quot;blue&quot;</span>)<span class="op">;</span></span></code></pre></div>
<p>La línea de regresión parece un ajuste razonable y se ajusta a nuestra intuición: a medida que aumenta el peso del coche, cabe esperar que el consumo de combustible disminuya.</p>
<p>Los valores atípicos pueden tener una gran influencia en los modelos de regresión lineal: como la regresión consiste en minimizar los residuos al cuadrado, los residuos grandes tienen una influencia desproporcionada en el modelo. Trazar el resultado nos ayuda a detectar los valores atípicos influyentes. En este caso no parece haber ningún valor atípico influyente. Añadamos un valor atípico -un coche superpesado de bajo consumo- y tracemos un nuevo modelo de regresión:</p>
<div class="sourceCode" id="cb825"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb825-1"><a href="#cb825-1" aria-hidden="true" tabindex="-1"></a>mtcars_subset <span class="op">=</span> mtcars[[<span class="st">&quot;mpg&quot;</span>,<span class="st">&quot;wt&quot;</span>]]</span>
<span id="cb825-2"><a href="#cb825-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb825-3"><a href="#cb825-3" aria-hidden="true" tabindex="-1"></a>super_car <span class="op">=</span> pd.DataFrame({<span class="st">&quot;mpg&quot;</span>:<span class="dv">50</span>,<span class="st">&quot;wt&quot;</span>:<span class="dv">10</span>}, index<span class="op">=</span>[<span class="st">&quot;super&quot;</span>])</span>
<span id="cb825-4"><a href="#cb825-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb825-5"><a href="#cb825-5" aria-hidden="true" tabindex="-1"></a>new_cars <span class="op">=</span> mtcars_subset.append(super_car)</span>
<span id="cb825-6"><a href="#cb825-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb825-7"><a href="#cb825-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize model</span></span>
<span id="cb825-8"><a href="#cb825-8" aria-hidden="true" tabindex="-1"></a>regression_model <span class="op">=</span> linear_model.LinearRegression()</span>
<span id="cb825-9"><a href="#cb825-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb825-10"><a href="#cb825-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the model using the new_cars data</span></span>
<span id="cb825-11"><a href="#cb825-11" aria-hidden="true" tabindex="-1"></a>regression_model.fit(X <span class="op">=</span> pd.DataFrame(new_cars[<span class="st">&quot;wt&quot;</span>]), </span>
<span id="cb825-12"><a href="#cb825-12" aria-hidden="true" tabindex="-1"></a>                     y <span class="op">=</span> new_cars[<span class="st">&quot;mpg&quot;</span>])</span>
<span id="cb825-13"><a href="#cb825-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb825-14"><a href="#cb825-14" aria-hidden="true" tabindex="-1"></a>train_prediction2 <span class="op">=</span> regression_model.predict(X <span class="op">=</span> pd.DataFrame(new_cars[<span class="st">&quot;wt&quot;</span>]))</span>
<span id="cb825-15"><a href="#cb825-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb825-16"><a href="#cb825-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the new model</span></span>
<span id="cb825-17"><a href="#cb825-17" aria-hidden="true" tabindex="-1"></a>new_cars.plot(kind<span class="op">=</span><span class="st">&quot;scatter&quot;</span>,</span>
<span id="cb825-18"><a href="#cb825-18" aria-hidden="true" tabindex="-1"></a>           x<span class="op">=</span><span class="st">&quot;wt&quot;</span>,</span>
<span id="cb825-19"><a href="#cb825-19" aria-hidden="true" tabindex="-1"></a>           y<span class="op">=</span><span class="st">&quot;mpg&quot;</span>,</span>
<span id="cb825-20"><a href="#cb825-20" aria-hidden="true" tabindex="-1"></a>           figsize<span class="op">=</span>(<span class="dv">9</span>,<span class="dv">9</span>),</span>
<span id="cb825-21"><a href="#cb825-21" aria-hidden="true" tabindex="-1"></a>           color<span class="op">=</span><span class="st">&quot;black&quot;</span>, xlim<span class="op">=</span>(<span class="dv">1</span>,<span class="dv">11</span>), ylim<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">52</span>))</span>
<span id="cb825-22"><a href="#cb825-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb825-23"><a href="#cb825-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot regression line</span></span>
<span id="cb825-24"><a href="#cb825-24" aria-hidden="true" tabindex="-1"></a>plt.plot(new_cars[<span class="st">&quot;wt&quot;</span>],     <span class="co"># Explanatory variable</span></span>
<span id="cb825-25"><a href="#cb825-25" aria-hidden="true" tabindex="-1"></a>         train_prediction2,  <span class="co"># Predicted values</span></span>
<span id="cb825-26"><a href="#cb825-26" aria-hidden="true" tabindex="-1"></a>         color<span class="op">=</span><span class="st">&quot;blue&quot;</span>)<span class="op">;</span></span></code></pre></div>
<ul>
<li><p>Aunque se trata de un caso extremo y artificial, el gráfico anterior ilustra la influencia que puede tener un solo valor atípico en un modelo de regresión lineal.</p></li>
<li><p>En un modelo de regresión lineal que se comporte bien, nos gustaría que los residuos se distribuyeran de forma aproximadamente normal. Es decir, nos gustaría que el error se distribuyera de forma más o menos uniforme por encima y por debajo de la línea de regresión.</p></li>
<li><p>Podemos investigar la normalidad de los residuos con un gráfico Q-Q (cuantil-cuantil). Haga un qqplot pasando los residuos a la función stats.probplot() en la biblioteca scipy.stats:</p></li>
</ul>
<div class="sourceCode" id="cb826"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb826-1"><a href="#cb826-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">9</span>,<span class="dv">9</span>))</span>
<span id="cb826-2"><a href="#cb826-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb826-3"><a href="#cb826-3" aria-hidden="true" tabindex="-1"></a>stats.probplot(residuals, dist<span class="op">=</span><span class="st">&quot;norm&quot;</span>, plot<span class="op">=</span>plt)<span class="op">;</span></span></code></pre></div>
<ul>
<li><p>Cuando los residuos se distribuyen normalmente, tienden a situarse a lo largo de la línea recta en el gráfico Q-Q. En este caso, los residuos parecen seguir un patrón ligeramente no lineal: los residuos se inclinan un poco lejos de la línea de normalidad en cada extremo. Esto es una indicación de que una simple línea recta podría no ser suficiente para describir completamente la relación entre el peso y el mpg.</p></li>
<li><p>Después de hacer las predicciones del modelo, es útil tener algún tipo de métrica para evaluar lo bien que funcionó el modelo. El R-cuadrado ajustado es una medida útil, pero sólo se aplica al modelo de regresión en sí: nos gustaría tener alguna métrica de evaluación universal que nos permita comparar el rendimiento de diferentes tipos de modelos.</p></li>
<li><p>El error medio cuadrático (RMSE) es una métrica de evaluación común para las predicciones con números reales. El error medio cuadrático es la raíz cuadrada de la media del error cuadrático (residuos). Si recuerda, escribimos una función para calcular el RMSE en la lección 12:</p></li>
</ul>
<div class="sourceCode" id="cb827"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb827-1"><a href="#cb827-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rmse(predicted, targets):</span>
<span id="cb827-2"><a href="#cb827-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb827-3"><a href="#cb827-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Computes root mean squared error of two numpy ndarrays</span></span>
<span id="cb827-4"><a href="#cb827-4" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb827-5"><a href="#cb827-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb827-6"><a href="#cb827-6" aria-hidden="true" tabindex="-1"></a><span class="co">        predicted: an ndarray of predictions</span></span>
<span id="cb827-7"><a href="#cb827-7" aria-hidden="true" tabindex="-1"></a><span class="co">        targets: an ndarray of target values</span></span>
<span id="cb827-8"><a href="#cb827-8" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb827-9"><a href="#cb827-9" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb827-10"><a href="#cb827-10" aria-hidden="true" tabindex="-1"></a><span class="co">        The root mean squared error as a float</span></span>
<span id="cb827-11"><a href="#cb827-11" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb827-12"><a href="#cb827-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (np.sqrt(np.mean((targets<span class="op">-</span>predicted)<span class="op">**</span><span class="dv">2</span>)))</span>
<span id="cb827-13"><a href="#cb827-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb827-14"><a href="#cb827-14" aria-hidden="true" tabindex="-1"></a>rmse(train_prediction2, new_cars[<span class="st">&quot;mpg&quot;</span>])</span>
<span id="cb827-15"><a href="#cb827-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb827-16"><a href="#cb827-16" aria-hidden="true" tabindex="-1"></a>rmse(train_prediction, mtcars[<span class="st">&quot;mpg&quot;</span>])</span>
<span id="cb827-17"><a href="#cb827-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb827-18"><a href="#cb827-18" aria-hidden="true" tabindex="-1"></a>rmse(train_prediction2, new_cars[<span class="st">&quot;mpg&quot;</span>])</span></code></pre></div>
<p>En lugar de definir su propia función RMSE, puede utilizar la función de error cuadrático medio de la biblioteca scikit-learn y tomar la raíz cuadrada del resultado:</p>
<div class="sourceCode" id="cb828"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb828-1"><a href="#cb828-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error</span>
<span id="cb828-2"><a href="#cb828-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb828-3"><a href="#cb828-3" aria-hidden="true" tabindex="-1"></a>RMSE <span class="op">=</span> mean_squared_error(train_prediction, mtcars[<span class="st">&quot;mpg&quot;</span>])<span class="op">**</span><span class="fl">0.5</span></span>
<span id="cb828-4"><a href="#cb828-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb828-5"><a href="#cb828-5" aria-hidden="true" tabindex="-1"></a>RMSE</span></code></pre></div>
</div>
<div id="agregando-polinomios" class="section level4 hasAnchor" number="4.7.2.2">
<h4 class="hasAnchor"><span class="header-section-number">4.7.2.2</span> Agregando polinomios<a href="#agregando-polinomios" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb829"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb829-1"><a href="#cb829-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Iniciamos el modelo</span></span>
<span id="cb829-2"><a href="#cb829-2" aria-hidden="true" tabindex="-1"></a>poly_model <span class="op">=</span> linear_model.LinearRegression()</span>
<span id="cb829-3"><a href="#cb829-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb829-4"><a href="#cb829-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Data frmame</span></span>
<span id="cb829-5"><a href="#cb829-5" aria-hidden="true" tabindex="-1"></a>predictors <span class="op">=</span> pd.DataFrame([mtcars[<span class="st">&quot;wt&quot;</span>],           <span class="co"># Include weight</span></span>
<span id="cb829-6"><a href="#cb829-6" aria-hidden="true" tabindex="-1"></a>                           mtcars[<span class="st">&quot;wt&quot;</span>]<span class="op">**</span><span class="dv">2</span>]).T     <span class="co"># Include weight squared</span></span>
<span id="cb829-7"><a href="#cb829-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb829-8"><a href="#cb829-8" aria-hidden="true" tabindex="-1"></a><span class="co"># &quot;Entrenar&quot; el modelo</span></span>
<span id="cb829-9"><a href="#cb829-9" aria-hidden="true" tabindex="-1"></a>poly_model.fit(X <span class="op">=</span> predictors, </span>
<span id="cb829-10"><a href="#cb829-10" aria-hidden="true" tabindex="-1"></a>               y <span class="op">=</span> mtcars[<span class="st">&quot;mpg&quot;</span>])</span>
<span id="cb829-11"><a href="#cb829-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb829-12"><a href="#cb829-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Chequear</span></span>
<span id="cb829-13"><a href="#cb829-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Model intercept&quot;</span>)</span>
<span id="cb829-14"><a href="#cb829-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(poly_model.intercept_)</span>
<span id="cb829-15"><a href="#cb829-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb829-16"><a href="#cb829-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Model Coefficients&quot;</span>)</span>
<span id="cb829-17"><a href="#cb829-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(poly_model.coef_)</span>
<span id="cb829-18"><a href="#cb829-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb829-19"><a href="#cb829-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb829-20"><a href="#cb829-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Model Accuracy:&quot;</span>)</span>
<span id="cb829-21"><a href="#cb829-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(poly_model.score(X <span class="op">=</span> predictors, </span>
<span id="cb829-22"><a href="#cb829-22" aria-hidden="true" tabindex="-1"></a>                 y <span class="op">=</span> mtcars[<span class="st">&quot;mpg&quot;</span>]))</span></code></pre></div>
<p>Vamos a trazar la línea curva definida por el nuevo modelo para ver si el ajuste es mejor que el anterior. Para empezar, vamos a crear una función que toma una matriz de valores x, coeficientes del modelo y un término de intercepción y devuelve los valores x y los valores y ajustados correspondientes a esos valores x.</p>
<div class="sourceCode" id="cb830"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb830-1"><a href="#cb830-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the curve from 1.5 to 5.5</span></span>
<span id="cb830-2"><a href="#cb830-2" aria-hidden="true" tabindex="-1"></a>poly_line_range <span class="op">=</span> np.arange(<span class="fl">1.5</span>, <span class="fl">5.5</span>, <span class="fl">0.1</span>)</span>
<span id="cb830-3"><a href="#cb830-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb830-4"><a href="#cb830-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get first and second order predictors from range</span></span>
<span id="cb830-5"><a href="#cb830-5" aria-hidden="true" tabindex="-1"></a>poly_predictors <span class="op">=</span> pd.DataFrame([poly_line_range,</span>
<span id="cb830-6"><a href="#cb830-6" aria-hidden="true" tabindex="-1"></a>                               poly_line_range<span class="op">**</span><span class="dv">2</span>]).T</span>
<span id="cb830-7"><a href="#cb830-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb830-8"><a href="#cb830-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Get corresponding y values from the model</span></span>
<span id="cb830-9"><a href="#cb830-9" aria-hidden="true" tabindex="-1"></a>y_values <span class="op">=</span> poly_model.predict(X <span class="op">=</span> poly_predictors)</span>
<span id="cb830-10"><a href="#cb830-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb830-11"><a href="#cb830-11" aria-hidden="true" tabindex="-1"></a>mtcars.plot(kind<span class="op">=</span><span class="st">&quot;scatter&quot;</span>,</span>
<span id="cb830-12"><a href="#cb830-12" aria-hidden="true" tabindex="-1"></a>           x<span class="op">=</span><span class="st">&quot;wt&quot;</span>,</span>
<span id="cb830-13"><a href="#cb830-13" aria-hidden="true" tabindex="-1"></a>           y<span class="op">=</span><span class="st">&quot;mpg&quot;</span>,</span>
<span id="cb830-14"><a href="#cb830-14" aria-hidden="true" tabindex="-1"></a>           figsize<span class="op">=</span>(<span class="dv">9</span>,<span class="dv">9</span>),</span>
<span id="cb830-15"><a href="#cb830-15" aria-hidden="true" tabindex="-1"></a>           color<span class="op">=</span><span class="st">&quot;black&quot;</span>,</span>
<span id="cb830-16"><a href="#cb830-16" aria-hidden="true" tabindex="-1"></a>           xlim <span class="op">=</span> (<span class="dv">0</span>,<span class="dv">7</span>))</span>
<span id="cb830-17"><a href="#cb830-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb830-18"><a href="#cb830-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot curve line</span></span>
<span id="cb830-19"><a href="#cb830-19" aria-hidden="true" tabindex="-1"></a>plt.plot(poly_line_range,   <span class="co"># X-axis range</span></span>
<span id="cb830-20"><a href="#cb830-20" aria-hidden="true" tabindex="-1"></a>         y_values,          <span class="co"># Predicted values</span></span>
<span id="cb830-21"><a href="#cb830-21" aria-hidden="true" tabindex="-1"></a>         color<span class="op">=</span><span class="st">&quot;blue&quot;</span>)<span class="op">;</span></span></code></pre></div>
<p>La función cuadrática parece ajustarse a los datos un poco mejor que la lineal. Investiguemos más a fondo utilizando el nuevo modelo para hacer predicciones sobre los datos originales y comprobemos el error medio cuadrático:</p>
<div class="sourceCode" id="cb831"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb831-1"><a href="#cb831-1" aria-hidden="true" tabindex="-1"></a>preds <span class="op">=</span> poly_model.predict(X<span class="op">=</span>predictors)</span>
<span id="cb831-2"><a href="#cb831-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb831-3"><a href="#cb831-3" aria-hidden="true" tabindex="-1"></a>rmse(preds , mtcars[<span class="st">&quot;mpg&quot;</span>])</span></code></pre></div>
<p>Como el RMSE del modelo cuadrático es menor que el anterior y el R-cuadrado ajustado es mayor, probablemente sea un modelo mejor. Sin embargo, tenemos que tener cuidado con el sobreajuste de los datos de entrenamiento (“overfitting”).</p>
<ul>
<li><p>La sobreadaptación describe una situación en la que nuestro modelo se ajusta demasiado a los datos que utilizamos para crearlo (datos de entrenamiento), lo que provoca una mala generalización a los nuevos datos.</p></li>
<li><p>Por eso, generalmente no queremos utilizar los datos de entrenamiento para evaluar un modelo: nos da una evaluación sesgada, normalmente demasiado optimista. Uno de los puntos fuertes de la regresión lineal de primer y segundo orden es que son tan simples que es poco probable que sobreajusten los datos. Cuanto más complejo sea el modelo que creemos y más libertad tenga para ajustarse a los datos de entrenamiento, mayor será el riesgo de sobreajuste.</p></li>
<li><p>Por ejemplo, podríamos seguir incluyendo más términos polinómicos en nuestro modelo de regresión para ajustarnos más a los datos de entrenamiento y conseguir puntuaciones de RMSE más bajas con respecto al conjunto de entrenamiento, pero es casi seguro que esto no se generalizaría bien a los nuevos datos. Ilustremos este punto ajustando un modelo de 10º orden a los datos de mtcars:</p></li>
</ul>
<div class="sourceCode" id="cb832"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb832-1"><a href="#cb832-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize model</span></span>
<span id="cb832-2"><a href="#cb832-2" aria-hidden="true" tabindex="-1"></a>poly_model <span class="op">=</span> linear_model.LinearRegression()</span>
<span id="cb832-3"><a href="#cb832-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb832-4"><a href="#cb832-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a DataFrame of predictor variables</span></span>
<span id="cb832-5"><a href="#cb832-5" aria-hidden="true" tabindex="-1"></a>predictors <span class="op">=</span> pd.DataFrame([mtcars[<span class="st">&quot;wt&quot;</span>],           </span>
<span id="cb832-6"><a href="#cb832-6" aria-hidden="true" tabindex="-1"></a>                           mtcars[<span class="st">&quot;wt&quot;</span>]<span class="op">**</span><span class="dv">2</span>,</span>
<span id="cb832-7"><a href="#cb832-7" aria-hidden="true" tabindex="-1"></a>                           mtcars[<span class="st">&quot;wt&quot;</span>]<span class="op">**</span><span class="dv">3</span>,</span>
<span id="cb832-8"><a href="#cb832-8" aria-hidden="true" tabindex="-1"></a>                           mtcars[<span class="st">&quot;wt&quot;</span>]<span class="op">**</span><span class="dv">4</span>,</span>
<span id="cb832-9"><a href="#cb832-9" aria-hidden="true" tabindex="-1"></a>                           mtcars[<span class="st">&quot;wt&quot;</span>]<span class="op">**</span><span class="dv">5</span>,</span>
<span id="cb832-10"><a href="#cb832-10" aria-hidden="true" tabindex="-1"></a>                           mtcars[<span class="st">&quot;wt&quot;</span>]<span class="op">**</span><span class="dv">6</span>,</span>
<span id="cb832-11"><a href="#cb832-11" aria-hidden="true" tabindex="-1"></a>                           mtcars[<span class="st">&quot;wt&quot;</span>]<span class="op">**</span><span class="dv">7</span>,</span>
<span id="cb832-12"><a href="#cb832-12" aria-hidden="true" tabindex="-1"></a>                           mtcars[<span class="st">&quot;wt&quot;</span>]<span class="op">**</span><span class="dv">8</span>,</span>
<span id="cb832-13"><a href="#cb832-13" aria-hidden="true" tabindex="-1"></a>                           mtcars[<span class="st">&quot;wt&quot;</span>]<span class="op">**</span><span class="dv">9</span>,</span>
<span id="cb832-14"><a href="#cb832-14" aria-hidden="true" tabindex="-1"></a>                           mtcars[<span class="st">&quot;wt&quot;</span>]<span class="op">**</span><span class="dv">10</span>]).T     </span>
<span id="cb832-15"><a href="#cb832-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb832-16"><a href="#cb832-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the model using the new_cars data</span></span>
<span id="cb832-17"><a href="#cb832-17" aria-hidden="true" tabindex="-1"></a>poly_model.fit(X <span class="op">=</span> predictors, </span>
<span id="cb832-18"><a href="#cb832-18" aria-hidden="true" tabindex="-1"></a>               y <span class="op">=</span> mtcars[<span class="st">&quot;mpg&quot;</span>])</span>
<span id="cb832-19"><a href="#cb832-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb832-20"><a href="#cb832-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Check trained model y-intercept</span></span>
<span id="cb832-21"><a href="#cb832-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Model intercept&quot;</span>)</span>
<span id="cb832-22"><a href="#cb832-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(poly_model.intercept_)</span>
<span id="cb832-23"><a href="#cb832-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb832-24"><a href="#cb832-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Check trained model coefficients (scaling factor given to &quot;wt&quot;)</span></span>
<span id="cb832-25"><a href="#cb832-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Model Coefficients&quot;</span>)</span>
<span id="cb832-26"><a href="#cb832-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(poly_model.coef_)</span>
<span id="cb832-27"><a href="#cb832-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb832-28"><a href="#cb832-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Check R-squared</span></span>
<span id="cb832-29"><a href="#cb832-29" aria-hidden="true" tabindex="-1"></a>poly_model.score(X <span class="op">=</span> predictors, </span>
<span id="cb832-30"><a href="#cb832-30" aria-hidden="true" tabindex="-1"></a>                 y <span class="op">=</span> mtcars[<span class="st">&quot;mpg&quot;</span>])</span></code></pre></div>
<ul>
<li>Obsérvese que la puntuación R-cuadrado ha aumentado sustancialmente con respecto a nuestro modelo cuadrático. Vamos a trazar la línea de mejor ajuste para investigar lo que hace el modelo:</li>
</ul>
<div class="sourceCode" id="cb833"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb833-1"><a href="#cb833-1" aria-hidden="true" tabindex="-1"></a>p_range <span class="op">=</span> np.arange(<span class="fl">1.5</span>, <span class="fl">5.45</span>, <span class="fl">0.01</span>)</span>
<span id="cb833-2"><a href="#cb833-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb833-3"><a href="#cb833-3" aria-hidden="true" tabindex="-1"></a>poly_predictors <span class="op">=</span> pd.DataFrame([p_range, p_range<span class="op">**</span><span class="dv">2</span>, p_range<span class="op">**</span><span class="dv">3</span>,</span>
<span id="cb833-4"><a href="#cb833-4" aria-hidden="true" tabindex="-1"></a>                              p_range<span class="op">**</span><span class="dv">4</span>, p_range<span class="op">**</span><span class="dv">5</span>, p_range<span class="op">**</span><span class="dv">6</span>, p_range<span class="op">**</span><span class="dv">7</span>, </span>
<span id="cb833-5"><a href="#cb833-5" aria-hidden="true" tabindex="-1"></a>                              p_range<span class="op">**</span><span class="dv">8</span>, p_range<span class="op">**</span><span class="dv">9</span>, p_range<span class="op">**</span><span class="dv">10</span>]).T  </span>
<span id="cb833-6"><a href="#cb833-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb833-7"><a href="#cb833-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Get corresponding y values from the model</span></span>
<span id="cb833-8"><a href="#cb833-8" aria-hidden="true" tabindex="-1"></a>y_values <span class="op">=</span> poly_model.predict(X <span class="op">=</span> poly_predictors)</span>
<span id="cb833-9"><a href="#cb833-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb833-10"><a href="#cb833-10" aria-hidden="true" tabindex="-1"></a>mtcars.plot(kind<span class="op">=</span><span class="st">&quot;scatter&quot;</span>,</span>
<span id="cb833-11"><a href="#cb833-11" aria-hidden="true" tabindex="-1"></a>           x<span class="op">=</span><span class="st">&quot;wt&quot;</span>,</span>
<span id="cb833-12"><a href="#cb833-12" aria-hidden="true" tabindex="-1"></a>           y<span class="op">=</span><span class="st">&quot;mpg&quot;</span>,</span>
<span id="cb833-13"><a href="#cb833-13" aria-hidden="true" tabindex="-1"></a>           figsize<span class="op">=</span>(<span class="dv">9</span>,<span class="dv">9</span>),</span>
<span id="cb833-14"><a href="#cb833-14" aria-hidden="true" tabindex="-1"></a>           color<span class="op">=</span><span class="st">&quot;black&quot;</span>,</span>
<span id="cb833-15"><a href="#cb833-15" aria-hidden="true" tabindex="-1"></a>           xlim <span class="op">=</span> (<span class="dv">0</span>,<span class="dv">7</span>))</span>
<span id="cb833-16"><a href="#cb833-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb833-17"><a href="#cb833-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot curve line</span></span>
<span id="cb833-18"><a href="#cb833-18" aria-hidden="true" tabindex="-1"></a>plt.plot(p_range,   <span class="co"># X-axis range</span></span>
<span id="cb833-19"><a href="#cb833-19" aria-hidden="true" tabindex="-1"></a>         y_values,          <span class="co"># Predicted values</span></span>
<span id="cb833-20"><a href="#cb833-20" aria-hidden="true" tabindex="-1"></a>         color<span class="op">=</span><span class="st">&quot;blue&quot;</span>)<span class="op">;</span></span></code></pre></div>
<p>Observe cómo el modelo polinómico de 10º orden se curva de forma salvaje en algunos lugares para ajustarse a los datos de entrenamiento. Aunque este modelo se ajusta mejor a los datos de entrenamiento, es casi seguro que no se generalizará bien a los nuevos datos, ya que conduce a predicciones absurdas, como que un coche tiene menos de 0 mpg si pesa 5.000 libras.</p>
</div>
<div id="agregar-más-variables" class="section level4 hasAnchor" number="4.7.2.3">
<h4 class="hasAnchor"><span class="header-section-number">4.7.2.3</span> Agregar más variables<a href="#agregar-más-variables" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Cuando se enfrenta a una tarea de modelado predictivo, a menudo tendrá varias variables en sus datos que pueden ayudar a explicar la variación en la variable de respuesta. Puede incluir más variables explicativas en un modelo de regresión lineal incluyendo más columnas en el marco de datos que pasa a la función de entrenamiento del modelo. Hagamos un nuevo modelo que añada la variable de potencia a nuestro modelo original:.</p>
<div class="sourceCode" id="cb834"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb834-1"><a href="#cb834-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize model</span></span>
<span id="cb834-2"><a href="#cb834-2" aria-hidden="true" tabindex="-1"></a>multi_reg_model <span class="op">=</span> linear_model.LinearRegression()</span>
<span id="cb834-3"><a href="#cb834-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb834-4"><a href="#cb834-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the model using the mtcars data</span></span>
<span id="cb834-5"><a href="#cb834-5" aria-hidden="true" tabindex="-1"></a>multi_reg_model.fit(X <span class="op">=</span> mtcars.loc[:,[<span class="st">&quot;wt&quot;</span>,<span class="st">&quot;hp&quot;</span>]], </span>
<span id="cb834-6"><a href="#cb834-6" aria-hidden="true" tabindex="-1"></a>                     y <span class="op">=</span> mtcars[<span class="st">&quot;mpg&quot;</span>])</span>
<span id="cb834-7"><a href="#cb834-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb834-8"><a href="#cb834-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Check trained model y-intercept</span></span>
<span id="cb834-9"><a href="#cb834-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(multi_reg_model.intercept_)</span>
<span id="cb834-10"><a href="#cb834-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb834-11"><a href="#cb834-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Check trained model coefficients (scaling factor given to &quot;wt&quot;)</span></span>
<span id="cb834-12"><a href="#cb834-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(multi_reg_model.coef_)</span>
<span id="cb834-13"><a href="#cb834-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb834-14"><a href="#cb834-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Check R-squared</span></span>
<span id="cb834-15"><a href="#cb834-15" aria-hidden="true" tabindex="-1"></a>multi_reg_model.score(X <span class="op">=</span> mtcars.loc[:,[<span class="st">&quot;wt&quot;</span>,<span class="st">&quot;hp&quot;</span>]], </span>
<span id="cb834-16"><a href="#cb834-16" aria-hidden="true" tabindex="-1"></a>                      y <span class="op">=</span> mtcars[<span class="st">&quot;mpg&quot;</span>])</span></code></pre></div>
<p>La mejora de la puntuación R-cuadrado sugiere que la potencia tiene una relación lineal con el mpg. Vamos a investigar con un gráfico:</p>
<div class="sourceCode" id="cb835"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb835-1"><a href="#cb835-1" aria-hidden="true" tabindex="-1"></a>mtcars.plot(kind<span class="op">=</span><span class="st">&quot;scatter&quot;</span>,</span>
<span id="cb835-2"><a href="#cb835-2" aria-hidden="true" tabindex="-1"></a>           x<span class="op">=</span><span class="st">&quot;hp&quot;</span>,</span>
<span id="cb835-3"><a href="#cb835-3" aria-hidden="true" tabindex="-1"></a>           y<span class="op">=</span><span class="st">&quot;mpg&quot;</span>,</span>
<span id="cb835-4"><a href="#cb835-4" aria-hidden="true" tabindex="-1"></a>           figsize<span class="op">=</span>(<span class="dv">9</span>,<span class="dv">9</span>),</span>
<span id="cb835-5"><a href="#cb835-5" aria-hidden="true" tabindex="-1"></a>           color<span class="op">=</span><span class="st">&quot;black&quot;</span>)<span class="op">;</span></span></code></pre></div>
<p>Aunque las millas por galón tienden a disminuir con los caballos, la relación parece más curvada que lineal, por lo que añadir términos polinómicos a nuestro modelo de regresión múltiple podría producir un mejor ajuste:</p>
<div class="sourceCode" id="cb836"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb836-1"><a href="#cb836-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize model</span></span>
<span id="cb836-2"><a href="#cb836-2" aria-hidden="true" tabindex="-1"></a>multi_reg_model <span class="op">=</span> linear_model.LinearRegression()</span>
<span id="cb836-3"><a href="#cb836-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb836-4"><a href="#cb836-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Include squared terms</span></span>
<span id="cb836-5"><a href="#cb836-5" aria-hidden="true" tabindex="-1"></a>poly_predictors <span class="op">=</span> pd.DataFrame([mtcars[<span class="st">&quot;wt&quot;</span>],</span>
<span id="cb836-6"><a href="#cb836-6" aria-hidden="true" tabindex="-1"></a>                                mtcars[<span class="st">&quot;hp&quot;</span>],</span>
<span id="cb836-7"><a href="#cb836-7" aria-hidden="true" tabindex="-1"></a>                                mtcars[<span class="st">&quot;wt&quot;</span>]<span class="op">**</span><span class="dv">2</span>,</span>
<span id="cb836-8"><a href="#cb836-8" aria-hidden="true" tabindex="-1"></a>                                mtcars[<span class="st">&quot;hp&quot;</span>]<span class="op">**</span><span class="dv">2</span>]).T</span>
<span id="cb836-9"><a href="#cb836-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb836-10"><a href="#cb836-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the model using the mtcars data</span></span>
<span id="cb836-11"><a href="#cb836-11" aria-hidden="true" tabindex="-1"></a>multi_reg_model.fit(X <span class="op">=</span> poly_predictors, </span>
<span id="cb836-12"><a href="#cb836-12" aria-hidden="true" tabindex="-1"></a>                    y <span class="op">=</span> mtcars[<span class="st">&quot;mpg&quot;</span>])</span>
<span id="cb836-13"><a href="#cb836-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb836-14"><a href="#cb836-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Check R-squared</span></span>
<span id="cb836-15"><a href="#cb836-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;R-Squared&quot;</span>)</span>
<span id="cb836-16"><a href="#cb836-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( multi_reg_model.score(X <span class="op">=</span> poly_predictors , </span>
<span id="cb836-17"><a href="#cb836-17" aria-hidden="true" tabindex="-1"></a>                      y <span class="op">=</span> mtcars[<span class="st">&quot;mpg&quot;</span>]) )</span>
<span id="cb836-18"><a href="#cb836-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb836-19"><a href="#cb836-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Check RMSE</span></span>
<span id="cb836-20"><a href="#cb836-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;RMSE&quot;</span>)</span>
<span id="cb836-21"><a href="#cb836-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rmse(multi_reg_model.predict(poly_predictors),mtcars[<span class="st">&quot;mpg&quot;</span>]))</span></code></pre></div>
<p>El nuevo R-cuadrado y el menor RMSE sugieren que éste es un modelo mejor que cualquiera de los que hicimos anteriormente y no nos preocuparía demasiado el sobreajuste, ya que sólo incluye 2 variables y 2 términos al cuadrado. Hay que tener en cuenta que cuando se trabaja con modelos multidimensionales, resulta difícil visualizar los resultados, por lo que se depende en gran medida de los resultados numéricos.</p>
<p>Podríamos seguir añadiendo más variables explicativas para intentar mejorar el modelo. Añadir variables que tienen poca relación con la respuesta o incluir variables demasiado relacionadas entre sí puede perjudicar los resultados cuando se utiliza la regresión lineal. También debe tener cuidado con las variables numéricas que toman pocos valores únicos, ya que pueden actuar más como variables categóricas que numéricas.</p>
</div>
<div id="desde-una-perspectiva-económetrica" class="section level4 hasAnchor" number="4.7.2.4">
<h4 class="hasAnchor"><span class="header-section-number">4.7.2.4</span> Desde una perspectiva económetrica<a href="#desde-una-perspectiva-económetrica" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb837"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb837-1"><a href="#cb837-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb837-2"><a href="#cb837-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.formula.api <span class="im">as</span> smf</span>
<span id="cb837-3"><a href="#cb837-3" aria-hidden="true" tabindex="-1"></a><span class="co">#import plotnine as p</span></span>
<span id="cb837-4"><a href="#cb837-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb837-5"><a href="#cb837-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ssl</span>
<span id="cb837-6"><a href="#cb837-6" aria-hidden="true" tabindex="-1"></a>ssl._create_default_https_context <span class="op">=</span> ssl._create_unverified_context</span>
<span id="cb837-7"><a href="#cb837-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb837-8"><a href="#cb837-8" aria-hidden="true" tabindex="-1"></a><span class="co"># read data</span></span>
<span id="cb837-9"><a href="#cb837-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> read_data(<span class="bu">file</span>):</span>
<span id="cb837-10"><a href="#cb837-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.read_csv(<span class="st">&quot;https://raw.github.com/scunning1975/mixtape/master/&quot;</span> <span class="op">+</span> <span class="bu">file</span>)</span>
<span id="cb837-11"><a href="#cb837-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb837-12"><a href="#cb837-12" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">1</span>)</span>
<span id="cb837-13"><a href="#cb837-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb837-14"><a href="#cb837-14" aria-hidden="true" tabindex="-1"></a>tb <span class="op">=</span> pd.DataFrame({</span>
<span id="cb837-15"><a href="#cb837-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;x&#39;</span>: np.random.normal(size<span class="op">=</span><span class="dv">10000</span>),</span>
<span id="cb837-16"><a href="#cb837-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;u&#39;</span>: np.random.normal(size<span class="op">=</span><span class="dv">10000</span>)})</span>
<span id="cb837-17"><a href="#cb837-17" aria-hidden="true" tabindex="-1"></a>tb[<span class="st">&#39;y&#39;</span>] <span class="op">=</span> <span class="fl">5.5</span><span class="op">*</span>tb[<span class="st">&#39;x&#39;</span>].values <span class="op">+</span> <span class="dv">12</span><span class="op">*</span>tb[<span class="st">&#39;u&#39;</span>].values</span>
<span id="cb837-18"><a href="#cb837-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb837-19"><a href="#cb837-19" aria-hidden="true" tabindex="-1"></a>tb</span>
<span id="cb837-20"><a href="#cb837-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb837-21"><a href="#cb837-21" aria-hidden="true" tabindex="-1"></a>reg_tb <span class="op">=</span> sm.OLS.from_formula(<span class="st">&#39;y ~ x&#39;</span>, </span>
<span id="cb837-22"><a href="#cb837-22" aria-hidden="true" tabindex="-1"></a>                             data<span class="op">=</span>tb).fit()</span>
<span id="cb837-23"><a href="#cb837-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb837-24"><a href="#cb837-24" aria-hidden="true" tabindex="-1"></a>reg_tb</span>
<span id="cb837-25"><a href="#cb837-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb837-26"><a href="#cb837-26" aria-hidden="true" tabindex="-1"></a>reg_tb.summary()</span>
<span id="cb837-27"><a href="#cb837-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb837-28"><a href="#cb837-28" aria-hidden="true" tabindex="-1"></a>tb[<span class="st">&#39;yhat1&#39;</span>] <span class="op">=</span> reg_tb.predict(tb)</span>
<span id="cb837-29"><a href="#cb837-29" aria-hidden="true" tabindex="-1"></a>tb[<span class="st">&#39;yhat2&#39;</span>] <span class="op">=</span> <span class="fl">0.1114</span> <span class="op">+</span> <span class="fl">5.6887</span><span class="op">*</span>tb[<span class="st">&#39;x&#39;</span>]</span>
<span id="cb837-30"><a href="#cb837-30" aria-hidden="true" tabindex="-1"></a>tb[<span class="st">&#39;uhat1&#39;</span>] <span class="op">=</span> reg_tb.resid</span>
<span id="cb837-31"><a href="#cb837-31" aria-hidden="true" tabindex="-1"></a>tb[<span class="st">&#39;uhat2&#39;</span>] <span class="op">=</span> tb[<span class="st">&#39;y&#39;</span>] <span class="op">-</span> tb[<span class="st">&#39;yhat2&#39;</span>]</span>
<span id="cb837-32"><a href="#cb837-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb837-33"><a href="#cb837-33" aria-hidden="true" tabindex="-1"></a>tb.describe()</span>
<span id="cb837-34"><a href="#cb837-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb837-35"><a href="#cb837-35" aria-hidden="true" tabindex="-1"></a>tb <span class="op">=</span> pd.DataFrame({</span>
<span id="cb837-36"><a href="#cb837-36" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;x&#39;</span>: <span class="dv">9</span><span class="op">*</span>np.random.normal(size<span class="op">=</span><span class="dv">10</span>),</span>
<span id="cb837-37"><a href="#cb837-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;u&#39;</span>: <span class="dv">36</span><span class="op">*</span>np.random.normal(size<span class="op">=</span><span class="dv">10</span>)})</span>
<span id="cb837-38"><a href="#cb837-38" aria-hidden="true" tabindex="-1"></a>tb[<span class="st">&#39;y&#39;</span>] <span class="op">=</span> <span class="dv">3</span><span class="op">*</span>tb[<span class="st">&#39;x&#39;</span>].values <span class="op">+</span> <span class="dv">2</span><span class="op">*</span>tb[<span class="st">&#39;u&#39;</span>].values</span>
<span id="cb837-39"><a href="#cb837-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb837-40"><a href="#cb837-40" aria-hidden="true" tabindex="-1"></a>reg_tb <span class="op">=</span> sm.OLS.from_formula(<span class="st">&#39;y ~ x&#39;</span>, data<span class="op">=</span>tb).fit()</span>
<span id="cb837-41"><a href="#cb837-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb837-42"><a href="#cb837-42" aria-hidden="true" tabindex="-1"></a>tb[<span class="st">&#39;yhat1&#39;</span>] <span class="op">=</span> reg_tb.predict(tb)</span>
<span id="cb837-43"><a href="#cb837-43" aria-hidden="true" tabindex="-1"></a>tb[<span class="st">&#39;uhat1&#39;</span>] <span class="op">=</span> reg_tb.resid</span>
<span id="cb837-44"><a href="#cb837-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb837-45"><a href="#cb837-45" aria-hidden="true" tabindex="-1"></a>tb.describe()</span></code></pre></div>
</div>
<div id="ejemplo-estimacion-de-regresion-lineal" class="section level4 hasAnchor" number="4.7.2.5">
<h4 class="hasAnchor"><span class="header-section-number">4.7.2.5</span> Ejemplo: estimacion de regresion lineal<a href="#ejemplo-estimacion-de-regresion-lineal" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb838"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb838-1"><a href="#cb838-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb838-2"><a href="#cb838-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb838-3"><a href="#cb838-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb838-4"><a href="#cb838-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb838-5"><a href="#cb838-5" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_csv(<span class="st">&#39;real_estate.csv&#39;</span>)</span>
<span id="cb838-6"><a href="#cb838-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb838-7"><a href="#cb838-7" aria-hidden="true" tabindex="-1"></a>data.head(<span class="dv">5</span>)</span>
<span id="cb838-8"><a href="#cb838-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb838-9"><a href="#cb838-9" aria-hidden="true" tabindex="-1"></a>data.shape</span>
<span id="cb838-10"><a href="#cb838-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb838-11"><a href="#cb838-11" aria-hidden="true" tabindex="-1"></a>data.describe()</span>
<span id="cb838-12"><a href="#cb838-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb838-13"><a href="#cb838-13" aria-hidden="true" tabindex="-1"></a>data.precio.describe()</span>
<span id="cb838-14"><a href="#cb838-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb838-15"><a href="#cb838-15" aria-hidden="true" tabindex="-1"></a>data.hist(figsize<span class="op">=</span>(<span class="dv">6</span>,<span class="dv">6</span>))</span>
<span id="cb838-16"><a href="#cb838-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb838-17"><a href="#cb838-17" aria-hidden="true" tabindex="-1"></a>data.superficie.hist()</span>
<span id="cb838-18"><a href="#cb838-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb838-19"><a href="#cb838-19" aria-hidden="true" tabindex="-1"></a>data.plot(kind <span class="op">=</span> <span class="st">&#39;kde&#39;</span>,</span>
<span id="cb838-20"><a href="#cb838-20" aria-hidden="true" tabindex="-1"></a>          subplots<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb838-21"><a href="#cb838-21" aria-hidden="true" tabindex="-1"></a>          layout <span class="op">=</span> (<span class="dv">2</span>,<span class="dv">2</span>),</span>
<span id="cb838-22"><a href="#cb838-22" aria-hidden="true" tabindex="-1"></a>          sharex<span class="op">=</span><span class="va">False</span>,figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">8</span>))</span>
<span id="cb838-23"><a href="#cb838-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb838-24"><a href="#cb838-24" aria-hidden="true" tabindex="-1"></a>data.plot(kind<span class="op">=</span><span class="st">&#39;box&#39;</span>,subplots<span class="op">=</span><span class="va">True</span>,layout<span class="op">=</span>(<span class="dv">2</span>,<span class="dv">2</span>),sharex<span class="op">=</span><span class="va">False</span>,sharey<span class="op">=</span><span class="va">False</span>,figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">8</span>))</span>
<span id="cb838-25"><a href="#cb838-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb838-26"><a href="#cb838-26" aria-hidden="true" tabindex="-1"></a>plt.scatter(data.superficie,data.precio,s<span class="op">=</span><span class="dv">10</span>,color<span class="op">=</span><span class="st">&#39;purple&#39;</span>)</span>
<span id="cb838-27"><a href="#cb838-27" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;superficie&#39;</span>)</span>
<span id="cb838-28"><a href="#cb838-28" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;precio&#39;</span>)</span>
<span id="cb838-29"><a href="#cb838-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb838-30"><a href="#cb838-30" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pandas.plotting <span class="im">import</span> scatter_matrix</span>
<span id="cb838-31"><a href="#cb838-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb838-32"><a href="#cb838-32" aria-hidden="true" tabindex="-1"></a>scatter_matrix(data,figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))</span></code></pre></div>
</div>
</div>
<div id="una-simulación-de-montecarlo" class="section level3 hasAnchor" number="4.7.3">
<h3 class="hasAnchor"><span class="header-section-number">4.7.3</span> Una simulación de montecarlo<a href="#una-simulación-de-montecarlo" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><span class="math display">\[y = 3 + 2x + u
\]</span></p>
<p><span class="math display">\[x ∼ N(0,9)\]</span></p>
<p><span class="math display">\[u ∼ N(0,36)\]</span></p>
<div class="sourceCode" id="cb839"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb839-1"><a href="#cb839-1" aria-hidden="true" tabindex="-1"></a>coefs <span class="op">=</span> np.zeros(<span class="dv">1000</span>)</span>
<span id="cb839-2"><a href="#cb839-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb839-3"><a href="#cb839-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1000</span>):</span>
<span id="cb839-4"><a href="#cb839-4" aria-hidden="true" tabindex="-1"></a>    tb <span class="op">=</span> pd.DataFrame({</span>
<span id="cb839-5"><a href="#cb839-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;x&#39;</span>: <span class="dv">9</span><span class="op">*</span>np.random.normal(size<span class="op">=</span><span class="dv">10000</span>),</span>
<span id="cb839-6"><a href="#cb839-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;u&#39;</span>: <span class="dv">36</span><span class="op">*</span>np.random.normal(size<span class="op">=</span><span class="dv">10000</span>)})</span>
<span id="cb839-7"><a href="#cb839-7" aria-hidden="true" tabindex="-1"></a>    tb[<span class="st">&#39;y&#39;</span>] <span class="op">=</span> <span class="dv">3</span> <span class="op">+</span> <span class="dv">2</span><span class="op">*</span>tb[<span class="st">&#39;x&#39;</span>].values <span class="op">+</span> tb[<span class="st">&#39;u&#39;</span>].values</span>
<span id="cb839-8"><a href="#cb839-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb839-9"><a href="#cb839-9" aria-hidden="true" tabindex="-1"></a>    reg_tb <span class="op">=</span> sm.OLS.from_formula(<span class="st">&#39;y ~ x&#39;</span>, data<span class="op">=</span>tb).fit()</span>
<span id="cb839-10"><a href="#cb839-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb839-11"><a href="#cb839-11" aria-hidden="true" tabindex="-1"></a>    coefs[i] <span class="op">=</span> reg_tb.params[<span class="st">&#39;x&#39;</span>]</span>
<span id="cb839-12"><a href="#cb839-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb839-13"><a href="#cb839-13" aria-hidden="true" tabindex="-1"></a>plt.hist(coefs, bins <span class="op">=</span> <span class="dv">100</span>)</span>
<span id="cb839-14"><a href="#cb839-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb839-15"><a href="#cb839-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb839-16"><a href="#cb839-16" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(coefs)</span>
<span id="cb839-17"><a href="#cb839-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb839-18"><a href="#cb839-18" aria-hidden="true" tabindex="-1"></a>coefs.mean()</span>
<span id="cb839-19"><a href="#cb839-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb839-20"><a href="#cb839-20" aria-hidden="true" tabindex="-1"></a>coefs.std()</span></code></pre></div>
<div id="ejemplo-1-tirar-dados" class="section level4 hasAnchor" number="4.7.3.1">
<h4 class="hasAnchor"><span class="header-section-number">4.7.3.1</span> Ejemplo 1: Tirar dados<a href="#ejemplo-1-tirar-dados" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb840"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb840-1"><a href="#cb840-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Importing Packages</span></span>
<span id="cb840-2"><a href="#cb840-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb840-3"><a href="#cb840-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span></code></pre></div>
<ul>
<li><p>En este juego, la casa tiene más oportunidades de ganar (30 resultados frente a los 6 del jugador), lo que significa que la casa tiene bastante ventaja.</p></li>
<li><p>Digamos que nuestro jugador comienza con un saldo de 1.000 dólares y está dispuesto a perderlo todo, por lo que apuesta 1 dólar en cada tirada (lo que significa que se lanzan ambos dados) y decide jugar 1.000 tiradas.</p></li>
<li><p>Como la casa es tan generosa, ofrece pagar 4 veces la apuesta del jugador cuando éste gana. Por ejemplo, si el jugador gana la primera tirada, su saldo aumenta en 4 dólares, y termina la ronda con un saldo de 1.004 dólares.</p></li>
<li><p>Si milagrosamente se produce una racha de 1.000 tiradas ganadas, podría irse a casa con 5.000 dólares. Si perdieran todas las rondas, podrían irse a casa sin nada. No es una mala relación riesgo-recompensa… o quizás sí.</p></li>
</ul>
<div class="sourceCode" id="cb841"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb841-1"><a href="#cb841-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating Roll Dice Function</span></span>
<span id="cb841-2"><a href="#cb841-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> roll_dice():</span>
<span id="cb841-3"><a href="#cb841-3" aria-hidden="true" tabindex="-1"></a>    die_1 <span class="op">=</span> random.randint(<span class="dv">1</span>, <span class="dv">6</span>)</span>
<span id="cb841-4"><a href="#cb841-4" aria-hidden="true" tabindex="-1"></a>    die_2 <span class="op">=</span> random.randint(<span class="dv">1</span>, <span class="dv">6</span>)</span>
<span id="cb841-5"><a href="#cb841-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb841-6"><a href="#cb841-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Determining if the dice are the same number</span></span>
<span id="cb841-7"><a href="#cb841-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> die_1 <span class="op">==</span> die_2:</span>
<span id="cb841-8"><a href="#cb841-8" aria-hidden="true" tabindex="-1"></a>        same_num <span class="op">=</span> <span class="va">True</span></span>
<span id="cb841-9"><a href="#cb841-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb841-10"><a href="#cb841-10" aria-hidden="true" tabindex="-1"></a>        same_num <span class="op">=</span> <span class="va">False</span></span>
<span id="cb841-11"><a href="#cb841-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> same_num</span>
<span id="cb841-12"><a href="#cb841-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb841-13"><a href="#cb841-13" aria-hidden="true" tabindex="-1"></a>roll_dice()</span>
<span id="cb841-14"><a href="#cb841-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb841-15"><a href="#cb841-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Inputs</span></span>
<span id="cb841-16"><a href="#cb841-16" aria-hidden="true" tabindex="-1"></a>num_simulations <span class="op">=</span> <span class="dv">10000</span></span>
<span id="cb841-17"><a href="#cb841-17" aria-hidden="true" tabindex="-1"></a>max_num_rolls <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb841-18"><a href="#cb841-18" aria-hidden="true" tabindex="-1"></a>bet <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb841-19"><a href="#cb841-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb841-20"><a href="#cb841-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Tracking</span></span>
<span id="cb841-21"><a href="#cb841-21" aria-hidden="true" tabindex="-1"></a>win_probability <span class="op">=</span> []</span>
<span id="cb841-22"><a href="#cb841-22" aria-hidden="true" tabindex="-1"></a>end_balance <span class="op">=</span> []</span>
<span id="cb841-23"><a href="#cb841-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb841-24"><a href="#cb841-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating Figure for Simulation Balances</span></span>
<span id="cb841-25"><a href="#cb841-25" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure()</span>
<span id="cb841-26"><a href="#cb841-26" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Monte Carlo Dice Game [&quot;</span> <span class="op">+</span> <span class="bu">str</span>(num_simulations) <span class="op">+</span> <span class="st">&quot;simulations]&quot;</span>)</span>
<span id="cb841-27"><a href="#cb841-27" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Roll Number&quot;</span>)</span>
<span id="cb841-28"><a href="#cb841-28" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;Balance [$]&quot;</span>)</span>
<span id="cb841-29"><a href="#cb841-29" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="dv">0</span>, max_num_rolls])</span>
<span id="cb841-30"><a href="#cb841-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb841-31"><a href="#cb841-31" aria-hidden="true" tabindex="-1"></a><span class="co"># For loop to run for the number of simulations desired</span></span>
<span id="cb841-32"><a href="#cb841-32" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(num_simulations):</span>
<span id="cb841-33"><a href="#cb841-33" aria-hidden="true" tabindex="-1"></a>    balance <span class="op">=</span> [<span class="dv">1000</span>]</span>
<span id="cb841-34"><a href="#cb841-34" aria-hidden="true" tabindex="-1"></a>    num_rolls <span class="op">=</span> [<span class="dv">0</span>]</span>
<span id="cb841-35"><a href="#cb841-35" aria-hidden="true" tabindex="-1"></a>    num_wins <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb841-36"><a href="#cb841-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Run until the player has rolled 1,000 times</span></span>
<span id="cb841-37"><a href="#cb841-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> num_rolls[<span class="op">-</span><span class="dv">1</span>] <span class="op">&lt;</span> max_num_rolls:</span>
<span id="cb841-38"><a href="#cb841-38" aria-hidden="true" tabindex="-1"></a>        same <span class="op">=</span> roll_dice()</span>
<span id="cb841-39"><a href="#cb841-39" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Result if the dice are the same number</span></span>
<span id="cb841-40"><a href="#cb841-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> same:</span>
<span id="cb841-41"><a href="#cb841-41" aria-hidden="true" tabindex="-1"></a>            balance.append(balance[<span class="op">-</span><span class="dv">1</span>] <span class="op">+</span> <span class="dv">4</span> <span class="op">*</span> bet)</span>
<span id="cb841-42"><a href="#cb841-42" aria-hidden="true" tabindex="-1"></a>            num_wins <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb841-43"><a href="#cb841-43" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Result if the dice are different numbers</span></span>
<span id="cb841-44"><a href="#cb841-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb841-45"><a href="#cb841-45" aria-hidden="true" tabindex="-1"></a>            balance.append(balance[<span class="op">-</span><span class="dv">1</span>] <span class="op">-</span> bet)</span>
<span id="cb841-46"><a href="#cb841-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb841-47"><a href="#cb841-47" aria-hidden="true" tabindex="-1"></a>        num_rolls.append(num_rolls[<span class="op">-</span><span class="dv">1</span>] <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb841-48"><a href="#cb841-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Store tracking variables and add line to figure</span></span>
<span id="cb841-49"><a href="#cb841-49" aria-hidden="true" tabindex="-1"></a>    win_probability.append(num_wins<span class="op">/</span>num_rolls[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb841-50"><a href="#cb841-50" aria-hidden="true" tabindex="-1"></a>    end_balance.append(balance[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb841-51"><a href="#cb841-51" aria-hidden="true" tabindex="-1"></a>    plt.plot(num_rolls, balance)</span>
<span id="cb841-52"><a href="#cb841-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb841-53"><a href="#cb841-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Showing the plot after the simulations are finished</span></span>
<span id="cb841-54"><a href="#cb841-54" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb841-55"><a href="#cb841-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb841-56"><a href="#cb841-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Averaging win probability and end balance</span></span>
<span id="cb841-57"><a href="#cb841-57" aria-hidden="true" tabindex="-1"></a>overall_win_probability <span class="op">=</span> <span class="bu">sum</span>(win_probability)<span class="op">/</span><span class="bu">len</span>(win_probability)</span>
<span id="cb841-58"><a href="#cb841-58" aria-hidden="true" tabindex="-1"></a>overall_end_balance <span class="op">=</span> <span class="bu">sum</span>(end_balance)<span class="op">/</span><span class="bu">len</span>(end_balance)</span>
<span id="cb841-59"><a href="#cb841-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Displaying the averages</span></span>
<span id="cb841-60"><a href="#cb841-60" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Average win probability after &quot;</span> <span class="op">+</span> <span class="bu">str</span>(num_simulations) <span class="op">+</span> <span class="st">&quot;runs: &quot;</span> <span class="op">+</span> <span class="bu">str</span>(overall_win_probability))</span>
<span id="cb841-61"><a href="#cb841-61" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Average ending balance after &quot;</span> <span class="op">+</span> <span class="bu">str</span>(num_simulations) <span class="op">+</span> <span class="st">&quot;runs: $&quot;</span> <span class="op">+</span> <span class="bu">str</span>(overall_end_balance))</span></code></pre></div>
</div>
<div id="ejemplo-2-modelo" class="section level4 hasAnchor" number="4.7.3.2">
<h4 class="hasAnchor"><span class="header-section-number">4.7.3.2</span> Ejemplo 2: Modelo<a href="#ejemplo-2-modelo" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb842"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb842-1"><a href="#cb842-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb842-2"><a href="#cb842-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb842-3"><a href="#cb842-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib <span class="im">as</span> plt </span>
<span id="cb842-4"><a href="#cb842-4" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">2021</span>)</span>
<span id="cb842-5"><a href="#cb842-5" aria-hidden="true" tabindex="-1"></a>mu <span class="op">=</span> <span class="dv">0</span> </span>
<span id="cb842-6"><a href="#cb842-6" aria-hidden="true" tabindex="-1"></a>sigma <span class="op">=</span> <span class="dv">1</span> </span>
<span id="cb842-7"><a href="#cb842-7" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="dv">100</span> </span>
<span id="cb842-8"><a href="#cb842-8" aria-hidden="true" tabindex="-1"></a><span class="co"># assumed population parameters</span></span>
<span id="cb842-9"><a href="#cb842-9" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> np.repeat(<span class="fl">0.5</span>, n)</span>
<span id="cb842-10"><a href="#cb842-10" aria-hidden="true" tabindex="-1"></a>beta <span class="op">=</span> <span class="fl">1.5</span></span>
<span id="cb842-11"><a href="#cb842-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb842-12"><a href="#cb842-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> MC_estimation_slope(M):</span>
<span id="cb842-13"><a href="#cb842-13" aria-hidden="true" tabindex="-1"></a>    MC_betas <span class="op">=</span> []</span>
<span id="cb842-14"><a href="#cb842-14" aria-hidden="true" tabindex="-1"></a>    MC_samples <span class="op">=</span> {}</span>
<span id="cb842-15"><a href="#cb842-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb842-16"><a href="#cb842-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(M):</span>
<span id="cb842-17"><a href="#cb842-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># randomly sampling from normal distribution as error terms</span></span>
<span id="cb842-18"><a href="#cb842-18" aria-hidden="true" tabindex="-1"></a>        e <span class="op">=</span> np.random.normal(mu, sigma, n)</span>
<span id="cb842-19"><a href="#cb842-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># generating independent variable by making sure the variance in X is larger than the variance in error terms</span></span>
<span id="cb842-20"><a href="#cb842-20" aria-hidden="true" tabindex="-1"></a>        X <span class="op">=</span> <span class="dv">9</span> <span class="op">*</span> np.random.normal(mu, sigma, n)</span>
<span id="cb842-21"><a href="#cb842-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># population distribution using the assumd parameter values alpha/beta</span></span>
<span id="cb842-22"><a href="#cb842-22" aria-hidden="true" tabindex="-1"></a>        Y <span class="op">=</span> (alpha <span class="op">+</span> beta <span class="op">*</span> X <span class="op">+</span> e)</span>
<span id="cb842-23"><a href="#cb842-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb842-24"><a href="#cb842-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># running OLS regression for getting slope parameters</span></span>
<span id="cb842-25"><a href="#cb842-25" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> sm.OLS(Y.reshape((<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)), X.reshape((<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)))</span>
<span id="cb842-26"><a href="#cb842-26" aria-hidden="true" tabindex="-1"></a>        ols_result <span class="op">=</span> model.fit()</span>
<span id="cb842-27"><a href="#cb842-27" aria-hidden="true" tabindex="-1"></a>        coeff <span class="op">=</span> ols_result.params</span>
<span id="cb842-28"><a href="#cb842-28" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb842-29"><a href="#cb842-29" aria-hidden="true" tabindex="-1"></a>        MC_samples[i] <span class="op">=</span> Y</span>
<span id="cb842-30"><a href="#cb842-30" aria-hidden="true" tabindex="-1"></a>        MC_betas.append(coeff)</span>
<span id="cb842-31"><a href="#cb842-31" aria-hidden="true" tabindex="-1"></a>    MC_beta_hats <span class="op">=</span> np.array(MC_betas).flatten()</span>
<span id="cb842-32"><a href="#cb842-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>(MC_samples, MC_beta_hats)</span>
<span id="cb842-33"><a href="#cb842-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb842-34"><a href="#cb842-34" aria-hidden="true" tabindex="-1"></a>MC_samples, MC_beta_hats <span class="op">=</span> MC_estimation_slope(M <span class="op">=</span> <span class="dv">10000</span>)</span>
<span id="cb842-35"><a href="#cb842-35" aria-hidden="true" tabindex="-1"></a>beta_hat_MC <span class="op">=</span> np.mean(MC_beta_hats)</span>
<span id="cb842-36"><a href="#cb842-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb842-37"><a href="#cb842-37" aria-hidden="true" tabindex="-1"></a>MC_samples, MC_beta_hats</span>
<span id="cb842-38"><a href="#cb842-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb842-39"><a href="#cb842-39" aria-hidden="true" tabindex="-1"></a>plt.hist(MC_beta_hats)</span>
<span id="cb842-40"><a href="#cb842-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb842-41"><a href="#cb842-41" aria-hidden="true" tabindex="-1"></a>beta_hat_MC</span></code></pre></div>
</div>
</div>
<div id="bootstraping" class="section level3 hasAnchor" number="4.7.4">
<h3 class="hasAnchor"><span class="header-section-number">4.7.4</span> Bootstraping<a href="#bootstraping" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb843"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb843-1"><a href="#cb843-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import necessary libraries</span></span>
<span id="cb843-2"><a href="#cb843-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb843-3"><a href="#cb843-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb843-4"><a href="#cb843-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb843-5"><a href="#cb843-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb843-6"><a href="#cb843-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code></pre></div>
<ul>
<li>Data</li>
</ul>
<div class="sourceCode" id="cb844"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb844-1"><a href="#cb844-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import the iris dataset</span></span>
<span id="cb844-2"><a href="#cb844-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_csv(<span class="st">&#39;weight-height.csv&#39;</span>)</span>
<span id="cb844-3"><a href="#cb844-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb844-4"><a href="#cb844-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Looking at information</span></span>
<span id="cb844-5"><a href="#cb844-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Info:&quot;</span>)</span>
<span id="cb844-6"><a href="#cb844-6" aria-hidden="true" tabindex="-1"></a>display(data.info())</span>
<span id="cb844-7"><a href="#cb844-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb844-8"><a href="#cb844-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary Statistics</span></span>
<span id="cb844-9"><a href="#cb844-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Summary Statistics:&quot;</span>)</span>
<span id="cb844-10"><a href="#cb844-10" aria-hidden="true" tabindex="-1"></a>display(data.describe())</span>
<span id="cb844-11"><a href="#cb844-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb844-12"><a href="#cb844-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Display first 5 rows</span></span>
<span id="cb844-13"><a href="#cb844-13" aria-hidden="true" tabindex="-1"></a>display(data.head())</span></code></pre></div>
<ul>
<li>Convertimos datos en centimetros</li>
</ul>
<div class="sourceCode" id="cb845"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb845-1"><a href="#cb845-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert inches to centimeters</span></span>
<span id="cb845-2"><a href="#cb845-2" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&quot;Height(cm)&quot;</span>] <span class="op">=</span> data[<span class="st">&quot;Height&quot;</span>]<span class="op">*</span><span class="fl">2.54</span></span>
<span id="cb845-3"><a href="#cb845-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb845-4"><a href="#cb845-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get summary statistics of Heights in centimeters</span></span>
<span id="cb845-5"><a href="#cb845-5" aria-hidden="true" tabindex="-1"></a>display(data[<span class="st">&#39;Height(cm)&#39;</span>].describe())</span></code></pre></div>
<p>Como podemos ver, la altura máxima y mínima del conjunto de datos son 137,8 cm y 200,6 cm respectivamente</p>
<p>Tome 500 alturas seleccionadas al azar</p>
<div class="sourceCode" id="cb846"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb846-1"><a href="#cb846-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraemos 500 random</span></span>
<span id="cb846-2"><a href="#cb846-2" aria-hidden="true" tabindex="-1"></a>heights <span class="op">=</span> data[<span class="st">&#39;Height(cm)&#39;</span>].sample(<span class="dv">500</span>).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb846-3"><a href="#cb846-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb846-4"><a href="#cb846-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Eastadisticas</span></span>
<span id="cb846-5"><a href="#cb846-5" aria-hidden="true" tabindex="-1"></a>display(heights.describe())</span></code></pre></div>
<ul>
<li>Si los datos se distribuyen normalmente, ¿qué pasaría? Para ver esto, vamos a trazar la función de distribución acumulativa con la media y la desviación estándar de nuestros datos empíricos.</li>
</ul>
<div class="sourceCode" id="cb847"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb847-1"><a href="#cb847-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtenga la desviación estándar y la media</span></span>
<span id="cb847-2"><a href="#cb847-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb847-3"><a href="#cb847-3" aria-hidden="true" tabindex="-1"></a>heights_std <span class="op">=</span> np.std(heights)</span>
<span id="cb847-4"><a href="#cb847-4" aria-hidden="true" tabindex="-1"></a>heights_mean <span class="op">=</span> np.mean(heights)</span>
<span id="cb847-5"><a href="#cb847-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb847-6"><a href="#cb847-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot Normal CDF</span></span>
<span id="cb847-7"><a href="#cb847-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_normal_CDF(data,mean,std,label,title):</span>
<span id="cb847-8"><a href="#cb847-8" aria-hidden="true" tabindex="-1"></a>    sns.<span class="bu">set</span>()</span>
<span id="cb847-9"><a href="#cb847-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># CDF of the data</span></span>
<span id="cb847-10"><a href="#cb847-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> np.linspace(<span class="bu">min</span>(data),<span class="bu">max</span>(data),<span class="bu">len</span>(data))</span>
<span id="cb847-11"><a href="#cb847-11" aria-hidden="true" tabindex="-1"></a>    cdf <span class="op">=</span> stats.norm.cdf(x,mean,std)</span>
<span id="cb847-12"><a href="#cb847-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb847-13"><a href="#cb847-13" aria-hidden="true" tabindex="-1"></a>    plt.plot(x,cdf)</span>
<span id="cb847-14"><a href="#cb847-14" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(label)</span>
<span id="cb847-15"><a href="#cb847-15" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">&#39;percentage&#39;</span>)</span>
<span id="cb847-16"><a href="#cb847-16" aria-hidden="true" tabindex="-1"></a>    plt.title(title)</span>
<span id="cb847-17"><a href="#cb847-17" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb847-18"><a href="#cb847-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x,cdf</span>
<span id="cb847-19"><a href="#cb847-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb847-20"><a href="#cb847-20" aria-hidden="true" tabindex="-1"></a><span class="co"># CDF of Versicolor</span></span>
<span id="cb847-21"><a href="#cb847-21" aria-hidden="true" tabindex="-1"></a>x_cdf, y_cdf <span class="op">=</span> plot_normal_CDF(heights, heights_mean, heights_std, <span class="st">&quot;Height (cm)&quot;</span>,<span class="st">&quot;CDF&quot;</span>)</span></code></pre></div>
<p>Además de la FCD, trace la función de distribución acumulativa empírica y la función de densidad de probabilidad.</p>
<div class="sourceCode" id="cb848"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb848-1"><a href="#cb848-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a function to get x, y for of ecdf</span></span>
<span id="cb848-2"><a href="#cb848-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_ecdf(data):</span>
<span id="cb848-3"><a href="#cb848-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb848-4"><a href="#cb848-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get lenght of the data into n</span></span>
<span id="cb848-5"><a href="#cb848-5" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="bu">len</span>(data)</span>
<span id="cb848-6"><a href="#cb848-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb848-7"><a href="#cb848-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># We need to sort the data</span></span>
<span id="cb848-8"><a href="#cb848-8" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> np.sort(data)</span>
<span id="cb848-9"><a href="#cb848-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb848-10"><a href="#cb848-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># the function will show us cumulative percentages of corresponding data points</span></span>
<span id="cb848-11"><a href="#cb848-11" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> np.arange(<span class="dv">1</span>,n<span class="op">+</span><span class="dv">1</span>)<span class="op">/</span>n</span>
<span id="cb848-12"><a href="#cb848-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb848-13"><a href="#cb848-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x,y</span>
<span id="cb848-14"><a href="#cb848-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-15"><a href="#cb848-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a function to plot ecdf</span></span>
<span id="cb848-16"><a href="#cb848-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_ecdf(data,labelx,labely,title,color):</span>
<span id="cb848-17"><a href="#cb848-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Plot ecdf&quot;&quot;&quot;</span></span>
<span id="cb848-18"><a href="#cb848-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Call get_ecdf function and assign the returning values</span></span>
<span id="cb848-19"><a href="#cb848-19" aria-hidden="true" tabindex="-1"></a>    x, y <span class="op">=</span> get_ecdf(data)</span>
<span id="cb848-20"><a href="#cb848-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb848-21"><a href="#cb848-21" aria-hidden="true" tabindex="-1"></a>    plt.plot(x,y,marker<span class="op">=</span><span class="st">&#39;.&#39;</span>,linestyle<span class="op">=</span><span class="st">&#39;none&#39;</span>,c<span class="op">=</span>color)</span>
<span id="cb848-22"><a href="#cb848-22" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(labelx)</span>
<span id="cb848-23"><a href="#cb848-23" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(labely)</span>
<span id="cb848-24"><a href="#cb848-24" aria-hidden="true" tabindex="-1"></a>    plt.title(title)</span>
<span id="cb848-25"><a href="#cb848-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-26"><a href="#cb848-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a function overlay ECDF on CDF</span></span>
<span id="cb848-27"><a href="#cb848-27" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_overlay_ecdf(data,labelx,labely,title,color,x_cdf, y_cdf):</span>
<span id="cb848-28"><a href="#cb848-28" aria-hidden="true" tabindex="-1"></a>    x, y <span class="op">=</span> get_ecdf(data)</span>
<span id="cb848-29"><a href="#cb848-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb848-30"><a href="#cb848-30" aria-hidden="true" tabindex="-1"></a>    plt.plot(x,y,marker<span class="op">=</span><span class="st">&#39;.&#39;</span>,linestyle<span class="op">=</span><span class="st">&#39;none&#39;</span>,c<span class="op">=</span>color,alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb848-31"><a href="#cb848-31" aria-hidden="true" tabindex="-1"></a>    plt.plot(x_cdf, y_cdf)</span>
<span id="cb848-32"><a href="#cb848-32" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(labelx)</span>
<span id="cb848-33"><a href="#cb848-33" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(labely)</span>
<span id="cb848-34"><a href="#cb848-34" aria-hidden="true" tabindex="-1"></a>    plt.title(title)</span>
<span id="cb848-35"><a href="#cb848-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb848-36"><a href="#cb848-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting Empirical CDF</span></span>
<span id="cb848-37"><a href="#cb848-37" aria-hidden="true" tabindex="-1"></a>plot_ecdf(heights,<span class="st">&quot;Height (cm)&quot;</span>,<span class="st">&quot;percentage&quot;</span>,<span class="st">&quot;Empirical CDF&quot;</span>,<span class="st">&quot;r&quot;</span>)</span>
<span id="cb848-38"><a href="#cb848-38" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb848-39"><a href="#cb848-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-40"><a href="#cb848-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Overlap Empirical CDF on CDF</span></span>
<span id="cb848-41"><a href="#cb848-41" aria-hidden="true" tabindex="-1"></a>plot_overlay_ecdf(heights,<span class="st">&quot;Height (cm)&quot;</span>,<span class="st">&quot;percentage&quot;</span>,<span class="st">&quot;Empirical CDF on CDF&quot;</span>,<span class="st">&quot;y&quot;</span>,x_cdf, y_cdf)</span>
<span id="cb848-42"><a href="#cb848-42" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb848-43"><a href="#cb848-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-44"><a href="#cb848-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting PDF</span></span>
<span id="cb848-45"><a href="#cb848-45" aria-hidden="true" tabindex="-1"></a>sns.distplot(heights,hist<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb848-46"><a href="#cb848-46" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Petal length(cm)&quot;</span>)</span>
<span id="cb848-47"><a href="#cb848-47" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;PDF&quot;</span>)</span>
<span id="cb848-48"><a href="#cb848-48" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Probability Density Function&quot;</span>)</span>
<span id="cb848-49"><a href="#cb848-49" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p>Si hubieramos hecho el mismo experimento muchas veces hubiesemos obtenido lo mismo?</p>
<div class="sourceCode" id="cb849"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb849-1"><a href="#cb849-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot our original sample ecdf</span></span>
<span id="cb849-2"><a href="#cb849-2" aria-hidden="true" tabindex="-1"></a>plot_ecdf(heights,<span class="st">&quot;Height (cm)&quot;</span>,<span class="st">&quot;percentage&quot;</span>,<span class="st">&quot;ECDF&#39;s of bootstrap samples&quot;</span>,<span class="st">&quot;y&quot;</span>)</span>
<span id="cb849-3"><a href="#cb849-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb849-4"><a href="#cb849-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1000</span>):</span>
<span id="cb849-5"><a href="#cb849-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb849-6"><a href="#cb849-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Generate a bootstrap sample</span></span>
<span id="cb849-7"><a href="#cb849-7" aria-hidden="true" tabindex="-1"></a>    bs_sample_heights <span class="op">=</span> np.random.choice(heights,size<span class="op">=</span><span class="bu">len</span>(heights))</span>
<span id="cb849-8"><a href="#cb849-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb849-9"><a href="#cb849-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot ecdf for bootstrap sample</span></span>
<span id="cb849-10"><a href="#cb849-10" aria-hidden="true" tabindex="-1"></a>    x, y <span class="op">=</span> get_ecdf(bs_sample_heights)</span>
<span id="cb849-11"><a href="#cb849-11" aria-hidden="true" tabindex="-1"></a>    plt.scatter(x, y,s<span class="op">=</span><span class="dv">1</span>,c<span class="op">=</span><span class="st">&#39;b&#39;</span>,alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb849-12"><a href="#cb849-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb849-13"><a href="#cb849-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<ul>
<li>Necesitaremos una función que genere muestras bootstrap y extraiga réplicas bootstrap de esas muestras tanto como queramos. La función tomará tres parámetros data, func y size. El parámetro ‘func’ corresponde a los estadísticos de resumen que querremos utilizar al crear una réplica bootstrap. El parámetro ‘size’ nos indicará cuántas réplicas necesitamos.</li>
</ul>
<div class="sourceCode" id="cb850"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb850-1"><a href="#cb850-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> draw_bs_replicates(data,func,size):</span>
<span id="cb850-2"><a href="#cb850-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;creates a bootstrap sample, computes replicates and returns replicates array&quot;&quot;&quot;</span></span>
<span id="cb850-3"><a href="#cb850-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create an empty array to store replicates</span></span>
<span id="cb850-4"><a href="#cb850-4" aria-hidden="true" tabindex="-1"></a>    bs_replicates <span class="op">=</span> np.empty(size)</span>
<span id="cb850-5"><a href="#cb850-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb850-6"><a href="#cb850-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create bootstrap replicates as much as size</span></span>
<span id="cb850-7"><a href="#cb850-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(size):</span>
<span id="cb850-8"><a href="#cb850-8" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create a bootstrap sample</span></span>
<span id="cb850-9"><a href="#cb850-9" aria-hidden="true" tabindex="-1"></a>        bs_sample <span class="op">=</span> np.random.choice(data,size<span class="op">=</span><span class="bu">len</span>(data))</span>
<span id="cb850-10"><a href="#cb850-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get bootstrap replicate and append to bs_replicates</span></span>
<span id="cb850-11"><a href="#cb850-11" aria-hidden="true" tabindex="-1"></a>        bs_replicates[i] <span class="op">=</span> func(bs_sample)</span>
<span id="cb850-12"><a href="#cb850-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb850-13"><a href="#cb850-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> bs_replicates</span></code></pre></div>
<p>Ahora utilizaremos nuestra función para obtener 10.000 réplicas bootstrap. Después veremos cómo son su PDF y su ECDF.</p>
<div class="sourceCode" id="cb851"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb851-1"><a href="#cb851-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Draw 10000 bootstrap replicates</span></span>
<span id="cb851-2"><a href="#cb851-2" aria-hidden="true" tabindex="-1"></a>bs_replicates_heights <span class="op">=</span> draw_bs_replicates(heights,np.mean,<span class="dv">15000</span>)</span>
<span id="cb851-3"><a href="#cb851-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb851-4"><a href="#cb851-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot probability density function</span></span>
<span id="cb851-5"><a href="#cb851-5" aria-hidden="true" tabindex="-1"></a>plt.hist(bs_replicates_heights,bins<span class="op">=</span><span class="dv">30</span>,density<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb851-6"><a href="#cb851-6" aria-hidden="true" tabindex="-1"></a>plt.axvline(x<span class="op">=</span>np.percentile(bs_replicates_heights,[<span class="fl">2.5</span>]), ymin<span class="op">=</span><span class="dv">0</span>, ymax<span class="op">=</span><span class="dv">1</span>,label<span class="op">=</span><span class="st">&#39;2.5th percentile&#39;</span>,c<span class="op">=</span><span class="st">&#39;y&#39;</span>)</span>
<span id="cb851-7"><a href="#cb851-7" aria-hidden="true" tabindex="-1"></a>plt.axvline(x<span class="op">=</span>np.percentile(bs_replicates_heights,[<span class="fl">97.5</span>]), ymin<span class="op">=</span><span class="dv">0</span>, ymax<span class="op">=</span><span class="dv">1</span>,label<span class="op">=</span><span class="st">&#39;97.5th percentile&#39;</span>,c<span class="op">=</span><span class="st">&#39;r&#39;</span>)</span>
<span id="cb851-8"><a href="#cb851-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Height(cm)&quot;</span>)</span>
<span id="cb851-9"><a href="#cb851-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;PDF&quot;</span>)</span>
<span id="cb851-10"><a href="#cb851-10" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Probability Density Function&quot;</span>)</span>
<span id="cb851-11"><a href="#cb851-11" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb851-12"><a href="#cb851-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb851-13"><a href="#cb851-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb851-14"><a href="#cb851-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the ECDF of replicates</span></span>
<span id="cb851-15"><a href="#cb851-15" aria-hidden="true" tabindex="-1"></a>xsbs_ecdf, ysbs_ecdf <span class="op">=</span> get_ecdf(bs_replicates_heights)</span>
<span id="cb851-16"><a href="#cb851-16" aria-hidden="true" tabindex="-1"></a>plt.scatter(xsbs_ecdf, ysbs_ecdf,s<span class="op">=</span><span class="dv">5</span>,c<span class="op">=</span><span class="st">&#39;b&#39;</span>,alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb851-17"><a href="#cb851-17" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Height(cm)&quot;</span>)</span>
<span id="cb851-18"><a href="#cb851-18" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;ECDF&quot;</span>)</span>
<span id="cb851-19"><a href="#cb851-19" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;ECDF of Bootstrap Replicates&quot;</span>)</span>
<span id="cb851-20"><a href="#cb851-20" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<ul>
<li>Comparemos la media empírica y la media de nuestras réplicas</li>
</ul>
<div class="sourceCode" id="cb852"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb852-1"><a href="#cb852-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Empirical mean: &quot;</span> <span class="op">+</span> <span class="bu">str</span>(heights_mean))</span>
<span id="cb852-2"><a href="#cb852-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb852-3"><a href="#cb852-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the mean of bootstrap replicates</span></span>
<span id="cb852-4"><a href="#cb852-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Bootstrap replicates mean: &quot;</span> <span class="op">+</span> <span class="bu">str</span>(np.mean(bs_replicates_heights)))</span></code></pre></div>
<ul>
<li><p>Intervalo de confianza?</p></li>
<li><p>Medias muy iguales</p></li>
<li><p>Ecnontremos el intervalo de confianza</p></li>
<li><p>Necesitamos conocer el area entre los cuantiles</p></li>
</ul>
<div class="sourceCode" id="cb853"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb853-1"><a href="#cb853-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the corresponding values of 2.5th and 97.5th percentiles</span></span>
<span id="cb853-2"><a href="#cb853-2" aria-hidden="true" tabindex="-1"></a>conf_interval <span class="op">=</span> np.percentile(bs_replicates_heights,[<span class="fl">2.5</span>,<span class="fl">97.5</span>])</span>
<span id="cb853-3"><a href="#cb853-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb853-4"><a href="#cb853-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the interval</span></span>
<span id="cb853-5"><a href="#cb853-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;The confidence interval: &quot;</span>,conf_interval)</span></code></pre></div>
<ul>
<li>Encontramos un intervalo de confianza entre 167,2cm y 162,5cm.</li>
<li>Podemos decir que si elegimos a alguien al azar, su altura estará entre este intervalo con un %95 de probabilidad.</li>
</ul>
</div>
<div id="regresión-logistica" class="section level3 hasAnchor" number="4.7.5">
<h3 class="hasAnchor"><span class="header-section-number">4.7.5</span> Regresión Logistica<a href="#regresión-logistica" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb854"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb854-1"><a href="#cb854-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb854-2"><a href="#cb854-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb854-3"><a href="#cb854-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib</span>
<span id="cb854-4"><a href="#cb854-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb854-5"><a href="#cb854-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.stats <span class="im">as</span> stats</span>
<span id="cb854-6"><a href="#cb854-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb854-7"><a href="#cb854-7" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">9</span>,<span class="dv">9</span>))</span>
<span id="cb854-8"><a href="#cb854-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb854-9"><a href="#cb854-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sigmoid(t):                          <span class="co"># Define the sigmoid function</span></span>
<span id="cb854-10"><a href="#cb854-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (<span class="dv">1</span><span class="op">/</span>(<span class="dv">1</span> <span class="op">+</span> np.e<span class="op">**</span>(<span class="op">-</span>t)))    </span>
<span id="cb854-11"><a href="#cb854-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb854-12"><a href="#cb854-12" aria-hidden="true" tabindex="-1"></a>plot_range <span class="op">=</span> np.arange(<span class="op">-</span><span class="dv">6</span>, <span class="dv">6</span>, <span class="fl">0.1</span>)       </span>
<span id="cb854-13"><a href="#cb854-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb854-14"><a href="#cb854-14" aria-hidden="true" tabindex="-1"></a>y_values <span class="op">=</span> sigmoid(plot_range)</span>
<span id="cb854-15"><a href="#cb854-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb854-16"><a href="#cb854-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot curve</span></span>
<span id="cb854-17"><a href="#cb854-17" aria-hidden="true" tabindex="-1"></a>plt.plot(plot_range,   <span class="co"># X-axis range</span></span>
<span id="cb854-18"><a href="#cb854-18" aria-hidden="true" tabindex="-1"></a>         y_values,          <span class="co"># Predicted values</span></span>
<span id="cb854-19"><a href="#cb854-19" aria-hidden="true" tabindex="-1"></a>         color<span class="op">=</span><span class="st">&quot;red&quot;</span>)<span class="op">;</span></span></code></pre></div>
<ul>
<li>La función sigmoide está limitada por debajo por 0 y por encima por 1.</li>
<li>En la regresión logística, el resultado se interpreta como una probabilidad: la probabilidad de que una observación pertenezca a la segunda de las dos categorías modeladas. Cuando la combinación lineal de variables produce números positivos, la probabilidad resultante es mayor que 0,5 y cuando produce números negativos, la probabilidad es menor que 0,5.</li>
</ul>
<p>No profundizaremos en los detalles de cómo funciona la regresión logística, sino que nos centraremos en cómo utilizarla en Python. Lo más importante es saber que la reg&lt;resión logística produce probabilidades que podemos utilizar para clasificar las observaciones.</p>
<div id="titanic" class="section level4 hasAnchor" number="4.7.5.1">
<h4 class="hasAnchor"><span class="header-section-number">4.7.5.1</span> Titanic<a href="#titanic" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Para el resto de la lección trabajaremos con los datos de entrenamiento de supervivencia del Titanic de Kaggle que vimos en la lección 14. Empezaremos cargando los datos y realizando algunas de las mismas tareas de preprocesamiento que hicimos en la lección 14:</p>
<div class="sourceCode" id="cb855"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb855-1"><a href="#cb855-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb855-2"><a href="#cb855-2" aria-hidden="true" tabindex="-1"></a>os.chdir(<span class="st">&quot;datos&quot;</span>)</span>
<span id="cb855-3"><a href="#cb855-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb855-4"><a href="#cb855-4" aria-hidden="true" tabindex="-1"></a>titanic_train <span class="op">=</span> pd.read_csv(<span class="st">&quot;train.csv&quot;</span>)    <span class="co"># Read the data</span></span>
<span id="cb855-5"><a href="#cb855-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb855-6"><a href="#cb855-6" aria-hidden="true" tabindex="-1"></a>char_cabin <span class="op">=</span> titanic_train[<span class="st">&quot;Cabin&quot;</span>].astype(<span class="bu">str</span>)     <span class="co"># Convert cabin to str</span></span>
<span id="cb855-7"><a href="#cb855-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb855-8"><a href="#cb855-8" aria-hidden="true" tabindex="-1"></a>new_Cabin <span class="op">=</span> np.array([cabin[<span class="dv">0</span>] <span class="cf">for</span> cabin <span class="kw">in</span> char_cabin]) <span class="co"># Take first letter</span></span>
<span id="cb855-9"><a href="#cb855-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb855-10"><a href="#cb855-10" aria-hidden="true" tabindex="-1"></a>titanic_train[<span class="st">&quot;Cabin&quot;</span>] <span class="op">=</span> pd.Categorical(new_Cabin)  <span class="co"># Save the new cabin var</span></span>
<span id="cb855-11"><a href="#cb855-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb855-12"><a href="#cb855-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Impute median Age for NA Age values</span></span>
<span id="cb855-13"><a href="#cb855-13" aria-hidden="true" tabindex="-1"></a>new_age_var <span class="op">=</span> np.where(titanic_train[<span class="st">&quot;Age&quot;</span>].isnull(), <span class="co"># Logical check</span></span>
<span id="cb855-14"><a href="#cb855-14" aria-hidden="true" tabindex="-1"></a>                       <span class="dv">28</span>,                       <span class="co"># Value if check is true</span></span>
<span id="cb855-15"><a href="#cb855-15" aria-hidden="true" tabindex="-1"></a>                       titanic_train[<span class="st">&quot;Age&quot;</span>])     <span class="co"># Value if check is false</span></span>
<span id="cb855-16"><a href="#cb855-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb855-17"><a href="#cb855-17" aria-hidden="true" tabindex="-1"></a>titanic_train[<span class="st">&quot;Age&quot;</span>] <span class="op">=</span> new_age_var </span>
<span id="cb855-18"><a href="#cb855-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb855-19"><a href="#cb855-19" aria-hidden="true" tabindex="-1"></a>new_fare_var <span class="op">=</span> np.where(titanic_train[<span class="st">&quot;Fare&quot;</span>].isnull(), <span class="co"># Logical check</span></span>
<span id="cb855-20"><a href="#cb855-20" aria-hidden="true" tabindex="-1"></a>                       <span class="dv">50</span>,                         <span class="co"># Value if check is true</span></span>
<span id="cb855-21"><a href="#cb855-21" aria-hidden="true" tabindex="-1"></a>                       titanic_train[<span class="st">&quot;Fare&quot;</span>])     <span class="co"># Value if check is false</span></span>
<span id="cb855-22"><a href="#cb855-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb855-23"><a href="#cb855-23" aria-hidden="true" tabindex="-1"></a>titanic_train[<span class="st">&quot;Fare&quot;</span>] <span class="op">=</span> new_fare_var</span></code></pre></div>
<ul>
<li><p>Ahora estamos listos para utilizar un modelo de regresión logística para predecir la supervivencia. La biblioteca scikit-learn tiene una función de regresión logística en la subcarpeta learn model.</p></li>
<li><p>Hagamos un modelo de regresión logística que sólo utilice la variable Sexo como predictor.</p></li>
<li><p>Antes de crear un modelo con la variable sexo, necesitamos convertirla a un número real porque las funciones de aprendizaje automático de sklearn sólo tratan con números reales.</p></li>
<li><p>Podemos convertir una variable categórica como en un número utilizando la función de preprocesamiento de sklearn LabelEncoder():</p></li>
</ul>
<div class="sourceCode" id="cb856"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb856-1"><a href="#cb856-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> linear_model</span>
<span id="cb856-2"><a href="#cb856-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> preprocessing</span>
<span id="cb856-3"><a href="#cb856-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb856-4"><a href="#cb856-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize label encoder</span></span>
<span id="cb856-5"><a href="#cb856-5" aria-hidden="true" tabindex="-1"></a>label_encoder <span class="op">=</span> preprocessing.LabelEncoder()</span>
<span id="cb856-6"><a href="#cb856-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb856-7"><a href="#cb856-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert Sex variable to numeric</span></span>
<span id="cb856-8"><a href="#cb856-8" aria-hidden="true" tabindex="-1"></a>encoded_sex <span class="op">=</span> label_encoder.fit_transform(titanic_train[<span class="st">&quot;Sex&quot;</span>])</span>
<span id="cb856-9"><a href="#cb856-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb856-10"><a href="#cb856-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize logistic regression model</span></span>
<span id="cb856-11"><a href="#cb856-11" aria-hidden="true" tabindex="-1"></a>log_model <span class="op">=</span> linear_model.LogisticRegression(solver <span class="op">=</span> <span class="st">&#39;lbfgs&#39;</span>)</span>
<span id="cb856-12"><a href="#cb856-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb856-13"><a href="#cb856-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the model</span></span>
<span id="cb856-14"><a href="#cb856-14" aria-hidden="true" tabindex="-1"></a>log_model.fit(X <span class="op">=</span> pd.DataFrame(encoded_sex), </span>
<span id="cb856-15"><a href="#cb856-15" aria-hidden="true" tabindex="-1"></a>              y <span class="op">=</span> titanic_train[<span class="st">&quot;Survived&quot;</span>])</span>
<span id="cb856-16"><a href="#cb856-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb856-17"><a href="#cb856-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Check trained model intercept</span></span>
<span id="cb856-18"><a href="#cb856-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(log_model.intercept_)</span>
<span id="cb856-19"><a href="#cb856-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb856-20"><a href="#cb856-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Check trained model coefficients</span></span>
<span id="cb856-21"><a href="#cb856-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(log_model.coef_)</span></code></pre></div>
<p>Los coeficientes del modelo de regresión logística son similares a los resultados de la regresión lineal. Podemos ver que el modelo produjo un valor de intercepción positivo y un peso de -2,421 en el género. Utilicemos el modelo para hacer predicciones en el conjunto de pruebas:</p>
<div class="sourceCode" id="cb857"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb857-1"><a href="#cb857-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions</span></span>
<span id="cb857-2"><a href="#cb857-2" aria-hidden="true" tabindex="-1"></a>preds <span class="op">=</span> log_model.predict_proba(X<span class="op">=</span> pd.DataFrame(encoded_sex))</span>
<span id="cb857-3"><a href="#cb857-3" aria-hidden="true" tabindex="-1"></a>preds <span class="op">=</span> pd.DataFrame(preds)</span>
<span id="cb857-4"><a href="#cb857-4" aria-hidden="true" tabindex="-1"></a>preds.columns <span class="op">=</span> [<span class="st">&quot;Death_prob&quot;</span>, <span class="st">&quot;Survival_prob&quot;</span>]</span>
<span id="cb857-5"><a href="#cb857-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb857-6"><a href="#cb857-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate table of predictions vs Sex</span></span>
<span id="cb857-7"><a href="#cb857-7" aria-hidden="true" tabindex="-1"></a>pd.crosstab(titanic_train[<span class="st">&quot;Sex&quot;</span>], preds.loc[:, <span class="st">&quot;Survival_prob&quot;</span>])</span></code></pre></div>
<p><em>Nota: Utilice model.predict_proba() para obtener las probabilidades de clase predichas. Utilice model.predict() para obtener las clases predichas.</em></p>
<p>La tabla muestra que el modelo predijo una probabilidad de supervivencia de aproximadamente el 19% para los hombres y el 73% para las mujeres. Si utilizamos este modelo simple para predecir la supervivencia, acabaríamos prediciendo que todas las mujeres sobrevivieron y que todos los hombres murieron. Hagamos un modelo más complicado que incluya algunas variables más del conjunto de entrenamiento del titán:</p>
<div class="sourceCode" id="cb858"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb858-1"><a href="#cb858-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert more variables to numeric</span></span>
<span id="cb858-2"><a href="#cb858-2" aria-hidden="true" tabindex="-1"></a>encoded_class <span class="op">=</span> label_encoder.fit_transform(titanic_train[<span class="st">&quot;Pclass&quot;</span>])</span>
<span id="cb858-3"><a href="#cb858-3" aria-hidden="true" tabindex="-1"></a>encoded_cabin <span class="op">=</span> label_encoder.fit_transform(titanic_train[<span class="st">&quot;Cabin&quot;</span>])</span>
<span id="cb858-4"><a href="#cb858-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb858-5"><a href="#cb858-5" aria-hidden="true" tabindex="-1"></a>train_features <span class="op">=</span> pd.DataFrame([encoded_class,</span>
<span id="cb858-6"><a href="#cb858-6" aria-hidden="true" tabindex="-1"></a>                              encoded_cabin,</span>
<span id="cb858-7"><a href="#cb858-7" aria-hidden="true" tabindex="-1"></a>                              encoded_sex,</span>
<span id="cb858-8"><a href="#cb858-8" aria-hidden="true" tabindex="-1"></a>                              titanic_train[<span class="st">&quot;Age&quot;</span>]]).T</span>
<span id="cb858-9"><a href="#cb858-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb858-10"><a href="#cb858-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize logistic regression model</span></span>
<span id="cb858-11"><a href="#cb858-11" aria-hidden="true" tabindex="-1"></a>log_model <span class="op">=</span> linear_model.LogisticRegression(solver <span class="op">=</span> <span class="st">&#39;lbfgs&#39;</span>)</span>
<span id="cb858-12"><a href="#cb858-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb858-13"><a href="#cb858-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the model</span></span>
<span id="cb858-14"><a href="#cb858-14" aria-hidden="true" tabindex="-1"></a>log_model.fit(X <span class="op">=</span> train_features ,</span>
<span id="cb858-15"><a href="#cb858-15" aria-hidden="true" tabindex="-1"></a>              y <span class="op">=</span> titanic_train[<span class="st">&quot;Survived&quot;</span>])</span>
<span id="cb858-16"><a href="#cb858-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb858-17"><a href="#cb858-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Check trained model intercept</span></span>
<span id="cb858-18"><a href="#cb858-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(log_model.intercept_)</span>
<span id="cb858-19"><a href="#cb858-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb858-20"><a href="#cb858-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Check trained model coefficients</span></span>
<span id="cb858-21"><a href="#cb858-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(log_model.coef_)</span></code></pre></div>
<p>A continuación, vamos a hacer predicciones de clase utilizando este modelo y luego compararemos las predicciones con los valores reales:</p>
<div class="sourceCode" id="cb859"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb859-1"><a href="#cb859-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions</span></span>
<span id="cb859-2"><a href="#cb859-2" aria-hidden="true" tabindex="-1"></a>preds <span class="op">=</span> log_model.predict(X<span class="op">=</span> train_features)</span>
<span id="cb859-3"><a href="#cb859-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb859-4"><a href="#cb859-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate table of predictions vs actual</span></span>
<span id="cb859-5"><a href="#cb859-5" aria-hidden="true" tabindex="-1"></a>pd.crosstab(preds,titanic_train[<span class="st">&quot;Survived&quot;</span>])</span></code></pre></div>
<p>La tabla anterior muestra las clases que nuestro modelo predijo frente a los valores reales de la variable Supervivencia. Esta tabla de valores predichos frente a los reales se conoce como matriz de confusión.</p>
</div>
</div>
<div id="matching" class="section level3 hasAnchor" number="4.7.6">
<h3 class="hasAnchor"><span class="header-section-number">4.7.6</span> Matching<a href="#matching" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To compare results, let’s first look at the treatment effect identified by a true experiment.</p>
<div class="sourceCode" id="cb860"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb860-1"><a href="#cb860-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb860-2"><a href="#cb860-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb860-3"><a href="#cb860-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb860-4"><a href="#cb860-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.formula.api <span class="im">as</span> smf</span>
<span id="cb860-5"><a href="#cb860-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb860-6"><a href="#cb860-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ssl</span>
<span id="cb860-7"><a href="#cb860-7" aria-hidden="true" tabindex="-1"></a>ssl._create_default_https_context <span class="op">=</span> ssl._create_unverified_context</span>
<span id="cb860-8"><a href="#cb860-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb860-9"><a href="#cb860-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> read_data(<span class="bu">file</span>):</span>
<span id="cb860-10"><a href="#cb860-10" aria-hidden="true" tabindex="-1"></a>    full_path <span class="op">=</span> <span class="st">&quot;https://raw.github.com/scunning1975/mixtape/master/&quot;</span> <span class="op">+</span> <span class="bu">file</span></span>
<span id="cb860-11"><a href="#cb860-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb860-12"><a href="#cb860-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.read_stata(full_path)</span></code></pre></div>
<ul>
<li>Before using the propensity score methods for estimating treatment effects, let’s calculate the average treatment effect from the actual experiment.</li>
</ul>
<div class="sourceCode" id="cb861"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb861-1"><a href="#cb861-1" aria-hidden="true" tabindex="-1"></a>nsw_dw <span class="op">=</span> read_data(<span class="st">&#39;nsw_mixtape.dta&#39;</span>)</span>
<span id="cb861-2"><a href="#cb861-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb861-3"><a href="#cb861-3" aria-hidden="true" tabindex="-1"></a>mean1 <span class="op">=</span> nsw_dw[nsw_dw.treat<span class="op">==</span><span class="dv">1</span>].re78.mean()</span>
<span id="cb861-4"><a href="#cb861-4" aria-hidden="true" tabindex="-1"></a>mean0 <span class="op">=</span> nsw_dw[nsw_dw.treat<span class="op">==</span><span class="dv">0</span>].re78.mean()</span>
<span id="cb861-5"><a href="#cb861-5" aria-hidden="true" tabindex="-1"></a>ate <span class="op">=</span> np.unique(mean1 <span class="op">-</span> mean0)[<span class="dv">0</span>]</span>
<span id="cb861-6"><a href="#cb861-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;The experimental ATE estimate is </span><span class="sc">{:.2f}</span><span class="st">&quot;</span>.<span class="bu">format</span>(ate))</span></code></pre></div>
<p>Using the code above, we calculate that the NSW job-training program caused real earnings in 1978 to increase by $1,794.343.</p>
<p>A continuación vamos a ver varios ejemplos en los que estimamos el efecto medio del tratamiento o algunas de sus variantes, como el efecto medio del tratamiento en el grupo tratado o el efecto medio del tratamiento en el grupo no tratado. Pero aquí, en lugar de utilizar el grupo de control experimental del experimento aleatorio original, utilizaremos el grupo de control no experimental de la Current Population Survey. Es muy importante subrayar que, mientras que el grupo de tratamiento es un grupo experimental, el grupo de control consiste ahora en una muestra aleatoria de estadounidenses de ese periodo de tiempo. Por lo tanto, el grupo de control sufre un sesgo de selección extremo, ya que la mayoría de los estadounidenses no funcionarían como contrafactuales para el grupo de trabajadores en apuros que se seleccionó en el programa NSW. A continuación, añadiremos los datos de la CPS a los datos experimentales y estimaremos la puntuación de propensión utilizando logit para ser coherentes con Dehejia y Wahba (2002).</p>
<div class="sourceCode" id="cb862"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb862-1"><a href="#cb862-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data for logit </span></span>
<span id="cb862-2"><a href="#cb862-2" aria-hidden="true" tabindex="-1"></a>nsw_dw_cpscontrol <span class="op">=</span> read_data(<span class="st">&#39;cps_mixtape.dta&#39;</span>)</span>
<span id="cb862-3"><a href="#cb862-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb862-4"><a href="#cb862-4" aria-hidden="true" tabindex="-1"></a>nsw_dw_cpscontrol <span class="op">=</span> pd.concat((nsw_dw_cpscontrol, nsw_dw))</span>
<span id="cb862-5"><a href="#cb862-5" aria-hidden="true" tabindex="-1"></a>nsw_dw_cpscontrol[[<span class="st">&#39;u74&#39;</span>, <span class="st">&#39;u75&#39;</span>]] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb862-6"><a href="#cb862-6" aria-hidden="true" tabindex="-1"></a>nsw_dw_cpscontrol.loc[nsw_dw_cpscontrol.re74<span class="op">==</span><span class="dv">0</span>, <span class="st">&#39;u74&#39;</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb862-7"><a href="#cb862-7" aria-hidden="true" tabindex="-1"></a>nsw_dw_cpscontrol.loc[nsw_dw_cpscontrol.re75<span class="op">==</span><span class="dv">0</span>, <span class="st">&#39;u75&#39;</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb862-8"><a href="#cb862-8" aria-hidden="true" tabindex="-1"></a><span class="co"># estimating propensity score</span></span>
<span id="cb862-9"><a href="#cb862-9" aria-hidden="true" tabindex="-1"></a>logit_nsw <span class="op">=</span> smf.glm(formula<span class="op">=</span><span class="st">&quot;&quot;&quot;treat ~ age + age**2 + age**3 + educ + educ**2 + </span></span>
<span id="cb862-10"><a href="#cb862-10" aria-hidden="true" tabindex="-1"></a><span class="st">                    marr + nodegree + black + hisp + re74 + re75 + u74 + u75 + educ*re74&quot;&quot;&quot;</span>, </span>
<span id="cb862-11"><a href="#cb862-11" aria-hidden="true" tabindex="-1"></a>                    family<span class="op">=</span>sm.families.Binomial(),</span>
<span id="cb862-12"><a href="#cb862-12" aria-hidden="true" tabindex="-1"></a>                   data<span class="op">=</span>nsw_dw_cpscontrol).fit()</span>
<span id="cb862-13"><a href="#cb862-13" aria-hidden="true" tabindex="-1"></a>                  </span>
<span id="cb862-14"><a href="#cb862-14" aria-hidden="true" tabindex="-1"></a>nsw_dw_cpscontrol[<span class="st">&#39;pscore&#39;</span>] <span class="op">=</span> logit_nsw.predict(nsw_dw_cpscontrol)</span>
<span id="cb862-15"><a href="#cb862-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb862-16"><a href="#cb862-16" aria-hidden="true" tabindex="-1"></a>nsw_dw_cpscontrol</span>
<span id="cb862-17"><a href="#cb862-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb862-18"><a href="#cb862-18" aria-hidden="true" tabindex="-1"></a>nsw_dw_cpscontrol.groupby(<span class="st">&#39;treat&#39;</span>)[<span class="st">&#39;pscore&#39;</span>].mean()</span>
<span id="cb862-19"><a href="#cb862-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb862-20"><a href="#cb862-20" aria-hidden="true" tabindex="-1"></a>nsw_dw_cpscontrol[<span class="st">&quot;pscore&quot;</span>][nsw_dw_cpscontrol[<span class="st">&quot;treat&quot;</span>] <span class="op">==</span> <span class="dv">1</span>]</span>
<span id="cb862-21"><a href="#cb862-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb862-22"><a href="#cb862-22" aria-hidden="true" tabindex="-1"></a><span class="co"># histogram</span></span>
<span id="cb862-23"><a href="#cb862-23" aria-hidden="true" tabindex="-1"></a>plt.hist(nsw_dw_cpscontrol[<span class="st">&quot;pscore&quot;</span>][nsw_dw_cpscontrol[<span class="st">&quot;treat&quot;</span>] <span class="op">==</span> <span class="dv">1</span>])</span>
<span id="cb862-24"><a href="#cb862-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb862-25"><a href="#cb862-25" aria-hidden="true" tabindex="-1"></a>plt.hist(nsw_dw_cpscontrol[<span class="st">&quot;pscore&quot;</span>][nsw_dw_cpscontrol[<span class="st">&quot;treat&quot;</span>] <span class="op">==</span> <span class="dv">0</span>])</span></code></pre></div>
<p>Recordemos lo que hace la ponderación probabilística inversa. Está ponderando las unidades de tratamiento y control según
la puntuación p, lo que hace que las unidades con valores muy pequeños de la puntuación de propensión se disparen y se vuelvan inusualmente influyentes en el cálculo del TCA.</p>
<div class="sourceCode" id="cb863"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb863-1"><a href="#cb863-1" aria-hidden="true" tabindex="-1"></a><span class="co"># continuation</span></span>
<span id="cb863-2"><a href="#cb863-2" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> nsw_dw_cpscontrol.shape[<span class="dv">0</span>]</span>
<span id="cb863-3"><a href="#cb863-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb863-4"><a href="#cb863-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Manual with non-normalized weights using all data</span></span>
<span id="cb863-5"><a href="#cb863-5" aria-hidden="true" tabindex="-1"></a>nsw_dw_cpscontrol <span class="op">=</span> nsw_dw_cpscontrol </span>
<span id="cb863-6"><a href="#cb863-6" aria-hidden="true" tabindex="-1"></a>nsw_dw_cpscontrol[<span class="st">&#39;d1&#39;</span>] <span class="op">=</span> nsw_dw_cpscontrol.treat<span class="op">/</span>nsw_dw_cpscontrol.pscore</span>
<span id="cb863-7"><a href="#cb863-7" aria-hidden="true" tabindex="-1"></a>nsw_dw_cpscontrol[<span class="st">&#39;d0&#39;</span>] <span class="op">=</span> (<span class="dv">1</span><span class="op">-</span>nsw_dw_cpscontrol.treat)<span class="op">/</span>(<span class="dv">1</span><span class="op">-</span>nsw_dw_cpscontrol.pscore)</span>
<span id="cb863-8"><a href="#cb863-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb863-9"><a href="#cb863-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb863-10"><a href="#cb863-10" aria-hidden="true" tabindex="-1"></a>s1 <span class="op">=</span> nsw_dw_cpscontrol.d1.<span class="bu">sum</span>()</span>
<span id="cb863-11"><a href="#cb863-11" aria-hidden="true" tabindex="-1"></a>s0 <span class="op">=</span> nsw_dw_cpscontrol.d0.<span class="bu">sum</span>()</span>
<span id="cb863-12"><a href="#cb863-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb863-13"><a href="#cb863-13" aria-hidden="true" tabindex="-1"></a>nsw_dw_cpscontrol[<span class="st">&#39;y1&#39;</span>] <span class="op">=</span> nsw_dw_cpscontrol.treat <span class="op">*</span> nsw_dw_cpscontrol.re78 <span class="op">/</span> nsw_dw_cpscontrol.pscore</span>
<span id="cb863-14"><a href="#cb863-14" aria-hidden="true" tabindex="-1"></a>nsw_dw_cpscontrol[<span class="st">&#39;y0&#39;</span>] <span class="op">=</span> (<span class="dv">1</span> <span class="op">-</span> nsw_dw_cpscontrol.treat) <span class="op">*</span> nsw_dw_cpscontrol.re78 <span class="op">/</span> (<span class="dv">1</span> <span class="op">-</span> nsw_dw_cpscontrol.pscore)</span>
<span id="cb863-15"><a href="#cb863-15" aria-hidden="true" tabindex="-1"></a>nsw_dw_cpscontrol[<span class="st">&#39;ht&#39;</span>] <span class="op">=</span> nsw_dw_cpscontrol[<span class="st">&#39;y1&#39;</span>] <span class="op">-</span> nsw_dw_cpscontrol[<span class="st">&#39;y0&#39;</span>]</span>
<span id="cb863-16"><a href="#cb863-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb863-17"><a href="#cb863-17" aria-hidden="true" tabindex="-1"></a>te_1 <span class="op">=</span> nsw_dw_cpscontrol.ht.mean()</span>
<span id="cb863-18"><a href="#cb863-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb863-19"><a href="#cb863-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Treatment Effect (non-normalized, all data): </span><span class="sc">{:.2f}</span><span class="st">&quot;</span>.<span class="bu">format</span>(te_1))</span>
<span id="cb863-20"><a href="#cb863-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb863-21"><a href="#cb863-21" aria-hidden="true" tabindex="-1"></a>nsw_dw_cpscontrol[<span class="st">&#39;y1&#39;</span>] <span class="op">=</span> nsw_dw_cpscontrol.treat <span class="op">*</span> nsw_dw_cpscontrol.re78 <span class="op">/</span> nsw_dw_cpscontrol.pscore</span>
<span id="cb863-22"><a href="#cb863-22" aria-hidden="true" tabindex="-1"></a>nsw_dw_cpscontrol[<span class="st">&#39;y1&#39;</span>] <span class="op">/=</span> s1<span class="op">/</span>N</span>
<span id="cb863-23"><a href="#cb863-23" aria-hidden="true" tabindex="-1"></a>nsw_dw_cpscontrol[<span class="st">&#39;y0&#39;</span>] <span class="op">=</span> (<span class="dv">1</span> <span class="op">-</span> nsw_dw_cpscontrol.treat) <span class="op">*</span> nsw_dw_cpscontrol.re78 <span class="op">/</span> (<span class="dv">1</span> <span class="op">-</span> nsw_dw_cpscontrol.pscore)</span>
<span id="cb863-24"><a href="#cb863-24" aria-hidden="true" tabindex="-1"></a>nsw_dw_cpscontrol[<span class="st">&#39;y0&#39;</span>] <span class="op">/=</span> s0<span class="op">/</span>N</span>
<span id="cb863-25"><a href="#cb863-25" aria-hidden="true" tabindex="-1"></a>nsw_dw_cpscontrol[<span class="st">&#39;ht&#39;</span>] <span class="op">=</span> nsw_dw_cpscontrol[<span class="st">&#39;y1&#39;</span>] <span class="op">-</span> nsw_dw_cpscontrol[<span class="st">&#39;y0&#39;</span>]</span>
<span id="cb863-26"><a href="#cb863-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb863-27"><a href="#cb863-27" aria-hidden="true" tabindex="-1"></a>te_2 <span class="op">=</span> nsw_dw_cpscontrol.ht.mean()</span>
<span id="cb863-28"><a href="#cb863-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb863-29"><a href="#cb863-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Treatment Effect (normalized, all data): </span><span class="sc">{:.2f}</span><span class="st">&quot;</span>.<span class="bu">format</span>(te_2))</span>
<span id="cb863-30"><a href="#cb863-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb863-31"><a href="#cb863-31" aria-hidden="true" tabindex="-1"></a>nsw_dw_trimmed <span class="op">=</span> nsw_dw_cpscontrol.drop([<span class="st">&#39;d1&#39;</span>, <span class="st">&#39;d0&#39;</span>, <span class="st">&#39;y1&#39;</span>, <span class="st">&#39;y0&#39;</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb863-32"><a href="#cb863-32" aria-hidden="true" tabindex="-1"></a>nsw_dw_trimmed <span class="op">=</span> nsw_dw_trimmed[nsw_dw_trimmed.pscore.between(<span class="fl">.1</span>, <span class="fl">.9</span>)]</span>
<span id="cb863-33"><a href="#cb863-33" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> nsw_dw_trimmed.shape[<span class="dv">0</span>]</span>
<span id="cb863-34"><a href="#cb863-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb863-35"><a href="#cb863-35" aria-hidden="true" tabindex="-1"></a>nsw_dw_trimmed[<span class="st">&#39;y1&#39;</span>] <span class="op">=</span> nsw_dw_trimmed.treat <span class="op">*</span> nsw_dw_trimmed.re78 <span class="op">/</span> nsw_dw_trimmed.pscore</span>
<span id="cb863-36"><a href="#cb863-36" aria-hidden="true" tabindex="-1"></a>nsw_dw_trimmed[<span class="st">&#39;y0&#39;</span>] <span class="op">=</span> (<span class="dv">1</span> <span class="op">-</span> nsw_dw_trimmed.treat) <span class="op">*</span> nsw_dw_trimmed.re78 <span class="op">/</span> (<span class="dv">1</span> <span class="op">-</span> nsw_dw_trimmed.pscore)</span>
<span id="cb863-37"><a href="#cb863-37" aria-hidden="true" tabindex="-1"></a>nsw_dw_trimmed[<span class="st">&#39;ht&#39;</span>] <span class="op">=</span> nsw_dw_trimmed[<span class="st">&#39;y1&#39;</span>] <span class="op">-</span> nsw_dw_trimmed[<span class="st">&#39;y0&#39;</span>]</span>
<span id="cb863-38"><a href="#cb863-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb863-39"><a href="#cb863-39" aria-hidden="true" tabindex="-1"></a>te_3 <span class="op">=</span> nsw_dw_trimmed.ht.mean()</span>
<span id="cb863-40"><a href="#cb863-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb863-41"><a href="#cb863-41" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Treatment Effect (non-normalized, trimmed data): </span><span class="sc">{:.2f}</span><span class="st">&quot;</span>.<span class="bu">format</span>(te_3))</span>
<span id="cb863-42"><a href="#cb863-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb863-43"><a href="#cb863-43" aria-hidden="true" tabindex="-1"></a>nsw_dw_trimmed[<span class="st">&#39;y1&#39;</span>] <span class="op">=</span> nsw_dw_trimmed.treat <span class="op">*</span> nsw_dw_trimmed.re78 <span class="op">/</span> nsw_dw_trimmed.pscore</span>
<span id="cb863-44"><a href="#cb863-44" aria-hidden="true" tabindex="-1"></a>nsw_dw_trimmed[<span class="st">&#39;y1&#39;</span>] <span class="op">/=</span> s1<span class="op">/</span>N</span>
<span id="cb863-45"><a href="#cb863-45" aria-hidden="true" tabindex="-1"></a>nsw_dw_trimmed[<span class="st">&#39;y0&#39;</span>] <span class="op">=</span> (<span class="dv">1</span> <span class="op">-</span> nsw_dw_trimmed.treat) <span class="op">*</span> nsw_dw_trimmed.re78 <span class="op">/</span> (<span class="dv">1</span> <span class="op">-</span> nsw_dw_trimmed.pscore)</span>
<span id="cb863-46"><a href="#cb863-46" aria-hidden="true" tabindex="-1"></a>nsw_dw_trimmed[<span class="st">&#39;y0&#39;</span>] <span class="op">/=</span> s0<span class="op">/</span>N</span>
<span id="cb863-47"><a href="#cb863-47" aria-hidden="true" tabindex="-1"></a>nsw_dw_trimmed[<span class="st">&#39;ht&#39;</span>] <span class="op">=</span> nsw_dw_trimmed[<span class="st">&#39;y1&#39;</span>] <span class="op">-</span> nsw_dw_trimmed[<span class="st">&#39;y0&#39;</span>]</span>
<span id="cb863-48"><a href="#cb863-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb863-49"><a href="#cb863-49" aria-hidden="true" tabindex="-1"></a>te_4 <span class="op">=</span> nsw_dw_trimmed.ht.mean()</span>
<span id="cb863-50"><a href="#cb863-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb863-51"><a href="#cb863-51" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Treatment Effect (normalized, trimmed data): </span><span class="sc">{:.2f}</span><span class="st">&quot;</span>.<span class="bu">format</span>(te_4))</span></code></pre></div>
</div>
</div>
<div id="análisis-de-datos-parte-iii" class="section level2 hasAnchor" number="4.8">
<h2 class="hasAnchor"><span class="header-section-number">4.8</span> Análisis de Datos (Parte III)<a href="#análisis-de-datos-parte-iii" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="bootstraping-en-el-contexto-de-mco" class="section level3 hasAnchor" number="4.8.1">
<h3 class="hasAnchor"><span class="header-section-number">4.8.1</span> Bootstraping en el contexto de MCO<a href="#bootstraping-en-el-contexto-de-mco" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb864"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb864-1"><a href="#cb864-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb864-2"><a href="#cb864-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb864-3"><a href="#cb864-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb864-4"><a href="#cb864-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.formula.api <span class="im">as</span> sm</span>
<span id="cb864-5"><a href="#cb864-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb864-6"><a href="#cb864-6" aria-hidden="true" tabindex="-1"></a><span class="co"># synthetic sample data</span></span>
<span id="cb864-7"><a href="#cb864-7" aria-hidden="true" tabindex="-1"></a>n_points <span class="op">=</span> <span class="dv">25</span></span>
<span id="cb864-8"><a href="#cb864-8" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">10</span>, n_points)</span>
<span id="cb864-9"><a href="#cb864-9" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> x <span class="op">+</span> (np.random.rand(<span class="bu">len</span>(x)) <span class="op">*</span> <span class="dv">5</span>)</span>
<span id="cb864-10"><a href="#cb864-10" aria-hidden="true" tabindex="-1"></a>data_df <span class="op">=</span> pd.DataFrame({<span class="st">&quot;x&quot;</span>: x, <span class="st">&quot;y&quot;</span>: y})</span>
<span id="cb864-11"><a href="#cb864-11" aria-hidden="true" tabindex="-1"></a>ols_model <span class="op">=</span> sm.ols(formula <span class="op">=</span> <span class="st">&quot;y ~ x&quot;</span>, data<span class="op">=</span>data_df)</span>
<span id="cb864-12"><a href="#cb864-12" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> ols_model.fit()</span>
<span id="cb864-13"><a href="#cb864-13" aria-hidden="true" tabindex="-1"></a><span class="co"># coefficients</span></span>
<span id="cb864-14"><a href="#cb864-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Intercept, x-Slope : </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(results.params))</span>
<span id="cb864-15"><a href="#cb864-15" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> ols_model.fit().predict(data_df[<span class="st">&quot;x&quot;</span>])</span>
<span id="cb864-16"><a href="#cb864-16" aria-hidden="true" tabindex="-1"></a><span class="co"># plot results</span></span>
<span id="cb864-17"><a href="#cb864-17" aria-hidden="true" tabindex="-1"></a>plt.scatter(x, y)</span>
<span id="cb864-18"><a href="#cb864-18" aria-hidden="true" tabindex="-1"></a>plt.plot(x, y_pred, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb864-19"><a href="#cb864-19" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb864-20"><a href="#cb864-20" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;x&quot;</span>)</span>
<span id="cb864-21"><a href="#cb864-21" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;y&quot;</span>)</span>
<span id="cb864-22"><a href="#cb864-22" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;x vs y&quot;</span>)</span>
<span id="cb864-23"><a href="#cb864-23" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb864-24"><a href="#cb864-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb864-25"><a href="#cb864-25" aria-hidden="true" tabindex="-1"></a><span class="co"># resample with replacement each row</span></span>
<span id="cb864-26"><a href="#cb864-26" aria-hidden="true" tabindex="-1"></a>boot_slopes <span class="op">=</span> []</span>
<span id="cb864-27"><a href="#cb864-27" aria-hidden="true" tabindex="-1"></a>boot_interc <span class="op">=</span> []</span>
<span id="cb864-28"><a href="#cb864-28" aria-hidden="true" tabindex="-1"></a>n_boots <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb864-29"><a href="#cb864-29" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb864-30"><a href="#cb864-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb864-31"><a href="#cb864-31" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(n_boots):</span>
<span id="cb864-32"><a href="#cb864-32" aria-hidden="true" tabindex="-1"></a> <span class="co"># sample the rows, same size, with replacement</span></span>
<span id="cb864-33"><a href="#cb864-33" aria-hidden="true" tabindex="-1"></a> sample_df <span class="op">=</span> data_df.sample(n<span class="op">=</span>n_points, replace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb864-34"><a href="#cb864-34" aria-hidden="true" tabindex="-1"></a> <span class="co"># fit a linear regression</span></span>
<span id="cb864-35"><a href="#cb864-35" aria-hidden="true" tabindex="-1"></a> ols_model_temp <span class="op">=</span> sm.ols(formula <span class="op">=</span> <span class="st">&quot;y ~ x&quot;</span>, data<span class="op">=</span>sample_df)</span>
<span id="cb864-36"><a href="#cb864-36" aria-hidden="true" tabindex="-1"></a> results_temp <span class="op">=</span> ols_model_temp.fit()</span>
<span id="cb864-37"><a href="#cb864-37" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb864-38"><a href="#cb864-38" aria-hidden="true" tabindex="-1"></a> <span class="co"># append coefficients</span></span>
<span id="cb864-39"><a href="#cb864-39" aria-hidden="true" tabindex="-1"></a> boot_interc.append(results_temp.params[<span class="dv">0</span>])</span>
<span id="cb864-40"><a href="#cb864-40" aria-hidden="true" tabindex="-1"></a> boot_slopes.append(results_temp.params[<span class="dv">1</span>])</span>
<span id="cb864-41"><a href="#cb864-41" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb864-42"><a href="#cb864-42" aria-hidden="true" tabindex="-1"></a> <span class="co"># plot a greyed out line</span></span>
<span id="cb864-43"><a href="#cb864-43" aria-hidden="true" tabindex="-1"></a> y_pred_temp <span class="op">=</span> ols_model_temp.fit().predict(sample_df[<span class="st">&quot;x&quot;</span>])</span>
<span id="cb864-44"><a href="#cb864-44" aria-hidden="true" tabindex="-1"></a> plt.plot(sample_df[<span class="st">&quot;x&quot;</span>], y_pred_temp, color<span class="op">=</span><span class="st">&quot;grey&quot;</span>, alpha<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb864-45"><a href="#cb864-45" aria-hidden="true" tabindex="-1"></a><span class="co"># add data points</span></span>
<span id="cb864-46"><a href="#cb864-46" aria-hidden="true" tabindex="-1"></a>plt.scatter(x, y)</span>
<span id="cb864-47"><a href="#cb864-47" aria-hidden="true" tabindex="-1"></a>plt.plot(x, y_pred, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb864-48"><a href="#cb864-48" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb864-49"><a href="#cb864-49" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;x&quot;</span>)</span>
<span id="cb864-50"><a href="#cb864-50" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;y&quot;</span>)</span>
<span id="cb864-51"><a href="#cb864-51" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;x vs y&quot;</span>)</span>
<span id="cb864-52"><a href="#cb864-52" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb864-53"><a href="#cb864-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb864-54"><a href="#cb864-54" aria-hidden="true" tabindex="-1"></a>sns.distplot(boot_slopes)</span>
<span id="cb864-55"><a href="#cb864-55" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb864-56"><a href="#cb864-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb864-57"><a href="#cb864-57" aria-hidden="true" tabindex="-1"></a>sns.distplot(boot_interc)</span>
<span id="cb864-58"><a href="#cb864-58" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<ul>
<li><p>Los datos anteriores pintan una bonita imagen del bootstrapping paramétrico.</p></li>
<li><p>Sin embargo, si por casualidad, y esto es lo más probable, tuviéramos datos dispersos, podría existir la posibilidad de que nuestra selección aleatoria de puntos se encontrara totalmente en una zona y no en otra - recordemos la mención de que el valor atípico puede ser muestreado varias veces a pesar de ser un único punto atípico.</p></li>
<li><p>Para luchar contra esto, podemos aplicar un tipo diferente de bootstrapping, llamado “bootstrapping no paramétrico”, por el que aplicamos el bootstrapping en los residuos, y no en el propio parámetro.</p></li>
<li><p>En resumen…</p></li>
<li><p>Bootstrap y la simulación de Montecarlo de una estadística: ambos se basan en la repetición del muestreo y en el examen directo de los resultados.</p></li>
<li><p>Sin embargo, una gran diferencia entre los métodos es que el bootstrap utiliza la muestra inicial original como población de la que se vuelve a tomar la muestra, mientras que la simulación de Montecarlo se basa en establecer un proceso de generación de datos (con valores conocidos de los parámetros).</p></li>
<li><p>Mientras que Monte Carlo se utiliza para probar los estimadores de la unidad, los métodos de bootstrap pueden utilizarse para estimar la variabilidad de un estadístico y la forma de su distribución muestral.</p></li>
</ul>
<div class="sourceCode" id="cb865"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb865-1"><a href="#cb865-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb865-2"><a href="#cb865-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb865-3"><a href="#cb865-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib</span>
<span id="cb865-4"><a href="#cb865-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb865-5"><a href="#cb865-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.stats <span class="im">as</span> stats</span></code></pre></div>
<ul>
<li><p>La función sigmoide está limitada por debajo por 0 y por encima por 1.</p></li>
<li><p>En la regresión logística, el resultado se interpreta como una probabilidad: la probabilidad de que una observación pertenezca a la segunda de las dos categorías modeladas. Cuando la combinación lineal de variables produce números positivos, la probabilidad resultante es mayor que 0,5 y cuando produce números negativos, la probabilidad es menor que 0,5.</p></li>
</ul>
<p>No profundizaremos en los detalles de cómo funciona la regresión logística, sino que nos centraremos en cómo utilizarla en Python. Lo más importante es saber que la reg&lt;resión logística produce probabilidades que podemos utilizar para clasificar las observaciones.</p>
</div>
<div id="logit-probabilidad-de-sobrevivir-al-hundimiento-del-titanic" class="section level3 hasAnchor" number="4.8.2">
<h3 class="hasAnchor"><span class="header-section-number">4.8.2</span> Logit: Probabilidad de sobrevivir al hundimiento del Titanic<a href="#logit-probabilidad-de-sobrevivir-al-hundimiento-del-titanic" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb866"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb866-1"><a href="#cb866-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb866-2"><a href="#cb866-2" aria-hidden="true" tabindex="-1"></a>os.chdir(<span class="st">&quot;datos&quot;</span>)</span>
<span id="cb866-3"><a href="#cb866-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb866-4"><a href="#cb866-4" aria-hidden="true" tabindex="-1"></a>titanic_train <span class="op">=</span> pd.read_csv(<span class="st">&quot;train.csv&quot;</span>)    <span class="co"># Read the data</span></span>
<span id="cb866-5"><a href="#cb866-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb866-6"><a href="#cb866-6" aria-hidden="true" tabindex="-1"></a>char_cabin <span class="op">=</span> titanic_train[<span class="st">&quot;Cabin&quot;</span>].astype(<span class="bu">str</span>)     <span class="co"># Convert cabin to str</span></span>
<span id="cb866-7"><a href="#cb866-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb866-8"><a href="#cb866-8" aria-hidden="true" tabindex="-1"></a>new_Cabin <span class="op">=</span> np.array([cabin[<span class="dv">0</span>] <span class="cf">for</span> cabin <span class="kw">in</span> char_cabin]) <span class="co"># Take first letter</span></span>
<span id="cb866-9"><a href="#cb866-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb866-10"><a href="#cb866-10" aria-hidden="true" tabindex="-1"></a>titanic_train[<span class="st">&quot;Cabin&quot;</span>] <span class="op">=</span> pd.Categorical(new_Cabin)  <span class="co"># Save the new cabin var</span></span>
<span id="cb866-11"><a href="#cb866-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb866-12"><a href="#cb866-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Impute median Age for NA Age values</span></span>
<span id="cb866-13"><a href="#cb866-13" aria-hidden="true" tabindex="-1"></a>new_age_var <span class="op">=</span> np.where(titanic_train[<span class="st">&quot;Age&quot;</span>].isnull(), <span class="co"># Logical check</span></span>
<span id="cb866-14"><a href="#cb866-14" aria-hidden="true" tabindex="-1"></a>                       <span class="dv">28</span>,                       <span class="co"># Value if check is true</span></span>
<span id="cb866-15"><a href="#cb866-15" aria-hidden="true" tabindex="-1"></a>                       titanic_train[<span class="st">&quot;Age&quot;</span>])     <span class="co"># Value if check is false</span></span>
<span id="cb866-16"><a href="#cb866-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb866-17"><a href="#cb866-17" aria-hidden="true" tabindex="-1"></a>titanic_train[<span class="st">&quot;Age&quot;</span>] <span class="op">=</span> new_age_var </span>
<span id="cb866-18"><a href="#cb866-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb866-19"><a href="#cb866-19" aria-hidden="true" tabindex="-1"></a>new_fare_var <span class="op">=</span> np.where(titanic_train[<span class="st">&quot;Fare&quot;</span>].isnull(), <span class="co"># Logical check</span></span>
<span id="cb866-20"><a href="#cb866-20" aria-hidden="true" tabindex="-1"></a>                       <span class="dv">50</span>,                         <span class="co"># Value if check is true</span></span>
<span id="cb866-21"><a href="#cb866-21" aria-hidden="true" tabindex="-1"></a>                       titanic_train[<span class="st">&quot;Fare&quot;</span>])     <span class="co"># Value if check is false</span></span>
<span id="cb866-22"><a href="#cb866-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb866-23"><a href="#cb866-23" aria-hidden="true" tabindex="-1"></a>titanic_train[<span class="st">&quot;Fare&quot;</span>] <span class="op">=</span> new_fare_var</span>
<span id="cb866-24"><a href="#cb866-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb866-25"><a href="#cb866-25" aria-hidden="true" tabindex="-1"></a>titanic_train</span></code></pre></div>
<ul>
<li><p>Ahora estamos listos para utilizar un modelo de regresión logística para predecir la supervivencia.</p></li>
<li><p>La biblioteca scikit-learn tiene una función de regresión logística en la subcarpeta linear model.</p></li>
<li><p>Hagamos un modelo de regresión logística que sólo utilice la variable Sexo como predictor.</p></li>
<li><p>Antes de crear un modelo con la variable sexo, necesitamos convertirla a un número real porque las funciones de aprendizaje automático de sklearn sólo tratan con números reales.</p></li>
<li><p>Podemos convertir una variable categórica como en un número utilizando la función de preprocesamiento de sklearn LabelEncoder():</p></li>
</ul>
<div class="sourceCode" id="cb867"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb867-1"><a href="#cb867-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> linear_model</span>
<span id="cb867-2"><a href="#cb867-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> preprocessing</span>
<span id="cb867-3"><a href="#cb867-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb867-4"><a href="#cb867-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize label encoder</span></span>
<span id="cb867-5"><a href="#cb867-5" aria-hidden="true" tabindex="-1"></a>label_encoder <span class="op">=</span> preprocessing.LabelEncoder()</span>
<span id="cb867-6"><a href="#cb867-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb867-7"><a href="#cb867-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert Sex variable to numeric</span></span>
<span id="cb867-8"><a href="#cb867-8" aria-hidden="true" tabindex="-1"></a>encoded_sex <span class="op">=</span> label_encoder.fit_transform(titanic_train[<span class="st">&quot;Sex&quot;</span>])</span>
<span id="cb867-9"><a href="#cb867-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb867-10"><a href="#cb867-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize logistic regression model</span></span>
<span id="cb867-11"><a href="#cb867-11" aria-hidden="true" tabindex="-1"></a>log_model <span class="op">=</span> linear_model.LogisticRegression(solver <span class="op">=</span> <span class="st">&#39;lbfgs&#39;</span>)</span>
<span id="cb867-12"><a href="#cb867-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb867-13"><a href="#cb867-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the model</span></span>
<span id="cb867-14"><a href="#cb867-14" aria-hidden="true" tabindex="-1"></a>log_model.fit(X <span class="op">=</span> pd.DataFrame(encoded_sex), </span>
<span id="cb867-15"><a href="#cb867-15" aria-hidden="true" tabindex="-1"></a>              y <span class="op">=</span> titanic_train[<span class="st">&quot;Survived&quot;</span>])</span>
<span id="cb867-16"><a href="#cb867-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb867-17"><a href="#cb867-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Check trained model intercept</span></span>
<span id="cb867-18"><a href="#cb867-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(log_model.intercept_)</span>
<span id="cb867-19"><a href="#cb867-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb867-20"><a href="#cb867-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Check trained model coefficients</span></span>
<span id="cb867-21"><a href="#cb867-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(log_model.coef_)</span></code></pre></div>
<p>Los coeficientes del modelo de regresión logística son similares a los resultados de la regresión lineal. Podemos ver que el modelo produjo un valor de intercepción positivo y un peso de -2,421 en el género. Utilicemos el modelo para hacer predicciones en el conjunto de pruebas:</p>
<div class="sourceCode" id="cb868"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb868-1"><a href="#cb868-1" aria-hidden="true" tabindex="-1"></a>encoded_sex</span>
<span id="cb868-2"><a href="#cb868-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb868-3"><a href="#cb868-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions</span></span>
<span id="cb868-4"><a href="#cb868-4" aria-hidden="true" tabindex="-1"></a>preds <span class="op">=</span> log_model.predict_proba(X<span class="op">=</span> pd.DataFrame(encoded_sex))</span>
<span id="cb868-5"><a href="#cb868-5" aria-hidden="true" tabindex="-1"></a>preds <span class="op">=</span> pd.DataFrame(preds)</span>
<span id="cb868-6"><a href="#cb868-6" aria-hidden="true" tabindex="-1"></a>preds.columns <span class="op">=</span> [<span class="st">&quot;Death_prob&quot;</span>, <span class="st">&quot;Survival_prob&quot;</span>]</span>
<span id="cb868-7"><a href="#cb868-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb868-8"><a href="#cb868-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate table of predictions vs Sex</span></span>
<span id="cb868-9"><a href="#cb868-9" aria-hidden="true" tabindex="-1"></a>pd.crosstab(titanic_train[<span class="st">&quot;Sex&quot;</span>], preds.loc[:, <span class="st">&quot;Survival_prob&quot;</span>])</span>
<span id="cb868-10"><a href="#cb868-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb868-11"><a href="#cb868-11" aria-hidden="true" tabindex="-1"></a>preds</span></code></pre></div>
<p><em>Nota: Utilice model.predict_proba() para obtener las probabilidades de clase predichas. Utilice model.predict() para obtener las clases predichas.</em></p>
<p>La tabla muestra que el modelo predijo una probabilidad de supervivencia de aproximadamente el 19% para los hombres y el 73% para las mujeres. Si utilizamos este modelo simple para predecir la supervivencia, acabaríamos prediciendo que todas las mujeres sobrevivieron y que todos los hombres murieron. Hagamos un modelo más complicado que incluya algunas variables más del conjunto de entrenamiento del titán:</p>
<div class="sourceCode" id="cb869"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb869-1"><a href="#cb869-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert more variables to numeric</span></span>
<span id="cb869-2"><a href="#cb869-2" aria-hidden="true" tabindex="-1"></a>encoded_class <span class="op">=</span> label_encoder.fit_transform(titanic_train[<span class="st">&quot;Pclass&quot;</span>])</span>
<span id="cb869-3"><a href="#cb869-3" aria-hidden="true" tabindex="-1"></a>encoded_cabin <span class="op">=</span> label_encoder.fit_transform(titanic_train[<span class="st">&quot;Cabin&quot;</span>])</span>
<span id="cb869-4"><a href="#cb869-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb869-5"><a href="#cb869-5" aria-hidden="true" tabindex="-1"></a>train_features <span class="op">=</span> pd.DataFrame([encoded_class,</span>
<span id="cb869-6"><a href="#cb869-6" aria-hidden="true" tabindex="-1"></a>                              encoded_cabin,</span>
<span id="cb869-7"><a href="#cb869-7" aria-hidden="true" tabindex="-1"></a>                              encoded_sex,</span>
<span id="cb869-8"><a href="#cb869-8" aria-hidden="true" tabindex="-1"></a>                              titanic_train[<span class="st">&quot;Age&quot;</span>]]).T</span>
<span id="cb869-9"><a href="#cb869-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb869-10"><a href="#cb869-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize logistic regression model</span></span>
<span id="cb869-11"><a href="#cb869-11" aria-hidden="true" tabindex="-1"></a>log_model <span class="op">=</span> linear_model.LogisticRegression(solver <span class="op">=</span> <span class="st">&#39;lbfgs&#39;</span>)</span>
<span id="cb869-12"><a href="#cb869-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb869-13"><a href="#cb869-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the model</span></span>
<span id="cb869-14"><a href="#cb869-14" aria-hidden="true" tabindex="-1"></a>log_model.fit(X <span class="op">=</span> train_features ,</span>
<span id="cb869-15"><a href="#cb869-15" aria-hidden="true" tabindex="-1"></a>              y <span class="op">=</span> titanic_train[<span class="st">&quot;Survived&quot;</span>])</span>
<span id="cb869-16"><a href="#cb869-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb869-17"><a href="#cb869-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Check trained model intercept</span></span>
<span id="cb869-18"><a href="#cb869-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(log_model.intercept_)</span>
<span id="cb869-19"><a href="#cb869-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb869-20"><a href="#cb869-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Check trained model coefficients</span></span>
<span id="cb869-21"><a href="#cb869-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(log_model.coef_)</span></code></pre></div>
<p>A continuación, vamos a hacer predicciones de clase utilizando este modelo y luego compararemos las predicciones con los valores reales:</p>
<div class="sourceCode" id="cb870"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb870-1"><a href="#cb870-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions</span></span>
<span id="cb870-2"><a href="#cb870-2" aria-hidden="true" tabindex="-1"></a>preds <span class="op">=</span> log_model.predict(X<span class="op">=</span> train_features)</span>
<span id="cb870-3"><a href="#cb870-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb870-4"><a href="#cb870-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate table of predictions vs actual</span></span>
<span id="cb870-5"><a href="#cb870-5" aria-hidden="true" tabindex="-1"></a>pd.crosstab(preds,titanic_train[<span class="st">&quot;Survived&quot;</span>])</span></code></pre></div>
<p>La tabla anterior muestra las clases que nuestro modelo predijo frente a los valores reales de la variable Supervivencia. Esta tabla de valores predichos frente a los reales se conoce como matriz de confusión.</p>
</div>
<div id="gmm" class="section level3 hasAnchor" number="4.8.3">
<h3 class="hasAnchor"><span class="header-section-number">4.8.3</span> GMM<a href="#gmm" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>El método generalizado de momentos (GMM) es un método para construir estimadores, análogo al de máxima verosimilitud (ML). El GMM utiliza suposiciones sobre momentos específicos de las variables aleatorias en lugar de suposiciones sobre toda la distribución, lo que hace que el GMM sea más robusto que el ML, a costa de cierta eficiencia. Los supuestos se denominan condiciones de momento.</li>
</ul>
<div class="sourceCode" id="cb871"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb871-1"><a href="#cb871-1" aria-hidden="true" tabindex="-1"></a><span class="co"># GMM</span></span>
<span id="cb871-2"><a href="#cb871-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb871-3"><a href="#cb871-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numpy <span class="im">import</span> hstack, ones, array, mat, tile, reshape, squeeze, eye, asmatrix</span>
<span id="cb871-4"><a href="#cb871-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numpy.linalg <span class="im">import</span> inv</span>
<span id="cb871-5"><a href="#cb871-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pandas <span class="im">import</span> read_csv, Series </span>
<span id="cb871-6"><a href="#cb871-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.linalg <span class="im">import</span> kron</span>
<span id="cb871-7"><a href="#cb871-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.optimize <span class="im">import</span> fmin_bfgs</span>
<span id="cb871-8"><a href="#cb871-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb871-9"><a href="#cb871-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span></code></pre></div>
<ul>
<li>A continuación se utiliza una función invocable para producir la salida iteración por iteración cuando se utiliza el optimizador no lineal.</li>
</ul>
<div class="sourceCode" id="cb872"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb872-1"><a href="#cb872-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> gmm_objective(params, pRets, fRets, Winv, out<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb872-2"><a href="#cb872-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> lastValue, functionCount</span>
<span id="cb872-3"><a href="#cb872-3" aria-hidden="true" tabindex="-1"></a>    T,N <span class="op">=</span> pRets.shape</span>
<span id="cb872-4"><a href="#cb872-4" aria-hidden="true" tabindex="-1"></a>    T,K <span class="op">=</span> fRets.shape</span>
<span id="cb872-5"><a href="#cb872-5" aria-hidden="true" tabindex="-1"></a>    beta <span class="op">=</span> squeeze(array(params[:(N<span class="op">*</span>K)]))</span>
<span id="cb872-6"><a href="#cb872-6" aria-hidden="true" tabindex="-1"></a>    lam <span class="op">=</span> squeeze(array(params[(N<span class="op">*</span>K):]))</span>
<span id="cb872-7"><a href="#cb872-7" aria-hidden="true" tabindex="-1"></a>    beta <span class="op">=</span> reshape(beta,(N,K))</span>
<span id="cb872-8"><a href="#cb872-8" aria-hidden="true" tabindex="-1"></a>    lam <span class="op">=</span> reshape(lam,(K,<span class="dv">1</span>))</span>
<span id="cb872-9"><a href="#cb872-9" aria-hidden="true" tabindex="-1"></a>    betalam <span class="op">=</span> beta <span class="op">@</span> lam</span>
<span id="cb872-10"><a href="#cb872-10" aria-hidden="true" tabindex="-1"></a>    expectedRet <span class="op">=</span> fRets <span class="op">@</span> beta.T</span>
<span id="cb872-11"><a href="#cb872-11" aria-hidden="true" tabindex="-1"></a>    e <span class="op">=</span> pRets <span class="op">-</span> expectedRet</span>
<span id="cb872-12"><a href="#cb872-12" aria-hidden="true" tabindex="-1"></a>    instr <span class="op">=</span> tile(fRets,N)</span>
<span id="cb872-13"><a href="#cb872-13" aria-hidden="true" tabindex="-1"></a>    moments1  <span class="op">=</span> kron(e,ones((<span class="dv">1</span>,K)))</span>
<span id="cb872-14"><a href="#cb872-14" aria-hidden="true" tabindex="-1"></a>    moments1 <span class="op">=</span> moments1 <span class="op">*</span> instr</span>
<span id="cb872-15"><a href="#cb872-15" aria-hidden="true" tabindex="-1"></a>    moments2 <span class="op">=</span> pRets <span class="op">-</span> betalam.T</span>
<span id="cb872-16"><a href="#cb872-16" aria-hidden="true" tabindex="-1"></a>    moments <span class="op">=</span> hstack((moments1,moments2))</span>
<span id="cb872-17"><a href="#cb872-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb872-18"><a href="#cb872-18" aria-hidden="true" tabindex="-1"></a>    avgMoment <span class="op">=</span> moments.mean(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb872-19"><a href="#cb872-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb872-20"><a href="#cb872-20" aria-hidden="true" tabindex="-1"></a>    J <span class="op">=</span> T <span class="op">*</span> mat(avgMoment) <span class="op">*</span> mat(Winv) <span class="op">*</span> mat(avgMoment).T</span>
<span id="cb872-21"><a href="#cb872-21" aria-hidden="true" tabindex="-1"></a>    J <span class="op">=</span> J[<span class="dv">0</span>,<span class="dv">0</span>]</span>
<span id="cb872-22"><a href="#cb872-22" aria-hidden="true" tabindex="-1"></a>    lastValue <span class="op">=</span> J</span>
<span id="cb872-23"><a href="#cb872-23" aria-hidden="true" tabindex="-1"></a>    functionCount <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb872-24"><a href="#cb872-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> out:</span>
<span id="cb872-25"><a href="#cb872-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> J</span>
<span id="cb872-26"><a href="#cb872-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb872-27"><a href="#cb872-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> J, moments</span></code></pre></div>
<ul>
<li>Se define la matriz G, que es la derivada de los momentos del GMM con respecto a los parámetros.</li>
</ul>
<div class="sourceCode" id="cb873"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb873-1"><a href="#cb873-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> gmm_G(params, pRets, fRets):</span>
<span id="cb873-2"><a href="#cb873-2" aria-hidden="true" tabindex="-1"></a>    T,N <span class="op">=</span> pRets.shape</span>
<span id="cb873-3"><a href="#cb873-3" aria-hidden="true" tabindex="-1"></a>    T,K <span class="op">=</span> fRets.shape</span>
<span id="cb873-4"><a href="#cb873-4" aria-hidden="true" tabindex="-1"></a>    beta <span class="op">=</span> squeeze(array(params[:(N<span class="op">*</span>K)]))</span>
<span id="cb873-5"><a href="#cb873-5" aria-hidden="true" tabindex="-1"></a>    lam <span class="op">=</span> squeeze(array(params[(N<span class="op">*</span>K):]))</span>
<span id="cb873-6"><a href="#cb873-6" aria-hidden="true" tabindex="-1"></a>    beta <span class="op">=</span> reshape(beta,(N,K))</span>
<span id="cb873-7"><a href="#cb873-7" aria-hidden="true" tabindex="-1"></a>    lam <span class="op">=</span> reshape(lam,(K,<span class="dv">1</span>))</span>
<span id="cb873-8"><a href="#cb873-8" aria-hidden="true" tabindex="-1"></a>    G <span class="op">=</span> np.zeros((N<span class="op">*</span>K<span class="op">+</span>K,N<span class="op">*</span>K<span class="op">+</span>N))</span>
<span id="cb873-9"><a href="#cb873-9" aria-hidden="true" tabindex="-1"></a>    ffp <span class="op">=</span> (fRets.T <span class="op">@</span> fRets) <span class="op">/</span> T</span>
<span id="cb873-10"><a href="#cb873-10" aria-hidden="true" tabindex="-1"></a>    G[:(N<span class="op">*</span>K),:(N<span class="op">*</span>K)]<span class="op">=</span>kron(eye(N),ffp)</span>
<span id="cb873-11"><a href="#cb873-11" aria-hidden="true" tabindex="-1"></a>    G[:(N<span class="op">*</span>K),(N<span class="op">*</span>K):] <span class="op">=</span> kron(eye(N),<span class="op">-</span>lam)</span>
<span id="cb873-12"><a href="#cb873-12" aria-hidden="true" tabindex="-1"></a>    G[(N<span class="op">*</span>K):,(N<span class="op">*</span>K):] <span class="op">=</span> <span class="op">-</span>beta.T</span>
<span id="cb873-13"><a href="#cb873-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb873-14"><a href="#cb873-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> G</span></code></pre></div>
<ul>
<li>A continuación, se importan los datos y se selecciona un subconjunto de las carteras de prueba para que la estimación sea más rápida.</li>
</ul>
<div class="sourceCode" id="cb874"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb874-1"><a href="#cb874-1" aria-hidden="true" tabindex="-1"></a>os.chdir(<span class="st">&quot;datos&quot;</span>)</span>
<span id="cb874-2"><a href="#cb874-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb874-3"><a href="#cb874-3" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> read_csv(<span class="st">&#39;FamaFrench.csv&#39;</span>)</span>
<span id="cb874-4"><a href="#cb874-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb874-5"><a href="#cb874-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Split using both named colums and ix for larger blocks</span></span>
<span id="cb874-6"><a href="#cb874-6" aria-hidden="true" tabindex="-1"></a>dates <span class="op">=</span> data[<span class="st">&#39;date&#39;</span>].values</span>
<span id="cb874-7"><a href="#cb874-7" aria-hidden="true" tabindex="-1"></a>factors <span class="op">=</span> data[[<span class="st">&#39;VWMe&#39;</span>,<span class="st">&#39;SMB&#39;</span>,<span class="st">&#39;HML&#39;</span>]].values</span>
<span id="cb874-8"><a href="#cb874-8" aria-hidden="true" tabindex="-1"></a>riskfree <span class="op">=</span> data[<span class="st">&#39;RF&#39;</span>].values</span>
<span id="cb874-9"><a href="#cb874-9" aria-hidden="true" tabindex="-1"></a>portfolios <span class="op">=</span> data.iloc[:,<span class="dv">5</span>:].values</span>
<span id="cb874-10"><a href="#cb874-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb874-11"><a href="#cb874-11" aria-hidden="true" tabindex="-1"></a>T,N <span class="op">=</span> portfolios.shape</span>
<span id="cb874-12"><a href="#cb874-12" aria-hidden="true" tabindex="-1"></a>portfolios <span class="op">=</span> portfolios[:,np.arange(<span class="dv">0</span>,N,<span class="dv">2</span>)]</span>
<span id="cb874-13"><a href="#cb874-13" aria-hidden="true" tabindex="-1"></a>T,N <span class="op">=</span> portfolios.shape</span>
<span id="cb874-14"><a href="#cb874-14" aria-hidden="true" tabindex="-1"></a>excessRet <span class="op">=</span> portfolios <span class="op">-</span> np.reshape(riskfree,(T,<span class="dv">1</span>))</span>
<span id="cb874-15"><a href="#cb874-15" aria-hidden="true" tabindex="-1"></a>K <span class="op">=</span> np.size(factors,<span class="dv">1</span>)</span>
<span id="cb874-16"><a href="#cb874-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb874-17"><a href="#cb874-17" aria-hidden="true" tabindex="-1"></a>portfolios.shape</span>
<span id="cb874-18"><a href="#cb874-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb874-19"><a href="#cb874-19" aria-hidden="true" tabindex="-1"></a>data</span></code></pre></div>
<ul>
<li>Los valores iniciales de las cargas de los factores y las primas de riesgo se estiman mediante MCO y medias simples.</li>
</ul>
<div class="sourceCode" id="cb875"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb875-1"><a href="#cb875-1" aria-hidden="true" tabindex="-1"></a>betas <span class="op">=</span> []</span>
<span id="cb875-2"><a href="#cb875-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb875-3"><a href="#cb875-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(N):</span>
<span id="cb875-4"><a href="#cb875-4" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> sm.OLS(excessRet[:,i],sm.add_constant(factors)).fit()</span>
<span id="cb875-5"><a href="#cb875-5" aria-hidden="true" tabindex="-1"></a>    betas.append(res.params[<span class="dv">1</span>:])</span>
<span id="cb875-6"><a href="#cb875-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb875-7"><a href="#cb875-7" aria-hidden="true" tabindex="-1"></a>avgReturn <span class="op">=</span> excessRet.mean(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb875-8"><a href="#cb875-8" aria-hidden="true" tabindex="-1"></a>avgReturn.shape <span class="op">=</span> N,<span class="dv">1</span></span>
<span id="cb875-9"><a href="#cb875-9" aria-hidden="true" tabindex="-1"></a>betas <span class="op">=</span> array(betas)</span>
<span id="cb875-10"><a href="#cb875-10" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> sm.OLS(avgReturn, betas).fit()</span>
<span id="cb875-11"><a href="#cb875-11" aria-hidden="true" tabindex="-1"></a>riskPremia <span class="op">=</span> res.params</span>
<span id="cb875-12"><a href="#cb875-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb875-13"><a href="#cb875-13" aria-hidden="true" tabindex="-1"></a>riskPremia</span></code></pre></div>
<ul>
<li>Los valores de partida se calculan las estimaciones del primer paso se encuentran utilizando el optimizador no lineal.</li>
<li>La matriz de ponderación inicial es sólo la matriz de identificación.</li>
</ul>
<div class="sourceCode" id="cb876"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb876-1"><a href="#cb876-1" aria-hidden="true" tabindex="-1"></a>riskPremia.shape <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb876-2"><a href="#cb876-2" aria-hidden="true" tabindex="-1"></a>startingVals <span class="op">=</span> np.concatenate((betas.flatten(),riskPremia))</span>
<span id="cb876-3"><a href="#cb876-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb876-4"><a href="#cb876-4" aria-hidden="true" tabindex="-1"></a>Winv <span class="op">=</span> np.eye(N<span class="op">*</span>(K<span class="op">+</span><span class="dv">1</span>))</span>
<span id="cb876-5"><a href="#cb876-5" aria-hidden="true" tabindex="-1"></a>args <span class="op">=</span> (excessRet, factors, Winv)</span>
<span id="cb876-6"><a href="#cb876-6" aria-hidden="true" tabindex="-1"></a>iteration <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb876-7"><a href="#cb876-7" aria-hidden="true" tabindex="-1"></a>functionCount <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb876-8"><a href="#cb876-8" aria-hidden="true" tabindex="-1"></a>step1opt <span class="op">=</span> fmin_bfgs(gmm_objective, startingVals, args<span class="op">=</span>args)</span>
<span id="cb876-9"><a href="#cb876-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb876-10"><a href="#cb876-10" aria-hidden="true" tabindex="-1"></a>step1opt</span>
<span id="cb876-11"><a href="#cb876-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb876-12"><a href="#cb876-12" aria-hidden="true" tabindex="-1"></a>premia <span class="op">=</span> step1opt[<span class="op">-</span><span class="dv">3</span>:]</span>
<span id="cb876-13"><a href="#cb876-13" aria-hidden="true" tabindex="-1"></a>premia</span>
<span id="cb876-14"><a href="#cb876-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb876-15"><a href="#cb876-15" aria-hidden="true" tabindex="-1"></a>premia <span class="op">=</span> step1opt[<span class="op">-</span><span class="dv">3</span>:]</span>
<span id="cb876-16"><a href="#cb876-16" aria-hidden="true" tabindex="-1"></a>premia <span class="op">=</span> Series(premia,index<span class="op">=</span>[<span class="st">&#39;VWMe&#39;</span>, <span class="st">&#39;SMB&#39;</span>, <span class="st">&#39;HML&#39;</span>])</span>
<span id="cb876-17"><a href="#cb876-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Annualized Risk Premia (First step)&#39;</span>)</span>
<span id="cb876-18"><a href="#cb876-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="dv">12</span> <span class="op">*</span> premia)</span>
<span id="cb876-19"><a href="#cb876-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb876-20"><a href="#cb876-20" aria-hidden="true" tabindex="-1"></a>out <span class="op">=</span> gmm_objective(step1opt, excessRet, factors, Winv, out<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb876-21"><a href="#cb876-21" aria-hidden="true" tabindex="-1"></a>S <span class="op">=</span> np.cov(out[<span class="dv">1</span>].T)</span>
<span id="cb876-22"><a href="#cb876-22" aria-hidden="true" tabindex="-1"></a>Winv2 <span class="op">=</span> inv(S)</span>
<span id="cb876-23"><a href="#cb876-23" aria-hidden="true" tabindex="-1"></a>args <span class="op">=</span> (excessRet, factors, Winv2)</span>
<span id="cb876-24"><a href="#cb876-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb876-25"><a href="#cb876-25" aria-hidden="true" tabindex="-1"></a>iteration <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb876-26"><a href="#cb876-26" aria-hidden="true" tabindex="-1"></a>functionCount <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb876-27"><a href="#cb876-27" aria-hidden="true" tabindex="-1"></a>step2opt <span class="op">=</span> fmin_bfgs(gmm_objective, step1opt, args<span class="op">=</span>args)</span></code></pre></div>
<ul>
<li>Por último, se calcula el VCV de las estimaciones de los parámetros.</li>
</ul>
<div class="sourceCode" id="cb877"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb877-1"><a href="#cb877-1" aria-hidden="true" tabindex="-1"></a>out <span class="op">=</span> gmm_objective(step2opt, excessRet, factors, Winv2, out<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb877-2"><a href="#cb877-2" aria-hidden="true" tabindex="-1"></a>G <span class="op">=</span> gmm_G(step2opt, excessRet, factors)</span>
<span id="cb877-3"><a href="#cb877-3" aria-hidden="true" tabindex="-1"></a>S <span class="op">=</span> np.cov(out[<span class="dv">1</span>].T)</span>
<span id="cb877-4"><a href="#cb877-4" aria-hidden="true" tabindex="-1"></a>vcv <span class="op">=</span> inv(G <span class="op">@</span> inv(S) <span class="op">@</span> G.T)<span class="op">/</span>T</span></code></pre></div>
<ul>
<li>Premio al riesgo con sus test - t</li>
</ul>
<div class="sourceCode" id="cb878"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb878-1"><a href="#cb878-1" aria-hidden="true" tabindex="-1"></a>premia <span class="op">=</span> step2opt[<span class="op">-</span><span class="dv">3</span>:]</span>
<span id="cb878-2"><a href="#cb878-2" aria-hidden="true" tabindex="-1"></a>premia <span class="op">=</span> Series(premia,index<span class="op">=</span>[<span class="st">&#39;VWMe&#39;</span>, <span class="st">&#39;SMB&#39;</span>, <span class="st">&#39;HML&#39;</span>])</span>
<span id="cb878-3"><a href="#cb878-3" aria-hidden="true" tabindex="-1"></a>premia_vcv <span class="op">=</span> vcv[<span class="op">-</span><span class="dv">3</span>:,<span class="op">-</span><span class="dv">3</span>:]</span>
<span id="cb878-4"><a href="#cb878-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Annualized Risk Premia&#39;</span>)</span>
<span id="cb878-5"><a href="#cb878-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="dv">12</span> <span class="op">*</span> premia)</span>
<span id="cb878-6"><a href="#cb878-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb878-7"><a href="#cb878-7" aria-hidden="true" tabindex="-1"></a>premia_stderr <span class="op">=</span> np.diag(premia_vcv)</span>
<span id="cb878-8"><a href="#cb878-8" aria-hidden="true" tabindex="-1"></a>premia_stderr <span class="op">=</span> Series(premia_stderr,index<span class="op">=</span>[<span class="st">&#39;VWMe&#39;</span>, <span class="st">&#39;SMB&#39;</span>, <span class="st">&#39;HML&#39;</span>])</span>
<span id="cb878-9"><a href="#cb878-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;T-stats&#39;</span>)</span>
<span id="cb878-10"><a href="#cb878-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(premia <span class="op">/</span> premia_stderr)</span></code></pre></div>
</div>
<div id="diferencias-en-diferencias" class="section level3 hasAnchor" number="4.8.4">
<h3 class="hasAnchor"><span class="header-section-number">4.8.4</span> Diferencias en Diferencias<a href="#diferencias-en-diferencias" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><p><strong>Pregunta clave</strong>: ¿cómo saber si el aumento o disminución de algún fenomeno que observamos no es una tendencia natural? En otras palabras, ¿cómo se puede saber el contrafactual <span class="math inline">\(Y_0\)</span> de lo que habría sucedido si no se hubiera pasado algo?</p></li>
<li><p>Una técnica para responder a este tipo de preguntas es la Diferencia en Diferencia. La diferencia en la diferencia se utiliza habitualmente para evaluar el efecto de las macrointervenciones, como el efecto de la inmigración en el desempleo, el efecto de los cambios en la ley de armas en los índices de delincuencia o simplemente la diferencia en el compromiso de los usuarios debido a una campaña de marketing.</p></li>
<li><p>En todos estos casos, se tiene un periodo antes y después de la intervención y se desea desentrañar el impacto de la intervención de una tendencia general. Como ejemplo motivador, veamos una pregunta similar a la que tuve que responder.</p></li>
<li><p>Vamos a ver un ejemplo del impacto de una publicidad. En este ejemplo se colocaron Vamos a colocar 3 vallas en la ciudad de Porto Alegre, la capital del estado de Rio Grande do Sul. Queremos ver si eso aumentaba los depósitos en nuestra cuenta de ahorros. Como nota para los que no estén muy familiarizados con la geografía brasileña, Rio Grande do Sul forma parte del sur del país, una de las regiones más desarrolladas.</p></li>
<li><p>Teniendo esto en cuenta, decidimos también mirar los datos de otra capital del sur. Colocamos la valla publicitaria en Porto Alegre durante todo el mes de junio. Los datos que tenemos son los siguientes:</p></li>
</ul>
<div class="sourceCode" id="cb879"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb879-1"><a href="#cb879-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Commented out IPython magic to ensure Python compatibility.</span></span>
<span id="cb879-2"><a href="#cb879-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb879-3"><a href="#cb879-3" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">&#39;ignore&#39;</span>)</span>
<span id="cb879-4"><a href="#cb879-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb879-5"><a href="#cb879-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb879-6"><a href="#cb879-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb879-7"><a href="#cb879-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> style</span>
<span id="cb879-8"><a href="#cb879-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt</span>
<span id="cb879-9"><a href="#cb879-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb879-10"><a href="#cb879-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.formula.api <span class="im">as</span> smf</span>
<span id="cb879-11"><a href="#cb879-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb879-12"><a href="#cb879-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb879-13"><a href="#cb879-13" aria-hidden="true" tabindex="-1"></a><span class="co"># %matplotlib inline</span></span>
<span id="cb879-14"><a href="#cb879-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb879-15"><a href="#cb879-15" aria-hidden="true" tabindex="-1"></a>style.use(<span class="st">&quot;fivethirtyeight&quot;</span>)</span>
<span id="cb879-16"><a href="#cb879-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb879-17"><a href="#cb879-17" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_csv(<span class="st">&quot;billboard_impact.csv&quot;</span>)</span>
<span id="cb879-18"><a href="#cb879-18" aria-hidden="true" tabindex="-1"></a>data.head()</span></code></pre></div>
<p>Recordemos que los depósitos son nuestra variable de resultado, la que deseamos aumentar con las vallas publicitarias. POA es un indicador ficticio de la ciudad de Porto Alegre. Cuando es cero, significa que las muestras son de Florianópolis. Jul es una variable ficticia para el mes de julio, o para el período posterior a la intervención. Cuando es cero, se refiere a las muestras de mayo, el período anterior a la intervención.</p>
<div id="estimador-did" class="section level4 hasAnchor" number="4.8.4.1">
<h4 class="hasAnchor"><span class="header-section-number">4.8.4.1</span> Estimador DID<a href="#estimador-did" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Para evitar la confusión entre Tiempo y Tratamiento, a partir de ahora, utilizaré D para denotar el tratamiento y T para denotar el tiempo. Sea <span class="math inline">\(Y_D(T)\)</span> el resultado potencial del tratamiento D en el período T. En un mundo ideal en el que tenemos la capacidad de observar el contrafactual, estimaríamos el efecto del tratamiento de una intervención de la siguiente manera:</p>
<p>$
= E[Y_1(1) - Y_0(1)|D=1]
$</p>
<p>El efecto causal es el resultado en el periodo posterior a la intervención en el caso de un tratamiento menos el resultado también en el periodo posterior a la intervención, pero en el caso de no tratamiento. Por supuesto, no podemos medir esto porque <span class="math inline">\(Y_0(1)\)</span> es contrafactual.</p>
<p>Una forma de evitarlo es comparar el antes y el después.</p>
<p>$
= E[Y(1)|D=1] - E[Y(0)|D=1]
$</p>
<p>En nuestro ejemplo, compararíamos los depósitos medios de POA antes y después de la colocación del cartel publicitario.</p>
<div class="sourceCode" id="cb880"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb880-1"><a href="#cb880-1" aria-hidden="true" tabindex="-1"></a>poa_before <span class="op">=</span> data.query(<span class="st">&quot;poa==1 &amp; jul==0&quot;</span>)[<span class="st">&quot;deposits&quot;</span>].mean()</span>
<span id="cb880-2"><a href="#cb880-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb880-3"><a href="#cb880-3" aria-hidden="true" tabindex="-1"></a>poa_after <span class="op">=</span> data.query(<span class="st">&quot;poa==1 &amp; jul==1&quot;</span>)[<span class="st">&quot;deposits&quot;</span>].mean()</span>
<span id="cb880-4"><a href="#cb880-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb880-5"><a href="#cb880-5" aria-hidden="true" tabindex="-1"></a>poa_after <span class="op">-</span> poa_before</span></code></pre></div>
<p>Este estimador nos dice que debemos esperar que los depósitos aumenten 41,04 R después de la intervención. ¿Pero podemos confiar en esto?</p>
<p>Obsérvese que <span class="math inline">\(E[Y(0)|D=1]=E[Y_0(0)|D=1]\)</span>, es decir, el resultado observado para la unidad tratada <strong>antes de la intervención</strong> es igual al resultado contrafactual para la unidad tratada también antes de la intervención. Como estamos utilizando esto para estimar el resultado contrafactual <strong>después de la intervención</strong> <span class="math inline">\(E[Y_0(1)|D=1]\)</span>, esta estimación anterior supone que <span class="math inline">\(E[Y_0(1)|D=1] = E[Y_0(0)|D=1]\)</span>.</p>
<p>Está diciendo que en el caso de que no haya intervención, el resultado en el último período sería el mismo que el resultado del período inicial. Obviamente, esto sería falso si la variable de resultado sigue algún tipo de tendencia. Por ejemplo, si los depósitos están subiendo en POA, <span class="math inline">\(E[Y_0(1)|D=1] &gt; E[Y_0(0)|D=1]\)</span>, es decir, el resultado del último período sería mayor que el del período inicial incluso en ausencia de la intervención. Con un argumento similar, si la tendencia de Y es descendente, <span class="math inline">\(E[Y_0(1)|D=1] &lt; E[Y_0(0)|D=1]\)</span>. Esto es para mostrar que esto del antes y el después no es un gran estimador.</p>
<p>Otra idea es comparar el grupo tratado con un grupo no tratado que no recibió la intervención:</p>
<p>$
= E[Y(1)|D=1] - E[Y(1)|D=0]
$</p>
<p>En nuestro ejemplo, sería comparar los depósitos de POA con los de Florianópolis en el período posterior a la intervención.</p>
<div class="sourceCode" id="cb881"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb881-1"><a href="#cb881-1" aria-hidden="true" tabindex="-1"></a>fl_after <span class="op">=</span> data.query(<span class="st">&quot;poa==0 &amp; jul==1&quot;</span>)[<span class="st">&quot;deposits&quot;</span>].mean()</span>
<span id="cb881-2"><a href="#cb881-2" aria-hidden="true" tabindex="-1"></a>poa_after <span class="op">-</span> fl_after</span></code></pre></div>
<p>Este estimador nos dice que la campaña es perjudicial y que los clientes disminuirán los depósitos en R$ 119,10.</p>
<p>Observe que <span class="math inline">\(E[Y(1)|D=0]=E[Y_0(1)|D=0]\)</span>. Y como estamos utilizando <span class="math inline">\(E[Y(1)|D=0]\)</span> para estimar el contrafactual para los tratados después de la intervención, estamos asumiendo que podemos reemplazar el contrafactual faltante así: <span class="math inline">\(E[Y_0(1)|D=0] = E[Y_0(1)|D=1]\)</span>. Pero nótese que esto sólo sería cierto si ambos grupos tienen un nivel de base muy similar. Por ejemplo, si Florianópolis tiene muchos más depósitos que Porto Alegre, esto no sería cierto porque <span class="math inline">\(E[Y_0(1)|D=0] &gt; E[Y_0(1)|D=1]\)</span>. Por otro lado, si el nivel de depósitos es menor en Florianópolis, tendríamos <span class="math inline">\(E[Y_0(1)|D=0] &lt; E[Y_0(1)|D=1]\)</span>.</p>
<p>De nuevo, esto no es una gran idea. Para resolver esto, podemos utilizar tanto la comparación espacial como la temporal. Esta es la idea del enfoque de la diferencia en la diferencia. Funciona sustituyendo el contrafactual que falta de la siguiente manera:</p>
<p>$
E[Y_0(1)|D=1] = E[Y_1(0)|D=1] + (E[Y_0(1)|D=0] - E[Y_0(0)|D=0])
$</p>
<p>Lo que esto hace es tomar la unidad tratada <strong>antes de la intervención</strong> y añadirle un componente de tendencia, que se estima utilizando el control <span class="math inline">\(E[Y_0(1)|D=0] - E[Y_0(0)|D=0]\)</span>. En palabras, está diciendo que el tratado <strong>después de la intervención</strong>, si no hubiera sido tratado, se parecería al <strong>tratado antes del tratamiento</strong> más un factor de crecimiento que es el mismo que el del control.</p>
<p>Es importante observar que esto supo ne que las tendencias del tratamiento y del control son las mismas:</p>
<p>$
E[Y_0(1) - Y_0(0)|D=1] = E[Y_0(1) - Y_0(0)|D=0]
$</p>
<p>donde el lado izquierdo es la tendencia contrafactual. Ahora, podemos reemplazar el contrafactual estimado en la definición del efecto del tratamiento <span class="math inline">\(E[Y_1(1)|D=1] - E[Y_0(1)|D=1]\)</span></p>
<p>$
= E[Y(1)|D=1] - (E[Y(0)|D=1] + (E[Y(1)|D=0] - E[Y(0)|D=0])
$</p>
<p>Si reordenamos los términos, obtenemos el estimador clásico Diff-in-Diff.</p>
<p>$
= (E[Y(1)|D=1] - E[Y(1)|D=0]) - (E[Y(0)|D=1] - E[Y(0)|D=0])
$</p>
<p>Recibe ese nombre porque obtiene la diferencia entre el tratamiento y el control después y antes del tratamiento.</p>
<p>Esto es lo que se ve en el código.</p>
<div class="sourceCode" id="cb882"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb882-1"><a href="#cb882-1" aria-hidden="true" tabindex="-1"></a>fl_before <span class="op">=</span> data.query(<span class="st">&quot;poa==0 &amp; jul==0&quot;</span>)[<span class="st">&quot;deposits&quot;</span>].mean()</span>
<span id="cb882-2"><a href="#cb882-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb882-3"><a href="#cb882-3" aria-hidden="true" tabindex="-1"></a>diff_in_diff <span class="op">=</span> (poa_after<span class="op">-</span>poa_before)<span class="op">-</span>(fl_after<span class="op">-</span>fl_before)</span>
<span id="cb882-4"><a href="#cb882-4" aria-hidden="true" tabindex="-1"></a>diff_in_diff</span></code></pre></div>
<p>Diff-in-Diff nos dice que deberíamos esperar que los depósitos aumenten en 6,52 R$ por cliente. Obsérvese que el supuesto que hace diff-in-diff es mucho más plausible que los otros 2 estimadores. Simplemente asume que el patrón de crecimiento entre las 2 ciudades es el mismo. Pero no requiere que tengan el mismo nivel de base ni que la tendencia sea cero.</p>
<p>Para visualizar lo que hace diff-in-diff, podemos proyectar la tendencia de crecimiento de la ciudad no tratada a la tratada para ver el contrafactual, es decir, el número de depósitos que deberíamos esperar si no hubiera intervención.</p>
<div class="sourceCode" id="cb883"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb883-1"><a href="#cb883-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">5</span>))</span>
<span id="cb883-2"><a href="#cb883-2" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="st">&quot;May&quot;</span>, <span class="st">&quot;Jul&quot;</span>], [fl_before, fl_after], label<span class="op">=</span><span class="st">&quot;FL&quot;</span>, lw<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb883-3"><a href="#cb883-3" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="st">&quot;May&quot;</span>, <span class="st">&quot;Jul&quot;</span>], [poa_before, poa_after], label<span class="op">=</span><span class="st">&quot;POA&quot;</span>, lw<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb883-4"><a href="#cb883-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb883-5"><a href="#cb883-5" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="st">&quot;May&quot;</span>, <span class="st">&quot;Jul&quot;</span>], [poa_before, poa_before<span class="op">+</span>(fl_after<span class="op">-</span>fl_before)],</span>
<span id="cb883-6"><a href="#cb883-6" aria-hidden="true" tabindex="-1"></a>         label<span class="op">=</span><span class="st">&quot;Counterfactual&quot;</span>, lw<span class="op">=</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">&quot;C2&quot;</span>, ls<span class="op">=</span><span class="st">&quot;-.&quot;</span>)</span>
<span id="cb883-7"><a href="#cb883-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb883-8"><a href="#cb883-8" aria-hidden="true" tabindex="-1"></a>plt.legend()<span class="op">;</span></span></code></pre></div>
<p>¿Ves esa pequeña diferencia entre las líneas discontinuas rojas y amarillas? Si te concentras bien, puedes ver el pequeño efecto del tratamiento en Porto Alegre.</p>
<p>Ahora bien, lo que se puede preguntar es “¿hasta qué punto puedo confiar en este estimador? Tengo derecho a que me informen de los errores estándar”. Lo cual tiene sentido, ya que los estimadores sin ellos parecen tontos. Para ello, utilizaremos un ingenioso truco que utiliza la regresión. En concreto, estimaremos el siguiente modelo lineal</p>
<p>$
Y_i = _0 + _1 POA_i + _2 Jul_i + _3 POA_i*Jul_i + e_i
$</p>
<p>Obsérvese que <span class="math inline">\(\beta_0\)</span> es la línea de base del control. En nuestro caso, es el nivel de depósitos en Florianópolis en el mes de mayo. Si activamos la variable ficticia de la ciudad tratada, obtenemos <span class="math inline">\(\beta_1\)</span>. Así, <span class="math inline">\(\beta_0 + \beta_1\)</span> es la línea de base de Porto Alegre en mayo, antes de la intervención, y <span class="math inline">\(\beta_1\)</span> es el aumento de la línea de base de Porto Alegre sobre Florianópolis. Si desactivamos la variable ficticia del POA y activamos la de julio, obtenemos <span class="math inline">\(\beta_0 + \beta_2\)</span>, que es el nivel de Florianópolis en julio, después del período de intervención. <span class="math inline">\(\beta_2\)</span> es entonces la tendencia del control, ya que lo añadimos a la línea de base para obtener el nivel del control en el periodo posterior a la intervención. Recapitulando, <span class="math inline">\(\beta_1\)</span> es el incremento que obtenemos al pasar del control al tratamiento, <span class="math inline">\(\beta_2\)</span> es el incremento que obtenemos al pasar del periodo anterior al periodo posterior a la intervención. Por último, si activamos ambas variables ficticias, obtenemos <span class="math inline">\(\beta_3\)</span>. <span class="math inline">\(\beta_0 + \beta_1 + \beta_2 + \beta_3\)</span> es el nivel en Porto Alegre después de la intervención. Así que <span class="math inline">\(\beta_3\)</span> es el impacto incremental cuando se pasa de mayo a julio y de Florianópolis a POA. En otras palabras, es el estimador de la diferencia en la diferencia.</p>
<p>Si no me cree, compruébelo usted mismo. Deberías obtener exactamente el mismo número que obtuvimos arriba. Y también observe cómo obtenemos nuestros tan deseados errores estándar.</p>
<div class="sourceCode" id="cb884"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb884-1"><a href="#cb884-1" aria-hidden="true" tabindex="-1"></a>smf.ols(<span class="st">&#39;deposits ~ poa*jul&#39;</span>, data<span class="op">=</span>data).fit().summary().tables[<span class="dv">1</span>]</span></code></pre></div>
</div>
</div>
<div id="plotly" class="section level3 hasAnchor" number="4.8.5">
<h3 class="hasAnchor"><span class="header-section-number">4.8.5</span> Plotly<a href="#plotly" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="introducción-tablas-y-gráficos-interactivos" class="section level4 hasAnchor" number="4.8.5.1">
<h4 class="hasAnchor"><span class="header-section-number">4.8.5.1</span> Introducción: tablas y gráficos interactivos<a href="#introducción-tablas-y-gráficos-interactivos" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>plotly</code> es una librería de python gráficos interactivos, en el ámbito estadístico, financiero, geográfico, científico.</p></li>
<li><p>Es muy útil para hacer gráficos que puedan interactuar con el usuario/a</p></li>
</ul>
<div class="sourceCode" id="cb885"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb885-1"><a href="#cb885-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objects <span class="im">as</span> go</span>
<span id="cb885-2"><a href="#cb885-2" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> go.Figure(data<span class="op">=</span>go.Bar(y<span class="op">=</span>[<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>]))</span>
<span id="cb885-3"><a href="#cb885-3" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code></pre></div>
<ul>
<li>También podemos hacer tablas interactivas</li>
</ul>
<div class="sourceCode" id="cb886"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb886-1"><a href="#cb886-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objects <span class="im">as</span> go</span>
<span id="cb886-2"><a href="#cb886-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb886-3"><a href="#cb886-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Valores a mostrar </span></span>
<span id="cb886-4"><a href="#cb886-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb886-5"><a href="#cb886-5" aria-hidden="true" tabindex="-1"></a>encabezado <span class="op">=</span> [<span class="st">&#39;A Scores&#39;</span>, <span class="st">&#39;B Scores&#39;</span>]</span>
<span id="cb886-6"><a href="#cb886-6" aria-hidden="true" tabindex="-1"></a>valores <span class="op">=</span> [[<span class="dv">100</span>, <span class="dv">90</span>, <span class="dv">80</span>, <span class="dv">90</span>], [<span class="dv">95</span>, <span class="dv">85</span>, <span class="dv">75</span>, <span class="dv">95</span>]]</span>
<span id="cb886-7"><a href="#cb886-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb886-8"><a href="#cb886-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear figura</span></span>
<span id="cb886-9"><a href="#cb886-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. llamar librería y función: go.Figure()</span></span>
<span id="cb886-10"><a href="#cb886-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Definir datos: data=[]</span></span>
<span id="cb886-11"><a href="#cb886-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Usar go.Table() para definir encabezado (header) y valores(cells)</span></span>
<span id="cb886-12"><a href="#cb886-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Guardamos el resultado en una variable -&gt; alpicamos fig.show()</span></span>
<span id="cb886-13"><a href="#cb886-13" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> go.Figure(data<span class="op">=</span>[go.Table(header<span class="op">=</span><span class="bu">dict</span>(values<span class="op">=</span>encabezado),</span>
<span id="cb886-14"><a href="#cb886-14" aria-hidden="true" tabindex="-1"></a>                               cells<span class="op">=</span><span class="bu">dict</span>(values<span class="op">=</span>valores))</span>
<span id="cb886-15"><a href="#cb886-15" aria-hidden="true" tabindex="-1"></a>                     ])</span>
<span id="cb886-16"><a href="#cb886-16" aria-hidden="true" tabindex="-1"></a>fig.show()</span>
<span id="cb886-17"><a href="#cb886-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb886-18"><a href="#cb886-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Podemos hacer modificaciones </span></span>
<span id="cb886-19"><a href="#cb886-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb886-20"><a href="#cb886-20" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> go.Figure(data<span class="op">=</span>[go.Table(</span>
<span id="cb886-21"><a href="#cb886-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Encabezado</span></span>
<span id="cb886-22"><a href="#cb886-22" aria-hidden="true" tabindex="-1"></a>    header<span class="op">=</span><span class="bu">dict</span>(values<span class="op">=</span>encabezado,</span>
<span id="cb886-23"><a href="#cb886-23" aria-hidden="true" tabindex="-1"></a>                line_color<span class="op">=</span><span class="st">&#39;red&#39;</span>, <span class="co">#Color borde: cambiar rojo</span></span>
<span id="cb886-24"><a href="#cb886-24" aria-hidden="true" tabindex="-1"></a>                fill_color<span class="op">=</span><span class="st">&#39;lightskyblue&#39;</span>, <span class="co">#Color fondo</span></span>
<span id="cb886-25"><a href="#cb886-25" aria-hidden="true" tabindex="-1"></a>                align<span class="op">=</span><span class="st">&#39;left&#39;</span>), <span class="co">#Alineación</span></span>
<span id="cb886-26"><a href="#cb886-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Valores</span></span>
<span id="cb886-27"><a href="#cb886-27" aria-hidden="true" tabindex="-1"></a>    cells<span class="op">=</span><span class="bu">dict</span>(values<span class="op">=</span>valores,</span>
<span id="cb886-28"><a href="#cb886-28" aria-hidden="true" tabindex="-1"></a>               line_color<span class="op">=</span><span class="st">&#39;darkslategray&#39;</span>,<span class="co">#Color borde</span></span>
<span id="cb886-29"><a href="#cb886-29" aria-hidden="true" tabindex="-1"></a>               fill_color<span class="op">=</span><span class="st">&#39;lightcyan&#39;</span>, <span class="co">#Color rojo</span></span>
<span id="cb886-30"><a href="#cb886-30" aria-hidden="true" tabindex="-1"></a>               align<span class="op">=</span><span class="st">&#39;left&#39;</span>)) <span class="co">#Alineación</span></span>
<span id="cb886-31"><a href="#cb886-31" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb886-32"><a href="#cb886-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb886-33"><a href="#cb886-33" aria-hidden="true" tabindex="-1"></a><span class="co">#Una vez creado el fig podemos editar su tamaño</span></span>
<span id="cb886-34"><a href="#cb886-34" aria-hidden="true" tabindex="-1"></a>fig.update_layout(width<span class="op">=</span><span class="dv">300</span>, height<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb886-35"><a href="#cb886-35" aria-hidden="true" tabindex="-1"></a>fig.show()</span>
<span id="cb886-36"><a href="#cb886-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb886-37"><a href="#cb886-37" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;+ Para modificar el formato de los datos, ejemplo número de decimales, podemos usar format</span></span></code></pre></div>
<div class="sourceCode" id="cb887"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb887-1"><a href="#cb887-1" aria-hidden="true" tabindex="-1"></a>encabezado <span class="op">=</span> [<span class="st">&#39;A Scores&#39;</span>, <span class="st">&#39;B Scores&#39;</span>, <span class="st">&#39;C Scores&#39;</span>]</span>
<span id="cb887-2"><a href="#cb887-2" aria-hidden="true" tabindex="-1"></a>valores <span class="op">=</span> [[<span class="dv">100</span>, <span class="dv">90</span>, <span class="dv">80</span>, <span class="dv">90</span>], [<span class="dv">95</span>, <span class="dv">85</span>, <span class="dv">75</span>, <span class="dv">95</span>], [<span class="fl">95.12345</span>, <span class="fl">85.12345</span>, <span class="fl">75.12345</span>, <span class="fl">95.12345</span>]]</span>
<span id="cb887-3"><a href="#cb887-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb887-4"><a href="#cb887-4" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> go.Figure(data<span class="op">=</span>[go.Table(</span>
<span id="cb887-5"><a href="#cb887-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Encabezado</span></span>
<span id="cb887-6"><a href="#cb887-6" aria-hidden="true" tabindex="-1"></a>    header<span class="op">=</span><span class="bu">dict</span>(values<span class="op">=</span>encabezado,</span>
<span id="cb887-7"><a href="#cb887-7" aria-hidden="true" tabindex="-1"></a>                line_color<span class="op">=</span><span class="st">&#39;darkslategray&#39;</span>, <span class="co">#Color borde: cambiar rojo</span></span>
<span id="cb887-8"><a href="#cb887-8" aria-hidden="true" tabindex="-1"></a>                fill_color<span class="op">=</span><span class="st">&#39;lightskyblue&#39;</span>, <span class="co">#Color fondo</span></span>
<span id="cb887-9"><a href="#cb887-9" aria-hidden="true" tabindex="-1"></a>                align<span class="op">=</span><span class="st">&#39;left&#39;</span>), <span class="co">#Alineación</span></span>
<span id="cb887-10"><a href="#cb887-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Valores</span></span>
<span id="cb887-11"><a href="#cb887-11" aria-hidden="true" tabindex="-1"></a>    cells<span class="op">=</span><span class="bu">dict</span>(values<span class="op">=</span>valores,</span>
<span id="cb887-12"><a href="#cb887-12" aria-hidden="true" tabindex="-1"></a>               line_color<span class="op">=</span><span class="st">&#39;darkslategray&#39;</span>,<span class="co">#Color borde</span></span>
<span id="cb887-13"><a href="#cb887-13" aria-hidden="true" tabindex="-1"></a>               fill_color<span class="op">=</span><span class="st">&#39;lightcyan&#39;</span>, <span class="co">#Color rojo</span></span>
<span id="cb887-14"><a href="#cb887-14" aria-hidden="true" tabindex="-1"></a>               align<span class="op">=</span><span class="st">&#39;left&#39;</span>, <span class="co">#Alineación</span></span>
<span id="cb887-15"><a href="#cb887-15" aria-hidden="true" tabindex="-1"></a>               <span class="bu">format</span> <span class="op">=</span> [<span class="va">None</span>, <span class="st">&quot;.1f&quot;</span>, <span class="st">&quot;.2f&quot;</span>])) <span class="co">#Formato: en una lista va según el número de columnas</span></span>
<span id="cb887-16"><a href="#cb887-16" aria-hidden="true" tabindex="-1"></a>                ])</span>
<span id="cb887-17"><a href="#cb887-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb887-18"><a href="#cb887-18" aria-hidden="true" tabindex="-1"></a><span class="co">#Una vez creado el fig podemos editar su tamaño</span></span>
<span id="cb887-19"><a href="#cb887-19" aria-hidden="true" tabindex="-1"></a>fig.update_layout(width<span class="op">=</span><span class="dv">400</span>, height<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb887-20"><a href="#cb887-20" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code></pre></div>
</div>
<div id="graficos-de-lineas" class="section level4 hasAnchor" number="4.8.5.2">
<h4 class="hasAnchor"><span class="header-section-number">4.8.5.2</span> Graficos de lineas<a href="#graficos-de-lineas" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>Para este ejemplo vamos a usar la librería plotly.express. Dentro de esta tenemos el DataFrame gapminder datos de expectativa de vida, población, PIB por país.</li>
</ul>
<div class="sourceCode" id="cb888"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb888-1"><a href="#cb888-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Importamos la librería</span></span>
<span id="cb888-2"><a href="#cb888-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb888-3"><a href="#cb888-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb888-4"><a href="#cb888-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Usamos un subconjunto de los datos, seleccionamos América</span></span>
<span id="cb888-5"><a href="#cb888-5" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> px.data.gapminder().query(<span class="st">&quot;continent==&#39;Americas&#39;&quot;</span>)</span>
<span id="cb888-6"><a href="#cb888-6" aria-hidden="true" tabindex="-1"></a>df.head()</span>
<span id="cb888-7"><a href="#cb888-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb888-8"><a href="#cb888-8" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.line(df, x<span class="op">=</span><span class="st">&quot;year&quot;</span>, </span>
<span id="cb888-9"><a href="#cb888-9" aria-hidden="true" tabindex="-1"></a>              y<span class="op">=</span><span class="st">&quot;lifeExp&quot;</span>, </span>
<span id="cb888-10"><a href="#cb888-10" aria-hidden="true" tabindex="-1"></a>              color<span class="op">=</span><span class="st">&#39;country&#39;</span>)</span>
<span id="cb888-11"><a href="#cb888-11" aria-hidden="true" tabindex="-1"></a>fig.show()</span>
<span id="cb888-12"><a href="#cb888-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb888-13"><a href="#cb888-13" aria-hidden="true" tabindex="-1"></a>df_sur <span class="op">=</span> df[(df.country<span class="op">==</span><span class="st">&quot;Argentina&quot;</span> )<span class="op">|</span> (df.country<span class="op">==</span><span class="st">&quot;Chile&quot;</span>) <span class="op">|</span> (df.country<span class="op">==</span><span class="st">&quot;Uruguay&quot;</span>)]</span>
<span id="cb888-14"><a href="#cb888-14" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.line(df_sur, x<span class="op">=</span><span class="st">&quot;year&quot;</span>, y<span class="op">=</span><span class="st">&quot;gdpPercap&quot;</span>, color<span class="op">=</span><span class="st">&#39;country&#39;</span>)</span>
<span id="cb888-15"><a href="#cb888-15" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code></pre></div>
<p>Usamos plotly.express cuando hacemos un ejercicio sencillo. Para comenzar a ejemplos más genéricos o en algunos casos, más complejos, vamos a usar go.Scatter</p>
<p>Como primer ejemplo, vamos a usar una función de los DataFrame llamada pivot_table que nos va a permitir modificar nuestra serie del tipo [Fecha, PIB, Pais] a [Fecha, PIB, Argentina, Chile, Uruguay]</p>
<div class="sourceCode" id="cb889"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb889-1"><a href="#cb889-1" aria-hidden="true" tabindex="-1"></a>df.head()</span>
<span id="cb889-2"><a href="#cb889-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb889-3"><a href="#cb889-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb889-4"><a href="#cb889-4" aria-hidden="true" tabindex="-1"></a>df_sur2 <span class="op">=</span> pd.pivot_table(df_sur, </span>
<span id="cb889-5"><a href="#cb889-5" aria-hidden="true" tabindex="-1"></a>                         values<span class="op">=</span>[<span class="st">&quot;gdpPercap&quot;</span>], </span>
<span id="cb889-6"><a href="#cb889-6" aria-hidden="true" tabindex="-1"></a>                         index<span class="op">=</span>[<span class="st">&quot;year&quot;</span>], </span>
<span id="cb889-7"><a href="#cb889-7" aria-hidden="true" tabindex="-1"></a>                         columns<span class="op">=</span><span class="st">&quot;country&quot;</span> )</span>
<span id="cb889-8"><a href="#cb889-8" aria-hidden="true" tabindex="-1"></a>df_sur2.head()</span>
<span id="cb889-9"><a href="#cb889-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb889-10"><a href="#cb889-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Importamos la librería</span></span>
<span id="cb889-11"><a href="#cb889-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objects <span class="im">as</span> go</span>
<span id="cb889-12"><a href="#cb889-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb889-13"><a href="#cb889-13" aria-hidden="true" tabindex="-1"></a><span class="co">#Creamos figura</span></span>
<span id="cb889-14"><a href="#cb889-14" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> go.Figure()</span>
<span id="cb889-15"><a href="#cb889-15" aria-hidden="true" tabindex="-1"></a><span class="co">#Primer plot</span></span>
<span id="cb889-16"><a href="#cb889-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb889-17"><a href="#cb889-17" aria-hidden="true" tabindex="-1"></a><span class="co">#go.Scatter(x=variable_x, y=variable_y)</span></span>
<span id="cb889-18"><a href="#cb889-18" aria-hidden="true" tabindex="-1"></a>fig.add_trace(go.Scatter(x<span class="op">=</span>df_sur2.index, y<span class="op">=</span>df_sur2.gdpPercap.Argentina,</span>
<span id="cb889-19"><a href="#cb889-19" aria-hidden="true" tabindex="-1"></a>                    mode<span class="op">=</span><span class="st">&#39;lines&#39;</span>,</span>
<span id="cb889-20"><a href="#cb889-20" aria-hidden="true" tabindex="-1"></a>                    name<span class="op">=</span><span class="st">&#39;Argentina&#39;</span>))</span>
<span id="cb889-21"><a href="#cb889-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb889-22"><a href="#cb889-22" aria-hidden="true" tabindex="-1"></a><span class="co">#Segundo plot</span></span>
<span id="cb889-23"><a href="#cb889-23" aria-hidden="true" tabindex="-1"></a>fig.add_trace(go.Scatter(x<span class="op">=</span>df_sur2.index, y<span class="op">=</span>df_sur2.gdpPercap.Chile,</span>
<span id="cb889-24"><a href="#cb889-24" aria-hidden="true" tabindex="-1"></a>                    mode<span class="op">=</span><span class="st">&#39;lines+markers&#39;</span>,</span>
<span id="cb889-25"><a href="#cb889-25" aria-hidden="true" tabindex="-1"></a>                    name<span class="op">=</span><span class="st">&#39;Chile&#39;</span>))</span>
<span id="cb889-26"><a href="#cb889-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb889-27"><a href="#cb889-27" aria-hidden="true" tabindex="-1"></a><span class="co"># #Tercer plot</span></span>
<span id="cb889-28"><a href="#cb889-28" aria-hidden="true" tabindex="-1"></a>fig.add_trace(go.Scatter(x<span class="op">=</span>df_sur2.index, y<span class="op">=</span>df_sur2.gdpPercap.Uruguay,</span>
<span id="cb889-29"><a href="#cb889-29" aria-hidden="true" tabindex="-1"></a>                    mode<span class="op">=</span><span class="st">&#39;markers&#39;</span>, name<span class="op">=</span><span class="st">&#39;Uruguay&#39;</span>))</span>
<span id="cb889-30"><a href="#cb889-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb889-31"><a href="#cb889-31" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code></pre></div>
</div>
<div id="grafico-de-puntos" class="section level4 hasAnchor" number="4.8.5.3">
<h4 class="hasAnchor"><span class="header-section-number">4.8.5.3</span> Grafico de puntos<a href="#grafico-de-puntos" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb890"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb890-1"><a href="#cb890-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Definimos el tipo gráfico</span></span>
<span id="cb890-2"><a href="#cb890-2" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.scatter(df_sur, x<span class="op">=</span><span class="st">&quot;gdpPercap&quot;</span>, y<span class="op">=</span><span class="st">&quot;lifeExp&quot;</span>, color <span class="op">=</span> <span class="st">&quot;country&quot;</span>)</span>
<span id="cb890-3"><a href="#cb890-3" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code></pre></div>
<ul>
<li>Podemos agregar una tercera dimensión, representada en el tamaño de la burbuja. Para esto usamos el argumento size y podemos transformlo en un gráfico de burbujas.</li>
</ul>
<div class="sourceCode" id="cb891"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb891-1"><a href="#cb891-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Definimos el tipo gráfico</span></span>
<span id="cb891-2"><a href="#cb891-2" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.scatter(df_sur, x<span class="op">=</span><span class="st">&quot;gdpPercap&quot;</span>, y<span class="op">=</span><span class="st">&quot;lifeExp&quot;</span>, color <span class="op">=</span> <span class="st">&quot;country&quot;</span>, size<span class="op">=</span><span class="st">&quot;pop&quot;</span>)</span>
<span id="cb891-3"><a href="#cb891-3" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code></pre></div>
<ul>
<li>Otro ejemplo es agregar una escala de colores para resaltar una categoría</li>
</ul>
<div class="sourceCode" id="cb892"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb892-1"><a href="#cb892-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objects <span class="im">as</span> go</span>
<span id="cb892-2"><a href="#cb892-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb892-3"><a href="#cb892-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb892-4"><a href="#cb892-4" aria-hidden="true" tabindex="-1"></a>df_chile <span class="op">=</span> df[(df.country<span class="op">==</span><span class="st">&quot;Chile&quot;</span>)]</span>
<span id="cb892-5"><a href="#cb892-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb892-6"><a href="#cb892-6" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> go.Figure(data<span class="op">=</span>go.Scatter(</span>
<span id="cb892-7"><a href="#cb892-7" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> df_chile.gdpPercap,</span>
<span id="cb892-8"><a href="#cb892-8" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> df_chile.lifeExp,</span>
<span id="cb892-9"><a href="#cb892-9" aria-hidden="true" tabindex="-1"></a>    mode<span class="op">=</span><span class="st">&#39;markers&#39;</span>,</span>
<span id="cb892-10"><a href="#cb892-10" aria-hidden="true" tabindex="-1"></a>    marker<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb892-11"><a href="#cb892-11" aria-hidden="true" tabindex="-1"></a>        size<span class="op">=</span><span class="dv">16</span>,</span>
<span id="cb892-12"><a href="#cb892-12" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span>df_chile.lifeExp, <span class="co">#set color equal to a variable</span></span>
<span id="cb892-13"><a href="#cb892-13" aria-hidden="true" tabindex="-1"></a>        colorscale<span class="op">=</span><span class="st">&#39;Viridis&#39;</span>, <span class="co"># one of plotly colorscales</span></span>
<span id="cb892-14"><a href="#cb892-14" aria-hidden="true" tabindex="-1"></a>        showscale<span class="op">=</span><span class="va">True</span></span>
<span id="cb892-15"><a href="#cb892-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb892-16"><a href="#cb892-16" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb892-17"><a href="#cb892-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb892-18"><a href="#cb892-18" aria-hidden="true" tabindex="-1"></a>fig.show()</span>
<span id="cb892-19"><a href="#cb892-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb892-20"><a href="#cb892-20" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb892-21"><a href="#cb892-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb892-22"><a href="#cb892-22" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> px.data.gapminder().query(<span class="st">&quot;year==2007 and continent==&#39;Americas&#39;&quot;</span>)</span>
<span id="cb892-23"><a href="#cb892-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb892-24"><a href="#cb892-24" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.scatter(df, x<span class="op">=</span><span class="st">&quot;gdpPercap&quot;</span>, </span>
<span id="cb892-25"><a href="#cb892-25" aria-hidden="true" tabindex="-1"></a>                 y<span class="op">=</span><span class="st">&quot;lifeExp&quot;</span>, </span>
<span id="cb892-26"><a href="#cb892-26" aria-hidden="true" tabindex="-1"></a>                 text<span class="op">=</span><span class="st">&quot;country&quot;</span>, </span>
<span id="cb892-27"><a href="#cb892-27" aria-hidden="true" tabindex="-1"></a>                 log_x<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb892-28"><a href="#cb892-28" aria-hidden="true" tabindex="-1"></a>                 size_max<span class="op">=</span><span class="dv">60</span>)</span>
<span id="cb892-29"><a href="#cb892-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb892-30"><a href="#cb892-30" aria-hidden="true" tabindex="-1"></a>fig.update_traces(textposition<span class="op">=</span><span class="st">&#39;top center&#39;</span>)</span>
<span id="cb892-31"><a href="#cb892-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb892-32"><a href="#cb892-32" aria-hidden="true" tabindex="-1"></a>fig.update_layout(</span>
<span id="cb892-33"><a href="#cb892-33" aria-hidden="true" tabindex="-1"></a>    height<span class="op">=</span><span class="dv">800</span>,</span>
<span id="cb892-34"><a href="#cb892-34" aria-hidden="true" tabindex="-1"></a>    title_text<span class="op">=</span><span class="st">&#39;GDP and Life Expectancy (Americas, 2007)&#39;</span></span>
<span id="cb892-35"><a href="#cb892-35" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb892-36"><a href="#cb892-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb892-37"><a href="#cb892-37" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code></pre></div>
</div>
<div id="grafico-de-barras" class="section level4 hasAnchor" number="4.8.5.4">
<h4 class="hasAnchor"><span class="header-section-number">4.8.5.4</span> Grafico de barras<a href="#grafico-de-barras" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb893"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb893-1"><a href="#cb893-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.bar(df_chile, x<span class="op">=</span><span class="st">&#39;year&#39;</span>, y<span class="op">=</span><span class="st">&#39;pop&#39;</span>)</span>
<span id="cb893-2"><a href="#cb893-2" aria-hidden="true" tabindex="-1"></a>fig.show()</span>
<span id="cb893-3"><a href="#cb893-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb893-4"><a href="#cb893-4" aria-hidden="true" tabindex="-1"></a>df_total <span class="op">=</span> px.data.gapminder()</span>
<span id="cb893-5"><a href="#cb893-5" aria-hidden="true" tabindex="-1"></a>df_2007 <span class="op">=</span> df_total[df_total.year<span class="op">==</span><span class="dv">2007</span>]</span>
<span id="cb893-6"><a href="#cb893-6" aria-hidden="true" tabindex="-1"></a>df_2007.head()</span>
<span id="cb893-7"><a href="#cb893-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb893-8"><a href="#cb893-8" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.bar(df_2007, </span>
<span id="cb893-9"><a href="#cb893-9" aria-hidden="true" tabindex="-1"></a>             x<span class="op">=</span><span class="st">&quot;continent&quot;</span>, </span>
<span id="cb893-10"><a href="#cb893-10" aria-hidden="true" tabindex="-1"></a>             y<span class="op">=</span><span class="st">&quot;pop&quot;</span>, </span>
<span id="cb893-11"><a href="#cb893-11" aria-hidden="true" tabindex="-1"></a>             title<span class="op">=</span><span class="st">&quot;Wide-Form Input&quot;</span>)</span>
<span id="cb893-12"><a href="#cb893-12" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code></pre></div>
</div>
<div id="grafico-de-torta" class="section level4 hasAnchor" number="4.8.5.5">
<h4 class="hasAnchor"><span class="header-section-number">4.8.5.5</span> Grafico de torta<a href="#grafico-de-torta" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb894"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb894-1"><a href="#cb894-1" aria-hidden="true" tabindex="-1"></a>df.loc[df[<span class="st">&#39;pop&#39;</span>] <span class="op">&lt;</span> <span class="fl">8.e6</span>, <span class="st">&#39;country&#39;</span>] <span class="op">=</span> <span class="st">&#39;Other countries&#39;</span> <span class="co"># Represent only large countries</span></span>
<span id="cb894-2"><a href="#cb894-2" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.pie(df, values<span class="op">=</span><span class="st">&#39;pop&#39;</span>, </span>
<span id="cb894-3"><a href="#cb894-3" aria-hidden="true" tabindex="-1"></a>             names<span class="op">=</span><span class="st">&#39;country&#39;</span>, </span>
<span id="cb894-4"><a href="#cb894-4" aria-hidden="true" tabindex="-1"></a>             title<span class="op">=</span><span class="st">&#39;Población en América&#39;</span>)</span>
<span id="cb894-5"><a href="#cb894-5" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code></pre></div>
</div>
<div id="animación" class="section level4 hasAnchor" number="4.8.5.6">
<h4 class="hasAnchor"><span class="header-section-number">4.8.5.6</span> Animación<a href="#animación" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb895"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb895-1"><a href="#cb895-1" aria-hidden="true" tabindex="-1"></a>df.head()</span>
<span id="cb895-2"><a href="#cb895-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb895-3"><a href="#cb895-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb895-4"><a href="#cb895-4" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> px.data.gapminder()</span>
<span id="cb895-5"><a href="#cb895-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb895-6"><a href="#cb895-6" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.scatter(df, x<span class="op">=</span><span class="st">&quot;gdpPercap&quot;</span>, y<span class="op">=</span><span class="st">&quot;lifeExp&quot;</span>, </span>
<span id="cb895-7"><a href="#cb895-7" aria-hidden="true" tabindex="-1"></a>                 animation_frame<span class="op">=</span><span class="st">&quot;year&quot;</span>, </span>
<span id="cb895-8"><a href="#cb895-8" aria-hidden="true" tabindex="-1"></a>                 animation_group<span class="op">=</span><span class="st">&quot;country&quot;</span>,</span>
<span id="cb895-9"><a href="#cb895-9" aria-hidden="true" tabindex="-1"></a>                 size<span class="op">=</span><span class="st">&quot;pop&quot;</span>, </span>
<span id="cb895-10"><a href="#cb895-10" aria-hidden="true" tabindex="-1"></a>                 color<span class="op">=</span><span class="st">&quot;continent&quot;</span>, </span>
<span id="cb895-11"><a href="#cb895-11" aria-hidden="true" tabindex="-1"></a>                 hover_name<span class="op">=</span><span class="st">&quot;country&quot;</span>, </span>
<span id="cb895-12"><a href="#cb895-12" aria-hidden="true" tabindex="-1"></a>                 facet_col<span class="op">=</span><span class="st">&quot;continent&quot;</span>,</span>
<span id="cb895-13"><a href="#cb895-13" aria-hidden="true" tabindex="-1"></a>                 log_x<span class="op">=</span><span class="va">True</span>, size_max<span class="op">=</span><span class="dv">45</span>, </span>
<span id="cb895-14"><a href="#cb895-14" aria-hidden="true" tabindex="-1"></a>                 range_x<span class="op">=</span>[<span class="dv">100</span>,<span class="dv">100000</span>], </span>
<span id="cb895-15"><a href="#cb895-15" aria-hidden="true" tabindex="-1"></a>                 range_y<span class="op">=</span>[<span class="dv">25</span>,<span class="dv">90</span>]</span>
<span id="cb895-16"><a href="#cb895-16" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb895-17"><a href="#cb895-17" aria-hidden="true" tabindex="-1"></a>fig.show()</span>
<span id="cb895-18"><a href="#cb895-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb895-19"><a href="#cb895-19" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.bar(df, x<span class="op">=</span><span class="st">&quot;continent&quot;</span>, y<span class="op">=</span><span class="st">&quot;pop&quot;</span>, </span>
<span id="cb895-20"><a href="#cb895-20" aria-hidden="true" tabindex="-1"></a>             color<span class="op">=</span><span class="st">&quot;continent&quot;</span>,</span>
<span id="cb895-21"><a href="#cb895-21" aria-hidden="true" tabindex="-1"></a>             animation_frame<span class="op">=</span><span class="st">&quot;year&quot;</span>, </span>
<span id="cb895-22"><a href="#cb895-22" aria-hidden="true" tabindex="-1"></a>             animation_group<span class="op">=</span><span class="st">&quot;country&quot;</span>, </span>
<span id="cb895-23"><a href="#cb895-23" aria-hidden="true" tabindex="-1"></a>             range_y<span class="op">=</span>[<span class="dv">0</span>,<span class="dv">4000000000</span>])</span>
<span id="cb895-24"><a href="#cb895-24" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code></pre></div>
</div>
<div id="mapas-de-calor" class="section level4 hasAnchor" number="4.8.5.7">
<h4 class="hasAnchor"><span class="header-section-number">4.8.5.7</span> Mapas de calor<a href="#mapas-de-calor" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb896"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb896-1"><a href="#cb896-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> px.data.gapminder().query(<span class="st">&quot;continent==&#39;Americas&#39;&quot;</span>)</span>
<span id="cb896-2"><a href="#cb896-2" aria-hidden="true" tabindex="-1"></a>df.head()</span>
<span id="cb896-3"><a href="#cb896-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb896-4"><a href="#cb896-4" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> go.Figure(data<span class="op">=</span>go.Heatmap(</span>
<span id="cb896-5"><a href="#cb896-5" aria-hidden="true" tabindex="-1"></a>        z<span class="op">=</span>df.lifeExp,</span>
<span id="cb896-6"><a href="#cb896-6" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>df.year,</span>
<span id="cb896-7"><a href="#cb896-7" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span>df.country,</span>
<span id="cb896-8"><a href="#cb896-8" aria-hidden="true" tabindex="-1"></a>        colorscale<span class="op">=</span><span class="st">&#39;Viridis&#39;</span></span>
<span id="cb896-9"><a href="#cb896-9" aria-hidden="true" tabindex="-1"></a>        ))</span>
<span id="cb896-10"><a href="#cb896-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb896-11"><a href="#cb896-11" aria-hidden="true" tabindex="-1"></a>fig.update_layout(</span>
<span id="cb896-12"><a href="#cb896-12" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">&#39;Expectativa de vida&#39;</span>,</span>
<span id="cb896-13"><a href="#cb896-13" aria-hidden="true" tabindex="-1"></a>    xaxis_nticks<span class="op">=</span><span class="dv">13</span>)</span>
<span id="cb896-14"><a href="#cb896-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb896-15"><a href="#cb896-15" aria-hidden="true" tabindex="-1"></a>fig.update_layout(width<span class="op">=</span><span class="dv">750</span>, height<span class="op">=</span><span class="dv">750</span>)</span>
<span id="cb896-16"><a href="#cb896-16" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code></pre></div>
</div>
<div id="sunburst-charts" class="section level4 hasAnchor" number="4.8.5.8">
<h4 class="hasAnchor"><span class="header-section-number">4.8.5.8</span> Sunburst charts<a href="#sunburst-charts" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb897"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb897-1"><a href="#cb897-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb897-2"><a href="#cb897-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb897-3"><a href="#cb897-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> px.data.gapminder().query(<span class="st">&quot;year == 2007&quot;</span>)</span>
<span id="cb897-4"><a href="#cb897-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb897-5"><a href="#cb897-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb897-6"><a href="#cb897-6" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.sunburst(df, path<span class="op">=</span>[<span class="st">&#39;continent&#39;</span>, <span class="st">&#39;country&#39;</span>], values<span class="op">=</span><span class="st">&#39;pop&#39;</span>, color<span class="op">=</span><span class="st">&#39;lifeExp&#39;</span>,</span>
<span id="cb897-7"><a href="#cb897-7" aria-hidden="true" tabindex="-1"></a>                  hover_data<span class="op">=</span>[<span class="st">&#39;iso_alpha&#39;</span>])</span>
<span id="cb897-8"><a href="#cb897-8" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code></pre></div>
</div>
<div id="treemap" class="section level4 hasAnchor" number="4.8.5.9">
<h4 class="hasAnchor"><span class="header-section-number">4.8.5.9</span> Treemap<a href="#treemap" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb898"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb898-1"><a href="#cb898-1" aria-hidden="true" tabindex="-1"></a>df.head()</span>
<span id="cb898-2"><a href="#cb898-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb898-3"><a href="#cb898-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb898-4"><a href="#cb898-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb898-5"><a href="#cb898-5" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> px.data.gapminder().query(<span class="st">&quot;year == 2007&quot;</span>)</span>
<span id="cb898-6"><a href="#cb898-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb898-7"><a href="#cb898-7" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.treemap(df, path<span class="op">=</span>[px.Constant(<span class="st">&#39;world&#39;</span>), <span class="st">&#39;continent&#39;</span>, <span class="st">&#39;country&#39;</span>], values<span class="op">=</span><span class="st">&#39;pop&#39;</span>,  </span>
<span id="cb898-8"><a href="#cb898-8" aria-hidden="true" tabindex="-1"></a>                  hover_data<span class="op">=</span>[<span class="st">&#39;iso_alpha&#39;</span>])</span>
<span id="cb898-9"><a href="#cb898-9" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code></pre></div>
</div>
<div id="histograma-2" class="section level4 hasAnchor" number="4.8.5.10">
<h4 class="hasAnchor"><span class="header-section-number">4.8.5.10</span> Histograma<a href="#histograma-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb899"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb899-1"><a href="#cb899-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb899-2"><a href="#cb899-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> px.data.tips()</span>
<span id="cb899-3"><a href="#cb899-3" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.histogram(df, x<span class="op">=</span><span class="st">&quot;total_bill&quot;</span>, y<span class="op">=</span><span class="st">&quot;tip&quot;</span>, color<span class="op">=</span><span class="st">&quot;sex&quot;</span>, marginal<span class="op">=</span><span class="st">&quot;rug&quot;</span>, hover_data<span class="op">=</span>df.columns)</span>
<span id="cb899-4"><a href="#cb899-4" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code></pre></div>
</div>
<div id="caja-y-bigote" class="section level4 hasAnchor" number="4.8.5.11">
<h4 class="hasAnchor"><span class="header-section-number">4.8.5.11</span> Caja y bigote<a href="#caja-y-bigote" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb900"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb900-1"><a href="#cb900-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb900-2"><a href="#cb900-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> px.data.tips()</span>
<span id="cb900-3"><a href="#cb900-3" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.box(df, x<span class="op">=</span><span class="st">&quot;day&quot;</span>, y<span class="op">=</span><span class="st">&quot;total_bill&quot;</span>, color<span class="op">=</span><span class="st">&quot;smoker&quot;</span>, notched<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb900-4"><a href="#cb900-4" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code></pre></div>
</div>
<div id="mapas" class="section level4 hasAnchor" number="4.8.5.12">
<h4 class="hasAnchor"><span class="header-section-number">4.8.5.12</span> Mapas<a href="#mapas" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>Un mapa Choropleth es un mapa compuesto por polígonos de colores.</li>
<li>Se utiliza para representar las variaciones espaciales de una
cantidad.</li>
<li>Vamos a utilizar la función px.choropleth_mapbox</li>
<li>Los principales parámetros de una mapa son:
<ul>
<li>GeoJson- formatted: información geometrica donde cada caracteristica tiene un id o identificador que es posible mapear</li>
<li>Lista de valores indexados al ID.</li>
</ul></li>
<li>Vamos a cargar un archivo GeoJSON que contiene información geometrica
para los condados en Estados Unidos.</li>
</ul>
<div class="sourceCode" id="cb901"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb901-1"><a href="#cb901-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> urllib.request <span class="im">import</span> urlopen</span>
<span id="cb901-2"><a href="#cb901-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb901-3"><a href="#cb901-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> urlopen(<span class="st">&#39;https://raw.githubusercontent.com/plotly/datasets/master/geojson-counties-fips.json&#39;</span>) <span class="im">as</span> response:</span>
<span id="cb901-4"><a href="#cb901-4" aria-hidden="true" tabindex="-1"></a>    counties <span class="op">=</span> json.load(response)</span>
<span id="cb901-5"><a href="#cb901-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb901-6"><a href="#cb901-6" aria-hidden="true" tabindex="-1"></a>counties[<span class="st">&quot;features&quot;</span>][<span class="dv">0</span>]</span>
<span id="cb901-7"><a href="#cb901-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb901-8"><a href="#cb901-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb901-9"><a href="#cb901-9" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&quot;https://raw.githubusercontent.com/plotly/datasets/master/fips-unemp-16.csv&quot;</span>,</span>
<span id="cb901-10"><a href="#cb901-10" aria-hidden="true" tabindex="-1"></a>                   dtype<span class="op">=</span>{<span class="st">&quot;fips&quot;</span>: <span class="bu">str</span>})</span>
<span id="cb901-11"><a href="#cb901-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb901-12"><a href="#cb901-12" aria-hidden="true" tabindex="-1"></a>df.head()</span>
<span id="cb901-13"><a href="#cb901-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb901-14"><a href="#cb901-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb901-15"><a href="#cb901-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb901-16"><a href="#cb901-16" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.choropleth_mapbox(df, geojson<span class="op">=</span>counties, locations<span class="op">=</span><span class="st">&#39;fips&#39;</span>, color<span class="op">=</span><span class="st">&#39;unemp&#39;</span>,</span>
<span id="cb901-17"><a href="#cb901-17" aria-hidden="true" tabindex="-1"></a>                           color_continuous_scale<span class="op">=</span><span class="st">&quot;Viridis&quot;</span>,</span>
<span id="cb901-18"><a href="#cb901-18" aria-hidden="true" tabindex="-1"></a>                           range_color<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">12</span>),</span>
<span id="cb901-19"><a href="#cb901-19" aria-hidden="true" tabindex="-1"></a>                           mapbox_style<span class="op">=</span><span class="st">&quot;carto-positron&quot;</span>,</span>
<span id="cb901-20"><a href="#cb901-20" aria-hidden="true" tabindex="-1"></a>                           zoom<span class="op">=</span><span class="dv">3</span>, center <span class="op">=</span> {<span class="st">&quot;lat&quot;</span>: <span class="fl">37.0902</span>, <span class="st">&quot;lon&quot;</span>: <span class="op">-</span><span class="fl">95.7129</span>},</span>
<span id="cb901-21"><a href="#cb901-21" aria-hidden="true" tabindex="-1"></a>                           opacity<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb901-22"><a href="#cb901-22" aria-hidden="true" tabindex="-1"></a>                           labels<span class="op">=</span>{<span class="st">&#39;unemp&#39;</span>:<span class="st">&#39;unemployment rate&#39;</span>}</span>
<span id="cb901-23"><a href="#cb901-23" aria-hidden="true" tabindex="-1"></a>                          )</span>
<span id="cb901-24"><a href="#cb901-24" aria-hidden="true" tabindex="-1"></a>fig.update_layout(margin<span class="op">=</span>{<span class="st">&quot;r&quot;</span>:<span class="dv">0</span>,<span class="st">&quot;t&quot;</span>:<span class="dv">0</span>,<span class="st">&quot;l&quot;</span>:<span class="dv">0</span>,<span class="st">&quot;b&quot;</span>:<span class="dv">0</span>})</span>
<span id="cb901-25"><a href="#cb901-25" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code></pre></div>
</div>
<div id="mapas-de-puntos" class="section level4 hasAnchor" number="4.8.5.13">
<h4 class="hasAnchor"><span class="header-section-number">4.8.5.13</span> Mapas de puntos<a href="#mapas-de-puntos" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb902"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb902-1"><a href="#cb902-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb902-2"><a href="#cb902-2" aria-hidden="true" tabindex="-1"></a>us_cities <span class="op">=</span> pd.read_csv(<span class="st">&quot;https://raw.githubusercontent.com/plotly/datasets/master/us-cities-top-1k.csv&quot;</span>)</span>
<span id="cb902-3"><a href="#cb902-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb902-4"><a href="#cb902-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb902-5"><a href="#cb902-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb902-6"><a href="#cb902-6" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.scatter_mapbox(us_cities, lat<span class="op">=</span><span class="st">&quot;lat&quot;</span>, lon<span class="op">=</span><span class="st">&quot;lon&quot;</span>, hover_name<span class="op">=</span><span class="st">&quot;City&quot;</span>, hover_data<span class="op">=</span>[<span class="st">&quot;State&quot;</span>, <span class="st">&quot;Population&quot;</span>],</span>
<span id="cb902-7"><a href="#cb902-7" aria-hidden="true" tabindex="-1"></a>                        color_discrete_sequence<span class="op">=</span>[<span class="st">&quot;fuchsia&quot;</span>], zoom<span class="op">=</span><span class="dv">3</span>, height<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb902-8"><a href="#cb902-8" aria-hidden="true" tabindex="-1"></a>fig.update_layout(mapbox_style<span class="op">=</span><span class="st">&quot;open-street-map&quot;</span>)</span>
<span id="cb902-9"><a href="#cb902-9" aria-hidden="true" tabindex="-1"></a>fig.update_layout(margin<span class="op">=</span>{<span class="st">&quot;r&quot;</span>:<span class="dv">0</span>,<span class="st">&quot;t&quot;</span>:<span class="dv">0</span>,<span class="st">&quot;l&quot;</span>:<span class="dv">0</span>,<span class="st">&quot;b&quot;</span>:<span class="dv">0</span>})</span>
<span id="cb902-10"><a href="#cb902-10" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code></pre></div>
</div>
<div id="mapas-de-burbujas" class="section level4 hasAnchor" number="4.8.5.14">
<h4 class="hasAnchor"><span class="header-section-number">4.8.5.14</span> Mapas de burbujas<a href="#mapas-de-burbujas" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb903"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb903-1"><a href="#cb903-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> px.data.gapminder().query(<span class="st">&quot;year==2007&quot;</span>)</span>
<span id="cb903-2"><a href="#cb903-2" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.scatter_geo(df, locations<span class="op">=</span><span class="st">&quot;iso_alpha&quot;</span>, color<span class="op">=</span><span class="st">&quot;continent&quot;</span>,</span>
<span id="cb903-3"><a href="#cb903-3" aria-hidden="true" tabindex="-1"></a>                     hover_name<span class="op">=</span><span class="st">&quot;country&quot;</span>, size<span class="op">=</span><span class="st">&quot;pop&quot;</span>,</span>
<span id="cb903-4"><a href="#cb903-4" aria-hidden="true" tabindex="-1"></a>                     projection<span class="op">=</span><span class="st">&quot;natural earth&quot;</span>)</span>
<span id="cb903-5"><a href="#cb903-5" aria-hidden="true" tabindex="-1"></a>fig.show()</span>
<span id="cb903-6"><a href="#cb903-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb903-7"><a href="#cb903-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb903-8"><a href="#cb903-8" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> px.data.gapminder()</span>
<span id="cb903-9"><a href="#cb903-9" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.scatter_geo(df, locations<span class="op">=</span><span class="st">&quot;iso_alpha&quot;</span>, color<span class="op">=</span><span class="st">&quot;continent&quot;</span>,</span>
<span id="cb903-10"><a href="#cb903-10" aria-hidden="true" tabindex="-1"></a>                     hover_name<span class="op">=</span><span class="st">&quot;country&quot;</span>, size<span class="op">=</span><span class="st">&quot;pop&quot;</span>,</span>
<span id="cb903-11"><a href="#cb903-11" aria-hidden="true" tabindex="-1"></a>                     animation_frame<span class="op">=</span><span class="st">&quot;year&quot;</span>,</span>
<span id="cb903-12"><a href="#cb903-12" aria-hidden="true" tabindex="-1"></a>                     projection<span class="op">=</span><span class="st">&quot;natural earth&quot;</span>)</span>
<span id="cb903-13"><a href="#cb903-13" aria-hidden="true" tabindex="-1"></a>fig.show()</span>
<span id="cb903-14"><a href="#cb903-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb903-15"><a href="#cb903-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objects <span class="im">as</span> go</span>
<span id="cb903-16"><a href="#cb903-16" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&#39;https://raw.githubusercontent.com/plotly/datasets/master/2014_us_cities.csv&#39;</span>)</span>
<span id="cb903-17"><a href="#cb903-17" aria-hidden="true" tabindex="-1"></a>df.head()</span>
<span id="cb903-18"><a href="#cb903-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb903-19"><a href="#cb903-19" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;text&#39;</span>] <span class="op">=</span> df[<span class="st">&#39;name&#39;</span>] <span class="op">+</span> <span class="st">&#39;&lt;br&gt;Population &#39;</span> <span class="op">+</span> (df[<span class="st">&#39;pop&#39;</span>]<span class="op">/</span><span class="fl">1e6</span>).astype(<span class="bu">str</span>)<span class="op">+</span><span class="st">&#39; million&#39;</span></span>
<span id="cb903-20"><a href="#cb903-20" aria-hidden="true" tabindex="-1"></a>limits <span class="op">=</span> [(<span class="dv">0</span>,<span class="dv">2</span>),(<span class="dv">3</span>,<span class="dv">10</span>),(<span class="dv">11</span>,<span class="dv">20</span>),(<span class="dv">21</span>,<span class="dv">50</span>),(<span class="dv">50</span>,<span class="dv">3000</span>)]</span>
<span id="cb903-21"><a href="#cb903-21" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> [<span class="st">&quot;royalblue&quot;</span>,<span class="st">&quot;crimson&quot;</span>,<span class="st">&quot;lightseagreen&quot;</span>,<span class="st">&quot;orange&quot;</span>,<span class="st">&quot;lightgrey&quot;</span>]</span>
<span id="cb903-22"><a href="#cb903-22" aria-hidden="true" tabindex="-1"></a>cities <span class="op">=</span> []</span>
<span id="cb903-23"><a href="#cb903-23" aria-hidden="true" tabindex="-1"></a>scale <span class="op">=</span> <span class="dv">5000</span></span>
<span id="cb903-24"><a href="#cb903-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb903-25"><a href="#cb903-25" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> go.Figure()</span>
<span id="cb903-26"><a href="#cb903-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb903-27"><a href="#cb903-27" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(limits)):</span>
<span id="cb903-28"><a href="#cb903-28" aria-hidden="true" tabindex="-1"></a>    lim <span class="op">=</span> limits[i]</span>
<span id="cb903-29"><a href="#cb903-29" aria-hidden="true" tabindex="-1"></a>    df_sub <span class="op">=</span> df[lim[<span class="dv">0</span>]:lim[<span class="dv">1</span>]]</span>
<span id="cb903-30"><a href="#cb903-30" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(go.Scattergeo(</span>
<span id="cb903-31"><a href="#cb903-31" aria-hidden="true" tabindex="-1"></a>        locationmode <span class="op">=</span> <span class="st">&#39;USA-states&#39;</span>,</span>
<span id="cb903-32"><a href="#cb903-32" aria-hidden="true" tabindex="-1"></a>        lon <span class="op">=</span> df_sub[<span class="st">&#39;lon&#39;</span>],</span>
<span id="cb903-33"><a href="#cb903-33" aria-hidden="true" tabindex="-1"></a>        lat <span class="op">=</span> df_sub[<span class="st">&#39;lat&#39;</span>],</span>
<span id="cb903-34"><a href="#cb903-34" aria-hidden="true" tabindex="-1"></a>        text <span class="op">=</span> df_sub[<span class="st">&#39;text&#39;</span>],</span>
<span id="cb903-35"><a href="#cb903-35" aria-hidden="true" tabindex="-1"></a>        marker <span class="op">=</span> <span class="bu">dict</span>(</span>
<span id="cb903-36"><a href="#cb903-36" aria-hidden="true" tabindex="-1"></a>            size <span class="op">=</span> df_sub[<span class="st">&#39;pop&#39;</span>]<span class="op">/</span>scale,</span>
<span id="cb903-37"><a href="#cb903-37" aria-hidden="true" tabindex="-1"></a>            color <span class="op">=</span> colors[i],</span>
<span id="cb903-38"><a href="#cb903-38" aria-hidden="true" tabindex="-1"></a>            line_color<span class="op">=</span><span class="st">&#39;rgb(40,40,40)&#39;</span>,</span>
<span id="cb903-39"><a href="#cb903-39" aria-hidden="true" tabindex="-1"></a>            line_width<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb903-40"><a href="#cb903-40" aria-hidden="true" tabindex="-1"></a>            sizemode <span class="op">=</span> <span class="st">&#39;area&#39;</span></span>
<span id="cb903-41"><a href="#cb903-41" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb903-42"><a href="#cb903-42" aria-hidden="true" tabindex="-1"></a>        name <span class="op">=</span> <span class="st">&#39;</span><span class="sc">{0}</span><span class="st"> - </span><span class="sc">{1}</span><span class="st">&#39;</span>.<span class="bu">format</span>(lim[<span class="dv">0</span>],lim[<span class="dv">1</span>])))</span>
<span id="cb903-43"><a href="#cb903-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb903-44"><a href="#cb903-44" aria-hidden="true" tabindex="-1"></a>fig.update_layout(</span>
<span id="cb903-45"><a href="#cb903-45" aria-hidden="true" tabindex="-1"></a>        title_text <span class="op">=</span> <span class="st">&#39;2014 US city populations&lt;br&gt;(Click legend to toggle traces)&#39;</span>,</span>
<span id="cb903-46"><a href="#cb903-46" aria-hidden="true" tabindex="-1"></a>        showlegend <span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb903-47"><a href="#cb903-47" aria-hidden="true" tabindex="-1"></a>        geo <span class="op">=</span> <span class="bu">dict</span>(</span>
<span id="cb903-48"><a href="#cb903-48" aria-hidden="true" tabindex="-1"></a>            scope <span class="op">=</span> <span class="st">&#39;usa&#39;</span>,</span>
<span id="cb903-49"><a href="#cb903-49" aria-hidden="true" tabindex="-1"></a>            landcolor <span class="op">=</span> <span class="st">&#39;rgb(217, 217, 217)&#39;</span>,</span>
<span id="cb903-50"><a href="#cb903-50" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb903-51"><a href="#cb903-51" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb903-52"><a href="#cb903-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb903-53"><a href="#cb903-53" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code></pre></div>
</div>
</div>
<div id="automatización-1" class="section level3 hasAnchor" number="4.8.6">
<h3 class="hasAnchor"><span class="header-section-number">4.8.6</span> Automatización<a href="#automatización-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb904"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb904-1"><a href="#cb904-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb904-2"><a href="#cb904-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> openpyxl</span>
<span id="cb904-3"><a href="#cb904-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openpyxl <span class="im">import</span> load_workbook</span>
<span id="cb904-4"><a href="#cb904-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openpyxl.styles <span class="im">import</span> Font</span>
<span id="cb904-5"><a href="#cb904-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openpyxl.chart <span class="im">import</span> BarChart, Reference</span>
<span id="cb904-6"><a href="#cb904-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> string</span></code></pre></div>
<div id="tablas-ancha" class="section level4 hasAnchor" number="4.8.6.1">
<h4 class="hasAnchor"><span class="header-section-number">4.8.6.1</span> Tablas ancha<a href="#tablas-ancha" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb905"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb905-1"><a href="#cb905-1" aria-hidden="true" tabindex="-1"></a>excel_file <span class="op">=</span> pd.read_excel(<span class="st">&#39;datasets</span><span class="ch">\\</span><span class="st">supermarket_sales.xlsx&#39;</span>)</span>
<span id="cb905-2"><a href="#cb905-2" aria-hidden="true" tabindex="-1"></a>excel_file[[<span class="st">&#39;Gender&#39;</span>, <span class="st">&#39;Product line&#39;</span>, <span class="st">&#39;Total&#39;</span>]]</span>
<span id="cb905-3"><a href="#cb905-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb905-4"><a href="#cb905-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Confeccionamos tabla</span></span>
<span id="cb905-5"><a href="#cb905-5" aria-hidden="true" tabindex="-1"></a>report_table <span class="op">=</span> excel_file.pivot_table(index<span class="op">=</span><span class="st">&#39;Gender&#39;</span>,</span>
<span id="cb905-6"><a href="#cb905-6" aria-hidden="true" tabindex="-1"></a>                                      columns<span class="op">=</span><span class="st">&#39;Product line&#39;</span>,</span>
<span id="cb905-7"><a href="#cb905-7" aria-hidden="true" tabindex="-1"></a>                                      values<span class="op">=</span><span class="st">&#39;Total&#39;</span>,</span>
<span id="cb905-8"><a href="#cb905-8" aria-hidden="true" tabindex="-1"></a>                                      aggfunc<span class="op">=</span><span class="st">&#39;sum&#39;</span>).<span class="bu">round</span>(<span class="dv">0</span>)</span>
<span id="cb905-9"><a href="#cb905-9" aria-hidden="true" tabindex="-1"></a>report_table</span>
<span id="cb905-10"><a href="#cb905-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb905-11"><a href="#cb905-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Exportamos tabla</span></span>
<span id="cb905-12"><a href="#cb905-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb905-13"><a href="#cb905-13" aria-hidden="true" tabindex="-1"></a>report_table.to_excel(<span class="st">&#39;report_2021.xlsx&#39;</span>,</span>
<span id="cb905-14"><a href="#cb905-14" aria-hidden="true" tabindex="-1"></a>                      sheet_name<span class="op">=</span><span class="st">&#39;Report&#39;</span>,</span>
<span id="cb905-15"><a href="#cb905-15" aria-hidden="true" tabindex="-1"></a>                      startrow<span class="op">=</span><span class="dv">4</span>)</span></code></pre></div>
</div>
<div id="hacer-el-reporte-con-openpyxl" class="section level4 hasAnchor" number="4.8.6.2">
<h4 class="hasAnchor"><span class="header-section-number">4.8.6.2</span> Hacer el reporte con Openpyxl<a href="#hacer-el-reporte-con-openpyxl" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Crear filas y columnas de referencia:</p>
<div class="sourceCode" id="cb906"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb906-1"><a href="#cb906-1" aria-hidden="true" tabindex="-1"></a>wb <span class="op">=</span> load_workbook(<span class="st">&#39;report_2021.xlsx&#39;</span>)</span>
<span id="cb906-2"><a href="#cb906-2" aria-hidden="true" tabindex="-1"></a>sheet <span class="op">=</span> wb[<span class="st">&#39;Report&#39;</span>]</span>
<span id="cb906-3"><a href="#cb906-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb906-4"><a href="#cb906-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Celdas de referencia </span></span>
<span id="cb906-5"><a href="#cb906-5" aria-hidden="true" tabindex="-1"></a>min_column <span class="op">=</span> wb.active.min_column</span>
<span id="cb906-6"><a href="#cb906-6" aria-hidden="true" tabindex="-1"></a>max_column <span class="op">=</span> wb.active.max_column</span>
<span id="cb906-7"><a href="#cb906-7" aria-hidden="true" tabindex="-1"></a>min_row <span class="op">=</span> wb.active.min_row</span>
<span id="cb906-8"><a href="#cb906-8" aria-hidden="true" tabindex="-1"></a>max_row <span class="op">=</span> wb.active.max_row</span>
<span id="cb906-9"><a href="#cb906-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb906-10"><a href="#cb906-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&#39;Min Columns: </span><span class="sc">{</span>min_column<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb906-11"><a href="#cb906-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&#39;Max Columns: </span><span class="sc">{</span>max_column<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb906-12"><a href="#cb906-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&#39;Min Rows: </span><span class="sc">{</span>min_row<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb906-13"><a href="#cb906-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&#39;Max Rows: </span><span class="sc">{</span>max_row<span class="sc">}</span><span class="ss">&#39;</span>)</span></code></pre></div>
<p>Añadir graficos:</p>
<div class="sourceCode" id="cb907"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb907-1"><a href="#cb907-1" aria-hidden="true" tabindex="-1"></a>wb <span class="op">=</span> load_workbook(<span class="st">&#39;report_2021.xlsx&#39;</span>)</span>
<span id="cb907-2"><a href="#cb907-2" aria-hidden="true" tabindex="-1"></a>sheet <span class="op">=</span> wb[<span class="st">&#39;Report&#39;</span>]</span>
<span id="cb907-3"><a href="#cb907-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb907-4"><a href="#cb907-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Grafico de barras </span></span>
<span id="cb907-5"><a href="#cb907-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb907-6"><a href="#cb907-6" aria-hidden="true" tabindex="-1"></a>barchart <span class="op">=</span> BarChart()</span>
<span id="cb907-7"><a href="#cb907-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb907-8"><a href="#cb907-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Localizar datos y categorias </span></span>
<span id="cb907-9"><a href="#cb907-9" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> Reference(sheet,</span>
<span id="cb907-10"><a href="#cb907-10" aria-hidden="true" tabindex="-1"></a>                 min_col<span class="op">=</span>min_column<span class="op">+</span><span class="dv">1</span>,</span>
<span id="cb907-11"><a href="#cb907-11" aria-hidden="true" tabindex="-1"></a>                 max_col<span class="op">=</span>max_column,</span>
<span id="cb907-12"><a href="#cb907-12" aria-hidden="true" tabindex="-1"></a>                 min_row<span class="op">=</span>min_row,</span>
<span id="cb907-13"><a href="#cb907-13" aria-hidden="true" tabindex="-1"></a>                 max_row<span class="op">=</span>max_row)</span>
<span id="cb907-14"><a href="#cb907-14" aria-hidden="true" tabindex="-1"></a>categories <span class="op">=</span> Reference(sheet,</span>
<span id="cb907-15"><a href="#cb907-15" aria-hidden="true" tabindex="-1"></a>                       min_col<span class="op">=</span>min_column,</span>
<span id="cb907-16"><a href="#cb907-16" aria-hidden="true" tabindex="-1"></a>                       max_col<span class="op">=</span>min_column,</span>
<span id="cb907-17"><a href="#cb907-17" aria-hidden="true" tabindex="-1"></a>                       min_row<span class="op">=</span>min_row<span class="op">+</span><span class="dv">1</span>,</span>
<span id="cb907-18"><a href="#cb907-18" aria-hidden="true" tabindex="-1"></a>                       max_row<span class="op">=</span>max_row) </span>
<span id="cb907-19"><a href="#cb907-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Agregar datos y categorias</span></span>
<span id="cb907-20"><a href="#cb907-20" aria-hidden="true" tabindex="-1"></a>barchart.add_data(data, titles_from_data<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb907-21"><a href="#cb907-21" aria-hidden="true" tabindex="-1"></a>barchart.set_categories(categories)</span>
<span id="cb907-22"><a href="#cb907-22" aria-hidden="true" tabindex="-1"></a><span class="co">#location chart</span></span>
<span id="cb907-23"><a href="#cb907-23" aria-hidden="true" tabindex="-1"></a>sheet.add_chart(barchart, <span class="st">&quot;B12&quot;</span>)</span>
<span id="cb907-24"><a href="#cb907-24" aria-hidden="true" tabindex="-1"></a>barchart.title <span class="op">=</span> <span class="st">&#39;Sales by Product line&#39;</span></span>
<span id="cb907-25"><a href="#cb907-25" aria-hidden="true" tabindex="-1"></a>barchart.style <span class="op">=</span> <span class="dv">5</span> <span class="co">#choose the chart style</span></span>
<span id="cb907-26"><a href="#cb907-26" aria-hidden="true" tabindex="-1"></a>wb.save(<span class="st">&#39;report_2021.xlsx&#39;</span>)</span></code></pre></div>
<p>Aplicar formulas manualmente:</p>
<div class="sourceCode" id="cb908"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb908-1"><a href="#cb908-1" aria-hidden="true" tabindex="-1"></a>wb <span class="op">=</span> load_workbook(<span class="st">&#39;report_2021.xlsx&#39;</span>)</span>
<span id="cb908-2"><a href="#cb908-2" aria-hidden="true" tabindex="-1"></a>sheet <span class="op">=</span> wb[<span class="st">&#39;Report&#39;</span>]</span>
<span id="cb908-3"><a href="#cb908-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb908-4"><a href="#cb908-4" aria-hidden="true" tabindex="-1"></a>sheet[<span class="st">&#39;B7&#39;</span>] <span class="op">=</span> <span class="st">&#39;=SUM(B5:B6)&#39;</span></span>
<span id="cb908-5"><a href="#cb908-5" aria-hidden="true" tabindex="-1"></a>sheet[<span class="st">&#39;B7&#39;</span>].style <span class="op">=</span> <span class="st">&#39;Currency&#39;</span></span>
<span id="cb908-6"><a href="#cb908-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb908-7"><a href="#cb908-7" aria-hidden="true" tabindex="-1"></a>wb.save(<span class="st">&#39;report_2021.xlsx&#39;</span>)</span></code></pre></div>
<p>Aplicar formulas con celdas de referencias:</p>
<div class="sourceCode" id="cb909"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb909-1"><a href="#cb909-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> string</span>
<span id="cb909-2"><a href="#cb909-2" aria-hidden="true" tabindex="-1"></a>alphabet <span class="op">=</span> <span class="bu">list</span>(string.ascii_uppercase)</span>
<span id="cb909-3"><a href="#cb909-3" aria-hidden="true" tabindex="-1"></a>excel_alphabet <span class="op">=</span> alphabet[<span class="dv">0</span>:max_column] <span class="co">#note: Python lists start on 0 -&gt; A=0, B=1, C=2. #note2 the [a:b] takes b-a elements</span></span>
<span id="cb909-4"><a href="#cb909-4" aria-hidden="true" tabindex="-1"></a>excel_alphabet</span>
<span id="cb909-5"><a href="#cb909-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb909-6"><a href="#cb909-6" aria-hidden="true" tabindex="-1"></a>wb <span class="op">=</span> load_workbook(<span class="st">&#39;report_2021.xlsx&#39;</span>)</span>
<span id="cb909-7"><a href="#cb909-7" aria-hidden="true" tabindex="-1"></a>sheet <span class="op">=</span> wb[<span class="st">&#39;Report&#39;</span>]</span>
<span id="cb909-8"><a href="#cb909-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb909-9"><a href="#cb909-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Suma en columnas B - G: </span></span>
<span id="cb909-10"><a href="#cb909-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> excel_alphabet:</span>
<span id="cb909-11"><a href="#cb909-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i<span class="op">!=</span><span class="st">&#39;A&#39;</span>:</span>
<span id="cb909-12"><a href="#cb909-12" aria-hidden="true" tabindex="-1"></a>        sheet[<span class="ss">f&#39;</span><span class="sc">{</span>i<span class="sc">}{</span>max_row<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>] <span class="op">=</span> <span class="ss">f&#39;=SUM(</span><span class="sc">{</span>i<span class="sc">}{</span>min_row<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">:</span><span class="sc">{</span>i<span class="sc">}{</span>max_row<span class="sc">}</span><span class="ss">)&#39;</span></span>
<span id="cb909-13"><a href="#cb909-13" aria-hidden="true" tabindex="-1"></a>        sheet[<span class="ss">f&#39;</span><span class="sc">{</span>i<span class="sc">}{</span>max_row<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>].style <span class="op">=</span> <span class="st">&#39;Currency&#39;</span></span>
<span id="cb909-14"><a href="#cb909-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb909-15"><a href="#cb909-15" aria-hidden="true" tabindex="-1"></a><span class="co"># adding total label</span></span>
<span id="cb909-16"><a href="#cb909-16" aria-hidden="true" tabindex="-1"></a>sheet[<span class="ss">f&#39;</span><span class="sc">{</span>excel_alphabet[<span class="dv">0</span>]<span class="sc">}{</span>max_row<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>] <span class="op">=</span> <span class="st">&#39;Total&#39;</span></span>
<span id="cb909-17"><a href="#cb909-17" aria-hidden="true" tabindex="-1"></a>wb.save(<span class="st">&#39;report_2021.xlsx&#39;</span>)</span>
<span id="cb909-18"><a href="#cb909-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb909-19"><a href="#cb909-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Formatear la tabla</span></span>
<span id="cb909-20"><a href="#cb909-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb909-21"><a href="#cb909-21" aria-hidden="true" tabindex="-1"></a>wb <span class="op">=</span> load_workbook(<span class="st">&#39;report_2021.xlsx&#39;</span>)</span>
<span id="cb909-22"><a href="#cb909-22" aria-hidden="true" tabindex="-1"></a>sheet <span class="op">=</span> wb[<span class="st">&#39;Report&#39;</span>]</span>
<span id="cb909-23"><a href="#cb909-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb909-24"><a href="#cb909-24" aria-hidden="true" tabindex="-1"></a>sheet[<span class="st">&#39;A1&#39;</span>] <span class="op">=</span> <span class="st">&#39;Sales Report&#39;</span></span>
<span id="cb909-25"><a href="#cb909-25" aria-hidden="true" tabindex="-1"></a>sheet[<span class="st">&#39;A2&#39;</span>] <span class="op">=</span> <span class="st">&#39;2021&#39;</span></span>
<span id="cb909-26"><a href="#cb909-26" aria-hidden="true" tabindex="-1"></a>sheet[<span class="st">&#39;A1&#39;</span>].font <span class="op">=</span> Font(<span class="st">&#39;Arial&#39;</span>, bold<span class="op">=</span><span class="va">True</span>, size<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb909-27"><a href="#cb909-27" aria-hidden="true" tabindex="-1"></a>sheet[<span class="st">&#39;A2&#39;</span>].font <span class="op">=</span> Font(<span class="st">&#39;Arial&#39;</span>, bold<span class="op">=</span><span class="va">True</span>, size<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb909-28"><a href="#cb909-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb909-29"><a href="#cb909-29" aria-hidden="true" tabindex="-1"></a>wb.save(<span class="st">&#39;report_2021.xlsx&#39;</span>)</span></code></pre></div>
</div>
<div id="automatizar-el-reporte-con-python" class="section level4 hasAnchor" number="4.8.6.3">
<h4 class="hasAnchor"><span class="header-section-number">4.8.6.3</span> Automatizar el reporte con Python<a href="#automatizar-el-reporte-con-python" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb910"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb910-1"><a href="#cb910-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb910-2"><a href="#cb910-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> openpyxl</span>
<span id="cb910-3"><a href="#cb910-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openpyxl <span class="im">import</span> load_workbook</span>
<span id="cb910-4"><a href="#cb910-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openpyxl.styles <span class="im">import</span> Font</span>
<span id="cb910-5"><a href="#cb910-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openpyxl.chart <span class="im">import</span> BarChart, Reference</span>
<span id="cb910-6"><a href="#cb910-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> string</span>
<span id="cb910-7"><a href="#cb910-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb910-8"><a href="#cb910-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> automate_excel(file_name):</span>
<span id="cb910-9"><a href="#cb910-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;The file name should have the following structure: sales_month.xlsx&quot;&quot;&quot;</span></span>
<span id="cb910-10"><a href="#cb910-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># read excel file</span></span>
<span id="cb910-11"><a href="#cb910-11" aria-hidden="true" tabindex="-1"></a>    excel_file <span class="op">=</span> pd.read_excel(file_name)</span>
<span id="cb910-12"><a href="#cb910-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make pivot table</span></span>
<span id="cb910-13"><a href="#cb910-13" aria-hidden="true" tabindex="-1"></a>    report_table <span class="op">=</span> excel_file.pivot_table(index<span class="op">=</span><span class="st">&#39;Gender&#39;</span>, columns<span class="op">=</span><span class="st">&#39;Product line&#39;</span>, values<span class="op">=</span><span class="st">&#39;Total&#39;</span>, aggfunc<span class="op">=</span><span class="st">&#39;sum&#39;</span>).<span class="bu">round</span>(<span class="dv">0</span>)</span>
<span id="cb910-14"><a href="#cb910-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># splitting the month and extension from the file name</span></span>
<span id="cb910-15"><a href="#cb910-15" aria-hidden="true" tabindex="-1"></a>    month_and_extension <span class="op">=</span> file_name.split(<span class="st">&#39;_&#39;</span>)[<span class="dv">1</span>]</span>
<span id="cb910-16"><a href="#cb910-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># send the report table to excel file</span></span>
<span id="cb910-17"><a href="#cb910-17" aria-hidden="true" tabindex="-1"></a>    report_table.to_excel(<span class="ss">f&#39;report_</span><span class="sc">{</span>month_and_extension<span class="sc">}</span><span class="ss">&#39;</span>, sheet_name<span class="op">=</span><span class="st">&#39;Report&#39;</span>, startrow<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb910-18"><a href="#cb910-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># loading workbook and selecting sheet</span></span>
<span id="cb910-19"><a href="#cb910-19" aria-hidden="true" tabindex="-1"></a>    wb <span class="op">=</span> load_workbook(<span class="ss">f&#39;report_</span><span class="sc">{</span>month_and_extension<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb910-20"><a href="#cb910-20" aria-hidden="true" tabindex="-1"></a>    sheet <span class="op">=</span> wb[<span class="st">&#39;Report&#39;</span>]</span>
<span id="cb910-21"><a href="#cb910-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># cell references (original spreadsheet)</span></span>
<span id="cb910-22"><a href="#cb910-22" aria-hidden="true" tabindex="-1"></a>    min_column <span class="op">=</span> wb.active.min_column</span>
<span id="cb910-23"><a href="#cb910-23" aria-hidden="true" tabindex="-1"></a>    max_column <span class="op">=</span> wb.active.max_column</span>
<span id="cb910-24"><a href="#cb910-24" aria-hidden="true" tabindex="-1"></a>    min_row <span class="op">=</span> wb.active.min_row</span>
<span id="cb910-25"><a href="#cb910-25" aria-hidden="true" tabindex="-1"></a>    max_row <span class="op">=</span> wb.active.max_row</span>
<span id="cb910-26"><a href="#cb910-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># adding a chart</span></span>
<span id="cb910-27"><a href="#cb910-27" aria-hidden="true" tabindex="-1"></a>    barchart <span class="op">=</span> BarChart()</span>
<span id="cb910-28"><a href="#cb910-28" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> Reference(sheet, min_col<span class="op">=</span>min_column<span class="op">+</span><span class="dv">1</span>, max_col<span class="op">=</span>max_column, min_row<span class="op">=</span>min_row, max_row<span class="op">=</span>max_row) <span class="co">#including headers</span></span>
<span id="cb910-29"><a href="#cb910-29" aria-hidden="true" tabindex="-1"></a>    categories <span class="op">=</span> Reference(sheet, min_col<span class="op">=</span>min_column, max_col<span class="op">=</span>min_column, min_row<span class="op">=</span>min_row<span class="op">+</span><span class="dv">1</span>, max_row<span class="op">=</span>max_row) <span class="co">#not including headers</span></span>
<span id="cb910-30"><a href="#cb910-30" aria-hidden="true" tabindex="-1"></a>    barchart.add_data(data, titles_from_data<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb910-31"><a href="#cb910-31" aria-hidden="true" tabindex="-1"></a>    barchart.set_categories(categories)</span>
<span id="cb910-32"><a href="#cb910-32" aria-hidden="true" tabindex="-1"></a>    sheet.add_chart(barchart, <span class="st">&quot;B12&quot;</span>) <span class="co">#location chart</span></span>
<span id="cb910-33"><a href="#cb910-33" aria-hidden="true" tabindex="-1"></a>    barchart.title <span class="op">=</span> <span class="st">&#39;Sales by Product line&#39;</span></span>
<span id="cb910-34"><a href="#cb910-34" aria-hidden="true" tabindex="-1"></a>    barchart.style <span class="op">=</span> <span class="dv">2</span> <span class="co">#choose the chart style</span></span>
<span id="cb910-35"><a href="#cb910-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># applying formulas</span></span>
<span id="cb910-36"><a href="#cb910-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># first create alphabet list as references for cells</span></span>
<span id="cb910-37"><a href="#cb910-37" aria-hidden="true" tabindex="-1"></a>    alphabet <span class="op">=</span> <span class="bu">list</span>(string.ascii_uppercase)</span>
<span id="cb910-38"><a href="#cb910-38" aria-hidden="true" tabindex="-1"></a>    excel_alphabet <span class="op">=</span> alphabet[<span class="dv">0</span>:max_column] <span class="co">#note: Python lists start on 0 -&gt; A=0, B=1, C=2. #note2 the [a:b] takes b-a elements</span></span>
<span id="cb910-39"><a href="#cb910-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># sum in columns B-G</span></span>
<span id="cb910-40"><a href="#cb910-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> excel_alphabet:</span>
<span id="cb910-41"><a href="#cb910-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i<span class="op">!=</span><span class="st">&#39;A&#39;</span>:</span>
<span id="cb910-42"><a href="#cb910-42" aria-hidden="true" tabindex="-1"></a>            sheet[<span class="ss">f&#39;</span><span class="sc">{</span>i<span class="sc">}{</span>max_row<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>] <span class="op">=</span> <span class="ss">f&#39;=SUM(</span><span class="sc">{</span>i<span class="sc">}{</span>min_row<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">:</span><span class="sc">{</span>i<span class="sc">}{</span>max_row<span class="sc">}</span><span class="ss">)&#39;</span></span>
<span id="cb910-43"><a href="#cb910-43" aria-hidden="true" tabindex="-1"></a>            sheet[<span class="ss">f&#39;</span><span class="sc">{</span>i<span class="sc">}{</span>max_row<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>].style <span class="op">=</span> <span class="st">&#39;Currency&#39;</span></span>
<span id="cb910-44"><a href="#cb910-44" aria-hidden="true" tabindex="-1"></a>    sheet[<span class="ss">f&#39;</span><span class="sc">{</span>excel_alphabet[<span class="dv">0</span>]<span class="sc">}{</span>max_row<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>] <span class="op">=</span> <span class="st">&#39;Total&#39;</span></span>
<span id="cb910-45"><a href="#cb910-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># getting month name</span></span>
<span id="cb910-46"><a href="#cb910-46" aria-hidden="true" tabindex="-1"></a>    month_name <span class="op">=</span> month_and_extension.split(<span class="st">&#39;.&#39;</span>)[<span class="dv">0</span>]</span>
<span id="cb910-47"><a href="#cb910-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># formatting the report</span></span>
<span id="cb910-48"><a href="#cb910-48" aria-hidden="true" tabindex="-1"></a>    sheet[<span class="st">&#39;A1&#39;</span>] <span class="op">=</span> <span class="st">&#39;Sales Report&#39;</span></span>
<span id="cb910-49"><a href="#cb910-49" aria-hidden="true" tabindex="-1"></a>    sheet[<span class="st">&#39;A2&#39;</span>] <span class="op">=</span> month_name.title()</span>
<span id="cb910-50"><a href="#cb910-50" aria-hidden="true" tabindex="-1"></a>    sheet[<span class="st">&#39;A1&#39;</span>].font <span class="op">=</span> Font(<span class="st">&#39;Arial&#39;</span>, bold<span class="op">=</span><span class="va">True</span>, size<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb910-51"><a href="#cb910-51" aria-hidden="true" tabindex="-1"></a>    sheet[<span class="st">&#39;A2&#39;</span>].font <span class="op">=</span> Font(<span class="st">&#39;Arial&#39;</span>, bold<span class="op">=</span><span class="va">True</span>, size<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb910-52"><a href="#cb910-52" aria-hidden="true" tabindex="-1"></a>    wb.save(<span class="ss">f&#39;report_</span><span class="sc">{</span>month_and_extension<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb910-53"><a href="#cb910-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span></span>
<span id="cb910-54"><a href="#cb910-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb910-55"><a href="#cb910-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Aplicar la función a un archivo</span></span>
<span id="cb910-56"><a href="#cb910-56" aria-hidden="true" tabindex="-1"></a>automate_excel(<span class="st">&#39;datasets</span><span class="ch">\\</span><span class="st">sales_2021.xlsx&#39;</span>)</span>
<span id="cb910-57"><a href="#cb910-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb910-58"><a href="#cb910-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Aplicar la función a múltiples archivos </span></span>
<span id="cb910-59"><a href="#cb910-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb910-60"><a href="#cb910-60" aria-hidden="true" tabindex="-1"></a><span class="co"># cada uno por separado</span></span>
<span id="cb910-61"><a href="#cb910-61" aria-hidden="true" tabindex="-1"></a>automate_excel(<span class="st">&#39;datasets</span><span class="ch">\\</span><span class="st">sales_january.xlsx&#39;</span>)</span>
<span id="cb910-62"><a href="#cb910-62" aria-hidden="true" tabindex="-1"></a>automate_excel(<span class="st">&#39;datasets</span><span class="ch">\\</span><span class="st">sales_february.xlsx&#39;</span>)</span>
<span id="cb910-63"><a href="#cb910-63" aria-hidden="true" tabindex="-1"></a>automate_excel(<span class="st">&#39;datasets</span><span class="ch">\\</span><span class="st">sales_march.xlsx&#39;</span>)</span>
<span id="cb910-64"><a href="#cb910-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb910-65"><a href="#cb910-65" aria-hidden="true" tabindex="-1"></a><span class="co"># option 2: todos juntos </span></span>
<span id="cb910-66"><a href="#cb910-66" aria-hidden="true" tabindex="-1"></a>excel_file_1 <span class="op">=</span> pd.read_excel(<span class="st">&#39;datasets</span><span class="ch">\\</span><span class="st">sales_january.xlsx&#39;</span>)</span>
<span id="cb910-67"><a href="#cb910-67" aria-hidden="true" tabindex="-1"></a>excel_file_2 <span class="op">=</span> pd.read_excel(<span class="st">&#39;datasets</span><span class="ch">\\</span><span class="st">sales_february.xlsx&#39;</span>)</span>
<span id="cb910-68"><a href="#cb910-68" aria-hidden="true" tabindex="-1"></a>excel_file_3 <span class="op">=</span> pd.read_excel(<span class="st">&#39;datasets</span><span class="ch">\\</span><span class="st">sales_march.xlsx&#39;</span>)</span>
<span id="cb910-69"><a href="#cb910-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb910-70"><a href="#cb910-70" aria-hidden="true" tabindex="-1"></a>new_file <span class="op">=</span> pd.concat([excel_file_1,</span>
<span id="cb910-71"><a href="#cb910-71" aria-hidden="true" tabindex="-1"></a>                      excel_file_2,</span>
<span id="cb910-72"><a href="#cb910-72" aria-hidden="true" tabindex="-1"></a>                      excel_file_3], ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb910-73"><a href="#cb910-73" aria-hidden="true" tabindex="-1"></a>new_file.to_excel(<span class="st">&#39;sales_2021.xlsx&#39;</span>)</span>
<span id="cb910-74"><a href="#cb910-74" aria-hidden="true" tabindex="-1"></a>automate_excel(<span class="st">&#39;sales_2021.xlsx&#39;</span>)</span></code></pre></div>
</div>
</div>
</div>
<div id="web-scraping-en-python" class="section level2 hasAnchor" number="4.9">
<h2 class="hasAnchor"><span class="header-section-number">4.9</span> Web Scraping en Python<a href="#web-scraping-en-python" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="introducción-3" class="section level3 hasAnchor" number="4.9.1">
<h3 class="hasAnchor"><span class="header-section-number">4.9.1</span> Introducción<a href="#introducción-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><p>Web scrapping o escrapeo de datos es un conjunto de herramientas que permiten obtener datos que esten disponibles en sitios web.</p></li>
<li><p>Estos datos pueden estar estructurados (datos enfocados en el analisis de datos) o no estructurados (datos previos a un formato de analisis de datos).</p></li>
<li><p>Vamos a ver algunos conceptos básicos, solo con el fin de que los conozcan, y luego vamos a ver varios ejemplos.</p></li>
</ul>
<div id="html" class="section level4 hasAnchor" number="4.9.1.1">
<h4 class="hasAnchor"><span class="header-section-number">4.9.1.1</span> HTML<a href="#html" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p>Hypertext Markup Language</p>
<ul>
<li>Es el lenguaje utilizado para diseñar sitios web.</li>
<li>Contiene varias etiquetas que almacenan todo tipo de información contenido en una página web.</li>
<li>Cada etiqueta tiene un rol especifico. Para ver detalles: w3schools.com/tags/default.asp</li>
<li>Esta organizada jerarquicamente (parecen ramas de arboles). Es importante entender este concepto</li>
<li>Recuerden que nuestro objetivo es entender esta estructura para poder extraer la información.</li>
</ul></li>
</ul>
</div>
<div id="estructura" class="section level4 hasAnchor" number="4.9.1.2">
<h4 class="hasAnchor"><span class="header-section-number">4.9.1.2</span> Estructura<a href="#estructura" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="figure">
<img src="attachment:a2b63850-b0d1-4236-8276-b443b9497008.png" alt="" />
<p class="caption">image.png</p>
</div>
<ul>
<li>html: inicio/fin archivo html</li>
<li>body: cuerpo</li>
<li>div: secciones</li>
<li>p: parrafos.</li>
</ul>
<div class="figure">
<img src="attachment:29d7db3a-9bec-439c-bd49-aa0508d0d511.png" alt="" />
<p class="caption">image.png</p>
</div>
<div class="figure">
<img src="attachment:ed681524-c03b-4144-a695-d5a872b27233.png" alt="" />
<p class="caption">image.png</p>
</div>
<div class="sourceCode" id="cb911"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb911-1"><a href="#cb911-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear un HTML</span></span>
<span id="cb911-2"><a href="#cb911-2" aria-hidden="true" tabindex="-1"></a>html <span class="op">=</span> <span class="st">&#39;&#39;&#39;</span></span>
<span id="cb911-3"><a href="#cb911-3" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;html&gt;</span></span>
<span id="cb911-4"><a href="#cb911-4" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;head&gt;</span></span>
<span id="cb911-5"><a href="#cb911-5" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;title&gt;Intro HTML&lt;/title&gt;</span></span>
<span id="cb911-6"><a href="#cb911-6" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/head&gt;</span></span>
<span id="cb911-7"><a href="#cb911-7" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;body&gt;</span></span>
<span id="cb911-8"><a href="#cb911-8" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;p&gt;Chao Chao!&lt;/p&gt;</span></span>
<span id="cb911-9"><a href="#cb911-9" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;p&gt;Hola Hola!&lt;/p&gt;</span></span>
<span id="cb911-10"><a href="#cb911-10" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/body&gt;</span></span>
<span id="cb911-11"><a href="#cb911-11" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/html&gt;</span></span>
<span id="cb911-12"><a href="#cb911-12" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;&#39;&#39;</span></span>
<span id="cb911-13"><a href="#cb911-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb911-14"><a href="#cb911-14" aria-hidden="true" tabindex="-1"></a>html</span></code></pre></div>
</div>
<div id="css-selectors" class="section level4 hasAnchor" number="4.9.1.3">
<h4 class="hasAnchor"><span class="header-section-number">4.9.1.3</span> CSS selectors<a href="#css-selectors" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>Cascading Style Sheets</li>
<li>Al igual que HTML sirve para generar sitios web.</li>
<li>En CSS hay algunos selectores adicionales, tres principales: class, id y tag.</li>
<li>Estos atributos son subconjuntos de información especifica contenida en cada sección</li>
</ul>
<div class="sourceCode" id="cb912"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb912-1"><a href="#cb912-1" aria-hidden="true" tabindex="-1"></a><span class="co"># HTML/CSS con atributos</span></span>
<span id="cb912-2"><a href="#cb912-2" aria-hidden="true" tabindex="-1"></a>html <span class="op">=</span> <span class="st">&#39;&#39;&#39;</span></span>
<span id="cb912-3"><a href="#cb912-3" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;html&gt;</span></span>
<span id="cb912-4"><a href="#cb912-4" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;body&gt;</span></span>
<span id="cb912-5"><a href="#cb912-5" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;div class=&quot;class1&quot; id=&quot;div1&quot;&gt;</span></span>
<span id="cb912-6"><a href="#cb912-6" aria-hidden="true" tabindex="-1"></a><span class="st">      &lt;p class=&quot;class2&quot;&gt;atributos&lt;/p&gt;</span></span>
<span id="cb912-7"><a href="#cb912-7" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/div&gt;</span></span>
<span id="cb912-8"><a href="#cb912-8" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;div class=&quot;holaholabola&quot;&gt;</span></span>
<span id="cb912-9"><a href="#cb912-9" aria-hidden="true" tabindex="-1"></a><span class="st">      &lt;p class=&quot;class2&quot;&gt;holaholahola!&lt;/p&gt;</span></span>
<span id="cb912-10"><a href="#cb912-10" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/div&gt;</span></span>
<span id="cb912-11"><a href="#cb912-11" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/body&gt;</span></span>
<span id="cb912-12"><a href="#cb912-12" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/html&gt;</span></span>
<span id="cb912-13"><a href="#cb912-13" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;&#39;&#39;</span></span></code></pre></div>
</div>
<div id="xpath" class="section level4 hasAnchor" number="4.9.1.4">
<h4 class="hasAnchor"><span class="header-section-number">4.9.1.4</span> XPATH<a href="#xpath" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>Es un lenguaje que permite construir expresiones que recorren y procesan un documento.</li>
<li>Es parecido a la idea de expresiones regulares al trabajar con texto.-</li>
<li>Tiene en cuenta la estructura jerarquica.</li>
</ul>
<div class="sourceCode" id="cb913"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb913-1"><a href="#cb913-1" aria-hidden="true" tabindex="-1"></a>xpath <span class="op">=</span> <span class="st">&quot;/html/body/div[2]&quot;</span></span></code></pre></div>
<p><img src="attachment:2ae64331-d781-45fa-9c2b-0a0278ea8b33.png" alt="image.png" /><img src="attachment:072ebcac-326a-40d0-8aac-9c59fe30d4f8.png" alt="image.png" /></p>
<ul>
<li>/: sirve para moverse de una generación a otra</li>
<li>etiqueta: indica donde buscar</li>
<li></li>
<li>Con doble // llamo a todas las generaciones</li>
</ul>
<div class="figure">
<img src="attachment:60365afb-3e32-4682-8187-78eadc64d00d.png" alt="" />
<p class="caption">image.png</p>
</div>
<ul>
<li>Más detalles en: <a href="https://www.geeksforgeeks.org/introduction-to-xpath/" class="uri">https://www.geeksforgeeks.org/introduction-to-xpath/</a></li>
</ul>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 4.9.1:</b> Para el siguiente html escriba el xpath que le permita ir a la frase “aprendo python haciendo”</p>
</div>
<div class="sourceCode" id="cb914"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb914-1"><a href="#cb914-1" aria-hidden="true" tabindex="-1"></a>html <span class="op">=</span> <span class="st">&#39;&#39;&#39;</span></span>
<span id="cb914-2"><a href="#cb914-2" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;html&gt;</span></span>
<span id="cb914-3"><a href="#cb914-3" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;body&gt;</span></span>
<span id="cb914-4"><a href="#cb914-4" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;div&gt;</span></span>
<span id="cb914-5"><a href="#cb914-5" aria-hidden="true" tabindex="-1"></a><span class="st">      &lt;p&gt;Me gusta el chocolate&lt;/p&gt;</span></span>
<span id="cb914-6"><a href="#cb914-6" aria-hidden="true" tabindex="-1"></a><span class="st">      &lt;p&gt;Aquí no&lt;/p&gt;</span></span>
<span id="cb914-7"><a href="#cb914-7" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/div&gt;</span></span>
<span id="cb914-8"><a href="#cb914-8" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;div&gt;</span></span>
<span id="cb914-9"><a href="#cb914-9" aria-hidden="true" tabindex="-1"></a><span class="st">      &lt;p&gt;Aprendo python haciendo&lt;/p&gt;</span></span>
<span id="cb914-10"><a href="#cb914-10" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/div&gt;</span></span>
<span id="cb914-11"><a href="#cb914-11" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/body&gt;</span></span>
<span id="cb914-12"><a href="#cb914-12" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/html&gt;</span></span>
<span id="cb914-13"><a href="#cb914-13" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;&#39;&#39;</span></span>
<span id="cb914-14"><a href="#cb914-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb914-15"><a href="#cb914-15" aria-hidden="true" tabindex="-1"></a>xpath <span class="op">=</span> <span class="st">&#39;/html/body/div[2]/p[1]&#39;</span></span></code></pre></div>
</div>
</div>
<div id="muchos-ejemplos-practicos-de-web---scraping" class="section level3 hasAnchor" number="4.9.2">
<h3 class="hasAnchor"><span class="header-section-number">4.9.2</span> Muchos ejemplos practicos de Web - scraping<a href="#muchos-ejemplos-practicos-de-web---scraping" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><p>Todos los conceptos anteriores son muy útiles cuando se trabajan con sitios web complejos. Es probable que si profundizan en el uso de web-scraping los vayan a necesitar. Sin embargo, en la practica vamos a utilziar programas auxiliares que nos permiten conocer las rutas</p></li>
<li><p>Ahora, vamos a mirar como utilizar la siguiente extensión: <a href="https://selectorgadget.com/" class="uri">https://selectorgadget.com/</a></p></li>
<li><p>WS va a utilizar los selectores de CSS y algunas librerías para obtener información guardada jerarquicamente en algún sitio web.</p></li>
<li><p>Imaginemos queremos obtener información de los precios de productos en Amazon, los pasos que necesitamos son:</p>
<ul>
<li>Primero, vamos a hacer una conexión con la página web desde el código de Python.</li>
<li>Una vez conectada, vamos a acceder a la información neta de la págica utilizando alguna librearía.</li>
<li>Vamos a rastrear los selectores que contienen la información que deseamos obtener (en este caso el precio)</li>
<li>Una vez reconocido, utilizaremos distintas funciones para extraer la información.</li>
<li>Una ves onbtenida la información la ordenamos con funciones que ya conocemos (ej. utilizando Pandas).</li>
</ul></li>
<li><p>Vamos a revisar tres librerías: (i) Beatiful Soap; (ii) Selenium.</p></li>
<li><p>Van avanzando en nivel de dificultad.</p></li>
</ul>
<div id="beautiful-soap" class="section level4 hasAnchor" number="4.9.2.1">
<h4 class="hasAnchor"><span class="header-section-number">4.9.2.1</span> Beautiful Soap<a href="#beautiful-soap" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>Beautiful Soup es un paquete de python que se utiliza para analizar documentos HTML y XML.</li>
<li>Es una de las bibliotecas más simples y amigables de python.</li>
<li>Beautiful soup crea un árbol de análisis para diferentes páginas analizadas que se utilizan para extraer datos de la fuente (HTML).</li>
</ul>
<p>Sintaxis Básica:</p>
<div class="sourceCode" id="cb915"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb915-1"><a href="#cb915-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup</span>
<span id="cb915-2"><a href="#cb915-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests           <span class="co">##A Python HTTP library</span></span>
<span id="cb915-3"><a href="#cb915-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb915-4"><a href="#cb915-4" aria-hidden="true" tabindex="-1"></a><span class="co">#url = &#39;WEBSITE_URL&#39; (link)</span></span>
<span id="cb915-5"><a href="#cb915-5" aria-hidden="true" tabindex="-1"></a><span class="co">#res = requests.get(url)  ## HTTP Requests</span></span>
<span id="cb915-6"><a href="#cb915-6" aria-hidden="true" tabindex="-1"></a><span class="co">#print(res)            ## if o/p is &lt;200&gt; then connection established</span></span>
<span id="cb915-7"><a href="#cb915-7" aria-hidden="true" tabindex="-1"></a><span class="co">#soup = BeautifulSoup(res.text,&#39;html.parser&#39;)</span></span>
<span id="cb915-8"><a href="#cb915-8" aria-hidden="true" tabindex="-1"></a><span class="co">#print(soup)          ## source code</span></span></code></pre></div>
<ul>
<li><code>html.parser</code> se utiliza para analizar documentos HTML.</li>
<li><code>soup</code> es un nombre de variable general que se utiliza para la definición del código fuente.</li>
</ul>
<div class="sourceCode" id="cb916"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb916-1"><a href="#cb916-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find, Find All y Select</span></span></code></pre></div>
<p><code>Find</code> es una función incorporada en la biblioteca que se utiliza para obtener el contenido de la fuente. Encuentra la primera ocurrencia del elemento o selector. find se utiliza principalmente para extraer encabezados, títulos, nombres de productos, etc. de la página web. Ejemplos.</p>
<div class="sourceCode" id="cb917"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb917-1"><a href="#cb917-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Retorna el título</span></span>
<span id="cb917-2"><a href="#cb917-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(soup.find(<span class="st">&#39;title&#39;</span>).text)</span>
<span id="cb917-3"><a href="#cb917-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb917-4"><a href="#cb917-4" aria-hidden="true" tabindex="-1"></a><span class="co">## Retorna el texto del primer encabezado  </span></span>
<span id="cb917-5"><a href="#cb917-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(soup.find(<span class="st">&#39;h1&#39;</span>).text)</span>
<span id="cb917-6"><a href="#cb917-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb917-7"><a href="#cb917-7" aria-hidden="true" tabindex="-1"></a><span class="co">## Retorna el contenido de la primera etiqueta div con los atributos tags</span></span>
<span id="cb917-8"><a href="#cb917-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(soup.find(<span class="st">&#39;div&#39;</span>, {<span class="st">&#39;class&#39;</span>: <span class="st">&#39;tags&#39;</span>}))</span>
<span id="cb917-9"><a href="#cb917-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb917-10"><a href="#cb917-10" aria-hidden="true" tabindex="-1"></a><span class="co">## Retorna el texto de etiqueta &quot;a&quot;, pero con atributo &quot;tag&quot;. </span></span>
<span id="cb917-11"><a href="#cb917-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(soup.find(<span class="st">&#39;a&#39;</span>,{<span class="st">&#39;class&#39;</span>:<span class="st">&#39;tag&#39;</span>}).text)</span></code></pre></div>
<ul>
<li><code>Find_all</code> encuentra todas las ocurrencias del elemento o selector.</li>
<li>Se utiliza principalmente para rastrear los datos de las tablas, reseñas de productos, detalles y productos listados en una página web.</li>
<li>Devuelve la salida en forma de lista.</li>
</ul>
<div class="sourceCode" id="cb918"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb918-1"><a href="#cb918-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Retorna todos los div con el atributo/clase product name </span></span>
<span id="cb918-2"><a href="#cb918-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb918-3"><a href="#cb918-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(soup.find_all(<span class="st">&#39;div&#39;</span>, {<span class="st">&#39;class&#39;</span>: <span class="st">&#39;productname&#39;</span>}))</span>
<span id="cb918-4"><a href="#cb918-4" aria-hidden="true" tabindex="-1"></a>productnames <span class="op">=</span> soup.find_all(<span class="st">&#39;div&#39;</span>, {<span class="st">&#39;class&#39;</span>: <span class="st">&#39;productname&#39;</span>})</span>
<span id="cb918-5"><a href="#cb918-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb918-6"><a href="#cb918-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name <span class="kw">in</span> productnames:</span>
<span id="cb918-7"><a href="#cb918-7" aria-hidden="true" tabindex="-1"></a>   <span class="bu">print</span>(name.text)</span></code></pre></div>
<ul>
<li>Select es una de las funciones más potente.</li>
<li>Selecciona el elemento o selector directamente en forma de lista.</li>
<li>Utiliza selectores CSS y selectores de etiquetas.</li>
<li>También devuelve la salida en forma de lista.</li>
</ul>
<div class="sourceCode" id="cb919"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb919-1"><a href="#cb919-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Retorna todas las etiquetas con la clase &quot;productname&quot; en una lista </span></span>
<span id="cb919-2"><a href="#cb919-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb919-3"><a href="#cb919-3" aria-hidden="true" tabindex="-1"></a><span class="co"># print(soup.select(.productname))</span></span>
<span id="cb919-4"><a href="#cb919-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb919-5"><a href="#cb919-5" aria-hidden="true" tabindex="-1"></a><span class="co">## Retorna el primer div con el id product en formato texto </span></span>
<span id="cb919-6"><a href="#cb919-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb919-7"><a href="#cb919-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(soup.select(div <span class="co">#productkey)[0].get_text())</span></span></code></pre></div>
</div>
<div id="ejemplo-1-scraping-para-wikipedia---conociendo-villasana-de-mena" class="section level4 hasAnchor" number="4.9.2.2">
<h4 class="hasAnchor"><span class="header-section-number">4.9.2.2</span> Ejemplo 1: Scraping para Wikipedia - conociendo Villasana de Mena<a href="#ejemplo-1-scraping-para-wikipedia---conociendo-villasana-de-mena" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb920"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb920-1"><a href="#cb920-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cargamos librerías </span></span>
<span id="cb920-2"><a href="#cb920-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb920-3"><a href="#cb920-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup</span>
<span id="cb920-4"><a href="#cb920-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb920-5"><a href="#cb920-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb920-6"><a href="#cb920-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Establecemos conexión</span></span>
<span id="cb920-7"><a href="#cb920-7" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> requests.get(<span class="st">&#39;https://es.wikipedia.org/wiki/Villasana_de_Mena&#39;</span>)</span>
<span id="cb920-8"><a href="#cb920-8" aria-hidden="true" tabindex="-1"></a>res</span>
<span id="cb920-9"><a href="#cb920-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb920-10"><a href="#cb920-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtenemos la codificación de la página web</span></span>
<span id="cb920-11"><a href="#cb920-11" aria-hidden="true" tabindex="-1"></a>soup <span class="op">=</span> BeautifulSoup(res.text,<span class="st">&#39;html.parser&#39;</span>)</span>
<span id="cb920-12"><a href="#cb920-12" aria-hidden="true" tabindex="-1"></a><span class="co">#print(soup)</span></span>
<span id="cb920-13"><a href="#cb920-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb920-14"><a href="#cb920-14" aria-hidden="true" tabindex="-1"></a>nombre <span class="op">=</span> soup.select(<span class="st">&quot;#firstHeading&quot;</span>)[<span class="dv">0</span>].getText().strip()</span>
<span id="cb920-15"><a href="#cb920-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(nombre)</span>
<span id="cb920-16"><a href="#cb920-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb920-17"><a href="#cb920-17" aria-hidden="true" tabindex="-1"></a>primerparrafo <span class="op">=</span> soup.select(<span class="st">&#39;.ambox-content+ p&#39;</span>)[<span class="dv">0</span>].get_text().strip()</span>
<span id="cb920-18"><a href="#cb920-18" aria-hidden="true" tabindex="-1"></a>primerparrafo</span>
<span id="cb920-19"><a href="#cb920-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb920-20"><a href="#cb920-20" aria-hidden="true" tabindex="-1"></a>todoslosparrafos <span class="op">=</span> [soup.select(<span class="st">&#39;p&#39;</span>)[i].get_text().strip() <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="bu">len</span>(soup.select(<span class="st">&#39;p&#39;</span>)))]</span>
<span id="cb920-21"><a href="#cb920-21" aria-hidden="true" tabindex="-1"></a>todoslosparrafos</span>
<span id="cb920-22"><a href="#cb920-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb920-23"><a href="#cb920-23" aria-hidden="true" tabindex="-1"></a>mapa <span class="op">=</span> soup.select(<span class="st">&quot;tr:nth-child(5) img&quot;</span>)[<span class="dv">0</span>]</span>
<span id="cb920-24"><a href="#cb920-24" aria-hidden="true" tabindex="-1"></a>mapa</span>
<span id="cb920-25"><a href="#cb920-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb920-26"><a href="#cb920-26" aria-hidden="true" tabindex="-1"></a>image_url <span class="op">=</span> mapa.attrs[<span class="st">&quot;src&quot;</span>]</span>
<span id="cb920-27"><a href="#cb920-27" aria-hidden="true" tabindex="-1"></a>image_url</span>
<span id="cb920-28"><a href="#cb920-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb920-29"><a href="#cb920-29" aria-hidden="true" tabindex="-1"></a>url_base <span class="op">=</span> <span class="st">&quot;https:&quot;</span></span>
<span id="cb920-30"><a href="#cb920-30" aria-hidden="true" tabindex="-1"></a>image_url <span class="op">=</span> mapa.attrs[<span class="st">&quot;src&quot;</span>]</span>
<span id="cb920-31"><a href="#cb920-31" aria-hidden="true" tabindex="-1"></a>url_final <span class="op">=</span> url_base <span class="op">+</span> image_url </span>
<span id="cb920-32"><a href="#cb920-32" aria-hidden="true" tabindex="-1"></a>url_final</span>
<span id="cb920-33"><a href="#cb920-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb920-34"><a href="#cb920-34" aria-hidden="true" tabindex="-1"></a>img_data <span class="op">=</span> requests.get(url_final).content</span>
<span id="cb920-35"><a href="#cb920-35" aria-hidden="true" tabindex="-1"></a><span class="co">#img_data</span></span>
<span id="cb920-36"><a href="#cb920-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb920-37"><a href="#cb920-37" aria-hidden="true" tabindex="-1"></a>img_data <span class="op">=</span> requests.get(url_final).content</span>
<span id="cb920-38"><a href="#cb920-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb920-39"><a href="#cb920-39" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">&#39;m1.jpg&#39;</span>, <span class="st">&#39;wb&#39;</span>) <span class="im">as</span> handler:</span>
<span id="cb920-40"><a href="#cb920-40" aria-hidden="true" tabindex="-1"></a>    handler.write(img_data)</span>
<span id="cb920-41"><a href="#cb920-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb920-42"><a href="#cb920-42" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb920-43"><a href="#cb920-43" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.image <span class="im">as</span> mpimg</span>
<span id="cb920-44"><a href="#cb920-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb920-45"><a href="#cb920-45" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> mpimg.imread(<span class="st">&#39;m1.jpg&#39;</span>)</span>
<span id="cb920-46"><a href="#cb920-46" aria-hidden="true" tabindex="-1"></a>imgplot <span class="op">=</span> plt.imshow(img)</span>
<span id="cb920-47"><a href="#cb920-47" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb920-48"><a href="#cb920-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb920-49"><a href="#cb920-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Importemos todas las imagenes en un iterador</span></span>
<span id="cb920-50"><a href="#cb920-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb920-51"><a href="#cb920-51" aria-hidden="true" tabindex="-1"></a>imagenes <span class="op">=</span> [soup.select(<span class="st">&quot;td :nth-child(1) .image img&quot;</span>)[i] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(soup.select(<span class="st">&quot;td :nth-child(1) .image img&quot;</span>)))]</span>
<span id="cb920-52"><a href="#cb920-52" aria-hidden="true" tabindex="-1"></a>imagenes</span>
<span id="cb920-53"><a href="#cb920-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb920-54"><a href="#cb920-54" aria-hidden="true" tabindex="-1"></a>url_1 <span class="op">=</span> <span class="st">&quot;https:&quot;</span> <span class="op">+</span> imagenes[<span class="dv">0</span>].attrs[<span class="st">&quot;src&quot;</span>]</span>
<span id="cb920-55"><a href="#cb920-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb920-56"><a href="#cb920-56" aria-hidden="true" tabindex="-1"></a>url_2<span class="op">=</span> <span class="st">&quot;https:&quot;</span> <span class="op">+</span> imagenes[<span class="dv">1</span>].attrs[<span class="st">&quot;src&quot;</span>]</span>
<span id="cb920-57"><a href="#cb920-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb920-58"><a href="#cb920-58" aria-hidden="true" tabindex="-1"></a>url_3 <span class="op">=</span> <span class="st">&quot;https:&quot;</span> <span class="op">+</span>imagenes[<span class="dv">2</span>].attrs[<span class="st">&quot;src&quot;</span>]</span>
<span id="cb920-59"><a href="#cb920-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb920-60"><a href="#cb920-60" aria-hidden="true" tabindex="-1"></a>urls <span class="op">=</span> [url_1, url_2, url_3]</span>
<span id="cb920-61"><a href="#cb920-61" aria-hidden="true" tabindex="-1"></a>urls</span>
<span id="cb920-62"><a href="#cb920-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb920-63"><a href="#cb920-63" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="dv">3</span>): </span>
<span id="cb920-64"><a href="#cb920-64" aria-hidden="true" tabindex="-1"></a>    img_data <span class="op">=</span> requests.get(urls[i]).content</span>
<span id="cb920-65"><a href="#cb920-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(<span class="st">&quot;imagen&quot;</span> <span class="op">+</span> <span class="bu">str</span>(i) <span class="op">+</span> <span class="st">&quot;.jpg&quot;</span>, <span class="st">&quot;wb&quot;</span>) <span class="im">as</span> handler:</span>
<span id="cb920-66"><a href="#cb920-66" aria-hidden="true" tabindex="-1"></a>        handler.write(img_data)</span></code></pre></div>
</div>
<div id="ejemplo-2-datos-de-libros" class="section level4 hasAnchor" number="4.9.2.3">
<h4 class="hasAnchor"><span class="header-section-number">4.9.2.3</span> Ejemplo 2: Datos de libros<a href="#ejemplo-2-datos-de-libros" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb921"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb921-1"><a href="#cb921-1" aria-hidden="true" tabindex="-1"></a><span class="co"># importing the libraries</span></span>
<span id="cb921-2"><a href="#cb921-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup</span>
<span id="cb921-3"><a href="#cb921-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb921-4"><a href="#cb921-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb921-5"><a href="#cb921-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb921-6"><a href="#cb921-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Request</span></span>
<span id="cb921-7"><a href="#cb921-7" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> requests.get(<span class="st">&#39;http://books.toscrape.com/&#39;</span>)</span>
<span id="cb921-8"><a href="#cb921-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb921-9"><a href="#cb921-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtenemos los datos</span></span>
<span id="cb921-10"><a href="#cb921-10" aria-hidden="true" tabindex="-1"></a>soup <span class="op">=</span> BeautifulSoup(r.text, <span class="st">&#39;html.parser&#39;</span>)</span>
<span id="cb921-11"><a href="#cb921-11" aria-hidden="true" tabindex="-1"></a><span class="co">#print(soup)</span></span>
<span id="cb921-12"><a href="#cb921-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb921-13"><a href="#cb921-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Generamos una variable que tenga toda la info con el atributo produc_pod</span></span>
<span id="cb921-14"><a href="#cb921-14" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> soup.find_all(attrs<span class="op">=</span>{<span class="st">&#39;class&#39;</span>:<span class="st">&#39;product_pod&#39;</span>})</span>
<span id="cb921-15"><a href="#cb921-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb921-16"><a href="#cb921-16" aria-hidden="true" tabindex="-1"></a><span class="co"># let&#39;s check how many results we got</span></span>
<span id="cb921-17"><a href="#cb921-17" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(results)</span>
<span id="cb921-18"><a href="#cb921-18" aria-hidden="true" tabindex="-1"></a><span class="co">#print(results)</span></span>
<span id="cb921-19"><a href="#cb921-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb921-20"><a href="#cb921-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Exploremos el primer libro</span></span>
<span id="cb921-21"><a href="#cb921-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb921-22"><a href="#cb921-22" aria-hidden="true" tabindex="-1"></a>first_book <span class="op">=</span> results[<span class="dv">0</span>]</span>
<span id="cb921-23"><a href="#cb921-23" aria-hidden="true" tabindex="-1"></a>first_book</span>
<span id="cb921-24"><a href="#cb921-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb921-25"><a href="#cb921-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtenemos el titulo</span></span>
<span id="cb921-26"><a href="#cb921-26" aria-hidden="true" tabindex="-1"></a>first_book.h3.a.get(<span class="st">&#39;title&#39;</span>)</span>
<span id="cb921-27"><a href="#cb921-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb921-28"><a href="#cb921-28" aria-hidden="true" tabindex="-1"></a><span class="co"># su precio</span></span>
<span id="cb921-29"><a href="#cb921-29" aria-hidden="true" tabindex="-1"></a>first_book.find(<span class="st">&#39;p&#39;</span>, class_<span class="op">=</span><span class="st">&quot;price_color&quot;</span>).text[<span class="dv">2</span>:] <span class="co"># selecting from the 3rd charcater on to get just the price number</span></span>
<span id="cb921-30"><a href="#cb921-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb921-31"><a href="#cb921-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Ahora hagamoslos para todos los libros </span></span>
<span id="cb921-32"><a href="#cb921-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb921-33"><a href="#cb921-33" aria-hidden="true" tabindex="-1"></a>names<span class="op">=</span> []</span>
<span id="cb921-34"><a href="#cb921-34" aria-hidden="true" tabindex="-1"></a>prices<span class="op">=</span> []</span>
<span id="cb921-35"><a href="#cb921-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb921-36"><a href="#cb921-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Rango de páginmas para trabajar </span></span>
<span id="cb921-37"><a href="#cb921-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb921-38"><a href="#cb921-38" aria-hidden="true" tabindex="-1"></a>pages <span class="op">=</span> [<span class="bu">str</span>(i) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">51</span>)]</span>
<span id="cb921-39"><a href="#cb921-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb921-40"><a href="#cb921-40" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> page <span class="kw">in</span> pages:</span>
<span id="cb921-41"><a href="#cb921-41" aria-hidden="true" tabindex="-1"></a>  response <span class="op">=</span> requests.get(<span class="st">&#39;http://books.toscrape.com/catalogue/page-&#39;</span> <span class="op">+</span> page <span class="op">+</span> <span class="st">&#39;.html&#39;</span>)</span>
<span id="cb921-42"><a href="#cb921-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb921-43"><a href="#cb921-43" aria-hidden="true" tabindex="-1"></a>  page_html <span class="op">=</span> BeautifulSoup(response.text, <span class="st">&#39;html.parser&#39;</span>)</span>
<span id="cb921-44"><a href="#cb921-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb921-45"><a href="#cb921-45" aria-hidden="true" tabindex="-1"></a>  book_containers <span class="op">=</span> page_html.find_all(attrs<span class="op">=</span>{<span class="st">&#39;class&#39;</span>:<span class="st">&#39;product_pod&#39;</span>})</span>
<span id="cb921-46"><a href="#cb921-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb921-47"><a href="#cb921-47" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> book <span class="kw">in</span> book_containers:</span>
<span id="cb921-48"><a href="#cb921-48" aria-hidden="true" tabindex="-1"></a>    names.append(book.h3.a.get(<span class="st">&#39;title&#39;</span>))</span>
<span id="cb921-49"><a href="#cb921-49" aria-hidden="true" tabindex="-1"></a>    prices.append(book.find(<span class="st">&#39;p&#39;</span>, class_<span class="op">=</span><span class="st">&quot;price_color&quot;</span>).text[<span class="dv">2</span>:])</span>
<span id="cb921-50"><a href="#cb921-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb921-51"><a href="#cb921-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Ahora vamos a crear una base de datos con todos los libros </span></span>
<span id="cb921-52"><a href="#cb921-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb921-53"><a href="#cb921-53" aria-hidden="true" tabindex="-1"></a>books_df <span class="op">=</span> pd.DataFrame(<span class="bu">list</span>(<span class="bu">zip</span>(names, prices)), columns<span class="op">=</span>[<span class="st">&#39;titles&#39;</span>,<span class="st">&#39;prices (£)&#39;</span>])</span>
<span id="cb921-54"><a href="#cb921-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb921-55"><a href="#cb921-55" aria-hidden="true" tabindex="-1"></a>books_df</span>
<span id="cb921-56"><a href="#cb921-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb921-57"><a href="#cb921-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Ahora hagamoslos para todos los links</span></span>
<span id="cb921-58"><a href="#cb921-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb921-59"><a href="#cb921-59" aria-hidden="true" tabindex="-1"></a>links <span class="op">=</span> []</span>
<span id="cb921-60"><a href="#cb921-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb921-61"><a href="#cb921-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Rango de páginmas para trabajar </span></span>
<span id="cb921-62"><a href="#cb921-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb921-63"><a href="#cb921-63" aria-hidden="true" tabindex="-1"></a>pages <span class="op">=</span> [<span class="bu">str</span>(i) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">51</span>)]</span>
<span id="cb921-64"><a href="#cb921-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb921-65"><a href="#cb921-65" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> page <span class="kw">in</span> pages:</span>
<span id="cb921-66"><a href="#cb921-66" aria-hidden="true" tabindex="-1"></a>  response <span class="op">=</span> requests.get(<span class="st">&#39;http://books.toscrape.com/catalogue/page-&#39;</span> <span class="op">+</span> page <span class="op">+</span> <span class="st">&#39;.html&#39;</span>)</span>
<span id="cb921-67"><a href="#cb921-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb921-68"><a href="#cb921-68" aria-hidden="true" tabindex="-1"></a>  page_html <span class="op">=</span> BeautifulSoup(response.text, <span class="st">&#39;html.parser&#39;</span>)</span>
<span id="cb921-69"><a href="#cb921-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb921-70"><a href="#cb921-70" aria-hidden="true" tabindex="-1"></a>  book_containers <span class="op">=</span> page_html.find_all(attrs<span class="op">=</span>{<span class="st">&#39;class&#39;</span>:<span class="st">&#39;product_pod&#39;</span>})</span>
<span id="cb921-71"><a href="#cb921-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb921-72"><a href="#cb921-72" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> book <span class="kw">in</span> book_containers:</span>
<span id="cb921-73"><a href="#cb921-73" aria-hidden="true" tabindex="-1"></a>    links.append(book.h3.a.get(<span class="st">&quot;href&quot;</span>))</span>
<span id="cb921-74"><a href="#cb921-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb921-75"><a href="#cb921-75" aria-hidden="true" tabindex="-1"></a>links[<span class="dv">100</span>]</span>
<span id="cb921-76"><a href="#cb921-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb921-77"><a href="#cb921-77" aria-hidden="true" tabindex="-1"></a>enlace_final <span class="op">=</span> []</span>
<span id="cb921-78"><a href="#cb921-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb921-79"><a href="#cb921-79" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(links)):</span>
<span id="cb921-80"><a href="#cb921-80" aria-hidden="true" tabindex="-1"></a>    enlace_final.append(<span class="st">&quot;http://books.toscrape.com/catalogue/&quot;</span> <span class="op">+</span> links[i])</span>
<span id="cb921-81"><a href="#cb921-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb921-82"><a href="#cb921-82" aria-hidden="true" tabindex="-1"></a><span class="co">#print(enlace_final)</span></span></code></pre></div>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 4.9.2: </b> Arme un código que le permita extraer todas las portadas. Utilice la lista enlace_final que acaba de crear</p>
</div>
<div class="sourceCode" id="cb922"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb922-1"><a href="#cb922-1" aria-hidden="true" tabindex="-1"></a>enlace_final[<span class="dv">0</span>]</span>
<span id="cb922-2"><a href="#cb922-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb922-3"><a href="#cb922-3" aria-hidden="true" tabindex="-1"></a>portadas <span class="op">=</span> []</span>
<span id="cb922-4"><a href="#cb922-4" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(enlace_final[<span class="dv">0</span>])</span>
<span id="cb922-5"><a href="#cb922-5" aria-hidden="true" tabindex="-1"></a>page_html <span class="op">=</span> BeautifulSoup(response.text, <span class="st">&#39;html.parser&#39;</span>)    </span>
<span id="cb922-6"><a href="#cb922-6" aria-hidden="true" tabindex="-1"></a>book_containers <span class="op">=</span> page_html.find_all(<span class="st">&quot;img&quot;</span>)</span>
<span id="cb922-7"><a href="#cb922-7" aria-hidden="true" tabindex="-1"></a>book_containers[<span class="dv">0</span>].get(<span class="st">&quot;src&quot;</span>)</span>
<span id="cb922-8"><a href="#cb922-8" aria-hidden="true" tabindex="-1"></a>enlace_book <span class="op">=</span> <span class="st">&quot;http://books.toscrape.com/&quot;</span> <span class="op">+</span> book_containers[<span class="dv">0</span>].get(<span class="st">&quot;src&quot;</span>)</span>
<span id="cb922-9"><a href="#cb922-9" aria-hidden="true" tabindex="-1"></a>enlace_book</span>
<span id="cb922-10"><a href="#cb922-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb922-11"><a href="#cb922-11" aria-hidden="true" tabindex="-1"></a><span class="co">#enlace_final</span></span>
<span id="cb922-12"><a href="#cb922-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb922-13"><a href="#cb922-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Ahora hagamoslos para todos las portadas </span></span>
<span id="cb922-14"><a href="#cb922-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb922-15"><a href="#cb922-15" aria-hidden="true" tabindex="-1"></a>portadas <span class="op">=</span> []</span>
<span id="cb922-16"><a href="#cb922-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb922-17"><a href="#cb922-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Rango a trabajar </span></span>
<span id="cb922-18"><a href="#cb922-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb922-19"><a href="#cb922-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="dv">100</span>):</span>
<span id="cb922-20"><a href="#cb922-20" aria-hidden="true" tabindex="-1"></a>  response <span class="op">=</span> requests.get(enlace_final[i])</span>
<span id="cb922-21"><a href="#cb922-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb922-22"><a href="#cb922-22" aria-hidden="true" tabindex="-1"></a>  page_html <span class="op">=</span> BeautifulSoup(response.text, <span class="st">&#39;html.parser&#39;</span>)</span>
<span id="cb922-23"><a href="#cb922-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb922-24"><a href="#cb922-24" aria-hidden="true" tabindex="-1"></a>  book_containers <span class="op">=</span> page_html.find_all(<span class="st">&quot;img&quot;</span>)</span>
<span id="cb922-25"><a href="#cb922-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb922-26"><a href="#cb922-26" aria-hidden="true" tabindex="-1"></a>  enlace_book <span class="op">=</span> <span class="st">&quot;http://books.toscrape.com/&quot;</span> <span class="op">+</span> book_containers[<span class="dv">0</span>].get(<span class="st">&quot;src&quot;</span>)</span>
<span id="cb922-27"><a href="#cb922-27" aria-hidden="true" tabindex="-1"></a>  portadas.append(enlace_book)</span>
<span id="cb922-28"><a href="#cb922-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb922-29"><a href="#cb922-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Exportemos </span></span>
<span id="cb922-30"><a href="#cb922-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb922-31"><a href="#cb922-31" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="dv">10</span>): </span>
<span id="cb922-32"><a href="#cb922-32" aria-hidden="true" tabindex="-1"></a>    img_data <span class="op">=</span> requests.get(portadas[i]).content</span>
<span id="cb922-33"><a href="#cb922-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(<span class="st">&quot;imagen&quot;</span> <span class="op">+</span> <span class="bu">str</span>(i) <span class="op">+</span> <span class="st">&quot;.jpg&quot;</span>, <span class="st">&quot;wb&quot;</span>) <span class="im">as</span> handler:</span>
<span id="cb922-34"><a href="#cb922-34" aria-hidden="true" tabindex="-1"></a>        handler.write(img_data)</span></code></pre></div>
</div>
<div id="ejemplo-3-datos-de-supermercado" class="section level4 hasAnchor" number="4.9.2.4">
<h4 class="hasAnchor"><span class="header-section-number">4.9.2.4</span> Ejemplo 3: Datos de supermercado<a href="#ejemplo-3-datos-de-supermercado" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p>Vamos a operar en dos pasos para que vean una forma alternativa de hacer un scrapping</p></li>
<li><p>Vamos a scrapiar la página de frutas del lider # importing the libraries
from bs4 import BeautifulSoup
import requests
import pandas as pd</p></li>
</ul>
<div class="sourceCode" id="cb923"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb923-1"><a href="#cb923-1" aria-hidden="true" tabindex="-1"></a><span class="co"># importing the libraries</span></span>
<span id="cb923-2"><a href="#cb923-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup</span>
<span id="cb923-3"><a href="#cb923-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb923-4"><a href="#cb923-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb923-5"><a href="#cb923-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb923-6"><a href="#cb923-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Request</span></span>
<span id="cb923-7"><a href="#cb923-7" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> requests.get(<span class="st">&#39;https://www.lider.cl/supermercado/category/Frutas-y-Verduras/Frutas/_/N-1hd567c&#39;</span>)</span>
<span id="cb923-8"><a href="#cb923-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb923-9"><a href="#cb923-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtenemos los datos</span></span>
<span id="cb923-10"><a href="#cb923-10" aria-hidden="true" tabindex="-1"></a>soup <span class="op">=</span> BeautifulSoup(r.text, <span class="st">&#39;html.parser&#39;</span>)</span>
<span id="cb923-11"><a href="#cb923-11" aria-hidden="true" tabindex="-1"></a><span class="co">#print(soup)</span></span>
<span id="cb923-12"><a href="#cb923-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb923-13"><a href="#cb923-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Generamos una variable que tenga toda la info con el atributo produc_pod</span></span>
<span id="cb923-14"><a href="#cb923-14" aria-hidden="true" tabindex="-1"></a>contenedor <span class="op">=</span> soup.find_all(attrs<span class="op">=</span>{<span class="st">&#39;class&#39;</span>:<span class="st">&#39;product-image&#39;</span>})</span>
<span id="cb923-15"><a href="#cb923-15" aria-hidden="true" tabindex="-1"></a>pproducto <span class="op">=</span> contenedor[<span class="dv">0</span>]</span>
<span id="cb923-16"><a href="#cb923-16" aria-hidden="true" tabindex="-1"></a>pproducto</span>
<span id="cb923-17"><a href="#cb923-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb923-18"><a href="#cb923-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtenemos el nombre del producto </span></span>
<span id="cb923-19"><a href="#cb923-19" aria-hidden="true" tabindex="-1"></a>nombre <span class="op">=</span> pproducto.find(<span class="st">&#39;img&#39;</span>).get(<span class="st">&quot;alt&quot;</span>)</span>
<span id="cb923-20"><a href="#cb923-20" aria-hidden="true" tabindex="-1"></a>nombre</span>
<span id="cb923-21"><a href="#cb923-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb923-22"><a href="#cb923-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Vamos a obtener los links</span></span>
<span id="cb923-23"><a href="#cb923-23" aria-hidden="true" tabindex="-1"></a>enlace <span class="op">=</span> <span class="st">&quot;https://www.lider.cl&quot;</span> <span class="op">+</span> pproducto.find(<span class="st">&#39;a&#39;</span>, class_<span class="op">=</span><span class="st">&quot;product-link&quot;</span>).get(<span class="st">&quot;href&quot;</span>)</span>
<span id="cb923-24"><a href="#cb923-24" aria-hidden="true" tabindex="-1"></a>enlace</span>
<span id="cb923-25"><a href="#cb923-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb923-26"><a href="#cb923-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Ahora para todos los productos de la pagina </span></span>
<span id="cb923-27"><a href="#cb923-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb923-28"><a href="#cb923-28" aria-hidden="true" tabindex="-1"></a>nombre <span class="op">=</span> []</span>
<span id="cb923-29"><a href="#cb923-29" aria-hidden="true" tabindex="-1"></a>enlaces <span class="op">=</span> []</span>
<span id="cb923-30"><a href="#cb923-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb923-31"><a href="#cb923-31" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(<span class="st">&quot;https://www.lider.cl/supermercado/category/Frutas-y-Verduras/Frutas/_/N-1hd567c&quot;</span>)</span>
<span id="cb923-32"><a href="#cb923-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb923-33"><a href="#cb923-33" aria-hidden="true" tabindex="-1"></a>page_html <span class="op">=</span> BeautifulSoup(response.text, <span class="st">&#39;html.parser&#39;</span>)</span>
<span id="cb923-34"><a href="#cb923-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb923-35"><a href="#cb923-35" aria-hidden="true" tabindex="-1"></a>product_containers <span class="op">=</span> page_html.find_all(attrs<span class="op">=</span>{<span class="st">&#39;class&#39;</span>:<span class="st">&#39;product-image&#39;</span>})</span>
<span id="cb923-36"><a href="#cb923-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb923-37"><a href="#cb923-37" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> product <span class="kw">in</span> product_containers:</span>
<span id="cb923-38"><a href="#cb923-38" aria-hidden="true" tabindex="-1"></a>    nombre.append(product.find(<span class="st">&#39;img&#39;</span>).get(<span class="st">&quot;alt&quot;</span>))</span>
<span id="cb923-39"><a href="#cb923-39" aria-hidden="true" tabindex="-1"></a>    enlaces.append(<span class="st">&quot;https://www.lider.cl&quot;</span> <span class="op">+</span> product.find(<span class="st">&#39;a&#39;</span>, class_<span class="op">=</span><span class="st">&quot;product-link&quot;</span>).get(<span class="st">&quot;href&quot;</span>))</span>
<span id="cb923-40"><a href="#cb923-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb923-41"><a href="#cb923-41" aria-hidden="true" tabindex="-1"></a>nombre</span>
<span id="cb923-42"><a href="#cb923-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb923-43"><a href="#cb923-43" aria-hidden="true" tabindex="-1"></a>enlaces</span>
<span id="cb923-44"><a href="#cb923-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb923-45"><a href="#cb923-45" aria-hidden="true" tabindex="-1"></a>productos_df <span class="op">=</span> pd.DataFrame(<span class="bu">list</span>(<span class="bu">zip</span>(nombre, enlaces)), columns<span class="op">=</span>[<span class="st">&#39;Nombre Producto&#39;</span>,<span class="st">&#39;enlace&#39;</span>])</span>
<span id="cb923-46"><a href="#cb923-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb923-47"><a href="#cb923-47" aria-hidden="true" tabindex="-1"></a>productos_df.head()</span></code></pre></div>
<ul>
<li>Ahora vamos a operar en el segundo paso. Para cada enlace vamos a crear una base de datos con la información que contiene.</li>
<li>En este caso vamos a iterar sobre los enlaces de los productos</li>
</ul>
<div class="sourceCode" id="cb924"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb924-1"><a href="#cb924-1" aria-hidden="true" tabindex="-1"></a><span class="co">#enlaces</span></span>
<span id="cb924-2"><a href="#cb924-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb924-3"><a href="#cb924-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Nombre producto </span></span>
<span id="cb924-4"><a href="#cb924-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb924-5"><a href="#cb924-5" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(<span class="st">&quot;https://www.lider.cl/supermercado/product/Palta-Palta-Hass-Malla/4545&quot;</span>)</span>
<span id="cb924-6"><a href="#cb924-6" aria-hidden="true" tabindex="-1"></a>soup <span class="op">=</span> BeautifulSoup(response.text, <span class="st">&#39;html.parser&#39;</span>)</span>
<span id="cb924-7"><a href="#cb924-7" aria-hidden="true" tabindex="-1"></a>contenedor <span class="op">=</span> soup.find_all(attrs<span class="op">=</span>{<span class="st">&#39;class&#39;</span>:<span class="st">&#39;product-info&#39;</span>})</span>
<span id="cb924-8"><a href="#cb924-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb924-9"><a href="#cb924-9" aria-hidden="true" tabindex="-1"></a>contenedor</span>
<span id="cb924-10"><a href="#cb924-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb924-11"><a href="#cb924-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Nombre del producto</span></span>
<span id="cb924-12"><a href="#cb924-12" aria-hidden="true" tabindex="-1"></a>nombre <span class="op">=</span> soup.find(<span class="st">&quot;span&quot;</span>, class_<span class="op">=</span><span class="st">&quot;product-descript&quot;</span>).get_text().strip()</span>
<span id="cb924-13"><a href="#cb924-13" aria-hidden="true" tabindex="-1"></a>nombre</span>
<span id="cb924-14"><a href="#cb924-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb924-15"><a href="#cb924-15" aria-hidden="true" tabindex="-1"></a>precio <span class="op">=</span> soup.find(<span class="st">&quot;p&quot;</span>, class_<span class="op">=</span><span class="st">&quot;price&quot;</span>).get_text().strip()</span>
<span id="cb924-16"><a href="#cb924-16" aria-hidden="true" tabindex="-1"></a>precio</span>
<span id="cb924-17"><a href="#cb924-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb924-18"><a href="#cb924-18" aria-hidden="true" tabindex="-1"></a>puntos <span class="op">=</span> soup.find(class_<span class="op">=</span><span class="st">&quot;miclub&quot;</span>).get_text().strip().replace(<span class="st">u&#39;</span><span class="ch">\xa0</span><span class="st">&#39;</span>, <span class="st">u&#39; &#39;</span>)</span>
<span id="cb924-19"><a href="#cb924-19" aria-hidden="true" tabindex="-1"></a>puntos</span>
<span id="cb924-20"><a href="#cb924-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb924-21"><a href="#cb924-21" aria-hidden="true" tabindex="-1"></a><span class="co">#enlaces</span></span>
<span id="cb924-22"><a href="#cb924-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb924-23"><a href="#cb924-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Ahora escalemos...</span></span>
<span id="cb924-24"><a href="#cb924-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb924-25"><a href="#cb924-25" aria-hidden="true" tabindex="-1"></a>nombres <span class="op">=</span> []</span>
<span id="cb924-26"><a href="#cb924-26" aria-hidden="true" tabindex="-1"></a>precios <span class="op">=</span> []</span>
<span id="cb924-27"><a href="#cb924-27" aria-hidden="true" tabindex="-1"></a>puntos <span class="op">=</span>  []</span>
<span id="cb924-28"><a href="#cb924-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb924-29"><a href="#cb924-29" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="dv">10</span>):</span>
<span id="cb924-30"><a href="#cb924-30" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> requests.get(enlaces[i])</span>
<span id="cb924-31"><a href="#cb924-31" aria-hidden="true" tabindex="-1"></a>    soup <span class="op">=</span> BeautifulSoup(response.text, <span class="st">&#39;html.parser&#39;</span>)</span>
<span id="cb924-32"><a href="#cb924-32" aria-hidden="true" tabindex="-1"></a>    nombres.append(soup.find(<span class="st">&quot;span&quot;</span>, class_<span class="op">=</span><span class="st">&quot;product-descript&quot;</span>).get_text().strip())</span>
<span id="cb924-33"><a href="#cb924-33" aria-hidden="true" tabindex="-1"></a>    precios.append(soup.find(<span class="st">&quot;p&quot;</span>, class_<span class="op">=</span><span class="st">&quot;price&quot;</span>).get_text().strip())</span>
<span id="cb924-34"><a href="#cb924-34" aria-hidden="true" tabindex="-1"></a>    puntos.append(soup.find(class_<span class="op">=</span><span class="st">&quot;miclub&quot;</span>).get_text().strip().replace(<span class="st">u&#39;</span><span class="ch">\xa0</span><span class="st">&#39;</span>, <span class="st">u&#39; &#39;</span>))</span>
<span id="cb924-35"><a href="#cb924-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb924-36"><a href="#cb924-36" aria-hidden="true" tabindex="-1"></a>puntos</span>
<span id="cb924-37"><a href="#cb924-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb924-38"><a href="#cb924-38" aria-hidden="true" tabindex="-1"></a>productos_final_df <span class="op">=</span> pd.DataFrame(<span class="bu">list</span>(<span class="bu">zip</span>(nombres, precios, puntos)), columns<span class="op">=</span>[<span class="st">&#39;Nombre Producto&#39;</span>,<span class="st">&#39;Precio&#39;</span>, <span class="st">&quot;Puntos&quot;</span>])</span>
<span id="cb924-39"><a href="#cb924-39" aria-hidden="true" tabindex="-1"></a>productos_final_df</span>
<span id="cb924-40"><a href="#cb924-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb924-41"><a href="#cb924-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Hacemos un merge </span></span>
<span id="cb924-42"><a href="#cb924-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb924-43"><a href="#cb924-43" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> productos_df.merge(productos_final_df, </span>
<span id="cb924-44"><a href="#cb924-44" aria-hidden="true" tabindex="-1"></a>          on <span class="op">=</span> <span class="st">&quot;Nombre Producto&quot;</span>)</span>
<span id="cb924-45"><a href="#cb924-45" aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div>
</div>
<div id="ejemplo-4-datos-de-transparencia" class="section level4 hasAnchor" number="4.9.2.5">
<h4 class="hasAnchor"><span class="header-section-number">4.9.2.5</span> Ejemplo 4: Datos de transparencia<a href="#ejemplo-4-datos-de-transparencia" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb925"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb925-1"><a href="#cb925-1" aria-hidden="true" tabindex="-1"></a><span class="co"># importing the libraries</span></span>
<span id="cb925-2"><a href="#cb925-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup</span>
<span id="cb925-3"><a href="#cb925-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb925-4"><a href="#cb925-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb925-5"><a href="#cb925-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb925-6"><a href="#cb925-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Request</span></span>
<span id="cb925-7"><a href="#cb925-7" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> requests.get(<span class="st">&#39;http://transparencia.mineduc.cl/2018/dotacion/enero/per_planta.html&#39;</span>)</span>
<span id="cb925-8"><a href="#cb925-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb925-9"><a href="#cb925-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtenemos los datos</span></span>
<span id="cb925-10"><a href="#cb925-10" aria-hidden="true" tabindex="-1"></a>soup <span class="op">=</span> BeautifulSoup(r.text, <span class="st">&#39;html.parser&#39;</span>)</span>
<span id="cb925-11"><a href="#cb925-11" aria-hidden="true" tabindex="-1"></a><span class="co">#print(soup)</span></span>
<span id="cb925-12"><a href="#cb925-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb925-13"><a href="#cb925-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Classes of each table:&#39;</span>)</span>
<span id="cb925-14"><a href="#cb925-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> table <span class="kw">in</span> soup.find_all(<span class="st">&#39;table&#39;</span>):</span>
<span id="cb925-15"><a href="#cb925-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(table.get(<span class="st">&#39;class&#39;</span>))</span>
<span id="cb925-16"><a href="#cb925-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating list with all tables</span></span>
<span id="cb925-17"><a href="#cb925-17" aria-hidden="true" tabindex="-1"></a>tables <span class="op">=</span> soup.find_all(<span class="st">&#39;table&#39;</span>)</span>
<span id="cb925-18"><a href="#cb925-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb925-19"><a href="#cb925-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Definimos dataset</span></span>
<span id="cb925-20"><a href="#cb925-20" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(columns<span class="op">=</span>[<span class="st">&#39;Estamento&#39;</span>, <span class="st">&#39;Profesion&#39;</span>, <span class="st">&#39;Region&#39;</span>,<span class="st">&#39;Sueldo&#39;</span>])</span>
<span id="cb925-21"><a href="#cb925-21" aria-hidden="true" tabindex="-1"></a>df</span>
<span id="cb925-22"><a href="#cb925-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb925-23"><a href="#cb925-23" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb925-24"><a href="#cb925-24" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">&quot;ignore&quot;</span>)</span>
<span id="cb925-25"><a href="#cb925-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb925-26"><a href="#cb925-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> table.tbody.find_all(<span class="st">&#39;tr&#39;</span>):    </span>
<span id="cb925-27"><a href="#cb925-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb925-28"><a href="#cb925-28" aria-hidden="true" tabindex="-1"></a>    columns <span class="op">=</span> row.find_all(<span class="st">&#39;td&#39;</span>)</span>
<span id="cb925-29"><a href="#cb925-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb925-30"><a href="#cb925-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(columns <span class="op">!=</span> []):</span>
<span id="cb925-31"><a href="#cb925-31" aria-hidden="true" tabindex="-1"></a>        estamento<span class="op">=</span> columns[<span class="dv">0</span>].text.strip()</span>
<span id="cb925-32"><a href="#cb925-32" aria-hidden="true" tabindex="-1"></a>        calif <span class="op">=</span> columns[<span class="dv">5</span>].text.strip()</span>
<span id="cb925-33"><a href="#cb925-33" aria-hidden="true" tabindex="-1"></a>        region <span class="op">=</span> columns[<span class="dv">7</span>].text.strip()</span>
<span id="cb925-34"><a href="#cb925-34" aria-hidden="true" tabindex="-1"></a>        plata <span class="op">=</span> columns[<span class="dv">10</span>].text.strip()</span>
<span id="cb925-35"><a href="#cb925-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb925-36"><a href="#cb925-36" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df.append({<span class="st">&#39;Estamento&#39;</span>: estamento,  <span class="st">&#39;Profesion&#39;</span>: calif, <span class="st">&#39;Region&#39;</span>: region, <span class="st">&#39;Sueldo&#39;</span>: plata}, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb925-37"><a href="#cb925-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb925-38"><a href="#cb925-38" aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div>
</div>
</div>
<div id="selenium" class="section level3 hasAnchor" number="4.9.3">
<h3 class="hasAnchor"><span class="header-section-number">4.9.3</span> Selenium<a href="#selenium" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Nos permite hacer web-scraping más sofisticados. Por ejemplo, si deseo hacer un click en algo.</li>
<li>Veremos en detalle un ejemplo que muestra la utilidad de Selenium para automatizar procesos de extracción de datos</li>
</ul>
<div id="ejemplo-1-obteniendo-información-de-tripadvisor" class="section level4 hasAnchor" number="4.9.3.1">
<h4 class="hasAnchor"><span class="header-section-number">4.9.3.1</span> Ejemplo 1: Obteniendo información de TripAdvisor<a href="#ejemplo-1-obteniendo-información-de-tripadvisor" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb926"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb926-1"><a href="#cb926-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> selenium <span class="im">import</span> webdriver</span>
<span id="cb926-2"><a href="#cb926-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> csv</span>
<span id="cb926-3"><a href="#cb926-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb926-4"><a href="#cb926-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb926-5"><a href="#cb926-5" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">&quot;ignore&quot;</span>)</span>
<span id="cb926-6"><a href="#cb926-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb926-7"><a href="#cb926-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Ejemplo: obtener los reviews desde Trip Advisor </span></span>
<span id="cb926-8"><a href="#cb926-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb926-9"><a href="#cb926-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Importamos librearía principal</span></span>
<span id="cb926-10"><a href="#cb926-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> selenium <span class="im">import</span> webdriver</span>
<span id="cb926-11"><a href="#cb926-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> selenium.webdriver.common.by <span class="im">import</span> By</span>
<span id="cb926-12"><a href="#cb926-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> selenium.webdriver.support.ui <span class="im">import</span> WebDriverWait </span>
<span id="cb926-13"><a href="#cb926-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> selenium.webdriver.support <span class="im">import</span> expected_conditions <span class="im">as</span> EC</span>
<span id="cb926-14"><a href="#cb926-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb926-15"><a href="#cb926-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Definimos link que vamos a mirar </span></span>
<span id="cb926-16"><a href="#cb926-16" aria-hidden="true" tabindex="-1"></a>URL <span class="op">=</span> <span class="st">&quot;https://www.tripadvisor.com/Restaurant_Review-g190328-d8867662-Reviews-Storie_Sapori_La_Valletta-Valletta_Island_of_Malta.html&quot;</span></span>
<span id="cb926-17"><a href="#cb926-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb926-18"><a href="#cb926-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Abrimos el navegador que vamos a utilizar </span></span>
<span id="cb926-19"><a href="#cb926-19" aria-hidden="true" tabindex="-1"></a>driver <span class="op">=</span> webdriver.Chrome()</span>
<span id="cb926-20"><a href="#cb926-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Abrimos la página web que vamos a utilizar </span></span>
<span id="cb926-21"><a href="#cb926-21" aria-hidden="true" tabindex="-1"></a>driver.get(URL)</span>
<span id="cb926-22"><a href="#cb926-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb926-23"><a href="#cb926-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Hacemos que la página web espere 10 segundos, la idea es que pueda cargar el cookie</span></span>
<span id="cb926-24"><a href="#cb926-24" aria-hidden="true" tabindex="-1"></a>wait <span class="op">=</span> WebDriverWait(driver, <span class="dv">10</span>)</span>
<span id="cb926-25"><a href="#cb926-25" aria-hidden="true" tabindex="-1"></a>wait.until(EC.element_to_be_clickable((By.XPATH, <span class="st">&quot;//button[text()=&#39;I Accept&#39;]&quot;</span>))).click()</span>
<span id="cb926-26"><a href="#cb926-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb926-27"><a href="#cb926-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Vamos a abrir un archivo csv </span></span>
<span id="cb926-28"><a href="#cb926-28" aria-hidden="true" tabindex="-1"></a>csvFile <span class="op">=</span> <span class="bu">open</span>(<span class="st">&quot;reviews.csv&quot;</span>, </span>
<span id="cb926-29"><a href="#cb926-29" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;w&quot;</span>, </span>
<span id="cb926-30"><a href="#cb926-30" aria-hidden="true" tabindex="-1"></a>               newline<span class="op">=</span><span class="st">&#39;&#39;</span>, </span>
<span id="cb926-31"><a href="#cb926-31" aria-hidden="true" tabindex="-1"></a>               encoding<span class="op">=</span><span class="st">&quot;utf-8&quot;</span>)</span>
<span id="cb926-32"><a href="#cb926-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb926-33"><a href="#cb926-33" aria-hidden="true" tabindex="-1"></a>csvWriter <span class="op">=</span> csv.writer(csvFile)</span>
<span id="cb926-34"><a href="#cb926-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb926-35"><a href="#cb926-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Vamos a incluir las columnas para las cuales queremos obtener información </span></span>
<span id="cb926-36"><a href="#cb926-36" aria-hidden="true" tabindex="-1"></a>csvWriter.writerow([<span class="st">&#39;Score&#39;</span>,<span class="st">&#39;Date&#39;</span>,<span class="st">&#39;Title&#39;</span>,<span class="st">&#39;Review&#39;</span>])</span>
<span id="cb926-37"><a href="#cb926-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb926-38"><a href="#cb926-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Ahora, tengo que ir a las recomendaciones y apretar en &quot;more reviews&quot; para </span></span>
<span id="cb926-39"><a href="#cb926-39" aria-hidden="true" tabindex="-1"></a><span class="co"># cargar todas las revisiones</span></span>
<span id="cb926-40"><a href="#cb926-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb926-41"><a href="#cb926-41" aria-hidden="true" tabindex="-1"></a>driver.find_element_by_xpath(<span class="st">&#39;//*[@id=&quot;taplc_location_reviews_list_resp_rr_resp_0&quot;]/div/div[17]&#39;</span>).click()</span>
<span id="cb926-42"><a href="#cb926-42" aria-hidden="true" tabindex="-1"></a>time.sleep(<span class="dv">5</span>) <span class="co"># Wait for reviews to load</span></span>
<span id="cb926-43"><a href="#cb926-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb926-44"><a href="#cb926-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Vamos a revisar paso a paso como logramos esto</span></span>
<span id="cb926-45"><a href="#cb926-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb926-46"><a href="#cb926-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Ahora vamos a buscar los elementos contenidos en las reviews</span></span>
<span id="cb926-47"><a href="#cb926-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb926-48"><a href="#cb926-48" aria-hidden="true" tabindex="-1"></a>reviews <span class="op">=</span> driver.find_elements_by_xpath(<span class="st">&quot;//div[@class=&#39;ui_column is-9&#39;]&quot;</span>)</span>
<span id="cb926-49"><a href="#cb926-49" aria-hidden="true" tabindex="-1"></a>num_page_items <span class="op">=</span> <span class="bu">min</span>(<span class="bu">len</span>(reviews), <span class="dv">10</span>)</span>
<span id="cb926-50"><a href="#cb926-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb926-51"><a href="#cb926-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Vemos la cantidad de reviews de esta pagina</span></span>
<span id="cb926-52"><a href="#cb926-52" aria-hidden="true" tabindex="-1"></a>num_page_items</span>
<span id="cb926-53"><a href="#cb926-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb926-54"><a href="#cb926-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Iteramos sobre la cantidad de reviews. Para cada review vamos a ir obteniendo la información</span></span>
<span id="cb926-55"><a href="#cb926-55" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(num_page_items):</span>
<span id="cb926-56"><a href="#cb926-56" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Obtenemos el puntaje, la fecha, el titulo y la review</span></span>
<span id="cb926-57"><a href="#cb926-57" aria-hidden="true" tabindex="-1"></a>    score_class <span class="op">=</span> reviews[i].find_element_by_xpath(<span class="st">&quot;.//span[contains(@class, &#39;ui_bubble_rating bubble_&#39;)]&quot;</span>).get_attribute(<span class="st">&quot;class&quot;</span>)</span>
<span id="cb926-58"><a href="#cb926-58" aria-hidden="true" tabindex="-1"></a>    score <span class="op">=</span> score_class.split(<span class="st">&quot;_&quot;</span>)[<span class="dv">3</span>]</span>
<span id="cb926-59"><a href="#cb926-59" aria-hidden="true" tabindex="-1"></a>    date <span class="op">=</span> reviews[i].find_element_by_xpath(<span class="st">&quot;.//span[@class=&#39;ratingDate&#39;]&quot;</span>).get_attribute(<span class="st">&quot;title&quot;</span>)</span>
<span id="cb926-60"><a href="#cb926-60" aria-hidden="true" tabindex="-1"></a>    title <span class="op">=</span> reviews[i].find_element_by_xpath(<span class="st">&quot;.//span[@class=&#39;noQuotes&#39;]&quot;</span>).text</span>
<span id="cb926-61"><a href="#cb926-61" aria-hidden="true" tabindex="-1"></a>    review <span class="op">=</span> reviews[i].find_element_by_xpath(<span class="st">&quot;.//p[@class=&#39;partial_entry&#39;]&quot;</span>).text.replace(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="st">&quot;&quot;</span>)</span>
<span id="cb926-62"><a href="#cb926-62" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Escribimos sobre el CSV</span></span>
<span id="cb926-63"><a href="#cb926-63" aria-hidden="true" tabindex="-1"></a>    csvWriter.writerow((score, date, title, review))</span>
<span id="cb926-64"><a href="#cb926-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb926-65"><a href="#cb926-65" aria-hidden="true" tabindex="-1"></a><span class="co"># Cerramos CSV</span></span>
<span id="cb926-66"><a href="#cb926-66" aria-hidden="true" tabindex="-1"></a>csvFile.close()</span>
<span id="cb926-67"><a href="#cb926-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb926-68"><a href="#cb926-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Ahora esperamos unos segundos </span></span>
<span id="cb926-69"><a href="#cb926-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb926-70"><a href="#cb926-70" aria-hidden="true" tabindex="-1"></a><span class="co"># Apretamos la pagina siguiente </span></span>
<span id="cb926-71"><a href="#cb926-71" aria-hidden="true" tabindex="-1"></a>driver.find_element_by_xpath(<span class="st">&quot;/html/body/div[2]/div[2]/div[2]/div[6]/div/div[1]/div[4]/div/div[5]/div/div[18]/div/div/div/a[2]&quot;</span>).click()</span>
<span id="cb926-72"><a href="#cb926-72" aria-hidden="true" tabindex="-1"></a>time.sleep(<span class="dv">3</span>)</span>
<span id="cb926-73"><a href="#cb926-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb926-74"><a href="#cb926-74" aria-hidden="true" tabindex="-1"></a><span class="co"># Repitamos el proceso </span></span>
<span id="cb926-75"><a href="#cb926-75" aria-hidden="true" tabindex="-1"></a>csvFile <span class="op">=</span> <span class="bu">open</span>(<span class="st">&quot;reviews2.csv&quot;</span>, </span>
<span id="cb926-76"><a href="#cb926-76" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;w&quot;</span>, </span>
<span id="cb926-77"><a href="#cb926-77" aria-hidden="true" tabindex="-1"></a>               newline<span class="op">=</span><span class="st">&#39;&#39;</span>, </span>
<span id="cb926-78"><a href="#cb926-78" aria-hidden="true" tabindex="-1"></a>               encoding<span class="op">=</span><span class="st">&quot;utf-8&quot;</span>)</span>
<span id="cb926-79"><a href="#cb926-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb926-80"><a href="#cb926-80" aria-hidden="true" tabindex="-1"></a>csvWriter <span class="op">=</span> csv.writer(csvFile)</span>
<span id="cb926-81"><a href="#cb926-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb926-82"><a href="#cb926-82" aria-hidden="true" tabindex="-1"></a><span class="co"># Vamos a incluir las columnas para las cuales queremos obtener información </span></span>
<span id="cb926-83"><a href="#cb926-83" aria-hidden="true" tabindex="-1"></a>csvWriter.writerow([<span class="st">&#39;Score&#39;</span>,<span class="st">&#39;Date&#39;</span>,<span class="st">&#39;Title&#39;</span>,<span class="st">&#39;Review&#39;</span>])</span>
<span id="cb926-84"><a href="#cb926-84" aria-hidden="true" tabindex="-1"></a>driver.find_element_by_xpath(<span class="st">&#39;//*[@id=&quot;taplc_location_reviews_list_resp_rr_resp_0&quot;]/div/div[17]&#39;</span>).click()</span>
<span id="cb926-85"><a href="#cb926-85" aria-hidden="true" tabindex="-1"></a>time.sleep(<span class="dv">5</span>) <span class="co"># Wait for reviews to load</span></span>
<span id="cb926-86"><a href="#cb926-86" aria-hidden="true" tabindex="-1"></a>reviews <span class="op">=</span> driver.find_elements_by_xpath(<span class="st">&quot;//div[@class=&#39;ui_column is-9&#39;]&quot;</span>)</span>
<span id="cb926-87"><a href="#cb926-87" aria-hidden="true" tabindex="-1"></a>num_page_items <span class="op">=</span> <span class="bu">min</span>(<span class="bu">len</span>(reviews), <span class="dv">10</span>)</span>
<span id="cb926-88"><a href="#cb926-88" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(num_page_items):</span>
<span id="cb926-89"><a href="#cb926-89" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Obtenemos el puntaje, la fecha, el titulo y la review</span></span>
<span id="cb926-90"><a href="#cb926-90" aria-hidden="true" tabindex="-1"></a>    score_class <span class="op">=</span> reviews[i].find_element_by_xpath(<span class="st">&quot;.//span[contains(@class, &#39;ui_bubble_rating bubble_&#39;)]&quot;</span>).get_attribute(<span class="st">&quot;class&quot;</span>)</span>
<span id="cb926-91"><a href="#cb926-91" aria-hidden="true" tabindex="-1"></a>    score <span class="op">=</span> score_class.split(<span class="st">&quot;_&quot;</span>)[<span class="dv">3</span>]</span>
<span id="cb926-92"><a href="#cb926-92" aria-hidden="true" tabindex="-1"></a>    date <span class="op">=</span> reviews[i].find_element_by_xpath(<span class="st">&quot;.//span[@class=&#39;ratingDate&#39;]&quot;</span>).get_attribute(<span class="st">&quot;title&quot;</span>)</span>
<span id="cb926-93"><a href="#cb926-93" aria-hidden="true" tabindex="-1"></a>    title <span class="op">=</span> reviews[i].find_element_by_xpath(<span class="st">&quot;.//span[@class=&#39;noQuotes&#39;]&quot;</span>).text</span>
<span id="cb926-94"><a href="#cb926-94" aria-hidden="true" tabindex="-1"></a>    review <span class="op">=</span> reviews[i].find_element_by_xpath(<span class="st">&quot;.//p[@class=&#39;partial_entry&#39;]&quot;</span>).text.replace(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="st">&quot;&quot;</span>)</span>
<span id="cb926-95"><a href="#cb926-95" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Escribimos sobre el CSV</span></span>
<span id="cb926-96"><a href="#cb926-96" aria-hidden="true" tabindex="-1"></a>    csvWriter.writerow((score, date, title, review))</span>
<span id="cb926-97"><a href="#cb926-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb926-98"><a href="#cb926-98" aria-hidden="true" tabindex="-1"></a><span class="co"># Cerramos CSV</span></span>
<span id="cb926-99"><a href="#cb926-99" aria-hidden="true" tabindex="-1"></a>csvFile.close()</span>
<span id="cb926-100"><a href="#cb926-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb926-101"><a href="#cb926-101" aria-hidden="true" tabindex="-1"></a><span class="co"># Cerramos navegador </span></span>
<span id="cb926-102"><a href="#cb926-102" aria-hidden="true" tabindex="-1"></a>driver.close()</span></code></pre></div>
<ul>
<li>De esta forma podemos ir automatizando el scraping de diversas formas</li>
<li>Para cualquier proceso de obtención de datos que requiera manipulación más complejas: cambio de páginas, ingresar contraseñas, entre otras. Selenium es una buena opción</li>
</ul>
</div>
<div id="ejemplo-2-ingresar-una-contraseña" class="section level4 hasAnchor" number="4.9.3.2">
<h4 class="hasAnchor"><span class="header-section-number">4.9.3.2</span> Ejemplo 2: Ingresar una contraseña<a href="#ejemplo-2-ingresar-una-contraseña" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb927"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb927-1"><a href="#cb927-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb927-2"><a href="#cb927-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> selenium <span class="im">import</span> webdriver</span>
<span id="cb927-3"><a href="#cb927-3" aria-hidden="true" tabindex="-1"></a>driver <span class="op">=</span> webdriver.Chrome()</span>
<span id="cb927-4"><a href="#cb927-4" aria-hidden="true" tabindex="-1"></a>driver.get(<span class="st">&quot;https://mail.rediff.com/cgi-bin/login.cgi&quot;</span>)</span>
<span id="cb927-5"><a href="#cb927-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb927-6"><a href="#cb927-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Identificamos la posición del nombre de usuario, la contrase{a y señalamos que poner</span></span>
<span id="cb927-7"><a href="#cb927-7" aria-hidden="true" tabindex="-1"></a>driver.find_element_by_name(<span class="st">&quot;login&quot;</span>).send_keys(<span class="st">&quot;ncamposb&quot;</span>)</span>
<span id="cb927-8"><a href="#cb927-8" aria-hidden="true" tabindex="-1"></a>time.sleep(<span class="fl">0.2</span>)</span>
<span id="cb927-9"><a href="#cb927-9" aria-hidden="true" tabindex="-1"></a>driver.find_element_by_name(<span class="st">&quot;passwd&quot;</span>).send_keys(<span class="st">&quot;contraeñaultrasecreta23&quot;</span>)</span>
<span id="cb927-10"><a href="#cb927-10" aria-hidden="true" tabindex="-1"></a>time.sleep(<span class="fl">0.4</span>)</span>
<span id="cb927-11"><a href="#cb927-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Le indicamos que aprete sobre sign in </span></span>
<span id="cb927-12"><a href="#cb927-12" aria-hidden="true" tabindex="-1"></a>driver.find_element_by_class_name(<span class="st">&quot;signinbtn&quot;</span>).click()</span>
<span id="cb927-13"><a href="#cb927-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Cerramos el navegador</span></span></code></pre></div>
<!--chapter:end:03-curso3.Rmd-->
</div>
</div>
</div>
</div>
<div id="referencias" class="section level1 hasAnchor" number="5">
<h1 class="hasAnchor"><span class="header-section-number">5</span> Referencias<a href="#referencias" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <a href="http://rmarkdown.rstudio.com" class="uri">http://rmarkdown.rstudio.com</a>.</p>
<p>When you click the <strong>Knit</strong> button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:</p>
<div class="sourceCode" id="cb928"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb928-1"><a href="#cb928-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cars)</span></code></pre></div>
<div id="including-plots" class="section level2 hasAnchor" number="5.1">
<h2 class="hasAnchor"><span class="header-section-number">5.1</span> Including Plots<a href="#including-plots" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>You can also embed plots, for example:</p>
<p>Note that the <code>echo = FALSE</code> parameter was added to the code chunk to prevent printing of the R code that generated the plot.</p>
<!--chapter:end:04-references.Rmd-->
</div>
</div>
<!--bookdown:body:end-->
            </section>

          </div>
        </div>
      </div>
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
    </div>
  </div>
<!--bookdown:config-->

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
