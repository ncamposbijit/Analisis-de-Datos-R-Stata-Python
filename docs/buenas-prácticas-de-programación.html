<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Buenas prácticas de programación | Análisis de Datos con Stata, R y Python</title>
  <meta name="description" content="Libro enfocado en enseñar análisis de datos utilizando Stata, R y Python" />
  <meta name="generator" content="bookdown 0.39.2 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Buenas prácticas de programación | Análisis de Datos con Stata, R y Python" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Libro enfocado en enseñar análisis de datos utilizando Stata, R y Python" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Buenas prácticas de programación | Análisis de Datos con Stata, R y Python" />
  
  <meta name="twitter:description" content="Libro enfocado en enseñar análisis de datos utilizando Stata, R y Python" />
  

<meta name="author" content="Nicolás Campos Bijit" />


<meta name="date" content="2024-06-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="programar-ado---files.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introducción</a></li>
<li class="chapter" data-level="2" data-path="buenas-prácticas-de-programación.html"><a href="buenas-prácticas-de-programación.html"><i class="fa fa-check"></i><b>2</b> Buenas prácticas de programación</a>
<ul>
<li class="chapter" data-level="2.1" data-path="buenas-prácticas-de-programación.html"><a href="buenas-prácticas-de-programación.html#programación-defensiva"><i class="fa fa-check"></i><b>2.1</b> Programación defensiva</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="buenas-prácticas-de-programación.html"><a href="buenas-prácticas-de-programación.html#práctica-i-escribir-una-prueba-o-test"><i class="fa fa-check"></i><b>2.1.1</b> Práctica I: escribir una prueba o test</a></li>
<li class="chapter" data-level="2.1.2" data-path="buenas-prácticas-de-programación.html"><a href="buenas-prácticas-de-programación.html#práctica-ii-no-duplicar-información"><i class="fa fa-check"></i><b>2.1.2</b> Práctica II: no duplicar información</a></li>
<li class="chapter" data-level="2.1.3" data-path="buenas-prácticas-de-programación.html"><a href="buenas-prácticas-de-programación.html#práctica-iv-estilo-importa"><i class="fa fa-check"></i><b>2.1.3</b> Práctica IV: estilo importa</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="buenas-prácticas-de-programación.html"><a href="buenas-prácticas-de-programación.html#estilo-de-codificación-en-stata"><i class="fa fa-check"></i><b>2.2</b> Estilo de codificación en Stata</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="buenas-prácticas-de-programación.html"><a href="buenas-prácticas-de-programación.html#ser-ordenado-no-es-condición-suficiente-para-tener-un-buen-estilo-de-codificación"><i class="fa fa-check"></i><b>2.2.1</b> Ser ordenado no es condición suficiente para tener un buen estilo de codificación</a></li>
<li class="chapter" data-level="2.2.2" data-path="buenas-prácticas-de-programación.html"><a href="buenas-prácticas-de-programación.html#escribe-códigos-cortos"><i class="fa fa-check"></i><b>2.2.2</b> Escribe códigos cortos</a></li>
<li class="chapter" data-level="2.2.3" data-path="buenas-prácticas-de-programación.html"><a href="buenas-prácticas-de-programación.html#el-nombre-de-las-variables-debe-caracterizarla"><i class="fa fa-check"></i><b>2.2.3</b> El nombre de las variables debe caracterizarla</a></li>
<li class="chapter" data-level="2.2.4" data-path="buenas-prácticas-de-programación.html"><a href="buenas-prácticas-de-programación.html#ten-especial-cuidado-cuando-uses-álgebra-en-los-códigos."><i class="fa fa-check"></i><b>2.2.4</b> Ten especial cuidado cuando uses álgebra en los códigos.</a></li>
<li class="chapter" data-level="2.2.5" data-path="buenas-prácticas-de-programación.html"><a href="buenas-prácticas-de-programación.html#ser-consistentes"><i class="fa fa-check"></i><b>2.2.5</b> Ser consistentes</a></li>
<li class="chapter" data-level="2.2.6" data-path="buenas-prácticas-de-programación.html"><a href="buenas-prácticas-de-programación.html#chequear-errores"><i class="fa fa-check"></i><b>2.2.6</b> Chequear errores</a></li>
<li class="chapter" data-level="2.2.7" data-path="buenas-prácticas-de-programación.html"><a href="buenas-prácticas-de-programación.html#separar-tipos-de-códigos"><i class="fa fa-check"></i><b>2.2.7</b> Separar tipos de códigos</a></li>
<li class="chapter" data-level="2.2.8" data-path="buenas-prácticas-de-programación.html"><a href="buenas-prácticas-de-programación.html#automatizar-todo-lo-que-se-pueda-automatizar"><i class="fa fa-check"></i><b>2.2.8</b> Automatizar todo lo que se pueda automatizar</a></li>
<li class="chapter" data-level="2.2.9" data-path="buenas-prácticas-de-programación.html"><a href="buenas-prácticas-de-programación.html#abstraer-para-eliminar-pasos-redundantes."><i class="fa fa-check"></i><b>2.2.9</b> Abstraer para eliminar pasos redundantes.</a></li>
<li class="chapter" data-level="2.2.10" data-path="buenas-prácticas-de-programación.html"><a href="buenas-prácticas-de-programación.html#crear-códigos-autoexplicativos-que-complementen-a-la-documentación"><i class="fa fa-check"></i><b>2.2.10</b> Crear códigos autoexplicativos que complementen a la documentación</a></li>
<li class="chapter" data-level="2.2.11" data-path="buenas-prácticas-de-programación.html"><a href="buenas-prácticas-de-programación.html#no-ser-repetitivo"><i class="fa fa-check"></i><b>2.2.11</b> No ser repetitivo</a></li>
<li class="chapter" data-level="2.2.12" data-path="buenas-prácticas-de-programación.html"><a href="buenas-prácticas-de-programación.html#mensajes-finales-sobre-estilo-de-codificación"><i class="fa fa-check"></i><b>2.2.12</b> Mensajes finales sobre estilo de codificación</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="buenas-prácticas-de-programación.html"><a href="buenas-prácticas-de-programación.html#organización-de-un-proyecto-en-stata"><i class="fa fa-check"></i><b>2.3</b> Organización de un proyecto en Stata</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="buenas-prácticas-de-programación.html"><a href="buenas-prácticas-de-programación.html#flujo-de-trabajo-en-stata"><i class="fa fa-check"></i><b>2.3.1</b> Flujo de trabajo en Stata</a></li>
<li class="chapter" data-level="2.3.2" data-path="buenas-prácticas-de-programación.html"><a href="buenas-prácticas-de-programación.html#organización-de-archivos-y-carpetas"><i class="fa fa-check"></i><b>2.3.2</b> Organización de archivos y carpetas</a></li>
<li class="chapter" data-level="2.3.3" data-path="buenas-prácticas-de-programación.html"><a href="buenas-prácticas-de-programación.html#master-do-files"><i class="fa fa-check"></i><b>2.3.3</b> Master <code>do-files</code></a></li>
<li class="chapter" data-level="2.3.4" data-path="buenas-prácticas-de-programación.html"><a href="buenas-prácticas-de-programación.html#rutas-de-las-carpetas"><i class="fa fa-check"></i><b>2.3.4</b> Rutas de las carpetas:</a></li>
<li class="chapter" data-level="2.3.5" data-path="buenas-prácticas-de-programación.html"><a href="buenas-prácticas-de-programación.html#utilizar-algún-auxiliar-de-generación-de-código-sublime-text"><i class="fa fa-check"></i><b>2.3.5</b> Utilizar algún auxiliar de generación de código: Sublime Text</a></li>
<li class="chapter" data-level="2.3.6" data-path="buenas-prácticas-de-programación.html"><a href="buenas-prácticas-de-programación.html#macros-locales-y-globales"><i class="fa fa-check"></i><b>2.3.6</b> Macros locales y globales</a></li>
<li class="chapter" data-level="2.3.7" data-path="buenas-prácticas-de-programación.html"><a href="buenas-prácticas-de-programación.html#estructuras-de-datos"><i class="fa fa-check"></i><b>2.3.7</b> Estructuras de datos</a></li>
<li class="chapter" data-level="2.3.8" data-path="buenas-prácticas-de-programación.html"><a href="buenas-prácticas-de-programación.html#iteradores"><i class="fa fa-check"></i><b>2.3.8</b> Iteradores</a></li>
<li class="chapter" data-level="2.3.9" data-path="buenas-prácticas-de-programación.html"><a href="buenas-prácticas-de-programación.html#manejo-de-bases-de-datos"><i class="fa fa-check"></i><b>2.3.9</b> Manejo de bases de datos</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="programar-ado---files.html"><a href="programar-ado---files.html"><i class="fa fa-check"></i><b>3</b> Programar ado - files</a>
<ul>
<li class="chapter" data-level="3.0.1" data-path="programar-ado---files.html"><a href="programar-ado---files.html#escribir-programas-en-stata"><i class="fa fa-check"></i><b>3.0.1</b> Escribir programas en Stata</a></li>
<li class="chapter" data-level="3.0.2" data-path="programar-ado---files.html"><a href="programar-ado---files.html#por-qué-escribir-programas-abstracción"><i class="fa fa-check"></i><b>3.0.2</b> ¿Por qué escribir programas?: Abstracción</a></li>
<li class="chapter" data-level="3.0.3" data-path="programar-ado---files.html"><a href="programar-ado---files.html#mis-primeros-programas-en-stata"><i class="fa fa-check"></i><b>3.0.3</b> Mis primeros programas en Stata</a></li>
<li class="chapter" data-level="3.0.4" data-path="programar-ado---files.html"><a href="programar-ado---files.html#programa-con-distintos-argumentos"><i class="fa fa-check"></i><b>3.0.4</b> Programa con distintos argumentos</a></li>
<li class="chapter" data-level="3.0.5" data-path="programar-ado---files.html"><a href="programar-ado---files.html#opción-syntax"><i class="fa fa-check"></i><b>3.0.5</b> Opción Syntax</a></li>
<li class="chapter" data-level="3.0.6" data-path="programar-ado---files.html"><a href="programar-ado---files.html#return"><i class="fa fa-check"></i><b>3.0.6</b> Return</a></li>
<li class="chapter" data-level="3.0.7" data-path="programar-ado---files.html"><a href="programar-ado---files.html#implementar-opciones-al-programa"><i class="fa fa-check"></i><b>3.0.7</b> Implementar opciones al programa</a></li>
<li class="chapter" data-level="3.0.8" data-path="programar-ado---files.html"><a href="programar-ado---files.html#incluir-ifin-al-programa"><i class="fa fa-check"></i><b>3.0.8</b> Incluir if/in al programa</a></li>
<li class="chapter" data-level="3.0.9" data-path="programar-ado---files.html"><a href="programar-ado---files.html#generalizar-el-comando-para-incluir-múltiples-variables"><i class="fa fa-check"></i><b>3.0.9</b> Generalizar el comando para incluir múltiples variables</a></li>
<li class="chapter" data-level="3.0.10" data-path="programar-ado---files.html"><a href="programar-ado---files.html#agregar-prefijos-a-los-programas"><i class="fa fa-check"></i><b>3.0.10</b> Agregar prefijos a los programas</a></li>
<li class="chapter" data-level="3.0.11" data-path="programar-ado---files.html"><a href="programar-ado---files.html#programas-para-complementar-función-egen"><i class="fa fa-check"></i><b>3.0.11</b> Programas para complementar función egen</a></li>
<li class="chapter" data-level="3.0.12" data-path="programar-ado---files.html"><a href="programar-ado---files.html#syntax"><i class="fa fa-check"></i><b>3.0.12</b> Syntax</a></li>
<li class="chapter" data-level="3.0.13" data-path="programar-ado---files.html"><a href="programar-ado---files.html#varlist"><i class="fa fa-check"></i><b>3.0.13</b> Varlist</a></li>
<li class="chapter" data-level="3.0.14" data-path="programar-ado---files.html"><a href="programar-ado---files.html#opciones"><i class="fa fa-check"></i><b>3.0.14</b> Opciones</a></li>
<li class="chapter" data-level="3.0.15" data-path="programar-ado---files.html"><a href="programar-ado---files.html#programa-para-calcular-percentiles"><i class="fa fa-check"></i><b>3.0.15</b> Programa para calcular percentiles</a></li>
<li class="chapter" data-level="3.0.16" data-path="programar-ado---files.html"><a href="programar-ado---files.html#programa-con-opción-return"><i class="fa fa-check"></i><b>3.0.16</b> Programa con opción return</a></li>
<li class="chapter" data-level="3.0.17" data-path="programar-ado---files.html"><a href="programar-ado---files.html#agregar-opciones-al-programa"><i class="fa fa-check"></i><b>3.0.17</b> Agregar opciones al programa</a></li>
<li class="chapter" data-level="3.0.18" data-path="programar-ado---files.html"><a href="programar-ado---files.html#generalizar-el-comando-para-incluir-múltiples-variables-1"><i class="fa fa-check"></i><b>3.0.18</b> Generalizar el comando para incluir múltiples variables</a></li>
<li class="chapter" data-level="3.0.19" data-path="programar-ado---files.html"><a href="programar-ado---files.html#agregar-prefijos-a-los-programas-1"><i class="fa fa-check"></i><b>3.0.19</b> Agregar prefijos a los programas</a></li>
<li class="chapter" data-level="3.0.20" data-path="programar-ado---files.html"><a href="programar-ado---files.html#programas-para-complementar-función-egen-1"><i class="fa fa-check"></i><b>3.0.20</b> Programas para complementar función egen</a></li>
<li class="chapter" data-level="3.0.21" data-path="programar-ado---files.html"><a href="programar-ado---files.html#generalización-de-la-función-egen"><i class="fa fa-check"></i><b>3.0.21</b> Generalización de la función egen</a></li>
<li class="chapter" data-level="3.0.22" data-path="programar-ado---files.html"><a href="programar-ado---files.html#documentar-tu-programa"><i class="fa fa-check"></i><b>3.0.22</b> Documentar tu programa</a></li>
<li class="chapter" data-level="3.0.23" data-path="programar-ado---files.html"><a href="programar-ado---files.html#escribir-programas-e-class"><i class="fa fa-check"></i><b>3.0.23</b> Escribir programas e-class</a></li>
<li class="chapter" data-level="3.0.24" data-path="programar-ado---files.html"><a href="programar-ado---files.html#marksample-mark-y-markout"><i class="fa fa-check"></i><b>3.0.24</b> Marksample, Mark y Markout</a></li>
<li class="chapter" data-level="3.0.25" data-path="programar-ado---files.html"><a href="programar-ado---files.html#sortpreserve"><i class="fa fa-check"></i><b>3.0.25</b> Sortpreserve</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="exportar-información.html"><a href="exportar-información.html"><i class="fa fa-check"></i><b>4</b> Exportar Información</a>
<ul>
<li class="chapter" data-level="4.0.1" data-path="exportar-información.html"><a href="exportar-información.html#stata-markdown"><i class="fa fa-check"></i><b>4.0.1</b> Stata Markdown</a></li>
<li class="chapter" data-level="4.0.2" data-path="exportar-información.html"><a href="exportar-información.html#putdocx"><i class="fa fa-check"></i><b>4.0.2</b> Putdocx</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="manejo-de-grandes-bases-de-datos-en-stata.html"><a href="manejo-de-grandes-bases-de-datos-en-stata.html"><i class="fa fa-check"></i><b>5</b> Manejo de grandes bases de datos en Stata</a>
<ul>
<li class="chapter" data-level="5.0.1" data-path="manejo-de-grandes-bases-de-datos-en-stata.html"><a href="manejo-de-grandes-bases-de-datos-en-stata.html#estilo-de-codificación-mejorar-velocidad-y-eficiencia"><i class="fa fa-check"></i><b>5.0.1</b> Estilo de codificación: mejorar velocidad y eficiencia</a></li>
<li class="chapter" data-level="5.0.2" data-path="manejo-de-grandes-bases-de-datos-en-stata.html"><a href="manejo-de-grandes-bases-de-datos-en-stata.html#cargar-grandes-bases-de-datos"><i class="fa fa-check"></i><b>5.0.2</b> Cargar grandes bases de datos</a></li>
<li class="chapter" data-level="5.0.3" data-path="manejo-de-grandes-bases-de-datos-en-stata.html"><a href="manejo-de-grandes-bases-de-datos-en-stata.html#reducir-el-uso-de-memoria"><i class="fa fa-check"></i><b>5.0.3</b> Reducir el uso de memoria</a></li>
<li class="chapter" data-level="5.0.4" data-path="manejo-de-grandes-bases-de-datos-en-stata.html"><a href="manejo-de-grandes-bases-de-datos-en-stata.html#reducir-el-tamaño-de-la-base-de-datos"><i class="fa fa-check"></i><b>5.0.4</b> Reducir el tamaño de la base de datos</a></li>
<li class="chapter" data-level="5.0.5" data-path="manejo-de-grandes-bases-de-datos-en-stata.html"><a href="manejo-de-grandes-bases-de-datos-en-stata.html#eliminar-siempre-resultados-intermedios-incluso-temporales"><i class="fa fa-check"></i><b>5.0.5</b> Eliminar siempre resultados intermedios, incluso temporales</a></li>
<li class="chapter" data-level="5.0.6" data-path="manejo-de-grandes-bases-de-datos-en-stata.html"><a href="manejo-de-grandes-bases-de-datos-en-stata.html#dividir-en-trozos-cuando-sea-posible"><i class="fa fa-check"></i><b>5.0.6</b> Dividir en trozos cuando sea posible</a></li>
<li class="chapter" data-level="5.0.7" data-path="manejo-de-grandes-bases-de-datos-en-stata.html"><a href="manejo-de-grandes-bases-de-datos-en-stata.html#sort"><i class="fa fa-check"></i><b>5.0.7</b> Sort</a></li>
<li class="chapter" data-level="5.0.8" data-path="manejo-de-grandes-bases-de-datos-en-stata.html"><a href="manejo-de-grandes-bases-de-datos-en-stata.html#selección-de-muestra"><i class="fa fa-check"></i><b>5.0.8</b> Selección de muestra</a></li>
<li class="chapter" data-level="5.0.9" data-path="manejo-de-grandes-bases-de-datos-en-stata.html"><a href="manejo-de-grandes-bases-de-datos-en-stata.html#precaución-con-reshape"><i class="fa fa-check"></i><b>5.0.9</b> Precaución con reshape</a></li>
<li class="chapter" data-level="5.0.10" data-path="manejo-de-grandes-bases-de-datos-en-stata.html"><a href="manejo-de-grandes-bases-de-datos-en-stata.html#subexpresiones-comunes"><i class="fa fa-check"></i><b>5.0.10</b> Subexpresiones comunes</a></li>
<li class="chapter" data-level="5.0.11" data-path="manejo-de-grandes-bases-de-datos-en-stata.html"><a href="manejo-de-grandes-bases-de-datos-en-stata.html#recomendaciones-adicionales"><i class="fa fa-check"></i><b>5.0.11</b> Recomendaciones Adicionales</a></li>
<li class="chapter" data-level="5.0.12" data-path="manejo-de-grandes-bases-de-datos-en-stata.html"><a href="manejo-de-grandes-bases-de-datos-en-stata.html#resumen"><i class="fa fa-check"></i><b>5.0.12</b> Resumen</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="mata.html"><a href="mata.html"><i class="fa fa-check"></i><b>6</b> Mata</a>
<ul>
<li class="chapter" data-level="6.1" data-path="mata.html"><a href="mata.html#qué-es-mata"><i class="fa fa-check"></i><b>6.1</b> ¿Qué es Mata?</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html"><i class="fa fa-check"></i><b>7</b> Análisis de Datos con Python</a>
<ul>
<li class="chapter" data-level="7.1" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#introducción-al-análisis-de-datos-con-python"><i class="fa fa-check"></i><b>7.1</b> Introducción al análisis de datos con Python</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#antes-de-partir-con-python"><i class="fa fa-check"></i><b>7.1.1</b> Antes de partir con Python…</a></li>
<li class="chapter" data-level="7.1.2" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#atajos"><i class="fa fa-check"></i><b>7.1.2</b> Atajos</a></li>
<li class="chapter" data-level="7.1.3" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#extensiones-de-jupyter-notebook"><i class="fa fa-check"></i><b>7.1.3</b> Extensiones de Jupyter Notebook</a></li>
<li class="chapter" data-level="7.1.4" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#sintaxis-básica"><i class="fa fa-check"></i><b>7.1.4</b> Sintaxis básica</a></li>
<li class="chapter" data-level="7.1.5" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#variables-y-objetos"><i class="fa fa-check"></i><b>7.1.5</b> Variables y objetos</a></li>
<li class="chapter" data-level="7.1.6" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#operadores"><i class="fa fa-check"></i><b>7.1.6</b> Operadores</a></li>
<li class="chapter" data-level="7.1.7" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#estructuras-de-datos-listas-tuplas-conjuntos-diccionarios"><i class="fa fa-check"></i><b>7.1.7</b> Estructuras de datos: listas, tuplas, conjuntos, diccionarios</a></li>
<li class="chapter" data-level="7.1.8" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#funciones-1"><i class="fa fa-check"></i><b>7.1.8</b> Funciones</a></li>
<li class="chapter" data-level="7.1.9" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#methods"><i class="fa fa-check"></i><b>7.1.9</b> Methods</a></li>
<li class="chapter" data-level="7.1.10" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#paquetes"><i class="fa fa-check"></i><b>7.1.10</b> Paquetes</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#librerias-principales-de-python---numpy-matplotlib-pandas"><i class="fa fa-check"></i><b>7.2</b> Librerías principales de Python - Numpy, Matplotlib, Pandas</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#numpy"><i class="fa fa-check"></i><b>7.2.1</b> NumPy</a></li>
<li class="chapter" data-level="7.2.2" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#matplotlib"><i class="fa fa-check"></i><b>7.2.2</b> Matplotlib</a></li>
<li class="chapter" data-level="7.2.3" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#pandas"><i class="fa fa-check"></i><b>7.2.3</b> Pandas</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#herramientas-de-programación"><i class="fa fa-check"></i><b>7.3</b> Herramientas de programación</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#controladores-de-flujo"><i class="fa fa-check"></i><b>7.3.1</b> Controladores de flujo</a></li>
<li class="chapter" data-level="7.3.2" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#if-elif-else"><i class="fa fa-check"></i><b>7.3.2</b> if-elif-else</a></li>
<li class="chapter" data-level="7.3.3" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#iteradores-básicos"><i class="fa fa-check"></i><b>7.3.3</b> Iteradores básicos</a></li>
<li class="chapter" data-level="7.3.4" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#iteradores-adicionales-en-python"><i class="fa fa-check"></i><b>7.3.4</b> Iteradores adicionales en Python</a></li>
<li class="chapter" data-level="7.3.5" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#list-comprehension"><i class="fa fa-check"></i><b>7.3.5</b> List Comprehension</a></li>
<li class="chapter" data-level="7.3.6" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#generadores"><i class="fa fa-check"></i><b>7.3.6</b> Generadores</a></li>
<li class="chapter" data-level="7.3.7" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#funciones-2"><i class="fa fa-check"></i><b>7.3.7</b> Funciones</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#manipulación-de-bases-de-datos-parte-i"><i class="fa fa-check"></i><b>7.4</b> Manipulación de bases de datos (Parte I)</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#importar-e-inspeccionar-datos-repaso"><i class="fa fa-check"></i><b>7.4.1</b> Importar e inspeccionar datos (repaso)</a></li>
<li class="chapter" data-level="7.4.2" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#manipular-repaso"><i class="fa fa-check"></i><b>7.4.2</b> Manipular (repaso)</a></li>
<li class="chapter" data-level="7.4.3" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#agrupar-calculos"><i class="fa fa-check"></i><b>7.4.3</b> Agrupar calculos</a></li>
<li class="chapter" data-level="7.4.4" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#aplicar-funciones"><i class="fa fa-check"></i><b>7.4.4</b> Aplicar funciones</a></li>
<li class="chapter" data-level="7.4.5" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#datos-como-tablas-problemas-y-soluciones"><i class="fa fa-check"></i><b>7.4.5</b> Datos como tablas: problemas y soluciones</a></li>
<li class="chapter" data-level="7.4.6" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#concatenar-data-frames"><i class="fa fa-check"></i><b>7.4.6</b> Concatenar data frames</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#manipulación-de-bases-de-datos-parte-ii"><i class="fa fa-check"></i><b>7.5</b> Manipulación de bases de datos (Parte II)</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#aplicar-funciones-a-columnas-de-una-base-de-datos"><i class="fa fa-check"></i><b>7.5.1</b> Aplicar funciones a columnas de una base de datos</a></li>
<li class="chapter" data-level="7.5.2" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#dividir-una-base-de-datos-por-grupos"><i class="fa fa-check"></i><b>7.5.2</b> Dividir una base de datos por grupos</a></li>
<li class="chapter" data-level="7.5.3" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#librería-datetime"><i class="fa fa-check"></i><b>7.5.3</b> Librería datetime</a></li>
<li class="chapter" data-level="7.5.4" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#reestructurar-un-dataframe"><i class="fa fa-check"></i><b>7.5.4</b> Reestructurar un DataFrame</a></li>
<li class="chapter" data-level="7.5.5" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#reestructurar-datos-para-arreglar-posibles-problemas"><i class="fa fa-check"></i><b>7.5.5</b> Reestructurar datos para arreglar posibles problemas</a></li>
<li class="chapter" data-level="7.5.6" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#missing-values-1"><i class="fa fa-check"></i><b>7.5.6</b> Missing values</a></li>
<li class="chapter" data-level="7.5.7" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#juntar-bases-de-datos-merge-y-append"><i class="fa fa-check"></i><b>7.5.7</b> Juntar bases de datos: merge y append</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#análisis-de-datos-parte-i"><i class="fa fa-check"></i><b>7.6</b> Análisis de datos (Parte I)</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#estadistica-descriptiva"><i class="fa fa-check"></i><b>7.6.1</b> Estadistica Descriptiva</a></li>
<li class="chapter" data-level="7.6.2" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#la-distribución-normal"><i class="fa fa-check"></i><b>7.6.2</b> La distribución normal</a></li>
<li class="chapter" data-level="7.6.3" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#test-de-hipotesis"><i class="fa fa-check"></i><b>7.6.3</b> Test de hipotesis</a></li>
<li class="chapter" data-level="7.6.4" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#ejemplo-1-resumen-exploratorio-de-datos"><i class="fa fa-check"></i><b>7.6.4</b> Ejemplo 1: resumen exploratorio de datos</a></li>
<li class="chapter" data-level="7.6.5" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#ejemplo-2-datos-con-precios-de-casas"><i class="fa fa-check"></i><b>7.6.5</b> Ejemplo 2: datos con precios de casas</a></li>
<li class="chapter" data-level="7.6.6" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#ejemplo-3"><i class="fa fa-check"></i><b>7.6.6</b> Ejemplo 3</a></li>
<li class="chapter" data-level="7.6.7" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#ejemplo-4"><i class="fa fa-check"></i><b>7.6.7</b> Ejemplo 4</a></li>
<li class="chapter" data-level="7.6.8" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#ejemplo-5-desigualdad-de-ingreso-usando-gapminder"><i class="fa fa-check"></i><b>7.6.8</b> Ejemplo 5 : Desigualdad de ingreso usando Gapminder</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#análisis-de-datos-parte-ii"><i class="fa fa-check"></i><b>7.7</b> Análisis de datos (Parte II)</a>
<ul>
<li class="chapter" data-level="7.7.1" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#optimización-con-scipy"><i class="fa fa-check"></i><b>7.7.1</b> Optimización con Scipy</a></li>
<li class="chapter" data-level="7.7.2" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#modelo-de-regresión-lineal"><i class="fa fa-check"></i><b>7.7.2</b> Modelo de regresión lineal</a></li>
<li class="chapter" data-level="7.7.3" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#una-simulación-de-montecarlo"><i class="fa fa-check"></i><b>7.7.3</b> Una simulación de montecarlo</a></li>
<li class="chapter" data-level="7.7.4" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#bootstraping"><i class="fa fa-check"></i><b>7.7.4</b> Bootstraping</a></li>
<li class="chapter" data-level="7.7.5" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#regresión-logistica"><i class="fa fa-check"></i><b>7.7.5</b> Regresión Logistica</a></li>
<li class="chapter" data-level="7.7.6" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#matching"><i class="fa fa-check"></i><b>7.7.6</b> Matching</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#análisis-de-datos-parte-iii"><i class="fa fa-check"></i><b>7.8</b> Análisis de Datos (Parte III)</a>
<ul>
<li class="chapter" data-level="7.8.1" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#bootstraping-en-el-contexto-de-mco"><i class="fa fa-check"></i><b>7.8.1</b> Bootstraping en el contexto de MCO</a></li>
<li class="chapter" data-level="7.8.2" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#logit-probabilidad-de-sobrevivir-al-hundimiento-del-titanic"><i class="fa fa-check"></i><b>7.8.2</b> Logit: Probabilidad de sobrevivir al hundimiento del Titanic</a></li>
<li class="chapter" data-level="7.8.3" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#gmm"><i class="fa fa-check"></i><b>7.8.3</b> GMM</a></li>
<li class="chapter" data-level="7.8.4" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#diferencias-en-diferencias"><i class="fa fa-check"></i><b>7.8.4</b> Diferencias en Diferencias</a></li>
<li class="chapter" data-level="7.8.5" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#plotly"><i class="fa fa-check"></i><b>7.8.5</b> Plotly</a></li>
<li class="chapter" data-level="7.8.6" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#automatización"><i class="fa fa-check"></i><b>7.8.6</b> Automatización</a></li>
</ul></li>
<li class="chapter" data-level="7.9" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#web-scraping-en-python"><i class="fa fa-check"></i><b>7.9</b> Web Scraping en Python</a>
<ul>
<li class="chapter" data-level="7.9.1" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#introducción-3"><i class="fa fa-check"></i><b>7.9.1</b> Introducción</a></li>
<li class="chapter" data-level="7.9.2" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#muchos-ejemplos-practicos-de-web---scraping"><i class="fa fa-check"></i><b>7.9.2</b> Muchos ejemplos practicos de Web - scraping</a></li>
<li class="chapter" data-level="7.9.3" data-path="análisis-de-datos-con-python.html"><a href="análisis-de-datos-con-python.html#selenium"><i class="fa fa-check"></i><b>7.9.3</b> Selenium</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="análisis-de-datos-con-r.html"><a href="análisis-de-datos-con-r.html"><i class="fa fa-check"></i><b>8</b> Análisis de datos con R</a>
<ul>
<li class="chapter" data-level="8.1" data-path="análisis-de-datos-con-r.html"><a href="análisis-de-datos-con-r.html#introducción-a-r-y-rstudio"><i class="fa fa-check"></i><b>8.1</b> Introducción a R y RStudio</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="análisis-de-datos-con-r.html"><a href="análisis-de-datos-con-r.html#por-qué-utilizar-r-como-lenguaje-de-programación"><i class="fa fa-check"></i><b>8.1.1</b> ¿Por qué utilizar R como lenguaje de programación?</a></li>
<li class="chapter" data-level="8.1.2" data-path="análisis-de-datos-con-r.html"><a href="análisis-de-datos-con-r.html#términos-clave-y-recurrentes-a-lo-largo-del-curso"><i class="fa fa-check"></i><b>8.1.2</b> Términos clave y recurrentes a lo largo del curso</a></li>
<li class="chapter" data-level="8.1.3" data-path="análisis-de-datos-con-r.html"><a href="análisis-de-datos-con-r.html#recursos-de-aprendizaje"><i class="fa fa-check"></i><b>8.1.3</b> Recursos de Aprendizaje</a></li>
<li class="chapter" data-level="8.1.4" data-path="análisis-de-datos-con-r.html"><a href="análisis-de-datos-con-r.html#interfaz-rstudio"><i class="fa fa-check"></i><b>8.1.4</b> Interfaz RStudio</a></li>
<li class="chapter" data-level="8.1.5" data-path="análisis-de-datos-con-r.html"><a href="análisis-de-datos-con-r.html#instalación-de-paquetes-y-ayuda"><i class="fa fa-check"></i><b>8.1.5</b> Instalación de paquetes y ayuda</a></li>
<li class="chapter" data-level="8.1.6" data-path="análisis-de-datos-con-r.html"><a href="análisis-de-datos-con-r.html#manipulación-de-objetos"><i class="fa fa-check"></i><b>8.1.6</b> Manipulación de objetos</a></li>
<li class="chapter" data-level="8.1.7" data-path="análisis-de-datos-con-r.html"><a href="análisis-de-datos-con-r.html#tipos-de-objetos"><i class="fa fa-check"></i><b>8.1.7</b> Tipos de objetos</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="análisis-de-datos-con-r.html"><a href="análisis-de-datos-con-r.html#herramientas-de-programación-1"><i class="fa fa-check"></i><b>8.2</b> Herramientas de programación</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="análisis-de-datos-con-r.html"><a href="análisis-de-datos-con-r.html#objetos-adicionales"><i class="fa fa-check"></i><b>8.2.1</b> Objetos adicionales</a></li>
<li class="chapter" data-level="8.2.2" data-path="análisis-de-datos-con-r.html"><a href="análisis-de-datos-con-r.html#acceder-a-elementos-de-un-objeto"><i class="fa fa-check"></i><b>8.2.2</b> Acceder a elementos de un objeto</a></li>
<li class="chapter" data-level="8.2.3" data-path="análisis-de-datos-con-r.html"><a href="análisis-de-datos-con-r.html#tipos-de-objetos-y-datos"><i class="fa fa-check"></i><b>8.2.3</b> Tipos de objetos y datos</a></li>
<li class="chapter" data-level="8.2.4" data-path="análisis-de-datos-con-r.html"><a href="análisis-de-datos-con-r.html#herramientas-en-r"><i class="fa fa-check"></i><b>8.2.4</b> Herramientas en R</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="análisis-de-datos-con-r.html"><a href="análisis-de-datos-con-r.html#manipulación-de-bases-de-datos-parte-i-1"><i class="fa fa-check"></i><b>8.3</b> Manipulación de bases de datos (Parte I)</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="análisis-de-datos-con-r.html"><a href="análisis-de-datos-con-r.html#principios-de-programación"><i class="fa fa-check"></i><b>8.3.1</b> Principios de programación</a></li>
<li class="chapter" data-level="8.3.2" data-path="análisis-de-datos-con-r.html"><a href="análisis-de-datos-con-r.html#manipulacion-de-bases-de-datos-en-r"><i class="fa fa-check"></i><b>8.3.2</b> Manipulacion de bases de datos en R</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="análisis-de-datos-con-r.html"><a href="análisis-de-datos-con-r.html#manipulación-de-bases-de-datos-parte-ii-1"><i class="fa fa-check"></i><b>8.4</b> Manipulación de bases de datos (Parte II)</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="análisis-de-datos-con-r.html"><a href="análisis-de-datos-con-r.html#funciones-clave"><i class="fa fa-check"></i><b>8.4.1</b> Funciones clave</a></li>
<li class="chapter" data-level="8.4.2" data-path="análisis-de-datos-con-r.html"><a href="análisis-de-datos-con-r.html#operador-piping"><i class="fa fa-check"></i><b>8.4.2</b> Operador piping</a></li>
<li class="chapter" data-level="8.4.3" data-path="análisis-de-datos-con-r.html"><a href="análisis-de-datos-con-r.html#proceso-de-análisis-de-datos-parte-i-cargar-inspeccionar-y-limpiar"><i class="fa fa-check"></i><b>8.4.3</b> Proceso de análisis de datos (Parte I): cargar, inspeccionar y limpiar</a></li>
<li class="chapter" data-level="8.4.4" data-path="análisis-de-datos-con-r.html"><a href="análisis-de-datos-con-r.html#proceso-de-análisis-de-datos-parte-ii-cargar-inspeccionar-y-limpiar"><i class="fa fa-check"></i><b>8.4.4</b> Proceso de análisis de datos (Parte II): cargar, inspeccionar y limpiar</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="análisis-de-datos-con-r.html"><a href="análisis-de-datos-con-r.html#manipulación-de-bases-de-datos-parte-iii"><i class="fa fa-check"></i><b>8.5</b> Manipulación de bases de datos (Parte III)</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="análisis-de-datos-con-r.html"><a href="análisis-de-datos-con-r.html#crear-variables"><i class="fa fa-check"></i><b>8.5.1</b> Crear Variables</a></li>
<li class="chapter" data-level="8.5.2" data-path="análisis-de-datos-con-r.html"><a href="análisis-de-datos-con-r.html#factores"><i class="fa fa-check"></i><b>8.5.2</b> Factores</a></li>
<li class="chapter" data-level="8.5.3" data-path="análisis-de-datos-con-r.html"><a href="análisis-de-datos-con-r.html#funciones-útiles-para-transformar-bases-de-datos"><i class="fa fa-check"></i><b>8.5.3</b> Funciones útiles para transformar bases de datos</a></li>
<li class="chapter" data-level="8.5.4" data-path="análisis-de-datos-con-r.html"><a href="análisis-de-datos-con-r.html#cambio-de-formato-de-los-datos"><i class="fa fa-check"></i><b>8.5.4</b> Cambio de formato de los datos</a></li>
<li class="chapter" data-level="8.5.5" data-path="análisis-de-datos-con-r.html"><a href="análisis-de-datos-con-r.html#juntar-bases-de-datos"><i class="fa fa-check"></i><b>8.5.5</b> Juntar bases de datos</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="análisis-de-datos-con-r.html"><a href="análisis-de-datos-con-r.html#análisis-de-datos"><i class="fa fa-check"></i><b>8.6</b> Análisis de datos</a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="análisis-de-datos-con-r.html"><a href="análisis-de-datos-con-r.html#inspección-de-datos"><i class="fa fa-check"></i><b>8.6.1</b> Inspección de datos</a></li>
<li class="chapter" data-level="8.6.2" data-path="análisis-de-datos-con-r.html"><a href="análisis-de-datos-con-r.html#estadística-descriptiva"><i class="fa fa-check"></i><b>8.6.2</b> Estadística descriptiva</a></li>
<li class="chapter" data-level="8.6.3" data-path="análisis-de-datos-con-r.html"><a href="análisis-de-datos-con-r.html#tablas-de-frecuencia"><i class="fa fa-check"></i><b>8.6.3</b> Tablas de frecuencia</a></li>
<li class="chapter" data-level="8.6.4" data-path="análisis-de-datos-con-r.html"><a href="análisis-de-datos-con-r.html#estadística-descriptiva-con-dplyr"><i class="fa fa-check"></i><b>8.6.4</b> Estadística descriptiva con “dplyr”</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="análisis-de-datos-con-r.html"><a href="análisis-de-datos-con-r.html#visualización"><i class="fa fa-check"></i><b>8.7</b> Visualización</a>
<ul>
<li class="chapter" data-level="8.7.1" data-path="análisis-de-datos-con-r.html"><a href="análisis-de-datos-con-r.html#visualización-r-base"><i class="fa fa-check"></i><b>8.7.1</b> Visualización: R base</a></li>
<li class="chapter" data-level="8.7.2" data-path="análisis-de-datos-con-r.html"><a href="análisis-de-datos-con-r.html#uso-paquete-ggplot"><i class="fa fa-check"></i><b>8.7.2</b> Uso paquete ggplot</a></li>
</ul></li>
<li class="chapter" data-level="8.8" data-path="análisis-de-datos-con-r.html"><a href="análisis-de-datos-con-r.html#análisis-de-datos-y-generación-de-informes-con-r-markdown"><i class="fa fa-check"></i><b>8.8</b> Análisis de datos y generación de informes con R Markdown</a>
<ul>
<li class="chapter" data-level="8.8.1" data-path="análisis-de-datos-con-r.html"><a href="análisis-de-datos-con-r.html#test-de-hipótesis"><i class="fa fa-check"></i><b>8.8.1</b> Test de hipótesis</a></li>
<li class="chapter" data-level="8.8.2" data-path="análisis-de-datos-con-r.html"><a href="análisis-de-datos-con-r.html#regresión-lineal-en-r"><i class="fa fa-check"></i><b>8.8.2</b> Regresión Lineal en R</a></li>
<li class="chapter" data-level="8.8.3" data-path="análisis-de-datos-con-r.html"><a href="análisis-de-datos-con-r.html#r-markdown"><i class="fa fa-check"></i><b>8.8.3</b> R Markdown</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Análisis de Datos con Stata, R y Python</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="buenas-prácticas-de-programación" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">2</span> Buenas prácticas de programación<a href="buenas-prácticas-de-programación.html#buenas-prácticas-de-programación" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="programación-defensiva" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Programación defensiva<a href="buenas-prácticas-de-programación.html#programación-defensiva" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>Las personas somos malas escribiendo códigos</strong></p>
<p>Esta sección está basada en los trabajos y recursos publicados por <a href="https://www.nickeubank.com/">Nick Eubank</a>.</p>
<ul>
<li>La filosofía de escribir un código está motivada por el hecho de que las personas somos <strong>malas escribiendo códigos</strong>.</li>
<li>Si queremos evitar errores <strong>no es suficiente con ser cuidadoso(a)</strong></li>
<li>Es necesario diseñar estrategias que tomen en cuenta el hecho de que vamos a cometer errores al escribir un código.</li>
<li>Tener buenas estrategias es más relevante cuando existe trabajo colaborativo, que puede <strong>amplificar los errores</strong>.</li>
</ul>
<p>En esta sección revisaremos cuatro <strong>buenas prácticas</strong> de programación. Estas prácticas no son solo aplicables a Stata, más bien son guías generales para escribir códigos en cualquier lenguaje de programación.</p>
<ol style="list-style-type: decimal">
<li>Usar pruebas o tests.</li>
<li>No duplicar información.</li>
<li>No transcribir información, siempre exportarla.</li>
<li>Usar un estilo correcto.</li>
</ol>
<p><u>Con estos elementos podremos:</u></p>
<ul>
<li><strong>Minimizar</strong> las oportunidades de generar errores al codificar.</li>
<li><strong>Maximizar</strong> la probabilidad de que cuando se cometa un error (lo que ocurrirá!) se pueda detectar con mayor facilidad.</li>
</ul>
<p><u>¿Necesito entender estos principios?</u></p>
<p><span class="citation">Chang and Li (<a href="#ref-chang2015economics" role="doc-biblioref">2015</a>)</span> testearon la reproducibilidad de 67 artículos <strong>publicados</strong>. Todos con alguna sección empírica. Encuentran que:</p>
<ul>
<li>Solo 29 artículos fueron totalmente replicables.</li>
<li>29 artículos tenían problemas al tratar <em>missing values</em>.</li>
<li>9 poseen datos incorrectos o errores de codificación.</li>
</ul>
<p><span class="citation">Christensen and Miguel (<a href="#ref-christensen2018transparency" role="doc-biblioref">2018</a>)</span> indican que <span class="citation">Chang and Li (<a href="#ref-chang2015economics" role="doc-biblioref">2015</a>)</span> utilizan una versión poco estricta de replicabilidad.</p>
<div class="alert alert-block alert-info">
<b></b> (…) Chang and Li (2015) use a qualitative definition of replication, and test only key results of the paper, and this appears to lead to a fairly generous interpretation of replicability. (…)
</div>
<div class="alert alert-block alert-info">
<b></b> (…) To our minds, this is evidence that even when data are available (which they sometimes are not) <strong>a non-negligible fraction of empirical economics research cannot be reproduced</strong>, even when using the original data and a relatively non-stringent conceptual understanding of what constitutes replication success.
</div>
<p><u>¿Qué podemos aprender de esta historia?</u></p>
<ul>
<li>Todos y todas tienen problemas para codificar (pasa hasta en las mejores familias).</li>
<li>Hoy el <strong>trabajo es colaborativo</strong>. También tienes que confiar en los demás.</li>
<li>Hay cosas que no se pueden resolver con ser cuidadoso(a) al codificar. ¿Si los datos están mal?</li>
<li>Reproducibilidad y replicabilidad son claves. Buenas referencias sobre estos temas se encuentran en la página de <a href="https://jschultecloos.github.io/">Julia Schulte-Cloos</a>.</li>
</ul>
<div id="práctica-i-escribir-una-prueba-o-test" class="section level3 hasAnchor" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> Práctica I: escribir una prueba o test<a href="buenas-prácticas-de-programación.html#práctica-i-escribir-una-prueba-o-test" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><u>¿Qué significa escribir una prueba o test?</u></p>
<p><a href="https://www.nickeubank.com/">Nick Eubank</a> indica que si él tuviese que elegir solo una práctica, elegiría agregar pruebas o tests a los códigos.</p>
<p><u>¿Qué es una prueba?</u></p>
<ul>
<li>Son afirmaciones que tienen como respuesta un valor lógico (verdadero o falso).</li>
<li>Buscan chequear si una condición particular es cierta. En el caso de que no lo sea, es decir de que no se cumpla esta condición, la ejecución del código se detiene.</li>
</ul>
<p><u>¿Por qué agregar estos chequeos, si yo siempre chequeo o reviso mis códigos? </u></p>
<p><u>1. Test se ejecutan <strong>cada vez</strong> que corres tu código</u></p>
<ul>
<li>La mayoría testea la <strong>primera</strong> vez que escribe un código.</li>
<li>Si hay algún apuro por terminar, el testeo del código disminuye rápidamente.</li>
<li>Si ya ha pasado algún tiempo desde la última vez que lo ejecuté, únicamente ejecuto el código y espero los resultados. Entender un código (incluso el que uno(a) mismo(a) escribió es difícil después de un tiempo).</li>
<li>Un error que se comete en una de las múltiples ediciones del código pueda ser detectado con facilidad al testear.</li>
</ul>
<p><u>2. Genera el hábito de chequear permanentemente a un <strong>costo razonable</strong></u></p>
<ul>
<li>La mayoría se para a chequear los datos cuando detecta algún error o bien sospecha que existe un problema.</li>
<li>Si nos acostumbramos a escribir pruebas al final de los códigos o bien cada vez que se hagan cierto tipo de operaciones (ej. siempre después de unir bases de datos), iremos generando el hábito de chequear constantemente, pero sin invertir demasiado tiempo en revisiones posteriores.</li>
</ul>
<p><u>3. Ayuda a <strong>detectar</strong> problemas rápidamente</u></p>
<ul>
<li>Sé donde está el error. Puedo corregirlo rápidamente.</li>
</ul>
<p><u>4. Escribir pruebas ayuda a detectar más problemas de los <strong>previstos</strong></u></p>
<ul>
<li>Los errores de un código se manifiestan de múltiples formas y muchas veces son consecuencia de errores anteriores.</li>
<li>Si tengo valores duplicados, mi estadística descriptiva estará mal.</li>
<li>El problema surge de no darle un tratamiento correcto a los valores duplicados. No surge de algún problema en el código que genera la estadística descriptiva.</li>
</ul>
<div id="el-comando-assert" class="section level4 hasAnchor" number="2.1.1.1">
<h4><span class="header-section-number">2.1.1.1</span> El comando <code>|assert|</code><a href="buenas-prácticas-de-programación.html#el-comando-assert" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>Ejemplo:</strong> Para escribir pruebas en Stata utilizaremos el comando <code>|assert|</code>. Notar que este comando detiene la ejecución del código cuando <strong>la condición no se cumple</strong>.</p>
<p>Testear si la base de datos tiene 100 observaciones:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb1-1"><a href="buenas-prácticas-de-programación.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span> </span>
<span id="cb1-2"><a href="buenas-prácticas-de-programación.html#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">assert</span> <span class="ot">`r(N)&#39;</span> == 100</span></code></pre></div>
<p>Testear si la variable <code>tasa_desempleo</code> está en su rango:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb2-1"><a href="buenas-prácticas-de-programación.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">assert</span> tasa_desempleo &gt; 0 &amp; tasa_desempleo &lt; 100</span></code></pre></div>
<p>Testear si la variable <code>edad</code> es siempre positiva:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb3-1"><a href="buenas-prácticas-de-programación.html#cb3-1" aria-hidden="true" tabindex="-1"></a>edad &gt; 0</span></code></pre></div>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio:</b></p>
<p>Instrucciones:</p>
<ul>
<li>Descargar los <a href="https://github.com/ncamposbijit/Analisis-de-Datos-Stata-R-Python/blob/c6b19e61b6c657d3354c31650781ef708ab5074f/docs/ejercicios/ejercicio1/ejercicio1.zip">datos</a></li>
</ul>
<p>Preguntas:</p>
<ol style="list-style-type: decimal">
<li>La base de datos <em>World Development Indicator (WDI)</em> tiene observaciones duplicadas. <strong>Escriba un test que falle cuando existen valores duplicados</strong>.</li>
<li>Los países en la base de datos <code>Polity</code> deberían ser un subconjunto de los países que están en la base WDI. <strong>Escriba un test que falle debido a este problema</strong>.</li>
</ol>
<ul>
<li>Las soluciones de todos los ejercicios se encuentran <a href="https://github.com/ncamposbijit/Analisis-de-Datos-Stata-R-Python/blob/e44fa03b99ddf308e025a28f16f55953e25795f2/docs/ejercicios/soluciones.do">aquí</a></li>
</ul>
</div>
<p>¿Cuando escribir tests?</p>
<ul>
<li>Después de juntar bases: <strong>Siempre</strong> incluir test después de utilizar un <code>merge</code> o bien de <code>append</code>.</li>
<li>Después de manipulaciones complejas de datos: Si piensas que fue difícil hacer un proceso, incluye un test.</li>
<li>Después de eliminar observaciones: <strong>Siempre</strong> incluir test después de utilizar un <code>drop</code>.</li>
</ul>
<div class="alert alert-block alert-info">
<p><b>Regla general</b> siempre que te veas a ti misma(o) revisando o chequeando algún segmento de código interactivamente <strong>escribe un test</strong>.</p>
</div>
</div>
</div>
<div id="práctica-ii-no-duplicar-información" class="section level3 hasAnchor" number="2.1.2">
<h3><span class="header-section-number">2.1.2</span> Práctica II: no duplicar información<a href="buenas-prácticas-de-programación.html#práctica-ii-no-duplicar-información" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Información debe estar expresada una sola vez en un código.</li>
<li>Si la información está en muchas partes en el código, tendrás que buscar todos esos lugares.</li>
</ul>
<p><em>Ejemplo:</em> Imaginemos que quiero eliminar todas las observaciones que toman un valor mayor a un cierto límite, 110 en este caso.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb4-1"><a href="buenas-prácticas-de-programación.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> <span class="kw">if</span> var1 &gt; 110 </span>
<span id="cb4-2"><a href="buenas-prácticas-de-programación.html#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> <span class="kw">if</span> var2 &gt; 110 </span>
<span id="cb4-3"><a href="buenas-prácticas-de-programación.html#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> <span class="kw">if</span> var3 &gt; 110 </span></code></pre></div>
<p>Lo anterior funciona… <u>¿Cuál es el problema entonces?</u></p>
<ul>
<li>Imaginemos que queremos cambiar el límite de 110 a 100. Del modo en que está escrito, vamos a tener que hacer cambios <strong>3 veces!</strong></li>
<li>Si estas restricciones se encuentran en distintas partes de tú código, se puede inducir un error.</li>
</ul>
<p><strong>Ejemplo:</strong> Para evitar el problema anterior, es mejor escribir:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb5-1"><a href="buenas-prácticas-de-programación.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> lim = 110 </span>
<span id="cb5-2"><a href="buenas-prácticas-de-programación.html#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="buenas-prácticas-de-programación.html#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">drop</span> <span class="kw">if</span> var1 &gt; <span class="ot">`lim&#39;</span></span>
<span id="cb5-4"><a href="buenas-prácticas-de-programación.html#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">drop</span> <span class="kw">if</span> var2 &gt; <span class="ot">`lim&#39;</span> </span>
<span id="cb5-5"><a href="buenas-prácticas-de-programación.html#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">drop</span> <span class="kw">if</span> var3 &gt; <span class="ot">`lim&#39;</span> </span></code></pre></div>
<p>De esta forma, en caso de decidir cambiar la restricción, solo tendrás que hacer <strong>un cambio</strong>. Minimizando la posibilidad de cometer un error.</p>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 2:</b></p>
<ul>
<li><p>Todas las regresiones que se encuentran en el código tienen la misma base, es decir, el mismo conjunto de variables que se repite.</p></li>
<li><p>La idea es consolidar</p></li>
</ul>
<p>la base con el fin de evitar duplicación de información.</p>
<ul>
<li>Con este fin, agregar <code>population</code> como control en todas las regresiones. Nuevamente, no dupliques información.</li>
</ul>
</div>
<div id="práctica-iii-nunca-transcribir-directamente-información-todo-automatizado" class="section level4 hasAnchor" number="2.1.2.1">
<h4><span class="header-section-number">2.1.2.1</span> Práctica III: nunca transcribir directamente información, todo automatizado<a href="buenas-prácticas-de-programación.html#práctica-iii-nunca-transcribir-directamente-información-todo-automatizado" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><strong>Nunca se debe transcribir resultados</strong>. Todo debe ser exportado de forma tal que pueda ser actualizado automáticamente.<br />
</li>
<li>No cumplir con esta práctica es una importante fuente de errores.</li>
<li><strong>Errores de transcripción:</strong> Si me equivoco en el décimo decimal no es tan grave, si cambio un signo sí lo es.</li>
<li><strong>Problemas para actualizar:</strong> Es probable que al actualizar un código (como sucede usualmente en cualquier proyecto), olvidemos traspasar los resultados.</li>
<li>¿Cómo evitar este problema?
<ul>
<li>Para usuarios de <span class="math inline">\(\LaTeX\)</span> cada resultado debe ser guardado en archivos <code>.tex</code>.</li>
<li>Hacer esto no solo con las tablas (ej. <code>putexcel</code>). También hacerlo con cualquier estadística que aparezca en el texto. (Por ejemplo, “El promedio de edad de la muestra es de 43 años”. Este 43 debe obtenerse automáticamente desde tu código, no debes transcribirlo.)</li>
<li>Para esto: debes generar el número que se desea citar. Convertirlo a <code>string</code> y guardarlo (ej. <code>midato.tex</code>). Llamarlo desde <span class="math inline">\(\LaTeX\)</span> con <code>\input{midato.tex}</code>.</li>
<li>Para usuarios de Word es un poco más complejo, pero posible <code>putdocx</code>.</li>
<li>Otra alternativa es utilizar Stata Markdown.</li>
<li>Independiente de la estrategia que utilices la buena práctica guarda relación con el hecho de que el producto final (artículo académico, reporte, nota, etc) debe estar <strong>conectado</strong> con cualquier estadística que se genere dentro de un proceso de análisis de datos.</li>
</ul></li>
</ul>
<p><strong>Ejemplo: importar una tabla desde Stata a <span class="math inline">\(\LaTeX\)</span> directamente</strong></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb6-1"><a href="buenas-prácticas-de-programación.html#cb6-1" aria-hidden="true" tabindex="-1"></a>eststo <span class="kw">clear</span></span>
<span id="cb6-2"><a href="buenas-prácticas-de-programación.html#cb6-2" aria-hidden="true" tabindex="-1"></a>eststo: <span class="kw">reg</span> polity gdp_per_cap</span>
<span id="cb6-3"><a href="buenas-prácticas-de-programación.html#cb6-3" aria-hidden="true" tabindex="-1"></a>eststo: <span class="kw">reg</span> polity gdp_per_cap under5_mortality</span>
<span id="cb6-4"><a href="buenas-prácticas-de-programación.html#cb6-4" aria-hidden="true" tabindex="-1"></a>esttab <span class="kw">using</span> nombredelarchivo.tex, <span class="kw">replace</span> <span class="co">///</span></span>
<span id="cb6-5"><a href="buenas-prácticas-de-programación.html#cb6-5" aria-hidden="true" tabindex="-1"></a>       <span class="bn">title</span>(<span class="st">&quot;Mis estimaciones&quot;</span>)</span></code></pre></div>
<ul>
<li>Lo importante es que todo lo que se produzca en Stata debe ir directamente al producto final. Para una revisión detallada ver <a href="https://medium.com/the-stata-guide/the-stata-to-latex-guide-6e7ed5622856">Stata to LaTeX Guide</a>. Una excelente referencia para hacer tablas mucho más avanzadas.</li>
</ul>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3:</b></p>
<p>Calcula el promedio de <code>literacy_rate</code> y guárdalo en una macro local. Generar un formato tal que solo tenga dos decimales. Guarda el valor como <em>string</em> en un archivo <code>.tex</code> en la misma carpeta.</p>
</div>
</div>
</div>
<div id="práctica-iv-estilo-importa" class="section level3 hasAnchor" number="2.1.3">
<h3><span class="header-section-number">2.1.3</span> Práctica IV: estilo importa<a href="buenas-prácticas-de-programación.html#práctica-iv-estilo-importa" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><p>Estilo no se refiere a la estética del código ni al orden.</p></li>
<li><p>Tiene que ver con la facilidad con el que este se puede <strong>leer</strong>. Al igual que cuando se escribe, lo importante es ser claro.</p></li>
<li><p>Para ello tres aspectos son claves:</p></li>
</ul>
<ol style="list-style-type: decimal">
<li><strong>Utilizar espacios</strong>. Usar espacios siempre después de utilizar un operador. Por ejemplo:</li>
</ol>
<div class="sourceCode" id="cb7"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb7-1"><a href="buenas-prácticas-de-programación.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> var1=var2+var3      <span class="co">/// Mal</span></span>
<span id="cb7-2"><a href="buenas-prácticas-de-programación.html#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> var1 = var2 + var3  <span class="co">/// Bien</span></span></code></pre></div>
<ul>
<li>Con criterio…</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb8-1"><a href="buenas-prácticas-de-programación.html#cb8-1" aria-hidden="true" tabindex="-1"></a>hours + minutes / 60 + seconds / 3600 </span>
<span id="cb8-2"><a href="buenas-prácticas-de-programación.html#cb8-2" aria-hidden="true" tabindex="-1"></a>hours + minutes/60 + seconds/3600</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li><p><strong>Nombrar las variables para que sean informativas en sí mismas.</strong> No escribir <code>var1</code>, si puedes escribir: <code>tasa_desempleo</code>. Requiere más trabajo, pero facilita la lectura. Agregar las unidades en las etiquetas facilita la lectura (<code>en porcentaje</code>). o bien (<code>== 1</code>) para indicar una variable dicotómica.</p></li>
<li><p><strong>Escribir comentarios</strong></p></li>
</ol>
<ul>
<li>Ejercicio para explicar en pocas palabras lo que se ha hecho.</li>
<li>Existe un equilibrio entre parsimonia y calidad del comentario.</li>
<li>Establecer el objetivo del comentario claramente es muy importante.</li>
<li>No hay una regla para escribir comentarios, pero sí algunos consejos (ver, <span class="citation">Gentzkow and Shapiro (<a href="#ref-gentzkow2014code" role="doc-biblioref">2014</a>)</span>)</li>
<li>Utilizar imperativo si lo tiene que corregir otra persona (ej. modifica parámetros aquí, fija directorio).</li>
<li>Debe incluir suficiente contexto para que alguien que no trabaje directamente en eso entienda qué se debe hacer.</li>
<li>Los comentarios largos deben explicar secciones de código. Importante escribir el código por bloques.</li>
<li>La brevedad no debe afectar nunca la comprensión. Esto también aplica para los comandos (ejemplo de <a href="https://michaelshill.net/2015/07/31/in-stata-coding-style-is-the-essential/">Michael Shill</a>).</li>
</ul>
<p><em>Ejemplo:</em></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb9-1"><a href="buenas-prácticas-de-programación.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">summarize</span> var1</span>
<span id="cb9-2"><a href="buenas-prácticas-de-programación.html#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">sum</span> var1</span>
<span id="cb9-3"><a href="buenas-prácticas-de-programación.html#cb9-3" aria-hidden="true" tabindex="-1"></a>su var1</span></code></pre></div>
</div>
</div>
<div id="estilo-de-codificación-en-stata" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Estilo de codificación en Stata<a href="buenas-prácticas-de-programación.html#estilo-de-codificación-en-stata" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="ser-ordenado-no-es-condición-suficiente-para-tener-un-buen-estilo-de-codificación" class="section level3 hasAnchor" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> Ser ordenado no es condición suficiente para tener un buen estilo de codificación<a href="buenas-prácticas-de-programación.html#ser-ordenado-no-es-condición-suficiente-para-tener-un-buen-estilo-de-codificación" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Primera idea: Un buen estilo de codificación es seguir una estrategia. Hay ciertas guías, pero lo relevante es seguir una y ser consistente.</li>
<li>Los códigos tienen distintas audiencias. La primera es tu computadora. Si tu computadora no entiende tu código, es el peor de los mundos.</li>
<li>Una de las audiencias más importantes son tus colaboradores y colaboradoras. Si ellos/as no lo entienden, <strong>el problema es tuyo en primer lugar.</strong></li>
<li>No hay un solo buen estilo. No hay una guía que pueda sustituir experiencia o estrategias ya probadas de trabajo de equipo.</li>
<li>Lo importante es <strong>tener estrategias</strong> y <strong>utilizarlas</strong> en la medida de que sea positivo para el producto final.</li>
<li>Ahora veremos algunas estrategias y buenas prácticas que pueden ayudar a mejorar el estilo de codificación individual y de tu equipo en base a dos referencias adicionales: y de una guía confeccionada por <a href="https://michaelstepner.com/">Michael Stepner</a>.</li>
</ul>
</div>
<div id="escribe-códigos-cortos" class="section level3 hasAnchor" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> Escribe códigos cortos<a href="buenas-prácticas-de-programación.html#escribe-códigos-cortos" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Ningún segmento de código debiese ser mayor a 100 - 150 caracteres.</li>
<li>Códigos largos, debiesen ser escritos de forma más pequeña como ado-files.</li>
<li>Si tienes dificultades para reducir un código a estos estándares, es probable que tengas que pensar en cómo estructurarlo de mejor forma.</li>
<li>Cada segmento de código o funciones debiesen tener un propósito <strong>claro e intuitivo</strong> para lectores experimentados en el lenguaje de programación que se esté utilizando.</li>
<li>Los do-files deben ser cortos y deben tener un objetivo claro.</li>
<li>Todo do-file debe tener un propósito que pueda ser <strong>explicado en una oración.</strong> De hecho, hay que hacerlo. En el preámbulo. Cada do-file debe indicar claramente su objetivo.<br />
</li>
<li>Un proyecto debería tener varios <code>do-files</code> con las siguientes características.
<ul>
<li><strong>Cortos:</strong> Debes ser capaz de leer un do-file completo en pocos minutos y entender el objetivo. Una buena regla es que no sean más largos de 250 - 350 líneas. No es estricta esta regla. Hay ocasiones que se justifican códigos más largos. Lo importante es la claridad. No sacrificarla nunca.</li>
<li><strong>Autocontenidos:</strong> Cada do-file interactúa con otros solo a través de los archivos que carga y de los que guarda. Es importante entender tu proyecto como un flujo estructurado con pasos predeterminados.</li>
<li><strong>Enfocados:</strong> Un <code>do-file</code> cumple un propósito determinado. Cada parte se debe entender como un paso intuitivo para lograr ese propósito.</li>
</ul></li>
</ul>
</div>
<div id="el-nombre-de-las-variables-debe-caracterizarla" class="section level3 hasAnchor" number="2.2.3">
<h3><span class="header-section-number">2.2.3</span> El nombre de las variables debe caracterizarla<a href="buenas-prácticas-de-programación.html#el-nombre-de-las-variables-debe-caracterizarla" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Nombres adecuados reemplazan comentarios y hacen el código auto contenido.</li>
<li><strong>Utilizar nombres completos</strong>. Abreviaciones solo en el caso de estar seguro que cualquier lector puede entenderlo sin ambigüedad.</li>
<li>Si se utilizan abreviaciones. Ser consistente. Utilizar siempre las mismas a lo largo del código. Documentarlas, especialmente con bases de datos complejas.</li>
<li>Cuando no se pueda ser suficientemente claro en un nombre, utilizar sí o sí para dar una descripción (ej. agregar unidad de medida, o qué tipo de variable es).</li>
<li><code>labels</code> especifican información. (ej, <code>edad</code> con el <code>label</code> <em>edad al 31 de enero</em> es más informativa que <code>edad</code> y más corto que <code>edad_31enero</code>).</li>
<li>No utilizar nombres en dos (o más) archivos que no expliciten por qué son diferentes. Por ejemplo: <code>version_final.do</code> y <code>version_final_ahorasiquesiestavezsi.do</code>.</li>
<li>Los nombres pueden ser más cortos cuando se utilicen con frecuencia o el objeto esté inmediatamente después.</li>
</ul>
<p><strong>Ejemplo:</strong></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb10-1"><a href="buenas-prácticas-de-programación.html#cb10-1" aria-hidden="true" tabindex="-1"></a>beta_mco = (educacion&#39; * educacion)^(-1) * <span class="co">///</span></span>
<span id="cb10-2"><a href="buenas-prácticas-de-programación.html#cb10-2" aria-hidden="true" tabindex="-1"></a>           (educacion&#39; * log_salarios)</span></code></pre></div>
<p>Mejor escrito sería:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb11-1"><a href="buenas-prácticas-de-programación.html#cb11-1" aria-hidden="true" tabindex="-1"></a>X = educacion</span>
<span id="cb11-2"><a href="buenas-prácticas-de-programación.html#cb11-2" aria-hidden="true" tabindex="-1"></a>Y = log_salarios</span>
<span id="cb11-3"><a href="buenas-prácticas-de-programación.html#cb11-3" aria-hidden="true" tabindex="-1"></a>beta_educ_salarios = (X&#39;*X)^(-1)*(X&#39;*Y) </span></code></pre></div>
<ul>
<li>No ser tacaño(a) al nombrar variables, archivos, carpetas.</li>
<li>Probablemente lo escribas solo una vez. No ahorres espacio. Siempre pensar en la claridad.</li>
<li>Para el caso de una figura:
<ul>
<li>`c_</li>
</ul></li>
</ul>
<p>1.pdf<code>es un pésimo nombre.    +</code>correlaciones.pdf<code>es un mal nombre.    +</code>T1_CORRELACIONES_INGRESO_MORTALIDAD.PDF<code>es un mejor nombre. * Para el caso de una carpeta:   +</code>datos/brutos/interregional<code>es un mal nombre.   +</code>datos/brutos/Estimaciones Censo Interregional 2010 - 2021` es un buen nombre.
* Estos nombres nos permiten pensar en el flujo lógico del proyecto sin tener que mirar los códigos nuevamente. Ayúdate constantemente.</p>
</div>
<div id="ten-especial-cuidado-cuando-uses-álgebra-en-los-códigos." class="section level3 hasAnchor" number="2.2.4">
<h3><span class="header-section-number">2.2.4</span> Ten especial cuidado cuando uses álgebra en los códigos.<a href="buenas-prácticas-de-programación.html#ten-especial-cuidado-cuando-uses-álgebra-en-los-códigos." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Separa el álgebra en partes. Por ejemplo, el siguiente código puede inducir a un error, dado que no está separado en partes.</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb12-1"><a href="buenas-prácticas-de-programación.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> pib_percapita_real = <span class="co">///</span></span>
<span id="cb12-2"><a href="buenas-prácticas-de-programación.html#cb12-2" aria-hidden="true" tabindex="-1"></a>    (cons + ggob + <span class="kw">export</span> - import - impuestos)* 10^6 <span class="co">///</span></span>
<span id="cb12-3"><a href="buenas-prácticas-de-programación.html#cb12-3" aria-hidden="true" tabindex="-1"></a>    /(indice_precios * poblacion_miles * 1000)</span></code></pre></div>
<p>Este código es más largo, pero mucho más entendible:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb13-1"><a href="buenas-prácticas-de-programación.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> pib_millones_nominal = <span class="co">///</span></span>
<span id="cb13-2"><a href="buenas-prácticas-de-programación.html#cb13-2" aria-hidden="true" tabindex="-1"></a>    (cons + ggob + <span class="kw">export</span> - import - impuestos)</span>
<span id="cb13-3"><a href="buenas-prácticas-de-programación.html#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> pib_total_real = pib_millones_nominal * 10^6 <span class="co">///</span></span>
<span id="cb13-4"><a href="buenas-prácticas-de-programación.html#cb13-4" aria-hidden="true" tabindex="-1"></a>    / indice_precios</span>
<span id="cb13-5"><a href="buenas-prácticas-de-programación.html#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> pop_total = poblacion_miles * 1000</span>
<span id="cb13-6"><a href="buenas-prácticas-de-programación.html#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> pib_percapita_real = pib_total_real / pop_total </span></code></pre></div>
</div>
<div id="ser-consistentes" class="section level3 hasAnchor" number="2.2.5">
<h3><span class="header-section-number">2.2.5</span> Ser consistentes<a href="buenas-prácticas-de-programación.html#ser-consistentes" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Hay cosas de estilo que son solo un tema de gusto. Por ejemplo, hay quienes escriben <code>nivel_empleo_anual</code> y otras que escriben <code>NivelEmpleoAnual</code>.</li>
<li>No importa la elección de un estilo u otro. Lo que importa es que todas y todos los miembros del equipo utilicen <strong>la misma</strong> convención.</li>
</ul>
</div>
<div id="chequear-errores" class="section level3 hasAnchor" number="2.2.6">
<h3><span class="header-section-number">2.2.6</span> Chequear errores<a href="buenas-prácticas-de-programación.html#chequear-errores" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Hemos aprendido que es importante escribir pruebas o testeos. Especialmente relevante después de operaciones complicadas o pegado de bases de datos.</li>
<li>Stata en algunas ocasiones indica los errores que se comenten, sin la necesidad de colocar estas pruebas. Por ejemplo:</li>
</ul>
<div class="sourceCode" id="cb14"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb14-1"><a href="buenas-prácticas-de-programación.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> <span class="fu">string</span> x = <span class="st">&quot;hola&quot;</span></span>
<span id="cb14-2"><a href="buenas-prácticas-de-programación.html#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> <span class="fu">y</span> = x^2</span></code></pre></div>
<p>Stata retorna el siguiente error:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb15-1"><a href="buenas-prácticas-de-programación.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="dv">type</span> mismatch </span>
<span id="cb15-2"><a href="buenas-prácticas-de-programación.html#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">r</span>(109);</span></code></pre></div>
<p>Normalmente el error da suficiente información. A pesar de lo anterior, en algunas circunstancias, no es tan claro saber cuál es el error. Cuando ustedes se hayan encontrado con un error, que no les fue fácil descifrar, <strong>tienen que escribir un comentario que lo indique y explique</strong>. Facilitará mucho el trabajo colaborativo. Eviten que otras personas tengan que invertir tiempo descifrando los mismos errores que ustedes.</p>
</div>
<div id="separar-tipos-de-códigos" class="section level3 hasAnchor" number="2.2.7">
<h3><span class="header-section-number">2.2.7</span> Separar tipos de códigos<a href="buenas-prácticas-de-programación.html#separar-tipos-de-códigos" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Separar códigos lentos de los rápidos.</li>
<li>Códigos lentos que rara vez se piensan ejecutar idealmente debiesen estar separados de los códigos rápidos que se quieren ejecutar múltiples ocasiones.</li>
<li>Evito tener que ejecutar un código lento cada vez que necesito actualizar algún resultado.</li>
<li>Este criterio cambia en caso de que todos los códigos sean rápidos. Si todos son computacionalmente no demandantes, lo importante es respetar el flujo de trabajo y la claridad de los procesos de análisis.</li>
</ul>
</div>
<div id="automatizar-todo-lo-que-se-pueda-automatizar" class="section level3 hasAnchor" number="2.2.8">
<h3><span class="header-section-number">2.2.8</span> Automatizar todo lo que se pueda automatizar<a href="buenas-prácticas-de-programación.html#automatizar-todo-lo-que-se-pueda-automatizar" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Todo lo que se pueda automatizar debe ser automatizado. Por ejemplo, escriban ado-files que cambien para subconjuntos. Que los iteradores tengan números que se obtengan a partir del código, no por algo que ustedes tengan que escribir.</li>
<li>Nunca hacer trabajo que vaya a obtener resultados de forma interactiva. Lo interactivo es siempre y únicamente para inspeccionar. En todo caso, al inspeccionar deberían hacer un código de todas formas. Esto les va a ayudar a saber qué estaban pensando en el primer momento que vieron los datos que quieren analizar.</li>
</ul>
</div>
<div id="abstraer-para-eliminar-pasos-redundantes." class="section level3 hasAnchor" number="2.2.9">
<h3><span class="header-section-number">2.2.9</span> Abstraer para eliminar pasos redundantes.<a href="buenas-prácticas-de-programación.html#abstraer-para-eliminar-pasos-redundantes." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Abstraer con fines de hacer códigos más claros. <strong>No por otras razones</strong>. A nadie le importa saber que puedes abstraer demasiado, si nadie entiende la razón de hacerlo. La claridad es lo que más importa.</li>
<li>Abstracción es esencial para escribir un buen código por al menos dos razones:
<ul>
<li>Al eliminar la redundancia se reducen las posibilidades de cometer errores.</li>
<li>Aumenta la claridad. Para cualquier lector será más fácil leer un código no redundante.</li>
</ul></li>
</ul>
<p><strong>Ejemplo:</strong> Supongamos que queremos ver la correlación espacial del consumo de papas fritas. Queremos testear si el consumo per-cápita de papas fritas está correlacionado con el consumo promedio per-cápita de las otras comunas de la misma región.</p>
<p>Primero tenemos que calcular el consumo per-cápita del resto:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb16-1"><a href="buenas-prácticas-de-programación.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> total_pc_papitas = <span class="kw">total</span>(pc_papitas), <span class="kw">by</span>(region)</span>
<span id="cb16-2"><a href="buenas-prácticas-de-programación.html#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> total_obs = <span class="fu">count</span>(pc_papitas), <span class="kw">by</span>(region)</span>
<span id="cb16-3"><a href="buenas-prácticas-de-programación.html#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> consumo_papitas_resto_pc = <span class="co">///</span></span>
<span id="cb16-4"><a href="buenas-prácticas-de-programación.html#cb16-4" aria-hidden="true" tabindex="-1"></a>(total_pc_papitas - pc_papitas)/(total_obs - 1)</span></code></pre></div>
<p>Ahora podemos ver si existe correlación. <u>¿Pero si queremos cambiar el nivel de agregación?</u> Tal vez sí existe correlación, pero a nivel de área metropolitana.</p>
<p>Copiemos el código de nuevo y calculemos esto.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb17-1"><a href="buenas-prácticas-de-programación.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> total_pc_papitas = <span class="kw">total</span>(pc_papitas), <span class="kw">by</span>(metroarea)</span>
<span id="cb17-2"><a href="buenas-prácticas-de-programación.html#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> total_obs = <span class="fu">count</span>(pc_papitas), <span class="kw">by</span>(region)</span>
<span id="cb17-3"><a href="buenas-prácticas-de-programación.html#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> consumo_papitas_restometro_pc = <span class="co">///</span></span>
<span id="cb17-4"><a href="buenas-prácticas-de-programación.html#cb17-4" aria-hidden="true" tabindex="-1"></a>(total_pc_papitas - pc_papitas)/(total_obs - 1)</span></code></pre></div>
<p><strong>Noten que hay un error</strong>. Se nos olvidó reemplazar región por <code>metroarea</code>. Este error se puede propagar si seguimos haciendo operaciones.</p>
<p>Una alternativa al copiar y pegar es escribir una función con propósito general (ado-file, programa, función, etc) que calcule la variable que deseamos bajo distintos parámetros (noten que esto se relaciona con automatizar)</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb18-1"><a href="buenas-prácticas-de-programación.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> consumo_papitas_resto </span>
<span id="cb18-2"><a href="buenas-prácticas-de-programación.html#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">syntax</span>, invar(varname) outvar(<span class="bn">name</span>) byvar(varname)</span>
<span id="cb18-3"><a href="buenas-prácticas-de-programación.html#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">tempvar</span> tot_invar count_invar </span>
<span id="cb18-4"><a href="buenas-prácticas-de-programación.html#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">egen</span> <span class="ot">`tot_invar&#39;</span> = <span class="kw">total</span>(<span class="ot">`invar&#39;</span>), <span class="kw">by</span>(<span class="ot">`byvar&#39;</span>)</span>
<span id="cb18-5"><a href="buenas-prácticas-de-programación.html#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">egen</span> <span class="ot">`count_invar&#39;</span> = <span class="fu">count</span>(&#39;invar&#39;), <span class="kw">by</span>(&#39;byvar&#39;) </span>
<span id="cb18-6"><a href="buenas-prácticas-de-programación.html#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">gen</span> <span class="ot">`outvar&#39;</span> = (<span class="ot">`tot_invar&#39;</span> - <span class="ot">`invar&#39;</span>) <span class="co">///</span></span>
<span id="cb18-7"><a href="buenas-prácticas-de-programación.html#cb18-7" aria-hidden="true" tabindex="-1"></a>    / (<span class="ot">`count_invar&#39;</span> - 1) </span>
<span id="cb18-8"><a href="buenas-prácticas-de-programación.html#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> </span></code></pre></div>
<p>Con el programa podemos escribir los bloques de código anteriores como:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb19-1"><a href="buenas-prácticas-de-programación.html#cb19-1" aria-hidden="true" tabindex="-1"></a>* Caso 1: a nivel <span class="kw">de</span> región</span>
<span id="cb19-2"><a href="buenas-prácticas-de-programación.html#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="buenas-prácticas-de-programación.html#cb19-3" aria-hidden="true" tabindex="-1"></a>consumo_papitas_resto, invar(pc_papitas) <span class="co">///</span></span>
<span id="cb19-4"><a href="buenas-prácticas-de-programación.html#cb19-4" aria-hidden="true" tabindex="-1"></a>outvar(consumo_papitas_resto_pc) byvar(region)</span>
<span id="cb19-5"><a href="buenas-prácticas-de-programación.html#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="buenas-prácticas-de-programación.html#cb19-6" aria-hidden="true" tabindex="-1"></a>* Caso 2: a nivel <span class="kw">de</span> área metropolitana</span>
<span id="cb19-7"><a href="buenas-prácticas-de-programación.html#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="buenas-prácticas-de-programación.html#cb19-8" aria-hidden="true" tabindex="-1"></a>consumo_papitas_resto, invar(pc_papitas)  <span class="co">///</span></span>
<span id="cb19-9"><a href="buenas-prácticas-de-programación.html#cb19-9" aria-hidden="true" tabindex="-1"></a>outvar(consumo_papitas_restometro_pc) byvar(metroarea)</span></code></pre></div>
<p>Hemos escrito la función de forma totalmente general. Podemos cambiar el nivel de agregación sin inducir errores por ir copiando y pegando códigos, además automatizamos un comando y evitamos repetición.</p>
</div>
<div id="crear-códigos-autoexplicativos-que-complementen-a-la-documentación" class="section level3 hasAnchor" number="2.2.10">
<h3><span class="header-section-number">2.2.10</span> Crear códigos autoexplicativos que complementen a la documentación<a href="buenas-prácticas-de-programación.html#crear-códigos-autoexplicativos-que-complementen-a-la-documentación" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>No escribas documentación que no vas a mantener.</li>
<li>Lo mejor es que los códigos sean autoexplicativos.</li>
<li>Veamos un ejemplo. Imaginemos que queremos estimar una elasticidad de demanda para hacer un análisis de bienestar.</li>
</ul>
<div class="sourceCode" id="cb20"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb20-1"><a href="buenas-prácticas-de-programación.html#cb20-1" aria-hidden="true" tabindex="-1"></a>* Elasticidad = Cambio porcentual en la cantidad / Cambio Porcentual en precio</span>
<span id="cb20-2"><a href="buenas-prácticas-de-programación.html#cb20-2" aria-hidden="true" tabindex="-1"></a>* Elasticidad = -0,4 / 0,2 = -2</span>
<span id="cb20-3"><a href="buenas-prácticas-de-programación.html#cb20-3" aria-hidden="true" tabindex="-1"></a>* Mirar Informe 1, Tabla 2A.</span>
<span id="cb20-4"><a href="buenas-prácticas-de-programación.html#cb20-4" aria-hidden="true" tabindex="-1"></a>    calcular_perdida_bienestar, elasticidad(3)</span></code></pre></div>
<ul>
<li><p><u>Problema:</u> código contradice comentario. Cuando tenemos dos fuentes o más fuentes que informan sobre el mismo objeto, es probable que estas se puedan contradecir. El problema de inconsistencia interna es especialmente importante para documentación, comentarios, notas, etc.</p></li>
<li><p>Para evitar este problema es necesario mantener los comentarios al día tal como se hace con los códigos.</p></li>
<li><p>Hacer esto es costoso. Mantener un código extenso al mismo tiempo que una larga documentación no es sencillo.</p></li>
<li><p>Dada esta restricción, es importante <em>escribir códigos que sean claros sin la necesidad de escribir comentarios extensos</em>.</p></li>
<li><p>Volviendo al ejemplo. ¿Cómo le decimos al lector del código debe tener una elasticidad de 2 y no de 3?</p></li>
</ul>
<p>Ejemplo de un código auto-explicativo:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb21-1"><a href="buenas-prácticas-de-programación.html#cb21-1" aria-hidden="true" tabindex="-1"></a>* Mirar Informe 1: Tabla 2A. </span>
<span id="cb21-2"><a href="buenas-prácticas-de-programación.html#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">local</span> cambio_porcentual_cantidad = -0,4</span>
<span id="cb21-3"><a href="buenas-prácticas-de-programación.html#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">local</span> cambio_porcentual_precio = 0,2 </span>
<span id="cb21-4"><a href="buenas-prácticas-de-programación.html#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">local</span> elasticidad = <span class="ot">`cambio_porcentual_cantidad&#39;</span> <span class="co">///</span></span>
<span id="cb21-5"><a href="buenas-prácticas-de-programación.html#cb21-5" aria-hidden="true" tabindex="-1"></a>  / <span class="ot">`cambio_porcentual_precio&#39;</span></span>
<span id="cb21-6"><a href="buenas-prácticas-de-programación.html#cb21-6" aria-hidden="true" tabindex="-1"></a>  calcular_perdida_bienestar, elasticidad(<span class="ot">`elasticidad&#39;</span>) </span></code></pre></div>
<p>Menos comentarios que el anterior. <strong>Sin números mágicos</strong>, los parámetros están definidos por variables locales, en vez de imputados directamente. Este código es más informativo y es internamente consistente dado que no puedo cambiar algunos de los parámetros sin modificar el resultado. Comentarios sirven en su justa medida: es imposible desprender del mismo código sin saber la tabla.</p>
<div id="pensar-siempre-en-la-unidad-de-observación-e-identificar-los-id-que-identifican-únicamente-a-la-unidad" class="section level4 hasAnchor" number="2.2.10.1">
<h4><span class="header-section-number">2.2.10.1</span> Pensar siempre en la unidad de observación e identificar los ID que identifican únicamente a la unidad<a href="buenas-prácticas-de-programación.html#pensar-siempre-en-la-unidad-de-observación-e-identificar-los-id-que-identifican-únicamente-a-la-unidad" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>de observación</p>
<ul>
<li>ID permiten saber la unidad de observación (hogar, empresas, lugares, hogar-año, empresa-mes-lugar).</li>
<li>Conocer ID únicos es esencial para entender los datos. Indican qué es lo que describen los datos.</li>
<li>También nos sirven para entender cómo juntar estos datos con otras fuentes de información.<br />
</li>
<li>Dos reglas que siempre tener en cuenta:
<ul>
<li>No tienen que existir observaciones duplicadas que tengan el mismo ID único.</li>
<li>Los ID no pueden tener <em>missings</em>.</li>
</ul></li>
<li>Una forma de verificar estos dos hechos es utilizando el comando <code>isid</code>. Este comando chequea si las variables especificadas identifican únicamente a las observaciones. Si esto no ocurre arrojará el siguiente mensaje:</li>
</ul>
<div class="sourceCode" id="cb22"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb22-1"><a href="buenas-prácticas-de-programación.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">variable</span> does <span class="kw">not</span> uniquely identify the observations</span></code></pre></div>
<p>Si encuentro plausible que alguna variable tenga <em>missing</em> puedo colocar la opción <code>missok</code>.</p>
</div>
</div>
<div id="no-ser-repetitivo" class="section level3 hasAnchor" number="2.2.11">
<h3><span class="header-section-number">2.2.11</span> No ser repetitivo<a href="buenas-prácticas-de-programación.html#no-ser-repetitivo" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Hemos hablado de evitar ser repetitivo. ¿Cuándo hacerlo? Repetir en una operación simple con dos categorías es razonable.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb23-1"><a href="buenas-prácticas-de-programación.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">xtile</span> decil_ing_ga = ing <span class="kw">if</span> grupo==<span class="st">&quot;A&quot;</span>, nq(10)</span>
<span id="cb23-2"><a href="buenas-prácticas-de-programación.html#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="kw">xtile</span> decil_ing_gb = ing <span class="kw">if</span> grupo==<span class="st">&quot;B&quot;</span>, nq(10)</span></code></pre></div>
<p>Si tengo que operar 15 veces, mejor hacerlo iterativamente:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb24-1"><a href="buenas-prácticas-de-programación.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> <span class="fu">y</span> = 2001/2015 {</span>
<span id="cb24-2"><a href="buenas-prácticas-de-programación.html#cb24-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">xtile</span> decil_ing_<span class="ot">`y&#39;</span> = ing <span class="kw">if</span> año == <span class="ot">`y&#39;</span>, nq(10)</span>
<span id="cb24-3"><a href="buenas-prácticas-de-programación.html#cb24-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Si involucra múltiples operaciones. A pesar de que solo existan dos categorías, es mejor hacerlo iterativo.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb25-1"><a href="buenas-prácticas-de-programación.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> g <span class="kw">in</span> <span class="st">&quot;A&quot;</span> <span class="st">&quot;B&quot;</span> {</span>
<span id="cb25-2"><a href="buenas-prácticas-de-programación.html#cb25-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">assert</span> ingreso &gt;= 0 <span class="kw">if</span> grupo == <span class="st">&quot;`g&#39;&quot;</span></span>
<span id="cb25-3"><a href="buenas-prácticas-de-programación.html#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">xtile</span> decil_ingreso_<span class="ot">`g&#39;</span> = ingreso <span class="co">/// </span></span>
<span id="cb25-4"><a href="buenas-prácticas-de-programación.html#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> grupo==<span class="st">&quot;`g&#39;&quot;</span> &amp; ingreso &gt; 0, nq(10)   </span>
<span id="cb25-5"><a href="buenas-prácticas-de-programación.html#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">replace</span> decil_ingreso_<span class="ot">`g&#39;</span> = 0 <span class="co">/// </span></span>
<span id="cb25-6"><a href="buenas-prácticas-de-programación.html#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> grupo==<span class="st">&quot;`g&#39;&quot;</span> &amp; ingreso == 0</span>
<span id="cb25-7"><a href="buenas-prácticas-de-programación.html#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">label</span> <span class="kw">var</span> decil_ingreso_<span class="ot">`g&#39;</span> <span class="st">&quot;Deciles de ingreso&quot;</span></span>
<span id="cb25-8"><a href="buenas-prácticas-de-programación.html#cb25-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><u>¿Cómo evitar ser repetitivo? </u></p>
<ul>
<li>Cuando necesites cambiar <strong>solo una cosa</strong> en el código utilizar un <em>loop</em>. <code>foreach</code> y <code>forvalues</code> iteran por el mismo código múltiples veces, cambiando el valor de una variable local cada vez.</li>
<li>Cuando necesites cambiar <strong>múltiples cosas</strong> dentro de un código, define un programa dentro del do-file utilizando <code>program</code>. De este modo tú podrás especificar más de un argumento.</li>
<li>Cuando necesites repetir un código en <strong>múltiples do-files</strong>, pueden definir un programa en un <code>ado-file</code>, guardarlo y llamarlo cuando lo necesites. Es importante que el código agregue automáticamente la ruta en donde se encuentran guardados estos programas.</li>
</ul>
<p><strong>Algunas ayudas:</strong></p>
<ul>
<li>Cuando algunas líneas de código necesiten cambiar entre repeticiones utilizar <code>if/else</code> y <code>forvalues</code>. Estos iteran por el mismo código múltiples veces, cambiando el valor de una variable local cada vez.</li>
<li>Cuando definas programas dentro de un do-file, agrega una línea que diga <code>cap program drop &lt;program_name&gt;</code> antes de <code>program define</code>. Automáticamente se eliminará y redefinirá el programa cada vez que ejecutes el código.</li>
</ul>
</div>
<div id="mensajes-finales-sobre-estilo-de-codificación" class="section level3 hasAnchor" number="2.2.12">
<h3><span class="header-section-number">2.2.12</span> Mensajes finales sobre estilo de codificación<a href="buenas-prácticas-de-programación.html#mensajes-finales-sobre-estilo-de-codificación" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Haz las cosas lo más simples posibles para ti (y tu equipo) de hoy y del futuro.</li>
<li>No confíes tanto en ti de hoy y menos en el del futuro. Es mejor programar <strong>defensivamente</strong>.</li>
<li>Ser consistente en formato, estilo, organización y nombres. Sigue estrategias.</li>
<li>Reducir en lo posible pegado de códigos y repetición innecesaria.</li>
<li>Testear regularmente.</li>
<li>Documentar a menudo, estratégicamente, pero mínimamente.</li>
</ul>
</div>
</div>
<div id="organización-de-un-proyecto-en-stata" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Organización de un proyecto en Stata<a href="buenas-prácticas-de-programación.html#organización-de-un-proyecto-en-stata" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="flujo-de-trabajo-en-stata" class="section level3 hasAnchor" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> Flujo de trabajo en Stata<a href="buenas-prácticas-de-programación.html#flujo-de-trabajo-en-stata" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Hasta el momento uno de los mayores mensajes es <strong>adoptar un sistema de organización</strong>, compartirlo en el equipo y adherirse a él. Este debe incluir:</p>
<ol style="list-style-type: decimal">
<li>Estructuras de directorio.</li>
<li>Estilo de codificación.<br />
</li>
<li>Convenciones para escribir nombres.<br />
</li>
<li>Convenciones para exportar datos.</li>
</ol>
<p>Hemos visto en detalle (2) y (3). Algunas cosas de (4) (más detalles en otro capítulo). En esta sección nos enfocaremos en (1). Esta sección se basa en una de las guías de <a href="https://asjadnaqvi.medium.com/">Asjad Nqvi</a>. Muy buenos recursos. Muy recomendado. También revisaremos algunos elementos de ().</p>
<ul>
<li>Un proyecto de análisis de datos contempla: planificar el trabajo, documentar las actividades, crear y verificar variables, generar y presentar análisis estadísticos, replicar resultados y archivar.</li>
<li>Todo lo anterior es a lo que nos referiremos como flujo de trabajo.</li>
<li>Un buen flujo de trabajo es esencial para que tú y tus colaboradores(as) y los interesados en tu trabajo puedan replicarlo.</li>
<li>Replicar es clave para generar información confiable y correcta.</li>
</ul>
<p>La administración del flujo de trabajo se hace al <strong>inicio</strong> de un proyecto. No al final. No hacerlo así tiene costos en tiempo y posiblemente induzca errores no forzados. Veremos algunos aspectos relacionados con la administración de datos y <em>scripts</em>. Nuevamente, más que reglas a seguir, lo presentado aquí son una serie de buenas prácticas que pueden ayudar a mejorar la gestión del trabajo con Stata. La idea de esto es que finalmente podamos dedicarle más y mejor tiempo al análisis de datos.
* Nuevamente, tener un flujo de trabajo es clave, incluso los mayores expertos en estos temas tienen problemas con esto. Por ejemplo, en el prólogo de <span class="citation">Long and Long (<a href="#ref-long2009workflow" role="doc-biblioref">2009</a>)</span></p>
<div class="alert alert-block alert-info">
<p>When I started, I thought my workflow <strong>was very good and that it was simply a matter of recording what I did”</strong> As writing proceeded (<strong>this book</strong>), I discovered gaps, inefficiencies, and inconsistencies in what I did. Sometimes these involved procedures that I knew were awkward, but where “I never took the time to find a better approach”. Some problems were due to oversights where I had not realized the consequences of the things I did or failed to do.</p>
</div>
</div>
<div id="organización-de-archivos-y-carpetas" class="section level3 hasAnchor" number="2.3.2">
<h3><span class="header-section-number">2.3.2</span> Organización de archivos y carpetas<a href="buenas-prácticas-de-programación.html#organización-de-archivos-y-carpetas" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Algunos problemas que son recurrentes:
<ul>
<li>Tener múltiples versiones de un archivo y no saber cuál es cuál.</li>
<li>No poder encontrar un archivo y pensar que lo has borrado.</li>
<li>Tu equipo (y tú) no saben cuál es el informe final. Hay dos archivos que con el nombre archivo final, pero con distinto contenido.</li>
</ul></li>
</ul>
<p>Para evitar los problemas anteriores es importante diseñar la estructura de la carpeta de trabajo y comprometerse a seguir una alerta.</p>
<div id="carpetas" class="section level4 hasAnchor" number="2.3.2.1">
<h4><span class="header-section-number">2.3.2.1</span> Carpetas<a href="buenas-prácticas-de-programación.html#carpetas" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p>Todo se guarda en carpetas. <strong>TODO</strong>.</p></li>
<li><p>Estas deben seguir un orden lógico e intuitivo. Como consejo. Colocar números en la carpeta. Al ordenar las carpetas seguirán este orden y no el alfabético.</p></li>
<li><p>No tener espacios en el nombre de las carpetas.</p></li>
<li><p>Nunca utilizar (-) entre nombres de una carpeta. Utilizar (_).</p></li>
<li><p>Evitar nombrar las carpetas con mayúsculas.</p></li>
<li><p>Siempre escribir un <code>README.txt</code>. Puede ser tedioso, pero muy necesario. Corto, informativo, que explique el flujo de trabajo y las carpetas. Sugerencia: colocar las rutas.</p></li>
<li><p>En esta figura se ve la idea de cómo debería estructurarse las carpetas de un proyecto pequeño</p></li>
<li><p>Lo mismo, pero para un proyecto grande</p></li>
<li><p>Lo mismo, pero presentado de otra forma:</p></li>
<li><p>En la medida que sus carpetas se parezcan más a estas, mucho mejor.</p></li>
<li><p>Es importante generar dos tipos de carpetas para los resultados <code>trabajo</code> y otras que diga <code>compartir</code>.</p></li>
<li><p><code>trabajo</code> guarda todos los resultados (ej. tablas, gráficos, documentos) que están siendo trabajados.</p></li>
<li><p><code>compartir</code> guarda resultados terminados y listos para compartir en alguna etapa del proyecto. Por ejemplo, cuando se quieran compartir resultados intermedios del proyecto.</p></li>
<li><p>Dos reglas:</p>
<ul>
<li>Resultados se comparten solo después que los archivos que lo generan pasen a la carpeta <code>compartir</code>.</li>
<li>Una vez traspasados a la carpeta compartir. No se modifican. Incluso cuando puedan existir errores.</li>
</ul></li>
</ul>
<p>Ayuda a garantizar que los resultados que se comparten se puedan replicar. Si encuentras errores o decides cambiar algo no cambies los ya posteados. Genera nuevos. Esto también ayuda a la replicabilidad: permite saber qué cambios existieron durante un proyecto.</p>
<p>Un directorio de trabajo estructurado es especialmente <strong>importante para proyectos colaborativos</strong> donde todo se puede desordenar más fácilmente. Dos directorios son sugeridos cuando se trabaja de forma colaborativa: <code>correo</code> y otras que diga <code>privados</code>. <code>correo</code> guarda intercambios entre colaboradoras mientras que <code>privados</code> guarda el trabajo propio de cada colaborador(a). Otras carpetas</p>
<p>que pueden complementar trabajo son <code>porhacer</code> que sea una carpeta que sirva como una lista de tareas <code>poraprender</code>. En cualquier caso, estas carpetas pueden ser parte de <code>privados</code>.</p>
<p>Cuando se tengan versiones se pueden utilizar dos modos:</p>
<ul>
<li>v1, v2, v3, etc.</li>
<li>Fechas. Si se utilizan estas escribirlo en año/mes/día. De esta forma se ordenará automáticamente desde el último al primero.</li>
</ul>
<p>Cuando versiones anteriores no te sean útiles. <strong>Bórralas!</strong> No acumules archivos y códigos porque sí. Si por alguna razón deseas dejarlos (ej. necesidad de respaldar lo hecho). Genera una carpeta temporal. Esta puede estar en tu versión personal del proyecto, pero no en el archivo final.</p>
</div>
</div>
<div id="master-do-files" class="section level3 hasAnchor" number="2.3.3">
<h3><span class="header-section-number">2.3.3</span> Master <code>do-files</code><a href="buenas-prácticas-de-programación.html#master-do-files" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Un Master <code>do-file</code> es un <code>do-file</code> que ejecuta todos los códigos relevantes para el proyecto.</li>
<li>Se basa en la idea de que diferentes <code>do-files</code> se enfocan en diferentes tareas o subtareas. No es buena práctica tener un solo código enorme que haga todo el proceso.<br />
</li>
<li>Es importante separar tanto todos los <code>do-files</code> (incluyendo el master) en secciones y subsecciones. Por ejemplo: Preámbulo, cargar datos, generar variables, figura I, Tabla 3, etc.</li>
<li>Crear <code>master_do.files</code> cada proyecto o subproyecto debe tener un archivo maestro que ejecute <strong>todos</strong> los códigos de inicio a fin y genere todos los resultados.</li>
<li>Cada vez que se termine un proyecto o se obtenga algún resultado es importante ejecutar el <code>master_do.files</code>.</li>
</ul>
<p>Ejemplo de master do-file:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb26-1"><a href="buenas-prácticas-de-programación.html#cb26-1" aria-hidden="true" tabindex="-1"></a>  *** Información del proyecto aquí ***</span>
<span id="cb26-2"><a href="buenas-prácticas-de-programación.html#cb26-2" aria-hidden="true" tabindex="-1"></a>  *** Información sobre directorios ***</span>
<span id="cb26-3"><a href="buenas-prácticas-de-programación.html#cb26-3" aria-hidden="true" tabindex="-1"></a>  *** Ejecutar códigos ***</span>
<span id="cb26-4"><a href="buenas-prácticas-de-programación.html#cb26-4" aria-hidden="true" tabindex="-1"></a>  * Generación <span class="kw">de</span> datos</span>
<span id="cb26-5"><a href="buenas-prácticas-de-programación.html#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">do</span> ./dofiles/01_datos_v11.<span class="kw">do</span> </span>
<span id="cb26-6"><a href="buenas-prácticas-de-programación.html#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">do</span> ./dofiles/02_merge_v2.<span class="kw">do</span> </span>
<span id="cb26-7"><a href="buenas-prácticas-de-programación.html#cb26-7" aria-hidden="true" tabindex="-1"></a>  * Generación <span class="kw">de</span> tablas</span>
<span id="cb26-8"><a href="buenas-prácticas-de-programación.html#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">do</span> ./dofiles/03_tablas_v4.<span class="kw">do</span> </span>
<span id="cb26-9"><a href="buenas-prácticas-de-programación.html#cb26-9" aria-hidden="true" tabindex="-1"></a>  * Estimación principal</span>
<span id="cb26-10"><a href="buenas-prácticas-de-programación.html#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">do</span> ./dofiles/04_estimaciones_v11.<span class="kw">do</span> </span>
<span id="cb26-11"><a href="buenas-prácticas-de-programación.html#cb26-11" aria-hidden="true" tabindex="-1"></a>  * Figuras principales</span>
<span id="cb26-12"><a href="buenas-prácticas-de-programación.html#cb26-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">do</span> ./dofiles/05_graficos_v11.<span class="kw">do</span> </span></code></pre></div>
</div>
<div id="rutas-de-las-carpetas" class="section level3 hasAnchor" number="2.3.4">
<h3><span class="header-section-number">2.3.4</span> Rutas de las carpetas:<a href="buenas-prácticas-de-programación.html#rutas-de-las-carpetas" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Es importante tener una carpeta principal y referenciar todas las rutas a esa dirección.</li>
<li>Utilizar siempre <code>/</code> no <code>\</code>. Puede causar problemas según el sistema operativo que utilices.</li>
<li>Utilizar macros para nombrar a las carpetas. Que estos nombres tengan sentido y se relacionen con el flujo de trabajo.</li>
<li>Recordar que una variable <code>local</code> guarda información temporalmente mientras que <code>global</code> guarda información permanentemente. Esto último hace de los <code>global</code> algo no recomendable de utilizar constantemente. No obstante, es útil para los directorios.</li>
</ul>
<div class="sourceCode" id="cb27"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb27-1"><a href="buenas-prácticas-de-programación.html#cb27-1" aria-hidden="true" tabindex="-1"></a>   *** Nota 1: Reemplazar esta ruta ***</span>
<span id="cb27-2"><a href="buenas-prácticas-de-programación.html#cb27-2" aria-hidden="true" tabindex="-1"></a>   <span class="kw">global</span> miproyecto <span class="st">&quot;C://Program Files/Dropbox/miproyecto/&quot;</span></span>
<span id="cb27-3"><a href="buenas-prácticas-de-programación.html#cb27-3" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb27-4"><a href="buenas-prácticas-de-programación.html#cb27-4" aria-hidden="true" tabindex="-1"></a>   *** Nota 2: Directorios <span class="kw">de</span> subcarpetas ***</span>
<span id="cb27-5"><a href="buenas-prácticas-de-programación.html#cb27-5" aria-hidden="true" tabindex="-1"></a>   <span class="kw">clear</span></span>
<span id="cb27-6"><a href="buenas-prácticas-de-programación.html#cb27-6" aria-hidden="true" tabindex="-1"></a>   <span class="kw">global</span> datosbrutos <span class="st">&quot;$miproyecto/datos/brutos&quot;</span></span>
<span id="cb27-7"><a href="buenas-prácticas-de-programación.html#cb27-7" aria-hidden="true" tabindex="-1"></a>   cd <span class="st">&quot;$datosbrutos&quot;</span></span>
<span id="cb27-8"><a href="buenas-prácticas-de-programación.html#cb27-8" aria-hidden="true" tabindex="-1"></a>   <span class="kw">use</span> datos1.dta, <span class="kw">replace</span> </span></code></pre></div>
</div>
<div id="utilizar-algún-auxiliar-de-generación-de-código-sublime-text" class="section level3 hasAnchor" number="2.3.5">
<h3><span class="header-section-number">2.3.5</span> Utilizar algún auxiliar de generación de código: Sublime Text<a href="buenas-prácticas-de-programación.html#utilizar-algún-auxiliar-de-generación-de-código-sublime-text" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Esta sección está basada en la página web de <a href="https://acarril.github.io/">Alvaro Carril</a>.</p>
<div id="qué-es-sublime" class="section level4 hasAnchor" number="2.3.5.1">
<h4><span class="header-section-number">2.3.5.1</span> ¿Qué es Sublime?<a href="buenas-prácticas-de-programación.html#qué-es-sublime" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><a href="https://www.sublimetext.com/">Sublime Text</a> es un editor de códigos gratuito. Este editor permite compilar códigos de distintos lenguajes de programación tales como Stata, Python, R, , entre muchos otros.</p></li>
<li><p>Tiene algunas herramientas que facilitan el trabajo de programación tales como atajos (<em>shortcuts</em>) o multicolumnas. Veremos varias en esta sección.
Es muy útil cuando tienes un proyecto grande con códigos de distintos tipos de lenguaje.
Instalar Sublime</p></li>
<li><p>Dirígete a <a href="https://www.sublimetext.com/">sublimetext.com</a>. Descarga e instala Sublime Text 4 (ST4) para tu sistema operativo.</p></li>
<li><p>Es esencial que también instales <code>Package Control</code>, que te permite añadir y eliminar fácilmente complementos adicionales. Si está bien instalado, debiese aparecer en <em>preferences.</em></p></li>
<li><p>Para instalar hay que entrar a sublime, apretar <code>ctrl + shift + p</code>.</p></li>
<li><p>Tipear <code>Install Package Control</code> y presionar <code>enter</code>.</p></li>
</ul>
</div>
<div id="ejecutar-stata-desde-sublime" class="section level4 hasAnchor" number="2.3.5.2">
<h4><span class="header-section-number">2.3.5.2</span> Ejecutar Stata desde Sublime<a href="buenas-prácticas-de-programación.html#ejecutar-stata-desde-sublime" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>Para Windows</strong></p>
<ul>
<li><strong>Instalar StataEditor:</strong> En ST4 apreta <code>ctrl+shift+p</code>. Escriba <code>install</code> y presione <code>Enter</code>. Ahora busque <code>StataEditor</code> y haga clic en él para instalarlo.</li>
<li><strong>Instale Pywin32:</strong> repita el proceso anterior pero instalando el complemento <code>Pywin32</code>.</li>
</ul>
<p>Configure StataEditor:</p>
<ul>
<li>En ST4 vaya a <code>Preferences -&gt; Package Settings -&gt; StataEditor -&gt; Settings - Users</code></li>
<li>En este archivo en blanco debe escribir la ruta de su ejecutable de Stata y la versión que posee.</li>
<li>Mi archivo de configuración en Windows se ve así:</li>
</ul>
<div class="sourceCode" id="cb28"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb28-1"><a href="buenas-prácticas-de-programación.html#cb28-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb28-2"><a href="buenas-prácticas-de-programación.html#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;stata_path&quot;</span>: <span class="st">&quot;C:/Program Files/Stata17/StataMP-64.exe&quot;</span>,</span>
<span id="cb28-3"><a href="buenas-prácticas-de-programación.html#cb28-3" aria-hidden="true" tabindex="-1"></a>   <span class="st">&quot;stata_version&quot;</span>: 17,</span>
<span id="cb28-4"><a href="buenas-prácticas-de-programación.html#cb28-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Registre la biblioteca de automatización de Stata:</p>
<ul>
<li>Vaya al ejecutable de Stata del que ha copiado la ruta (por ejemplo, StataMP-64.exe).</li>
<li>Cree un acceso directo en su escritorio.</li>
<li>Ahora haga clic con el botón derecho en este nuevo acceso directo y seleccione “Propiedades”.</li>
<li>En el campo “Destino”, añada /Registro al final (con un espacio precedente). En mi caso es:</li>
</ul>
<div class="sourceCode" id="cb29"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb29-1"><a href="buenas-prácticas-de-programación.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;C:\Program Files\Stata17\StataMP-64.exe&quot;</span> /Register</span></code></pre></div>
<p>Aplicar y aceptar los cambios. Apretar sobre el acceso directo el clic derecho y ejecutar como administrador. ¡Y listo!</p>
<p><strong>Para Mac</strong></p>
<ul>
<li>Para instalar el Editor Mejorado de Stata en ST4, inicie la paleta de comandos con <code>Cmd+shift+p</code>, escriba “install” y presione <code>Enter</code>.</li>
<li>Ahora busque <code>Stata Improved Editor</code> y haga clic en él para instalarlo.</li>
<li>Reinicie ST4 y listo!</li>
</ul>
<p>Autoguardado</p>
<ul>
<li>Sublime permite auto-guardar los códigos.</li>
<li>De esta forma no hay que preocuparse en casos de que no hayas respaldado tu código.</li>
<li>Para esto hay que escribir vamos a instalar el paquete <code>autosave</code> y adicionalmente vamos a agregar a “preferencias”:</li>
</ul>
<div class="sourceCode" id="cb30"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb30-1"><a href="buenas-prácticas-de-programación.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;save_on_focus_lost&quot;</span>: true.</span></code></pre></div>
<pre><code>
&lt;!--chapter:end:01-Cap1.Rmd--&gt;


# Programar do - files {#01-chap02}

## Programar en Stata

Esta sección esta basada en: **An introduction to Stata Programing** (\cite{baum2009introduction}), en notas de clase de la profesora [Erin Hengel](https://www.erinhengel.com/), en **Advanced Stata Topics** del profesor Alexander C. Lembcke, en **Seventy-six Stata tips** \cite{newton2009seventy}, en **Top 10 ``gotchas&quot;** de \cite{shaw2015top} y en **Data Management Using Stata. A Practical Handbook** de \cite{mitchell2010data}. 

#### ¿Qué es programar en Stata?

Programar en Stata es: 

* Escribir `do - files`: una secuencia de comandos ejecutables a través de un archivo `.do`.
* Escribir los que formalmente en Stata es un *programa*: un conjunto de comandos que incluyen el comando `program`.  Un programa en Stata se guarda como un *ado - file*.
* Escribir lenguaje de programación matricial: denominado mata.

#### do - files

El uso de `do-file` garantiza la replicabilidad del análisis de datos utilizando Stata. Recordar que un `do-file` puede llamar a otros (ej. `master do.file`. La jerarquización de los `do-file` puede ser importante para proyectos grandes o complejos. Es importante evitar trabajar en Stata interactivamente. Únicamente hay que hacerlo para inspeccionar datos (recordar practicas Sección 3.1). 

#### ado - files

Sirven para crear tus propios \textit{comandos} en Stata. Una vez que armes tu programa y lo guardes en la carpeta de `ado-file` puedes utilizarlo como cualquier otro comando de Stata. Por ejemplo, puedes agregar las opciones *if*, *in range* y otras. También puedes escribir un documento de ayuda (*help*} que explique el programa. Crear tus propios comandos es una muy buena forma de ser más eficiente al trabajar con Stata (recordar Sección 1). 

Mata para ado-files: Los `ado-files` pueden realizar tareas más complejas que involucren ejecutar el comando múltiples veces. 

* El lenguaje de programación mata es mucho más rápido que un `ado-file`.
* Útil para realizar tareas que sean intensivas computacionalmente. 
* No es solo un lenguajes de programación que utiliza matrices. También sirve para tareas que involucran texto o listas. 
* Próximante discutiremos este lenguaje. 

### Comandos y funciones claves (y algunos detalles)}

Revisaremos algunos aspectos necesarios para mejorar la eficiencia al trabajar en Stata.

* Directorios y uso de `profile.do`.
* Tipos de comandos. 
* Tipos de datos y uso de `compress`. 
* Uso de `capture`, `preserve` y `restore`.  

#### Directorios

* `cd` y `pwd` sirven para fijar y conocer mis directorios. Es importante utilizar **dobles comillas** en los casos en que la ruta del directorio tenga espacios. 
* El comando `sysdir` provee una lista de los directorios importantes para Stata. 
* El comando `update` sirve para actualizar los comandos. 
* La carpeta `PLUS` es el directorio donde se guardan comandos descargados. Si utilizas `ssc`, se guardara en esta carpeta.   
* `PERSONAL` para tus propios `ado-files`. 

#### Profile do

¿Qué es profile do? 

* Una opción no tan conocida es la utilización de `profile.do`
* Este archivo se ejecuta cada vez que Stata se inicia. Si no tienes uno guardado no pasa nada. 
* Este `do-file` permite, por ejemplo, fijar tu directorio de trabajo inicial, cambiar características de los gráficos, generar atajos.  
* También se puede hacer que Stata abra un log-file y lo guarde siempre en el mismo lugar. 
* Cada vez que inicies sesión Stata ira por `profile.do`. Si lo encuentra lo va a ejecutar.     
* Stata recomienda guardar `profile.do` en *home directory* (ver *help profilew para ususarios de windows y profilem para Mac*). 
* Vamos a ver como modificar `profile.do`. En particular: 
  + Ajustes generales. 
  + Establecer las características de los gráficos.
  + Establecer atajos 
  + Abrir, cerrar y guardar un log-file con la fecha.

&lt;div class=&quot;alert alert-block alert-warning&quot;&gt;
&lt;b&gt;Ejercicio 3.3.1:&lt;/b&gt;

Instrucciones

1. Descargar carpeta *ejercicios-clase3*.
2. Abrir `profile.do` e inspeccionar cada una de las lineas del código. 

Preguntas

1. Agrega dos elementos a alguna sección. 
2. Modifica las carpetas según las características de tu computadora.
3. Guarda `profile.do` en el *home directory*. Ejecutar nuevamente Stata y verificar que el código se ha ejecutado.
&lt;/div&gt;

#### Tipos de comandos

Comandos r-class y e-class

* Muchos comandos en Stata (ej. `summarize`, `correlate`, `regress`) hacen que sea posible utilizar sus resultados una vez que estos son ejecutados. 
* `summarize` y `correlate` son comandos `r-class`. Es decir, comandos que guardan sus resultados en `r()`. 
* `regress` es un comando `e-class`. Es decir, comandos que guardan sus resultados en `e()`.
* `return list` retorna los valores guardados en `r()`


```stata
* r-class
sysuse auto.dta, clear 
summarize mpg 
return list 

summarize mpg, detail 
return list 
display &quot;La asimetría de mpg es&quot; r(skewness) 
summarize price, detail 
return list </code></pre>
<p>Su limitación es que solo están disponibles los valores del último comando <code>r-class</code> ejecutado.</p>
<p>Los comandos <code>e-class</code> son comandos de <em>estimación</em>. Para verlos <code>ereturn list</code> y para llamarlos individualmente <code>e(nombre)</code>. Guardan más información que los de <code>r-class</code> : matrices, vectores y funciones. La información de los comandos <code>e-class</code> sigue estando disponible una vez que utilizamos algún comando <code>r</code>-class`. <strong>Aquí una diferencia!</strong></p>
<p>Un ejemplo clásico son las estimaciones de regresión lineal.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb32-1"><a href="buenas-prácticas-de-programación.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="kw">regress</span> mpg <span class="kw">weight</span> <span class="fu">length</span> rep78 </span>
<span id="cb32-2"><a href="buenas-prácticas-de-programación.html#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;La regresión se estimo para &quot;</span> <span class="fu">e</span>(<span class="kw">N</span>) <span class="st">&quot; observaciones.&quot;</span> </span>
<span id="cb32-3"><a href="buenas-prácticas-de-programación.html#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="kw">ereturn</span> <span class="ot">list</span></span></code></pre></div>
<p>En general cualquier comando de estimación se guarda en esta clase de formato.</p>
</div>
<div id="tipos-de-datos" class="section level4 hasAnchor" number="2.3.5.3">
<h4><span class="header-section-number">2.3.5.3</span> Tipos de datos<a href="buenas-prácticas-de-programación.html#tipos-de-datos" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>numeric y string</p>
<ul>
<li>La mayor distinción entre tipos de datos es entre <em>numeric</em> y <em>string</em>.</li>
<li>Al trabajar con datos muchas veces es necesario realizar conversiones entre estos dos formatos. Los comandos <code>destring</code>, <code>tostring</code> y <code>encode</code> son útiles para estas tareas (si alguien tiene dudas con alguno me escriben).</li>
<li><em>strings</em> pueden soportar un máximo de 244 caracteres con un <code>byte</code> por cada carácter.</li>
<li>Por ejemplo, una variable del tipo <code>str20</code> requiere 20 <code>bytes</code> por observación.</li>
</ul>
<p>Clasificación de los datos</p>
<ul>
<li>Para las variables en formato <em>numeric</em> los tipos de datos son: <code>byte</code>, <code>int</code>, <code>long</code>, <code>float</code> y <code>double</code>.</li>
<li>Los tres primeros solo puede almacenar valores enteros. <code>long</code> puede almacenar todos los números de 9 dígitos, pero es limitado para 10 dígitos.</li>
<li><code>float</code> y <code>double</code> pueden almacenar números grandes.</li>
<li>No asumir que <code>float</code> será aritméticamente exacto. Por ejemplo:</li>
</ul>
<div class="sourceCode" id="cb33"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb33-1"><a href="buenas-prácticas-de-programación.html#cb33-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">float</span>(16777216)</span>
<span id="cb33-2"><a href="buenas-prácticas-de-programación.html#cb33-2" aria-hidden="true" tabindex="-1"></a>        16777216</span>
<span id="cb33-3"><a href="buenas-prácticas-de-programación.html#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">float</span>(16777217)</span>
<span id="cb33-4"><a href="buenas-prácticas-de-programación.html#cb33-4" aria-hidden="true" tabindex="-1"></a>        16777216</span></code></pre></div>
<p>¿Como utilizar esto para programar efectivamente en Stata?</p>
<ul>
<li>IDs con muchos dígitos (y caracteres) guardarlos como <em>string</em>. No como <code>integers</code>, <code>float</code> o <code>doubles</code>.</li>
<li>No confiar en test exactos contra una constante con datos en formato <code>float</code>. Utilizar formato <code>double</code> para cualquier serie que necesita ser precisa (ej. suma de los residuos de una regresión).</li>
<li>Utiliza <code>integers</code> cuando sea apropiado (ej. variables dicotómicas). Guardar valores como <code>int</code> o <code>byte</code> ayuda a utilizar de forma más eficiente el espacio en el disco.</li>
<li><code>compress</code> examina cada variable y determina si estas pueden ser guardadas de forma más eficiente. <strong>Utilizarlo</strong>.</li>
</ul>
<p>Si se especifican valores iniciales fuera de los rangos permitidos para cada tipo de dato el resultado será un <em>missing</em>.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb34-1"><a href="buenas-prácticas-de-programación.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span> <span class="ot">all</span> </span>
<span id="cb34-2"><a href="buenas-prácticas-de-programación.html#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="kw">obs</span> 10 </span>
<span id="cb34-3"><a href="buenas-prácticas-de-programación.html#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> <span class="kw">byte</span> var1 = 101</span>
<span id="cb34-4"><a href="buenas-prácticas-de-programación.html#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="kw">summarize</span> var1 </span></code></pre></div>
<p>Notar que no se genera ninguna alerta de <em>missing</em> cuando este se crea. Esto es distinto para variables que ya existen.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb35-1"><a href="buenas-prácticas-de-programación.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span> <span class="ot">all</span></span>
<span id="cb35-2"><a href="buenas-prácticas-de-programación.html#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="kw">obs</span> 10</span>
<span id="cb35-3"><a href="buenas-prácticas-de-programación.html#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> <span class="kw">byte</span> var1 = 1</span>
<span id="cb35-4"><a href="buenas-prácticas-de-programación.html#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> var1 = 101</span></code></pre></div>
<p>Si el valor esta fuera de los rangos permitidos, la variable se guarda en un formato mayor. <code>byte</code> a <code>int</code>, <code>int</code> a <code>long</code>, a <code>float</code> a <code>double</code>. En este caso un mensaje aparece.</p>
</div>
<div id="capture-preserve-y-restore" class="section level4 hasAnchor" number="2.3.5.4">
<h4><span class="header-section-number">2.3.5.4</span> capture, preserve y restore<a href="buenas-prácticas-de-programación.html#capture-preserve-y-restore" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Manejando errores: capture</p>
<ul>
<li>Sirve para evitar que Stata aborte cuando detecta un error.</li>
<li>Bueno para cuando quieres borrar algo que ya no se encuentra. Lo malo es que suprime todos los errores y oculta todo lo que puede ir mal.</li>
</ul>
<div class="sourceCode" id="cb36"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb36-1"><a href="buenas-prácticas-de-programación.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="kw">obs</span> 10</span>
<span id="cb36-2"><a href="buenas-prácticas-de-programación.html#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> <span class="kw">byte</span> var1 = 5</span>
<span id="cb36-3"><a href="buenas-prácticas-de-programación.html#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> <span class="kw">byte</span> var2 = 10 </span>
<span id="cb36-4"><a href="buenas-prácticas-de-programación.html#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="kw">capture</span> <span class="kw">drop</span> var1 var2 var3 </span>
<span id="cb36-5"><a href="buenas-prácticas-de-programación.html#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">describe</span> var1 var2</span></code></pre></div>
<p>Código crea <code>var1</code> y <code>var2</code>, luego las elimina incluyendo una variable que no existe. Al contrario de lo que se intuye, no se borran las variables, dado que hay una variable que no existe. La recomendación es siempre utilizar <code>capture</code> con moderación. Puede ser utilizado en bloque para así no tener que utilizarlo en cada linea.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb37-1"><a href="buenas-prácticas-de-programación.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto.dta, <span class="kw">clear</span></span>
<span id="cb37-2"><a href="buenas-prácticas-de-programación.html#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="kw">capture</span>{</span>
<span id="cb37-3"><a href="buenas-prácticas-de-programación.html#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> price mpg-trunk</span>
<span id="cb37-4"><a href="buenas-prácticas-de-programación.html#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> price mpg-<span class="kw">weight</span></span>
<span id="cb37-5"><a href="buenas-prácticas-de-programación.html#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> price mpg-foreign</span>
<span id="cb37-6"><a href="buenas-prácticas-de-programación.html#cb37-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-7"><a href="buenas-prácticas-de-programación.html#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="kw">ereturn</span> <span class="ot">list</span> </span></code></pre></div>
<p>preserve y restore</p>
<ul>
<li>Algunos comandos en Stata remplazan la base actual por una nueva (ej. <code>collapse</code> o <code>contract</code>).</li>
<li>Utilizar <code>preserve</code> y <code>restore</code> es útil en estos casos.</li>
<li>En caso de que queramos obtener estadística descriptiva agregada y asociarla a observaciones podemos utilizar estos comandos.</li>
</ul>
<div class="sourceCode" id="cb38"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb38-1"><a href="buenas-prácticas-de-programación.html#cb38-1" aria-hidden="true" tabindex="-1"></a>* Ejemplo con <span class="kw">collapse</span></span>
<span id="cb38-2"><a href="buenas-prácticas-de-programación.html#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto.dta, <span class="kw">clear</span></span>
<span id="cb38-3"><a href="buenas-prácticas-de-programación.html#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> lprice = <span class="fu">log</span>(price)</span>
<span id="cb38-4"><a href="buenas-prácticas-de-programación.html#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="kw">preserve</span></span>
<span id="cb38-5"><a href="buenas-prácticas-de-programación.html#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="kw">collapse</span> (<span class="fu">max</span>) max_lprice=lprice max_mpg=mpg <span class="co">///</span></span>
<span id="cb38-6"><a href="buenas-prácticas-de-programación.html#cb38-6" aria-hidden="true" tabindex="-1"></a>(<span class="fu">iqr</span>) iqr_lprince = lprice iqr_mpg = mpg <span class="kw">if</span> !<span class="fu">missing</span>(rep78), <span class="kw">by</span>(rep78) </span>
<span id="cb38-7"><a href="buenas-prácticas-de-programación.html#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="kw">sort</span> rep78 </span>
<span id="cb38-8"><a href="buenas-prácticas-de-programación.html#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="kw">tempfile</span> repstats</span>
<span id="cb38-9"><a href="buenas-prácticas-de-programación.html#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="kw">save</span> <span class="ot">`repstats&#39;</span></span>
<span id="cb38-10"><a href="buenas-prácticas-de-programación.html#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="kw">restore</span> </span>
<span id="cb38-11"><a href="buenas-prácticas-de-programación.html#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="kw">sort</span> rep78 </span>
<span id="cb38-12"><a href="buenas-prácticas-de-programación.html#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="kw">merge</span> <span class="fu">m</span>:1 rep78 <span class="kw">using</span> <span class="ot">`repstats&#39;</span></span>
<span id="cb38-13"><a href="buenas-prácticas-de-programación.html#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="kw">assert</span> <span class="dt">_merge</span> != 2</span>
<span id="cb38-14"><a href="buenas-prácticas-de-programación.html#cb38-14" aria-hidden="true" tabindex="-1"></a><span class="kw">summarize</span> lprice max_lprice max_mpg </span>
<span id="cb38-15"><a href="buenas-prácticas-de-programación.html#cb38-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-16"><a href="buenas-prácticas-de-programación.html#cb38-16" aria-hidden="true" tabindex="-1"></a>* Ejemplo con <span class="kw">contract</span></span>
<span id="cb38-17"><a href="buenas-prácticas-de-programación.html#cb38-17" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto.dta, <span class="kw">clear</span></span>
<span id="cb38-18"><a href="buenas-prácticas-de-programación.html#cb38-18" aria-hidden="true" tabindex="-1"></a><span class="kw">preserve</span></span>
<span id="cb38-19"><a href="buenas-prácticas-de-programación.html#cb38-19" aria-hidden="true" tabindex="-1"></a><span class="kw">contract</span> mpg, <span class="kw">cfreq</span>(cumfreq) <span class="kw">percent</span>(percentage) <span class="kw">cpercent</span>(cumpercent)</span>
<span id="cb38-20"><a href="buenas-prácticas-de-programación.html#cb38-20" aria-hidden="true" tabindex="-1"></a><span class="kw">sort</span> mpg </span>
<span id="cb38-21"><a href="buenas-prácticas-de-programación.html#cb38-21" aria-hidden="true" tabindex="-1"></a><span class="kw">tempfile</span> mpgfreq</span>
<span id="cb38-22"><a href="buenas-prácticas-de-programación.html#cb38-22" aria-hidden="true" tabindex="-1"></a><span class="kw">save</span> <span class="ot">`mpgfreq&#39;</span></span>
<span id="cb38-23"><a href="buenas-prácticas-de-programación.html#cb38-23" aria-hidden="true" tabindex="-1"></a><span class="kw">restore</span> </span>
<span id="cb38-24"><a href="buenas-prácticas-de-programación.html#cb38-24" aria-hidden="true" tabindex="-1"></a><span class="kw">sort</span> mpg</span>
<span id="cb38-25"><a href="buenas-prácticas-de-programación.html#cb38-25" aria-hidden="true" tabindex="-1"></a><span class="kw">merge</span> <span class="fu">m</span>:1 mpg <span class="kw">using</span> <span class="ot">`mpgfreq&#39;</span></span>
<span id="cb38-26"><a href="buenas-prácticas-de-programación.html#cb38-26" aria-hidden="true" tabindex="-1"></a><span class="kw">assert</span> <span class="dt">_merge</span> != 2</span>
<span id="cb38-27"><a href="buenas-prácticas-de-programación.html#cb38-27" aria-hidden="true" tabindex="-1"></a><span class="kw">summarize</span> _freq cumfreq percentage cumpercent</span></code></pre></div>
</div>
<div id="missing-values" class="section level4 hasAnchor" number="2.3.5.5">
<h4><span class="header-section-number">2.3.5.5</span> Missing values<a href="buenas-prácticas-de-programación.html#missing-values" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>En general uno utiliza <code>if variable !=.</code> para evitar incluir <strong>missings</strong>.</li>
<li>Mejor practica es <code>variable &lt;.</code> para excluir todos los valores en <em>missing</em>. Otra opción es <code>if !missing(variable)</code>.</li>
<li>Los <em>missing</em> están codificados internamente como valores mayores a cualquier número. El menor valor de todos los <em>missing</em> es el punto. Al utilizar <code>if variable &lt;.</code> es como decir, solo utiliza los números.</li>
<li>Como vimos en la Sección 3.1 hay muchos problemas al no tratar bien los <em>missings</em>. Este problema se incrementa al momento de trabajar con bases de datos imposibles de inspeccionar. Veremos algunas recomendaciones que pueden ser utiles para evitar estos errores.</li>
</ul>
<p>Los comandos tratan distinto a los missings</p>
<ul>
<li>Cualquier función de datos <em>missing</em> será <em>missing</em>.</li>
<li>Cuando se calcula un promedio o una desviación estándar solo valores no missing son considerados (ej. <code>sum</code>).<br />
</li>
<li>Algunos comandos en Stata manejan los <em>missing</em> de otras formas. Por ejemplo, las funciones <code>max</code>, <code>min</code> y las funciones para filas de <code>egen</code>: <code>rowmax()</code>, <code>rowmean()</code>, <code>rowmin()</code>, <code>rowsd()</code> y <code>rowtotal()</code> ignoran los <em>missing</em>. Por ejemplo, <code>rowmean(x1,x2,x3)</code> calcula el promedio de las variables y solo retornara <em>missing</em> si todas lo son.</li>
<li>Por ejemplo, <code>rowmean(x1,x2,x3)</code> calcula el promedio de las variables y solo retornara <em>missing</em> si todas lo son.</li>
<li><code>collapse (sum)</code> trata a los <em>missing</em> como ceros.</li>
</ul>
<p>Calcular un promedio con missings</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb39-1"><a href="buenas-prácticas-de-programación.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span></span>
<span id="cb39-2"><a href="buenas-prácticas-de-programación.html#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="kw">obs</span> 10 </span>
<span id="cb39-3"><a href="buenas-prácticas-de-programación.html#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> var1 = rnormal()</span>
<span id="cb39-4"><a href="buenas-prácticas-de-programación.html#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> var2 = 5 </span>
<span id="cb39-5"><a href="buenas-prácticas-de-programación.html#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> var3 = .</span>
<span id="cb39-6"><a href="buenas-prácticas-de-programación.html#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> promedio = (var1 + var2 + var3)/3</span>
<span id="cb39-7"><a href="buenas-prácticas-de-programación.html#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> promedio1 = <span class="fu">rowmean</span>(var1 var2 var3)</span></code></pre></div>
<p>PromedioSinMissing da como resultado <em>missings</em>. PromedioConMissing no considera <em>missings</em>. Es importante tratar de entender como funcionan los <code>missings</code> de los comandos que utilizas.</p>
<p>Generar variables considerando missings: Al crear una variable <em>dicotómica</em>, <code>gen</code> y <code>gen byte</code> tratan a los <em>missing</em> de formas distintas.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb40-1"><a href="buenas-prácticas-de-programación.html#cb40-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span> <span class="kw">N</span> = 500</span>
<span id="cb40-2"><a href="buenas-prácticas-de-programación.html#cb40-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> <span class="kw">obs</span> <span class="ot">`N&#39;</span></span>
<span id="cb40-3"><a href="buenas-prácticas-de-programación.html#cb40-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">gen</span> indicador = uniform() &lt; .5</span>
<span id="cb40-4"><a href="buenas-prácticas-de-programación.html#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">replace</span> indicador =. <span class="kw">if</span> <span class="fu">mod</span>(<span class="dt">_n</span>, 2) == 0</span>
<span id="cb40-5"><a href="buenas-prácticas-de-programación.html#cb40-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-6"><a href="buenas-prácticas-de-programación.html#cb40-6" aria-hidden="true" tabindex="-1"></a>    * Si indicador es <span class="fu">missing</span>, <span class="kw">variable</span> sera <span class="fu">missing</span></span>
<span id="cb40-7"><a href="buenas-prácticas-de-programación.html#cb40-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">gen</span> variable_primercaso = 1 <span class="kw">if</span> indicador == 1 </span>
<span id="cb40-8"><a href="buenas-prácticas-de-programación.html#cb40-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">replace</span> variable_primercaso = 0 <span class="kw">if</span> indicador == 0</span>
<span id="cb40-9"><a href="buenas-prácticas-de-programación.html#cb40-9" aria-hidden="true" tabindex="-1"></a>    * Si indicador es <span class="fu">missing</span>, <span class="kw">variable</span> sera cero. </span>
<span id="cb40-10"><a href="buenas-prácticas-de-programación.html#cb40-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">gen</span> variable_segundocaso=(indicador==1)</span>
<span id="cb40-11"><a href="buenas-prácticas-de-programación.html#cb40-11" aria-hidden="true" tabindex="-1"></a>    \<span class="kw">end</span>{minted}</span>
<span id="cb40-12"><a href="buenas-prácticas-de-programación.html#cb40-12" aria-hidden="true" tabindex="-1"></a>    \<span class="kw">end</span>{itemize}</span></code></pre></div>
<p><code>sum()</code> considera <em>missing</em> como ceros.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb41-1"><a href="buenas-prácticas-de-programación.html#cb41-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">clear</span> <span class="ot">all</span> </span>
<span id="cb41-2"><a href="buenas-prácticas-de-programación.html#cb41-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> <span class="kw">obs</span> 4 </span>
<span id="cb41-3"><a href="buenas-prácticas-de-programación.html#cb41-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">generate</span> <span class="kw">byte</span> var1 = <span class="fu">cond</span>(<span class="fu">mod</span>(<span class="dt">_n</span>,2)==1, 1, .)</span>
<span id="cb41-4"><a href="buenas-prácticas-de-programación.html#cb41-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">generate</span> <span class="kw">byte</span> var1sum = <span class="kw">sum</span>(var1)</span>
<span id="cb41-5"><a href="buenas-prácticas-de-programación.html#cb41-5" aria-hidden="true" tabindex="-1"></a>    <span class="ot">list</span>, <span class="kw">noobs</span></span></code></pre></div>
<p><code>max()</code> trata a los <em>missing</em> como si no estuviesen allí.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb42-1"><a href="buenas-prácticas-de-programación.html#cb42-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">display</span> <span class="fu">max</span>(-5,.)</span></code></pre></div>
<p>tabmiss, mvdecode y mvencode</p>
<ul>
<li>En ocasiones los <em>missing</em> difieren en notación (ej. al importar datos de otro paquete). Siempre que trabajes con una base de datos nueva es importante recodificar. Notar que no todos tienen que ir a un punto. Todo depende del origen de los <em>missing</em>.</li>
<li><code>mvdecode</code> y <code>mvencode</code> pueden ser útiles en este tipo de casos.</li>
<li><code>mvdecode</code> permite recodificar valores numéricos como <em>missing</em>. Útil cuando valores son representados como -99, -999.</li>
<li><code>mvencode</code> hace lo inverso. Mapea <em>missing</em> como numéricos.</li>
<li>El comando <code>tabmiss</code> inspecciona todas las variables de una base de datos y reporta los <code>missing</code> totales y como fracción del total de observaciones.</li>
</ul>
<div class="sourceCode" id="cb43"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb43-1"><a href="buenas-prácticas-de-programación.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span> <span class="ot">all</span> </span>
<span id="cb43-2"><a href="buenas-prácticas-de-programación.html#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="dv">seed</span> 1234</span>
<span id="cb43-3"><a href="buenas-prácticas-de-programación.html#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="kw">N</span> = 50</span>
<span id="cb43-4"><a href="buenas-prácticas-de-programación.html#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="kw">obs</span> <span class="ot">`N&#39;</span></span>
<span id="cb43-5"><a href="buenas-prácticas-de-programación.html#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> income = <span class="fu">abs</span>(<span class="kw">int</span>(rnormal(0,5)))</span>
<span id="cb43-6"><a href="buenas-prácticas-de-programación.html#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="kw">assert</span> income &gt;= 0</span>
<span id="cb43-7"><a href="buenas-prácticas-de-programación.html#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> income =. <span class="kw">if</span> <span class="fu">mod</span>(<span class="dt">_n</span>, 2) == 0</span>
<span id="cb43-8"><a href="buenas-prácticas-de-programación.html#cb43-8" aria-hidden="true" tabindex="-1"></a>* Para ver los <span class="fu">missing</span> en variables</span>
<span id="cb43-9"><a href="buenas-prácticas-de-programación.html#cb43-9" aria-hidden="true" tabindex="-1"></a>tabmiss </span>
<span id="cb43-10"><a href="buenas-prácticas-de-programación.html#cb43-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-11"><a href="buenas-prácticas-de-programación.html#cb43-11" aria-hidden="true" tabindex="-1"></a>* Transformar un valor númerico a <span class="fu">missing</span></span>
<span id="cb43-12"><a href="buenas-prácticas-de-programación.html#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="kw">mvdecode</span> income, mv(2)</span>
<span id="cb43-13"><a href="buenas-prácticas-de-programación.html#cb43-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-14"><a href="buenas-prácticas-de-programación.html#cb43-14" aria-hidden="true" tabindex="-1"></a>* Transformar varios valores númericos a <span class="fu">missing</span>.</span>
<span id="cb43-15"><a href="buenas-prácticas-de-programación.html#cb43-15" aria-hidden="true" tabindex="-1"></a><span class="kw">mvdecode</span> income, mv(2 5)</span>
<span id="cb43-16"><a href="buenas-prácticas-de-programación.html#cb43-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-17"><a href="buenas-prácticas-de-programación.html#cb43-17" aria-hidden="true" tabindex="-1"></a>* Transformar varios a <span class="fu">missing</span>, pero identific ́andolos.</span>
<span id="cb43-18"><a href="buenas-prácticas-de-programación.html#cb43-18" aria-hidden="true" tabindex="-1"></a><span class="kw">mvdecode</span> income, mv(3 = .a \ 6 = .b)</span>
<span id="cb43-19"><a href="buenas-prácticas-de-programación.html#cb43-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-20"><a href="buenas-prácticas-de-programación.html#cb43-20" aria-hidden="true" tabindex="-1"></a>* Missings se cambian <span class="kw">de</span> vuelta a su valor original.</span>
<span id="cb43-21"><a href="buenas-prácticas-de-programación.html#cb43-21" aria-hidden="true" tabindex="-1"></a><span class="kw">mvencode</span> income, mv(.a = 3 \ .b = 6)</span></code></pre></div>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.3.2: </b></p>
<p>Instrucciones</p>
<p>Abrir <code>ejercicios-clase3.do</code> y ejecute las líneas correspondientes al ejercicio 2.</p>
<p>Pregunta</p>
<p>Compare las opciones 1, 2 y 3 en relación a como tratan los <em>missing</em>. Explique las diferencias entre cada una de estas opciones.</p>
</div>
<p>generate, replace y missing: Sólo unas pequeños detalles.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb44-1"><a href="buenas-prácticas-de-programación.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span> </span>
<span id="cb44-2"><a href="buenas-prácticas-de-programación.html#cb44-2" aria-hidden="true" tabindex="-1"></a>cd <span class="st">&quot;$ejercicio3&quot;</span></span>
<span id="cb44-3"><a href="buenas-prácticas-de-programación.html#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> census2c, <span class="kw">clear</span></span>
<span id="cb44-4"><a href="buenas-prácticas-de-programación.html#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="buenas-prácticas-de-programación.html#cb44-5" aria-hidden="true" tabindex="-1"></a>* Opción 1</span>
<span id="cb44-6"><a href="buenas-prácticas-de-programación.html#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> smallpop_o1 = 1 <span class="kw">if</span> pop&lt;=5000</span>
<span id="cb44-7"><a href="buenas-prácticas-de-programación.html#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> smallpop_o1 = 0 <span class="kw">if</span> pop&gt;5000</span>
<span id="cb44-8"><a href="buenas-prácticas-de-programación.html#cb44-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-9"><a href="buenas-prácticas-de-programación.html#cb44-9" aria-hidden="true" tabindex="-1"></a>* Opción 2</span>
<span id="cb44-10"><a href="buenas-prácticas-de-programación.html#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> smallpop_o2 = (pop &lt;= 5000) </span>
<span id="cb44-11"><a href="buenas-prácticas-de-programación.html#cb44-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-12"><a href="buenas-prácticas-de-programación.html#cb44-12" aria-hidden="true" tabindex="-1"></a>* Opcion 3</span>
<span id="cb44-13"><a href="buenas-prácticas-de-programación.html#cb44-13" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> smallpop_o3 = (pop &lt;= 5000) <span class="kw">if</span> !<span class="fu">missing</span>(pop)</span></code></pre></div>
<p>Opción 1 es la típica. Ojo no esta considerando <em>missing</em>. Es necesario agregar <code>&amp; !missing(pop)</code>. Escrito de esta forma, si <code>pop</code> es <em>missing</em>, <code>smallpop</code> será <em>cero</em>. Opción 2 es más simple, pero si cualquier valor de <code>pop</code> es <em>missing</em> será evaluado como un cero también. La razón es que los <em>missing</em> en Stata son considerados como números muy grandes para el programa. La Opción 3 soluciona el problema.</p>
</div>
<div id="string-a-numeric-y-al-revés" class="section level4 hasAnchor" number="2.3.5.6">
<h4><span class="header-section-number">2.3.5.6</span> String a numeric y al revés<a href="buenas-prácticas-de-programación.html#string-a-numeric-y-al-revés" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>De string a numeric</p>
<ul>
<li>Si las variables han sido mal clasificadas como <em>string</em> puedes utilizar la función <code>real()</code>.</li>
<li>Por ejemplo: <code>generate idpaciente = real(pacienteid)</code>.</li>
<li>El comando anterior genera <em>missing</em> para todas las observaciones que no puedan ser interpretadas como numéricas.</li>
<li>Mucho mejor es utilizar <code>destring, replace</code>.</li>
<li>Otro caso usual es que tenemos datos en formato <code>string</code> y queremos que tengan un equivalente. El comando <code>encode</code>. No es aconsejable utilizar este comando para valores numéricos guardados como <em>string</em>.</li>
</ul>
<p>De numeric a string</p>
<ul>
<li>Hay veces en las que se quiere generar un equivalente <em>string</em> a valores numéricos.</li>
<li>Tres comandos: <code>string()</code> , <code>tostring()</code> y <code>decode()</code>.</li>
<li>Un ejemplo es querer mantener los 0 que estan al inicio de un código ID.</li>
<li>El comando <code>tostring zip, format(\%05.0f) generate(idstring)</code> genera un <em>string</em> de cinco digitos con los ceros al inicio.</li>
<li><code>decode()</code> sirve para un caso en que tengas un id en numérico, pero que no la tengas en <em>string</em>.</li>
</ul>
<p>Strings entre comillas: importa poner las comillas bien.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb45-1"><a href="buenas-prácticas-de-programación.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;Este es un string normal&quot;</span></span>
<span id="cb45-2"><a href="buenas-prácticas-de-programación.html#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="buenas-prácticas-de-programación.html#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;Este no es un string con &quot;</span>comillas<span class="st">&quot; &quot;</span></span>
<span id="cb45-4"><a href="buenas-prácticas-de-programación.html#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="buenas-prácticas-de-programación.html#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">`&quot;</span>Este si es un <span class="fu">string</span> con <span class="st">&quot;comillas&quot;&quot;&#39;</span></span></code></pre></div>
</div>
<div id="funciones-para-generar-variables" class="section level4 hasAnchor" number="2.3.5.7">
<h4><span class="header-section-number">2.3.5.7</span> Funciones para generar variables<a href="buenas-prácticas-de-programación.html#funciones-para-generar-variables" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>generate y replace: función <code>cond()</code></p>
<ul>
<li>Si quiero que un resultado sea “a” si una <em>condición es verdadera</em> y “b” si es <em>falsa</em>.</li>
<li>La función <code>cond(x,a,b)</code> posee esta capacidad sin la necesidad de utilizar <code>if</code>.</li>
</ul>
<div class="sourceCode" id="cb46"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb46-1"><a href="buenas-prácticas-de-programación.html#cb46-1" aria-hidden="true" tabindex="-1"></a>* Útil para construir una tabla</span>
<span id="cb46-2"><a href="buenas-prácticas-de-programación.html#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> netmarr2x = <span class="fu">cond</span>(marr/divr &gt; 2, 1, 2) </span>
<span id="cb46-3"><a href="buenas-prácticas-de-programación.html#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="kw">label</span> <span class="kw">define</span> netmarr2xc 1 <span class="st">&quot;marr &gt; 2 divr&quot;</span> 2 <span class="st">&quot;marr &lt;= 2 divr&quot;</span> </span>
<span id="cb46-4"><a href="buenas-prácticas-de-programación.html#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="kw">label</span> <span class="kw">values</span> netmarr2x netmarr2xc </span>
<span id="cb46-5"><a href="buenas-prácticas-de-programación.html#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="kw">tabstat</span> pop medage, <span class="kw">by</span>(netmarr2x) </span></code></pre></div>
<p>Las observaciones en Stata estás numeradas desde el 1. <code>_N</code> es el mayor número de observaciones, mientras que el actual es <code>_n</code>. <code>sort</code> (ascendete) y <code>gsort</code> (ascendete o descendente) alteran el orden de las observaciones. Como recomendación eviten generar variables o condiciones que dependan de la posición especifica de una observación.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb47-1"><a href="buenas-prácticas-de-programación.html#cb47-1" aria-hidden="true" tabindex="-1"></a>* Ejemplo 1: uso <span class="kw">de</span> <span class="kw">gsort</span></span>
<span id="cb47-2"><a href="buenas-prácticas-de-programación.html#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="kw">gsort</span> region -pop </span>
<span id="cb47-3"><a href="buenas-prácticas-de-programación.html#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="kw">by</span> region: <span class="kw">generate</span> totpop = <span class="kw">sum</span>(pop)</span>
<span id="cb47-4"><a href="buenas-prácticas-de-programación.html#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="buenas-prácticas-de-programación.html#cb47-5" aria-hidden="true" tabindex="-1"></a>* Ejemplo 2: uso <span class="kw">de</span> <span class="dt">_n</span> <span class="fu">y</span> _N</span>
<span id="cb47-6"><a href="buenas-prácticas-de-programación.html#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="kw">by</span> region: <span class="ot">list</span> region totpop <span class="kw">if</span> <span class="dt">_n</span> == _N</span>
<span id="cb47-7"><a href="buenas-prácticas-de-programación.html#cb47-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-8"><a href="buenas-prácticas-de-programación.html#cb47-8" aria-hidden="true" tabindex="-1"></a>* Ejemplo 3: <span class="kw">sort</span></span>
<span id="cb47-9"><a href="buenas-prácticas-de-programación.html#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> largepop = 0</span>
<span id="cb47-10"><a href="buenas-prácticas-de-programación.html#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> largepop = 1 <span class="kw">if</span> pop &gt; 5000 &amp; !<span class="fu">missing</span>(pop)</span>
<span id="cb47-11"><a href="buenas-prácticas-de-programación.html#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> smallpop = (pop &lt;= 5000) <span class="kw">if</span> !<span class="fu">missing</span>(pop)</span>
<span id="cb47-12"><a href="buenas-prácticas-de-programación.html#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> popsize = smallpop + 2*largepop</span>
<span id="cb47-13"><a href="buenas-prácticas-de-programación.html#cb47-13" aria-hidden="true" tabindex="-1"></a><span class="kw">label</span> <span class="kw">variable</span> popsize <span class="st">&quot;Population size code&quot;</span></span>
<span id="cb47-14"><a href="buenas-prácticas-de-programación.html#cb47-14" aria-hidden="true" tabindex="-1"></a><span class="kw">label</span> <span class="kw">define</span> popsize 1  <span class="st">&quot;&lt;= 5 million&quot;</span> 2 <span class="st">&quot;&gt; 5 million&quot;</span>, modify</span>
<span id="cb47-15"><a href="buenas-prácticas-de-programación.html#cb47-15" aria-hidden="true" tabindex="-1"></a><span class="kw">label</span> <span class="kw">values</span> popsize popsize </span>
<span id="cb47-16"><a href="buenas-prácticas-de-programación.html#cb47-16" aria-hidden="true" tabindex="-1"></a><span class="kw">bysort</span> region popsize: <span class="kw">egen</span> meanpop2 = <span class="kw">mean</span>(pop) </span></code></pre></div>
<p><code>recode</code> para variables discretas: <code>recode</code> crea una nueva variable basada en otra variable.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb48-1"><a href="buenas-prácticas-de-programación.html#cb48-1" aria-hidden="true" tabindex="-1"></a>* Esta no es una buena opción </span>
<span id="cb48-2"><a href="buenas-prácticas-de-programación.html#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> newcode = 5 <span class="kw">if</span> oldcode == 2 </span>
<span id="cb48-3"><a href="buenas-prácticas-de-programación.html#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> newcode = 8 <span class="kw">if</span> oldcode == 3 </span>
<span id="cb48-4"><a href="buenas-prácticas-de-programación.html#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> newcode = 12 <span class="kw">if</span> <span class="fu">inlist</span>(oldcode, 5, 6, 7)</span>
<span id="cb48-5"><a href="buenas-prácticas-de-programación.html#cb48-5" aria-hidden="true" tabindex="-1"></a>* Esta si es una buena opción </span>
<span id="cb48-6"><a href="buenas-prácticas-de-programación.html#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="kw">recode</span> oldcode (2 = 5) (3 = 8) (5/7 = 12), <span class="kw">gen</span>(newcode) </span></code></pre></div>
<p>El signo (<span class="math inline">\(=\)</span>) es para indicar valor antiguo a valor nuevo. No es necesario aplicarlo linea por linea. <code>recode</code> produce <strong>un código más eficiente</strong>.</p>
<p><code>recode</code> para variables continuas: <code>recode(x,x1,x2,x3,x4,xn)</code> para variables continuas de forma tal de generar intervalos tal que <span class="math inline">\(x \leq x_1 ; x_1 \leq x \leq x_2\)</span> y así sucesivamente. Los resultados son iguales a los límites creados.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb49-1"><a href="buenas-prácticas-de-programación.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> census2c, <span class="kw">clear</span></span>
<span id="cb49-2"><a href="buenas-prácticas-de-programación.html#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> breaks = <span class="kw">recode</span>(medage, 29, 30, 31, 32, 33)</span></code></pre></div>
<p>Otros comandos que cumplen una función parecida son <code>floor</code> y <code>ceil()</code>. Ambos sirven para generar un valor entero. El primero para redondear hacia abajo y el otro hacia arriba. <code>floor(x)</code> retorna el entero <span class="math inline">\(n\)</span> tal que <span class="math inline">\(n \leq x &lt; n + 1\)</span> mientras que <code>ceil(x)</code> es tal que <span class="math inline">\(n - 1 &lt; x \leq n\)</span>.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb50-1"><a href="buenas-prácticas-de-programación.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> census2c, <span class="kw">clear</span></span>
<span id="cb50-2"><a href="buenas-prácticas-de-programación.html#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> popurbfloor = <span class="fu">floor</span>(popurb)</span>
<span id="cb50-3"><a href="buenas-prácticas-de-programación.html#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> popurbceil = <span class="fu">ceil</span>(popurb)</span></code></pre></div>
<p><code>irecode</code> para variables continuas: <code>irecode(x,x1,x2,x3,x4,x_n)</code> es una alternativa para categorizar grupos también. Por ejemplo:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb51-1"><a href="buenas-prácticas-de-programación.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> <span class="kw">size</span> = <span class="fu">irecode</span>(pop, 1000, 4000, 8000, 20000)</span>
<span id="cb51-2"><a href="buenas-prácticas-de-programación.html#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="kw">label</span> <span class="kw">define</span> popsize 0 <span class="st">&quot;&lt;1m&quot;</span> 1 <span class="st">&quot;1-4m&quot;</span> 2 <span class="st">&quot;4-8m&quot;</span> 3 <span class="st">&quot;&gt;8m&quot;</span> </span>
<span id="cb51-3"><a href="buenas-prácticas-de-programación.html#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="kw">label</span> <span class="kw">values</span> <span class="kw">size</span> popsize</span>
<span id="cb51-4"><a href="buenas-prácticas-de-programación.html#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="kw">tabstat</span> pop, stat(<span class="kw">mean</span> <span class="fu">min</span> <span class="fu">max</span>) <span class="kw">by</span>(<span class="kw">size</span>)</span></code></pre></div>
<p>Categorizara cada grupo según el intervalo en el que este. <strong>Parte del cero!</strong>. $x x_1 $, <span class="math inline">\(x_1 \leq x \leq x_2 \rightarrow 1\)</span> y así sucesivamente.</p>
<p>Crear cuartiles con <code>xtile</code>: Con <code>xtile</code> podemos querer clasificar las variables según cuantiles (quintiles, deciles, cuartiles, etc).</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb52-1"><a href="buenas-prácticas-de-programación.html#cb52-1" aria-hidden="true" tabindex="-1"></a>* Creamos cuartiles para población </span>
<span id="cb52-2"><a href="buenas-prácticas-de-programación.html#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="kw">xtile</span> popcuart = pop , nq(4)</span>
<span id="cb52-3"><a href="buenas-prácticas-de-programación.html#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="kw">tabstat</span> pop, stat(n <span class="kw">mean</span> <span class="fu">min</span> <span class="fu">max</span>) <span class="kw">by</span>(popcuart)</span></code></pre></div>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.3.3:</b></p>
<p>Instrucciones</p>
<ol style="list-style-type: decimal">
<li>Cargar la base <code>auto.dta</code></li>
</ol>
<p>Pregunta</p>
<ol style="list-style-type: decimal">
<li>Genere una variable que sirva para redondear hacia abajo la variable <code>mpg</code> en en múltiplos de 5, de modo que cualquier valor de 10 a 14 se redondee a 10, cualquier valor de 15 a 19 a 15 y así sucesivamente.</li>
</ol>
</div>
</div>
<div id="funciones-de-egen" class="section level4 hasAnchor" number="2.3.5.8">
<h4><span class="header-section-number">2.3.5.8</span> Funciones de egen<a href="buenas-prácticas-de-programación.html#funciones-de-egen" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Todos y todas conocemos algunas de las típicas funciones de <code>egen</code>.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb53-1"><a href="buenas-prácticas-de-programación.html#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span> </span>
<span id="cb53-2"><a href="buenas-prácticas-de-programación.html#cb53-2" aria-hidden="true" tabindex="-1"></a>* Ejemplo del uso <span class="kw">de</span> <span class="kw">egen</span></span>
<span id="cb53-3"><a href="buenas-prácticas-de-programación.html#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> <span class="kw">size</span> = <span class="fu">irecode</span>(pop, 1000, 4000, 8000, 20000)</span>
<span id="cb53-4"><a href="buenas-prácticas-de-programación.html#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="kw">label</span> <span class="kw">define</span> popsize 0 <span class="st">&quot;&lt;1m&quot;</span> 1 <span class="st">&quot;1-4m&quot;</span> 2 <span class="st">&quot;4-8m&quot;</span> 3 <span class="st">&quot;&gt;8m&quot;</span> </span>
<span id="cb53-5"><a href="buenas-prácticas-de-programación.html#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="kw">label</span> <span class="kw">values</span> <span class="kw">size</span> popsize</span>
<span id="cb53-6"><a href="buenas-prácticas-de-programación.html#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="kw">bysort</span> <span class="kw">size</span>: <span class="kw">egen</span> avgpop = <span class="kw">mean</span>(pop)</span>
<span id="cb53-7"><a href="buenas-prácticas-de-programación.html#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> popratio = 100 * pop / avgpop </span>
<span id="cb53-8"><a href="buenas-prácticas-de-programación.html#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="kw">format</span> popratio \%7.2f</span>
<span id="cb53-9"><a href="buenas-prácticas-de-programación.html#cb53-9" aria-hidden="true" tabindex="-1"></a><span class="ot">list</span> state pop avgpop popratio <span class="kw">if</span> <span class="kw">size</span> == 0 </span></code></pre></div>
<p>Otras funciones son <code>iqr()</code>, <code>kurt()</code>,<code>mad()</code>, <code>mdev()</code>, <code>median()</code>, <code>mode()</code>, <code>pc()</code>, <code>pctile()</code>, <code>rank()</code>, <code>sd()</code>, <code>skwe()</code>, <code>std()</code>.</p>
<p>egenmore</p>
<ul>
<li>Menos conocida es la colección de funciones adicionales de <code>egen</code> hechas por <a href="https://www.durham.ac.uk/staff/n-j-cox/">Nicholas J. Cox.</a></li>
<li>Estas funciones están contenidas en el comando <code>egenmore</code>.</li>
<li><code>bom()</code> y <code>eom()</code> crean variables de fechas que corresponde al primer y último día de un mes determinado.</li>
<li><code>corr()</code> calcula correlaciones y covarianzas mientras que <code>var()</code> calcular la varianza.</li>
<li><code>semean()</code> calcula la desviación estándar del error de una media.</li>
<li><code>record()</code> permite calcular el valor más alto o más bajo de una serie.</li>
</ul>
<div class="sourceCode" id="cb54"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb54-1"><a href="buenas-prácticas-de-programación.html#cb54-1" aria-hidden="true" tabindex="-1"></a>* Ejemplo 1: Generar <span class="kw">variable</span> que tenga la primera palabra <span class="kw">de</span> una frase (wordof)</span>
<span id="cb54-2"><a href="buenas-prácticas-de-programación.html#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> firstword = wordof(make),  <span class="fu">word</span>(1)</span>
<span id="cb54-3"><a href="buenas-prácticas-de-programación.html#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="ot">list</span> firstword make <span class="kw">in</span>  1/15</span>
<span id="cb54-4"><a href="buenas-prácticas-de-programación.html#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="buenas-prácticas-de-programación.html#cb54-5" aria-hidden="true" tabindex="-1"></a>* Ejemplo 2: Para generar automáticamente valores extremos (outside, 1,5 RIQ)</span>
<span id="cb54-6"><a href="buenas-prácticas-de-programación.html#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span>    extrmpg = outside(mpg)</span>
<span id="cb54-7"><a href="buenas-prácticas-de-programación.html#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="kw">tab</span> extrmpg,    <span class="fu">missing</span></span></code></pre></div>
<p><code>rall()</code> y <code>rany()</code> son útiles para el análisis de datos. Evaluan una condición y genera un indicador si todas o alguna observación la cumple.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb55-1"><a href="buenas-prácticas-de-programación.html#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="kw">obs</span> 12</span>
<span id="cb55-2"><a href="buenas-prácticas-de-programación.html#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> a = 1 <span class="kw">in</span> 1 </span>
<span id="cb55-3"><a href="buenas-prácticas-de-programación.html#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> b = 2 <span class="kw">in</span> 2/4</span>
<span id="cb55-4"><a href="buenas-prácticas-de-programación.html#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> c  = -3  <span class="kw">in</span> 5/7</span>
<span id="cb55-5"><a href="buenas-prácticas-de-programación.html#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> <span class="kw">d</span> = 4  <span class="kw">in</span> 8/10</span>
<span id="cb55-6"><a href="buenas-prácticas-de-programación.html#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> <span class="fu">e</span> = . <span class="kw">in</span> 11/12</span>
<span id="cb55-7"><a href="buenas-prácticas-de-programación.html#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> any = rany(a b c <span class="kw">d</span> <span class="fu">e</span>) , c(@ &gt; 0 &amp; !<span class="fu">missing</span>(@))</span>
<span id="cb55-8"><a href="buenas-prácticas-de-programación.html#cb55-8" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> <span class="ot">all</span> = rall(a b c <span class="kw">d</span> <span class="fu">e</span>) , c(@ &gt; 0 &amp; !<span class="fu">missing</span>(@)) </span></code></pre></div>
</div>
</div>
<div id="macros-locales-y-globales" class="section level3 hasAnchor" number="2.3.6">
<h3><span class="header-section-number">2.3.6</span> Macros locales y globales<a href="buenas-prácticas-de-programación.html#macros-locales-y-globales" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="nombrar-macros" class="section level4 hasAnchor" number="2.3.6.1">
<h4><span class="header-section-number">2.3.6.1</span> Nombrar macros<a href="buenas-prácticas-de-programación.html#nombrar-macros" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>Una macro es un <strong>contenedor</strong> que puede almacenar números o nombres de variables.</li>
<li>Puede ser <code>local</code> o <code>global</code>. La primera es temporal, la segunda no.<br />
</li>
<li>Un ejemplo de variable local es:</li>
</ul>
<div class="sourceCode" id="cb56"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb56-1"><a href="buenas-prácticas-de-programación.html#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> NivelEstres Nada Medio Moderado Severo </span>
<span id="cb56-2"><a href="buenas-prácticas-de-programación.html#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;Los niveles de estrés son: `NivelEstres&#39;&quot;</span></span></code></pre></div>
<p>El primer comando define la macro y sus valores. Para llamar a la macro hay que utilizar las comillas (“). <code>local nombre texto</code> <span class="math inline">\(\rightarrow\)</span> <code>local nombre = text</code> <span class="math inline">\(\rightarrow\)</span> <code>local nombre = "text"</code>.</p>
<p>Ojo con las rutas:</p>
<ul>
<li>En ocasiones voy a querer utilizar una macro dentro de la ruta de una carpeta.</li>
<li>Es importante utilizar siempre <code>/</code> o bien <code>\\</code>. De otra forma no lo reconocerá.</li>
</ul>
<div class="sourceCode" id="cb57"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb57-1"><a href="buenas-prácticas-de-programación.html#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> filename base.dta </span>
<span id="cb57-2"><a href="buenas-prácticas-de-programación.html#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="st">&quot;H:\ECStata\`filename&#39;&quot;</span></span>
<span id="cb57-3"><a href="buenas-prácticas-de-programación.html#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="fu">r</span>(601);</span>
<span id="cb57-4"><a href="buenas-prácticas-de-programación.html#cb57-4" aria-hidden="true" tabindex="-1"></a>* Para corregir <span class="fu">el</span> <span class="kw">error</span>, dos caminos: </span>
<span id="cb57-5"><a href="buenas-prácticas-de-programación.html#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="st">&quot;H:\ECStata</span><span class="ch">\\</span><span class="st">`filename&#39;&quot;</span> </span>
<span id="cb57-6"><a href="buenas-prácticas-de-programación.html#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="st">&quot;H:/ECStata/`filename&#39;&quot;</span></span></code></pre></div>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.3.4:</b> Compare los siguientes comandos y comente las diferencias:</p>
<ul>
<li><code>display "Dos mas dos = 2 + 2"</code></li>
<li><code>display "Dos mas dos</code>= 2 + 2’“`</li>
</ul>
</div>
<p>Ojo con el signo igual: Algunas veces es bueno colocar un signo <span class="math inline">\(=\)</span> al definir macros. Por ejemplo, cuando redefinimos variables.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb58-1"><a href="buenas-prácticas-de-programación.html#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> contador 0</span>
<span id="cb58-2"><a href="buenas-prácticas-de-programación.html#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> NivelEstres Nada Medio Moderado Severo </span>
<span id="cb58-3"><a href="buenas-prácticas-de-programación.html#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> a <span class="kw">of</span> <span class="kw">local</span> NivelEstres { </span>
<span id="cb58-4"><a href="buenas-prácticas-de-programación.html#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> contador = <span class="ot">`contador&#39;</span> + 1 </span>
<span id="cb58-5"><a href="buenas-prácticas-de-programación.html#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;Nivel de Estres `contador&#39; : `a&#39;&quot;</span></span>
<span id="cb58-6"><a href="buenas-prácticas-de-programación.html#cb58-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>La primera parte sirve para definir la <code>macro</code> mientras que la segunda sirve para dar cuenta de su valor actual. Al actualizar, ocupen igual.</p>
<p>Sin signo igual: En algunas ocasiones queremos escribir una <code>macro</code> dentro de un <em>loop</em>. En estos casos es conveniente evitar el signo igual.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb59-1"><a href="buenas-prácticas-de-programación.html#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> contador 0</span>
<span id="cb59-2"><a href="buenas-prácticas-de-programación.html#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> NivelEstres Nada Medio Moderado Severo </span>
<span id="cb59-3"><a href="buenas-prácticas-de-programación.html#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> a <span class="kw">of</span> <span class="kw">local</span> NivelEstres {</span>
<span id="cb59-4"><a href="buenas-prácticas-de-programación.html#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> contador = <span class="ot">`contador&#39;</span> + 1 </span>
<span id="cb59-5"><a href="buenas-prácticas-de-programación.html#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> nuevalista <span class="ot">`nuevalista&#39;</span> <span class="ot">`contador&#39;</span> &#39;a&#39; </span>
<span id="cb59-6"><a href="buenas-prácticas-de-programación.html#cb59-6" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb59-7"><a href="buenas-prácticas-de-programación.html#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;`nuevalista&#39;&quot;</span> </span></code></pre></div>
<p>El <code>local nuevalista</code> define una macro como <em>string</em> que posee su propio contenido, el valor de contar y el valor del iterador.</p>
</div>
<div id="generar-variables-contadores-y-condiciones-con-macros" class="section level4 hasAnchor" number="2.3.6.2">
<h4><span class="header-section-number">2.3.6.2</span> Generar variables, contadores y condiciones con macros<a href="buenas-prácticas-de-programación.html#generar-variables-contadores-y-condiciones-con-macros" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Podemos utilizar macros para renombrar variables.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb60-1"><a href="buenas-prácticas-de-programación.html#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span> </span>
<span id="cb60-2"><a href="buenas-prácticas-de-programación.html#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> a = 10/20{ </span>
<span id="cb60-3"><a href="buenas-prácticas-de-programación.html#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> v<span class="ot">`a&#39;</span> = rnormal()</span>
<span id="cb60-4"><a href="buenas-prácticas-de-programación.html#cb60-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb60-5"><a href="buenas-prácticas-de-programación.html#cb60-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-6"><a href="buenas-prácticas-de-programación.html#cb60-6" aria-hidden="true" tabindex="-1"></a>* Renombramos variables </span>
<span id="cb60-7"><a href="buenas-prácticas-de-programación.html#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> i = 11/15 { </span>
<span id="cb60-8"><a href="buenas-prácticas-de-programación.html#cb60-8" aria-hidden="true" tabindex="-1"></a><span class="kw">rename</span> v<span class="ot">`i&#39;</span> x<span class="ot">`=1960 + `i&#39;</span>&#39;</span>
<span id="cb60-9"><a href="buenas-prácticas-de-programación.html#cb60-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>En este fragmento de código, Stata evalúa la expresión <code>1960 + 'i'</code> antes de evaluar la macro externa. Por ejemplo, cuando pase por el iterador <code>i = 11</code>, el nuevo nombre de la variable será <code>x1971</code>.</p>
<p>Resumir condiciones: Podemos utilizar macros para resumir condiciones. Esto es útil para estimar modelos o generar estadística descriptiva.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb61-1"><a href="buenas-prácticas-de-programación.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span> </span>
<span id="cb61-2"><a href="buenas-prácticas-de-programación.html#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto </span>
<span id="cb61-3"><a href="buenas-prácticas-de-programación.html#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="fu">cond</span> <span class="st">&quot;if foreign==0&quot;</span></span>
<span id="cb61-4"><a href="buenas-prácticas-de-programación.html#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="kw">varlist</span> <span class="st">&quot;mpg rep78 trunk weight turn&quot;</span></span>
<span id="cb61-5"><a href="buenas-prácticas-de-programación.html#cb61-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-6"><a href="buenas-prácticas-de-programación.html#cb61-6" aria-hidden="true" tabindex="-1"></a>* Estimar la regresión considerando la condicíòn</span>
<span id="cb61-7"><a href="buenas-prácticas-de-programación.html#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> price <span class="ot">`varlist&#39;</span> <span class="ot">`cond&#39;</span></span></code></pre></div>
<p>Agrupar en base a una condición: Imaginemos que ahora queremos estimar una regresión para todas las compañías de auto que empiezan empiezan con B.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb62-1"><a href="buenas-prácticas-de-programación.html#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> autoname B </span>
<span id="cb62-2"><a href="buenas-prácticas-de-programación.html#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> price mpg <span class="kw">weight</span> <span class="kw">if</span> <span class="fu">substr</span>(make,1,1)==<span class="st">&quot;`autoname&#39;&quot;</span></span></code></pre></div>
<p>La mejor manera de pensar en esto es hacer lo que hace Stata: reemplazar <code>"ctyname"</code> por su contenido <code>substr(país,1,1)=="</code>ctyname’“<code>. Al hacerlo, se convierte en</code>substr(país,1,1)==”B”<code>. Si se omiten las comillas dobles, se obtiene</code>substr(country,1,1)==B`, lo que da lugar a un error.</p>
<p>Contadores: Las macros también pueden ser útiles para contadores.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb63-1"><a href="buenas-prácticas-de-programación.html#cb63-1" aria-hidden="true" tabindex="-1"></a>* Para adelante</span>
<span id="cb63-2"><a href="buenas-prácticas-de-programación.html#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> i = 1 </span>
<span id="cb63-3"><a href="buenas-prácticas-de-programación.html#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> ++i </span>
<span id="cb63-4"><a href="buenas-prácticas-de-programación.html#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="kw">di</span> <span class="ot">`i&#39;</span> </span>
<span id="cb63-5"><a href="buenas-prácticas-de-programación.html#cb63-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-6"><a href="buenas-prácticas-de-programación.html#cb63-6" aria-hidden="true" tabindex="-1"></a>* Para atrás</span>
<span id="cb63-7"><a href="buenas-prácticas-de-programación.html#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> i = 1</span>
<span id="cb63-8"><a href="buenas-prácticas-de-programación.html#cb63-8" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> --i </span>
<span id="cb63-9"><a href="buenas-prácticas-de-programación.html#cb63-9" aria-hidden="true" tabindex="-1"></a><span class="kw">di</span> <span class="ot">`i&#39;</span> </span></code></pre></div>
<p>Muy útil para hacer gráficos o guardar datos en matrices.</p>
<p>Utilizar una macro para estimar regresiones: Imaginen que desean estimar regresiones sobre un conjunto de variables donde una parte de este conjunto esta fija y la otra parte es variable.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb64-1"><a href="buenas-prácticas-de-programación.html#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> rhs mpg <span class="kw">weight</span></span>
<span id="cb64-2"><a href="buenas-prácticas-de-programación.html#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> price <span class="ot">`rhs&#39;</span> <span class="kw">if</span> foreign == 0 </span>
<span id="cb64-3"><a href="buenas-prácticas-de-programación.html#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> rhs <span class="st">&quot;`rhs&#39; headroom trunk&quot;</span>  </span>
<span id="cb64-4"><a href="buenas-prácticas-de-programación.html#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> price <span class="ot">`rhs&#39;</span> <span class="kw">if</span> foreign == 0 </span></code></pre></div>
<p>¿Qué ocurre si queremos hacerlo por separado? ¿Uno a uno?</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb65-1"><a href="buenas-prácticas-de-programación.html#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> rhs <span class="st">&quot;mpg weight \`add_var&#39;&quot;</span> </span>
<span id="cb65-2"><a href="buenas-prácticas-de-programación.html#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> add_var <span class="st">&quot;headroom&quot;</span></span>
<span id="cb65-3"><a href="buenas-prácticas-de-programación.html#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> price <span class="ot">`rhs&#39;</span> <span class="kw">if</span> foreign == 0  </span>
<span id="cb65-4"><a href="buenas-prácticas-de-programación.html#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> add_var <span class="st">&quot;trunk&quot;</span> </span>
<span id="cb65-5"><a href="buenas-prácticas-de-programación.html#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> price <span class="ot">`rhs&#39;</span> <span class="kw">if</span> foreign == 0  </span>
<span id="cb65-6"><a href="buenas-prácticas-de-programación.html#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> add_var <span class="st">&quot;turn&quot;</span> </span>
<span id="cb65-7"><a href="buenas-prácticas-de-programación.html#cb65-7" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> price <span class="ot">`rhs&#39;</span> <span class="kw">if</span> foreign == 0  </span></code></pre></div>
<p>Lo que ocurre cuando hacemos referencia a una macro es que su valor se introduce en ese punto. El uso de una barra invertida en su lugar hace que se introduzca la referencia de la macro, es decir, no se sustituirá el valor de <code>add_var</code> sino el término `<code>add_var'</code>. Así que cada vez que llamamos a la local <code>rhs</code> el valor actual de el local <code>add_var</code> es sustituido.</p>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.3.5: </b></p>
<p>Instrucciones</p>
<ol style="list-style-type: decimal">
<li>Cargar la base <code>auto.dta</code></li>
</ol>
<p>Preguntas</p>
<ol style="list-style-type: decimal">
<li><p>Defina una variable macro llamada <code>control</code> que contenga <code>mpg</code>, <code>rep78</code> y <code>headroom</code>. Estime una regresión entre <code>price</code> y <code>control</code> para vehículos extranjeros y de nuevo para vehículos domésticos.</p></li>
<li><p>Ejecute <code>summarize mpg</code> junto con <code>return list</code>. Defina dos macros <code>display</code> <code>local mean1 r(mean)</code> y <code>local mean2 = r(mean)</code>. ¿Son iguales?</p></li>
</ol>
</div>
</div>
<div id="globales" class="section level4 hasAnchor" number="2.3.6.3">
<h4><span class="header-section-number">2.3.6.3</span> Globales<a href="buenas-prácticas-de-programación.html#globales" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Crear macros globales</p>
<ul>
<li>Se crean con el comando <code>global</code>.</li>
<li>Útiles para fijar directorios o programas.</li>
<li>En otros casos es mejor utilizar <code>local</code>.</li>
</ul>
<div class="sourceCode" id="cb66"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb66-1"><a href="buenas-prácticas-de-programación.html#cb66-1" aria-hidden="true" tabindex="-1"></a>* Para generarla </span>
<span id="cb66-2"><a href="buenas-prácticas-de-programación.html#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="kw">global</span> <span class="kw">variable</span></span>
<span id="cb66-3"><a href="buenas-prácticas-de-programación.html#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="buenas-prácticas-de-programación.html#cb66-4" aria-hidden="true" tabindex="-1"></a>* En caso <span class="kw">de</span> querer llamarla</span>
<span id="cb66-5"><a href="buenas-prácticas-de-programación.html#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="ot">$variable</span></span></code></pre></div>
</div>
<div id="funciones-extendidas-de-macros" class="section level4 hasAnchor" number="2.3.6.4">
<h4><span class="header-section-number">2.3.6.4</span> Funciones extendidas de macros<a href="buenas-prácticas-de-programación.html#funciones-extendidas-de-macros" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>¿Qué son las funciones de macros extendidas?</p>
<ul>
<li>Stata también define ciertas macro. Estas se denominan <em>extended macro functions</em> o macros extendidas.</li>
<li>En algunos casos contienen información sobre tu sistema operativo, sobre la última estimación que se realizo o sobre la base de datos.</li>
<li>El <code>help extended_fcn</code> y la documentación que la acompaña proporcionan una descripción completa de la sintaxis de cada función de macro extendida (hay muchas). Muchas tienen ligeras variaciones de sintaxis entre ellas (por ejemplo, algunas requieren que las macros estén entre comillas dobles; otras no lo permiten).</li>
</ul>
<div class="sourceCode" id="cb67"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb67-1"><a href="buenas-prácticas-de-programación.html#cb67-1" aria-hidden="true" tabindex="-1"></a>* La sintaxis general es: </span>
<span id="cb67-2"><a href="buenas-prácticas-de-programación.html#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> nombremacro: función <span class="kw">macro</span> extendida</span></code></pre></div>
<p>Mirar labels</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb68-1"><a href="buenas-prácticas-de-programación.html#cb68-1" aria-hidden="true" tabindex="-1"></a>* Para mirar los labels <span class="kw">de</span> trunk</span>
<span id="cb68-2"><a href="buenas-prácticas-de-programación.html#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto, <span class="kw">clear</span></span>
<span id="cb68-3"><a href="buenas-prácticas-de-programación.html#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> tlab : <span class="kw">variable</span> <span class="kw">label</span> trunk </span>
<span id="cb68-4"><a href="buenas-prácticas-de-programación.html#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;`tlab&#39;&quot;</span></span></code></pre></div>
<p><code>variable label</code> recupera el nombre asignado a una variable.</p>
<p>Contar dentro de un local</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb69-1"><a href="buenas-prácticas-de-programación.html#cb69-1" aria-hidden="true" tabindex="-1"></a>* Para contar dentro <span class="kw">de</span> un <span class="kw">local</span></span>
<span id="cb69-2"><a href="buenas-prácticas-de-programación.html#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> NivelEstres Nada Medio Moderado Severo </span>
<span id="cb69-3"><a href="buenas-prácticas-de-programación.html#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> wds: <span class="fu">word</span> <span class="fu">count</span> <span class="ot">`NivelEstres&#39;</span> </span>
<span id="cb69-4"><a href="buenas-prácticas-de-programación.html#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;Hay `wds&#39; niveles de estres:&quot;</span></span>
<span id="cb69-5"><a href="buenas-prácticas-de-programación.html#cb69-5" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> i = 1/<span class="ot">`wds&#39;</span> {</span>
<span id="cb69-6"><a href="buenas-prácticas-de-programación.html#cb69-6" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> wd: <span class="fu">word</span> <span class="ot">`i&#39;</span> <span class="kw">of</span> <span class="ot">`NivelEstres&#39;</span></span>
<span id="cb69-7"><a href="buenas-prácticas-de-programación.html#cb69-7" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;Nivel `i&#39; is `wd&#39;&quot;</span></span>
<span id="cb69-8"><a href="buenas-prácticas-de-programación.html#cb69-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><code>word count</code> y <code>word</code> como funciones de extensión que operan sobre <em>strings</em>.</p>
<p>Conocer tipos de datos</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb70-1"><a href="buenas-prácticas-de-programación.html#cb70-1" aria-hidden="true" tabindex="-1"></a>* Para conocer tipos <span class="kw">de</span> datos</span>
<span id="cb70-2"><a href="buenas-prácticas-de-programación.html#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto, <span class="kw">clear</span></span>
<span id="cb70-3"><a href="buenas-prácticas-de-programación.html#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> stortype : <span class="dv">type</span> make </span>
<span id="cb70-4"><a href="buenas-prácticas-de-programación.html#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;`stortype&#39;&quot;</span></span></code></pre></div>
<p>Ojos con las comillas dobles (nuevamente): Algunas veces las macros contienen comillas dobles. Para poder escribirlos sin errores es necesario modificar levemente la forma en que se llama a la variable <code>local</code></p>
<div class="sourceCode" id="cb71"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb71-1"><a href="buenas-prácticas-de-programación.html#cb71-1" aria-hidden="true" tabindex="-1"></a>* Con <span class="kw">error</span> </span>
<span id="cb71-2"><a href="buenas-prácticas-de-programación.html#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> answers yes no <span class="st">&quot;do not know&quot;</span> </span>
<span id="cb71-3"><a href="buenas-prácticas-de-programación.html#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;`answers&#39;&quot;</span></span>
<span id="cb71-4"><a href="buenas-prácticas-de-programación.html#cb71-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-5"><a href="buenas-prácticas-de-programación.html#cb71-5" aria-hidden="true" tabindex="-1"></a>* Sin <span class="kw">error</span> </span>
<span id="cb71-6"><a href="buenas-prácticas-de-programación.html#cb71-6" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> answers yes no <span class="st">&quot;do not know&quot;</span> </span>
<span id="cb71-7"><a href="buenas-prácticas-de-programación.html#cb71-7" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">`&quot;</span><span class="ot">`answers&#39;</span><span class="st">&quot;&#39;</span></span></code></pre></div>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.3.6: </b></p>
<p>Preguntas</p>
<ol style="list-style-type: decimal">
<li>Use una macro extendida para mostrar el tipo de dato (ej. <code>int</code>, <code>float</code>, <code>long</code>,…) de <code>mpg</code>. Revise el <code>help</code> de <code>extended_fcn</code>.</li>
<li>Use una macro extendida para retornar el valor del label asociado a <code>foreign</code> cuando es igual a 1.</li>
<li>Use una macro extendida para mostrar solo la primera variable de `<code>controls'</code>.</li>
<li>Utilice una función extendida de macros para mostrar todos los archivos de su directorio actual (sugerencia: utilice comillas compuestas cuando muestre los nombres de los archivos).</li>
</ol>
</div>
</div>
<div id="funciones-de-macro-extendidas-para-listas" class="section level4 hasAnchor" number="2.3.6.5">
<h4><span class="header-section-number">2.3.6.5</span> Funciones de macro extendidas para listas<a href="buenas-prácticas-de-programación.html#funciones-de-macro-extendidas-para-listas" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Stata también define ciertas macro para operar sobre listas. Estas funciones permiten combinar listas, buscar elementos dentro de una lista o bien buscar elementos comunes entre dos listas. Conveniente revisar <code>help macrolist</code> para más funciones.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb72-1"><a href="buenas-prácticas-de-programación.html#cb72-1" aria-hidden="true" tabindex="-1"></a>* Sintaxis: </span>
<span id="cb72-2"><a href="buenas-prácticas-de-programación.html#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> nombre <span class="kw">macro</span>: <span class="ot">list</span> función</span>
<span id="cb72-3"><a href="buenas-prácticas-de-programación.html#cb72-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-4"><a href="buenas-prácticas-de-programación.html#cb72-4" aria-hidden="true" tabindex="-1"></a>* Ejemplo <span class="kw">de</span> lista</span>
<span id="cb72-5"><a href="buenas-prácticas-de-programación.html#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> animales <span class="st">&quot;gato perro gato loro loro&quot;</span> </span>
<span id="cb72-6"><a href="buenas-prácticas-de-programación.html#cb72-6" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> uniqanimales : <span class="ot">list</span> uniq animales </span>
<span id="cb72-7"><a href="buenas-prácticas-de-programación.html#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;`uniqanimales&#39;&quot;</span></span></code></pre></div>
<p>Función levelsof: El comando <code>levelsof</code> lista los valores distintos de una variable. Al agregar la opción <code>local(nombremacro)</code> esto se guardara como una macro.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb73-1"><a href="buenas-prácticas-de-programación.html#cb73-1" aria-hidden="true" tabindex="-1"></a>* Sintaxis básica</span>
<span id="cb73-2"><a href="buenas-prácticas-de-programación.html#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto, <span class="kw">clear</span></span>
<span id="cb73-3"><a href="buenas-prácticas-de-programación.html#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="kw">levelsof</span> rep78 </span>
<span id="cb73-4"><a href="buenas-prácticas-de-programación.html#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;`r(levels)&#39;&quot;</span></span>
<span id="cb73-5"><a href="buenas-prácticas-de-programación.html#cb73-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-6"><a href="buenas-prácticas-de-programación.html#cb73-6" aria-hidden="true" tabindex="-1"></a>* Sintaxis cuando hay variables categóricas.</span>
<span id="cb73-7"><a href="buenas-prácticas-de-programación.html#cb73-7" aria-hidden="true" tabindex="-1"></a><span class="kw">levelsof</span> foreign, <span class="kw">local</span>(<span class="kw">levels</span>)</span>
<span id="cb73-8"><a href="buenas-prácticas-de-programación.html#cb73-8" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> <span class="ot">l</span> <span class="kw">of</span> <span class="kw">local</span> <span class="kw">levels</span> {</span>
<span id="cb73-9"><a href="buenas-prácticas-de-programación.html#cb73-9" aria-hidden="true" tabindex="-1"></a><span class="kw">di</span> <span class="st">&quot;-&gt; foreign = `: label (foreign) `l&#39;&#39;&quot;</span></span>
<span id="cb73-10"><a href="buenas-prácticas-de-programación.html#cb73-10" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> price mpg <span class="kw">if</span> foreign == <span class="ot">`l&#39;</span></span>
<span id="cb73-11"><a href="buenas-prácticas-de-programación.html#cb73-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="manipulación-de-locales-vía-listas-de-macros" class="section level4 hasAnchor" number="2.3.6.6">
<h4><span class="header-section-number">2.3.6.6</span> Manipulación de locales vía listas de macros<a href="buenas-prácticas-de-programación.html#manipulación-de-locales-vía-listas-de-macros" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Listas de macros: Las <code>macro lists</code> permiten obtener el número de elementos de una macro, trabajar con valores duplicados, ordenar elementos. Veremos cuatro aplicaciones:</p>
<ol style="list-style-type: decimal">
<li>Elementos duplicados.</li>
<li>Agregar y remover elementos.</li>
<li>Uniones e intersecciones.</li>
<li>Ordenar elementos.</li>
</ol>
<p>Elementos duplicados: <code>dups</code> extrae todos los elementos sobrantes.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb74-1"><a href="buenas-prácticas-de-programación.html#cb74-1" aria-hidden="true" tabindex="-1"></a>* Deja solo los unicos</span>
<span id="cb74-2"><a href="buenas-prácticas-de-programación.html#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> fib 0 1 1 2 3</span>
<span id="cb74-3"><a href="buenas-prácticas-de-programación.html#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> fib_nodups : <span class="ot">list</span> uniq fib</span>
<span id="cb74-4"><a href="buenas-prácticas-de-programación.html#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;`fib_nodups&#39;&quot;</span></span>
<span id="cb74-5"><a href="buenas-prácticas-de-programación.html#cb74-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-6"><a href="buenas-prácticas-de-programación.html#cb74-6" aria-hidden="true" tabindex="-1"></a>* Quita todo los duplicados</span>
<span id="cb74-7"><a href="buenas-prácticas-de-programación.html#cb74-7" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> fib 0 1 1 2 3</span>
<span id="cb74-8"><a href="buenas-prácticas-de-programación.html#cb74-8" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> fib_dups : <span class="ot">list</span> dups fib</span>
<span id="cb74-9"><a href="buenas-prácticas-de-programación.html#cb74-9" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;`fib_dups&#39;&quot;</span></span></code></pre></div>
<p>Agregar y remover elementos: Es básicamente pegar elementos de una macro con otra. Definamos dos variables locales: <code>vars</code> y <code>coef</code> y peguémoslos.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb75-1"><a href="buenas-prácticas-de-programación.html#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> vars x <span class="fu">y</span> z </span>
<span id="cb75-2"><a href="buenas-prácticas-de-programación.html#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> coefs a b c </span>
<span id="cb75-3"><a href="buenas-prácticas-de-programación.html#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> vars_coefs <span class="ot">`vars&#39;</span> <span class="ot">`coefs&#39;</span></span>
<span id="cb75-4"><a href="buenas-prácticas-de-programación.html#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;`vars_coefs&#39;&quot;</span></span></code></pre></div>
<p>Para remover tenemos que definir un nuevo local con los elementos que queremos quitar y sustraerlo del original. Supongamos que queremos actualizar el contenido de <code>vars</code> eliminado “y”.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb76-1"><a href="buenas-prácticas-de-programación.html#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="kw">not</span> <span class="fu">y</span></span>
<span id="cb76-2"><a href="buenas-prácticas-de-programación.html#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> vars : <span class="ot">list</span> vars - <span class="kw">not</span></span>
<span id="cb76-3"><a href="buenas-prácticas-de-programación.html#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;`vars&#39;&quot;</span></span></code></pre></div>
<p>Unión de elementos: Podemos pegar todos los elementos diferentes entre dos listas.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb77-1"><a href="buenas-prácticas-de-programación.html#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> A house tree car</span>
<span id="cb77-2"><a href="buenas-prácticas-de-programación.html#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> B computer car bike</span>
<span id="cb77-3"><a href="buenas-prácticas-de-programación.html#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> all_things : <span class="ot">list</span> A | B</span>
<span id="cb77-4"><a href="buenas-prácticas-de-programación.html#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;`all_things&#39;&quot;</span></span></code></pre></div>
<p>Noten que los elementos de <code>car</code> no fueron pegados. Notar que esto es distinto a simplemente pegar macros entre sí.</p>
<p>Intersección de elementos: Podemos hacer la intersección entre dos elementos de una lista. Esto corresponde a los elementos que pertenecen a ambas macros.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb78-1"><a href="buenas-prácticas-de-programación.html#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> A house tree car</span>
<span id="cb78-2"><a href="buenas-prácticas-de-programación.html#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> B computer car bike</span>
<span id="cb78-3"><a href="buenas-prácticas-de-programación.html#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> common_things : <span class="ot">list</span> A &amp; B</span>
<span id="cb78-4"><a href="buenas-prácticas-de-programación.html#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;`common_things&#39;&quot;</span></span></code></pre></div>
<p>Noten que en este caso solo <code>car</code> se mantiene.</p>
<p>Ordenar elementos: En ocasiones queremos ordenar los elementos de una lista contenida en una macro.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb79-1"><a href="buenas-prácticas-de-programación.html#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> names camila camilo pedro paula</span>
<span id="cb79-2"><a href="buenas-prácticas-de-programación.html#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> names : <span class="ot">list</span> <span class="kw">sort</span> names</span>
<span id="cb79-3"><a href="buenas-prácticas-de-programación.html#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;`names&#39;&quot;</span></span></code></pre></div>
<p>Para hacer que los elementos de una macro se ordenen aleatoriamente es conveniente utilizar mata</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb80-1"><a href="buenas-prácticas-de-programación.html#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> nums 1 2 3 4 5</span>
<span id="cb80-2"><a href="buenas-prácticas-de-programación.html#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> : st_local(<span class="st">&quot;random_nums&quot;</span>, <span class="co">///</span></span>
<span id="cb80-3"><a href="buenas-prácticas-de-programación.html#cb80-3" aria-hidden="true" tabindex="-1"></a>invtokens(<span class="kw">jumble</span>(tokens(st_local(<span class="st">&quot;nums&quot;</span>))&#39;)&#39;))</span>
<span id="cb80-4"><a href="buenas-prácticas-de-programación.html#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;`random_nums&#39;&quot;</span></span></code></pre></div>
</div>
<div id="creturn" class="section level4 hasAnchor" number="2.3.6.7">
<h4><span class="header-section-number">2.3.6.7</span> creturn<a href="buenas-prácticas-de-programación.html#creturn" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Macros con creturn</p>
<ul>
<li>En algunos casos al utilizar <code>local</code> o <code>global</code> vamos a querer fijar algunos parámetros.</li>
<li>Para este propósito utilizar <code>creturn</code>. Algunos ejemplos son: <code>c(current_date)</code>, <code>c(pwd)</code>, <code>c(current_time)</code>, <code>c(stata_version)</code>, <code>c(pi)</code>, <code>c(alpha)</code>, <code>c(Wdays)</code>.</li>
</ul>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.3.7: </b></p>
<p>Preguntas</p>
<ol style="list-style-type: decimal">
<li>Define una macro llamada comestibles con peras, manzanas, fresas, yogur, vino y queso en ella. Ponla en orden alfabético.</li>
<li>Define una macro llamada unión que contenga los miembros de la macro <em>animales</em> y <em>comestibles</em> y luego utiliza una función de lista extendida de la macro para mostrar el número de palabras que contiene.</li>
<li>Ordena <em>unión</em> y muestra la posición de la palabra “vino” utilizando una función de lista extendida de macros.</li>
</ol>
</div>
</div>
</div>
<div id="estructuras-de-datos" class="section level3 hasAnchor" number="2.3.7">
<h3><span class="header-section-number">2.3.7</span> Estructuras de datos<a href="buenas-prácticas-de-programación.html#estructuras-de-datos" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="escalares" class="section level4 hasAnchor" number="2.3.7.1">
<h4><span class="header-section-number">2.3.7.1</span> Escalares<a href="buenas-prácticas-de-programación.html#escalares" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>Los escalares pueden contener valores numéricos o <em>strings</em>. Un escalar solo puede contener un valor.</li>
<li>La sintaxis para generar un escalar es <code>scalar scalar_name = exp</code>.</li>
</ul>
<div class="sourceCode" id="cb81"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb81-1"><a href="buenas-prácticas-de-programación.html#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="kw">quietly</span>: <span class="kw">summarize</span> mpg </span>
<span id="cb81-2"><a href="buenas-prácticas-de-programación.html#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="fu">scalar</span> mean_mpg = <span class="fu">r</span>(<span class="kw">mean</span>)</span>
<span id="cb81-3"><a href="buenas-prácticas-de-programación.html#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="kw">quietly</span>: <span class="kw">summarize</span> rep78</span>
<span id="cb81-4"><a href="buenas-prácticas-de-programación.html#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="fu">scalar</span> mean_rep78 = <span class="fu">r</span>(<span class="kw">mean</span>)</span>
<span id="cb81-5"><a href="buenas-prácticas-de-programación.html#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;r(mean) guarda el promedio de rep78: &quot;</span> <span class="fu">r</span>(<span class="kw">mean</span>) </span>
<span id="cb81-6"><a href="buenas-prácticas-de-programación.html#cb81-6" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;Pero tambien podemos recuperarlo:&quot;</span> mean_mpg</span></code></pre></div>
<p>Para utilizar un escalar en una operación solo es necesario llamarlo por su nombre. Para listar el contenido de todos los escalares <code>scalar list</code>. Para borrar <code>scalar drop scalar_name</code> o si quiero eliminar todo <code>scalar drop _all</code>. Los escalares permiten parametrizar un <code>do-file</code>.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb82-1"><a href="buenas-prácticas-de-programación.html#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> fem2, <span class="kw">clear</span> </span>
<span id="cb82-2"><a href="buenas-prácticas-de-programación.html#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">scalar</span> lb1 = 80 </span>
<span id="cb82-3"><a href="buenas-prácticas-de-programación.html#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="fu">scalar</span> ub1 = 88 </span>
<span id="cb82-4"><a href="buenas-prácticas-de-programación.html#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="fu">scalar</span> lb2 = 89 </span>
<span id="cb82-5"><a href="buenas-prácticas-de-programación.html#cb82-5" aria-hidden="true" tabindex="-1"></a><span class="fu">scalar</span> ub2 = 97 </span>
<span id="cb82-6"><a href="buenas-prácticas-de-programación.html#cb82-6" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> i = 1/2 {</span>
<span id="cb82-7"><a href="buenas-prácticas-de-programación.html#cb82-7" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="dt">_n</span> <span class="st">&quot;IQ&quot;</span> <span class="st">&quot;lb`i&#39;&quot;</span> <span class="st">&quot;-&quot;</span> <span class="st">&quot;ub`i&#39;&quot;</span> </span>
<span id="cb82-8"><a href="buenas-prácticas-de-programación.html#cb82-8" aria-hidden="true" tabindex="-1"></a><span class="kw">tabulate</span> anxiety <span class="kw">if</span> <span class="fu">inrange</span>(iq, lb<span class="ot">`i&#39;</span>, ub<span class="ot">`i&#39;</span>)</span>
<span id="cb82-9"><a href="buenas-prácticas-de-programación.html#cb82-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="elementos-y-operaciones-con-matrices" class="section level4 hasAnchor" number="2.3.7.2">
<h4><span class="header-section-number">2.3.7.2</span> Elementos y operaciones con matrices<a href="buenas-prácticas-de-programación.html#elementos-y-operaciones-con-matrices" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Stata puede generar matrices.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb83-1"><a href="buenas-prácticas-de-programación.html#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> <span class="kw">weight</span> age age2</span>
<span id="cb83-2"><a href="buenas-prácticas-de-programación.html#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> b = <span class="fu">e</span>(b)</span>
<span id="cb83-3"><a href="buenas-prácticas-de-programación.html#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> <span class="ot">list</span> b</span>
<span id="cb83-4"><a href="buenas-prácticas-de-programación.html#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> <span class="kw">V</span> = <span class="fu">e</span>(<span class="kw">V</span>)</span>
<span id="cb83-5"><a href="buenas-prácticas-de-programación.html#cb83-5" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> <span class="ot">list</span> <span class="kw">V</span></span></code></pre></div>
<p>Las matrices son muy importantes para guardar resultados y exportarlos de forma conveniente. También son útiles para cuando se quieren hacer estimaciones de muchos parámetros y para distintos conjuntos de datos.</p>
<p>Operaciones con matrices: Se puede operar con matrices. Por ejemplo, sabemos que <span class="math inline">\(b = (X&#39;X)^{-1}X&#39;y\)</span> y que <span class="math inline">\(V = \sigma^{2}(X&#39;X)^{-1}\)</span>. Si queremos extraer solo la matriz <span class="math inline">\(X&#39;y\)</span> tenemos que operar, calculando <span class="math inline">\(\frac{1}{\sigma^{2}}V^{-1}b\)</span>.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb84-1"><a href="buenas-prácticas-de-programación.html#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> <span class="kw">define</span> b = <span class="fu">e</span>(b)&#39; </span>
<span id="cb84-2"><a href="buenas-prácticas-de-programación.html#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> <span class="kw">define</span> xty = <span class="fu">inv</span>(<span class="kw">V</span>) * b /<span class="fu">e</span>(rmse)^2</span>
<span id="cb84-3"><a href="buenas-prácticas-de-programación.html#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> <span class="ot">list</span> xty </span></code></pre></div>
<p><code>e(b)’</code> indica la traspuesta, mientras que <code>inv()</code> es para calcular la matriz inversa.</p>
<p>Llamar a los elementos de una matriz: Se puede acceder a los escalares contenidos en las matrices. Por ejemplo, si queremos obtener los elementos de la matriz <span class="math inline">\(e(b)\)</span> tenemos:</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb85-1"><a href="buenas-prácticas-de-programación.html#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;The coefficient on weight is: &quot;</span> _b[<span class="kw">weight</span>] </span>
<span id="cb85-2"><a href="buenas-prácticas-de-programación.html#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;Its standard error is: &quot;</span> _se[<span class="kw">weight</span>] </span>
<span id="cb85-3"><a href="buenas-prácticas-de-programación.html#cb85-3" aria-hidden="true" tabindex="-1"></a>* Valores predichos </span>
<span id="cb85-4"><a href="buenas-prácticas-de-programación.html#cb85-4" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> anxietyhat = _b[<span class="dt">_cons</span>] + _b[<span class="kw">weight</span>] * <span class="kw">weight</span> + <span class="co">/// </span></span>
<span id="cb85-5"><a href="buenas-prácticas-de-programación.html#cb85-5" aria-hidden="true" tabindex="-1"></a>_b[age] * age + _b[age2] * age2</span></code></pre></div>
<p>También podemos utilizar las posiciones de los elementos de la matriz (<code>b[i,k)]</code>).</p>
</div>
<div id="funciones" class="section level4 hasAnchor" number="2.3.7.3">
<h4><span class="header-section-number">2.3.7.3</span> Funciones<a href="buenas-prácticas-de-programación.html#funciones" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Solo disponibles para comandos <code>e-class</code>. Por ejemplo, si estimamos una regresión veremos que la unica función disponible es <code>e(sample)</code>.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb86-1"><a href="buenas-prácticas-de-programación.html#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto </span>
<span id="cb86-2"><a href="buenas-prácticas-de-programación.html#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="kw">regress</span> mpg <span class="kw">weight</span> <span class="fu">length</span> rep78</span>
<span id="cb86-3"><a href="buenas-prácticas-de-programación.html#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="kw">ereturn</span> <span class="ot">list</span></span></code></pre></div>
<p><code>e(sample)</code> nos indica si una determinada observación se utilizó para estimar la regresión. Es decir, es igual a uno si una observación estaba en la muestra de estimación y 0 si fue excluida.</p>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.4.1:</b></p>
<p>Preguntas:</p>
<ol style="list-style-type: decimal">
<li>Estime una regresión de mpg contra weight length rep78 utilizando base de datos auto, pero solo para los autos extranjeros (<code>foreign == 1</code>).</li>
<li>Genere una nueva variable, llamada <code>enmuestra</code> que tome los valores dados por la función <code>e(sample)</code>.</li>
<li>Utilizando <code>br</code>, observe los valores de <code>enmuestra</code>. ¿Qué observa?</li>
<li>Calcule la estadística de <code>mpg</code> solo para las observaciones que fueron incluidas en la regresión.</li>
</ol>
</div>
</div>
</div>
<div id="iteradores" class="section level3 hasAnchor" number="2.3.8">
<h3><span class="header-section-number">2.3.8</span> Iteradores<a href="buenas-prácticas-de-programación.html#iteradores" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="foreach" class="section level4 hasAnchor" number="2.3.8.1">
<h4><span class="header-section-number">2.3.8.1</span> Foreach<a href="buenas-prácticas-de-programación.html#foreach" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>foreach</code> y <code>forvalues</code>: <code>forvalues</code> itera sobre una lista de números y <code>foreach</code> recorre los elementos de una macro, o los nombres de las variables de una lista de variables, o los elementos de una lista de números.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb87-1"><a href="buenas-prácticas-de-programación.html#cb87-1" aria-hidden="true" tabindex="-1"></a>* Foreach</span>
<span id="cb87-2"><a href="buenas-prácticas-de-programación.html#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> animal <span class="kw">in</span> cats and dogs { </span>
<span id="cb87-3"><a href="buenas-prácticas-de-programación.html#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;`animal&#39;&quot;</span></span>
<span id="cb87-4"><a href="buenas-prácticas-de-programación.html#cb87-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb87-5"><a href="buenas-prácticas-de-programación.html#cb87-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-6"><a href="buenas-prácticas-de-programación.html#cb87-6" aria-hidden="true" tabindex="-1"></a>* Forvalues </span>
<span id="cb87-7"><a href="buenas-prácticas-de-programación.html#cb87-7" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> i = 1(1)100 { </span>
<span id="cb87-8"><a href="buenas-prácticas-de-programación.html#cb87-8" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> x<span class="ot">`i&#39;</span> = runiform()</span>
<span id="cb87-9"><a href="buenas-prácticas-de-programación.html#cb87-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Hay algunas variaciones en <code>foreach</code> según el tipo de lista. La sintaxis es similar a la recien presentada, pero difiere en dos aspectos:</p>
<ul>
<li><code>in</code> se remplaza por <code>of</code>.</li>
<li>Hay que llamar al identificador.</li>
<li>Veamos como iterar sobre una lista de <strong>globales y locales</strong>.
\end{itemize}</li>
</ul>
<div class="sourceCode" id="cb88"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb88-1"><a href="buenas-prácticas-de-programación.html#cb88-1" aria-hidden="true" tabindex="-1"></a>* Sobre locales <span class="fu">y</span> globales</span>
<span id="cb88-2"><a href="buenas-prácticas-de-programación.html#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> money <span class="st">&quot;Franc Dollar Lira Pound&quot;</span> </span>
<span id="cb88-3"><a href="buenas-prácticas-de-programación.html#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> currency <span class="kw">of</span> <span class="kw">local</span> money { </span>
<span id="cb88-4"><a href="buenas-prácticas-de-programación.html#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;`currency&#39;&quot;</span></span>
<span id="cb88-5"><a href="buenas-prácticas-de-programación.html#cb88-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Veamos como iterar sobre una <strong>lista de variables</strong>:</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb89-1"><a href="buenas-prácticas-de-programación.html#cb89-1" aria-hidden="true" tabindex="-1"></a>* Sobre lista <span class="kw">de</span> variables</span>
<span id="cb89-2"><a href="buenas-prácticas-de-programación.html#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> <span class="kw">var</span> <span class="kw">of</span> <span class="kw">varlist</span> mpg <span class="kw">weight</span>-turn { </span>
<span id="cb89-3"><a href="buenas-prácticas-de-programación.html#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="kw">quietly</span> <span class="kw">summarize</span> <span class="ot">`var&#39;</span> <span class="kw">summarize</span> <span class="ot">`var&#39;</span> <span class="kw">if</span> <span class="ot">`var&#39;</span> &gt; <span class="fu">r</span>(<span class="kw">mean</span>)</span>
<span id="cb89-4"><a href="buenas-prácticas-de-programación.html#cb89-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Veamos como iterar sobre una <strong>lista de de nuevas variables</strong>:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb90-1"><a href="buenas-prácticas-de-programación.html#cb90-1" aria-hidden="true" tabindex="-1"></a>* Sobre lista <span class="kw">de</span> nuevas variables</span>
<span id="cb90-2"><a href="buenas-prácticas-de-programación.html#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> <span class="kw">var</span> <span class="kw">of</span> newlist z1-z20 { </span>
<span id="cb90-3"><a href="buenas-prácticas-de-programación.html#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> <span class="ot">`var&#39;</span> = runiform()</span>
<span id="cb90-4"><a href="buenas-prácticas-de-programación.html#cb90-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Veamos como iterar sobre una <strong>lista de números</strong>:</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb91-1"><a href="buenas-prácticas-de-programación.html#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> num <span class="kw">of</span> numlist 1 4/8 13(2)21 103 { </span>
<span id="cb91-2"><a href="buenas-prácticas-de-programación.html#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="ot">`num&#39;</span></span>
<span id="cb91-3"><a href="buenas-prácticas-de-programación.html#cb91-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="combinar-macros-con-iteradores" class="section level4 hasAnchor" number="2.3.8.2">
<h4><span class="header-section-number">2.3.8.2</span> Combinar macros con iteradores<a href="buenas-prácticas-de-programación.html#combinar-macros-con-iteradores" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>foreach</code> y <code>forvalues</code> combinados con macros pueden utilizarse para ahorrarnos mucho trabajo. Podemos generar tun conjunto de locales a partir de iteraciones.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb92-1"><a href="buenas-prácticas-de-programación.html#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> replicate.dta, <span class="kw">replace</span></span>
<span id="cb92-2"><a href="buenas-prácticas-de-programación.html#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="kw">levelsof</span> cty</span>
<span id="cb92-3"><a href="buenas-prácticas-de-programación.html#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> ctries <span class="st">&quot;`r(levels)&#39;&quot;</span> </span>
<span id="cb92-4"><a href="buenas-prácticas-de-programación.html#cb92-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-5"><a href="buenas-prácticas-de-programación.html#cb92-5" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> ctr <span class="kw">in</span> <span class="ot">`ctries&#39;</span> { </span>
<span id="cb92-6"><a href="buenas-prácticas-de-programación.html#cb92-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">sum</span> hours_t <span class="kw">if</span> cty == <span class="st">&quot;`ctr&#39;&quot;</span> </span>
<span id="cb92-7"><a href="buenas-prácticas-de-programación.html#cb92-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">local</span> nombre <span class="ot">`ctr&#39;</span> = <span class="ot">`r(mean)&#39;</span></span>
<span id="cb92-8"><a href="buenas-prácticas-de-programación.html#cb92-8" aria-hidden="true" tabindex="-1"></a>} </span></code></pre></div>
<p>Como ya hemos visto, el comando <code>levelsof</code> devuelve una lista de todos los valores distintos de una variable categórica y los guarda en la macro <code>r(levels)</code>. Esto lo hace en el caso de que nosotros no le asignemos un nombre. Podemos utilizar esta lista para los países y años de nuestra muestra para definir dos iteraciones que recorran todos los valores posibles. Para cada valor resumimos la población y definimos una macro local compuesta por el código de país y el año (por ejemplo, USA1990) que toma el valor de la población en ese año para ese país.</p>
<p>Una aplicación del <code>forvalues</code>:</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb93-1"><a href="buenas-prácticas-de-programación.html#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> gdp4cty, <span class="kw">clear</span> </span>
<span id="cb93-2"><a href="buenas-prácticas-de-programación.html#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> i = 1/4 {</span>
<span id="cb93-3"><a href="buenas-prácticas-de-programación.html#cb93-3" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> <span class="kw">double</span> lngdp&#39;i&#39; = <span class="fu">log</span>(gdp&#39;i&#39;)</span>
<span id="cb93-4"><a href="buenas-prácticas-de-programación.html#cb93-4" aria-hidden="true" tabindex="-1"></a><span class="kw">summarize</span> lngdp&#39;i&#39;</span>
<span id="cb93-5"><a href="buenas-prácticas-de-programación.html#cb93-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Utilizando dos <code>forvalues</code>:</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb94-1"><a href="buenas-prácticas-de-programación.html#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> <span class="fu">y</span> = 1995(2)1999 {</span>
<span id="cb94-2"><a href="buenas-prácticas-de-programación.html#cb94-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">forvalues</span> i = 2(2)4 {</span>
<span id="cb94-3"><a href="buenas-prácticas-de-programación.html#cb94-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">summarize</span> gdp<span class="ot">`i&#39;</span>_<span class="ot">`y&#39;</span></span>
<span id="cb94-4"><a href="buenas-prácticas-de-programación.html#cb94-4" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb94-5"><a href="buenas-prácticas-de-programación.html#cb94-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><code>foreach</code> y <code>recode</code>:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb95-1"><a href="buenas-prácticas-de-programación.html#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> gdp4cty, <span class="kw">clear</span> </span>
<span id="cb95-2"><a href="buenas-prácticas-de-programación.html#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> ctycode 111 112 136 134 </span>
<span id="cb95-3"><a href="buenas-prácticas-de-programación.html#cb95-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> i 0</span>
<span id="cb95-4"><a href="buenas-prácticas-de-programación.html#cb95-4" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> c <span class="kw">of</span> <span class="kw">local</span> ctycode{ </span>
<span id="cb95-5"><a href="buenas-prácticas-de-programación.html#cb95-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">local</span> ++i </span>
<span id="cb95-6"><a href="buenas-prácticas-de-programación.html#cb95-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">local</span> rc <span class="st">&quot;`rc&#39; (`i&#39;=`c&#39;)&quot;</span> </span>
<span id="cb95-7"><a href="buenas-prácticas-de-programación.html#cb95-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb95-8"><a href="buenas-prácticas-de-programación.html#cb95-8" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;`rc&#39;&quot;</span></span>
<span id="cb95-9"><a href="buenas-prácticas-de-programación.html#cb95-9" aria-hidden="true" tabindex="-1"></a><span class="kw">recode</span> <span class="kw">cc</span> <span class="ot">`rc&#39;</span>, <span class="kw">gen</span>(newcc)</span></code></pre></div>
<p>Loops anidados: <code>foreach</code> y <code>forvalues</code></p>
<div class="sourceCode" id="cb96"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb96-1"><a href="buenas-prácticas-de-programación.html#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> gdp4cty, <span class="kw">clear</span> </span>
<span id="cb96-2"><a href="buenas-prácticas-de-programación.html#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> country US UK DE FR </span>
<span id="cb96-3"><a href="buenas-prácticas-de-programación.html#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> yrlist 1995 1999 </span>
<span id="cb96-4"><a href="buenas-prácticas-de-programación.html#cb96-4" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> i = 1/4 {</span>
<span id="cb96-5"><a href="buenas-prácticas-de-programación.html#cb96-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span> cnaine: <span class="fu">word</span> <span class="ot">`i&#39;</span> <span class="kw">of</span> <span class="ot">`country&#39;</span></span>
<span id="cb96-6"><a href="buenas-prácticas-de-programación.html#cb96-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="st">&quot;`cnaine&#39;&quot;</span></span>
<span id="cb96-7"><a href="buenas-prácticas-de-programación.html#cb96-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="fu">y</span> <span class="kw">of</span> <span class="kw">local</span> yrlist {</span>
<span id="cb96-8"><a href="buenas-prácticas-de-programación.html#cb96-8" aria-hidden="true" tabindex="-1"></a>            <span class="kw">rename</span> gdp<span class="ot">`i&#39;</span>_<span class="ot">`y&#39;</span> gdp<span class="ot">`cnaine&#39;</span>_<span class="ot">`y&#39;</span></span>
<span id="cb96-9"><a href="buenas-prácticas-de-programación.html#cb96-9" aria-hidden="true" tabindex="-1"></a>    } </span>
<span id="cb96-10"><a href="buenas-prácticas-de-programación.html#cb96-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>En estos casos es bueno utilizar espacios para hacer el código más amigable. Ojo que a Stata no le interesa esto para ejecutar, es solo una cuestión de estilo.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb97-1"><a href="buenas-prácticas-de-programación.html#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto, <span class="kw">clear</span></span>
<span id="cb97-2"><a href="buenas-prácticas-de-programación.html#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> <span class="fu">y</span> <span class="kw">of</span> <span class="kw">varlist</span> mpg rep78 headroom trunk <span class="kw">weight</span> <span class="fu">length</span> { </span>
<span id="cb97-3"><a href="buenas-prácticas-de-programación.html#cb97-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> x <span class="kw">of</span> <span class="kw">varlist</span> rep78 price displacement gear_ratio foreign { </span>
<span id="cb97-4"><a href="buenas-prácticas-de-programación.html#cb97-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">regress</span> <span class="ot">`y&#39;</span> <span class="ot">`x&#39;</span></span>
<span id="cb97-5"><a href="buenas-prácticas-de-programación.html#cb97-5" aria-hidden="true" tabindex="-1"></a>} </span></code></pre></div>
<p>También útil para estimar regresiones.</p>
<p>Tokenize: Podemos almacenar los elementos de la lista de países en macros numeradas con <code>tokenize</code>.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb98-1"><a href="buenas-prácticas-de-programación.html#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> gdp4cty, <span class="kw">clear</span></span>
<span id="cb98-2"><a href="buenas-prácticas-de-programación.html#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> country US UK DE FR </span>
<span id="cb98-3"><a href="buenas-prácticas-de-programación.html#cb98-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> yrlist 1995 1999 </span>
<span id="cb98-4"><a href="buenas-prácticas-de-programación.html#cb98-4" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> ncty: <span class="fu">word</span> <span class="fu">count</span> <span class="ot">`country&#39;</span></span>
<span id="cb98-5"><a href="buenas-prácticas-de-programación.html#cb98-5" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;`ncty&#39;&quot;</span></span>
<span id="cb98-6"><a href="buenas-prácticas-de-programación.html#cb98-6" aria-hidden="true" tabindex="-1"></a><span class="kw">tokenize</span> <span class="ot">`country&#39;</span></span>
<span id="cb98-7"><a href="buenas-prácticas-de-programación.html#cb98-7" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> i = 1/<span class="ot">`ncty&#39;</span>{</span>
<span id="cb98-8"><a href="buenas-prácticas-de-programación.html#cb98-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="fu">y</span> <span class="kw">of</span> <span class="kw">local</span> yrlist {</span>
<span id="cb98-9"><a href="buenas-prácticas-de-programación.html#cb98-9" aria-hidden="true" tabindex="-1"></a>            <span class="kw">rename</span> gdp<span class="ot">`i&#39;</span>_<span class="ot">`y&#39;</span> gdp<span class="ot">``i&#39;</span>&#39;_<span class="ot">`y&#39;</span></span>
<span id="cb98-10"><a href="buenas-prácticas-de-programación.html#cb98-10" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb98-11"><a href="buenas-prácticas-de-programación.html#cb98-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Aquí los nombres de los países se almacenan como valores de las macros numeradas. Debemos referenciar doblemente la macro <span class="math inline">\(i\)</span>. El contenido de esa macro la primera vez que se pasa por el bucle es el número 1. Para acceder al primer código de país, debemos referenciar la macro <span class="math inline">\(`1&#39;\)</span>.</p>
</div>
<div id="while-loop" class="section level4 hasAnchor" number="2.3.8.3">
<h4><span class="header-section-number">2.3.8.3</span> While loop<a href="buenas-prácticas-de-programación.html#while-loop" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Realiza la iteración o se repite una lista de comandos mientras la condición <code>while</code> sea verdadera. La sintaxis es:</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb99-1"><a href="buenas-prácticas-de-programación.html#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="kw">while</span> <span class="fu">exp</span> { </span>
<span id="cb99-2"><a href="buenas-prácticas-de-programación.html#cb99-2" aria-hidden="true" tabindex="-1"></a>hace algo</span>
<span id="cb99-3"><a href="buenas-prácticas-de-programación.html#cb99-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>¿Cuando es útil? : <strong>Cuando no este seguro(a) cuantas veces se realizará la iteración</strong>. Notar que si no hay convergencia, va iterar infinitamente.</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb100-1"><a href="buenas-prácticas-de-programación.html#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="kw">while</span> <span class="fu">reldif</span> (nueva, antigua) &gt; 0.001 { </span>
<span id="cb100-2"><a href="buenas-prácticas-de-programación.html#cb100-2" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>También se puede combinar con macros. Es importante utilizar los incrementales:</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb101-1"><a href="buenas-prácticas-de-programación.html#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> i=1 </span>
<span id="cb101-2"><a href="buenas-prácticas-de-programación.html#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="kw">while</span> <span class="ot">`i&#39;</span>&lt;=5 {</span>
<span id="cb101-3"><a href="buenas-prácticas-de-programación.html#cb101-3" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">&quot;loop number&quot;</span> <span class="ot">`i&#39;</span> </span>
<span id="cb101-4"><a href="buenas-prácticas-de-programación.html#cb101-4" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> i = <span class="ot">`i&#39;</span>+1</span>
<span id="cb101-5"><a href="buenas-prácticas-de-programación.html#cb101-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>La primera parte define el inicio del contador, mientras que la segunda indica la condición para que sea ejecutado. El <code>local</code> final actualiza (incremental). Si el incremento es unitario podemos utilizar <code>local ++i</code>.</p>
</div>
<div id="branching" class="section level4 hasAnchor" number="2.3.8.4">
<h4><span class="header-section-number">2.3.8.4</span> Branching<a href="buenas-prácticas-de-programación.html#branching" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Hacer una cosa en caso de que alguna condición sea cierta y otra cosa en caso de que sea falsa. La sintaxis básica es:</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb102-1"><a href="buenas-prácticas-de-programación.html#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> algo es verdadero { </span>
<span id="cb102-2"><a href="buenas-prácticas-de-programación.html#cb102-2" aria-hidden="true" tabindex="-1"></a>hacer esto</span>
<span id="cb102-3"><a href="buenas-prácticas-de-programación.html#cb102-3" aria-hidden="true" tabindex="-1"></a>} <span class="kw">else</span> {</span>
<span id="cb102-4"><a href="buenas-prácticas-de-programación.html#cb102-4" aria-hidden="true" tabindex="-1"></a>hacer lo contrario</span>
<span id="cb102-5"><a href="buenas-prácticas-de-programación.html#cb102-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.4.2:</b></p>
<p>Preguntas</p>
<ol style="list-style-type: decimal">
<li>Defina una macro llamada mimacro que sea igual a un número entero aleatorio entre 1 y 99.</li>
<li>Utilizando <code>if</code> y <code>else</code> muestre un mensaje que diga si es par o impar.</li>
</ol>
</div>
</div>
<div id="aplicaciones" class="section level4 hasAnchor" number="2.3.8.5">
<h4><span class="header-section-number">2.3.8.5</span> Aplicaciones<a href="buenas-prácticas-de-programación.html#aplicaciones" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Seguir secuencias especiales: <code>creturn</code> posee varias constantes y valores a los que se puede acceder. Por ejemplo:</p>
<ul>
<li><code>c(filename)</code> nombre del último nombre del archivo guardado.</li>
<li><code>c(alpha/ALPHA)</code> lista de letras minúsculas/mayusculas.<br />
</li>
<li><code>c(Mons)</code> lista de nombres de los meses abreviados.</li>
<li><code>c(Months)</code> lista de los nombres de los meses no abreviados.</li>
<li><code>c(Wdays)</code> lista de los dias de la semana abreviados a tres caracteres.</li>
<li><code>c(Weekdays)</code> lista de los días de la semana no abreviados.</li>
</ul>
<p>Con un iterador es posible aplicar estas listas para agregar labels. Suponga que tenemos valores de 1 a 12 que representan meses.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb103-1"><a href="buenas-prácticas-de-programación.html#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span> <span class="ot">all</span></span>
<span id="cb103-2"><a href="buenas-prácticas-de-programación.html#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="kw">obs</span> 12</span>
<span id="cb103-3"><a href="buenas-prácticas-de-programación.html#cb103-3" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> <span class="fu">month</span> = <span class="dt">_n</span> </span>
<span id="cb103-4"><a href="buenas-prácticas-de-programación.html#cb103-4" aria-hidden="true" tabindex="-1"></a><span class="kw">tokenize</span> <span class="ot">`c(Months)&#39;</span> </span>
<span id="cb103-5"><a href="buenas-prácticas-de-programación.html#cb103-5" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> i = 1/12 {</span>
<span id="cb103-6"><a href="buenas-prácticas-de-programación.html#cb103-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">label</span> <span class="kw">define</span> monthlab <span class="ot">`i&#39;</span> <span class="st">&quot;``i&#39;&#39;&quot;</span> , modify </span>
<span id="cb103-7"><a href="buenas-prácticas-de-programación.html#cb103-7" aria-hidden="true" tabindex="-1"></a>                   }</span>
<span id="cb103-8"><a href="buenas-prácticas-de-programación.html#cb103-8" aria-hidden="true" tabindex="-1"></a><span class="kw">label</span> val <span class="fu">month</span> monthlab</span></code></pre></div>
</div>
<div id="monitorear-un-loop" class="section level4 hasAnchor" number="2.3.8.6">
<h4><span class="header-section-number">2.3.8.6</span> Monitorear un loop<a href="buenas-prácticas-de-programación.html#monitorear-un-loop" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Ejemplo proveniente de (Stata tip 41). Cualquier <em>loop</em> puede ser modificado para que muestre su progreso con el comando <code>_dots</code>. Esto es importante para cuando se requieren hacer procesos que toman varias horas y es necesario monitorear avances.</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb104-1"><a href="buenas-prácticas-de-programación.html#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="kw">_dots</span> 0, <span class="bn">title</span>(Loop ejecutando) reps(75) </span>
<span id="cb104-2"><a href="buenas-prácticas-de-programación.html#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> i = 1/75 { </span>
<span id="cb104-3"><a href="buenas-prácticas-de-programación.html#cb104-3" aria-hidden="true" tabindex="-1"></a><span class="kw">_dots</span> ‘i’ 0</span>
<span id="cb104-4"><a href="buenas-prácticas-de-programación.html#cb104-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb104-5"><a href="buenas-prácticas-de-programación.html#cb104-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-6"><a href="buenas-prácticas-de-programación.html#cb104-6" aria-hidden="true" tabindex="-1"></a>----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5</span>
<span id="cb104-7"><a href="buenas-prácticas-de-programación.html#cb104-7" aria-hidden="true" tabindex="-1"></a>..................................................    50</span>
<span id="cb104-8"><a href="buenas-prácticas-de-programación.html#cb104-8" aria-hidden="true" tabindex="-1"></a>.........................</span></code></pre></div>
<p>El primer comando <code>_dots</code> establece las lineas. Titulo y número de repeticiones son opcionales. <code>reps</code> solo acepta enteros como argumento. <code>_dots ‘i’ 0</code> tiene dos elementos:</p>
<ul>
<li>El primer argumento es el número de repetición, que registra el número de intentos en curso. En el ejemplo, esta automáticamente determinado por el <em>loop</em>.</li>
<li>El segundo argumento es el código de retorno, el cual indica el tipo de símbolo. En el ejemplo tenemos un 0.</li>
<li>Los códigos de retorno alternativos producen una “s” (-1), “.” (), “x” roja (1), una “e” (2), una “n” (3) o un “?” (cualquier otro valor).</li>
</ul>
<p>Ejemplo no numérico: La idea es definir una macro local para que actue como un contador.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb105-1"><a href="buenas-prácticas-de-programación.html#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto</span>
<span id="cb105-2"><a href="buenas-prácticas-de-programación.html#cb105-2" aria-hidden="true" tabindex="-1"></a><span class="kw">_dots</span> 0, reps(10)</span>
<span id="cb105-3"><a href="buenas-prácticas-de-programación.html#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> <span class="kw">var</span> <span class="kw">of</span> <span class="kw">varlist</span> price - gear_ratio {</span>
<span id="cb105-4"><a href="buenas-prácticas-de-programación.html#cb105-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">sum</span> <span class="ot">`var&#39;</span>, <span class="kw">d</span></span>
<span id="cb105-5"><a href="buenas-prácticas-de-programación.html#cb105-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">local</span> i = <span class="ot">`i&#39;</span>+1</span>
<span id="cb105-6"><a href="buenas-prácticas-de-programación.html#cb105-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">_dots</span> <span class="ot">`i&#39;</span> 0</span>
<span id="cb105-7"><a href="buenas-prácticas-de-programación.html#cb105-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Contar repeticiones:</p>
<ul>
<li>El número de repeticiones en <code>rep</code> no es calculado por <code>_dots</code>. Es necesario contar manualmente las variables e introducir el número.</li>
<li>Esto lo vamos a hacer con la ayuda de una función de macro extendida <code>sizeof</code>.</li>
<li><code>unab</code> permite ingresar una lista de variable abreviada y expandirla, de forma tal de que la pueda contar.</li>
</ul>
<div class="sourceCode" id="cb106"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb106-1"><a href="buenas-prácticas-de-programación.html#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto</span>
<span id="cb106-2"><a href="buenas-prácticas-de-programación.html#cb106-2" aria-hidden="true" tabindex="-1"></a><span class="kw">unab</span> myvars : price - gear_ratio</span>
<span id="cb106-3"><a href="buenas-prácticas-de-programación.html#cb106-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="kw">N</span> : <span class="ot">list</span> <span class="kw">sizeof</span> myvars</span>
<span id="cb106-4"><a href="buenas-prácticas-de-programación.html#cb106-4" aria-hidden="true" tabindex="-1"></a><span class="kw">_dots</span> 0, reps(<span class="ot">`N&#39;</span>)</span>
<span id="cb106-5"><a href="buenas-prácticas-de-programación.html#cb106-5" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> <span class="kw">var</span> <span class="kw">of</span> <span class="kw">varlist</span> <span class="ot">`myvars&#39;</span> {</span>
<span id="cb106-6"><a href="buenas-prácticas-de-programación.html#cb106-6" aria-hidden="true" tabindex="-1"></a>  ...</span>
<span id="cb106-7"><a href="buenas-prácticas-de-programación.html#cb106-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">local</span> i = <span class="ot">`i&#39;</span>+1</span>
<span id="cb106-8"><a href="buenas-prácticas-de-programación.html#cb106-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">_dots</span> <span class="ot">`i&#39;</span> 0</span>
<span id="cb106-9"><a href="buenas-prácticas-de-programación.html#cb106-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Un ejemplo más complejo es:</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb107-1"><a href="buenas-prácticas-de-programación.html#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="kw">noisily</span> <span class="kw">_dots</span> 0, <span class="bn">title</span>(Looping <span class="kw">until</span> 70 successes...) </span>
<span id="cb107-2"><a href="buenas-prácticas-de-programación.html#cb107-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> rep 1 </span>
<span id="cb107-3"><a href="buenas-prácticas-de-programación.html#cb107-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> nsuccess 0 </span>
<span id="cb107-4"><a href="buenas-prácticas-de-programación.html#cb107-4" aria-hidden="true" tabindex="-1"></a><span class="kw">while</span> ‘nsuccess’ &lt; 70 { </span>
<span id="cb107-5"><a href="buenas-prácticas-de-programación.html#cb107-5" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> fail = uniform() &lt; .2 </span>
<span id="cb107-6"><a href="buenas-prácticas-de-programación.html#cb107-6" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> nsuccess = ‘nsuccess’ + (‘fail’ == 0) </span>
<span id="cb107-7"><a href="buenas-prácticas-de-programación.html#cb107-7" aria-hidden="true" tabindex="-1"></a><span class="kw">noisily</span> <span class="kw">_dots</span> ‘rep++’ ‘fail’</span>
<span id="cb107-8"><a href="buenas-prácticas-de-programación.html#cb107-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Se ejecuta hasta que logre 70 aciertos. En este ejemplo artificial, cada iteración tiene un éxito aleatorio con una probabilidad del 80%. Los éxitos se indican con un punto (.) y los fracasos con una x.</p>
</div>
</div>
<div id="manejo-de-bases-de-datos" class="section level3 hasAnchor" number="2.3.9">
<h3><span class="header-section-number">2.3.9</span> Manejo de bases de datos<a href="buenas-prácticas-de-programación.html#manejo-de-bases-de-datos" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="prefijo-by" class="section level4 hasAnchor" number="2.3.9.1">
<h4><span class="header-section-number">2.3.9.1</span> Prefijo: by<a href="buenas-prácticas-de-programación.html#prefijo-by" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Los prefijos en Stata ejecutan tareas repetitivas sin la necesidad de especificar el rango de valores sobre la tarea que es ejecutada. Un prefijo muy conocido es <code>by</code>. Por ejemplo, <code>by varlist [, sort]: command</code>. <code>command</code> es repetido para cada valor de la variable. Es más, repeticiones siguen el orden de la variable sea <em>string</em> o <em>numeric</em>.</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb108-1"><a href="buenas-prácticas-de-programación.html#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> bpress, <span class="kw">clear</span></span>
<span id="cb108-2"><a href="buenas-prácticas-de-programación.html#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="kw">bysort</span> sex agegrp: <span class="kw">summarize</span> bp </span></code></pre></div>
</div>
<div id="prefijo-xi" class="section level4 hasAnchor" number="2.3.9.2">
<h4><span class="header-section-number">2.3.9.2</span> Prefijo: xi<a href="buenas-prácticas-de-programación.html#prefijo-xi" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>xi</code> es útil para cuando queremos producir un variable indicador para las observaciones que son distintas entre si.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb109-1"><a href="buenas-prácticas-de-programación.html#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="kw">xi</span> i.agegrp</span></code></pre></div>
<p>El ejemplo le esta diciendo a Stata que genere variables indicadores. Esto es muy útil para reducir los códigos.</p>
<p>Interpretando prefijo xi: <code>xi</code> es comúnmente utilizado como un prefijo. La principal ventaja es cuando existen múltiples interacciones entre las variables.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb110-1"><a href="buenas-prácticas-de-programación.html#cb110-1" aria-hidden="true" tabindex="-1"></a>* Caso 1: incluye indicadores <span class="kw">de</span> ambas variables.</span>
<span id="cb110-2"><a href="buenas-prácticas-de-programación.html#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="kw">xi</span>: <span class="kw">regress</span> bp i.agegrp i.sex</span>
<span id="cb110-3"><a href="buenas-prácticas-de-programación.html#cb110-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-4"><a href="buenas-prácticas-de-programación.html#cb110-4" aria-hidden="true" tabindex="-1"></a>* Caso 2: incluye además interacciones entre ellas.</span>
<span id="cb110-5"><a href="buenas-prácticas-de-programación.html#cb110-5" aria-hidden="true" tabindex="-1"></a><span class="kw">xi</span>: <span class="kw">regress</span> bp i.agegrp*i.sex</span>
<span id="cb110-6"><a href="buenas-prácticas-de-programación.html#cb110-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-7"><a href="buenas-prácticas-de-programación.html#cb110-7" aria-hidden="true" tabindex="-1"></a>* Caso 3: Interactúa una <span class="kw">variable</span> continua con una discreta.</span>
<span id="cb110-8"><a href="buenas-prácticas-de-programación.html#cb110-8" aria-hidden="true" tabindex="-1"></a><span class="kw">xi</span>: <span class="kw">regress</span> bp i.agegrp*bp0</span>
<span id="cb110-9"><a href="buenas-prácticas-de-programación.html#cb110-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-10"><a href="buenas-prácticas-de-programación.html#cb110-10" aria-hidden="true" tabindex="-1"></a>* Caso 4: Incluye solo interacciones con <span class="kw">variable</span> continua (además <span class="kw">de</span> principal). </span>
<span id="cb110-11"><a href="buenas-prácticas-de-programación.html#cb110-11" aria-hidden="true" tabindex="-1"></a><span class="kw">xi</span>: <span class="kw">regress</span> bp i.agegrp|bp0 </span></code></pre></div>
</div>
<div id="prefijo-statsby" class="section level4 hasAnchor" number="2.3.9.3">
<h4><span class="header-section-number">2.3.9.3</span> Prefijo: statsby<a href="buenas-prácticas-de-programación.html#prefijo-statsby" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>statsby</code> permite ampliar <code>by</code>. Este último tiene la limitación de permitir únicamente un comando.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb111-1"><a href="buenas-prácticas-de-programación.html#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="kw">statsby</span> <span class="kw">mean</span>=<span class="fu">r</span>(<span class="kw">mean</span>) <span class="fu">sd</span>=<span class="fu">r</span>(<span class="fu">sd</span>) n=<span class="fu">r</span>(<span class="kw">N</span>), <span class="kw">by</span>(agegrp sex): <span class="kw">summarize</span> bp</span></code></pre></div>
<p>Se produce una nueva base de datos con una observación por grupo con los estadísticos incorporados. <strong>Útil para calcular estadística descriptiva</strong>.</p>
</div>
<div id="prefijo-rolling" class="section level4 hasAnchor" number="2.3.9.4">
<h4><span class="header-section-number">2.3.9.4</span> Prefijo: rolling<a href="buenas-prácticas-de-programación.html#prefijo-rolling" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>statsby</code> permite obtener estadísticas para sub-muestras que no se traslapan. <code>rolling</code> sirve para sub-muestras traslapadas. Por ejemplo, al trabajar con series de tiempo se quiere calcular estadísticas para datos que están traslapados (el. calcular una media móvil).</p>
<p>Vamos a calcular medias y medianas utilizando una ventana de 90 días:</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb112-1"><a href="buenas-prácticas-de-programación.html#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> ibm, <span class="kw">clear</span> </span>
<span id="cb112-2"><a href="buenas-prácticas-de-programación.html#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="kw">rolling</span> <span class="kw">mean</span>=<span class="fu">r</span>(<span class="kw">mean</span>) <span class="kw">median</span>=<span class="fu">r</span>(p50), <span class="kw">window</span>(90): <span class="kw">summarize</span> spx, <span class="kw">d</span> </span>
<span id="cb112-3"><a href="buenas-prácticas-de-programación.html#cb112-3" aria-hidden="true" tabindex="-1"></a><span class="kw">tsset</span> <span class="kw">end</span> </span>
<span id="cb112-4"><a href="buenas-prácticas-de-programación.html#cb112-4" aria-hidden="true" tabindex="-1"></a><span class="kw">tsline</span> <span class="kw">mean</span></span></code></pre></div>
<p><code>start</code> y <code>end</code> indican el inicio y fin de la ventana.</p>
</div>
<div id="merge-y-append" class="section level4 hasAnchor" number="2.3.9.5">
<h4><span class="header-section-number">2.3.9.5</span> Merge y Append<a href="buenas-prácticas-de-programación.html#merge-y-append" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Recomendaciones para utilizar merge</p>
<ul>
<li>Especifique siempre el tipo de fusión (1:1, m:1 o 1:m). Si no se especifica el tipo de fusión, se llama a la versión antigua y no robusta de la fusión.</li>
<li>Nunca haga fusiones de muchos a muchos (m:m), o al menos, sólo hágalo cuando tenga una muy buena razón.</li>
<li>Incluya siempre la opción <code>assert()</code> para indicar qué patrón de observaciones coincidentes espera.</li>
<li>Incluya siempre la opción <code>keep()</code> para indicar qué observaciones deben conservarse del conjunto de datos fusionados.</li>
<li>Siempre que sea posible, incluya la opción <code>keepusing()</code> y enumere explícitamente qué variables pretende añadir al conjunto de datos; puede incluir esta opción incluso cuando mantenga todas las variables de los datos utilizados.</li>
<li>Utilice la opción <code>nogen</code>, excepto cuando piense utilizar explícitamente la variable <code>_merge</code> más adelante. Nunca debe guardar un conjunto de datos que tenga <code>_merge</code>; si necesita esta variable más adelante, dele un nombre más informativo.</li>
</ul>
<p>Con respecto a especificar <code>_merge</code> y <code>assert</code> notar que:</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb113-1"><a href="buenas-prácticas-de-programación.html#cb113-1" aria-hidden="true" tabindex="-1"></a>     <span class="kw">merge</span> ..., <span class="kw">assert</span>(<span class="fu">match</span> master) <span class="kw">keep</span>(<span class="fu">match</span>)</span>
<span id="cb113-2"><a href="buenas-prácticas-de-programación.html#cb113-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-3"><a href="buenas-prácticas-de-programación.html#cb113-3" aria-hidden="true" tabindex="-1"></a>     * Es equivalente a: </span>
<span id="cb113-4"><a href="buenas-prácticas-de-programación.html#cb113-4" aria-hidden="true" tabindex="-1"></a>     <span class="kw">merge</span> ...</span>
<span id="cb113-5"><a href="buenas-prácticas-de-programación.html#cb113-5" aria-hidden="true" tabindex="-1"></a>     <span class="kw">assert</span> <span class="dt">_merge</span>==1 | <span class="dt">_merge</span>==3</span>
<span id="cb113-6"><a href="buenas-prácticas-de-programación.html#cb113-6" aria-hidden="true" tabindex="-1"></a>     <span class="kw">keep</span> <span class="kw">if</span> <span class="dt">_merge</span>==3</span></code></pre></div>
<p>Append con ciudado:</p>
<ul>
<li>El comando <code>append</code> es muy útil para manejos de bases de datos. Una precaución común es con respecto al nombre de las variables. Si dos variables (ej. PRECIO y precio) difieren, se generaran dos columnas nuevas al hacer el <code>append</code> en vez de una.</li>
<li>Una precaución un poco menos conocida guarda relación con el tipo de variables. ¿Qué ocurre si dos variables se llaman igual, pero <strong>estan guardadas en formatos distintos</strong>?</li>
<li>En este caso, el orden en el cual se combine la base de datos va a importar y puede generar diferencias al momento de pegar datos. Esto es especialmente importante cuando una variable esta guardada en numérico en una base de datos y en <code>string</code> en la otra.</li>
</ul>
<p>Veamos un ejemplo con la base <code>auto.dta</code>. Vamos a crear dos bases de datos según la procedencia de los autos y ejecutar el comando <code>append</code>.</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb114-1"><a href="buenas-prácticas-de-programación.html#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto </span>
<span id="cb114-2"><a href="buenas-prácticas-de-programación.html#cb114-2" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> <span class="kw">if</span> foreign</span>
<span id="cb114-3"><a href="buenas-prácticas-de-programación.html#cb114-3" aria-hidden="true" tabindex="-1"></a><span class="kw">save</span> autodom </span>
<span id="cb114-4"><a href="buenas-prácticas-de-programación.html#cb114-4" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto </span>
<span id="cb114-5"><a href="buenas-prácticas-de-programación.html#cb114-5" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> <span class="kw">if</span> !foreign </span>
<span id="cb114-6"><a href="buenas-prácticas-de-programación.html#cb114-6" aria-hidden="true" tabindex="-1"></a><span class="kw">rename</span> foreign nondom </span>
<span id="cb114-7"><a href="buenas-prácticas-de-programación.html#cb114-7" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> str foreign = <span class="st">&quot;foreign&quot;</span> <span class="kw">if</span> nondom </span>
<span id="cb114-8"><a href="buenas-prácticas-de-programación.html#cb114-8" aria-hidden="true" tabindex="-1"></a><span class="kw">save</span> autofor</span>
<span id="cb114-9"><a href="buenas-prácticas-de-programación.html#cb114-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-10"><a href="buenas-prácticas-de-programación.html#cb114-10" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> autdom </span>
<span id="cb114-11"><a href="buenas-prácticas-de-programación.html#cb114-11" aria-hidden="true" tabindex="-1"></a><span class="kw">append</span> <span class="kw">using</span> autofor </span>
<span id="cb114-12"><a href="buenas-prácticas-de-programación.html#cb114-12" aria-hidden="true" tabindex="-1"></a><span class="kw">describe</span> foreign </span></code></pre></div>
<p>Notar que <code>append</code> genera el siguiente mensaje: <code>foreign is str 7 in using data byt will be byte now</code>. Noten que el contenido de la variable string se ha perdido: 22 casos son ahora <em>missing</em>.</p>
<p>¿Qué ocurre si hacemos el proceso al revés? Vamos a cargar autos extranjeros y le vamos a pegar autos domésticos:</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb115-1"><a href="buenas-prácticas-de-programación.html#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> autfor </span>
<span id="cb115-2"><a href="buenas-prácticas-de-programación.html#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="kw">append</span> <span class="kw">using</span> autodom, <span class="kw">force</span></span>
<span id="cb115-3"><a href="buenas-prácticas-de-programación.html#cb115-3" aria-hidden="true" tabindex="-1"></a><span class="kw">describe</span> foreign </span>
<span id="cb115-4"><a href="buenas-prácticas-de-programación.html#cb115-4" aria-hidden="true" tabindex="-1"></a><span class="kw">codebook</span> foreign</span></code></pre></div>
<p>El formato de los datos de la primer base de datos manda.
* No utilizar force sin cuidado.
* Con distintos tipos de datos, <code>append</code> es sensible al orden en que los archivos son pegados. <strong>Tener cuidado y revisar consistencia en los datos</strong>. Hacer test aquí tambíen es importante.</p>

</div>
</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-chang2015economics" class="csl-entry">
Chang, Andrew C, and Phillip Li. 2015. <span>“Is Economics Research Replicable? Sixty Published Papers from Thirteen Journals Say’usually Not’.”</span>
</div>
<div id="ref-christensen2018transparency" class="csl-entry">
Christensen, Garret, and Edward Miguel. 2018. <span>“Transparency, Reproducibility, and the Credibility of Economics Research.”</span> <em>Journal of Economic Literature</em> 56 (3): 920–80.
</div>
<div id="ref-gentzkow2014code" class="csl-entry">
Gentzkow, Matthew, and Jesse M Shapiro. 2014. <span>“Code and Data for the Social Sciences: A Practitioner’s Guide.”</span> <em>Chicago, IL: University of Chicago</em>.
</div>
<div id="ref-long2009workflow" class="csl-entry">
Long, J Scott, and J Scott Long. 2009. <em>The Workflow of Data Analysis Using Stata</em>. Stata Press College Station, TX.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="programar-ado---files.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/ncamposbijit/ncamposbijit/Analisis-de-Datos-Stata-nivel-avanzado/edit/main/02-Cap2.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/ncamposbijit/ncamposbijit/Analisis-de-Datos-Stata-nivel-avanzado/blob/main/02-Cap2.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
