<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>3 Programar do - files | Análisis de Datos con Stata, R y Python</title>
<meta name="author" content="Nicolás Campos Bijit">
<meta name="generator" content="bookdown 0.32 with bs4_book()">
<meta property="og:title" content="3 Programar do - files | Análisis de Datos con Stata, R y Python">
<meta property="og:type" content="book">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="3 Programar do - files | Análisis de Datos con Stata, R y Python">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.0/transition.js"></script><script src="libs/bs3compat-0.4.0/tabs.js"></script><script src="libs/bs3compat-0.4.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="style4.css">
<meta name="description" content="3.0.1 Programar en Stata Esta sección esta basada en: An introduction to Stata Programing (), en notas de clase de la profesora Erin Hengel, en Advanced Stata Topics del profesor Alexander C....">
<meta property="og:description" content="3.0.1 Programar en Stata Esta sección esta basada en: An introduction to Stata Programing (), en notas de clase de la profesora Erin Hengel, en Advanced Stata Topics del profesor Alexander C....">
<meta name="twitter:description" content="3.0.1 Programar en Stata Esta sección esta basada en: An introduction to Stata Programing (), en notas de clase de la profesora Erin Hengel, en Advanced Stata Topics del profesor Alexander C....">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Análisis de Datos con Stata, R y Python</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Introducción</a></li>
<li><a class="" href="buenas-pr%C3%A1cticas-de-programaci%C3%B3n-y-visualizaci%C3%B3n.html"><span class="header-section-number">2</span> Buenas prácticas de programación y visualización</a></li>
<li><a class="active" href="programar-do---files.html"><span class="header-section-number">3</span> Programar do - files</a></li>
<li><a class="" href="programar-ado---files.html"><span class="header-section-number">4</span> Programar ado - files</a></li>
<li><a class="" href="exportar-informaci%C3%B3n.html"><span class="header-section-number">5</span> Exportar Información</a></li>
<li><a class="" href="manejo-de-grandes-bases-de-datos-en-stata.html"><span class="header-section-number">6</span> Manejo de grandes bases de datos en Stata</a></li>
<li><a class="" href="mata.html"><span class="header-section-number">7</span> Mata</a></li>
<li><a class="" href="an%C3%A1lisis-de-datos-con-python.html"><span class="header-section-number">8</span> Análisis de Datos con Python</a></li>
<li><a class="" href="an%C3%A1lisis-de-datos-con-r.html"><span class="header-section-number">9</span> Análisis de datos con R</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="programar-do---files" class="section level1" number="3">
<h1>
<span class="header-section-number">3</span> Programar do - files<a class="anchor" aria-label="anchor" href="#programar-do---files"><i class="fas fa-link"></i></a>
</h1>
<div id="programar-en-stata" class="section level3" number="3.0.1">
<h3>
<span class="header-section-number">3.0.1</span> Programar en Stata<a class="anchor" aria-label="anchor" href="#programar-en-stata"><i class="fas fa-link"></i></a>
</h3>
<p>Esta sección esta basada en: <strong>An introduction to Stata Programing</strong> (), en notas de clase de la profesora <a href="https://www.erinhengel.com/">Erin Hengel</a>, en <strong>Advanced Stata Topics</strong> del profesor Alexander C. Lembcke, en <strong>Seventy-six Stata tips</strong> , en <strong>Top 10 ``gotchas”</strong> de y en <strong>Data Management Using Stata. A Practical Handbook</strong> de .</p>
<div id="qué-es-programar-en-stata" class="section level4" number="3.0.1.1">
<h4>
<span class="header-section-number">3.0.1.1</span> ¿Qué es programar en Stata?<a class="anchor" aria-label="anchor" href="#qu%C3%A9-es-programar-en-stata"><i class="fas fa-link"></i></a>
</h4>
<p>Programar en Stata es:</p>
<ul>
<li>Escribir <code>do - files</code>: una secuencia de comandos ejecutables a través de un archivo <code>.do</code>.</li>
<li>Escribir los que formalmente en Stata es un <em>programa</em>: un conjunto de comandos que incluyen el comando <code>program</code>. Un programa en Stata se guarda como un <em>ado - file</em>.</li>
<li>Escribir lenguaje de programación matricial: denominado mata.</li>
</ul>
</div>
<div id="do---files" class="section level4" number="3.0.1.2">
<h4>
<span class="header-section-number">3.0.1.2</span> do - files<a class="anchor" aria-label="anchor" href="#do---files"><i class="fas fa-link"></i></a>
</h4>
<p>El uso de <code>do-file</code> garantiza la replicabilidad del análisis de datos utilizando Stata. Recordar que un <code>do-file</code> puede llamar a otros (ej. <code>master do.file</code>. La jerarquización de los <code>do-file</code> puede ser importante para proyectos grandes o complejos. Es importante evitar trabajar en Stata interactivamente. Únicamente hay que hacerlo para inspeccionar datos (recordar practicas Sección 3.1).</p>
</div>
<div id="ado---files" class="section level4" number="3.0.1.3">
<h4>
<span class="header-section-number">3.0.1.3</span> ado - files<a class="anchor" aria-label="anchor" href="#ado---files"><i class="fas fa-link"></i></a>
</h4>
<p>Sirven para crear tus propios en Stata. Una vez que armes tu programa y lo guardes en la carpeta de <code>ado-file</code> puedes utilizarlo como cualquier otro comando de Stata. Por ejemplo, puedes agregar las opciones <em>if</em>, <em>in range</em> y otras. También puedes escribir un documento de ayuda (<em>help</em>} que explique el programa. Crear tus propios comandos es una muy buena forma de ser más eficiente al trabajar con Stata (recordar Sección 1).</p>
<p>Mata para ado-files: Los <code>ado-files</code> pueden realizar tareas más complejas que involucren ejecutar el comando múltiples veces.</p>
<ul>
<li>El lenguaje de programación mata es mucho más rápido que un <code>ado-file</code>.</li>
<li>Útil para realizar tareas que sean intensivas computacionalmente.</li>
<li>No es solo un lenguajes de programación que utiliza matrices. También sirve para tareas que involucran texto o listas.</li>
<li>Próximante discutiremos este lenguaje.</li>
</ul>
</div>
</div>
<div id="comandos-y-funciones-claves-y-algunos-detalles" class="section level3" number="3.0.2">
<h3>
<span class="header-section-number">3.0.2</span> Comandos y funciones claves (y algunos detalles)}<a class="anchor" aria-label="anchor" href="#comandos-y-funciones-claves-y-algunos-detalles"><i class="fas fa-link"></i></a>
</h3>
<p>Revisaremos algunos aspectos necesarios para mejorar la eficiencia al trabajar en Stata.</p>
<ul>
<li>Directorios y uso de <code>profile.do</code>.</li>
<li>Tipos de comandos.</li>
<li>Tipos de datos y uso de <code>compress</code>.</li>
<li>Uso de <code>capture</code>, <code>preserve</code> y <code>restore</code>.</li>
</ul>
<div id="directorios" class="section level4" number="3.0.2.1">
<h4>
<span class="header-section-number">3.0.2.1</span> Directorios<a class="anchor" aria-label="anchor" href="#directorios"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>
<code>cd</code> y <code>pwd</code> sirven para fijar y conocer mis directorios. Es importante utilizar <strong>dobles comillas</strong> en los casos en que la ruta del directorio tenga espacios.</li>
<li>El comando <code>sysdir</code> provee una lista de los directorios importantes para Stata.</li>
<li>El comando <code>update</code> sirve para actualizar los comandos.</li>
<li>La carpeta <code>PLUS</code> es el directorio donde se guardan comandos descargados. Si utilizas <code>ssc</code>, se guardara en esta carpeta.<br>
</li>
<li>
<code>PERSONAL</code> para tus propios <code>ado-files</code>.</li>
</ul>
</div>
<div id="profile-do" class="section level4" number="3.0.2.2">
<h4>
<span class="header-section-number">3.0.2.2</span> Profile do<a class="anchor" aria-label="anchor" href="#profile-do"><i class="fas fa-link"></i></a>
</h4>
<p>¿Qué es profile do?</p>
<ul>
<li>Una opción no tan conocida es la utilización de <code>profile.do</code>
</li>
<li>Este archivo se ejecuta cada vez que Stata se inicia. Si no tienes uno guardado no pasa nada.</li>
<li>Este <code>do-file</code> permite, por ejemplo, fijar tu directorio de trabajo inicial, cambiar características de los gráficos, generar atajos.<br>
</li>
<li>También se puede hacer que Stata abra un log-file y lo guarde siempre en el mismo lugar.</li>
<li>Cada vez que inicies sesión Stata ira por <code>profile.do</code>. Si lo encuentra lo va a ejecutar.<br>
</li>
<li>Stata recomienda guardar <code>profile.do</code> en <em>home directory</em> (ver <em>help profilew para ususarios de windows y profilem para Mac</em>).</li>
<li>Vamos a ver como modificar <code>profile.do</code>. En particular:
<ul>
<li>Ajustes generales.</li>
<li>Establecer las características de los gráficos.</li>
<li>Establecer atajos</li>
<li>Abrir, cerrar y guardar un log-file con la fecha.</li>
</ul>
</li>
</ul>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.3.1:</b></p>
<p>Instrucciones</p>
<ol style="list-style-type: decimal">
<li>Descargar carpeta <em>ejercicios-clase3</em>.</li>
<li>Abrir <code>profile.do</code> e inspeccionar cada una de las lineas del código.</li>
</ol>
<p>Preguntas</p>
<ol style="list-style-type: decimal">
<li>Agrega dos elementos a alguna sección.</li>
<li>Modifica las carpetas según las características de tu computadora.</li>
<li>Guarda <code>profile.do</code> en el <em>home directory</em>. Ejecutar nuevamente Stata y verificar que el código se ha ejecutado.</li>
</ol>
</div>
</div>
<div id="tipos-de-comandos" class="section level4" number="3.0.2.3">
<h4>
<span class="header-section-number">3.0.2.3</span> Tipos de comandos<a class="anchor" aria-label="anchor" href="#tipos-de-comandos"><i class="fas fa-link"></i></a>
</h4>
<p>Comandos r-class y e-class</p>
<ul>
<li>Muchos comandos en Stata (ej. <code>summarize</code>, <code>correlate</code>, <code>regress</code>) hacen que sea posible utilizar sus resultados una vez que estos son ejecutados.</li>
<li>
<code>summarize</code> y <code>correlate</code> son comandos <code>r-class</code>. Es decir, comandos que guardan sus resultados en <code>r()</code>.</li>
<li>
<code>regress</code> es un comando <code>e-class</code>. Es decir, comandos que guardan sus resultados en <code>e()</code>.</li>
<li>
<code>return list</code> retorna los valores guardados en <code>r()</code>
</li>
</ul>
<div class="sourceCode" id="cb31"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb31-1"><a href="programar-do---files.html#cb31-1" aria-hidden="true" tabindex="-1"></a>* <span class="fu">r</span>-<span class="kw">class</span></span>
<span id="cb31-2"><a href="programar-do---files.html#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto.dta, <span class="kw">clear</span> </span>
<span id="cb31-3"><a href="programar-do---files.html#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="kw">summarize</span> mpg </span>
<span id="cb31-4"><a href="programar-do---files.html#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span> <span class="ot">list</span> </span>
<span id="cb31-5"><a href="programar-do---files.html#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="programar-do---files.html#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="kw">summarize</span> mpg, <span class="kw">detail</span> </span>
<span id="cb31-7"><a href="programar-do---files.html#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span> <span class="ot">list</span> </span>
<span id="cb31-8"><a href="programar-do---files.html#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"La asimetría de mpg es"</span> <span class="fu">r</span>(skewness) </span>
<span id="cb31-9"><a href="programar-do---files.html#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="kw">summarize</span> price, <span class="kw">detail</span> </span>
<span id="cb31-10"><a href="programar-do---files.html#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span> <span class="ot">list</span> </span></code></pre></div>
<p>Su limitación es que solo están disponibles los valores del último comando <code>r-class</code> ejecutado.</p>
<p>Los comandos <code>e-class</code> son comandos de <em>estimación</em>. Para verlos <code>ereturn list</code> y para llamarlos individualmente <code>e(nombre)</code>. Guardan más información que los de <code>r-class</code> : matrices, vectores y funciones. La información de los comandos <code>e-class</code> sigue estando disponible una vez que utilizamos algún comando <code>r</code>-class`. <strong>Aquí una diferencia!</strong></p>
<p>Un ejemplo clásico son las estimaciones de regresión lineal.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb32-1"><a href="programar-do---files.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="kw">regress</span> mpg <span class="kw">weight</span> <span class="fu">length</span> rep78 </span>
<span id="cb32-2"><a href="programar-do---files.html#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"La regresión se estimo para "</span> <span class="fu">e</span>(<span class="kw">N</span>) <span class="st">" observaciones."</span> </span>
<span id="cb32-3"><a href="programar-do---files.html#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="kw">ereturn</span> <span class="ot">list</span></span></code></pre></div>
<p>En general cualquier comando de estimación se guarda en esta clase de formato.</p>
</div>
<div id="tipos-de-datos" class="section level4" number="3.0.2.4">
<h4>
<span class="header-section-number">3.0.2.4</span> Tipos de datos<a class="anchor" aria-label="anchor" href="#tipos-de-datos"><i class="fas fa-link"></i></a>
</h4>
<p>numeric y string</p>
<ul>
<li>La mayor distinción entre tipos de datos es entre <em>numeric</em> y <em>string</em>.</li>
<li>Al trabajar con datos muchas veces es necesario realizar conversiones entre estos dos formatos. Los comandos <code>destring</code>, <code>tostring</code> y <code>encode</code> son útiles para estas tareas (si alguien tiene dudas con alguno me escriben).</li>
<li>
<em>strings</em> pueden soportar un máximo de 244 caracteres con un <code>byte</code> por cada carácter.</li>
<li>Por ejemplo, una variable del tipo <code>str20</code> requiere 20 <code>bytes</code> por observación.</li>
</ul>
<p>Clasificación de los datos</p>
<ul>
<li>Para las variables en formato <em>numeric</em> los tipos de datos son: <code>byte</code>, <code>int</code>, <code>long</code>, <code>float</code> y <code>double</code>.</li>
<li>Los tres primeros solo puede almacenar valores enteros. <code>long</code> puede almacenar todos los números de 9 dígitos, pero es limitado para 10 dígitos.</li>
<li>
<code>float</code> y <code>double</code> pueden almacenar números grandes.</li>
<li>No asumir que <code>float</code> será aritméticamente exacto. Por ejemplo:</li>
</ul>
<div class="sourceCode" id="cb33"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb33-1"><a href="programar-do---files.html#cb33-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">float</span>(16777216)</span>
<span id="cb33-2"><a href="programar-do---files.html#cb33-2" aria-hidden="true" tabindex="-1"></a>        16777216</span>
<span id="cb33-3"><a href="programar-do---files.html#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">float</span>(16777217)</span>
<span id="cb33-4"><a href="programar-do---files.html#cb33-4" aria-hidden="true" tabindex="-1"></a>        16777216</span></code></pre></div>
<p>¿Como utilizar esto para programar efectivamente en Stata?</p>
<ul>
<li>IDs con muchos dígitos (y caracteres) guardarlos como <em>string</em>. No como <code>integers</code>, <code>float</code> o <code>doubles</code>.</li>
<li>No confiar en test exactos contra una constante con datos en formato <code>float</code>. Utilizar formato <code>double</code> para cualquier serie que necesita ser precisa (ej. suma de los residuos de una regresión).</li>
<li>Utiliza <code>integers</code> cuando sea apropiado (ej. variables dicotómicas). Guardar valores como <code>int</code> o <code>byte</code> ayuda a utilizar de forma más eficiente el espacio en el disco.</li>
<li>
<code>compress</code> examina cada variable y determina si estas pueden ser guardadas de forma más eficiente. <strong>Utilizarlo</strong>.</li>
</ul>
<p>Si se especifican valores iniciales fuera de los rangos permitidos para cada tipo de dato el resultado será un <em>missing</em>.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb34-1"><a href="programar-do---files.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span> <span class="ot">all</span> </span>
<span id="cb34-2"><a href="programar-do---files.html#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="kw">obs</span> 10 </span>
<span id="cb34-3"><a href="programar-do---files.html#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> <span class="kw">byte</span> var1 = 101</span>
<span id="cb34-4"><a href="programar-do---files.html#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="kw">summarize</span> var1 </span></code></pre></div>
<p>Notar que no se genera ninguna alerta de <em>missing</em> cuando este se crea. Esto es distinto para variables que ya existen.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb35-1"><a href="programar-do---files.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span> <span class="ot">all</span></span>
<span id="cb35-2"><a href="programar-do---files.html#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="kw">obs</span> 10</span>
<span id="cb35-3"><a href="programar-do---files.html#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> <span class="kw">byte</span> var1 = 1</span>
<span id="cb35-4"><a href="programar-do---files.html#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> var1 = 101</span></code></pre></div>
<p>Si el valor esta fuera de los rangos permitidos, la variable se guarda en un formato mayor. <code>byte</code> a <code>int</code>, <code>int</code> a <code>long</code>, a <code>float</code> a <code>double</code>. En este caso un mensaje aparece.</p>
</div>
<div id="capture-preserve-y-restore" class="section level4" number="3.0.2.5">
<h4>
<span class="header-section-number">3.0.2.5</span> capture, preserve y restore<a class="anchor" aria-label="anchor" href="#capture-preserve-y-restore"><i class="fas fa-link"></i></a>
</h4>
<p>Manejando errores: capture</p>
<ul>
<li>Sirve para evitar que Stata aborte cuando detecta un error.</li>
<li>Bueno para cuando quieres borrar algo que ya no se encuentra. Lo malo es que suprime todos los errores y oculta todo lo que puede ir mal.</li>
</ul>
<div class="sourceCode" id="cb36"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb36-1"><a href="programar-do---files.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="kw">obs</span> 10</span>
<span id="cb36-2"><a href="programar-do---files.html#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> <span class="kw">byte</span> var1 = 5</span>
<span id="cb36-3"><a href="programar-do---files.html#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> <span class="kw">byte</span> var2 = 10 </span>
<span id="cb36-4"><a href="programar-do---files.html#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="kw">capture</span> <span class="kw">drop</span> var1 var2 var3 </span>
<span id="cb36-5"><a href="programar-do---files.html#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">describe</span> var1 var2</span></code></pre></div>
<p>Código crea <code>var1</code> y <code>var2</code>, luego las elimina incluyendo una variable que no existe. Al contrario de lo que se intuye, no se borran las variables, dado que hay una variable que no existe. La recomendación es siempre utilizar <code>capture</code> con moderación. Puede ser utilizado en bloque para así no tener que utilizarlo en cada linea.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb37-1"><a href="programar-do---files.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto.dta, <span class="kw">clear</span></span>
<span id="cb37-2"><a href="programar-do---files.html#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="kw">capture</span>{</span>
<span id="cb37-3"><a href="programar-do---files.html#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> price mpg-trunk</span>
<span id="cb37-4"><a href="programar-do---files.html#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> price mpg-<span class="kw">weight</span></span>
<span id="cb37-5"><a href="programar-do---files.html#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> price mpg-foreign</span>
<span id="cb37-6"><a href="programar-do---files.html#cb37-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-7"><a href="programar-do---files.html#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="kw">ereturn</span> <span class="ot">list</span> </span></code></pre></div>
<p>preserve y restore</p>
<ul>
<li>Algunos comandos en Stata remplazan la base actual por una nueva (ej. <code>collapse</code> o <code>contract</code>).</li>
<li>Utilizar <code>preserve</code> y <code>restore</code> es útil en estos casos.</li>
<li>En caso de que queramos obtener estadística descriptiva agregada y asociarla a observaciones podemos utilizar estos comandos.</li>
</ul>
<div class="sourceCode" id="cb38"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb38-1"><a href="programar-do---files.html#cb38-1" aria-hidden="true" tabindex="-1"></a>* Ejemplo con <span class="kw">collapse</span></span>
<span id="cb38-2"><a href="programar-do---files.html#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto.dta, <span class="kw">clear</span></span>
<span id="cb38-3"><a href="programar-do---files.html#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> lprice = <span class="fu">log</span>(price)</span>
<span id="cb38-4"><a href="programar-do---files.html#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="kw">preserve</span></span>
<span id="cb38-5"><a href="programar-do---files.html#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="kw">collapse</span> (<span class="fu">max</span>) max_lprice=lprice max_mpg=mpg <span class="co">///</span></span>
<span id="cb38-6"><a href="programar-do---files.html#cb38-6" aria-hidden="true" tabindex="-1"></a>(<span class="fu">iqr</span>) iqr_lprince = lprice iqr_mpg = mpg <span class="kw">if</span> !<span class="fu">missing</span>(rep78), <span class="kw">by</span>(rep78) </span>
<span id="cb38-7"><a href="programar-do---files.html#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="kw">sort</span> rep78 </span>
<span id="cb38-8"><a href="programar-do---files.html#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="kw">tempfile</span> repstats</span>
<span id="cb38-9"><a href="programar-do---files.html#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="kw">save</span> <span class="ot">`repstats'</span></span>
<span id="cb38-10"><a href="programar-do---files.html#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="kw">restore</span> </span>
<span id="cb38-11"><a href="programar-do---files.html#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="kw">sort</span> rep78 </span>
<span id="cb38-12"><a href="programar-do---files.html#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="kw">merge</span> <span class="fu">m</span>:1 rep78 <span class="kw">using</span> <span class="ot">`repstats'</span></span>
<span id="cb38-13"><a href="programar-do---files.html#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="kw">assert</span> <span class="dt">_merge</span> != 2</span>
<span id="cb38-14"><a href="programar-do---files.html#cb38-14" aria-hidden="true" tabindex="-1"></a><span class="kw">summarize</span> lprice max_lprice max_mpg </span>
<span id="cb38-15"><a href="programar-do---files.html#cb38-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-16"><a href="programar-do---files.html#cb38-16" aria-hidden="true" tabindex="-1"></a>* Ejemplo con <span class="kw">contract</span></span>
<span id="cb38-17"><a href="programar-do---files.html#cb38-17" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto.dta, <span class="kw">clear</span></span>
<span id="cb38-18"><a href="programar-do---files.html#cb38-18" aria-hidden="true" tabindex="-1"></a><span class="kw">preserve</span></span>
<span id="cb38-19"><a href="programar-do---files.html#cb38-19" aria-hidden="true" tabindex="-1"></a><span class="kw">contract</span> mpg, <span class="kw">cfreq</span>(cumfreq) <span class="kw">percent</span>(percentage) <span class="kw">cpercent</span>(cumpercent)</span>
<span id="cb38-20"><a href="programar-do---files.html#cb38-20" aria-hidden="true" tabindex="-1"></a><span class="kw">sort</span> mpg </span>
<span id="cb38-21"><a href="programar-do---files.html#cb38-21" aria-hidden="true" tabindex="-1"></a><span class="kw">tempfile</span> mpgfreq</span>
<span id="cb38-22"><a href="programar-do---files.html#cb38-22" aria-hidden="true" tabindex="-1"></a><span class="kw">save</span> <span class="ot">`mpgfreq'</span></span>
<span id="cb38-23"><a href="programar-do---files.html#cb38-23" aria-hidden="true" tabindex="-1"></a><span class="kw">restore</span> </span>
<span id="cb38-24"><a href="programar-do---files.html#cb38-24" aria-hidden="true" tabindex="-1"></a><span class="kw">sort</span> mpg</span>
<span id="cb38-25"><a href="programar-do---files.html#cb38-25" aria-hidden="true" tabindex="-1"></a><span class="kw">merge</span> <span class="fu">m</span>:1 mpg <span class="kw">using</span> <span class="ot">`mpgfreq'</span></span>
<span id="cb38-26"><a href="programar-do---files.html#cb38-26" aria-hidden="true" tabindex="-1"></a><span class="kw">assert</span> <span class="dt">_merge</span> != 2</span>
<span id="cb38-27"><a href="programar-do---files.html#cb38-27" aria-hidden="true" tabindex="-1"></a><span class="kw">summarize</span> _freq cumfreq percentage cumpercent</span></code></pre></div>
</div>
<div id="missing-values" class="section level4" number="3.0.2.6">
<h4>
<span class="header-section-number">3.0.2.6</span> Missing values<a class="anchor" aria-label="anchor" href="#missing-values"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>En general uno utiliza <code>if variable !=.</code> para evitar incluir <strong>missings</strong>.</li>
<li>Mejor practica es <code>variable &lt;.</code> para excluir todos los valores en <em>missing</em>. Otra opción es <code>if !missing(variable)</code>.</li>
<li>Los <em>missing</em> están codificados internamente como valores mayores a cualquier número. El menor valor de todos los <em>missing</em> es el punto. Al utilizar <code>if variable &lt;.</code> es como decir, solo utiliza los números.</li>
<li>Como vimos en la Sección 3.1 hay muchos problemas al no tratar bien los <em>missings</em>. Este problema se incrementa al momento de trabajar con bases de datos imposibles de inspeccionar. Veremos algunas recomendaciones que pueden ser utiles para evitar estos errores.</li>
</ul>
<p>Los comandos tratan distinto a los missings</p>
<ul>
<li>Cualquier función de datos <em>missing</em> será <em>missing</em>.</li>
<li>Cuando se calcula un promedio o una desviación estándar solo valores no missing son considerados (ej. <code>sum</code>).<br>
</li>
<li>Algunos comandos en Stata manejan los <em>missing</em> de otras formas. Por ejemplo, las funciones <code>max</code>, <code>min</code> y las funciones para filas de <code>egen</code>: <code>rowmax()</code>, <code>rowmean()</code>, <code>rowmin()</code>, <code>rowsd()</code> y <code>rowtotal()</code> ignoran los <em>missing</em>. Por ejemplo, <code>rowmean(x1,x2,x3)</code> calcula el promedio de las variables y solo retornara <em>missing</em> si todas lo son.</li>
<li>Por ejemplo, <code>rowmean(x1,x2,x3)</code> calcula el promedio de las variables y solo retornara <em>missing</em> si todas lo son.</li>
<li>
<code>collapse (sum)</code> trata a los <em>missing</em> como ceros.</li>
</ul>
<p>Calcular un promedio con missings</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb39-1"><a href="programar-do---files.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span></span>
<span id="cb39-2"><a href="programar-do---files.html#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="kw">obs</span> 10 </span>
<span id="cb39-3"><a href="programar-do---files.html#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> var1 = rnormal()</span>
<span id="cb39-4"><a href="programar-do---files.html#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> var2 = 5 </span>
<span id="cb39-5"><a href="programar-do---files.html#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> var3 = .</span>
<span id="cb39-6"><a href="programar-do---files.html#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> promedio = (var1 + var2 + var3)/3</span>
<span id="cb39-7"><a href="programar-do---files.html#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> promedio1 = <span class="fu">rowmean</span>(var1 var2 var3)</span></code></pre></div>
<p>PromedioSinMissing da como resultado <em>missings</em>. PromedioConMissing no considera <em>missings</em>. Es importante tratar de entender como funcionan los <code>missings</code> de los comandos que utilizas.</p>
<p>Generar variables considerando missings: Al crear una variable <em>dicotómica</em>, <code>gen</code> y <code>gen byte</code> tratan a los <em>missing</em> de formas distintas.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb40-1"><a href="programar-do---files.html#cb40-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span> <span class="kw">N</span> = 500</span>
<span id="cb40-2"><a href="programar-do---files.html#cb40-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> <span class="kw">obs</span> <span class="ot">`N'</span></span>
<span id="cb40-3"><a href="programar-do---files.html#cb40-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">gen</span> indicador = uniform() &lt; .5</span>
<span id="cb40-4"><a href="programar-do---files.html#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">replace</span> indicador =. <span class="kw">if</span> <span class="fu">mod</span>(<span class="dt">_n</span>, 2) == 0</span>
<span id="cb40-5"><a href="programar-do---files.html#cb40-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-6"><a href="programar-do---files.html#cb40-6" aria-hidden="true" tabindex="-1"></a>    * Si indicador es <span class="fu">missing</span>, <span class="kw">variable</span> sera <span class="fu">missing</span></span>
<span id="cb40-7"><a href="programar-do---files.html#cb40-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">gen</span> variable_primercaso = 1 <span class="kw">if</span> indicador == 1 </span>
<span id="cb40-8"><a href="programar-do---files.html#cb40-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">replace</span> variable_primercaso = 0 <span class="kw">if</span> indicador == 0</span>
<span id="cb40-9"><a href="programar-do---files.html#cb40-9" aria-hidden="true" tabindex="-1"></a>    * Si indicador es <span class="fu">missing</span>, <span class="kw">variable</span> sera cero. </span>
<span id="cb40-10"><a href="programar-do---files.html#cb40-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">gen</span> variable_segundocaso=(indicador==1)</span>
<span id="cb40-11"><a href="programar-do---files.html#cb40-11" aria-hidden="true" tabindex="-1"></a>    \<span class="kw">end</span>{minted}</span>
<span id="cb40-12"><a href="programar-do---files.html#cb40-12" aria-hidden="true" tabindex="-1"></a>    \<span class="kw">end</span>{itemize}</span></code></pre></div>
<p><code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code> considera <em>missing</em> como ceros.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb41-1"><a href="programar-do---files.html#cb41-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">clear</span> <span class="ot">all</span> </span>
<span id="cb41-2"><a href="programar-do---files.html#cb41-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> <span class="kw">obs</span> 4 </span>
<span id="cb41-3"><a href="programar-do---files.html#cb41-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">generate</span> <span class="kw">byte</span> var1 = <span class="fu">cond</span>(<span class="fu">mod</span>(<span class="dt">_n</span>,2)==1, 1, .)</span>
<span id="cb41-4"><a href="programar-do---files.html#cb41-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">generate</span> <span class="kw">byte</span> var1sum = <span class="kw">sum</span>(var1)</span>
<span id="cb41-5"><a href="programar-do---files.html#cb41-5" aria-hidden="true" tabindex="-1"></a>    <span class="ot">list</span>, <span class="kw">noobs</span></span></code></pre></div>
<p><code><a href="https://rdrr.io/r/base/Extremes.html">max()</a></code> trata a los <em>missing</em> como si no estuviesen allí.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb42-1"><a href="programar-do---files.html#cb42-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">display</span> <span class="fu">max</span>(-5,.)</span></code></pre></div>
<p>tabmiss, mvdecode y mvencode</p>
<ul>
<li>En ocasiones los <em>missing</em> difieren en notación (ej. al importar datos de otro paquete). Siempre que trabajes con una base de datos nueva es importante recodificar. Notar que no todos tienen que ir a un punto. Todo depende del origen de los <em>missing</em>.</li>
<li>
<code>mvdecode</code> y <code>mvencode</code> pueden ser útiles en este tipo de casos.</li>
<li>
<code>mvdecode</code> permite recodificar valores numéricos como <em>missing</em>. Útil cuando valores son representados como -99, -999.</li>
<li>
<code>mvencode</code> hace lo inverso. Mapea <em>missing</em> como numéricos.</li>
<li>El comando <code>tabmiss</code> inspecciona todas las variables de una base de datos y reporta los <code>missing</code> totales y como fracción del total de observaciones.</li>
</ul>
<div class="sourceCode" id="cb43"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb43-1"><a href="programar-do---files.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span> <span class="ot">all</span> </span>
<span id="cb43-2"><a href="programar-do---files.html#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="dv">seed</span> 1234</span>
<span id="cb43-3"><a href="programar-do---files.html#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="kw">N</span> = 50</span>
<span id="cb43-4"><a href="programar-do---files.html#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="kw">obs</span> <span class="ot">`N'</span></span>
<span id="cb43-5"><a href="programar-do---files.html#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> income = <span class="fu">abs</span>(<span class="kw">int</span>(rnormal(0,5)))</span>
<span id="cb43-6"><a href="programar-do---files.html#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="kw">assert</span> income &gt;= 0</span>
<span id="cb43-7"><a href="programar-do---files.html#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> income =. <span class="kw">if</span> <span class="fu">mod</span>(<span class="dt">_n</span>, 2) == 0</span>
<span id="cb43-8"><a href="programar-do---files.html#cb43-8" aria-hidden="true" tabindex="-1"></a>* Para ver los <span class="fu">missing</span> en variables</span>
<span id="cb43-9"><a href="programar-do---files.html#cb43-9" aria-hidden="true" tabindex="-1"></a>tabmiss </span>
<span id="cb43-10"><a href="programar-do---files.html#cb43-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-11"><a href="programar-do---files.html#cb43-11" aria-hidden="true" tabindex="-1"></a>* Transformar un valor númerico a <span class="fu">missing</span></span>
<span id="cb43-12"><a href="programar-do---files.html#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="kw">mvdecode</span> income, mv(2)</span>
<span id="cb43-13"><a href="programar-do---files.html#cb43-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-14"><a href="programar-do---files.html#cb43-14" aria-hidden="true" tabindex="-1"></a>* Transformar varios valores númericos a <span class="fu">missing</span>.</span>
<span id="cb43-15"><a href="programar-do---files.html#cb43-15" aria-hidden="true" tabindex="-1"></a><span class="kw">mvdecode</span> income, mv(2 5)</span>
<span id="cb43-16"><a href="programar-do---files.html#cb43-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-17"><a href="programar-do---files.html#cb43-17" aria-hidden="true" tabindex="-1"></a>* Transformar varios a <span class="fu">missing</span>, pero identific ́andolos.</span>
<span id="cb43-18"><a href="programar-do---files.html#cb43-18" aria-hidden="true" tabindex="-1"></a><span class="kw">mvdecode</span> income, mv(3 = .a \ 6 = .b)</span>
<span id="cb43-19"><a href="programar-do---files.html#cb43-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-20"><a href="programar-do---files.html#cb43-20" aria-hidden="true" tabindex="-1"></a>* Missings se cambian <span class="kw">de</span> vuelta a su valor original.</span>
<span id="cb43-21"><a href="programar-do---files.html#cb43-21" aria-hidden="true" tabindex="-1"></a><span class="kw">mvencode</span> income, mv(.a = 3 \ .b = 6)</span></code></pre></div>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.3.2: </b></p>
<p>Instrucciones</p>
<p>Abrir <code>ejercicios-clase3.do</code> y ejecute las líneas correspondientes al ejercicio 2.</p>
<p>Pregunta</p>
<p>Compare las opciones 1, 2 y 3 en relación a como tratan los <em>missing</em>. Explique las diferencias entre cada una de estas opciones.</p>
</div>
<p>generate, replace y missing: Sólo unas pequeños detalles.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb44-1"><a href="programar-do---files.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span> </span>
<span id="cb44-2"><a href="programar-do---files.html#cb44-2" aria-hidden="true" tabindex="-1"></a>cd <span class="st">"$ejercicio3"</span></span>
<span id="cb44-3"><a href="programar-do---files.html#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> census2c, <span class="kw">clear</span></span>
<span id="cb44-4"><a href="programar-do---files.html#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="programar-do---files.html#cb44-5" aria-hidden="true" tabindex="-1"></a>* Opción 1</span>
<span id="cb44-6"><a href="programar-do---files.html#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> smallpop_o1 = 1 <span class="kw">if</span> pop&lt;=5000</span>
<span id="cb44-7"><a href="programar-do---files.html#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> smallpop_o1 = 0 <span class="kw">if</span> pop&gt;5000</span>
<span id="cb44-8"><a href="programar-do---files.html#cb44-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-9"><a href="programar-do---files.html#cb44-9" aria-hidden="true" tabindex="-1"></a>* Opción 2</span>
<span id="cb44-10"><a href="programar-do---files.html#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> smallpop_o2 = (pop &lt;= 5000) </span>
<span id="cb44-11"><a href="programar-do---files.html#cb44-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-12"><a href="programar-do---files.html#cb44-12" aria-hidden="true" tabindex="-1"></a>* Opcion 3</span>
<span id="cb44-13"><a href="programar-do---files.html#cb44-13" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> smallpop_o3 = (pop &lt;= 5000) <span class="kw">if</span> !<span class="fu">missing</span>(pop)</span></code></pre></div>
<p>Opción 1 es la típica. Ojo no esta considerando <em>missing</em>. Es necesario agregar <code>&amp; !missing(pop)</code>. Escrito de esta forma, si <code>pop</code> es <em>missing</em>, <code>smallpop</code> será <em>cero</em>. Opción 2 es más simple, pero si cualquier valor de <code>pop</code> es <em>missing</em> será evaluado como un cero también. La razón es que los <em>missing</em> en Stata son considerados como números muy grandes para el programa. La Opción 3 soluciona el problema.</p>
</div>
<div id="string-a-numeric-y-al-revés" class="section level4" number="3.0.2.7">
<h4>
<span class="header-section-number">3.0.2.7</span> String a numeric y al revés<a class="anchor" aria-label="anchor" href="#string-a-numeric-y-al-rev%C3%A9s"><i class="fas fa-link"></i></a>
</h4>
<p>De string a numeric</p>
<ul>
<li>Si las variables han sido mal clasificadas como <em>string</em> puedes utilizar la función <code>real()</code>.</li>
<li>Por ejemplo: <code>generate idpaciente = real(pacienteid)</code>.</li>
<li>El comando anterior genera <em>missing</em> para todas las observaciones que no puedan ser interpretadas como numéricas.</li>
<li>Mucho mejor es utilizar <code>destring, replace</code>.</li>
<li>Otro caso usual es que tenemos datos en formato <code>string</code> y queremos que tengan un equivalente. El comando <code>encode</code>. No es aconsejable utilizar este comando para valores numéricos guardados como <em>string</em>.</li>
</ul>
<p>De numeric a string</p>
<ul>
<li>Hay veces en las que se quiere generar un equivalente <em>string</em> a valores numéricos.</li>
<li>Tres comandos: <code>string()</code> , <code>tostring()</code> y <code>decode()</code>.</li>
<li>Un ejemplo es querer mantener los 0 que estan al inicio de un código ID.</li>
<li>El comando <code>tostring zip, format(\%05.0f) generate(idstring)</code> genera un <em>string</em> de cinco digitos con los ceros al inicio.</li>
<li>
<code>decode()</code> sirve para un caso en que tengas un id en numérico, pero que no la tengas en <em>string</em>.</li>
</ul>
<p>Strings entre comillas: importa poner las comillas bien.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb45-1"><a href="programar-do---files.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"Este es un string normal"</span></span>
<span id="cb45-2"><a href="programar-do---files.html#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="programar-do---files.html#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"Este no es un string con "</span>comillas<span class="st">" "</span></span>
<span id="cb45-4"><a href="programar-do---files.html#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="programar-do---files.html#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">`"</span>Este si es un <span class="fu">string</span> con <span class="st">"comillas""'</span></span></code></pre></div>
</div>
<div id="funciones-para-generar-variables" class="section level4" number="3.0.2.8">
<h4>
<span class="header-section-number">3.0.2.8</span> Funciones para generar variables<a class="anchor" aria-label="anchor" href="#funciones-para-generar-variables"><i class="fas fa-link"></i></a>
</h4>
<p>generate y replace: función <code>cond()</code></p>
<ul>
<li>Si quiero que un resultado sea “a” si una <em>condición es verdadera</em> y “b” si es <em>falsa</em>.</li>
<li>La función <code>cond(x,a,b)</code> posee esta capacidad sin la necesidad de utilizar <code>if</code>.</li>
</ul>
<div class="sourceCode" id="cb46"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb46-1"><a href="programar-do---files.html#cb46-1" aria-hidden="true" tabindex="-1"></a>* Útil para construir una tabla</span>
<span id="cb46-2"><a href="programar-do---files.html#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> netmarr2x = <span class="fu">cond</span>(marr/divr &gt; 2, 1, 2) </span>
<span id="cb46-3"><a href="programar-do---files.html#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="kw">label</span> <span class="kw">define</span> netmarr2xc 1 <span class="st">"marr &gt; 2 divr"</span> 2 <span class="st">"marr &lt;= 2 divr"</span> </span>
<span id="cb46-4"><a href="programar-do---files.html#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="kw">label</span> <span class="kw">values</span> netmarr2x netmarr2xc </span>
<span id="cb46-5"><a href="programar-do---files.html#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="kw">tabstat</span> pop medage, <span class="kw">by</span>(netmarr2x) </span></code></pre></div>
<p>Las observaciones en Stata estás numeradas desde el 1. <code>_N</code> es el mayor número de observaciones, mientras que el actual es <code>_n</code>. <code>sort</code> (ascendete) y <code>gsort</code> (ascendete o descendente) alteran el orden de las observaciones. Como recomendación eviten generar variables o condiciones que dependan de la posición especifica de una observación.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb47-1"><a href="programar-do---files.html#cb47-1" aria-hidden="true" tabindex="-1"></a>* Ejemplo 1: uso <span class="kw">de</span> <span class="kw">gsort</span></span>
<span id="cb47-2"><a href="programar-do---files.html#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="kw">gsort</span> region -pop </span>
<span id="cb47-3"><a href="programar-do---files.html#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="kw">by</span> region: <span class="kw">generate</span> totpop = <span class="kw">sum</span>(pop)</span>
<span id="cb47-4"><a href="programar-do---files.html#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="programar-do---files.html#cb47-5" aria-hidden="true" tabindex="-1"></a>* Ejemplo 2: uso <span class="kw">de</span> <span class="dt">_n</span> <span class="fu">y</span> _N</span>
<span id="cb47-6"><a href="programar-do---files.html#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="kw">by</span> region: <span class="ot">list</span> region totpop <span class="kw">if</span> <span class="dt">_n</span> == _N</span>
<span id="cb47-7"><a href="programar-do---files.html#cb47-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-8"><a href="programar-do---files.html#cb47-8" aria-hidden="true" tabindex="-1"></a>* Ejemplo 3: <span class="kw">sort</span></span>
<span id="cb47-9"><a href="programar-do---files.html#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> largepop = 0</span>
<span id="cb47-10"><a href="programar-do---files.html#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> largepop = 1 <span class="kw">if</span> pop &gt; 5000 &amp; !<span class="fu">missing</span>(pop)</span>
<span id="cb47-11"><a href="programar-do---files.html#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> smallpop = (pop &lt;= 5000) <span class="kw">if</span> !<span class="fu">missing</span>(pop)</span>
<span id="cb47-12"><a href="programar-do---files.html#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> popsize = smallpop + 2*largepop</span>
<span id="cb47-13"><a href="programar-do---files.html#cb47-13" aria-hidden="true" tabindex="-1"></a><span class="kw">label</span> <span class="kw">variable</span> popsize <span class="st">"Population size code"</span></span>
<span id="cb47-14"><a href="programar-do---files.html#cb47-14" aria-hidden="true" tabindex="-1"></a><span class="kw">label</span> <span class="kw">define</span> popsize 1  <span class="st">"&lt;= 5 million"</span> 2 <span class="st">"&gt; 5 million"</span>, modify</span>
<span id="cb47-15"><a href="programar-do---files.html#cb47-15" aria-hidden="true" tabindex="-1"></a><span class="kw">label</span> <span class="kw">values</span> popsize popsize </span>
<span id="cb47-16"><a href="programar-do---files.html#cb47-16" aria-hidden="true" tabindex="-1"></a><span class="kw">bysort</span> region popsize: <span class="kw">egen</span> meanpop2 = <span class="kw">mean</span>(pop) </span></code></pre></div>
<p><code>recode</code> para variables discretas: <code>recode</code> crea una nueva variable basada en otra variable.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb48-1"><a href="programar-do---files.html#cb48-1" aria-hidden="true" tabindex="-1"></a>* Esta no es una buena opción </span>
<span id="cb48-2"><a href="programar-do---files.html#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> newcode = 5 <span class="kw">if</span> oldcode == 2 </span>
<span id="cb48-3"><a href="programar-do---files.html#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> newcode = 8 <span class="kw">if</span> oldcode == 3 </span>
<span id="cb48-4"><a href="programar-do---files.html#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> newcode = 12 <span class="kw">if</span> <span class="fu">inlist</span>(oldcode, 5, 6, 7)</span>
<span id="cb48-5"><a href="programar-do---files.html#cb48-5" aria-hidden="true" tabindex="-1"></a>* Esta si es una buena opción </span>
<span id="cb48-6"><a href="programar-do---files.html#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="kw">recode</span> oldcode (2 = 5) (3 = 8) (5/7 = 12), <span class="kw">gen</span>(newcode) </span></code></pre></div>
<p>El signo (<span class="math inline">\(=\)</span>) es para indicar valor antiguo a valor nuevo. No es necesario aplicarlo linea por linea. <code>recode</code> produce <strong>un código más eficiente</strong>.</p>
<p><code>recode</code> para variables continuas: <code>recode(x,x1,x2,x3,x4,xn)</code> para variables continuas de forma tal de generar intervalos tal que <span class="math inline">\(x \leq x_1 ; x_1 \leq x \leq x_2\)</span> y así sucesivamente. Los resultados son iguales a los límites creados.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb49-1"><a href="programar-do---files.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> census2c, <span class="kw">clear</span></span>
<span id="cb49-2"><a href="programar-do---files.html#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> breaks = <span class="kw">recode</span>(medage, 29, 30, 31, 32, 33)</span></code></pre></div>
<p>Otros comandos que cumplen una función parecida son <code>floor</code> y <code>ceil()</code>. Ambos sirven para generar un valor entero. El primero para redondear hacia abajo y el otro hacia arriba. <code>floor(x)</code> retorna el entero <span class="math inline">\(n\)</span> tal que <span class="math inline">\(n \leq x &lt; n + 1\)</span> mientras que <code>ceil(x)</code> es tal que <span class="math inline">\(n - 1 &lt; x \leq n\)</span>.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb50-1"><a href="programar-do---files.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> census2c, <span class="kw">clear</span></span>
<span id="cb50-2"><a href="programar-do---files.html#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> popurbfloor = <span class="fu">floor</span>(popurb)</span>
<span id="cb50-3"><a href="programar-do---files.html#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> popurbceil = <span class="fu">ceil</span>(popurb)</span></code></pre></div>
<p><code>irecode</code> para variables continuas: <code>irecode(x,x1,x2,x3,x4,x_n)</code> es una alternativa para categorizar grupos también. Por ejemplo:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb51-1"><a href="programar-do---files.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> <span class="kw">size</span> = <span class="fu">irecode</span>(pop, 1000, 4000, 8000, 20000)</span>
<span id="cb51-2"><a href="programar-do---files.html#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="kw">label</span> <span class="kw">define</span> popsize 0 <span class="st">"&lt;1m"</span> 1 <span class="st">"1-4m"</span> 2 <span class="st">"4-8m"</span> 3 <span class="st">"&gt;8m"</span> </span>
<span id="cb51-3"><a href="programar-do---files.html#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="kw">label</span> <span class="kw">values</span> <span class="kw">size</span> popsize</span>
<span id="cb51-4"><a href="programar-do---files.html#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="kw">tabstat</span> pop, stat(<span class="kw">mean</span> <span class="fu">min</span> <span class="fu">max</span>) <span class="kw">by</span>(<span class="kw">size</span>)</span></code></pre></div>
<p>Categorizara cada grupo según el intervalo en el que este. <strong>Parte del cero!</strong>. $x x_1 $, <span class="math inline">\(x_1 \leq x \leq x_2 \rightarrow 1\)</span> y así sucesivamente.</p>
<p>Crear cuartiles con <code>xtile</code>: Con <code>xtile</code> podemos querer clasificar las variables según cuantiles (quintiles, deciles, cuartiles, etc).</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb52-1"><a href="programar-do---files.html#cb52-1" aria-hidden="true" tabindex="-1"></a>* Creamos cuartiles para población </span>
<span id="cb52-2"><a href="programar-do---files.html#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="kw">xtile</span> popcuart = pop , nq(4)</span>
<span id="cb52-3"><a href="programar-do---files.html#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="kw">tabstat</span> pop, stat(n <span class="kw">mean</span> <span class="fu">min</span> <span class="fu">max</span>) <span class="kw">by</span>(popcuart)</span></code></pre></div>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.3.3:</b></p>
<p>Instrucciones</p>
<ol style="list-style-type: decimal">
<li>Cargar la base <code>auto.dta</code>
</li>
</ol>
<p>Pregunta</p>
<ol style="list-style-type: decimal">
<li>Genere una variable que sirva para redondear hacia abajo la variable <code>mpg</code> en en múltiplos de 5, de modo que cualquier valor de 10 a 14 se redondee a 10, cualquier valor de 15 a 19 a 15 y así sucesivamente.</li>
</ol>
</div>
</div>
<div id="funciones-de-egen" class="section level4" number="3.0.2.9">
<h4>
<span class="header-section-number">3.0.2.9</span> Funciones de egen<a class="anchor" aria-label="anchor" href="#funciones-de-egen"><i class="fas fa-link"></i></a>
</h4>
<p>Todos y todas conocemos algunas de las típicas funciones de <code>egen</code>.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb53-1"><a href="programar-do---files.html#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span> </span>
<span id="cb53-2"><a href="programar-do---files.html#cb53-2" aria-hidden="true" tabindex="-1"></a>* Ejemplo del uso <span class="kw">de</span> <span class="kw">egen</span></span>
<span id="cb53-3"><a href="programar-do---files.html#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> <span class="kw">size</span> = <span class="fu">irecode</span>(pop, 1000, 4000, 8000, 20000)</span>
<span id="cb53-4"><a href="programar-do---files.html#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="kw">label</span> <span class="kw">define</span> popsize 0 <span class="st">"&lt;1m"</span> 1 <span class="st">"1-4m"</span> 2 <span class="st">"4-8m"</span> 3 <span class="st">"&gt;8m"</span> </span>
<span id="cb53-5"><a href="programar-do---files.html#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="kw">label</span> <span class="kw">values</span> <span class="kw">size</span> popsize</span>
<span id="cb53-6"><a href="programar-do---files.html#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="kw">bysort</span> <span class="kw">size</span>: <span class="kw">egen</span> avgpop = <span class="kw">mean</span>(pop)</span>
<span id="cb53-7"><a href="programar-do---files.html#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> popratio = 100 * pop / avgpop </span>
<span id="cb53-8"><a href="programar-do---files.html#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="kw">format</span> popratio \%7.2f</span>
<span id="cb53-9"><a href="programar-do---files.html#cb53-9" aria-hidden="true" tabindex="-1"></a><span class="ot">list</span> state pop avgpop popratio <span class="kw">if</span> <span class="kw">size</span> == 0 </span></code></pre></div>
<p>Otras funciones son <code>iqr()</code>, <code>kurt()</code>,<code><a href="https://rdrr.io/r/stats/mad.html">mad()</a></code>, <code>mdev()</code>, <code><a href="https://rdrr.io/r/stats/median.html">median()</a></code>, <code><a href="https://rdrr.io/r/base/mode.html">mode()</a></code>, <code>pc()</code>, <code>pctile()</code>, <code><a href="https://rdrr.io/r/base/rank.html">rank()</a></code>, <code><a href="https://rdrr.io/r/stats/sd.html">sd()</a></code>, <code>skwe()</code>, <code>std()</code>.</p>
<p>egenmore</p>
<ul>
<li>Menos conocida es la colección de funciones adicionales de <code>egen</code> hechas por <a href="https://www.durham.ac.uk/staff/n-j-cox/">Nicholas J. Cox.</a>
</li>
<li>Estas funciones están contenidas en el comando <code>egenmore</code>.</li>
<li>
<code>bom()</code> y <code>eom()</code> crean variables de fechas que corresponde al primer y último día de un mes determinado.</li>
<li>
<code>corr()</code> calcula correlaciones y covarianzas mientras que <code><a href="https://rdrr.io/r/stats/cor.html">var()</a></code> calcular la varianza.</li>
<li>
<code>semean()</code> calcula la desviación estándar del error de una media.</li>
<li>
<code>record()</code> permite calcular el valor más alto o más bajo de una serie.</li>
</ul>
<div class="sourceCode" id="cb54"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb54-1"><a href="programar-do---files.html#cb54-1" aria-hidden="true" tabindex="-1"></a>* Ejemplo 1: Generar <span class="kw">variable</span> que tenga la primera palabra <span class="kw">de</span> una frase (wordof)</span>
<span id="cb54-2"><a href="programar-do---files.html#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> firstword = wordof(make),  <span class="fu">word</span>(1)</span>
<span id="cb54-3"><a href="programar-do---files.html#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="ot">list</span> firstword make <span class="kw">in</span>  1/15</span>
<span id="cb54-4"><a href="programar-do---files.html#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="programar-do---files.html#cb54-5" aria-hidden="true" tabindex="-1"></a>* Ejemplo 2: Para generar automáticamente valores extremos (outside, 1,5 RIQ)</span>
<span id="cb54-6"><a href="programar-do---files.html#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span>    extrmpg = outside(mpg)</span>
<span id="cb54-7"><a href="programar-do---files.html#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="kw">tab</span> extrmpg,    <span class="fu">missing</span></span></code></pre></div>
<p><code>rall()</code> y <code>rany()</code> son útiles para el análisis de datos. Evaluan una condición y genera un indicador si todas o alguna observación la cumple.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb55-1"><a href="programar-do---files.html#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="kw">obs</span> 12</span>
<span id="cb55-2"><a href="programar-do---files.html#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> a = 1 <span class="kw">in</span> 1 </span>
<span id="cb55-3"><a href="programar-do---files.html#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> b = 2 <span class="kw">in</span> 2/4</span>
<span id="cb55-4"><a href="programar-do---files.html#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> c  = -3  <span class="kw">in</span> 5/7</span>
<span id="cb55-5"><a href="programar-do---files.html#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> <span class="kw">d</span> = 4  <span class="kw">in</span> 8/10</span>
<span id="cb55-6"><a href="programar-do---files.html#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> <span class="fu">e</span> = . <span class="kw">in</span> 11/12</span>
<span id="cb55-7"><a href="programar-do---files.html#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> any = rany(a b c <span class="kw">d</span> <span class="fu">e</span>) , c(@ &gt; 0 &amp; !<span class="fu">missing</span>(@))</span>
<span id="cb55-8"><a href="programar-do---files.html#cb55-8" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> <span class="ot">all</span> = rall(a b c <span class="kw">d</span> <span class="fu">e</span>) , c(@ &gt; 0 &amp; !<span class="fu">missing</span>(@)) </span></code></pre></div>
</div>
</div>
<div id="macros-locales-y-globales" class="section level3" number="3.0.3">
<h3>
<span class="header-section-number">3.0.3</span> Macros locales y globales<a class="anchor" aria-label="anchor" href="#macros-locales-y-globales"><i class="fas fa-link"></i></a>
</h3>
<div id="nombrar-macros" class="section level4" number="3.0.3.1">
<h4>
<span class="header-section-number">3.0.3.1</span> Nombrar macros<a class="anchor" aria-label="anchor" href="#nombrar-macros"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Una macro es un <strong>contenedor</strong> que puede almacenar números o nombres de variables.</li>
<li>Puede ser <code>local</code> o <code>global</code>. La primera es temporal, la segunda no.<br>
</li>
<li>Un ejemplo de variable local es:</li>
</ul>
<div class="sourceCode" id="cb56"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb56-1"><a href="programar-do---files.html#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> NivelEstres Nada Medio Moderado Severo </span>
<span id="cb56-2"><a href="programar-do---files.html#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"Los niveles de estrés son: `NivelEstres'"</span></span></code></pre></div>
<p>El primer comando define la macro y sus valores. Para llamar a la macro hay que utilizar las comillas (“). <code>local nombre texto</code> <span class="math inline">\(\rightarrow\)</span> <code>local nombre = text</code> <span class="math inline">\(\rightarrow\)</span> <code>local nombre = "text"</code>.</p>
<p>Ojo con las rutas:</p>
<ul>
<li>En ocasiones voy a querer utilizar una macro dentro de la ruta de una carpeta.</li>
<li>Es importante utilizar siempre <code>/</code> o bien <code>\\</code>. De otra forma no lo reconocerá.</li>
</ul>
<div class="sourceCode" id="cb57"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb57-1"><a href="programar-do---files.html#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> filename base.dta </span>
<span id="cb57-2"><a href="programar-do---files.html#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="st">"H:\ECStata\`filename'"</span></span>
<span id="cb57-3"><a href="programar-do---files.html#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="fu">r</span>(601);</span>
<span id="cb57-4"><a href="programar-do---files.html#cb57-4" aria-hidden="true" tabindex="-1"></a>* Para corregir <span class="fu">el</span> <span class="kw">error</span>, dos caminos: </span>
<span id="cb57-5"><a href="programar-do---files.html#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="st">"H:\ECStata</span><span class="ch">\\</span><span class="st">`filename'"</span> </span>
<span id="cb57-6"><a href="programar-do---files.html#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="st">"H:/ECStata/`filename'"</span></span></code></pre></div>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.3.4:</b> Compare los siguientes comandos y comente las diferencias:</p>
<ul>
<li><code>display "Dos mas dos = 2 + 2"</code></li>
<li>
<code>display "Dos mas dos</code>= 2 + 2’“`</li>
</ul>
</div>
<p>Ojo con el signo igual: Algunas veces es bueno colocar un signo <span class="math inline">\(=\)</span> al definir macros. Por ejemplo, cuando redefinimos variables.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb58-1"><a href="programar-do---files.html#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> contador 0</span>
<span id="cb58-2"><a href="programar-do---files.html#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> NivelEstres Nada Medio Moderado Severo </span>
<span id="cb58-3"><a href="programar-do---files.html#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> a <span class="kw">of</span> <span class="kw">local</span> NivelEstres { </span>
<span id="cb58-4"><a href="programar-do---files.html#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> contador = <span class="ot">`contador'</span> + 1 </span>
<span id="cb58-5"><a href="programar-do---files.html#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"Nivel de Estres `contador' : `a'"</span></span>
<span id="cb58-6"><a href="programar-do---files.html#cb58-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>La primera parte sirve para definir la <code>macro</code> mientras que la segunda sirve para dar cuenta de su valor actual. Al actualizar, ocupen igual.</p>
<p>Sin signo igual: En algunas ocasiones queremos escribir una <code>macro</code> dentro de un <em>loop</em>. En estos casos es conveniente evitar el signo igual.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb59-1"><a href="programar-do---files.html#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> contador 0</span>
<span id="cb59-2"><a href="programar-do---files.html#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> NivelEstres Nada Medio Moderado Severo </span>
<span id="cb59-3"><a href="programar-do---files.html#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> a <span class="kw">of</span> <span class="kw">local</span> NivelEstres {</span>
<span id="cb59-4"><a href="programar-do---files.html#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> contador = <span class="ot">`contador'</span> + 1 </span>
<span id="cb59-5"><a href="programar-do---files.html#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> nuevalista <span class="ot">`nuevalista'</span> <span class="ot">`contador'</span> 'a' </span>
<span id="cb59-6"><a href="programar-do---files.html#cb59-6" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb59-7"><a href="programar-do---files.html#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"`nuevalista'"</span> </span></code></pre></div>
<p>El <code>local nuevalista</code> define una macro como <em>string</em> que posee su propio contenido, el valor de contar y el valor del iterador.</p>
</div>
<div id="generar-variables-contadores-y-condiciones-con-macros" class="section level4" number="3.0.3.2">
<h4>
<span class="header-section-number">3.0.3.2</span> Generar variables, contadores y condiciones con macros<a class="anchor" aria-label="anchor" href="#generar-variables-contadores-y-condiciones-con-macros"><i class="fas fa-link"></i></a>
</h4>
<p>Podemos utilizar macros para renombrar variables.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb60-1"><a href="programar-do---files.html#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span> </span>
<span id="cb60-2"><a href="programar-do---files.html#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> a = 10/20{ </span>
<span id="cb60-3"><a href="programar-do---files.html#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> v<span class="ot">`a'</span> = rnormal()</span>
<span id="cb60-4"><a href="programar-do---files.html#cb60-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb60-5"><a href="programar-do---files.html#cb60-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-6"><a href="programar-do---files.html#cb60-6" aria-hidden="true" tabindex="-1"></a>* Renombramos variables </span>
<span id="cb60-7"><a href="programar-do---files.html#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> i = 11/15 { </span>
<span id="cb60-8"><a href="programar-do---files.html#cb60-8" aria-hidden="true" tabindex="-1"></a><span class="kw">rename</span> v<span class="ot">`i'</span> x<span class="ot">`=1960 + `i'</span>'</span>
<span id="cb60-9"><a href="programar-do---files.html#cb60-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>En este fragmento de código, Stata evalúa la expresión <code>1960 + 'i'</code> antes de evaluar la macro externa. Por ejemplo, cuando pase por el iterador <code>i = 11</code>, el nuevo nombre de la variable será <code>x1971</code>.</p>
<p>Resumir condiciones: Podemos utilizar macros para resumir condiciones. Esto es útil para estimar modelos o generar estadística descriptiva.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb61-1"><a href="programar-do---files.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span> </span>
<span id="cb61-2"><a href="programar-do---files.html#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto </span>
<span id="cb61-3"><a href="programar-do---files.html#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="fu">cond</span> <span class="st">"if foreign==0"</span></span>
<span id="cb61-4"><a href="programar-do---files.html#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="kw">varlist</span> <span class="st">"mpg rep78 trunk weight turn"</span></span>
<span id="cb61-5"><a href="programar-do---files.html#cb61-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-6"><a href="programar-do---files.html#cb61-6" aria-hidden="true" tabindex="-1"></a>* Estimar la regresión considerando la condicíòn</span>
<span id="cb61-7"><a href="programar-do---files.html#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> price <span class="ot">`varlist'</span> <span class="ot">`cond'</span></span></code></pre></div>
<p>Agrupar en base a una condición: Imaginemos que ahora queremos estimar una regresión para todas las compañías de auto que empiezan empiezan con B.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb62-1"><a href="programar-do---files.html#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> autoname B </span>
<span id="cb62-2"><a href="programar-do---files.html#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> price mpg <span class="kw">weight</span> <span class="kw">if</span> <span class="fu">substr</span>(make,1,1)==<span class="st">"`autoname'"</span></span></code></pre></div>
<p>La mejor manera de pensar en esto es hacer lo que hace Stata: reemplazar <code>"ctyname"</code> por su contenido <code>substr(país,1,1)=="</code>ctyname’“<code>. Al hacerlo, se convierte en</code>substr(país,1,1)==”B”<code>. Si se omiten las comillas dobles, se obtiene</code>substr(country,1,1)==B`, lo que da lugar a un error.</p>
<p>Contadores: Las macros también pueden ser útiles para contadores.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb63-1"><a href="programar-do---files.html#cb63-1" aria-hidden="true" tabindex="-1"></a>* Para adelante</span>
<span id="cb63-2"><a href="programar-do---files.html#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> i = 1 </span>
<span id="cb63-3"><a href="programar-do---files.html#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> ++i </span>
<span id="cb63-4"><a href="programar-do---files.html#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="kw">di</span> <span class="ot">`i'</span> </span>
<span id="cb63-5"><a href="programar-do---files.html#cb63-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-6"><a href="programar-do---files.html#cb63-6" aria-hidden="true" tabindex="-1"></a>* Para atrás</span>
<span id="cb63-7"><a href="programar-do---files.html#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> i = 1</span>
<span id="cb63-8"><a href="programar-do---files.html#cb63-8" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> --i </span>
<span id="cb63-9"><a href="programar-do---files.html#cb63-9" aria-hidden="true" tabindex="-1"></a><span class="kw">di</span> <span class="ot">`i'</span> </span></code></pre></div>
<p>Muy útil para hacer gráficos o guardar datos en matrices.</p>
<p>Utilizar una macro para estimar regresiones: Imaginen que desean estimar regresiones sobre un conjunto de variables donde una parte de este conjunto esta fija y la otra parte es variable.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb64-1"><a href="programar-do---files.html#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> rhs mpg <span class="kw">weight</span></span>
<span id="cb64-2"><a href="programar-do---files.html#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> price <span class="ot">`rhs'</span> <span class="kw">if</span> foreign == 0 </span>
<span id="cb64-3"><a href="programar-do---files.html#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> rhs <span class="st">"`rhs' headroom trunk"</span>  </span>
<span id="cb64-4"><a href="programar-do---files.html#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> price <span class="ot">`rhs'</span> <span class="kw">if</span> foreign == 0 </span></code></pre></div>
<p>¿Qué ocurre si queremos hacerlo por separado? ¿Uno a uno?</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb65-1"><a href="programar-do---files.html#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> rhs <span class="st">"mpg weight \`add_var'"</span> </span>
<span id="cb65-2"><a href="programar-do---files.html#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> add_var <span class="st">"headroom"</span></span>
<span id="cb65-3"><a href="programar-do---files.html#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> price <span class="ot">`rhs'</span> <span class="kw">if</span> foreign == 0  </span>
<span id="cb65-4"><a href="programar-do---files.html#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> add_var <span class="st">"trunk"</span> </span>
<span id="cb65-5"><a href="programar-do---files.html#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> price <span class="ot">`rhs'</span> <span class="kw">if</span> foreign == 0  </span>
<span id="cb65-6"><a href="programar-do---files.html#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> add_var <span class="st">"turn"</span> </span>
<span id="cb65-7"><a href="programar-do---files.html#cb65-7" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> price <span class="ot">`rhs'</span> <span class="kw">if</span> foreign == 0  </span></code></pre></div>
<p>Lo que ocurre cuando hacemos referencia a una macro es que su valor se introduce en ese punto. El uso de una barra invertida en su lugar hace que se introduzca la referencia de la macro, es decir, no se sustituirá el valor de <code>add_var</code> sino el término `<code>add_var'</code>. Así que cada vez que llamamos a la local <code>rhs</code> el valor actual de el local <code>add_var</code> es sustituido.</p>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.3.5: </b></p>
<p>Instrucciones</p>
<ol style="list-style-type: decimal">
<li>Cargar la base <code>auto.dta</code>
</li>
</ol>
<p>Preguntas</p>
<ol style="list-style-type: decimal">
<li><p>Defina una variable macro llamada <code>control</code> que contenga <code>mpg</code>, <code>rep78</code> y <code>headroom</code>. Estime una regresión entre <code>price</code> y <code>control</code> para vehículos extranjeros y de nuevo para vehículos domésticos.</p></li>
<li><p>Ejecute <code>summarize mpg</code> junto con <code>return list</code>. Defina dos macros <code>display</code> <code>local mean1 r(mean)</code> y <code>local mean2 = r(mean)</code>. ¿Son iguales?</p></li>
</ol>
</div>
</div>
<div id="globales" class="section level4" number="3.0.3.3">
<h4>
<span class="header-section-number">3.0.3.3</span> Globales<a class="anchor" aria-label="anchor" href="#globales"><i class="fas fa-link"></i></a>
</h4>
<p>Crear macros globales</p>
<ul>
<li>Se crean con el comando <code>global</code>.</li>
<li>Útiles para fijar directorios o programas.</li>
<li>En otros casos es mejor utilizar <code>local</code>.</li>
</ul>
<div class="sourceCode" id="cb66"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb66-1"><a href="programar-do---files.html#cb66-1" aria-hidden="true" tabindex="-1"></a>* Para generarla </span>
<span id="cb66-2"><a href="programar-do---files.html#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="kw">global</span> <span class="kw">variable</span></span>
<span id="cb66-3"><a href="programar-do---files.html#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="programar-do---files.html#cb66-4" aria-hidden="true" tabindex="-1"></a>* En caso <span class="kw">de</span> querer llamarla</span>
<span id="cb66-5"><a href="programar-do---files.html#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="ot">$variable</span></span></code></pre></div>
</div>
<div id="funciones-extendidas-de-macros" class="section level4" number="3.0.3.4">
<h4>
<span class="header-section-number">3.0.3.4</span> Funciones extendidas de macros<a class="anchor" aria-label="anchor" href="#funciones-extendidas-de-macros"><i class="fas fa-link"></i></a>
</h4>
<p>¿Qué son las funciones de macros extendidas?</p>
<ul>
<li>Stata también define ciertas macro. Estas se denominan <em>extended macro functions</em> o macros extendidas.</li>
<li>En algunos casos contienen información sobre tu sistema operativo, sobre la última estimación que se realizo o sobre la base de datos.</li>
<li>El <code>help extended_fcn</code> y la documentación que la acompaña proporcionan una descripción completa de la sintaxis de cada función de macro extendida (hay muchas). Muchas tienen ligeras variaciones de sintaxis entre ellas (por ejemplo, algunas requieren que las macros estén entre comillas dobles; otras no lo permiten).</li>
</ul>
<div class="sourceCode" id="cb67"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb67-1"><a href="programar-do---files.html#cb67-1" aria-hidden="true" tabindex="-1"></a>* La sintaxis general es: </span>
<span id="cb67-2"><a href="programar-do---files.html#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> nombremacro: función <span class="kw">macro</span> extendida</span></code></pre></div>
<p>Mirar labels</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb68-1"><a href="programar-do---files.html#cb68-1" aria-hidden="true" tabindex="-1"></a>* Para mirar los labels <span class="kw">de</span> trunk</span>
<span id="cb68-2"><a href="programar-do---files.html#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto, <span class="kw">clear</span></span>
<span id="cb68-3"><a href="programar-do---files.html#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> tlab : <span class="kw">variable</span> <span class="kw">label</span> trunk </span>
<span id="cb68-4"><a href="programar-do---files.html#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"`tlab'"</span></span></code></pre></div>
<p><code>variable label</code> recupera el nombre asignado a una variable.</p>
<p>Contar dentro de un local</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb69-1"><a href="programar-do---files.html#cb69-1" aria-hidden="true" tabindex="-1"></a>* Para contar dentro <span class="kw">de</span> un <span class="kw">local</span></span>
<span id="cb69-2"><a href="programar-do---files.html#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> NivelEstres Nada Medio Moderado Severo </span>
<span id="cb69-3"><a href="programar-do---files.html#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> wds: <span class="fu">word</span> <span class="fu">count</span> <span class="ot">`NivelEstres'</span> </span>
<span id="cb69-4"><a href="programar-do---files.html#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"Hay `wds' niveles de estres:"</span></span>
<span id="cb69-5"><a href="programar-do---files.html#cb69-5" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> i = 1/<span class="ot">`wds'</span> {</span>
<span id="cb69-6"><a href="programar-do---files.html#cb69-6" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> wd: <span class="fu">word</span> <span class="ot">`i'</span> <span class="kw">of</span> <span class="ot">`NivelEstres'</span></span>
<span id="cb69-7"><a href="programar-do---files.html#cb69-7" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"Nivel `i' is `wd'"</span></span>
<span id="cb69-8"><a href="programar-do---files.html#cb69-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><code>word count</code> y <code>word</code> como funciones de extensión que operan sobre <em>strings</em>.</p>
<p>Conocer tipos de datos</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb70-1"><a href="programar-do---files.html#cb70-1" aria-hidden="true" tabindex="-1"></a>* Para conocer tipos <span class="kw">de</span> datos</span>
<span id="cb70-2"><a href="programar-do---files.html#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto, <span class="kw">clear</span></span>
<span id="cb70-3"><a href="programar-do---files.html#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> stortype : <span class="dv">type</span> make </span>
<span id="cb70-4"><a href="programar-do---files.html#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"`stortype'"</span></span></code></pre></div>
<p>Ojos con las comillas dobles (nuevamente): Algunas veces las macros contienen comillas dobles. Para poder escribirlos sin errores es necesario modificar levemente la forma en que se llama a la variable <code>local</code></p>
<div class="sourceCode" id="cb71"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb71-1"><a href="programar-do---files.html#cb71-1" aria-hidden="true" tabindex="-1"></a>* Con <span class="kw">error</span> </span>
<span id="cb71-2"><a href="programar-do---files.html#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> answers yes no <span class="st">"do not know"</span> </span>
<span id="cb71-3"><a href="programar-do---files.html#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"`answers'"</span></span>
<span id="cb71-4"><a href="programar-do---files.html#cb71-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-5"><a href="programar-do---files.html#cb71-5" aria-hidden="true" tabindex="-1"></a>* Sin <span class="kw">error</span> </span>
<span id="cb71-6"><a href="programar-do---files.html#cb71-6" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> answers yes no <span class="st">"do not know"</span> </span>
<span id="cb71-7"><a href="programar-do---files.html#cb71-7" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">`"</span><span class="ot">`answers'</span><span class="st">"'</span></span></code></pre></div>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.3.6: </b></p>
<p>Preguntas</p>
<ol style="list-style-type: decimal">
<li>Use una macro extendida para mostrar el tipo de dato (ej. <code>int</code>, <code>float</code>, <code>long</code>,…) de <code>mpg</code>. Revise el <code>help</code> de <code>extended_fcn</code>.</li>
<li>Use una macro extendida para retornar el valor del label asociado a <code>foreign</code> cuando es igual a 1.</li>
<li>Use una macro extendida para mostrar solo la primera variable de `<code>controls'</code>.</li>
<li>Utilice una función extendida de macros para mostrar todos los archivos de su directorio actual (sugerencia: utilice comillas compuestas cuando muestre los nombres de los archivos).</li>
</ol>
</div>
</div>
<div id="funciones-de-macro-extendidas-para-listas" class="section level4" number="3.0.3.5">
<h4>
<span class="header-section-number">3.0.3.5</span> Funciones de macro extendidas para listas<a class="anchor" aria-label="anchor" href="#funciones-de-macro-extendidas-para-listas"><i class="fas fa-link"></i></a>
</h4>
<p>Stata también define ciertas macro para operar sobre listas. Estas funciones permiten combinar listas, buscar elementos dentro de una lista o bien buscar elementos comunes entre dos listas. Conveniente revisar <code>help macrolist</code> para más funciones.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb72-1"><a href="programar-do---files.html#cb72-1" aria-hidden="true" tabindex="-1"></a>* Sintaxis: </span>
<span id="cb72-2"><a href="programar-do---files.html#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> nombre <span class="kw">macro</span>: <span class="ot">list</span> función</span>
<span id="cb72-3"><a href="programar-do---files.html#cb72-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-4"><a href="programar-do---files.html#cb72-4" aria-hidden="true" tabindex="-1"></a>* Ejemplo <span class="kw">de</span> lista</span>
<span id="cb72-5"><a href="programar-do---files.html#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> animales <span class="st">"gato perro gato loro loro"</span> </span>
<span id="cb72-6"><a href="programar-do---files.html#cb72-6" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> uniqanimales : <span class="ot">list</span> uniq animales </span>
<span id="cb72-7"><a href="programar-do---files.html#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"`uniqanimales'"</span></span></code></pre></div>
<p>Función levelsof: El comando <code>levelsof</code> lista los valores distintos de una variable. Al agregar la opción <code>local(nombremacro)</code> esto se guardara como una macro.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb73-1"><a href="programar-do---files.html#cb73-1" aria-hidden="true" tabindex="-1"></a>* Sintaxis básica</span>
<span id="cb73-2"><a href="programar-do---files.html#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto, <span class="kw">clear</span></span>
<span id="cb73-3"><a href="programar-do---files.html#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="kw">levelsof</span> rep78 </span>
<span id="cb73-4"><a href="programar-do---files.html#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"`r(levels)'"</span></span>
<span id="cb73-5"><a href="programar-do---files.html#cb73-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-6"><a href="programar-do---files.html#cb73-6" aria-hidden="true" tabindex="-1"></a>* Sintaxis cuando hay variables categóricas.</span>
<span id="cb73-7"><a href="programar-do---files.html#cb73-7" aria-hidden="true" tabindex="-1"></a><span class="kw">levelsof</span> foreign, <span class="kw">local</span>(<span class="kw">levels</span>)</span>
<span id="cb73-8"><a href="programar-do---files.html#cb73-8" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> <span class="ot">l</span> <span class="kw">of</span> <span class="kw">local</span> <span class="kw">levels</span> {</span>
<span id="cb73-9"><a href="programar-do---files.html#cb73-9" aria-hidden="true" tabindex="-1"></a><span class="kw">di</span> <span class="st">"-&gt; foreign = `: label (foreign) `l''"</span></span>
<span id="cb73-10"><a href="programar-do---files.html#cb73-10" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> price mpg <span class="kw">if</span> foreign == <span class="ot">`l'</span></span>
<span id="cb73-11"><a href="programar-do---files.html#cb73-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="manipulación-de-locales-vía-listas-de-macros" class="section level4" number="3.0.3.6">
<h4>
<span class="header-section-number">3.0.3.6</span> Manipulación de locales vía listas de macros<a class="anchor" aria-label="anchor" href="#manipulaci%C3%B3n-de-locales-v%C3%ADa-listas-de-macros"><i class="fas fa-link"></i></a>
</h4>
<p>Listas de macros: Las <code>macro lists</code> permiten obtener el número de elementos de una macro, trabajar con valores duplicados, ordenar elementos. Veremos cuatro aplicaciones:</p>
<ol style="list-style-type: decimal">
<li>Elementos duplicados.</li>
<li>Agregar y remover elementos.</li>
<li>Uniones e intersecciones.</li>
<li>Ordenar elementos.</li>
</ol>
<p>Elementos duplicados: <code>dups</code> extrae todos los elementos sobrantes.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb74-1"><a href="programar-do---files.html#cb74-1" aria-hidden="true" tabindex="-1"></a>* Deja solo los unicos</span>
<span id="cb74-2"><a href="programar-do---files.html#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> fib 0 1 1 2 3</span>
<span id="cb74-3"><a href="programar-do---files.html#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> fib_nodups : <span class="ot">list</span> uniq fib</span>
<span id="cb74-4"><a href="programar-do---files.html#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"`fib_nodups'"</span></span>
<span id="cb74-5"><a href="programar-do---files.html#cb74-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-6"><a href="programar-do---files.html#cb74-6" aria-hidden="true" tabindex="-1"></a>* Quita todo los duplicados</span>
<span id="cb74-7"><a href="programar-do---files.html#cb74-7" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> fib 0 1 1 2 3</span>
<span id="cb74-8"><a href="programar-do---files.html#cb74-8" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> fib_dups : <span class="ot">list</span> dups fib</span>
<span id="cb74-9"><a href="programar-do---files.html#cb74-9" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"`fib_dups'"</span></span></code></pre></div>
<p>Agregar y remover elementos: Es básicamente pegar elementos de una macro con otra. Definamos dos variables locales: <code>vars</code> y <code>coef</code> y peguémoslos.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb75-1"><a href="programar-do---files.html#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> vars x <span class="fu">y</span> z </span>
<span id="cb75-2"><a href="programar-do---files.html#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> coefs a b c </span>
<span id="cb75-3"><a href="programar-do---files.html#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> vars_coefs <span class="ot">`vars'</span> <span class="ot">`coefs'</span></span>
<span id="cb75-4"><a href="programar-do---files.html#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"`vars_coefs'"</span></span></code></pre></div>
<p>Para remover tenemos que definir un nuevo local con los elementos que queremos quitar y sustraerlo del original. Supongamos que queremos actualizar el contenido de <code>vars</code> eliminado “y”.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb76-1"><a href="programar-do---files.html#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="kw">not</span> <span class="fu">y</span></span>
<span id="cb76-2"><a href="programar-do---files.html#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> vars : <span class="ot">list</span> vars - <span class="kw">not</span></span>
<span id="cb76-3"><a href="programar-do---files.html#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"`vars'"</span></span></code></pre></div>
<p>Unión de elementos: Podemos pegar todos los elementos diferentes entre dos listas.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb77-1"><a href="programar-do---files.html#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> A house tree car</span>
<span id="cb77-2"><a href="programar-do---files.html#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> B computer car bike</span>
<span id="cb77-3"><a href="programar-do---files.html#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> all_things : <span class="ot">list</span> A | B</span>
<span id="cb77-4"><a href="programar-do---files.html#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"`all_things'"</span></span></code></pre></div>
<p>Noten que los elementos de <code>car</code> no fueron pegados. Notar que esto es distinto a simplemente pegar macros entre sí.</p>
<p>Intersección de elementos: Podemos hacer la intersección entre dos elementos de una lista. Esto corresponde a los elementos que pertenecen a ambas macros.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb78-1"><a href="programar-do---files.html#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> A house tree car</span>
<span id="cb78-2"><a href="programar-do---files.html#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> B computer car bike</span>
<span id="cb78-3"><a href="programar-do---files.html#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> common_things : <span class="ot">list</span> A &amp; B</span>
<span id="cb78-4"><a href="programar-do---files.html#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"`common_things'"</span></span></code></pre></div>
<p>Noten que en este caso solo <code>car</code> se mantiene.</p>
<p>Ordenar elementos: En ocasiones queremos ordenar los elementos de una lista contenida en una macro.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb79-1"><a href="programar-do---files.html#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> names camila camilo pedro paula</span>
<span id="cb79-2"><a href="programar-do---files.html#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> names : <span class="ot">list</span> <span class="kw">sort</span> names</span>
<span id="cb79-3"><a href="programar-do---files.html#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"`names'"</span></span></code></pre></div>
<p>Para hacer que los elementos de una macro se ordenen aleatoriamente es conveniente utilizar mata</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb80-1"><a href="programar-do---files.html#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> nums 1 2 3 4 5</span>
<span id="cb80-2"><a href="programar-do---files.html#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> : st_local(<span class="st">"random_nums"</span>, <span class="co">///</span></span>
<span id="cb80-3"><a href="programar-do---files.html#cb80-3" aria-hidden="true" tabindex="-1"></a>invtokens(<span class="kw">jumble</span>(tokens(st_local(<span class="st">"nums"</span>))')'))</span>
<span id="cb80-4"><a href="programar-do---files.html#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"`random_nums'"</span></span></code></pre></div>
</div>
<div id="creturn" class="section level4" number="3.0.3.7">
<h4>
<span class="header-section-number">3.0.3.7</span> creturn<a class="anchor" aria-label="anchor" href="#creturn"><i class="fas fa-link"></i></a>
</h4>
<p>Macros con creturn</p>
<ul>
<li>En algunos casos al utilizar <code>local</code> o <code>global</code> vamos a querer fijar algunos parámetros.</li>
<li>Para este propósito utilizar <code>creturn</code>. Algunos ejemplos son: <code>c(current_date)</code>, <code>c(pwd)</code>, <code>c(current_time)</code>, <code>c(stata_version)</code>, <code>c(pi)</code>, <code>c(alpha)</code>, <code>c(Wdays)</code>.</li>
</ul>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.3.7: </b></p>
<p>Preguntas</p>
<ol style="list-style-type: decimal">
<li>Define una macro llamada comestibles con peras, manzanas, fresas, yogur, vino y queso en ella. Ponla en orden alfabético.</li>
<li>Define una macro llamada unión que contenga los miembros de la macro <em>animales</em> y <em>comestibles</em> y luego utiliza una función de lista extendida de la macro para mostrar el número de palabras que contiene.</li>
<li>Ordena <em>unión</em> y muestra la posición de la palabra “vino” utilizando una función de lista extendida de macros.</li>
</ol>
</div>
</div>
</div>
<div id="estructuras-de-datos" class="section level3" number="3.0.4">
<h3>
<span class="header-section-number">3.0.4</span> Estructuras de datos<a class="anchor" aria-label="anchor" href="#estructuras-de-datos"><i class="fas fa-link"></i></a>
</h3>
<div id="escalares" class="section level4" number="3.0.4.1">
<h4>
<span class="header-section-number">3.0.4.1</span> Escalares<a class="anchor" aria-label="anchor" href="#escalares"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Los escalares pueden contener valores numéricos o <em>strings</em>. Un escalar solo puede contener un valor.</li>
<li>La sintaxis para generar un escalar es <code>scalar scalar_name = exp</code>.</li>
</ul>
<div class="sourceCode" id="cb81"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb81-1"><a href="programar-do---files.html#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="kw">quietly</span>: <span class="kw">summarize</span> mpg </span>
<span id="cb81-2"><a href="programar-do---files.html#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="fu">scalar</span> mean_mpg = <span class="fu">r</span>(<span class="kw">mean</span>)</span>
<span id="cb81-3"><a href="programar-do---files.html#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="kw">quietly</span>: <span class="kw">summarize</span> rep78</span>
<span id="cb81-4"><a href="programar-do---files.html#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="fu">scalar</span> mean_rep78 = <span class="fu">r</span>(<span class="kw">mean</span>)</span>
<span id="cb81-5"><a href="programar-do---files.html#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"r(mean) guarda el promedio de rep78: "</span> <span class="fu">r</span>(<span class="kw">mean</span>) </span>
<span id="cb81-6"><a href="programar-do---files.html#cb81-6" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"Pero tambien podemos recuperarlo:"</span> mean_mpg</span></code></pre></div>
<p>Para utilizar un escalar en una operación solo es necesario llamarlo por su nombre. Para listar el contenido de todos los escalares <code>scalar list</code>. Para borrar <code>scalar drop scalar_name</code> o si quiero eliminar todo <code>scalar drop _all</code>. Los escalares permiten parametrizar un <code>do-file</code>.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb82-1"><a href="programar-do---files.html#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> fem2, <span class="kw">clear</span> </span>
<span id="cb82-2"><a href="programar-do---files.html#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">scalar</span> lb1 = 80 </span>
<span id="cb82-3"><a href="programar-do---files.html#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="fu">scalar</span> ub1 = 88 </span>
<span id="cb82-4"><a href="programar-do---files.html#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="fu">scalar</span> lb2 = 89 </span>
<span id="cb82-5"><a href="programar-do---files.html#cb82-5" aria-hidden="true" tabindex="-1"></a><span class="fu">scalar</span> ub2 = 97 </span>
<span id="cb82-6"><a href="programar-do---files.html#cb82-6" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> i = 1/2 {</span>
<span id="cb82-7"><a href="programar-do---files.html#cb82-7" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="dt">_n</span> <span class="st">"IQ"</span> <span class="st">"lb`i'"</span> <span class="st">"-"</span> <span class="st">"ub`i'"</span> </span>
<span id="cb82-8"><a href="programar-do---files.html#cb82-8" aria-hidden="true" tabindex="-1"></a><span class="kw">tabulate</span> anxiety <span class="kw">if</span> <span class="fu">inrange</span>(iq, lb<span class="ot">`i'</span>, ub<span class="ot">`i'</span>)</span>
<span id="cb82-9"><a href="programar-do---files.html#cb82-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="elementos-y-operaciones-con-matrices" class="section level4" number="3.0.4.2">
<h4>
<span class="header-section-number">3.0.4.2</span> Elementos y operaciones con matrices<a class="anchor" aria-label="anchor" href="#elementos-y-operaciones-con-matrices"><i class="fas fa-link"></i></a>
</h4>
<p>Stata puede generar matrices.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb83-1"><a href="programar-do---files.html#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> <span class="kw">weight</span> age age2</span>
<span id="cb83-2"><a href="programar-do---files.html#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> b = <span class="fu">e</span>(b)</span>
<span id="cb83-3"><a href="programar-do---files.html#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> <span class="ot">list</span> b</span>
<span id="cb83-4"><a href="programar-do---files.html#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> <span class="kw">V</span> = <span class="fu">e</span>(<span class="kw">V</span>)</span>
<span id="cb83-5"><a href="programar-do---files.html#cb83-5" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> <span class="ot">list</span> <span class="kw">V</span></span></code></pre></div>
<p>Las matrices son muy importantes para guardar resultados y exportarlos de forma conveniente. También son útiles para cuando se quieren hacer estimaciones de muchos parámetros y para distintos conjuntos de datos.</p>
<p>Operaciones con matrices: Se puede operar con matrices. Por ejemplo, sabemos que <span class="math inline">\(b = (X'X)^{-1}X'y\)</span> y que <span class="math inline">\(V = \sigma^{2}(X'X)^{-1}\)</span>. Si queremos extraer solo la matriz <span class="math inline">\(X'y\)</span> tenemos que operar, calculando <span class="math inline">\(\frac{1}{\sigma^{2}}V^{-1}b\)</span>.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb84-1"><a href="programar-do---files.html#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> <span class="kw">define</span> b = <span class="fu">e</span>(b)' </span>
<span id="cb84-2"><a href="programar-do---files.html#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> <span class="kw">define</span> xty = <span class="fu">inv</span>(<span class="kw">V</span>) * b /<span class="fu">e</span>(rmse)^2</span>
<span id="cb84-3"><a href="programar-do---files.html#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> <span class="ot">list</span> xty </span></code></pre></div>
<p><code>e(b)’</code> indica la traspuesta, mientras que <code>inv()</code> es para calcular la matriz inversa.</p>
<p>Llamar a los elementos de una matriz: Se puede acceder a los escalares contenidos en las matrices. Por ejemplo, si queremos obtener los elementos de la matriz <span class="math inline">\(e(b)\)</span> tenemos:</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb85-1"><a href="programar-do---files.html#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"The coefficient on weight is: "</span> _b[<span class="kw">weight</span>] </span>
<span id="cb85-2"><a href="programar-do---files.html#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"Its standard error is: "</span> _se[<span class="kw">weight</span>] </span>
<span id="cb85-3"><a href="programar-do---files.html#cb85-3" aria-hidden="true" tabindex="-1"></a>* Valores predichos </span>
<span id="cb85-4"><a href="programar-do---files.html#cb85-4" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> anxietyhat = _b[<span class="dt">_cons</span>] + _b[<span class="kw">weight</span>] * <span class="kw">weight</span> + <span class="co">/// </span></span>
<span id="cb85-5"><a href="programar-do---files.html#cb85-5" aria-hidden="true" tabindex="-1"></a>_b[age] * age + _b[age2] * age2</span></code></pre></div>
<p>También podemos utilizar las posiciones de los elementos de la matriz (<code>b[i,k)]</code>).</p>
</div>
<div id="funciones" class="section level4" number="3.0.4.3">
<h4>
<span class="header-section-number">3.0.4.3</span> Funciones<a class="anchor" aria-label="anchor" href="#funciones"><i class="fas fa-link"></i></a>
</h4>
<p>Solo disponibles para comandos <code>e-class</code>. Por ejemplo, si estimamos una regresión veremos que la unica función disponible es <code>e(sample)</code>.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb86-1"><a href="programar-do---files.html#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto </span>
<span id="cb86-2"><a href="programar-do---files.html#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="kw">regress</span> mpg <span class="kw">weight</span> <span class="fu">length</span> rep78</span>
<span id="cb86-3"><a href="programar-do---files.html#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="kw">ereturn</span> <span class="ot">list</span></span></code></pre></div>
<p><code>e(sample)</code> nos indica si una determinada observación se utilizó para estimar la regresión. Es decir, es igual a uno si una observación estaba en la muestra de estimación y 0 si fue excluida.</p>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.4.1:</b></p>
<p>Preguntas:</p>
<ol style="list-style-type: decimal">
<li>Estime una regresión de mpg contra weight length rep78 utilizando base de datos auto, pero solo para los autos extranjeros (<code>foreign == 1</code>).</li>
<li>Genere una nueva variable, llamada <code>enmuestra</code> que tome los valores dados por la función <code>e(sample)</code>.</li>
<li>Utilizando <code>br</code>, observe los valores de <code>enmuestra</code>. ¿Qué observa?</li>
<li>Calcule la estadística de <code>mpg</code> solo para las observaciones que fueron incluidas en la regresión.</li>
</ol>
</div>
</div>
</div>
<div id="iteradores" class="section level3" number="3.0.5">
<h3>
<span class="header-section-number">3.0.5</span> Iteradores<a class="anchor" aria-label="anchor" href="#iteradores"><i class="fas fa-link"></i></a>
</h3>
<div id="foreach" class="section level4" number="3.0.5.1">
<h4>
<span class="header-section-number">3.0.5.1</span> Foreach<a class="anchor" aria-label="anchor" href="#foreach"><i class="fas fa-link"></i></a>
</h4>
<p><code>foreach</code> y <code>forvalues</code>: <code>forvalues</code> itera sobre una lista de números y <code>foreach</code> recorre los elementos de una macro, o los nombres de las variables de una lista de variables, o los elementos de una lista de números.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb87-1"><a href="programar-do---files.html#cb87-1" aria-hidden="true" tabindex="-1"></a>* Foreach</span>
<span id="cb87-2"><a href="programar-do---files.html#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> animal <span class="kw">in</span> cats and dogs { </span>
<span id="cb87-3"><a href="programar-do---files.html#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"`animal'"</span></span>
<span id="cb87-4"><a href="programar-do---files.html#cb87-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb87-5"><a href="programar-do---files.html#cb87-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-6"><a href="programar-do---files.html#cb87-6" aria-hidden="true" tabindex="-1"></a>* Forvalues </span>
<span id="cb87-7"><a href="programar-do---files.html#cb87-7" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> i = 1(1)100 { </span>
<span id="cb87-8"><a href="programar-do---files.html#cb87-8" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> x<span class="ot">`i'</span> = runiform()</span>
<span id="cb87-9"><a href="programar-do---files.html#cb87-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Hay algunas variaciones en <code>foreach</code> según el tipo de lista. La sintaxis es similar a la recien presentada, pero difiere en dos aspectos:</p>
<ul>
<li>
<code>in</code> se remplaza por <code>of</code>.</li>
<li>Hay que llamar al identificador.</li>
<li>Veamos como iterar sobre una lista de <strong>globales y locales</strong>.
\end{itemize}</li>
</ul>
<div class="sourceCode" id="cb88"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb88-1"><a href="programar-do---files.html#cb88-1" aria-hidden="true" tabindex="-1"></a>* Sobre locales <span class="fu">y</span> globales</span>
<span id="cb88-2"><a href="programar-do---files.html#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> money <span class="st">"Franc Dollar Lira Pound"</span> </span>
<span id="cb88-3"><a href="programar-do---files.html#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> currency <span class="kw">of</span> <span class="kw">local</span> money { </span>
<span id="cb88-4"><a href="programar-do---files.html#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"`currency'"</span></span>
<span id="cb88-5"><a href="programar-do---files.html#cb88-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Veamos como iterar sobre una <strong>lista de variables</strong>:</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb89-1"><a href="programar-do---files.html#cb89-1" aria-hidden="true" tabindex="-1"></a>* Sobre lista <span class="kw">de</span> variables</span>
<span id="cb89-2"><a href="programar-do---files.html#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> <span class="kw">var</span> <span class="kw">of</span> <span class="kw">varlist</span> mpg <span class="kw">weight</span>-turn { </span>
<span id="cb89-3"><a href="programar-do---files.html#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="kw">quietly</span> <span class="kw">summarize</span> <span class="ot">`var'</span> <span class="kw">summarize</span> <span class="ot">`var'</span> <span class="kw">if</span> <span class="ot">`var'</span> &gt; <span class="fu">r</span>(<span class="kw">mean</span>)</span>
<span id="cb89-4"><a href="programar-do---files.html#cb89-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Veamos como iterar sobre una <strong>lista de de nuevas variables</strong>:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb90-1"><a href="programar-do---files.html#cb90-1" aria-hidden="true" tabindex="-1"></a>* Sobre lista <span class="kw">de</span> nuevas variables</span>
<span id="cb90-2"><a href="programar-do---files.html#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> <span class="kw">var</span> <span class="kw">of</span> newlist z1-z20 { </span>
<span id="cb90-3"><a href="programar-do---files.html#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> <span class="ot">`var'</span> = runiform()</span>
<span id="cb90-4"><a href="programar-do---files.html#cb90-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Veamos como iterar sobre una <strong>lista de números</strong>:</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb91-1"><a href="programar-do---files.html#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> num <span class="kw">of</span> numlist 1 4/8 13(2)21 103 { </span>
<span id="cb91-2"><a href="programar-do---files.html#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="ot">`num'</span></span>
<span id="cb91-3"><a href="programar-do---files.html#cb91-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="combinar-macros-con-iteradores" class="section level4" number="3.0.5.2">
<h4>
<span class="header-section-number">3.0.5.2</span> Combinar macros con iteradores<a class="anchor" aria-label="anchor" href="#combinar-macros-con-iteradores"><i class="fas fa-link"></i></a>
</h4>
<p><code>foreach</code> y <code>forvalues</code> combinados con macros pueden utilizarse para ahorrarnos mucho trabajo. Podemos generar tun conjunto de locales a partir de iteraciones.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb92-1"><a href="programar-do---files.html#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> replicate.dta, <span class="kw">replace</span></span>
<span id="cb92-2"><a href="programar-do---files.html#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="kw">levelsof</span> cty</span>
<span id="cb92-3"><a href="programar-do---files.html#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> ctries <span class="st">"`r(levels)'"</span> </span>
<span id="cb92-4"><a href="programar-do---files.html#cb92-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-5"><a href="programar-do---files.html#cb92-5" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> ctr <span class="kw">in</span> <span class="ot">`ctries'</span> { </span>
<span id="cb92-6"><a href="programar-do---files.html#cb92-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">sum</span> hours_t <span class="kw">if</span> cty == <span class="st">"`ctr'"</span> </span>
<span id="cb92-7"><a href="programar-do---files.html#cb92-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">local</span> nombre <span class="ot">`ctr'</span> = <span class="ot">`r(mean)'</span></span>
<span id="cb92-8"><a href="programar-do---files.html#cb92-8" aria-hidden="true" tabindex="-1"></a>} </span></code></pre></div>
<p>Como ya hemos visto, el comando <code>levelsof</code> devuelve una lista de todos los valores distintos de una variable categórica y los guarda en la macro <code>r(levels)</code>. Esto lo hace en el caso de que nosotros no le asignemos un nombre. Podemos utilizar esta lista para los países y años de nuestra muestra para definir dos iteraciones que recorran todos los valores posibles. Para cada valor resumimos la población y definimos una macro local compuesta por el código de país y el año (por ejemplo, USA1990) que toma el valor de la población en ese año para ese país.</p>
<p>Una aplicación del <code>forvalues</code>:</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb93-1"><a href="programar-do---files.html#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> gdp4cty, <span class="kw">clear</span> </span>
<span id="cb93-2"><a href="programar-do---files.html#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> i = 1/4 {</span>
<span id="cb93-3"><a href="programar-do---files.html#cb93-3" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> <span class="kw">double</span> lngdp'i' = <span class="fu">log</span>(gdp'i')</span>
<span id="cb93-4"><a href="programar-do---files.html#cb93-4" aria-hidden="true" tabindex="-1"></a><span class="kw">summarize</span> lngdp'i'</span>
<span id="cb93-5"><a href="programar-do---files.html#cb93-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Utilizando dos <code>forvalues</code>:</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb94-1"><a href="programar-do---files.html#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> <span class="fu">y</span> = 1995(2)1999 {</span>
<span id="cb94-2"><a href="programar-do---files.html#cb94-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">forvalues</span> i = 2(2)4 {</span>
<span id="cb94-3"><a href="programar-do---files.html#cb94-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">summarize</span> gdp<span class="ot">`i'</span>_<span class="ot">`y'</span></span>
<span id="cb94-4"><a href="programar-do---files.html#cb94-4" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb94-5"><a href="programar-do---files.html#cb94-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><code>foreach</code> y <code>recode</code>:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb95-1"><a href="programar-do---files.html#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> gdp4cty, <span class="kw">clear</span> </span>
<span id="cb95-2"><a href="programar-do---files.html#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> ctycode 111 112 136 134 </span>
<span id="cb95-3"><a href="programar-do---files.html#cb95-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> i 0</span>
<span id="cb95-4"><a href="programar-do---files.html#cb95-4" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> c <span class="kw">of</span> <span class="kw">local</span> ctycode{ </span>
<span id="cb95-5"><a href="programar-do---files.html#cb95-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">local</span> ++i </span>
<span id="cb95-6"><a href="programar-do---files.html#cb95-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">local</span> rc <span class="st">"`rc' (`i'=`c')"</span> </span>
<span id="cb95-7"><a href="programar-do---files.html#cb95-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb95-8"><a href="programar-do---files.html#cb95-8" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"`rc'"</span></span>
<span id="cb95-9"><a href="programar-do---files.html#cb95-9" aria-hidden="true" tabindex="-1"></a><span class="kw">recode</span> <span class="kw">cc</span> <span class="ot">`rc'</span>, <span class="kw">gen</span>(newcc)</span></code></pre></div>
<p>Loops anidados: <code>foreach</code> y <code>forvalues</code></p>
<div class="sourceCode" id="cb96"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb96-1"><a href="programar-do---files.html#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> gdp4cty, <span class="kw">clear</span> </span>
<span id="cb96-2"><a href="programar-do---files.html#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> country US UK DE FR </span>
<span id="cb96-3"><a href="programar-do---files.html#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> yrlist 1995 1999 </span>
<span id="cb96-4"><a href="programar-do---files.html#cb96-4" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> i = 1/4 {</span>
<span id="cb96-5"><a href="programar-do---files.html#cb96-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span> cnaine: <span class="fu">word</span> <span class="ot">`i'</span> <span class="kw">of</span> <span class="ot">`country'</span></span>
<span id="cb96-6"><a href="programar-do---files.html#cb96-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="st">"`cnaine'"</span></span>
<span id="cb96-7"><a href="programar-do---files.html#cb96-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="fu">y</span> <span class="kw">of</span> <span class="kw">local</span> yrlist {</span>
<span id="cb96-8"><a href="programar-do---files.html#cb96-8" aria-hidden="true" tabindex="-1"></a>            <span class="kw">rename</span> gdp<span class="ot">`i'</span>_<span class="ot">`y'</span> gdp<span class="ot">`cnaine'</span>_<span class="ot">`y'</span></span>
<span id="cb96-9"><a href="programar-do---files.html#cb96-9" aria-hidden="true" tabindex="-1"></a>    } </span>
<span id="cb96-10"><a href="programar-do---files.html#cb96-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>En estos casos es bueno utilizar espacios para hacer el código más amigable. Ojo que a Stata no le interesa esto para ejecutar, es solo una cuestión de estilo.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb97-1"><a href="programar-do---files.html#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto, <span class="kw">clear</span></span>
<span id="cb97-2"><a href="programar-do---files.html#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> <span class="fu">y</span> <span class="kw">of</span> <span class="kw">varlist</span> mpg rep78 headroom trunk <span class="kw">weight</span> <span class="fu">length</span> { </span>
<span id="cb97-3"><a href="programar-do---files.html#cb97-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> x <span class="kw">of</span> <span class="kw">varlist</span> rep78 price displacement gear_ratio foreign { </span>
<span id="cb97-4"><a href="programar-do---files.html#cb97-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">regress</span> <span class="ot">`y'</span> <span class="ot">`x'</span></span>
<span id="cb97-5"><a href="programar-do---files.html#cb97-5" aria-hidden="true" tabindex="-1"></a>} </span></code></pre></div>
<p>También útil para estimar regresiones.</p>
<p>Tokenize: Podemos almacenar los elementos de la lista de países en macros numeradas con <code>tokenize</code>.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb98-1"><a href="programar-do---files.html#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> gdp4cty, <span class="kw">clear</span></span>
<span id="cb98-2"><a href="programar-do---files.html#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> country US UK DE FR </span>
<span id="cb98-3"><a href="programar-do---files.html#cb98-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> yrlist 1995 1999 </span>
<span id="cb98-4"><a href="programar-do---files.html#cb98-4" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> ncty: <span class="fu">word</span> <span class="fu">count</span> <span class="ot">`country'</span></span>
<span id="cb98-5"><a href="programar-do---files.html#cb98-5" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"`ncty'"</span></span>
<span id="cb98-6"><a href="programar-do---files.html#cb98-6" aria-hidden="true" tabindex="-1"></a><span class="kw">tokenize</span> <span class="ot">`country'</span></span>
<span id="cb98-7"><a href="programar-do---files.html#cb98-7" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> i = 1/<span class="ot">`ncty'</span>{</span>
<span id="cb98-8"><a href="programar-do---files.html#cb98-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="fu">y</span> <span class="kw">of</span> <span class="kw">local</span> yrlist {</span>
<span id="cb98-9"><a href="programar-do---files.html#cb98-9" aria-hidden="true" tabindex="-1"></a>            <span class="kw">rename</span> gdp<span class="ot">`i'</span>_<span class="ot">`y'</span> gdp<span class="ot">``i'</span>'_<span class="ot">`y'</span></span>
<span id="cb98-10"><a href="programar-do---files.html#cb98-10" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb98-11"><a href="programar-do---files.html#cb98-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Aquí los nombres de los países se almacenan como valores de las macros numeradas. Debemos referenciar doblemente la macro <span class="math inline">\(i\)</span>. El contenido de esa macro la primera vez que se pasa por el bucle es el número 1. Para acceder al primer código de país, debemos referenciar la macro <span class="math inline">\(`1'\)</span>.</p>
</div>
<div id="while-loop" class="section level4" number="3.0.5.3">
<h4>
<span class="header-section-number">3.0.5.3</span> While loop<a class="anchor" aria-label="anchor" href="#while-loop"><i class="fas fa-link"></i></a>
</h4>
<p>Realiza la iteración o se repite una lista de comandos mientras la condición <code>while</code> sea verdadera. La sintaxis es:</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb99-1"><a href="programar-do---files.html#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="kw">while</span> <span class="fu">exp</span> { </span>
<span id="cb99-2"><a href="programar-do---files.html#cb99-2" aria-hidden="true" tabindex="-1"></a>hace algo</span>
<span id="cb99-3"><a href="programar-do---files.html#cb99-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>¿Cuando es útil? : <strong>Cuando no este seguro(a) cuantas veces se realizará la iteración</strong>. Notar que si no hay convergencia, va iterar infinitamente.</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb100-1"><a href="programar-do---files.html#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="kw">while</span> <span class="fu">reldif</span> (nueva, antigua) &gt; 0.001 { </span>
<span id="cb100-2"><a href="programar-do---files.html#cb100-2" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>También se puede combinar con macros. Es importante utilizar los incrementales:</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb101-1"><a href="programar-do---files.html#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> i=1 </span>
<span id="cb101-2"><a href="programar-do---files.html#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="kw">while</span> <span class="ot">`i'</span>&lt;=5 {</span>
<span id="cb101-3"><a href="programar-do---files.html#cb101-3" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"loop number"</span> <span class="ot">`i'</span> </span>
<span id="cb101-4"><a href="programar-do---files.html#cb101-4" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> i = <span class="ot">`i'</span>+1</span>
<span id="cb101-5"><a href="programar-do---files.html#cb101-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>La primera parte define el inicio del contador, mientras que la segunda indica la condición para que sea ejecutado. El <code>local</code> final actualiza (incremental). Si el incremento es unitario podemos utilizar <code>local ++i</code>.</p>
</div>
<div id="branching" class="section level4" number="3.0.5.4">
<h4>
<span class="header-section-number">3.0.5.4</span> Branching<a class="anchor" aria-label="anchor" href="#branching"><i class="fas fa-link"></i></a>
</h4>
<p>Hacer una cosa en caso de que alguna condición sea cierta y otra cosa en caso de que sea falsa. La sintaxis básica es:</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb102-1"><a href="programar-do---files.html#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> algo es verdadero { </span>
<span id="cb102-2"><a href="programar-do---files.html#cb102-2" aria-hidden="true" tabindex="-1"></a>hacer esto</span>
<span id="cb102-3"><a href="programar-do---files.html#cb102-3" aria-hidden="true" tabindex="-1"></a>} <span class="kw">else</span> {</span>
<span id="cb102-4"><a href="programar-do---files.html#cb102-4" aria-hidden="true" tabindex="-1"></a>hacer lo contrario</span>
<span id="cb102-5"><a href="programar-do---files.html#cb102-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.4.2:</b></p>
<p>Preguntas</p>
<ol style="list-style-type: decimal">
<li>Defina una macro llamada mimacro que sea igual a un número entero aleatorio entre 1 y 99.</li>
<li>Utilizando <code>if</code> y <code>else</code> muestre un mensaje que diga si es par o impar.</li>
</ol>
</div>
</div>
<div id="aplicaciones" class="section level4" number="3.0.5.5">
<h4>
<span class="header-section-number">3.0.5.5</span> Aplicaciones<a class="anchor" aria-label="anchor" href="#aplicaciones"><i class="fas fa-link"></i></a>
</h4>
<p>Seguir secuencias especiales: <code>creturn</code> posee varias constantes y valores a los que se puede acceder. Por ejemplo:</p>
<ul>
<li>
<code>c(filename)</code> nombre del último nombre del archivo guardado.</li>
<li>
<code>c(alpha/ALPHA)</code> lista de letras minúsculas/mayusculas.<br>
</li>
<li>
<code>c(Mons)</code> lista de nombres de los meses abreviados.</li>
<li>
<code>c(Months)</code> lista de los nombres de los meses no abreviados.</li>
<li>
<code>c(Wdays)</code> lista de los dias de la semana abreviados a tres caracteres.</li>
<li>
<code>c(Weekdays)</code> lista de los días de la semana no abreviados.</li>
</ul>
<p>Con un iterador es posible aplicar estas listas para agregar labels. Suponga que tenemos valores de 1 a 12 que representan meses.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb103-1"><a href="programar-do---files.html#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span> <span class="ot">all</span></span>
<span id="cb103-2"><a href="programar-do---files.html#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="kw">obs</span> 12</span>
<span id="cb103-3"><a href="programar-do---files.html#cb103-3" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> <span class="fu">month</span> = <span class="dt">_n</span> </span>
<span id="cb103-4"><a href="programar-do---files.html#cb103-4" aria-hidden="true" tabindex="-1"></a><span class="kw">tokenize</span> <span class="ot">`c(Months)'</span> </span>
<span id="cb103-5"><a href="programar-do---files.html#cb103-5" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> i = 1/12 {</span>
<span id="cb103-6"><a href="programar-do---files.html#cb103-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">label</span> <span class="kw">define</span> monthlab <span class="ot">`i'</span> <span class="st">"``i''"</span> , modify </span>
<span id="cb103-7"><a href="programar-do---files.html#cb103-7" aria-hidden="true" tabindex="-1"></a>                   }</span>
<span id="cb103-8"><a href="programar-do---files.html#cb103-8" aria-hidden="true" tabindex="-1"></a><span class="kw">label</span> val <span class="fu">month</span> monthlab</span></code></pre></div>
</div>
<div id="monitorear-un-loop" class="section level4" number="3.0.5.6">
<h4>
<span class="header-section-number">3.0.5.6</span> Monitorear un loop<a class="anchor" aria-label="anchor" href="#monitorear-un-loop"><i class="fas fa-link"></i></a>
</h4>
<p>Ejemplo proveniente de (Stata tip 41). Cualquier <em>loop</em> puede ser modificado para que muestre su progreso con el comando <code>_dots</code>. Esto es importante para cuando se requieren hacer procesos que toman varias horas y es necesario monitorear avances.</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb104-1"><a href="programar-do---files.html#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="kw">_dots</span> 0, <span class="bn">title</span>(Loop ejecutando) reps(75) </span>
<span id="cb104-2"><a href="programar-do---files.html#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> i = 1/75 { </span>
<span id="cb104-3"><a href="programar-do---files.html#cb104-3" aria-hidden="true" tabindex="-1"></a><span class="kw">_dots</span> ‘i’ 0</span>
<span id="cb104-4"><a href="programar-do---files.html#cb104-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb104-5"><a href="programar-do---files.html#cb104-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-6"><a href="programar-do---files.html#cb104-6" aria-hidden="true" tabindex="-1"></a>----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5</span>
<span id="cb104-7"><a href="programar-do---files.html#cb104-7" aria-hidden="true" tabindex="-1"></a>..................................................    50</span>
<span id="cb104-8"><a href="programar-do---files.html#cb104-8" aria-hidden="true" tabindex="-1"></a>.........................</span></code></pre></div>
<p>El primer comando <code>_dots</code> establece las lineas. Titulo y número de repeticiones son opcionales. <code>reps</code> solo acepta enteros como argumento. <code>_dots ‘i’ 0</code> tiene dos elementos:</p>
<ul>
<li>El primer argumento es el número de repetición, que registra el número de intentos en curso. En el ejemplo, esta automáticamente determinado por el <em>loop</em>.</li>
<li>El segundo argumento es el código de retorno, el cual indica el tipo de símbolo. En el ejemplo tenemos un 0.</li>
<li>Los códigos de retorno alternativos producen una “s” (-1), “.” (), “x” roja (1), una “e” (2), una “n” (3) o un “?” (cualquier otro valor).</li>
</ul>
<p>Ejemplo no numérico: La idea es definir una macro local para que actue como un contador.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb105-1"><a href="programar-do---files.html#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto</span>
<span id="cb105-2"><a href="programar-do---files.html#cb105-2" aria-hidden="true" tabindex="-1"></a><span class="kw">_dots</span> 0, reps(10)</span>
<span id="cb105-3"><a href="programar-do---files.html#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> <span class="kw">var</span> <span class="kw">of</span> <span class="kw">varlist</span> price - gear_ratio {</span>
<span id="cb105-4"><a href="programar-do---files.html#cb105-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">sum</span> <span class="ot">`var'</span>, <span class="kw">d</span></span>
<span id="cb105-5"><a href="programar-do---files.html#cb105-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">local</span> i = <span class="ot">`i'</span>+1</span>
<span id="cb105-6"><a href="programar-do---files.html#cb105-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">_dots</span> <span class="ot">`i'</span> 0</span>
<span id="cb105-7"><a href="programar-do---files.html#cb105-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Contar repeticiones:</p>
<ul>
<li>El número de repeticiones en <code>rep</code> no es calculado por <code>_dots</code>. Es necesario contar manualmente las variables e introducir el número.</li>
<li>Esto lo vamos a hacer con la ayuda de una función de macro extendida <code>sizeof</code>.</li>
<li>
<code>unab</code> permite ingresar una lista de variable abreviada y expandirla, de forma tal de que la pueda contar.</li>
</ul>
<div class="sourceCode" id="cb106"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb106-1"><a href="programar-do---files.html#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto</span>
<span id="cb106-2"><a href="programar-do---files.html#cb106-2" aria-hidden="true" tabindex="-1"></a><span class="kw">unab</span> myvars : price - gear_ratio</span>
<span id="cb106-3"><a href="programar-do---files.html#cb106-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="kw">N</span> : <span class="ot">list</span> <span class="kw">sizeof</span> myvars</span>
<span id="cb106-4"><a href="programar-do---files.html#cb106-4" aria-hidden="true" tabindex="-1"></a><span class="kw">_dots</span> 0, reps(<span class="ot">`N'</span>)</span>
<span id="cb106-5"><a href="programar-do---files.html#cb106-5" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> <span class="kw">var</span> <span class="kw">of</span> <span class="kw">varlist</span> <span class="ot">`myvars'</span> {</span>
<span id="cb106-6"><a href="programar-do---files.html#cb106-6" aria-hidden="true" tabindex="-1"></a>  ...</span>
<span id="cb106-7"><a href="programar-do---files.html#cb106-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">local</span> i = <span class="ot">`i'</span>+1</span>
<span id="cb106-8"><a href="programar-do---files.html#cb106-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">_dots</span> <span class="ot">`i'</span> 0</span>
<span id="cb106-9"><a href="programar-do---files.html#cb106-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Un ejemplo más complejo es:</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb107-1"><a href="programar-do---files.html#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="kw">noisily</span> <span class="kw">_dots</span> 0, <span class="bn">title</span>(Looping <span class="kw">until</span> 70 successes...) </span>
<span id="cb107-2"><a href="programar-do---files.html#cb107-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> rep 1 </span>
<span id="cb107-3"><a href="programar-do---files.html#cb107-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> nsuccess 0 </span>
<span id="cb107-4"><a href="programar-do---files.html#cb107-4" aria-hidden="true" tabindex="-1"></a><span class="kw">while</span> ‘nsuccess’ &lt; 70 { </span>
<span id="cb107-5"><a href="programar-do---files.html#cb107-5" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> fail = uniform() &lt; .2 </span>
<span id="cb107-6"><a href="programar-do---files.html#cb107-6" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> nsuccess = ‘nsuccess’ + (‘fail’ == 0) </span>
<span id="cb107-7"><a href="programar-do---files.html#cb107-7" aria-hidden="true" tabindex="-1"></a><span class="kw">noisily</span> <span class="kw">_dots</span> ‘rep++’ ‘fail’</span>
<span id="cb107-8"><a href="programar-do---files.html#cb107-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Se ejecuta hasta que logre 70 aciertos. En este ejemplo artificial, cada iteración tiene un éxito aleatorio con una probabilidad del 80%. Los éxitos se indican con un punto (.) y los fracasos con una x.</p>
</div>
</div>
<div id="manejo-de-bases-de-datos" class="section level3" number="3.0.6">
<h3>
<span class="header-section-number">3.0.6</span> Manejo de bases de datos<a class="anchor" aria-label="anchor" href="#manejo-de-bases-de-datos"><i class="fas fa-link"></i></a>
</h3>
<div id="prefijo-by" class="section level4" number="3.0.6.1">
<h4>
<span class="header-section-number">3.0.6.1</span> Prefijo: by<a class="anchor" aria-label="anchor" href="#prefijo-by"><i class="fas fa-link"></i></a>
</h4>
<p>Los prefijos en Stata ejecutan tareas repetitivas sin la necesidad de especificar el rango de valores sobre la tarea que es ejecutada. Un prefijo muy conocido es <code>by</code>. Por ejemplo, <code>by varlist [, sort]: command</code>. <code>command</code> es repetido para cada valor de la variable. Es más, repeticiones siguen el orden de la variable sea <em>string</em> o <em>numeric</em>.</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb108-1"><a href="programar-do---files.html#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> bpress, <span class="kw">clear</span></span>
<span id="cb108-2"><a href="programar-do---files.html#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="kw">bysort</span> sex agegrp: <span class="kw">summarize</span> bp </span></code></pre></div>
</div>
<div id="prefijo-xi" class="section level4" number="3.0.6.2">
<h4>
<span class="header-section-number">3.0.6.2</span> Prefijo: xi<a class="anchor" aria-label="anchor" href="#prefijo-xi"><i class="fas fa-link"></i></a>
</h4>
<p><code>xi</code> es útil para cuando queremos producir un variable indicador para las observaciones que son distintas entre si.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb109-1"><a href="programar-do---files.html#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="kw">xi</span> i.agegrp</span></code></pre></div>
<p>El ejemplo le esta diciendo a Stata que genere variables indicadores. Esto es muy útil para reducir los códigos.</p>
<p>Interpretando prefijo xi: <code>xi</code> es comúnmente utilizado como un prefijo. La principal ventaja es cuando existen múltiples interacciones entre las variables.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb110-1"><a href="programar-do---files.html#cb110-1" aria-hidden="true" tabindex="-1"></a>* Caso 1: incluye indicadores <span class="kw">de</span> ambas variables.</span>
<span id="cb110-2"><a href="programar-do---files.html#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="kw">xi</span>: <span class="kw">regress</span> bp i.agegrp i.sex</span>
<span id="cb110-3"><a href="programar-do---files.html#cb110-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-4"><a href="programar-do---files.html#cb110-4" aria-hidden="true" tabindex="-1"></a>* Caso 2: incluye además interacciones entre ellas.</span>
<span id="cb110-5"><a href="programar-do---files.html#cb110-5" aria-hidden="true" tabindex="-1"></a><span class="kw">xi</span>: <span class="kw">regress</span> bp i.agegrp*i.sex</span>
<span id="cb110-6"><a href="programar-do---files.html#cb110-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-7"><a href="programar-do---files.html#cb110-7" aria-hidden="true" tabindex="-1"></a>* Caso 3: Interactúa una <span class="kw">variable</span> continua con una discreta.</span>
<span id="cb110-8"><a href="programar-do---files.html#cb110-8" aria-hidden="true" tabindex="-1"></a><span class="kw">xi</span>: <span class="kw">regress</span> bp i.agegrp*bp0</span>
<span id="cb110-9"><a href="programar-do---files.html#cb110-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-10"><a href="programar-do---files.html#cb110-10" aria-hidden="true" tabindex="-1"></a>* Caso 4: Incluye solo interacciones con <span class="kw">variable</span> continua (además <span class="kw">de</span> principal). </span>
<span id="cb110-11"><a href="programar-do---files.html#cb110-11" aria-hidden="true" tabindex="-1"></a><span class="kw">xi</span>: <span class="kw">regress</span> bp i.agegrp|bp0 </span></code></pre></div>
</div>
<div id="prefijo-statsby" class="section level4" number="3.0.6.3">
<h4>
<span class="header-section-number">3.0.6.3</span> Prefijo: statsby<a class="anchor" aria-label="anchor" href="#prefijo-statsby"><i class="fas fa-link"></i></a>
</h4>
<p><code>statsby</code> permite ampliar <code>by</code>. Este último tiene la limitación de permitir únicamente un comando.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb111-1"><a href="programar-do---files.html#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="kw">statsby</span> <span class="kw">mean</span>=<span class="fu">r</span>(<span class="kw">mean</span>) <span class="fu">sd</span>=<span class="fu">r</span>(<span class="fu">sd</span>) n=<span class="fu">r</span>(<span class="kw">N</span>), <span class="kw">by</span>(agegrp sex): <span class="kw">summarize</span> bp</span></code></pre></div>
<p>Se produce una nueva base de datos con una observación por grupo con los estadísticos incorporados. <strong>Útil para calcular estadística descriptiva</strong>.</p>
</div>
<div id="prefijo-rolling" class="section level4" number="3.0.6.4">
<h4>
<span class="header-section-number">3.0.6.4</span> Prefijo: rolling<a class="anchor" aria-label="anchor" href="#prefijo-rolling"><i class="fas fa-link"></i></a>
</h4>
<p><code>statsby</code> permite obtener estadísticas para sub-muestras que no se traslapan. <code>rolling</code> sirve para sub-muestras traslapadas. Por ejemplo, al trabajar con series de tiempo se quiere calcular estadísticas para datos que están traslapados (el. calcular una media móvil).</p>
<p>Vamos a calcular medias y medianas utilizando una ventana de 90 días:</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb112-1"><a href="programar-do---files.html#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> ibm, <span class="kw">clear</span> </span>
<span id="cb112-2"><a href="programar-do---files.html#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="kw">rolling</span> <span class="kw">mean</span>=<span class="fu">r</span>(<span class="kw">mean</span>) <span class="kw">median</span>=<span class="fu">r</span>(p50), <span class="kw">window</span>(90): <span class="kw">summarize</span> spx, <span class="kw">d</span> </span>
<span id="cb112-3"><a href="programar-do---files.html#cb112-3" aria-hidden="true" tabindex="-1"></a><span class="kw">tsset</span> <span class="kw">end</span> </span>
<span id="cb112-4"><a href="programar-do---files.html#cb112-4" aria-hidden="true" tabindex="-1"></a><span class="kw">tsline</span> <span class="kw">mean</span></span></code></pre></div>
<p><code>start</code> y <code>end</code> indican el inicio y fin de la ventana.</p>
</div>
<div id="merge-y-append" class="section level4" number="3.0.6.5">
<h4>
<span class="header-section-number">3.0.6.5</span> Merge y Append<a class="anchor" aria-label="anchor" href="#merge-y-append"><i class="fas fa-link"></i></a>
</h4>
<p>Recomendaciones para utilizar merge</p>
<ul>
<li>Especifique siempre el tipo de fusión (1:1, m:1 o 1:m). Si no se especifica el tipo de fusión, se llama a la versión antigua y no robusta de la fusión.</li>
<li>Nunca haga fusiones de muchos a muchos (m:m), o al menos, sólo hágalo cuando tenga una muy buena razón.</li>
<li>Incluya siempre la opción <code>assert()</code> para indicar qué patrón de observaciones coincidentes espera.</li>
<li>Incluya siempre la opción <code>keep()</code> para indicar qué observaciones deben conservarse del conjunto de datos fusionados.</li>
<li>Siempre que sea posible, incluya la opción <code>keepusing()</code> y enumere explícitamente qué variables pretende añadir al conjunto de datos; puede incluir esta opción incluso cuando mantenga todas las variables de los datos utilizados.</li>
<li>Utilice la opción <code>nogen</code>, excepto cuando piense utilizar explícitamente la variable <code>_merge</code> más adelante. Nunca debe guardar un conjunto de datos que tenga <code>_merge</code>; si necesita esta variable más adelante, dele un nombre más informativo.</li>
</ul>
<p>Con respecto a especificar <code>_merge</code> y <code>assert</code> notar que:</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb113-1"><a href="programar-do---files.html#cb113-1" aria-hidden="true" tabindex="-1"></a>     <span class="kw">merge</span> ..., <span class="kw">assert</span>(<span class="fu">match</span> master) <span class="kw">keep</span>(<span class="fu">match</span>)</span>
<span id="cb113-2"><a href="programar-do---files.html#cb113-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-3"><a href="programar-do---files.html#cb113-3" aria-hidden="true" tabindex="-1"></a>     * Es equivalente a: </span>
<span id="cb113-4"><a href="programar-do---files.html#cb113-4" aria-hidden="true" tabindex="-1"></a>     <span class="kw">merge</span> ...</span>
<span id="cb113-5"><a href="programar-do---files.html#cb113-5" aria-hidden="true" tabindex="-1"></a>     <span class="kw">assert</span> <span class="dt">_merge</span>==1 | <span class="dt">_merge</span>==3</span>
<span id="cb113-6"><a href="programar-do---files.html#cb113-6" aria-hidden="true" tabindex="-1"></a>     <span class="kw">keep</span> <span class="kw">if</span> <span class="dt">_merge</span>==3</span></code></pre></div>
<p>Append con ciudado:</p>
<ul>
<li>El comando <code>append</code> es muy útil para manejos de bases de datos. Una precaución común es con respecto al nombre de las variables. Si dos variables (ej. PRECIO y precio) difieren, se generaran dos columnas nuevas al hacer el <code>append</code> en vez de una.</li>
<li>Una precaución un poco menos conocida guarda relación con el tipo de variables. ¿Qué ocurre si dos variables se llaman igual, pero <strong>estan guardadas en formatos distintos</strong>?</li>
<li>En este caso, el orden en el cual se combine la base de datos va a importar y puede generar diferencias al momento de pegar datos. Esto es especialmente importante cuando una variable esta guardada en numérico en una base de datos y en <code>string</code> en la otra.</li>
</ul>
<p>Veamos un ejemplo con la base <code>auto.dta</code>. Vamos a crear dos bases de datos según la procedencia de los autos y ejecutar el comando <code>append</code>.</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb114-1"><a href="programar-do---files.html#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto </span>
<span id="cb114-2"><a href="programar-do---files.html#cb114-2" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> <span class="kw">if</span> foreign</span>
<span id="cb114-3"><a href="programar-do---files.html#cb114-3" aria-hidden="true" tabindex="-1"></a><span class="kw">save</span> autodom </span>
<span id="cb114-4"><a href="programar-do---files.html#cb114-4" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto </span>
<span id="cb114-5"><a href="programar-do---files.html#cb114-5" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> <span class="kw">if</span> !foreign </span>
<span id="cb114-6"><a href="programar-do---files.html#cb114-6" aria-hidden="true" tabindex="-1"></a><span class="kw">rename</span> foreign nondom </span>
<span id="cb114-7"><a href="programar-do---files.html#cb114-7" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> str foreign = <span class="st">"foreign"</span> <span class="kw">if</span> nondom </span>
<span id="cb114-8"><a href="programar-do---files.html#cb114-8" aria-hidden="true" tabindex="-1"></a><span class="kw">save</span> autofor</span>
<span id="cb114-9"><a href="programar-do---files.html#cb114-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-10"><a href="programar-do---files.html#cb114-10" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> autdom </span>
<span id="cb114-11"><a href="programar-do---files.html#cb114-11" aria-hidden="true" tabindex="-1"></a><span class="kw">append</span> <span class="kw">using</span> autofor </span>
<span id="cb114-12"><a href="programar-do---files.html#cb114-12" aria-hidden="true" tabindex="-1"></a><span class="kw">describe</span> foreign </span></code></pre></div>
<p>Notar que <code>append</code> genera el siguiente mensaje: <code>foreign is str 7 in using data byt will be byte now</code>. Noten que el contenido de la variable string se ha perdido: 22 casos son ahora <em>missing</em>.</p>
<p>¿Qué ocurre si hacemos el proceso al revés? Vamos a cargar autos extranjeros y le vamos a pegar autos domésticos:</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb115-1"><a href="programar-do---files.html#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> autfor </span>
<span id="cb115-2"><a href="programar-do---files.html#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="kw">append</span> <span class="kw">using</span> autodom, <span class="kw">force</span></span>
<span id="cb115-3"><a href="programar-do---files.html#cb115-3" aria-hidden="true" tabindex="-1"></a><span class="kw">describe</span> foreign </span>
<span id="cb115-4"><a href="programar-do---files.html#cb115-4" aria-hidden="true" tabindex="-1"></a><span class="kw">codebook</span> foreign</span></code></pre></div>
<p>El formato de los datos de la primer base de datos manda.
* No utilizar force sin cuidado.
* Con distintos tipos de datos, <code>append</code> es sensible al orden en que los archivos son pegados. <strong>Tener cuidado y revisar consistencia en los datos</strong>. Hacer test aquí tambíen es importante.</p>

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="buenas-pr%C3%A1cticas-de-programaci%C3%B3n-y-visualizaci%C3%B3n.html"><span class="header-section-number">2</span> Buenas prácticas de programación y visualización</a></div>
<div class="next"><a href="programar-ado---files.html"><span class="header-section-number">4</span> Programar ado - files</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav"><li>
<a class="nav-link" href="#programar-do---files"><span class="header-section-number">3</span> Programar do - files</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#programar-en-stata"><span class="header-section-number">3.0.1</span> Programar en Stata</a></li>
<li><a class="nav-link" href="#comandos-y-funciones-claves-y-algunos-detalles"><span class="header-section-number">3.0.2</span> Comandos y funciones claves (y algunos detalles)}</a></li>
<li><a class="nav-link" href="#macros-locales-y-globales"><span class="header-section-number">3.0.3</span> Macros locales y globales</a></li>
<li><a class="nav-link" href="#estructuras-de-datos"><span class="header-section-number">3.0.4</span> Estructuras de datos</a></li>
<li><a class="nav-link" href="#iteradores"><span class="header-section-number">3.0.5</span> Iteradores</a></li>
<li><a class="nav-link" href="#manejo-de-bases-de-datos"><span class="header-section-number">3.0.6</span> Manejo de bases de datos</a></li>
</ul>
</li></ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Análisis de Datos con Stata, R y Python</strong>" was written by Nicolás Campos Bijit. It was last built on Octubre 2023.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
