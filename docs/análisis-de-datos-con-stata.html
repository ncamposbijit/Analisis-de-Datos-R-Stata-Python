<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>2 Análisis de datos con Stata | Análisis de Datos con Stata, R y Python</title>
<meta name="author" content="Nicolás Campos Bijit">
<meta name="generator" content="bookdown 0.32 with bs4_book()">
<meta property="og:title" content="2 Análisis de datos con Stata | Análisis de Datos con Stata, R y Python">
<meta property="og:type" content="book">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="2 Análisis de datos con Stata | Análisis de Datos con Stata, R y Python">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.0/transition.js"></script><script src="libs/bs3compat-0.4.0/tabs.js"></script><script src="libs/bs3compat-0.4.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style4.css">
<meta name="description" content="2.1 Buenas prácticas de programación y visualización  2.1.1 Introducción  2.1.1.1 Programación defensiva Las personas somos malas escribiendo códigos Esta sección esta basada en los trabajos y...">
<meta property="og:description" content="2.1 Buenas prácticas de programación y visualización  2.1.1 Introducción  2.1.1.1 Programación defensiva Las personas somos malas escribiendo códigos Esta sección esta basada en los trabajos y...">
<meta name="twitter:description" content="2.1 Buenas prácticas de programación y visualización  2.1.1 Introducción  2.1.1.1 Programación defensiva Las personas somos malas escribiendo códigos Esta sección esta basada en los trabajos y...">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Análisis de Datos con Stata, R y Python</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Introducción</a></li>
<li><a class="active" href="an%C3%A1lisis-de-datos-con-stata.html"><span class="header-section-number">2</span> Análisis de datos con Stata</a></li>
<li><a class="" href="referencias.html"><span class="header-section-number">3</span> Referencias</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="análisis-de-datos-con-stata" class="section level1" number="2">
<h1>
<span class="header-section-number">2</span> Análisis de datos con Stata<a class="anchor" aria-label="anchor" href="#an%C3%A1lisis-de-datos-con-stata"><i class="fas fa-link"></i></a>
</h1>
<div id="buenas-prácticas-de-programación-y-visualización" class="section level2" number="2.1">
<h2>
<span class="header-section-number">2.1</span> Buenas prácticas de programación y visualización<a class="anchor" aria-label="anchor" href="#buenas-pr%C3%A1cticas-de-programaci%C3%B3n-y-visualizaci%C3%B3n"><i class="fas fa-link"></i></a>
</h2>
<div id="introducción-1" class="section level3" number="2.1.1">
<h3>
<span class="header-section-number">2.1.1</span> Introducción<a class="anchor" aria-label="anchor" href="#introducci%C3%B3n-1"><i class="fas fa-link"></i></a>
</h3>
<div id="programación-defensiva" class="section level4" number="2.1.1.1">
<h4>
<span class="header-section-number">2.1.1.1</span> Programación defensiva<a class="anchor" aria-label="anchor" href="#programaci%C3%B3n-defensiva"><i class="fas fa-link"></i></a>
</h4>
<p><strong>Las personas somos malas escribiendo códigos</strong></p>
<p>Esta sección esta basada en los trabajos y recursos publicados por <a href="https://www.nickeubank.com/">Nick Eubank</a>.</p>
<ul>
<li>La filosofía de escribir un código esta motivada por el hecho de que las personas somos <strong>malas escribiendo códigos</strong>.</li>
<li>Si queremos evitar errores <strong>no es suficiente con ser cuidadoso(a)</strong>
</li>
<li>Es necesario diseñar estrategias que tomen en cuenta el hecho de que vamos a cometer errores al escribir un código.</li>
<li>Tener buenas estrategias es más relevante cuando existe trabajo colaborativo, que puede <strong>amplificar los errores</strong>.</li>
</ul>
<p>En esta sección revisaremos cuatro ``buenas practicas’’ de programación. Estas practicas no son solo aplicables a Stata, más bien son guías generales para escribir códigos en cualquier lenguaje.</p>
<ul>
<li>Usar testeos o pruebas.</li>
<li>No duplicar información.</li>
<li>No transcribir información, siempre exportarla.</li>
<li>Usar un estilo correcto.</li>
</ul>
<p>Con estos elementos podremos:</p>
<ul>
<li>
<strong>Minimizar</strong> las oportunidades de generar errores al codificar.</li>
<li>
<strong>Maximizar</strong> la probabilidad de que cuando se cometa un error (lo que ocurrirá!) se pueda detectar con mayor facilidad.</li>
</ul>
<p><strong>¿Necesito entender estos principios?</strong></p>
<p> testearon la reproducibilidad de 67 artículos <strong>publicados</strong>. Todos con alguna sección empírica. Encuentran que:</p>
<ul>
<li>Solo 29 artículos fueron totalmente replicables.</li>
<li>29 artículos tenían problemas al tratar </li>
<li>9 poseen datos incorrectos o errores de codificación.</li>
</ul>
<p> indican que Chang y Li utilizan una versión poco estricta de replicabilidad.</p>
<div class="alert alert-block alert-info">
<b></b> (…) Chang and Li (2015) use a qualitative definition of replication, and test only key results of the paper, and this appears to lead to a fairly generous interpretation of replicability. (…)
</div>
<div class="alert alert-block alert-info">
<b></b> (…) To our minds, this is evidence that even when data are available (which they sometimes are not) , even when using the original data and a relatively non-stringent conceptual understanding of what constitutes replication success.
</div>
<p>¿Qué podemos aprender de esta historia?</p>
<ul>
<li>Todos y todas tienen problemas para codificar.</li>
<li>Hoy el <strong>trabajo es colaborativo</strong>. También tienes que confiar en los demás.</li>
<li>Hay cosas que no se pueden resolver con ser cuidadoso(a) al codificar. ¿Si los datos están mal?</li>
<li>Reproducibilidad y replicabilidad son claves. Buenas referencias se encuentran en la página de <a href="https://jschultecloos.github.io/">Julia Schulte-Cloos</a>.</li>
</ul>
</div>
<div id="practica-i-escribir-pruebas" class="section level4" number="2.1.1.2">
<h4>
<span class="header-section-number">2.1.1.2</span> Practica I: escribir pruebas<a class="anchor" aria-label="anchor" href="#practica-i-escribir-pruebas"><i class="fas fa-link"></i></a>
</h4>
<p>¿Qué es escribir pruebas?</p>
<p><a href="https://www.nickeubank.com/">Nick Eubank</a> indica que si el tuviese que elegir solo una practica elegiría agregar pruebas o tests a los códigos.</p>
<p>¿Qué es una prueba?</p>
<ul>
<li>Son afirmaciones que tienen como respuesta un valor lógico.</li>
<li>Buscan chequear una condición particular, en caso de que no se cumpla esta condición, la ejecución se detiene.</li>
</ul>
<p>¿Por qué agregar estos chequeos, si yo siempre chequeo o reviso mis códigos?</p>
<ol style="list-style-type: decimal">
<li>Test se ejecutan <strong>cada vez</strong> que corres tu código</li>
</ol>
<ul>
<li>La mayoría testea la <strong>primera</strong> vez que escribe un código.</li>
<li>Si hay una entrega el testeo disminuye rápidamente.</li>
<li>Si ya ha pasado algún tiempo. Únicamente ejecuto el código y espero los resultados. Entender un código (incluso el que uno(a) misma escribió es difícil).</li>
<li>Un error que se comete en una de las múltiples ediciones del código pueda ser detectado con facilidad al testear.</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>Genera el hábito de chequear permanentemente a un <strong>costo razonable</strong>
</li>
</ol>
<ul>
<li>La mayoría se para a chequear los datos cuando detecta algún error o bien sospecha que existe un problema.</li>
<li>Si nos acostumbramos a escribir pruebas al final de los códigos o bien cada vez que se hagan cierto tipo de operaciones (ej. siempre después de unir bases de datos), iremos generando el hábito de chequear constantemente, pero sin sobre-invertir en revisiones posteriores.</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>Ayuda a <strong>detectar</strong> problemas rápidamente</li>
</ol>
<ul>
<li>Se donde esta el error. Puedo corregirlo rápidamente.</li>
<li>Esto es especialmente importante en Stata dado que no nos indica en que linea del código se produjo el error. % Chequear bien esto.</li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li>Escribir pruebas ayuda a detectar más problemas de los <strong>previstos</strong>
</li>
</ol>
<ul>
<li>Los errores de un código se manifiestan de múltiples formas y muchas veces son consecuencia de errores anteriores.</li>
<li>Por ejemplo…</li>
<li>Si tengo valores duplicados mi estadística descriptiva estará mala.</li>
<li>El problema surge de no darle un tratamiento correcto a los valores duplicados. No surge de algún problema en el código que genera la estadística descriptiva.</li>
</ul>
<p><strong>Ejemplo 1:</strong> Para escribir pruebas en Stata utilizaremos el comando <code>|assert|</code>. Notar que este comando detiene la ejecución del código cuando <strong>la condición no se cumple</strong>.</p>
<p>Testear si la base de datos tiene 100 observaciones:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb1-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span> </span>
<span id="cb1-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">assert</span> <span class="ot">`r(N)'</span> == 100</span></code></pre></div>
<p>Testear si la variable <code>tasa_desempleo</code> toma valores razonables:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb2-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">assert</span> tasa_desempleo| &gt; 0 &amp; tasa_desempleo| &lt; 100</span></code></pre></div>
<p>Testear si la variable <code>edad</code> es siempre positiva:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb3-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb3-1" aria-hidden="true" tabindex="-1"></a>edad &gt; 0</span></code></pre></div>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.1.1:</b></p>
<p>Instrucciones:</p>
<ul>
<li>Descargar carpeta <em>ejercicios - Clase 1</em>
</li>
<li>Abrir <code>ejercicios_clase1.do</code> y fijar directorio de trabajo en la carpeta descargada.</li>
</ul>
<p>Preguntas:</p>
<ol style="list-style-type: decimal">
<li>La base de datos <em>World Development Indicator (WDI)</em> tiene observaciones duplicadas. <strong>Escriba un test que falle cuando existen valores duplicados</strong>.</li>
<li>Los países en la base de datos <code>Polity</code> deberían ser un subconjunto de los países que están en la base WDI. <strong>Escriba un test que falle debido a este problema</strong>.</li>
</ol>
</div>
<p>¿Cuando escribir tests?</p>
<ul>
<li>Después de juntar bases: <strong>Siempre</strong> incluir test después de utilizar un <code>merge</code>.</li>
<li>Después manipulaciones complejas de datos: Si piensas que fue difícil, incluye un test.</li>
<li>Después de eliminar observaciones: <strong>Siempre</strong> incluir test después de utilizar un <code>drop</code>.</li>
</ul>
<div class="alert alert-block alert-info">
<p><b>Regla general</b> siempre que te veas a ti misma(o) revisando o chequeando algún segmento de código interactivamente <strong>escribe un test</strong>.</p>
</div>
</div>
<div id="practica-ii-no-duplicar-información" class="section level4" number="2.1.1.3">
<h4>
<span class="header-section-number">2.1.1.3</span> Practica II: no duplicar información<a class="anchor" aria-label="anchor" href="#practica-ii-no-duplicar-informaci%C3%B3n"><i class="fas fa-link"></i></a>
</h4>
<p>Todo en un solo sitio</p>
<ul>
<li>Información debe estar expresada una sola vez en un código.</li>
<li>Si la información esta en muchas partes en el código, tendrás que buscar todos esos lugares.</li>
<li>Veamos un ejemplo…</li>
</ul>
<p>Imaginemos que quiero eliminar todas las observaciones que toman un valor mayor a un cierto límite.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb4-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> <span class="kw">if</span> var1 &gt; 110 </span>
<span id="cb4-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> <span class="kw">if</span> var2 &gt; 110 </span>
<span id="cb4-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> <span class="kw">if</span> var3 &gt; 110 </span></code></pre></div>
<p>Lo anterior funciona… ¿Cual es el problema entonces?</p>
<ul>
<li>Imaginemos que queremos cambiar el límite de 110 a 100. Del modo en que esta escrito, vamos a tener que hacer cambios <strong>3 veces!</strong>
</li>
<li>Si estas restricciones se encuentran en distintas partes de tú código, se puede inducir un error.</li>
</ul>
<p><strong>Ejemplo 2:</strong> Para evitar el problema anterior, es mejor escribir:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb5-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> lim = 110 </span>
<span id="cb5-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">drop</span> <span class="kw">if</span> var1 &gt; <span class="ot">`lim'</span></span>
<span id="cb5-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">drop</span> <span class="kw">if</span> var2 &gt; <span class="ot">`lim'</span> </span>
<span id="cb5-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">drop</span> <span class="kw">if</span> var3 &gt; <span class="ot">`lim'</span> </span></code></pre></div>
<p>De esta forma, en caso de decidir cambiar la restricción, solo tendrás que hacer <strong>un cambio</strong>. Minimizando la posibilidad de cometer un error.</p>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.1.2:</b></p>
<ul>
<li>Todas las regresiones que se encuentran en el código tienen la misma base, es decir, el mismo conjunto de variables que se repite.</li>
<li>La idea es consolidar la base con el fin de evitar duplicación de información.</li>
<li>Con este fin, agregar <code>population</code> como control en todas las regresiones. Nuevamente, no dupliques información.</li>
</ul>
</div>
</div>
<div id="practica-iii-no-transcribir-exportar-información" class="section level4" number="2.1.1.4">
<h4>
<span class="header-section-number">2.1.1.4</span> Practica III: no transcribir, exportar información<a class="anchor" aria-label="anchor" href="#practica-iii-no-transcribir-exportar-informaci%C3%B3n"><i class="fas fa-link"></i></a>
</h4>
<p>Nunca transcribir</p>
<ul>
<li>
<strong>Nunca se debe transcribir resultados</strong>. Todo debe ser exportado de forma tal que pueda ser actualizado automáticamente.<br>
</li>
<li>No cumplir con esta practica es una importante fuente de errores:</li>
<li>
<strong>Errores de transcripción:</strong> Si me equivoco en el décimo decimal no es tan grave, si cambio un signo si lo es.</li>
<li>
<strong>Problemas para actualizar:</strong> Es probable que al actualizar un código (como sucede usualmente en cualquier proyecto), olvidemos traspasar los resultados.</li>
<li>¿Como evitar este problema?
<ul>
<li>Para usuarios de <span class="math inline">\(\LaTeX\)</span> cada resultado debe ser guardado en archivos <code>.tex</code>.</li>
<li>Hacer esto no solo con las tablas (ej. <code>putexcel</code>). También hacerlo con cualquier estadística que aparezca en el texto.</li>
<li>Generar el número que se desea citar. Convertirlo a <code>string</code> y guardarlo (ej. <code>midato.tex</code>). Llamarlo con <code>\input{midato.tex}</code>.</li>
<li>Para usuarios de Word es un poco más complejo. Veremos que se puede hacer en la Clase 6.</li>
<li>También veremos Stata Markdown.</li>
</ul>
</li>
</ul>
<p>Ejemplo 3:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb6-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb6-1" aria-hidden="true" tabindex="-1"></a>eststo <span class="kw">clear</span></span>
<span id="cb6-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb6-2" aria-hidden="true" tabindex="-1"></a>eststo: <span class="kw">reg</span> polity gdp_per_cap</span>
<span id="cb6-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb6-3" aria-hidden="true" tabindex="-1"></a>eststo: <span class="kw">reg</span> polity gdp_per_cap under5_mortality</span>
<span id="cb6-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb6-4" aria-hidden="true" tabindex="-1"></a>esttab <span class="kw">using</span> nombredelarchivo.tex, <span class="kw">replace</span> <span class="co">///</span></span>
<span id="cb6-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb6-5" aria-hidden="true" tabindex="-1"></a>       <span class="bn">title</span>(<span class="st">"Mis estimaciones"</span>)</span></code></pre></div>
<p>Importar a <span class="math inline">\(\LaTeX\)</span>: <code>\input{nombredelarchivo.tex}</code></p>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.1.3:</b></p>
<p>Calcula el promedio de <code>literacy_rate</code> y guárdalo en una macro local. Generar un formato tal que solo tenga dos decimales. Guarda el valor como <em>string</em> en un archivo <code>.tex</code> en la misma carpeta.</p>
</div>
</div>
<div id="practica-iv-estilo-importa" class="section level4" number="2.1.1.5">
<h4>
<span class="header-section-number">2.1.1.5</span> Practica IV: estilo importa<a class="anchor" aria-label="anchor" href="#practica-iv-estilo-importa"><i class="fas fa-link"></i></a>
</h4>
<p>Algunos comentarios sobre estilo</p>
<ul>
<li>Estilo no se refiere a la estética del código ni al orden (para bien o para mal!).</li>
<li>Tiene que ver con la facilidad con el que este se puede <strong>leer</strong>. El objetivo final es siempre poder detectar errores.<br>
</li>
<li>Tres aspectos son claves:
<ul>
<li>
<strong>Utilizar espacios.</strong> Usar espacios siempre después de utilizar un operador. Por ejemplo:</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb7-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> var1=var2+var3      <span class="co">/// Mal</span></span>
<span id="cb7-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> var1 = var2 + var3  <span class="co">/// Bien</span></span></code></pre></div>
<ul>
<li>Con criterio…</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb8-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb8-1" aria-hidden="true" tabindex="-1"></a>hours + minutes / 60 + seconds / 3600 </span>
<span id="cb8-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb8-2" aria-hidden="true" tabindex="-1"></a>hours + minutes/60 + seconds/3600</span></code></pre></div>
<ul>
<li><p><strong>Usar variables que sean informativas en si mismas.</strong> No escribir <code>var1</code>, si puedes escribir: <code>tasa_desempleo</code>. Requiere más trabajo, pero facilita la lectura. Agregar unidades también facilita la lectura (<code>labels</code>).<br></p></li>
<li>
<p>Escribir comentarios</p>
<ul>
<li>Ejercicio para explicar en pocas palabras lo que se ha hecho.</li>
<li>Existe un equilibrio entre parsimonia y calidad del comentario.</li>
<li>Establecer el objetivo del comentario claramente es muy importante.</li>
</ul>
</li>
<li>
<p>No hay una regla para escribir comentarios</p>
<ul>
<li>Utilizar imperativo si lo tiene que corregir otra persona (ej. modifica parámetros aquí, fija directorio).</li>
<li>Debe incluir suficiente contexto para que alguien que no trabaje directamente en eso entienda que se debe hacer.</li>
<li>Los comentarios largos deben explicar secciones de código. Importante escribir el código por bloques.</li>
<li>La brevedad no debe afectar nunca la comprensión. Esto también aplica para los comandos (ejemplo de <a href="https://michaelshill.net/2015/07/31/in-stata-coding-style-is-the-essential/">Michael Shill</a>).</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb9-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">summarize</span> var1</span>
<span id="cb9-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">sum</span> var1</span>
<span id="cb9-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb9-3" aria-hidden="true" tabindex="-1"></a>su var1</span></code></pre></div>
</div>
</div>
<div id="estilo-de-codificación-en-stata" class="section level3" number="2.1.2">
<h3>
<span class="header-section-number">2.1.2</span> Estilo de codificación en Stata<a class="anchor" aria-label="anchor" href="#estilo-de-codificaci%C3%B3n-en-stata"><i class="fas fa-link"></i></a>
</h3>
<div id="más-allá-del-orden" class="section level4" number="2.1.2.1">
<h4>
<span class="header-section-number">2.1.2.1</span> Más allá del orden<a class="anchor" aria-label="anchor" href="#m%C3%A1s-all%C3%A1-del-orden"><i class="fas fa-link"></i></a>
</h4>
<p>Un buen estilo es seguir una estrategia</p>
<ul>
<li>Revisaremos un poco más sobre estilo en base a dos referencias adicionales: y de una guía confeccionada por <a href="https://michaelstepner.com/">Michael Stepner</a>.</li>
<li>Los códigos tienen distintas audiencias. La primera es tu computadora. Si tu computadora no entiende tú código es el peor de los mundos.</li>
<li>Una de las audiencias más importantes son tus colaboradores y colaboradoras. Si ellos/as no lo entienden. <strong>El problema es tuyo en primer lugar.</strong>
</li>
<li>No hay un solo buen estilo. No hay una guía que pueda sustituir experiencia o estrategias ya probadas de trabajo de equipo.</li>
<li>Lo importante es y <strong>utilizarlas</strong> en la medida de que sea positivo para el producto final.</li>
<li>Ahora veremos algunas estrategias y buenas practicas que pueden ayudar a mejorar el estilo de codificación individual y de tu equipo.</li>
</ul>
</div>
<div id="códigos-cortos" class="section level4" number="2.1.2.2">
<h4>
<span class="header-section-number">2.1.2.2</span> Códigos cortos<a class="anchor" aria-label="anchor" href="#c%C3%B3digos-cortos"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Ningún segmento de código debiese ser mayor a 100 - 150 carácteres.</li>
<li>Códigos largos, debiesen ser escritos de forma más pequeña como funciones (Clase 4).</li>
<li>Si tienes dificultades para reducir un código a estos estándares, es probable que tengas que pensar en como estructurarlo de mejor forma.</li>
<li>Cada segmento de código o funciones debiesen tener un propósito <strong>claro e intuitivo</strong> para lectores experimentados en el lenguaje de programación que se este utilizando.</li>
</ul>
<p>do - files cortos y con foco</p>
<ul>
<li>Todo do-file debe tener un propósito que pueda ser <strong>explicado en una oración.</strong> De hecho, hay que hacerlo. En el preámbulo.<br>
</li>
<li>Un proyecto debe tener varios <code>do-files</code> con las siguientes características.
<ul>
<li>
<strong>Cortos:</strong> Debes ser capaz de leer un do-file completo en poco minutos y entender el objetivo. Una buena regla es que no sean más largos de 250 - 350 lineas. No es estricta esta regla. Hay ocasiones que se justifican códigos más largos. %Lo importante es claridad. No sacrificarla nunca.</li>
<li>
<strong>Autocontenidos:</strong> Cada do-file interactúa con otros solo a través de los archivos que carga y de los que guarda.</li>
<li>
<strong>Enfocados:</strong> Un <code>do-file</code> cumple un propósito determinado. Cada parte se debe entender como un paso intuitivo para lograr ese propósito.</li>
</ul>
</li>
</ul>
<p>Funciones claras</p>
<ul>
<li>Un lector debe saber exactamente cuales son los <code>inputs</code> de las funciones.<br>
</li>
<li>Las funciones debiesen declarar explicitamente <code>inputs</code> y <code>outputs</code>. Solo deben funcionar en variables locales.</li>
<li>Las funciones deben trabajar solo en el conjunto de datos para el cual están diseñadas. Por ejemplo: parametros regresión.</li>
<li>Usar variables globales rara vez.</li>
</ul>
</div>
<div id="nombres-descriptivos" class="section level4" number="2.1.2.3">
<h4>
<span class="header-section-number">2.1.2.3</span> Nombres Descriptivos<a class="anchor" aria-label="anchor" href="#nombres-descriptivos"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Nombres adecuados remplazan comentarios y hacen del código un archivo auto contenido. * <strong>Utilizar nombres completos</strong>. Abreviaciones solo en el caso de estar seguro que cualquier lector puede entenderlo sin ambigüedad.</li>
<li>Si se utilizan abreviaciones. Ser consistente. Utilizar siempre las mismas a lo largo del código.</li>
<li>Cuando no se pueda ser suficientemente claro en un nombre, utilizar si o si para dar una descripción (ej. agregar unidad de medida).</li>
<li>
<code>labels</code> especifican información. (ej, <code>edad</code> con el <code>label</code> <em>edad al 31 de enero</em> es más informativa que <code>edad</code> y más corto que <code>edad_31enero</code>.</li>
<li>No utilizar nombres en dos (o más) archivos que no expliciten porque son diferentes. Por ejemplo: <code>version_final.do</code> y <code>version_final_ahorasiquesi.do</code>.</li>
<li>Los nombres pueden ser más cortos cuando se utilicen con frecuencia o el objeto este inmediatamente después. Por ejemplo:</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb10-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb10-1" aria-hidden="true" tabindex="-1"></a>beta_mco = (educacion' * educacion)^(-1) * <span class="co">///</span></span>
<span id="cb10-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb10-2" aria-hidden="true" tabindex="-1"></a>           (educacion' * log_salarios)</span></code></pre></div>
<p>Mejor escrito sería:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb11-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb11-1" aria-hidden="true" tabindex="-1"></a>X = educacion</span>
<span id="cb11-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb11-2" aria-hidden="true" tabindex="-1"></a>Y = log_salarios</span>
<span id="cb11-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb11-3" aria-hidden="true" tabindex="-1"></a>beta_educ_salarios = (X'*X)^(-1)*(X'*Y) </span></code></pre></div>
<ul>
<li>No ser tacaño(a) al nombrar variables, archivos, carpetas.</li>
<li>Probablemente lo escribas solo una vez. No ahorres espacio. Siempre pensar en la claridad.</li>
<li>Para el caso de una figura:
<ul>
<li>
<code>c_1.pdf</code> es un pesimo nombre.</li>
<li>
<code>correlaciones.pdf</code> es un mal nombre.</li>
<li>
<code>T1_CORRELACIONES_INGRESO_MORTALIDAD.PDF</code> es un mejor nombre.</li>
</ul>
</li>
<li>Para el caso de una carpeta:
<ul>
<li>
<code>datos/brutos/interregional</code> es un mal nombre.</li>
<li>
<code>datos/brutos/Estimaciones Censo Interregional 2010 - 2021</code> es un buen nombre.</li>
</ul>
</li>
<li>Estos nombres nos permiten pensar en el flujo del proyecto sin tener que mirar los códigos.</li>
</ul>
</div>
<div id="ojo-con-el-álgebra" class="section level4" number="2.1.2.4">
<h4>
<span class="header-section-number">2.1.2.4</span> Ojo con el álgebra<a class="anchor" aria-label="anchor" href="#ojo-con-el-%C3%A1lgebra"><i class="fas fa-link"></i></a>
</h4>
<p>Separa el álgebra en partes.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb12-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> pib_percapita_real = <span class="co">///</span></span>
<span id="cb12-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb12-2" aria-hidden="true" tabindex="-1"></a>    (cons + ggob + <span class="kw">export</span> - import - impuestos)* 10^6 <span class="co">///</span></span>
<span id="cb12-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb12-3" aria-hidden="true" tabindex="-1"></a>    /(indice_precios * poblacion_miles * 1000)</span></code></pre></div>
<p>Más largo, pero mucho más entendible:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb13-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> pib_millones_nominal = <span class="co">///</span></span>
<span id="cb13-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb13-2" aria-hidden="true" tabindex="-1"></a>    (cons + ggob + <span class="kw">export</span> - import - impuestos)</span>
<span id="cb13-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> pib_total_real = pib_millones_nominal * 10^6 <span class="co">///</span></span>
<span id="cb13-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb13-4" aria-hidden="true" tabindex="-1"></a>    / indice_precios</span>
<span id="cb13-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> pop_total = poblacion_miles * 1000</span>
<span id="cb13-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> pib_percapita_real = pib_total_real / pob_total </span></code></pre></div>
</div>
<div id="consistencia" class="section level4" number="2.1.2.5">
<h4>
<span class="header-section-number">2.1.2.5</span> Consistencia<a class="anchor" aria-label="anchor" href="#consistencia"><i class="fas fa-link"></i></a>
</h4>
<p>Ser consistentes
* Hay cosas de estilo que son solo un tema de gusto. Por ejemplo, hay quienes escriben <code>nivel_empleo_anual</code> y otras que escribe <code>NivelEmpleoAnual</code>.
* No importa la elección de un estilo u otro. Lo que importa es que todas y todos los miembros del equipo utilicen <strong>la misma</strong> convención.</p>
</div>
<div id="chequear-errores" class="section level4" number="2.1.2.6">
<h4>
<span class="header-section-number">2.1.2.6</span> Chequear errores<a class="anchor" aria-label="anchor" href="#chequear-errores"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Hemos aprendido que es importante escribir pruebas o testeos. Especialmente relevante después de operaciones complicadas o pegado de bases de datos.</li>
<li>Stata en algunas ocasiones indica los errores que se comenten, sin la necesidad de colocar estas pruebas. Por ejemplo:</li>
</ul>
<div class="sourceCode" id="cb14"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb14-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> <span class="fu">string</span> x = <span class="st">"hola"</span></span>
<span id="cb14-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> <span class="fu">y</span> = x^2</span></code></pre></div>
<p>Stata retorna el siguiente error:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb15-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="dv">type</span> mismatch </span>
<span id="cb15-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">r</span>(109);</span></code></pre></div>
<p>Normalmente el error da suficiente información. A pesar de lo anterior, en algunas circunstancias, no es tan claro saber cual es el error. Cuando ustedes se hayan encontrado con un error, que no les fue fácil descifrar, ** tienen que escribir un comentario que lo indique**. Facilitara mucho el trabajo colaborativo.</p>
</div>
<div id="separar-tipos-de-códigos" class="section level4" number="2.1.2.7">
<h4>
<span class="header-section-number">2.1.2.7</span> Separar tipos de códigos<a class="anchor" aria-label="anchor" href="#separar-tipos-de-c%C3%B3digos"><i class="fas fa-link"></i></a>
</h4>
<p>Separar códigos lentos de los rápidos</p>
<ul>
<li>Códigos lentos que rara vez se piensan ejecutar idealmente debiesen estar separados de los códigos rápidos que se quieren ejecutar múltiples ocasiones.</li>
<li>Evito tener que ejecutar un código lento cada vez que necesito actualizar algún resultado.</li>
<li>Este criterio cambia en caso de que todos los códigos sean rápidos.</li>
</ul>
</div>
<div id="automatización" class="section level4" number="2.1.2.8">
<h4>
<span class="header-section-number">2.1.2.8</span> Automatización<a class="anchor" aria-label="anchor" href="#automatizaci%C3%B3n"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Todo lo que se pueda automatizar debe ser automatizado.</li>
<li>Nunca hacer trabajo que vaya a obtener resultados de forma interactiva. Lo interactivo es siempre para inspeccionar.</li>
</ul>
</div>
<div id="abstracción" class="section level4" number="2.1.2.9">
<h4>
<span class="header-section-number">2.1.2.9</span> Abstracción<a class="anchor" aria-label="anchor" href="#abstracci%C3%B3n"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Abstraer para eliminar pasos redundantes.<br>
</li>
<li>Abstraer con fines de hacer códigos más claros. <strong>No por otras razones</strong>.</li>
<li>Abstracción es esencial para escribir un buen código por al menos dos razones:
<ul>
<li>Al eliminar la redundancia se reducen las posibilidades de cometer errores.</li>
<li>Aumenta la claridad. Para cualquier lector será más facil leer un código no redundante.</li>
</ul>
</li>
</ul>
<p><strong>Ejemplo 4:</strong> Supongamos que queremos ver la correlación espacial del consumo de papas fritas. Queremos testear si el consumo per-capita de papas fritas esta correlacionado con el consumo promedio percapita de las otras comunas de la misma región.</p>
<p>Primero tenemos que calcular el consumo per-capita del resto:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb16-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> total_pc_papitas = <span class="kw">total</span>(pc_papitas), <span class="kw">by</span>(region)</span>
<span id="cb16-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> total_obs = <span class="fu">count</span>(pc_papitas), <span class="kw">by</span>(region)</span>
<span id="cb16-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> consumo_papitas_resto_pc = <span class="co">///</span></span>
<span id="cb16-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb16-4" aria-hidden="true" tabindex="-1"></a>(total_pc_papitas - pc_papitas)/(total_obs - 1)</span></code></pre></div>
<p>Ahora podemos ver si existe correlación. ¿Pero si queremos cambiar el nivel de agregación? Tal vez si existe correlación, pero a nivel de área metropolitana. Copiemos el código de nuevo y calculemos esto.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb17-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> total_pc_papitas = <span class="kw">total</span>(pc_papitas), <span class="kw">by</span>(metroarea)</span>
<span id="cb17-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> total_obs = <span class="fu">count</span>(pc_papitas), <span class="kw">by</span>(region)</span>
<span id="cb17-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> consumo_papitas_restometro_pc = <span class="co">///</span></span>
<span id="cb17-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb17-4" aria-hidden="true" tabindex="-1"></a>(total_pc_papitas - pc_papitas)/(total_obs - 1)</span></code></pre></div>
<p>Noten que hay un error. Se nos olvido remplazar región por <code>metroarea</code>. Este error se puede propagar si seguimos haciendo operaciones.</p>
<p>Una alternativa al copiar y pega es escribir una función con propósito general que calcule la variable que deseamos bajo distintos parámetros.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb18-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> consumo_papitas_resto </span>
<span id="cb18-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">syntax</span>, invar(varname) outvar(<span class="bn">name</span>) byvar(varname)</span>
<span id="cb18-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">tempvar</span> tot_invar count_invar </span>
<span id="cb18-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">egen</span> <span class="ot">`tot_invar'</span> = <span class="kw">total</span>(<span class="ot">`invar'</span>), <span class="kw">by</span>(<span class="ot">`byvar'</span>)</span>
<span id="cb18-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">egen</span> <span class="ot">`count_invar'</span> = <span class="fu">count</span>('invar'), <span class="kw">by</span>('byvar') </span>
<span id="cb18-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">gen</span> <span class="ot">`outvar'</span> = (<span class="ot">`tot_invar'</span> - <span class="ot">`invar'</span>) <span class="co">///</span></span>
<span id="cb18-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb18-7" aria-hidden="true" tabindex="-1"></a>    / (<span class="ot">`count_invar'</span> - 1) </span>
<span id="cb18-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> </span></code></pre></div>
<p>Con el programa podemos escribir los bloques de código anteriores como:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb19-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb19-1" aria-hidden="true" tabindex="-1"></a>* Caso 1 </span>
<span id="cb19-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb19-2" aria-hidden="true" tabindex="-1"></a>consumo_papitas_resto, invar(pc_papitas) <span class="co">///</span></span>
<span id="cb19-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb19-3" aria-hidden="true" tabindex="-1"></a>outvar(consumo_papitas_resto_pc) byvar(region)</span>
<span id="cb19-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb19-5" aria-hidden="true" tabindex="-1"></a>* Caso 2</span>
<span id="cb19-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb19-6" aria-hidden="true" tabindex="-1"></a>consumo_papitas_resto, invar(pc_papitas)  <span class="co">///</span></span>
<span id="cb19-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb19-7" aria-hidden="true" tabindex="-1"></a>outvar(consumo_papitas_restometro_pc) byvar(metroarea)</span></code></pre></div>
<p>Hemos escrito la función de forma totalmente general. Podemos cambiar el nivel de agregación sin inducir errores.</p>
</div>
<div id="documentación-y-comentarios" class="section level4" number="2.1.2.10">
<h4>
<span class="header-section-number">2.1.2.10</span> Documentación y comentarios<a class="anchor" aria-label="anchor" href="#documentaci%C3%B3n-y-comentarios"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>No escribas documentación que no vas a mantener.</li>
<li>Códigos deben ser autoexplicativos.</li>
<li>Imaginemos queremos estimar una elasticidad de demanda para hacer un análisis de bienestar.</li>
</ul>
<div class="sourceCode" id="cb20"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb20-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb20-1" aria-hidden="true" tabindex="-1"></a>* Elasticidad = Cambio porcentual en la cantidad ç</span>
<span id="cb20-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb20-2" aria-hidden="true" tabindex="-1"></a>   / Cambio Porcentual en precio</span>
<span id="cb20-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb20-3" aria-hidden="true" tabindex="-1"></a>* Elasticidad = -0,4 / 0,2 = -2</span>
<span id="cb20-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb20-4" aria-hidden="true" tabindex="-1"></a>* Mirar Informe 1, Tabla 2A.</span>
<span id="cb20-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb20-5" aria-hidden="true" tabindex="-1"></a>    calcular_perdida_bienestar, elasticidad(3)</span></code></pre></div>
<p>Problema: código contradice comentario. Cuando tenemos dos fuentes o más fuentes que informan sobre el mismo objeto, es probable que estas se puedan contradecir. El problema de inconsistencia interna es especialmente importante para documentación, comentarios, notas, etc.</p>
<ul>
<li>Para evitar este problema es necesario mantener los comentarios al día tal como se hace con los códigos.</li>
<li>Hacer esto es costoso. Mantener un código extenso al mismo tiempo que una larga documentación no es sencillo.</li>
<li>Dado esta restricción, es importante .</li>
<li>Volviendo al ejemplo. ¿Como le decimos al lector del código debe tener una elasticidad de 2 y no de 3?</li>
</ul>
<p>Ejemplo de un código auto-explicativo:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb21-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb21-1" aria-hidden="true" tabindex="-1"></a>* Mirar Informe 1: Tabla 2A. </span>
<span id="cb21-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">local</span> cambio_porcentual_cantidad = -0,4</span>
<span id="cb21-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">local</span> cambio_porcentual_precio = 0,2 </span>
<span id="cb21-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">local</span> elasticidad = <span class="ot">`cambio_porcentual_cantidad'</span> <span class="co">///</span></span>
<span id="cb21-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb21-5" aria-hidden="true" tabindex="-1"></a>  / <span class="ot">`cambio_porcentual_precio'</span></span>
<span id="cb21-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb21-6" aria-hidden="true" tabindex="-1"></a>  calcular_perdida_bienestar, elasticidad(<span class="ot">`elasticidad'</span>) </span></code></pre></div>
<p>Menos comentarios que el anterior. <strong>Sin números mágicos</strong>. Pero es más informativo e interno consistentemente dado que no puedo cambiar algunos de los parámetros sin modificar el resultado. Comentarios sirven en su justa medida: es imposible desprender del mismo código sin saber la tabla.</p>
</div>
<div id="identificadores-únicos" class="section level4" number="2.1.2.11">
<h4>
<span class="header-section-number">2.1.2.11</span> Identificadores únicos<a class="anchor" aria-label="anchor" href="#identificadores-%C3%BAnicos"><i class="fas fa-link"></i></a>
</h4>
<p>Bases de datos con Identificadores únicos</p>
<ul>
<li>ID permiten saber la unidad de observación (hogar, empresas, lugares, etc).</li>
<li>Conocer ID únicos es esencial para entender los datos. Indican que es lo que describen los datos.</li>
<li>También nos sirven para entender como juntar estos datos con otras fuentes de información.<br>
</li>
<li>Dos reglas que siempre tener en cuenta:
<ul>
<li>No tienen que existir observaciones duplicadas que tengan el mismo ID único.</li>
<li>Los ID no pueden tener <em>missings</em>.</li>
</ul>
</li>
<li>Una forma de verificar estos dos hechos es utilizando el comando <code>isid</code>. Este comando chequea si las variables especificadas identifican únicamente a las observaciones. Si esto no ocurre arrojara el siguiente mensaje:</li>
</ul>
<div class="sourceCode" id="cb22"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb22-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">variable</span> does <span class="kw">not</span> uniquely identify the observations</span></code></pre></div>
<p>Si encuentro plausible que alguna variable tenga <em>missing</em> puedo colocar la opción <code>missok</code>.</p>
</div>
<div id="no-ser-repetitivo" class="section level4" number="2.1.2.12">
<h4>
<span class="header-section-number">2.1.2.12</span> No ser repetitivo<a class="anchor" aria-label="anchor" href="#no-ser-repetitivo"><i class="fas fa-link"></i></a>
</h4>
<p>Hemos hablado de evitar ser repetitivo. ¿Cuándo hacerlo? Repetir en una operación simple con dos categorías es razonable.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb23-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">xtile</span> decil_ing_ga = ing <span class="kw">if</span> grupo==<span class="st">"A"</span>, nq(10)</span>
<span id="cb23-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="kw">xtile</span> decil_ing_gb = ing <span class="kw">if</span> grupo==<span class="st">"B"</span>, nq(10)</span></code></pre></div>
<p>Si tengo que operar 15 veces, mejor hacerlo iterativamente:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb24-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> <span class="fu">y</span> = 2001/2015 {</span>
<span id="cb24-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb24-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">xtile</span> decil_ing_<span class="ot">`y'</span> = inn <span class="kw">if</span> año == <span class="ot">`y'</span>, nq(10)</span>
<span id="cb24-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb24-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Si involucra múltiples operaciones. A pesar de que solo existan dos categorías, es mejor hacerlo iterativo.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb25-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> g <span class="kw">in</span> <span class="st">"A"</span> <span class="st">"B"</span> {</span>
<span id="cb25-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb25-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">assert</span> ingreso &gt;= 0 <span class="kw">if</span> grupo == <span class="st">"`g'"</span></span>
<span id="cb25-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">xtile</span> decil_ingreso_<span class="ot">`g'</span> = ingreso <span class="co">/// </span></span>
<span id="cb25-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> grupo==<span class="st">"`g'"</span>  &amp; ingreso &gt; 0, nq(10)  </span>
<span id="cb25-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">replace</span> decil_ingreso_<span class="ot">`g'</span> = 0 <span class="co">/// </span></span>
<span id="cb25-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> grupo==<span class="st">"`g'"</span>  &amp; ingreso == 0</span>
<span id="cb25-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">label</span> <span class="kw">var</span> decil_ingreso_<span class="ot">`g'</span> <span class="st">"Deciles de ingreso"</span></span>
<span id="cb25-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb25-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Un ejemplo de convención para evitar ser repetitivos:</p>
<ul>
<li>Cuando necesites cambiar <strong>solo una cosa</strong> en el código utilizar un <em>loop</em>. <code>foreach</code> y <code>forvalues</code> iteran por el mismo código múltiples veces, cambiando el valor de una variable local cada vez.</li>
<li>Cuando necesites cambiar <strong>múltiples cosas</strong> dentro de un código, define un programa dentro del do-file utilizando <code>program</code>. De este modo tu podrás especificar más de un argumento.</li>
<li>Cuando necesites repetir un código en <strong>múltiples do.files</strong>, pueden definir un programa en un <code>ado-file</code>, guardarlo y llamarlo cuando lo necesites. Es importante que el código agregue automáticamente la ruta en donde se encuentran guardados estos programas.</li>
</ul>
<p>Algunas ayudas:
* Cuando algunas lineas de código necesiten cambiar entre repeticiones utilizar <code>if/else</code> y <code>forvalues</code>. Estos iteran por el mismo código múltiples veces, cambiando el valor de una variable local cada vez.
* Cuando definas programas dentro de un do-file, agrega una linea que diga <code>cap program drop &lt;program_name&gt;</code> antes de <code>program define</code>. Automáticamente se eliminará y redefinirá el programa cada vez que ejecutes el código.</p>
<p>Mensajes finales sobre estilo de codificación</p>
<ul>
<li>Haz las cosas lo más simples posibles para ti (y tu equipo) de hoy y del futuro.</li>
<li>No confíes tanto en ti de hoy y menos en el del futuro. Es mejor programar <strong>defensivamente</strong>.</li>
<li>Ser consistente en formato, estilo, organización y nombres. Sigue estrategias.</li>
<li>Reducir en lo posible pegado y repetición.</li>
<li>Testear regularmente.</li>
<li>Documentar a menudo, estratégicamente, pero mínimamente.</li>
</ul>
</div>
</div>
<div id="organización-de-un-proyecto-en-stata" class="section level3" number="2.1.3">
<h3>
<span class="header-section-number">2.1.3</span> Organización de un proyecto en Stata<a class="anchor" aria-label="anchor" href="#organizaci%C3%B3n-de-un-proyecto-en-stata"><i class="fas fa-link"></i></a>
</h3>
<div id="flujo-de-trabajo-en-stata" class="section level4" number="2.1.3.1">
<h4>
<span class="header-section-number">2.1.3.1</span> Flujo de trabajo en Stata<a class="anchor" aria-label="anchor" href="#flujo-de-trabajo-en-stata"><i class="fas fa-link"></i></a>
</h4>
<p>Hasta el momento uno de los mayores mensajes es <strong>adoptar un sistema de organización</strong> compartirlo en el equipo y adherirse a él. Este debe incluir:</p>
<ol style="list-style-type: decimal">
<li>Estructuras de directorio.</li>
<li>Estilo de codificación.<br>
</li>
<li>Convenciones para escribir nombres.<br>
</li>
<li>Convenciones para exportar datos.</li>
</ol>
<p>Hemos visto en detalle (2) y (3). Algunas cosas de (4) (más detalles en Sección 3.6). En esta sección nos enfocaremos en (1). Esta sección se basa en una de las guías de <a href="https://asjadnaqvi.medium.com/">Asjad Nqvi</a>. Muy buenos recursos. Muy recomendado. También revisaremos algunos elementos de ().
* Un proyecto de análisis de datos contempla: planificar el trabajo, documentar las actividades, crear y verificar variables, generar y presentar análisis estadístico, replicar resultados y archivar.
* Todo lo anterior es a lo que nos referiremos como flujo de trabajo.
* Un buen flujo de trabajo es esencial para que tu y tus colaboradores(as) y los interesados en tu trabajo puedan replicarlo.
* Replicar es clave para generar información confiable y correcta.</p>
<p>La administración del flujo de trabajo se hace al <strong>inicio</strong> de un proyecto. No al final. No hacerlo así tiene costos en tiempo y posiblemente induzca errores no forzados. Veremos algunos aspectos relacionados con la administración de datos y <em>scripts</em>. Nuevamente, más que reglas a seguir, lo presentado aquí son una serie de buenas practicas que pueden ayudar a mejorar la gestión del trabajo con Stata. La idea de esto es que finalmente podamos dedicarle más y mejor tiempo al análisis de datos.</p>
<div class="alert alert-block alert-info">
<p><b>, prefacio.</b></p>
When I started, I thought my workflow <span style="color:red"> “was very good and that it was simply a matter of recording what I did”, “red”

. As writing proceeded (<strong>this book</strong>), I discovered gaps, inefficiencies, and inconsistencies in what I did. Sometimes these involved procedures that I knew were awkward, but where <span style="color:red"> “I never took the time to find a better approach”, “red”

<p>. Some problems were due to oversights where I had not realized the consequences of the things I did or failed to do.</p>
</span></span>
</div>
</div>
<div id="organización-de-archivos-y-carpetas" class="section level4" number="2.1.3.2">
<h4>
<span class="header-section-number">2.1.3.2</span> Organización de archivos y carpetas<a class="anchor" aria-label="anchor" href="#organizaci%C3%B3n-de-archivos-y-carpetas"><i class="fas fa-link"></i></a>
</h4>
<p>¿Les suena familiar?</p>
<ul>
<li>Tener múltiples versiones de un archivo y no saber cual es cual.</li>
<li>No poder encontrar un archivo y pensar que lo has borrado.</li>
<li>Tu equipo (y tú) no saben cual es el informe final. Hay dos archivos que con el nombre archivo final, pero con distinto contenido.</li>
</ul>
<p>Para evitar los problemas anteriores es importante diseñar la estructura de la carpeta de trabajo y comprometerse a seguir una alerta.</p>
<p>Carpetas</p>
<ul>
<li>Todo se guarda en carpetas. <strong>TODO</strong>.</li>
<li>Estas deben seguir un orden lógico e intuitivo. Como consejo. Colocar números en la carpeta. Al ordenar las carpetas seguirán este orden y no el alfabético.</li>
<li>No tener espacios en el nombre de las carpetas.</li>
<li>Nunca utilizar (-) entre nombres de una carpeta. Utilizar (_).</li>
<li>Evitar nombrar las carpetas con mayúsculas.</li>
<li>Siempre escribir un <code>README.txt</code>. Puede ser tedioso, pero muy necesario. Corto, informativo, que explique el flujo de trabajo y las carpetas. Sugerencia: colocar las rutas.</li>
</ul>
<div class="figure">
<img src="01figuras/C2.2.1.png" alt=""><p class="caption">Proyecto muy pequeño</p>
</div>
<div class="figure">
<img src="01figuras/C2.2.2.png" alt=""><p class="caption">Proyecto pequeño</p>
</div>
<div class="figure">
<img src="01figuras/C2.2.3.png" alt=""><p class="caption">Proyecto grande</p>
</div>
<div class="figure">
<img src="01figuras/C2.2.4.png" alt=""><p class="caption">Otro ejemplo de proyecto. Ejemplo de </p>
</div>
<p>Es importante generar dos tipos de carpetas para los resultados <code>trabajo</code> y otras que diga <code>compartir</code>.</p>
<ul>
<li>
<code>trabajo</code> guarda todos los resultados (ej. tablas, gráficos, documentos) que están siendo trabajados.</li>
<li>
<code>compartir</code> guarda resultados terminados y listos para compartir en alguna etapa del proyecto. Por ejemplo, cuando se quieran compartir resultados intermedios del proyecto.</li>
</ul>
<p>Dos reglas:</p>
<ul>
<li>Resultados se comparten solo después que los archivos que lo generan pasen a la carpeta <code>compartir</code>.</li>
<li>Una vez traspasados a la carpeta compartir. No se modifican. Incluso cuando puedan existir errores.</li>
</ul>
<p>Ayuda a garantizar que los resultados que se comparte se puedan replicar. Si encuentras errores o decides cambiar algo no cambies los ya posteados. Genera nuevos. Esto también ayuda a la replicabilidad: permite saber que cambios existieron durante un proyecto.</p>
<p>Un directorio de trabajo estructurado es especialmente <strong>importante para proyectos colaborativos</strong> donde todo se puede desordenar mas fácilmente. Dos directorios son sugeridos cuando se trabaja de forma colaborativa: <code>correo</code> y otras que diga <code>privados</code>. <code>correo</code> guarda intercambios entre colaboradoras mientras que <code>privados</code> guarda el trabajo propio de cada colaborador(a). Otras carpetas que pueden complementar trabajo son <code>porhacer</code> que sea una carpeta que sirva como una lista de tareas <code>poraprender</code>. En cualquier caso, estas carpetas pueden ser parte de <code>privados</code>.</p>
<p>Cuando se tengan versiones se pueden utilizar dos modos:</p>
<ul>
<li>v1, v2, v3, etc.</li>
<li>Fechas. Si se utilizan estas escribirlo en año/mes/día. De esta forma se ordenara automáticamente desde el último al primero.</li>
</ul>
<p>Cuando versiones anteriores no te sean útiles. <strong>Borralas!</strong> No acumules archivos y códigos porque sí. Si por alguna razón deseas dejarlos (ej. necesidad de respaldar lo hecho). Genera una carpeta temporal. Esta puede estar en tú versión personal del proyecto, pero no en el archivo final.</p>
<p>Master do-file</p>
<ul>
<li>Diferentes <code>do-files</code> para diferentes tareas.</li>
<li>Separar en secciones y subsecciones. Por ejemplo: Preámbulo, cargar datos, generar variables, figura I, Tabla 3, etc.</li>
<li>Crear <code>master_do.files</code> cada proyecto o subproyecto debe tener un archivo maestro que ejecute <strong>todos</strong> los códigos de inicio a fin y genere todos los resultados.</li>
<li>Cada vez que se termine un proyecto o se obtenga algún resultado es importante ejecutar el <code>master_do.files</code>.</li>
</ul>
<p>Ejemplo de master do-file:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb26-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb26-1" aria-hidden="true" tabindex="-1"></a>  *** Información del proyecto aquí ***</span>
<span id="cb26-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb26-2" aria-hidden="true" tabindex="-1"></a>  *** Información sobre directorios ***</span>
<span id="cb26-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb26-3" aria-hidden="true" tabindex="-1"></a>  *** Ejecutar códigos ***</span>
<span id="cb26-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb26-4" aria-hidden="true" tabindex="-1"></a>  * Generación <span class="kw">de</span> datos</span>
<span id="cb26-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">do</span> ./dofiles/01_datos_v11.<span class="kw">do</span> </span>
<span id="cb26-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">do</span> ./dofiles/02_merge_v2.<span class="kw">do</span> </span>
<span id="cb26-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb26-7" aria-hidden="true" tabindex="-1"></a>  * Generación <span class="kw">de</span> tablas</span>
<span id="cb26-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">do</span> ./dofiles/03_tablas_v4.<span class="kw">do</span> </span>
<span id="cb26-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb26-9" aria-hidden="true" tabindex="-1"></a>  * Estimación principal</span>
<span id="cb26-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">do</span> ./dofiles/04_estimaciones_v11.<span class="kw">do</span> </span>
<span id="cb26-11"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb26-11" aria-hidden="true" tabindex="-1"></a>  * Figuras principales</span>
<span id="cb26-12"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb26-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">do</span> ./dofiles/05_graficos_v11.<span class="kw">do</span> </span></code></pre></div>
<p>Rutas de las carpetas:</p>
<ul>
<li>Es importante tener una carpeta principal y referenciar todas las rutas a esa dirección.</li>
<li>Utilizar siempre <code>/</code> no <code>\textbackslash</code>. Puede causar problemas según el sistema operativo que utilices.</li>
<li>Utilizar macros para nombrar a las carpetas. Que estos nombres tengan sentido y se relacionen con el flujo de trabajo.</li>
<li>Recordar que una variable <code>local</code> guarda información temporalmente mientras que <code>global</code> guarda información permanentemente. Esto último hace de los <code>global</code> algo no recomendable de utilizar constantemente. No obstante, es útil para los directorios.</li>
</ul>
<div class="sourceCode" id="cb27"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb27-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb27-1" aria-hidden="true" tabindex="-1"></a>   *** Nota 1: Remplazar esta ruta ***</span>
<span id="cb27-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb27-2" aria-hidden="true" tabindex="-1"></a>   <span class="kw">global</span> miproyecto <span class="st">"C://Program Files/Dropbox/miproyecto/"</span></span>
<span id="cb27-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb27-3" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb27-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb27-4" aria-hidden="true" tabindex="-1"></a>   *** Nota 2: Directorios <span class="kw">de</span> subcarpetas ***</span>
<span id="cb27-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb27-5" aria-hidden="true" tabindex="-1"></a>   <span class="kw">clear</span></span>
<span id="cb27-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb27-6" aria-hidden="true" tabindex="-1"></a>   <span class="kw">global</span> datosbrutos <span class="st">"$miproyecto/datos/brutos"</span></span>
<span id="cb27-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb27-7" aria-hidden="true" tabindex="-1"></a>   cd <span class="st">"$datosbrutos"</span></span>
<span id="cb27-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb27-8" aria-hidden="true" tabindex="-1"></a>   <span class="kw">use</span> datos1.dta, <span class="kw">replace</span> </span></code></pre></div>
</div>
</div>
<div id="buenas-practicas-de-visualización" class="section level3" number="2.1.4">
<h3>
<span class="header-section-number">2.1.4</span> Buenas practicas de visualización<a class="anchor" aria-label="anchor" href="#buenas-practicas-de-visualizaci%C3%B3n"><i class="fas fa-link"></i></a>
</h3>
<div id="principios-de-una-buena-visualización-de-datos" class="section level4" number="2.1.4.1">
<h4>
<span class="header-section-number">2.1.4.1</span> Principios de una buena visualización de datos<a class="anchor" aria-label="anchor" href="#principios-de-una-buena-visualizaci%C3%B3n-de-datos"><i class="fas fa-link"></i></a>
</h4>
<p>Un gráfico mal hecho desinforma, gráficos mal hechos son inefectivos. Comunican mal la información o incluso la distorsionan. Las personas tenemos un procesamiento visual limitado. Existe uno previo e inconsciente y uno posterior consciente. Entender este aspecto es importante si queremos diseñar visualizaciones que sean efectivas.</p>
<p>Esta sección esta basada en <strong>An Economist’s Guide to Visualizing Data</strong> ().</p>
<p>Tres principios básicos</p>
<ul>
<li>Mostrar los datos
<ul>
<li>Es la parte más importante del gráfico.</li>
<li>No mostrar ni mucho, ni muy poco.</li>
</ul>
</li>
<li>Disminuir distractores.
<ul>
<li>Disminuir el uso de elementos visuales no útiles para entender los datos.</li>
<li>Símbolos innecesarios, texto, texturas son ejemplos de elementos visuales no útiles. * Integrar el texto al gráfico</li>
<li>El gráfico debe ser capaz de complementar el texto y al mismo tiempo contener suficiente información para estar sin él.</li>
</ul>
</li>
</ul>
</div>
<div id="siete-gráficos-alternativos" class="section level4" number="2.1.4.2">
<h4>
<span class="header-section-number">2.1.4.2</span> Siete gráficos alternativos<a class="anchor" aria-label="anchor" href="#siete-gr%C3%A1ficos-alternativos"><i class="fas fa-link"></i></a>
</h4>
</div>
</div>
<div id="sublime-text" class="section level3" number="2.1.5">
<h3>
<span class="header-section-number">2.1.5</span> Sublime Text<a class="anchor" aria-label="anchor" href="#sublime-text"><i class="fas fa-link"></i></a>
</h3>
<p>Esta sección esta basada en la página web de <a href="https://acarril.github.io/">Alvaro Carril</a>.</p>
<div id="qué-es-sublime" class="section level4" number="2.1.5.1">
<h4>
<span class="header-section-number">2.1.5.1</span> ¿Qué es Sublime?<a class="anchor" aria-label="anchor" href="#qu%C3%A9-es-sublime"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li><p><a href="https://www.sublimetext.com/">Sublime Text</a> es un editor de códigos gratuito. Este editor permite compilar códigos de distintos lenguajes de programación tales como Stata, Python, R, , entre muchos otros.</p></li>
<li><p>Tiene algunas herramientas que facilitan el trabajo de programación tales como atajos (<em>shortcuts</em>) o multicolumnas. Veremos varias en esta sección.
Es muy útil cuando tienes un proyecto grande con códigos de distintos tipos de lenguaje.
Instalar Sublime</p></li>
<li><p>Dirígete a <a href="https://www.sublimetext.com/">sublimetext.com</a>. Descarga e instala Sublime Text 4 (ST4) para tu sistema operativo.</p></li>
<li><p>Es esencial que también instales <code>Package Control</code>, que te permite añadir y eliminar fácilmente complementos adicionales. Si esta bien instalado debiese aparecer en <em>preferences.</em></p></li>
<li><p>Para installar hay que entrar a sublime, apretar <code>ctrl + shift + p</code>.</p></li>
<li><p>Tipear <code>Install Package Control</code> y presionar <code>enter</code>.</p></li>
</ul>
</div>
<div id="ejecutar-stata-desde-sublime" class="section level4" number="2.1.5.2">
<h4>
<span class="header-section-number">2.1.5.2</span> Ejecutar Stata desde Sublime<a class="anchor" aria-label="anchor" href="#ejecutar-stata-desde-sublime"><i class="fas fa-link"></i></a>
</h4>
<p>Para Windows</p>
<ul>
<li>
<strong>Instalar StataEditor:</strong> En ST4 aprete <code>ctrl+shift+p</code>. Escriba <code>install</code> y presione <code>Enter</code>. Ahora busque <code>StataEditor</code> y haga clic en él para instalarlo.</li>
<li>
<strong>Instale Pywin32:</strong> repita el proceso anterior pero instalando el complemento <code>Pywin32</code>.</li>
</ul>
<p>Configure StataEditor:</p>
<ul>
<li>En ST4 vaya a <code>Preferences -&gt; Package Settings -&gt; StataEditor -&gt; Settings - Users</code>
</li>
<li>En este archivo en blanco debe escribir la ruta de su ejecutable de Stata y la versión que posee.</li>
<li>Mi archivo de configuración en Windows se ve así:</li>
</ul>
<div class="sourceCode" id="cb28"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb28-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb28-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb28-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"stata_path"</span>: <span class="st">"C:/Program Files/Stata17/StataMP-64.exe"</span>,</span>
<span id="cb28-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb28-3" aria-hidden="true" tabindex="-1"></a>   <span class="st">"stata_version"</span>: 17,</span>
<span id="cb28-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb28-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Registre la biblioteca de automatización de Stata:</p>
<ul>
<li>Vaya al ejecutable de Stata del que ha copiado la ruta (por ejemplo, StataMP-64.exe).</li>
<li>Cree un acceso directo en su escritorio.</li>
<li>Ahora haga clic con el botón derecho en este nuevo acceso directo y seleccione ``Propiedades”.</li>
<li>En el campo ``Destino”, añada /Registro al final (con un espacio precedente). En mi caso es:</li>
</ul>
<div class="sourceCode" id="cb29"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb29-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="st">"C:\Program Files\Stata17\StataMP-64.exe"</span> /Register</span></code></pre></div>
<p>Aplicar y aceptar los cambios. Apretar sobre el acceso directo el click derecho y ejecutar como administrador. Y listo!</p>
<p>Para Mac</p>
<ul>
<li>Para instalar el Editor Mejorado de Stata en ST4, inicie la paleta de comandos con <code>Cmd+shift+p</code>, escriba `<code>install" y presione</code>Enter`.</li>
<li>Ahora busque <code>Stata Improved Editor</code> y haga clic en él para instalarlo.</li>
<li>Reinicie ST4 y listo!</li>
</ul>
<p>Autoguardado</p>
<ul>
<li>Sublime permite auto-guardar los códigos.</li>
<li>De esta forma no hay que preocuparse en casos de que no hayas respaldado tu código.</li>
<li>Para esto hay que escribir vamos a instalar el paquete <code>autosave</code> y adicionalmente vamos a agregar a ``preferencias”:</li>
</ul>
<div class="sourceCode" id="cb30"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb30-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb30-1" aria-hidden="true" tabindex="-1"></a>``save_on_focus_lost<span class="st">": true.</span></span></code></pre></div>
<p>Codificación colaborativa</p>
<ul>
<li>Para trabajo colaborativo existen editores de códigos que se enfocan en que dos o más personas puedan programar desde sus computadoras.</li>
<li>Una buena página es <a href="https://codeshare.io/bvz4Ow">Code Share</a>
</li>
<li>Muy útil para pedir ayuda o hacer una revisión final.</li>
</ul>
</div>
</div>
</div>
<div id="programar-do---files-parte-i" class="section level2" number="2.2">
<h2>
<span class="header-section-number">2.2</span> Programar do - files (Parte I)<a class="anchor" aria-label="anchor" href="#programar-do---files-parte-i"><i class="fas fa-link"></i></a>
</h2>
<div id="programar-en-stata" class="section level3" number="2.2.1">
<h3>
<span class="header-section-number">2.2.1</span> Programar en Stata<a class="anchor" aria-label="anchor" href="#programar-en-stata"><i class="fas fa-link"></i></a>
</h3>
<p>Esta sección esta basada en: <strong>An introduction to Stata Programing</strong> (), en notas de clase de la profesora <a href="https://www.erinhengel.com/">Erin Hengel</a>, en <strong>Advanced Stata Topics</strong> del profesor Alexander C. Lembcke, en <strong>Seventy-six Stata tips</strong> , en <strong>Top 10 ``gotchas”</strong> de y en <strong>Data Management Using Stata. A Practical Handbook</strong> de .</p>
<div id="qué-es-programar-en-stata" class="section level4" number="2.2.1.1">
<h4>
<span class="header-section-number">2.2.1.1</span> ¿Qué es programar en Stata?<a class="anchor" aria-label="anchor" href="#qu%C3%A9-es-programar-en-stata"><i class="fas fa-link"></i></a>
</h4>
<p>Programar en Stata es:</p>
<ul>
<li>Escribir <code>do - files</code>: una secuencia de comandos ejecutables a través de un archivo <code>.do</code>.</li>
<li>Escribir los que formalmente en Stata es un <em>programa</em>: un conjunto de comandos que incluyen el comando <code>program</code>. Un programa en Stata se guarda como un <em>ado - file</em>.</li>
<li>Escribir lenguaje de programación matricial: denominado mata.</li>
</ul>
</div>
<div id="do---files" class="section level4" number="2.2.1.2">
<h4>
<span class="header-section-number">2.2.1.2</span> do - files<a class="anchor" aria-label="anchor" href="#do---files"><i class="fas fa-link"></i></a>
</h4>
<p>El uso de <code>do-file</code> garantiza la replicabilidad del análisis de datos utilizando Stata. Recordar que un <code>do-file</code> puede llamar a otros (ej. <code>master do.file</code>. La jerarquización de los <code>do-file</code> puede ser importante para proyectos grandes o complejos. Es importante evitar trabajar en Stata interactivamente. Únicamente hay que hacerlo para inspeccionar datos (recordar practicas Sección 3.1).</p>
</div>
<div id="ado---files" class="section level4" number="2.2.1.3">
<h4>
<span class="header-section-number">2.2.1.3</span> ado - files<a class="anchor" aria-label="anchor" href="#ado---files"><i class="fas fa-link"></i></a>
</h4>
<p>Sirven para crear tus propios en Stata. Una vez que armes tu programa y lo guardes en la carpeta de <code>ado-file</code> puedes utilizarlo como cualquier otro comando de Stata. Por ejemplo, puedes agregar las opciones <em>if</em>, <em>in range</em> y otras. También puedes escribir un documento de ayuda (<em>help</em>} que explique el programa. Crear tus propios comandos es una muy buena forma de ser más eficiente al trabajar con Stata (recordar Sección 1).</p>
<p>Mata para ado-files: Los <code>ado-files</code> pueden realizar tareas más complejas que involucren ejecutar el comando múltiples veces.</p>
<ul>
<li>El lenguaje de programación mata es mucho más rápido que un <code>ado-file</code>.</li>
<li>Útil para realizar tareas que sean intensivas computacionalmente.</li>
<li>No es solo un lenguajes de programación que utiliza matrices. También sirve para tareas que involucran texto o listas.</li>
<li>Próximante discutiremos este lenguaje.</li>
</ul>
</div>
</div>
<div id="comandos-y-funciones-claves-y-algunos-detalles" class="section level3" number="2.2.2">
<h3>
<span class="header-section-number">2.2.2</span> Comandos y funciones claves (y algunos detalles)}<a class="anchor" aria-label="anchor" href="#comandos-y-funciones-claves-y-algunos-detalles"><i class="fas fa-link"></i></a>
</h3>
<p>Revisaremos algunos aspectos necesarios para mejorar la eficiencia al trabajar en Stata.</p>
<ul>
<li>Directorios y uso de <code>profile.do</code>.</li>
<li>Tipos de comandos.</li>
<li>Tipos de datos y uso de <code>compress</code>.</li>
<li>Uso de <code>capture</code>, <code>preserve</code> y <code>restore</code>.</li>
</ul>
<div id="directorios" class="section level4" number="2.2.2.1">
<h4>
<span class="header-section-number">2.2.2.1</span> Directorios<a class="anchor" aria-label="anchor" href="#directorios"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>
<code>cd</code> y <code>pwd</code> sirven para fijar y conocer mis directorios. Es importante utilizar <strong>dobles comillas</strong> en los casos en que la ruta del directorio tenga espacios.</li>
<li>El comando <code>sysdir</code> provee una lista de los directorios importantes para Stata.</li>
<li>El comando <code>update</code> sirve para actualizar los comandos.</li>
<li>La carpeta <code>PLUS</code> es el directorio donde se guardan comandos descargados. Si utilizas <code>ssc</code>, se guardara en esta carpeta.<br>
</li>
<li>
<code>PERSONAL</code> para tus propios <code>ado-files</code>.</li>
</ul>
</div>
<div id="profile-do" class="section level4" number="2.2.2.2">
<h4>
<span class="header-section-number">2.2.2.2</span> Profile do<a class="anchor" aria-label="anchor" href="#profile-do"><i class="fas fa-link"></i></a>
</h4>
<p>¿Qué es profile do?</p>
<ul>
<li>Una opción no tan conocida es la utilización de <code>profile.do</code>
</li>
<li>Este archivo se ejecuta cada vez que Stata se inicia. Si no tienes uno guardado no pasa nada.</li>
<li>Este <code>do-file</code> permite, por ejemplo, fijar tu directorio de trabajo inicial, cambiar características de los gráficos, generar atajos.<br>
</li>
<li>También se puede hacer que Stata abra un log-file y lo guarde siempre en el mismo lugar.</li>
<li>Cada vez que inicies sesión Stata ira por <code>profile.do</code>. Si lo encuentra lo va a ejecutar.<br>
</li>
<li>Stata recomienda guardar <code>profile.do</code> en <em>home directory</em> (ver <em>help profilew para ususarios de windows y profilem para Mac</em>).</li>
<li>Vamos a ver como modificar <code>profile.do</code>. En particular:
<ul>
<li>Ajustes generales.</li>
<li>Establecer las características de los gráficos.</li>
<li>Establecer atajos</li>
<li>Abrir, cerrar y guardar un log-file con la fecha.</li>
</ul>
</li>
</ul>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.3.1:</b></p>
<p>Instrucciones</p>
<ol style="list-style-type: decimal">
<li>Descargar carpeta <em>ejercicios-clase3</em>.</li>
<li>Abrir <code>profile.do</code> e inspeccionar cada una de las lineas del código.</li>
</ol>
<p>Preguntas</p>
<ol style="list-style-type: decimal">
<li>Agrega dos elementos a alguna sección.</li>
<li>Modifica las carpetas según las características de tu computadora.</li>
<li>Guarda <code>profile.do</code> en el <em>home directory</em>. Ejecutar nuevamente Stata y verificar que el código se ha ejecutado.</li>
</ol>
</div>
</div>
<div id="tipos-de-comandos" class="section level4" number="2.2.2.3">
<h4>
<span class="header-section-number">2.2.2.3</span> Tipos de comandos<a class="anchor" aria-label="anchor" href="#tipos-de-comandos"><i class="fas fa-link"></i></a>
</h4>
<p>Comandos r-class y e-class</p>
<ul>
<li>Muchos comandos en Stata (ej. <code>summarize</code>, <code>correlate</code>, <code>regress</code>) hacen que sea posible utilizar sus resultados una vez que estos son ejecutados.</li>
<li>
<code>summarize</code> y <code>correlate</code> son comandos <code>r-class</code>. Es decir, comandos que guardan sus resultados en <code>r()</code>.</li>
<li>
<code>regress</code> es un comando <code>e-class</code>. Es decir, comandos que guardan sus resultados en <code>e()</code>.</li>
<li>
<code>return list</code> retorna los valores guardados en <code>r()</code>
</li>
</ul>
<div class="sourceCode" id="cb31"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb31-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb31-1" aria-hidden="true" tabindex="-1"></a>* <span class="fu">r</span>-<span class="kw">class</span></span>
<span id="cb31-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto.dta, <span class="kw">clear</span> </span>
<span id="cb31-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="kw">summarize</span> mpg </span>
<span id="cb31-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span> <span class="ot">list</span> </span>
<span id="cb31-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="kw">summarize</span> mpg, <span class="kw">detail</span> </span>
<span id="cb31-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span> <span class="ot">list</span> </span>
<span id="cb31-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"La asimetría de mpg es"</span> <span class="fu">r</span>(skewness) </span>
<span id="cb31-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="kw">summarize</span> price, <span class="kw">detail</span> </span>
<span id="cb31-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span> <span class="ot">list</span> </span></code></pre></div>
<p>Su limitación es que solo están disponibles los valores del último comando <code>r-class</code> ejecutado.</p>
<p>Los comandos <code>e-class</code> son comandos de <em>estimación</em>. Para verlos <code>ereturn list</code> y para llamarlos individualmente <code>e(nombre)</code>. Guardan más información que los de <code>r-class</code> : matrices, vectores y funciones. La información de los comandos <code>e-class</code> sigue estando disponible una vez que utilizamos algún comando <code>r</code>-class`. <strong>Aquí una diferencia!</strong></p>
<p>Un ejemplo clásico son las estimaciones de regresión lineal.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb32-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="kw">regress</span> mpg <span class="kw">weight</span> <span class="fu">length</span> rep78 </span>
<span id="cb32-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"La regresión se estimo para "</span> <span class="fu">e</span>(<span class="kw">N</span>) <span class="st">" observaciones."</span> </span>
<span id="cb32-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="kw">ereturn</span> <span class="ot">list</span></span></code></pre></div>
<p>En general cualquier comando de estimación se guarda en esta clase de formato.</p>
</div>
<div id="tipos-de-datos" class="section level4" number="2.2.2.4">
<h4>
<span class="header-section-number">2.2.2.4</span> Tipos de datos<a class="anchor" aria-label="anchor" href="#tipos-de-datos"><i class="fas fa-link"></i></a>
</h4>
<p>numeric y string</p>
<ul>
<li>La mayor distinción entre tipos de datos es entre <em>numeric</em> y <em>string</em>.</li>
<li>Al trabajar con datos muchas veces es necesario realizar conversiones entre estos dos formatos. Los comandos <code>destring</code>, <code>tostring</code> y <code>encode</code> son útiles para estas tareas (si alguien tiene dudas con alguno me escriben).</li>
<li>
<em>strings</em> pueden soportar un máximo de 244 caracteres con un <code>byte</code> por cada carácter.</li>
<li>Por ejemplo, una variable del tipo <code>str20</code> requiere 20 <code>bytes</code> por observación.</li>
</ul>
<p>Clasificación de los datos</p>
<ul>
<li>Para las variables en formato <em>numeric</em> los tipos de datos son: <code>byte</code>, <code>int</code>, <code>long</code>, <code>float</code> y <code>double</code>.</li>
<li>Los tres primeros solo puede almacenar valores enteros. <code>long</code> puede almacenar todos los números de 9 dígitos, pero es limitado para 10 dígitos.</li>
<li>
<code>float</code> y <code>double</code> pueden almacenar números grandes.</li>
<li>No asumir que <code>float</code> será aritméticamente exacto. Por ejemplo:</li>
</ul>
<div class="sourceCode" id="cb33"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb33-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb33-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">float</span>(16777216)</span>
<span id="cb33-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb33-2" aria-hidden="true" tabindex="-1"></a>        16777216</span>
<span id="cb33-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">float</span>(16777217)</span>
<span id="cb33-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb33-4" aria-hidden="true" tabindex="-1"></a>        16777216</span></code></pre></div>
<p>¿Como utilizar esto para programar efectivamente en Stata?</p>
<ul>
<li>IDs con muchos dígitos (y caracteres) guardarlos como <em>string</em>. No como <code>integers</code>, <code>float</code> o <code>doubles</code>.</li>
<li>No confiar en test exactos contra una constante con datos en formato <code>float</code>. Utilizar formato <code>double</code> para cualquier serie que necesita ser precisa (ej. suma de los residuos de una regresión).</li>
<li>Utiliza <code>integers</code> cuando sea apropiado (ej. variables dicotómicas). Guardar valores como <code>int</code> o <code>byte</code> ayuda a utilizar de forma más eficiente el espacio en el disco.</li>
<li>
<code>compress</code> examina cada variable y determina si estas pueden ser guardadas de forma más eficiente. <strong>Utilizarlo</strong>.</li>
</ul>
<p>Si se especifican valores iniciales fuera de los rangos permitidos para cada tipo de dato el resultado será un <em>missing</em>.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb34-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span> <span class="ot">all</span> </span>
<span id="cb34-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="kw">obs</span> 10 </span>
<span id="cb34-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> <span class="kw">byte</span> var1 = 101</span>
<span id="cb34-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="kw">summarize</span> var1 </span></code></pre></div>
<p>Notar que no se genera ninguna alerta de <em>missing</em> cuando este se crea. Esto es distinto para variables que ya existen.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb35-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span> <span class="ot">all</span></span>
<span id="cb35-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="kw">obs</span> 10</span>
<span id="cb35-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> <span class="kw">byte</span> var1 = 1</span>
<span id="cb35-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> var1 = 101</span></code></pre></div>
<p>Si el valor esta fuera de los rangos permitidos, la variable se guarda en un formato mayor. <code>byte</code> a <code>int</code>, <code>int</code> a <code>long</code>, a <code>float</code> a <code>double</code>. En este caso un mensaje aparece.</p>
</div>
<div id="capture-preserve-y-restore" class="section level4" number="2.2.2.5">
<h4>
<span class="header-section-number">2.2.2.5</span> capture, preserve y restore<a class="anchor" aria-label="anchor" href="#capture-preserve-y-restore"><i class="fas fa-link"></i></a>
</h4>
<p>Manejando errores: capture</p>
<ul>
<li>Sirve para evitar que Stata aborte cuando detecta un error.</li>
<li>Bueno para cuando quieres borrar algo que ya no se encuentra. Lo malo es que suprime todos los errores y oculta todo lo que puede ir mal.</li>
</ul>
<div class="sourceCode" id="cb36"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb36-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="kw">obs</span> 10</span>
<span id="cb36-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> <span class="kw">byte</span> var1 = 5</span>
<span id="cb36-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> <span class="kw">byte</span> var2 = 10 </span>
<span id="cb36-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="kw">capture</span> <span class="kw">drop</span> var1 var2 var3 </span>
<span id="cb36-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">describe</span> var1 var2</span></code></pre></div>
<p>Código crea <code>var1</code> y <code>var2</code>, luego las elimina incluyendo una variable que no existe. Al contrario de lo que se intuye, no se borran las variables, dado que hay una variable que no existe. La recomendación es siempre utilizar <code>capture</code> con moderación. Puede ser utilizado en bloque para así no tener que utilizarlo en cada linea.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb37-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto.dta, <span class="kw">clear</span></span>
<span id="cb37-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="kw">capture</span>{</span>
<span id="cb37-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> price mpg-trunk</span>
<span id="cb37-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> price mpg-<span class="kw">weight</span></span>
<span id="cb37-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> price mpg-foreign</span>
<span id="cb37-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb37-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="kw">ereturn</span> <span class="ot">list</span> </span></code></pre></div>
<p>preserve y restore</p>
<ul>
<li>Algunos comandos en Stata remplazan la base actual por una nueva (ej. <code>collapse</code> o <code>contract</code>).</li>
<li>Utilizar <code>preserve</code> y <code>restore</code> es útil en estos casos.</li>
<li>En caso de que queramos obtener estadística descriptiva agregada y asociarla a observaciones podemos utilizar estos comandos.</li>
</ul>
<div class="sourceCode" id="cb38"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb38-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb38-1" aria-hidden="true" tabindex="-1"></a>* Ejemplo con <span class="kw">collapse</span></span>
<span id="cb38-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto.dta, <span class="kw">clear</span></span>
<span id="cb38-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> lprice = <span class="fu">log</span>(price)</span>
<span id="cb38-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="kw">preserve</span></span>
<span id="cb38-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="kw">collapse</span> (<span class="fu">max</span>) max_lprice=lprice max_mpg=mpg <span class="co">///</span></span>
<span id="cb38-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb38-6" aria-hidden="true" tabindex="-1"></a>(<span class="fu">iqr</span>) iqr_lprince = lprice iqr_mpg = mpg <span class="kw">if</span> !<span class="fu">missing</span>(rep78), <span class="kw">by</span>(rep78) </span>
<span id="cb38-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="kw">sort</span> rep78 </span>
<span id="cb38-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="kw">tempfile</span> repstats</span>
<span id="cb38-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="kw">save</span> <span class="ot">`repstats'</span></span>
<span id="cb38-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="kw">restore</span> </span>
<span id="cb38-11"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="kw">sort</span> rep78 </span>
<span id="cb38-12"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="kw">merge</span> <span class="fu">m</span>:1 rep78 <span class="kw">using</span> <span class="ot">`repstats'</span></span>
<span id="cb38-13"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="kw">assert</span> <span class="dt">_merge</span> != 2</span>
<span id="cb38-14"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb38-14" aria-hidden="true" tabindex="-1"></a><span class="kw">summarize</span> lprice max_lprice max_mpg </span>
<span id="cb38-15"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb38-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-16"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb38-16" aria-hidden="true" tabindex="-1"></a>* Ejemplo con <span class="kw">contract</span></span>
<span id="cb38-17"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb38-17" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto.dta, <span class="kw">clear</span></span>
<span id="cb38-18"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb38-18" aria-hidden="true" tabindex="-1"></a><span class="kw">preserve</span></span>
<span id="cb38-19"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb38-19" aria-hidden="true" tabindex="-1"></a><span class="kw">contract</span> mpg, <span class="kw">cfreq</span>(cumfreq) <span class="kw">percent</span>(percentage) <span class="kw">cpercent</span>(cumpercent)</span>
<span id="cb38-20"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb38-20" aria-hidden="true" tabindex="-1"></a><span class="kw">sort</span> mpg </span>
<span id="cb38-21"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb38-21" aria-hidden="true" tabindex="-1"></a><span class="kw">tempfile</span> mpgfreq</span>
<span id="cb38-22"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb38-22" aria-hidden="true" tabindex="-1"></a><span class="kw">save</span> <span class="ot">`mpgfreq'</span></span>
<span id="cb38-23"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb38-23" aria-hidden="true" tabindex="-1"></a><span class="kw">restore</span> </span>
<span id="cb38-24"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb38-24" aria-hidden="true" tabindex="-1"></a><span class="kw">sort</span> mpg</span>
<span id="cb38-25"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb38-25" aria-hidden="true" tabindex="-1"></a><span class="kw">merge</span> <span class="fu">m</span>:1 mpg <span class="kw">using</span> <span class="ot">`mpgfreq'</span></span>
<span id="cb38-26"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb38-26" aria-hidden="true" tabindex="-1"></a><span class="kw">assert</span> <span class="dt">_merge</span> != 2</span>
<span id="cb38-27"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb38-27" aria-hidden="true" tabindex="-1"></a><span class="kw">summarize</span> _freq cumfreq percentage cumpercent</span></code></pre></div>
</div>
<div id="missing-values" class="section level4" number="2.2.2.6">
<h4>
<span class="header-section-number">2.2.2.6</span> Missing values<a class="anchor" aria-label="anchor" href="#missing-values"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>En general uno utiliza <code>if variable !=.</code> para evitar incluir <strong>missings</strong>.</li>
<li>Mejor practica es <code>variable &lt;.</code> para excluir todos los valores en <em>missing</em>. Otra opción es <code>if !missing(variable)</code>.</li>
<li>Los <em>missing</em> están codificados internamente como valores mayores a cualquier número. El menor valor de todos los <em>missing</em> es el punto. Al utilizar <code>if variable &lt;.</code> es como decir, solo utiliza los números.</li>
<li>Como vimos en la Sección 3.1 hay muchos problemas al no tratar bien los <em>missings</em>. Este problema se incrementa al momento de trabajar con bases de datos imposibles de inspeccionar. Veremos algunas recomendaciones que pueden ser utiles para evitar estos errores.</li>
</ul>
<p>Los comandos tratan distinto a los missings</p>
<ul>
<li>Cualquier función de datos <em>missing</em> será <em>missing</em>.</li>
<li>Cuando se calcula un promedio o una desviación estándar solo valores no missing son considerados (ej. <code>sum</code>).<br>
</li>
<li>Algunos comandos en Stata manejan los <em>missing</em> de otras formas. Por ejemplo, las funciones <code>max</code>, <code>min</code> y las funciones para filas de <code>egen</code>: <code>rowmax()</code>, <code>rowmean()</code>, <code>rowmin()</code>, <code>rowsd()</code> y <code>rowtotal()</code> ignoran los <em>missing</em>. Por ejemplo, <code>rowmean(x1,x2,x3)</code> calcula el promedio de las variables y solo retornara <em>missing</em> si todas lo son.</li>
<li>Por ejemplo, <code>rowmean(x1,x2,x3)</code> calcula el promedio de las variables y solo retornara <em>missing</em> si todas lo son.</li>
<li>
<code>collapse (sum)</code> trata a los <em>missing</em> como ceros.</li>
</ul>
<p>Calcular un promedio con missings</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb39-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span></span>
<span id="cb39-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="kw">obs</span> 10 </span>
<span id="cb39-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> var1 = rnormal()</span>
<span id="cb39-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> var2 = 5 </span>
<span id="cb39-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> var3 = .</span>
<span id="cb39-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> promedio = (var1 + var2 + var3)/3</span>
<span id="cb39-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> promedio1 = <span class="fu">rowmean</span>(var1 var2 var3)</span></code></pre></div>
<p>PromedioSinMissing da como resultado <em>missings</em>. PromedioConMissing no considera <em>missings</em>. Es importante tratar de entender como funcionan los <code>missings</code> de los comandos que utilizas.</p>
<p>Generar variables considerando missings: Al crear una variable <em>dicotómica</em>, <code>gen</code> y <code>gen byte</code> tratan a los <em>missing</em> de formas distintas.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb40-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb40-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span> <span class="kw">N</span> = 500</span>
<span id="cb40-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb40-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> <span class="kw">obs</span> <span class="ot">`N'</span></span>
<span id="cb40-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb40-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">gen</span> indicador = uniform() &lt; .5</span>
<span id="cb40-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">replace</span> indicador =. <span class="kw">if</span> <span class="fu">mod</span>(<span class="dt">_n</span>, 2) == 0</span>
<span id="cb40-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb40-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb40-6" aria-hidden="true" tabindex="-1"></a>    * Si indicador es <span class="fu">missing</span>, <span class="kw">variable</span> sera <span class="fu">missing</span></span>
<span id="cb40-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb40-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">gen</span> variable_primercaso = 1 <span class="kw">if</span> indicador == 1 </span>
<span id="cb40-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb40-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">replace</span> variable_primercaso = 0 <span class="kw">if</span> indicador == 0</span>
<span id="cb40-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb40-9" aria-hidden="true" tabindex="-1"></a>    * Si indicador es <span class="fu">missing</span>, <span class="kw">variable</span> sera cero. </span>
<span id="cb40-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb40-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">gen</span> variable_segundocaso=(indicador==1)</span>
<span id="cb40-11"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb40-11" aria-hidden="true" tabindex="-1"></a>    \<span class="kw">end</span>{minted}</span>
<span id="cb40-12"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb40-12" aria-hidden="true" tabindex="-1"></a>    \<span class="kw">end</span>{itemize}</span></code></pre></div>
<p><code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code> considera <em>missing</em> como ceros.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb41-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb41-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">clear</span> <span class="ot">all</span> </span>
<span id="cb41-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb41-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> <span class="kw">obs</span> 4 </span>
<span id="cb41-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb41-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">generate</span> <span class="kw">byte</span> var1 = <span class="fu">cond</span>(<span class="fu">mod</span>(<span class="dt">_n</span>,2)==1, 1, .)</span>
<span id="cb41-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb41-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">generate</span> <span class="kw">byte</span> var1sum = <span class="kw">sum</span>(var1)</span>
<span id="cb41-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb41-5" aria-hidden="true" tabindex="-1"></a>    <span class="ot">list</span>, <span class="kw">noobs</span></span></code></pre></div>
<p><code><a href="https://rdrr.io/r/base/Extremes.html">max()</a></code> trata a los <em>missing</em> como si no estuviesen allí.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb42-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb42-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">display</span> <span class="fu">max</span>(-5,.)</span></code></pre></div>
<p>tabmiss, mvdecode y mvencode</p>
<ul>
<li>En ocasiones los <em>missing</em> difieren en notación (ej. al importar datos de otro paquete). Siempre que trabajes con una base de datos nueva es importante recodificar. Notar que no todos tienen que ir a un punto. Todo depende del origen de los <em>missing</em>.</li>
<li>
<code>mvdecode</code> y <code>mvencode</code> pueden ser útiles en este tipo de casos.</li>
<li>
<code>mvdecode</code> permite recodificar valores numéricos como <em>missing</em>. Útil cuando valores son representados como -99, -999.</li>
<li>
<code>mvencode</code> hace lo inverso. Mapea <em>missing</em> como numéricos.</li>
<li>El comando <code>tabmiss</code> inspecciona todas las variables de una base de datos y reporta los <code>missing</code> totales y como fracción del total de observaciones.</li>
</ul>
<div class="sourceCode" id="cb43"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb43-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span> <span class="ot">all</span> </span>
<span id="cb43-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="dv">seed</span> 1234</span>
<span id="cb43-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="kw">N</span> = 50</span>
<span id="cb43-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="kw">obs</span> <span class="ot">`N'</span></span>
<span id="cb43-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> income = <span class="fu">abs</span>(<span class="kw">int</span>(rnormal(0,5)))</span>
<span id="cb43-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="kw">assert</span> income &gt;= 0</span>
<span id="cb43-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> income =. <span class="kw">if</span> <span class="fu">mod</span>(<span class="dt">_n</span>, 2) == 0</span>
<span id="cb43-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb43-8" aria-hidden="true" tabindex="-1"></a>* Para ver los <span class="fu">missing</span> en variables</span>
<span id="cb43-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb43-9" aria-hidden="true" tabindex="-1"></a>tabmiss </span>
<span id="cb43-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb43-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-11"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb43-11" aria-hidden="true" tabindex="-1"></a>* Transformar un valor númerico a <span class="fu">missing</span></span>
<span id="cb43-12"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="kw">mvdecode</span> income, mv(2)</span>
<span id="cb43-13"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb43-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-14"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb43-14" aria-hidden="true" tabindex="-1"></a>* Transformar varios valores númericos a <span class="fu">missing</span>.</span>
<span id="cb43-15"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb43-15" aria-hidden="true" tabindex="-1"></a><span class="kw">mvdecode</span> income, mv(2 5)</span>
<span id="cb43-16"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb43-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-17"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb43-17" aria-hidden="true" tabindex="-1"></a>* Transformar varios a <span class="fu">missing</span>, pero identific ́andolos.</span>
<span id="cb43-18"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb43-18" aria-hidden="true" tabindex="-1"></a><span class="kw">mvdecode</span> income, mv(3 = .a \ 6 = .b)</span>
<span id="cb43-19"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb43-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-20"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb43-20" aria-hidden="true" tabindex="-1"></a>* Missings se cambian <span class="kw">de</span> vuelta a su valor original.</span>
<span id="cb43-21"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb43-21" aria-hidden="true" tabindex="-1"></a><span class="kw">mvencode</span> income, mv(.a = 3 \ .b = 6)</span></code></pre></div>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.3.2: </b></p>
<p>Instrucciones</p>
<p>Abrir <code>ejercicios-clase3.do</code> y ejecute las líneas correspondientes al ejercicio 2.</p>
<p>Pregunta</p>
<p>Compare las opciones 1, 2 y 3 en relación a como tratan los <em>missing</em>. Explique las diferencias entre cada una de estas opciones.</p>
</div>
<p>generate, replace y missing: Sólo unas pequeños detalles.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb44-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span> </span>
<span id="cb44-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb44-2" aria-hidden="true" tabindex="-1"></a>cd <span class="st">"$ejercicio3"</span></span>
<span id="cb44-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> census2c, <span class="kw">clear</span></span>
<span id="cb44-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb44-5" aria-hidden="true" tabindex="-1"></a>* Opción 1</span>
<span id="cb44-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> smallpop_o1 = 1 <span class="kw">if</span> pop&lt;=5000</span>
<span id="cb44-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> smallpop_o1 = 0 <span class="kw">if</span> pop&gt;5000</span>
<span id="cb44-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb44-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb44-9" aria-hidden="true" tabindex="-1"></a>* Opción 2</span>
<span id="cb44-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> smallpop_o2 = (pop &lt;= 5000) </span>
<span id="cb44-11"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb44-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-12"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb44-12" aria-hidden="true" tabindex="-1"></a>* Opcion 3</span>
<span id="cb44-13"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb44-13" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> smallpop_o3 = (pop &lt;= 5000) <span class="kw">if</span> !<span class="fu">missing</span>(pop)</span></code></pre></div>
<p>Opción 1 es la típica. Ojo no esta considerando <em>missing</em>. Es necesario agregar <code>&amp; !missing(pop)</code>. Escrito de esta forma, si <code>pop</code> es <em>missing</em>, <code>smallpop</code> será <em>cero</em>. Opción 2 es más simple, pero si cualquier valor de <code>pop</code> es <em>missing</em> será evaluado como un cero también. La razón es que los <em>missing</em> en Stata son considerados como números muy grandes para el programa. La Opción 3 soluciona el problema.</p>
</div>
<div id="string-a-numeric-y-al-revés" class="section level4" number="2.2.2.7">
<h4>
<span class="header-section-number">2.2.2.7</span> String a numeric y al revés<a class="anchor" aria-label="anchor" href="#string-a-numeric-y-al-rev%C3%A9s"><i class="fas fa-link"></i></a>
</h4>
<p>De string a numeric</p>
<ul>
<li>Si las variables han sido mal clasificadas como <em>string</em> puedes utilizar la función <code>real()</code>.</li>
<li>Por ejemplo: <code>generate idpaciente = real(pacienteid)</code>.</li>
<li>El comando anterior genera <em>missing</em> para todas las observaciones que no puedan ser interpretadas como numéricas.</li>
<li>Mucho mejor es utilizar <code>destring, replace</code>.</li>
<li>Otro caso usual es que tenemos datos en formato <code>string</code> y queremos que tengan un equivalente. El comando <code>encode</code>. No es aconsejable utilizar este comando para valores numéricos guardados como <em>string</em>.</li>
</ul>
<p>De numeric a string</p>
<ul>
<li>Hay veces en las que se quiere generar un equivalente <em>string</em> a valores numéricos.</li>
<li>Tres comandos: <code>string()</code> , <code>tostring()</code> y <code>decode()</code>.</li>
<li>Un ejemplo es querer mantener los 0 que estan al inicio de un código ID.</li>
<li>El comando <code>tostring zip, format(\%05.0f) generate(idstring)</code> genera un <em>string</em> de cinco digitos con los ceros al inicio.</li>
<li>
<code>decode()</code> sirve para un caso en que tengas un id en numérico, pero que no la tengas en <em>string</em>.</li>
</ul>
<p>Strings entre comillas: importa poner las comillas bien.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb45-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"Este es un string normal"</span></span>
<span id="cb45-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"Este no es un string con "</span>comillas<span class="st">" "</span></span>
<span id="cb45-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">`"</span>Este si es un <span class="fu">string</span> con <span class="st">"comillas""'</span></span></code></pre></div>
</div>
<div id="funciones-para-generar-variables" class="section level4" number="2.2.2.8">
<h4>
<span class="header-section-number">2.2.2.8</span> Funciones para generar variables<a class="anchor" aria-label="anchor" href="#funciones-para-generar-variables"><i class="fas fa-link"></i></a>
</h4>
<p>generate y replace: función <code>cond()</code></p>
<ul>
<li>Si quiero que un resultado sea “a” si una <em>condición es verdadera</em> y “b” si es <em>falsa</em>.</li>
<li>La función <code>cond(x,a,b)</code> posee esta capacidad sin la necesidad de utilizar <code>if</code>.</li>
</ul>
<div class="sourceCode" id="cb46"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb46-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb46-1" aria-hidden="true" tabindex="-1"></a>* Útil para construir una tabla</span>
<span id="cb46-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> netmarr2x = <span class="fu">cond</span>(marr/divr &gt; 2, 1, 2) </span>
<span id="cb46-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="kw">label</span> <span class="kw">define</span> netmarr2xc 1 <span class="st">"marr &gt; 2 divr"</span> 2 <span class="st">"marr &lt;= 2 divr"</span> </span>
<span id="cb46-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="kw">label</span> <span class="kw">values</span> netmarr2x netmarr2xc </span>
<span id="cb46-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="kw">tabstat</span> pop medage, <span class="kw">by</span>(netmarr2x) </span></code></pre></div>
<p>Las observaciones en Stata estás numeradas desde el 1. <code>_N</code> es el mayor número de observaciones, mientras que el actual es <code>_n</code>. <code>sort</code> (ascendete) y <code>gsort</code> (ascendete o descendente) alteran el orden de las observaciones. Como recomendación eviten generar variables o condiciones que dependan de la posición especifica de una observación.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb47-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb47-1" aria-hidden="true" tabindex="-1"></a>* Ejemplo 1: uso <span class="kw">de</span> <span class="kw">gsort</span></span>
<span id="cb47-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="kw">gsort</span> region -pop </span>
<span id="cb47-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="kw">by</span> region: <span class="kw">generate</span> totpop = <span class="kw">sum</span>(pop)</span>
<span id="cb47-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb47-5" aria-hidden="true" tabindex="-1"></a>* Ejemplo 2: uso <span class="kw">de</span> <span class="dt">_n</span> <span class="fu">y</span> _N</span>
<span id="cb47-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="kw">by</span> region: <span class="ot">list</span> region totpop <span class="kw">if</span> <span class="dt">_n</span> == _N</span>
<span id="cb47-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb47-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb47-8" aria-hidden="true" tabindex="-1"></a>* Ejemplo 3: <span class="kw">sort</span></span>
<span id="cb47-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> largepop = 0</span>
<span id="cb47-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> largepop = 1 <span class="kw">if</span> pop &gt; 5000 &amp; !<span class="fu">missing</span>(pop)</span>
<span id="cb47-11"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> smallpop = (pop &lt;= 5000) <span class="kw">if</span> !<span class="fu">missing</span>(pop)</span>
<span id="cb47-12"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> popsize = smallpop + 2*largepop</span>
<span id="cb47-13"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb47-13" aria-hidden="true" tabindex="-1"></a><span class="kw">label</span> <span class="kw">variable</span> popsize <span class="st">"Population size code"</span></span>
<span id="cb47-14"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb47-14" aria-hidden="true" tabindex="-1"></a><span class="kw">label</span> <span class="kw">define</span> popsize 1  <span class="st">"&lt;= 5 million"</span> 2 <span class="st">"&gt; 5 million"</span>, modify</span>
<span id="cb47-15"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb47-15" aria-hidden="true" tabindex="-1"></a><span class="kw">label</span> <span class="kw">values</span> popsize popsize </span>
<span id="cb47-16"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb47-16" aria-hidden="true" tabindex="-1"></a><span class="kw">bysort</span> region popsize: <span class="kw">egen</span> meanpop2 = <span class="kw">mean</span>(pop) </span></code></pre></div>
<p><code>recode</code> para variables discretas: <code>recode</code> crea una nueva variable basada en otra variable.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb48-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb48-1" aria-hidden="true" tabindex="-1"></a>* Esta no es una buena opción </span>
<span id="cb48-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> newcode = 5 <span class="kw">if</span> oldcode == 2 </span>
<span id="cb48-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> newcode = 8 <span class="kw">if</span> oldcode == 3 </span>
<span id="cb48-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> newcode = 12 <span class="kw">if</span> <span class="fu">inlist</span>(oldcode, 5, 6, 7)</span>
<span id="cb48-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb48-5" aria-hidden="true" tabindex="-1"></a>* Esta si es una buena opción </span>
<span id="cb48-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="kw">recode</span> oldcode (2 = 5) (3 = 8) (5/7 = 12), <span class="kw">gen</span>(newcode) </span></code></pre></div>
<p>El signo (<span class="math inline">\(=\)</span>) es para indicar valor antiguo a valor nuevo. No es necesario aplicarlo linea por linea. <code>recode</code> produce <strong>un código más eficiente</strong>.</p>
<p><code>recode</code> para variables continuas: <code>recode(x,x1,x2,x3,x4,xn)</code> para variables continuas de forma tal de generar intervalos tal que <span class="math inline">\(x \leq x_1 ; x_1 \leq x \leq x_2\)</span> y así sucesivamente. Los resultados son iguales a los límites creados.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb49-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> census2c, <span class="kw">clear</span></span>
<span id="cb49-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> breaks = <span class="kw">recode</span>(medage, 29, 30, 31, 32, 33)</span></code></pre></div>
<p>Otros comandos que cumplen una función parecida son <code>floor</code> y <code>ceil()</code>. Ambos sirven para generar un valor entero. El primero para redondear hacia abajo y el otro hacia arriba. <code>floor(x)</code> retorna el entero <span class="math inline">\(n\)</span> tal que <span class="math inline">\(n \leq x &lt; n + 1\)</span> mientras que <code>ceil(x)</code> es tal que <span class="math inline">\(n - 1 &lt; x \leq n\)</span>.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb50-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> census2c, <span class="kw">clear</span></span>
<span id="cb50-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> popurbfloor = <span class="fu">floor</span>(popurb)</span>
<span id="cb50-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> popurbceil = <span class="fu">ceil</span>(popurb)</span></code></pre></div>
<p><code>irecode</code> para variables continuas: <code>irecode(x,x1,x2,x3,x4,x_n)</code> es una alternativa para categorizar grupos también. Por ejemplo:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb51-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> <span class="kw">size</span> = <span class="fu">irecode</span>(pop, 1000, 4000, 8000, 20000)</span>
<span id="cb51-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="kw">label</span> <span class="kw">define</span> popsize 0 <span class="st">"&lt;1m"</span> 1 <span class="st">"1-4m"</span> 2 <span class="st">"4-8m"</span> 3 <span class="st">"&gt;8m"</span> </span>
<span id="cb51-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="kw">label</span> <span class="kw">values</span> <span class="kw">size</span> popsize</span>
<span id="cb51-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="kw">tabstat</span> pop, stat(<span class="kw">mean</span> <span class="fu">min</span> <span class="fu">max</span>) <span class="kw">by</span>(<span class="kw">size</span>)</span></code></pre></div>
<p>Categorizara cada grupo según el intervalo en el que este. <strong>Parte del cero!</strong>. $x x_1 $, <span class="math inline">\(x_1 \leq x \leq x_2 \rightarrow 1\)</span> y así sucesivamente.</p>
<p>Crear cuartiles con <code>xtile</code>: Con <code>xtile</code> podemos querer clasificar las variables según cuantiles (quintiles, deciles, cuartiles, etc).</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb52-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb52-1" aria-hidden="true" tabindex="-1"></a>* Creamos cuartiles para población </span>
<span id="cb52-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="kw">xtile</span> popcuart = pop , nq(4)</span>
<span id="cb52-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="kw">tabstat</span> pop, stat(n <span class="kw">mean</span> <span class="fu">min</span> <span class="fu">max</span>) <span class="kw">by</span>(popcuart)</span></code></pre></div>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.3.3:</b></p>
<p>Instrucciones</p>
<ol style="list-style-type: decimal">
<li>Cargar la base <code>auto.dta</code>
</li>
</ol>
<p>Pregunta</p>
<ol style="list-style-type: decimal">
<li>Genere una variable que sirva para redondear hacia abajo la variable <code>mpg</code> en en múltiplos de 5, de modo que cualquier valor de 10 a 14 se redondee a 10, cualquier valor de 15 a 19 a 15 y así sucesivamente.</li>
</ol>
</div>
</div>
<div id="funciones-de-egen" class="section level4" number="2.2.2.9">
<h4>
<span class="header-section-number">2.2.2.9</span> Funciones de egen<a class="anchor" aria-label="anchor" href="#funciones-de-egen"><i class="fas fa-link"></i></a>
</h4>
<p>Todos y todas conocemos algunas de las típicas funciones de <code>egen</code>.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb53-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span> </span>
<span id="cb53-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb53-2" aria-hidden="true" tabindex="-1"></a>* Ejemplo del uso <span class="kw">de</span> <span class="kw">egen</span></span>
<span id="cb53-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> <span class="kw">size</span> = <span class="fu">irecode</span>(pop, 1000, 4000, 8000, 20000)</span>
<span id="cb53-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="kw">label</span> <span class="kw">define</span> popsize 0 <span class="st">"&lt;1m"</span> 1 <span class="st">"1-4m"</span> 2 <span class="st">"4-8m"</span> 3 <span class="st">"&gt;8m"</span> </span>
<span id="cb53-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="kw">label</span> <span class="kw">values</span> <span class="kw">size</span> popsize</span>
<span id="cb53-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="kw">bysort</span> <span class="kw">size</span>: <span class="kw">egen</span> avgpop = <span class="kw">mean</span>(pop)</span>
<span id="cb53-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> popratio = 100 * pop / avgpop </span>
<span id="cb53-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="kw">format</span> popratio \%7.2f</span>
<span id="cb53-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb53-9" aria-hidden="true" tabindex="-1"></a><span class="ot">list</span> state pop avgpop popratio <span class="kw">if</span> <span class="kw">size</span> == 0 </span></code></pre></div>
<p>Otras funciones son <code>iqr()</code>, <code>kurt()</code>,<code><a href="https://rdrr.io/r/stats/mad.html">mad()</a></code>, <code>mdev()</code>, <code><a href="https://rdrr.io/r/stats/median.html">median()</a></code>, <code><a href="https://rdrr.io/r/base/mode.html">mode()</a></code>, <code>pc()</code>, <code>pctile()</code>, <code><a href="https://rdrr.io/r/base/rank.html">rank()</a></code>, <code><a href="https://rdrr.io/r/stats/sd.html">sd()</a></code>, <code>skwe()</code>, <code>std()</code>.</p>
<p>egenmore</p>
<ul>
<li>Menos conocida es la colección de funciones adicionales de <code>egen</code> hechas por <a href="https://www.durham.ac.uk/staff/n-j-cox/">Nicholas J. Cox.</a>
</li>
<li>Estas funciones están contenidas en el comando <code>egenmore</code>.</li>
<li>
<code>bom()</code> y <code>eom()</code> crean variables de fechas que corresponde al primer y último día de un mes determinado.</li>
<li>
<code>corr()</code> calcula correlaciones y covarianzas mientras que <code><a href="https://rdrr.io/r/stats/cor.html">var()</a></code> calcular la varianza.</li>
<li>
<code>semean()</code> calcula la desviación estándar del error de una media.</li>
<li>
<code>record()</code> permite calcular el valor más alto o más bajo de una serie.</li>
</ul>
<div class="sourceCode" id="cb54"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb54-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb54-1" aria-hidden="true" tabindex="-1"></a>* Ejemplo 1: Generar <span class="kw">variable</span> que tenga la primera palabra <span class="kw">de</span> una frase (wordof)</span>
<span id="cb54-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> firstword = wordof(make),  <span class="fu">word</span>(1)</span>
<span id="cb54-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="ot">list</span> firstword make <span class="kw">in</span>  1/15</span>
<span id="cb54-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb54-5" aria-hidden="true" tabindex="-1"></a>* Ejemplo 2: Para generar automáticamente valores extremos (outside, 1,5 RIQ)</span>
<span id="cb54-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span>    extrmpg = outside(mpg)</span>
<span id="cb54-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="kw">tab</span> extrmpg,    <span class="fu">missing</span></span></code></pre></div>
<p><code>rall()</code> y <code>rany()</code> son útiles para el análisis de datos. Evaluan una condición y genera un indicador si todas o alguna observación la cumple.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb55-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="kw">obs</span> 12</span>
<span id="cb55-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> a = 1 <span class="kw">in</span> 1 </span>
<span id="cb55-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> b = 2 <span class="kw">in</span> 2/4</span>
<span id="cb55-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> c  = -3  <span class="kw">in</span> 5/7</span>
<span id="cb55-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> <span class="kw">d</span> = 4  <span class="kw">in</span> 8/10</span>
<span id="cb55-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> <span class="fu">e</span> = . <span class="kw">in</span> 11/12</span>
<span id="cb55-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> any = rany(a b c <span class="kw">d</span> <span class="fu">e</span>) , c(@ &gt; 0 &amp; !<span class="fu">missing</span>(@))</span>
<span id="cb55-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb55-8" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> <span class="ot">all</span> = rall(a b c <span class="kw">d</span> <span class="fu">e</span>) , c(@ &gt; 0 &amp; !<span class="fu">missing</span>(@)) </span></code></pre></div>
</div>
</div>
<div id="macros-locales-y-globales" class="section level3" number="2.2.3">
<h3>
<span class="header-section-number">2.2.3</span> Macros locales y globales<a class="anchor" aria-label="anchor" href="#macros-locales-y-globales"><i class="fas fa-link"></i></a>
</h3>
<div id="nombrar-macros" class="section level4" number="2.2.3.1">
<h4>
<span class="header-section-number">2.2.3.1</span> Nombrar macros<a class="anchor" aria-label="anchor" href="#nombrar-macros"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Una macro es un <strong>contenedor</strong> que puede almacenar números o nombres de variables.</li>
<li>Puede ser <code>local</code> o <code>global</code>. La primera es temporal, la segunda no.<br>
</li>
<li>Un ejemplo de variable local es:</li>
</ul>
<div class="sourceCode" id="cb56"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb56-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> NivelEstres Nada Medio Moderado Severo </span>
<span id="cb56-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"Los niveles de estrés son: `NivelEstres'"</span></span></code></pre></div>
<p>El primer comando define la macro y sus valores. Para llamar a la macro hay que utilizar las comillas (“). <code>local nombre texto</code> <span class="math inline">\(\rightarrow\)</span> <code>local nombre = text</code> <span class="math inline">\(\rightarrow\)</span> <code>local nombre = "text"</code>.</p>
<p>Ojo con las rutas:</p>
<ul>
<li>En ocasiones voy a querer utilizar una macro dentro de la ruta de una carpeta.</li>
<li>Es importante utilizar siempre <code>/</code> o bien <code>\\</code>. De otra forma no lo reconocerá.</li>
</ul>
<div class="sourceCode" id="cb57"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb57-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> filename base.dta </span>
<span id="cb57-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="st">"H:\ECStata\`filename'"</span></span>
<span id="cb57-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="fu">r</span>(601);</span>
<span id="cb57-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb57-4" aria-hidden="true" tabindex="-1"></a>* Para corregir <span class="fu">el</span> <span class="kw">error</span>, dos caminos: </span>
<span id="cb57-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="st">"H:\ECStata</span><span class="ch">\\</span><span class="st">`filename'"</span> </span>
<span id="cb57-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="st">"H:/ECStata/`filename'"</span></span></code></pre></div>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.3.4:</b> Compare los siguientes comandos y comente las diferencias:</p>
<ul>
<li><code>display "Dos mas dos = 2 + 2"</code></li>
<li>
<code>display "Dos mas dos</code>= 2 + 2’“`</li>
</ul>
</div>
<p>Ojo con el signo igual: Algunas veces es bueno colocar un signo <span class="math inline">\(=\)</span> al definir macros. Por ejemplo, cuando redefinimos variables.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb58-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> contador 0</span>
<span id="cb58-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> NivelEstres Nada Medio Moderado Severo </span>
<span id="cb58-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> a <span class="kw">of</span> <span class="kw">local</span> NivelEstres { </span>
<span id="cb58-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> contador = <span class="ot">`contador'</span> + 1 </span>
<span id="cb58-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"Nivel de Estres `contador' : `a'"</span></span>
<span id="cb58-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb58-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>La primera parte sirve para definir la <code>macro</code> mientras que la segunda sirve para dar cuenta de su valor actual. Al actualizar, ocupen igual.</p>
<p>Sin signo igual: En algunas ocasiones queremos escribir una <code>macro</code> dentro de un <em>loop</em>. En estos casos es conveniente evitar el signo igual.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb59-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> contador 0</span>
<span id="cb59-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> NivelEstres Nada Medio Moderado Severo </span>
<span id="cb59-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> a <span class="kw">of</span> <span class="kw">local</span> NivelEstres {</span>
<span id="cb59-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> contador = <span class="ot">`contador'</span> + 1 </span>
<span id="cb59-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> nuevalista <span class="ot">`nuevalista'</span> <span class="ot">`contador'</span> 'a' </span>
<span id="cb59-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb59-6" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb59-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"`nuevalista'"</span> </span></code></pre></div>
<p>El <code>local nuevalista</code> define una macro como <em>string</em> que posee su propio contenido, el valor de contar y el valor del iterador.</p>
</div>
<div id="generar-variables-contadores-y-condiciones-con-macros" class="section level4" number="2.2.3.2">
<h4>
<span class="header-section-number">2.2.3.2</span> Generar variables, contadores y condiciones con macros<a class="anchor" aria-label="anchor" href="#generar-variables-contadores-y-condiciones-con-macros"><i class="fas fa-link"></i></a>
</h4>
<p>Podemos utilizar macros para renombrar variables.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb60-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span> </span>
<span id="cb60-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> a = 10/20{ </span>
<span id="cb60-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> v<span class="ot">`a'</span> = rnormal()</span>
<span id="cb60-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb60-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb60-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb60-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb60-6" aria-hidden="true" tabindex="-1"></a>* Renombramos variables </span>
<span id="cb60-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> i = 11/15 { </span>
<span id="cb60-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb60-8" aria-hidden="true" tabindex="-1"></a><span class="kw">rename</span> v<span class="ot">`i'</span> x<span class="ot">`=1960 + `i'</span>'</span>
<span id="cb60-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb60-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>En este fragmento de código, Stata evalúa la expresión <code>1960 + 'i'</code> antes de evaluar la macro externa. Por ejemplo, cuando pase por el iterador <code>i = 11</code>, el nuevo nombre de la variable será <code>x1971</code>.</p>
<p>Resumir condiciones: Podemos utilizar macros para resumir condiciones. Esto es útil para estimar modelos o generar estadística descriptiva.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb61-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span> </span>
<span id="cb61-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto </span>
<span id="cb61-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="fu">cond</span> <span class="st">"if foreign==0"</span></span>
<span id="cb61-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="kw">varlist</span> <span class="st">"mpg rep78 trunk weight turn"</span></span>
<span id="cb61-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb61-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb61-6" aria-hidden="true" tabindex="-1"></a>* Estimar la regresión considerando la condicíòn</span>
<span id="cb61-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> price <span class="ot">`varlist'</span> <span class="ot">`cond'</span></span></code></pre></div>
<p>Agrupar en base a una condición: Imaginemos que ahora queremos estimar una regresión para todas las compañías de auto que empiezan empiezan con B.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb62-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> autoname B </span>
<span id="cb62-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> price mpg <span class="kw">weight</span> <span class="kw">if</span> <span class="fu">substr</span>(make,1,1)==<span class="st">"`autoname'"</span></span></code></pre></div>
<p>La mejor manera de pensar en esto es hacer lo que hace Stata: reemplazar <code>"ctyname"</code> por su contenido <code>substr(país,1,1)=="</code>ctyname’“<code>. Al hacerlo, se convierte en</code>substr(país,1,1)==”B”<code>. Si se omiten las comillas dobles, se obtiene</code>substr(country,1,1)==B`, lo que da lugar a un error.</p>
<p>Contadores: Las macros también pueden ser útiles para contadores.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb63-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb63-1" aria-hidden="true" tabindex="-1"></a>* Para adelante</span>
<span id="cb63-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> i = 1 </span>
<span id="cb63-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> ++i </span>
<span id="cb63-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="kw">di</span> <span class="ot">`i'</span> </span>
<span id="cb63-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb63-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb63-6" aria-hidden="true" tabindex="-1"></a>* Para atrás</span>
<span id="cb63-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> i = 1</span>
<span id="cb63-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb63-8" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> --i </span>
<span id="cb63-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb63-9" aria-hidden="true" tabindex="-1"></a><span class="kw">di</span> <span class="ot">`i'</span> </span></code></pre></div>
<p>Muy útil para hacer gráficos o guardar datos en matrices.</p>
<p>Utilizar una macro para estimar regresiones: Imaginen que desean estimar regresiones sobre un conjunto de variables donde una parte de este conjunto esta fija y la otra parte es variable.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb64-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> rhs mpg <span class="kw">weight</span></span>
<span id="cb64-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> price <span class="ot">`rhs'</span> <span class="kw">if</span> foreign == 0 </span>
<span id="cb64-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> rhs <span class="st">"`rhs' headroom trunk"</span>  </span>
<span id="cb64-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> price <span class="ot">`rhs'</span> <span class="kw">if</span> foreign == 0 </span></code></pre></div>
<p>¿Qué ocurre si queremos hacerlo por separado? ¿Uno a uno?</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb65-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> rhs <span class="st">"mpg weight \`add_var'"</span> </span>
<span id="cb65-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> add_var <span class="st">"headroom"</span></span>
<span id="cb65-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> price <span class="ot">`rhs'</span> <span class="kw">if</span> foreign == 0  </span>
<span id="cb65-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> add_var <span class="st">"trunk"</span> </span>
<span id="cb65-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> price <span class="ot">`rhs'</span> <span class="kw">if</span> foreign == 0  </span>
<span id="cb65-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> add_var <span class="st">"turn"</span> </span>
<span id="cb65-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb65-7" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> price <span class="ot">`rhs'</span> <span class="kw">if</span> foreign == 0  </span></code></pre></div>
<p>Lo que ocurre cuando hacemos referencia a una macro es que su valor se introduce en ese punto. El uso de una barra invertida en su lugar hace que se introduzca la referencia de la macro, es decir, no se sustituirá el valor de <code>add_var</code> sino el término `<code>add_var'</code>. Así que cada vez que llamamos a la local <code>rhs</code> el valor actual de el local <code>add_var</code> es sustituido.</p>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.3.5: </b></p>
<p>Instrucciones</p>
<ol style="list-style-type: decimal">
<li>Cargar la base <code>auto.dta</code>
</li>
</ol>
<p>Preguntas</p>
<ol style="list-style-type: decimal">
<li><p>Defina una variable macro llamada <code>control</code> que contenga <code>mpg</code>, <code>rep78</code> y <code>headroom</code>. Estime una regresión entre <code>price</code> y <code>control</code> para vehículos extranjeros y de nuevo para vehículos domésticos.</p></li>
<li><p>Ejecute <code>summarize mpg</code> junto con <code>return list</code>. Defina dos macros <code>display</code> <code>local mean1 r(mean)</code> y <code>local mean2 = r(mean)</code>. ¿Son iguales?</p></li>
</ol>
</div>
</div>
<div id="globales" class="section level4" number="2.2.3.3">
<h4>
<span class="header-section-number">2.2.3.3</span> Globales<a class="anchor" aria-label="anchor" href="#globales"><i class="fas fa-link"></i></a>
</h4>
<p>Crear macros globales</p>
<ul>
<li>Se crean con el comando <code>global</code>.</li>
<li>Útiles para fijar directorios o programas.</li>
<li>En otros casos es mejor utilizar <code>local</code>.</li>
</ul>
<div class="sourceCode" id="cb66"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb66-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb66-1" aria-hidden="true" tabindex="-1"></a>* Para generarla </span>
<span id="cb66-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="kw">global</span> <span class="kw">variable</span></span>
<span id="cb66-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb66-4" aria-hidden="true" tabindex="-1"></a>* En caso <span class="kw">de</span> querer llamarla</span>
<span id="cb66-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="ot">$variable</span></span></code></pre></div>
</div>
<div id="funciones-extendidas-de-macros" class="section level4" number="2.2.3.4">
<h4>
<span class="header-section-number">2.2.3.4</span> Funciones extendidas de macros<a class="anchor" aria-label="anchor" href="#funciones-extendidas-de-macros"><i class="fas fa-link"></i></a>
</h4>
<p>¿Qué son las funciones de macros extendidas?</p>
<ul>
<li>Stata también define ciertas macro. Estas se denominan <em>extended macro functions</em> o macros extendidas.</li>
<li>En algunos casos contienen información sobre tu sistema operativo, sobre la última estimación que se realizo o sobre la base de datos.</li>
<li>El <code>help extended_fcn</code> y la documentación que la acompaña proporcionan una descripción completa de la sintaxis de cada función de macro extendida (hay muchas). Muchas tienen ligeras variaciones de sintaxis entre ellas (por ejemplo, algunas requieren que las macros estén entre comillas dobles; otras no lo permiten).</li>
</ul>
<div class="sourceCode" id="cb67"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb67-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb67-1" aria-hidden="true" tabindex="-1"></a>* La sintaxis general es: </span>
<span id="cb67-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> nombremacro: función <span class="kw">macro</span> extendida</span></code></pre></div>
<p>Mirar labels</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb68-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb68-1" aria-hidden="true" tabindex="-1"></a>* Para mirar los labels <span class="kw">de</span> trunk</span>
<span id="cb68-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto, <span class="kw">clear</span></span>
<span id="cb68-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> tlab : <span class="kw">variable</span> <span class="kw">label</span> trunk </span>
<span id="cb68-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"`tlab'"</span></span></code></pre></div>
<p><code>variable label</code> recupera el nombre asignado a una variable.</p>
<p>Contar dentro de un local</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb69-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb69-1" aria-hidden="true" tabindex="-1"></a>* Para contar dentro <span class="kw">de</span> un <span class="kw">local</span></span>
<span id="cb69-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> NivelEstres Nada Medio Moderado Severo </span>
<span id="cb69-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> wds: <span class="fu">word</span> <span class="fu">count</span> <span class="ot">`NivelEstres'</span> </span>
<span id="cb69-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"Hay `wds' niveles de estres:"</span></span>
<span id="cb69-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb69-5" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> i = 1/<span class="ot">`wds'</span> {</span>
<span id="cb69-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb69-6" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> wd: <span class="fu">word</span> <span class="ot">`i'</span> <span class="kw">of</span> <span class="ot">`NivelEstres'</span></span>
<span id="cb69-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb69-7" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"Nivel `i' is `wd'"</span></span>
<span id="cb69-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb69-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><code>word count</code> y <code>word</code> como funciones de extensión que operan sobre <em>strings</em>.</p>
<p>Conocer tipos de datos</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb70-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb70-1" aria-hidden="true" tabindex="-1"></a>* Para conocer tipos <span class="kw">de</span> datos</span>
<span id="cb70-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto, <span class="kw">clear</span></span>
<span id="cb70-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> stortype : <span class="dv">type</span> make </span>
<span id="cb70-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"`stortype'"</span></span></code></pre></div>
<p>Ojos con las comillas dobles (nuevamente): Algunas veces las macros contienen comillas dobles. Para poder escribirlos sin errores es necesario modificar levemente la forma en que se llama a la variable <code>local</code></p>
<div class="sourceCode" id="cb71"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb71-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb71-1" aria-hidden="true" tabindex="-1"></a>* Con <span class="kw">error</span> </span>
<span id="cb71-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> answers yes no <span class="st">"do not know"</span> </span>
<span id="cb71-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"`answers'"</span></span>
<span id="cb71-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb71-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb71-5" aria-hidden="true" tabindex="-1"></a>* Sin <span class="kw">error</span> </span>
<span id="cb71-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb71-6" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> answers yes no <span class="st">"do not know"</span> </span>
<span id="cb71-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb71-7" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">`"</span><span class="ot">`answers'</span><span class="st">"'</span></span></code></pre></div>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.3.6: </b></p>
<p>Preguntas</p>
<ol style="list-style-type: decimal">
<li>Use una macro extendida para mostrar el tipo de dato (ej. <code>int</code>, <code>float</code>, <code>long</code>,…) de <code>mpg</code>. Revise el <code>help</code> de <code>extended_fcn</code>.</li>
<li>Use una macro extendida para retornar el valor del label asociado a <code>foreign</code> cuando es igual a 1.</li>
<li>Use una macro extendida para mostrar solo la primera variable de `<code>controls'</code>.</li>
<li>Utilice una función extendida de macros para mostrar todos los archivos de su directorio actual (sugerencia: utilice comillas compuestas cuando muestre los nombres de los archivos).</li>
</ol>
</div>
</div>
<div id="funciones-de-macro-extendidas-para-listas" class="section level4" number="2.2.3.5">
<h4>
<span class="header-section-number">2.2.3.5</span> Funciones de macro extendidas para listas<a class="anchor" aria-label="anchor" href="#funciones-de-macro-extendidas-para-listas"><i class="fas fa-link"></i></a>
</h4>
<p>Stata también define ciertas macro para operar sobre listas. Estas funciones permiten combinar listas, buscar elementos dentro de una lista o bien buscar elementos comunes entre dos listas. Conveniente revisar <code>help macrolist</code> para más funciones.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb72-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb72-1" aria-hidden="true" tabindex="-1"></a>* Sintaxis: </span>
<span id="cb72-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> nombre <span class="kw">macro</span>: <span class="ot">list</span> función</span>
<span id="cb72-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb72-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb72-4" aria-hidden="true" tabindex="-1"></a>* Ejemplo <span class="kw">de</span> lista</span>
<span id="cb72-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> animales <span class="st">"gato perro gato loro loro"</span> </span>
<span id="cb72-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb72-6" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> uniqanimales : <span class="ot">list</span> uniq animales </span>
<span id="cb72-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"`uniqanimales'"</span></span></code></pre></div>
<p>Función levelsof: El comando <code>levelsof</code> lista los valores distintos de una variable. Al agregar la opción <code>local(nombremacro)</code> esto se guardara como una macro.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb73-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb73-1" aria-hidden="true" tabindex="-1"></a>* Sintaxis básica</span>
<span id="cb73-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto, <span class="kw">clear</span></span>
<span id="cb73-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="kw">levelsof</span> rep78 </span>
<span id="cb73-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"`r(levels)'"</span></span>
<span id="cb73-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb73-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb73-6" aria-hidden="true" tabindex="-1"></a>* Sintaxis cuando hay variables categóricas.</span>
<span id="cb73-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb73-7" aria-hidden="true" tabindex="-1"></a><span class="kw">levelsof</span> foreign, <span class="kw">local</span>(<span class="kw">levels</span>)</span>
<span id="cb73-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb73-8" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> <span class="ot">l</span> <span class="kw">of</span> <span class="kw">local</span> <span class="kw">levels</span> {</span>
<span id="cb73-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb73-9" aria-hidden="true" tabindex="-1"></a><span class="kw">di</span> <span class="st">"-&gt; foreign = `: label (foreign) `l''"</span></span>
<span id="cb73-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb73-10" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> price mpg <span class="kw">if</span> foreign == <span class="ot">`l'</span></span>
<span id="cb73-11"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb73-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="manipulación-de-locales-vía-listas-de-macros" class="section level4" number="2.2.3.6">
<h4>
<span class="header-section-number">2.2.3.6</span> Manipulación de locales vía listas de macros<a class="anchor" aria-label="anchor" href="#manipulaci%C3%B3n-de-locales-v%C3%ADa-listas-de-macros"><i class="fas fa-link"></i></a>
</h4>
<p>Listas de macros: Las <code>macro lists</code> permiten obtener el número de elementos de una macro, trabajar con valores duplicados, ordenar elementos. Veremos cuatro aplicaciones:</p>
<ol style="list-style-type: decimal">
<li>Elementos duplicados.</li>
<li>Agregar y remover elementos.</li>
<li>Uniones e intersecciones.</li>
<li>Ordenar elementos.</li>
</ol>
<p>Elementos duplicados: <code>dups</code> extrae todos los elementos sobrantes.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb74-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb74-1" aria-hidden="true" tabindex="-1"></a>* Deja solo los unicos</span>
<span id="cb74-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> fib 0 1 1 2 3</span>
<span id="cb74-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> fib_nodups : <span class="ot">list</span> uniq fib</span>
<span id="cb74-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"`fib_nodups'"</span></span>
<span id="cb74-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb74-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb74-6" aria-hidden="true" tabindex="-1"></a>* Quita todo los duplicados</span>
<span id="cb74-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb74-7" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> fib 0 1 1 2 3</span>
<span id="cb74-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb74-8" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> fib_dups : <span class="ot">list</span> dups fib</span>
<span id="cb74-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb74-9" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"`fib_dups'"</span></span></code></pre></div>
<p>Agregar y remover elementos: Es básicamente pegar elementos de una macro con otra. Definamos dos variables locales: <code>vars</code> y <code>coef</code> y peguémoslos.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb75-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> vars x <span class="fu">y</span> z </span>
<span id="cb75-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> coefs a b c </span>
<span id="cb75-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> vars_coefs <span class="ot">`vars'</span> <span class="ot">`coefs'</span></span>
<span id="cb75-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"`vars_coefs'"</span></span></code></pre></div>
<p>Para remover tenemos que definir un nuevo local con los elementos que queremos quitar y sustraerlo del original. Supongamos que queremos actualizar el contenido de <code>vars</code> eliminado “y”.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb76-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="kw">not</span> <span class="fu">y</span></span>
<span id="cb76-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> vars : <span class="ot">list</span> vars - <span class="kw">not</span></span>
<span id="cb76-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"`vars'"</span></span></code></pre></div>
<p>Unión de elementos: Podemos pegar todos los elementos diferentes entre dos listas.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb77-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> A house tree car</span>
<span id="cb77-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> B computer car bike</span>
<span id="cb77-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> all_things : <span class="ot">list</span> A | B</span>
<span id="cb77-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"`all_things'"</span></span></code></pre></div>
<p>Noten que los elementos de <code>car</code> no fueron pegados. Notar que esto es distinto a simplemente pegar macros entre sí.</p>
<p>Intersección de elementos: Podemos hacer la intersección entre dos elementos de una lista. Esto corresponde a los elementos que pertenecen a ambas macros.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb78-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> A house tree car</span>
<span id="cb78-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> B computer car bike</span>
<span id="cb78-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> common_things : <span class="ot">list</span> A &amp; B</span>
<span id="cb78-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"`common_things'"</span></span></code></pre></div>
<p>Noten que en este caso solo <code>car</code> se mantiene.</p>
<p>Ordenar elementos: En ocasiones queremos ordenar los elementos de una lista contenida en una macro.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb79-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> names camila camilo pedro paula</span>
<span id="cb79-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> names : <span class="ot">list</span> <span class="kw">sort</span> names</span>
<span id="cb79-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"`names'"</span></span></code></pre></div>
<p>Para hacer que los elementos de una macro se ordenen aleatoriamente es conveniente utilizar mata</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb80-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> nums 1 2 3 4 5</span>
<span id="cb80-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> : st_local(<span class="st">"random_nums"</span>, <span class="co">///</span></span>
<span id="cb80-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb80-3" aria-hidden="true" tabindex="-1"></a>invtokens(<span class="kw">jumble</span>(tokens(st_local(<span class="st">"nums"</span>))')'))</span>
<span id="cb80-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"`random_nums'"</span></span></code></pre></div>
</div>
<div id="creturn" class="section level4" number="2.2.3.7">
<h4>
<span class="header-section-number">2.2.3.7</span> creturn<a class="anchor" aria-label="anchor" href="#creturn"><i class="fas fa-link"></i></a>
</h4>
<p>Macros con creturn</p>
<ul>
<li>En algunos casos al utilizar <code>local</code> o <code>global</code> vamos a querer fijar algunos parámetros.</li>
<li>Para este propósito utilizar <code>creturn</code>. Algunos ejemplos son: <code>c(current_date)</code>, <code>c(pwd)</code>, <code>c(current_time)</code>, <code>c(stata_version)</code>, <code>c(pi)</code>, <code>c(alpha)</code>, <code>c(Wdays)</code>.</li>
</ul>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.3.7: </b></p>
<p>Preguntas</p>
<ol style="list-style-type: decimal">
<li>Define una macro llamada comestibles con peras, manzanas, fresas, yogur, vino y queso en ella. Ponla en orden alfabético.</li>
<li>Define una macro llamada unión que contenga los miembros de la macro <em>animales</em> y <em>comestibles</em> y luego utiliza una función de lista extendida de la macro para mostrar el número de palabras que contiene.</li>
<li>Ordena <em>unión</em> y muestra la posición de la palabra “vino” utilizando una función de lista extendida de macros.</li>
</ol>
</div>
</div>
</div>
</div>
<div id="programar-do---files-parte-ii" class="section level2" number="2.3">
<h2>
<span class="header-section-number">2.3</span> Programar do - files (Parte II)<a class="anchor" aria-label="anchor" href="#programar-do---files-parte-ii"><i class="fas fa-link"></i></a>
</h2>
<div id="estructuras-de-datos" class="section level3" number="2.3.1">
<h3>
<span class="header-section-number">2.3.1</span> Estructuras de datos<a class="anchor" aria-label="anchor" href="#estructuras-de-datos"><i class="fas fa-link"></i></a>
</h3>
<div id="escalares" class="section level4" number="2.3.1.1">
<h4>
<span class="header-section-number">2.3.1.1</span> Escalares<a class="anchor" aria-label="anchor" href="#escalares"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Los escalares pueden contener valores numéricos o <em>strings</em>. Un escalar solo puede contener un valor.</li>
<li>La sintaxis para generar un escalar es <code>scalar scalar_name = exp</code>.</li>
</ul>
<div class="sourceCode" id="cb81"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb81-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="kw">quietly</span>: <span class="kw">summarize</span> mpg </span>
<span id="cb81-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="fu">scalar</span> mean_mpg = <span class="fu">r</span>(<span class="kw">mean</span>)</span>
<span id="cb81-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="kw">quietly</span>: <span class="kw">summarize</span> rep78</span>
<span id="cb81-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="fu">scalar</span> mean_rep78 = <span class="fu">r</span>(<span class="kw">mean</span>)</span>
<span id="cb81-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"r(mean) guarda el promedio de rep78: "</span> <span class="fu">r</span>(<span class="kw">mean</span>) </span>
<span id="cb81-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb81-6" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"Pero tambien podemos recuperarlo:"</span> mean_mpg</span></code></pre></div>
<p>Para utilizar un escalar en una operación solo es necesario llamarlo por su nombre. Para listar el contenido de todos los escalares <code>scalar list</code>. Para borrar <code>scalar drop scalar_name</code> o si quiero eliminar todo <code>scalar drop _all</code>. Los escalares permiten parametrizar un <code>do-file</code>.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb82-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> fem2, <span class="kw">clear</span> </span>
<span id="cb82-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">scalar</span> lb1 = 80 </span>
<span id="cb82-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="fu">scalar</span> ub1 = 88 </span>
<span id="cb82-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="fu">scalar</span> lb2 = 89 </span>
<span id="cb82-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb82-5" aria-hidden="true" tabindex="-1"></a><span class="fu">scalar</span> ub2 = 97 </span>
<span id="cb82-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb82-6" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> i = 1/2 {</span>
<span id="cb82-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb82-7" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="dt">_n</span> <span class="st">"IQ"</span> <span class="st">"lb`i'"</span> <span class="st">"-"</span> <span class="st">"ub`i'"</span> </span>
<span id="cb82-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb82-8" aria-hidden="true" tabindex="-1"></a><span class="kw">tabulate</span> anxiety <span class="kw">if</span> <span class="fu">inrange</span>(iq, lb<span class="ot">`i'</span>, ub<span class="ot">`i'</span>)</span>
<span id="cb82-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb82-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="elementos-y-operaciones-con-matrices" class="section level4" number="2.3.1.2">
<h4>
<span class="header-section-number">2.3.1.2</span> Elementos y operaciones con matrices<a class="anchor" aria-label="anchor" href="#elementos-y-operaciones-con-matrices"><i class="fas fa-link"></i></a>
</h4>
<p>Stata puede generar matrices.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb83-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> <span class="kw">weight</span> age age2</span>
<span id="cb83-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> b = <span class="fu">e</span>(b)</span>
<span id="cb83-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> <span class="ot">list</span> b</span>
<span id="cb83-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> <span class="kw">V</span> = <span class="fu">e</span>(<span class="kw">V</span>)</span>
<span id="cb83-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb83-5" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> <span class="ot">list</span> <span class="kw">V</span></span></code></pre></div>
<p>Las matrices son muy importantes para guardar resultados y exportarlos de forma conveniente. También son útiles para cuando se quieren hacer estimaciones de muchos parámetros y para distintos conjuntos de datos.</p>
<p>Operaciones con matrices: Se puede operar con matrices. Por ejemplo, sabemos que <span class="math inline">\(b = (X'X)^{-1}X'y\)</span> y que <span class="math inline">\(V = \sigma^{2}(X'X)^{-1}\)</span>. Si queremos extraer solo la matriz <span class="math inline">\(X'y\)</span> tenemos que operar, calculando <span class="math inline">\(\frac{1}{\sigma^{2}}V^{-1}b\)</span>.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb84-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> <span class="kw">define</span> b = <span class="fu">e</span>(b)' </span>
<span id="cb84-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> <span class="kw">define</span> xty = <span class="fu">inv</span>(<span class="kw">V</span>) * b /<span class="fu">e</span>(rmse)^2</span>
<span id="cb84-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> <span class="ot">list</span> xty </span></code></pre></div>
<p><code>e(b)’</code> indica la traspuesta, mientras que <code>inv()</code> es para calcular la matriz inversa.</p>
<p>Llamar a los elementos de una matriz: Se puede acceder a los escalares contenidos en las matrices. Por ejemplo, si queremos obtener los elementos de la matriz <span class="math inline">\(e(b)\)</span> tenemos:</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb85-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"The coefficient on weight is: "</span> _b[<span class="kw">weight</span>] </span>
<span id="cb85-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"Its standard error is: "</span> _se[<span class="kw">weight</span>] </span>
<span id="cb85-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb85-3" aria-hidden="true" tabindex="-1"></a>* Valores predichos </span>
<span id="cb85-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb85-4" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> anxietyhat = _b[<span class="dt">_cons</span>] + _b[<span class="kw">weight</span>] * <span class="kw">weight</span> + <span class="co">/// </span></span>
<span id="cb85-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb85-5" aria-hidden="true" tabindex="-1"></a>_b[age] * age + _b[age2] * age2</span></code></pre></div>
<p>También podemos utilizar las posiciones de los elementos de la matriz (<code>b[i,k)]</code>).</p>
</div>
<div id="funciones" class="section level4" number="2.3.1.3">
<h4>
<span class="header-section-number">2.3.1.3</span> Funciones<a class="anchor" aria-label="anchor" href="#funciones"><i class="fas fa-link"></i></a>
</h4>
<p>Solo disponibles para comandos <code>e-class</code>. Por ejemplo, si estimamos una regresión veremos que la unica función disponible es <code>e(sample)</code>.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb86-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto </span>
<span id="cb86-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="kw">regress</span> mpg <span class="kw">weight</span> <span class="fu">length</span> rep78</span>
<span id="cb86-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="kw">ereturn</span> <span class="ot">list</span></span></code></pre></div>
<p><code>e(sample)</code> nos indica si una determinada observación se utilizó para estimar la regresión. Es decir, es igual a uno si una observación estaba en la muestra de estimación y 0 si fue excluida.</p>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.4.1:</b></p>
<p>Preguntas:</p>
<ol style="list-style-type: decimal">
<li>Estime una regresión de mpg contra weight length rep78 utilizando base de datos auto, pero solo para los autos extranjeros (<code>foreign == 1</code>).</li>
<li>Genere una nueva variable, llamada <code>enmuestra</code> que tome los valores dados por la función <code>e(sample)</code>.</li>
<li>Utilizando <code>br</code>, observe los valores de <code>enmuestra</code>. ¿Qué observa?</li>
<li>Calcule la estadística de <code>mpg</code> solo para las observaciones que fueron incluidas en la regresión.</li>
</ol>
</div>
</div>
</div>
<div id="iteradores" class="section level3" number="2.3.2">
<h3>
<span class="header-section-number">2.3.2</span> Iteradores<a class="anchor" aria-label="anchor" href="#iteradores"><i class="fas fa-link"></i></a>
</h3>
<div id="foreach" class="section level4" number="2.3.2.1">
<h4>
<span class="header-section-number">2.3.2.1</span> Foreach<a class="anchor" aria-label="anchor" href="#foreach"><i class="fas fa-link"></i></a>
</h4>
<p><code>foreach</code> y <code>forvalues</code>: <code>forvalues</code> itera sobre una lista de números y <code>foreach</code> recorre los elementos de una macro, o los nombres de las variables de una lista de variables, o los elementos de una lista de números.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb87-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb87-1" aria-hidden="true" tabindex="-1"></a>* Foreach</span>
<span id="cb87-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> animal <span class="kw">in</span> cats and dogs { </span>
<span id="cb87-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"`animal'"</span></span>
<span id="cb87-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb87-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb87-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb87-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb87-6" aria-hidden="true" tabindex="-1"></a>* Forvalues </span>
<span id="cb87-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb87-7" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> i = 1(1)100 { </span>
<span id="cb87-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb87-8" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> x<span class="ot">`i'</span> = runiform()</span>
<span id="cb87-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb87-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Hay algunas variaciones en <code>foreach</code> según el tipo de lista. La sintaxis es similar a la recien presentada, pero difiere en dos aspectos:</p>
<ul>
<li>
<code>in</code> se remplaza por <code>of</code>.</li>
<li>Hay que llamar al identificador.</li>
<li>Veamos como iterar sobre una lista de <strong>globales y locales</strong>.
\end{itemize}</li>
</ul>
<div class="sourceCode" id="cb88"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb88-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb88-1" aria-hidden="true" tabindex="-1"></a>* Sobre locales <span class="fu">y</span> globales</span>
<span id="cb88-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> money <span class="st">"Franc Dollar Lira Pound"</span> </span>
<span id="cb88-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> currency <span class="kw">of</span> <span class="kw">local</span> money { </span>
<span id="cb88-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"`currency'"</span></span>
<span id="cb88-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb88-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Veamos como iterar sobre una <strong>lista de variables</strong>:</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb89-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb89-1" aria-hidden="true" tabindex="-1"></a>* Sobre lista <span class="kw">de</span> variables</span>
<span id="cb89-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> <span class="kw">var</span> <span class="kw">of</span> <span class="kw">varlist</span> mpg <span class="kw">weight</span>-turn { </span>
<span id="cb89-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="kw">quietly</span> <span class="kw">summarize</span> <span class="ot">`var'</span> <span class="kw">summarize</span> <span class="ot">`var'</span> <span class="kw">if</span> <span class="ot">`var'</span> &gt; <span class="fu">r</span>(<span class="kw">mean</span>)</span>
<span id="cb89-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb89-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Veamos como iterar sobre una <strong>lista de de nuevas variables</strong>:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb90-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb90-1" aria-hidden="true" tabindex="-1"></a>* Sobre lista <span class="kw">de</span> nuevas variables</span>
<span id="cb90-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> <span class="kw">var</span> <span class="kw">of</span> newlist z1-z20 { </span>
<span id="cb90-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> <span class="ot">`var'</span> = runiform()</span>
<span id="cb90-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb90-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Veamos como iterar sobre una <strong>lista de números</strong>:</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb91-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> num <span class="kw">of</span> numlist 1 4/8 13(2)21 103 { </span>
<span id="cb91-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="ot">`num'</span></span>
<span id="cb91-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb91-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="combinar-macros-con-iteradores" class="section level4" number="2.3.2.2">
<h4>
<span class="header-section-number">2.3.2.2</span> Combinar macros con iteradores<a class="anchor" aria-label="anchor" href="#combinar-macros-con-iteradores"><i class="fas fa-link"></i></a>
</h4>
<p><code>foreach</code> y <code>forvalues</code> combinados con macros pueden utilizarse para ahorrarnos mucho trabajo. Podemos generar tun conjunto de locales a partir de iteraciones.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb92-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> replicate.dta, <span class="kw">replace</span></span>
<span id="cb92-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="kw">levelsof</span> cty</span>
<span id="cb92-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> ctries <span class="st">"`r(levels)'"</span> </span>
<span id="cb92-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb92-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb92-5" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> ctr <span class="kw">in</span> <span class="ot">`ctries'</span> { </span>
<span id="cb92-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb92-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">sum</span> hours_t <span class="kw">if</span> cty == <span class="st">"`ctr'"</span> </span>
<span id="cb92-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb92-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">local</span> nombre <span class="ot">`ctr'</span> = <span class="ot">`r(mean)'</span></span>
<span id="cb92-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb92-8" aria-hidden="true" tabindex="-1"></a>} </span></code></pre></div>
<p>Como ya hemos visto, el comando <code>levelsof</code> devuelve una lista de todos los valores distintos de una variable categórica y los guarda en la macro <code>r(levels)</code>. Esto lo hace en el caso de que nosotros no le asignemos un nombre. Podemos utilizar esta lista para los países y años de nuestra muestra para definir dos iteraciones que recorran todos los valores posibles. Para cada valor resumimos la población y definimos una macro local compuesta por el código de país y el año (por ejemplo, USA1990) que toma el valor de la población en ese año para ese país.</p>
<p>Una aplicación del <code>forvalues</code>:</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb93-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> gdp4cty, <span class="kw">clear</span> </span>
<span id="cb93-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> i = 1/4 {</span>
<span id="cb93-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb93-3" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> <span class="kw">double</span> lngdp'i' = <span class="fu">log</span>(gdp'i')</span>
<span id="cb93-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb93-4" aria-hidden="true" tabindex="-1"></a><span class="kw">summarize</span> lngdp'i'</span>
<span id="cb93-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb93-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Utilizando dos <code>forvalues</code>:</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb94-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> <span class="fu">y</span> = 1995(2)1999 {</span>
<span id="cb94-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb94-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">forvalues</span> i = 2(2)4 {</span>
<span id="cb94-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb94-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">summarize</span> gdp<span class="ot">`i'</span>_<span class="ot">`y'</span></span>
<span id="cb94-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb94-4" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb94-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb94-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><code>foreach</code> y <code>recode</code>:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb95-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> gdp4cty, <span class="kw">clear</span> </span>
<span id="cb95-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> ctycode 111 112 136 134 </span>
<span id="cb95-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb95-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> i 0</span>
<span id="cb95-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb95-4" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> c <span class="kw">of</span> <span class="kw">local</span> ctycode{ </span>
<span id="cb95-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb95-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">local</span> ++i </span>
<span id="cb95-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb95-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">local</span> rc <span class="st">"`rc' (`i'=`c')"</span> </span>
<span id="cb95-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb95-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb95-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb95-8" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"`rc'"</span></span>
<span id="cb95-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb95-9" aria-hidden="true" tabindex="-1"></a><span class="kw">recode</span> <span class="kw">cc</span> <span class="ot">`rc'</span>, <span class="kw">gen</span>(newcc)</span></code></pre></div>
<p>Loops anidados: <code>foreach</code> y <code>forvalues</code></p>
<div class="sourceCode" id="cb96"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb96-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> gdp4cty, <span class="kw">clear</span> </span>
<span id="cb96-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> country US UK DE FR </span>
<span id="cb96-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> yrlist 1995 1999 </span>
<span id="cb96-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb96-4" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> i = 1/4 {</span>
<span id="cb96-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb96-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span> cnaine: <span class="fu">word</span> <span class="ot">`i'</span> <span class="kw">of</span> <span class="ot">`country'</span></span>
<span id="cb96-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb96-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="st">"`cnaine'"</span></span>
<span id="cb96-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb96-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="fu">y</span> <span class="kw">of</span> <span class="kw">local</span> yrlist {</span>
<span id="cb96-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb96-8" aria-hidden="true" tabindex="-1"></a>            <span class="kw">rename</span> gdp<span class="ot">`i'</span>_<span class="ot">`y'</span> gdp<span class="ot">`cnaine'</span>_<span class="ot">`y'</span></span>
<span id="cb96-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb96-9" aria-hidden="true" tabindex="-1"></a>    } </span>
<span id="cb96-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb96-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>En estos casos es bueno utilizar espacios para hacer el código más amigable. Ojo que a Stata no le interesa esto para ejecutar, es solo una cuestión de estilo.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb97-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto, <span class="kw">clear</span></span>
<span id="cb97-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> <span class="fu">y</span> <span class="kw">of</span> <span class="kw">varlist</span> mpg rep78 headroom trunk <span class="kw">weight</span> <span class="fu">length</span> { </span>
<span id="cb97-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb97-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> x <span class="kw">of</span> <span class="kw">varlist</span> rep78 price displacement gear_ratio foreign { </span>
<span id="cb97-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb97-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">regress</span> <span class="ot">`y'</span> <span class="ot">`x'</span></span>
<span id="cb97-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb97-5" aria-hidden="true" tabindex="-1"></a>} </span></code></pre></div>
<p>También útil para estimar regresiones.</p>
<p>Tokenize: Podemos almacenar los elementos de la lista de países en macros numeradas con <code>tokenize</code>.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb98-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> gdp4cty, <span class="kw">clear</span></span>
<span id="cb98-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> country US UK DE FR </span>
<span id="cb98-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb98-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> yrlist 1995 1999 </span>
<span id="cb98-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb98-4" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> ncty: <span class="fu">word</span> <span class="fu">count</span> <span class="ot">`country'</span></span>
<span id="cb98-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb98-5" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"`ncty'"</span></span>
<span id="cb98-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb98-6" aria-hidden="true" tabindex="-1"></a><span class="kw">tokenize</span> <span class="ot">`country'</span></span>
<span id="cb98-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb98-7" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> i = 1/<span class="ot">`ncty'</span>{</span>
<span id="cb98-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb98-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="fu">y</span> <span class="kw">of</span> <span class="kw">local</span> yrlist {</span>
<span id="cb98-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb98-9" aria-hidden="true" tabindex="-1"></a>            <span class="kw">rename</span> gdp<span class="ot">`i'</span>_<span class="ot">`y'</span> gdp<span class="ot">``i'</span>'_<span class="ot">`y'</span></span>
<span id="cb98-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb98-10" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb98-11"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb98-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Aquí los nombres de los países se almacenan como valores de las macros numeradas. Debemos referenciar doblemente la macro <span class="math inline">\(i\)</span>. El contenido de esa macro la primera vez que se pasa por el bucle es el número 1. Para acceder al primer código de país, debemos referenciar la macro <span class="math inline">\(`1'\)</span>.</p>
</div>
<div id="while-loop" class="section level4" number="2.3.2.3">
<h4>
<span class="header-section-number">2.3.2.3</span> While loop<a class="anchor" aria-label="anchor" href="#while-loop"><i class="fas fa-link"></i></a>
</h4>
<p>Realiza la iteración o se repite una lista de comandos mientras la condición <code>while</code> sea verdadera. La sintaxis es:</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb99-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="kw">while</span> <span class="fu">exp</span> { </span>
<span id="cb99-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb99-2" aria-hidden="true" tabindex="-1"></a>hace algo</span>
<span id="cb99-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb99-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>¿Cuando es útil? : <strong>Cuando no este seguro(a) cuantas veces se realizará la iteración</strong>. Notar que si no hay convergencia, va iterar infinitamente.</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb100-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="kw">while</span> <span class="fu">reldif</span> (nueva, antigua) &gt; 0.001 { </span>
<span id="cb100-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb100-2" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>También se puede combinar con macros. Es importante utilizar los incrementales:</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb101-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> i=1 </span>
<span id="cb101-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="kw">while</span> <span class="ot">`i'</span>&lt;=5 {</span>
<span id="cb101-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb101-3" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"loop number"</span> <span class="ot">`i'</span> </span>
<span id="cb101-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb101-4" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> i = <span class="ot">`i'</span>+1</span>
<span id="cb101-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb101-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>La primera parte define el inicio del contador, mientras que la segunda indica la condición para que sea ejecutado. El <code>local</code> final actualiza (incremental). Si el incremento es unitario podemos utilizar <code>local ++i</code>.</p>
</div>
<div id="branching" class="section level4" number="2.3.2.4">
<h4>
<span class="header-section-number">2.3.2.4</span> Branching<a class="anchor" aria-label="anchor" href="#branching"><i class="fas fa-link"></i></a>
</h4>
<p>Hacer una cosa en caso de que alguna condición sea cierta y otra cosa en caso de que sea falsa. La sintaxis básica es:</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb102-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> algo es verdadero { </span>
<span id="cb102-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb102-2" aria-hidden="true" tabindex="-1"></a>hacer esto</span>
<span id="cb102-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb102-3" aria-hidden="true" tabindex="-1"></a>} <span class="kw">else</span> {</span>
<span id="cb102-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb102-4" aria-hidden="true" tabindex="-1"></a>hacer lo contrario</span>
<span id="cb102-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb102-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.4.2:</b></p>
<p>Preguntas</p>
<ol style="list-style-type: decimal">
<li>Defina una macro llamada mimacro que sea igual a un número entero aleatorio entre 1 y 99.</li>
<li>Utilizando <code>if</code> y <code>else</code> muestre un mensaje que diga si es par o impar.</li>
</ol>
</div>
</div>
<div id="aplicaciones" class="section level4" number="2.3.2.5">
<h4>
<span class="header-section-number">2.3.2.5</span> Aplicaciones<a class="anchor" aria-label="anchor" href="#aplicaciones"><i class="fas fa-link"></i></a>
</h4>
<p>Seguir secuencias especiales: <code>creturn</code> posee varias constantes y valores a los que se puede acceder. Por ejemplo:</p>
<ul>
<li>
<code>c(filename)</code> nombre del último nombre del archivo guardado.</li>
<li>
<code>c(alpha/ALPHA)</code> lista de letras minúsculas/mayusculas.<br>
</li>
<li>
<code>c(Mons)</code> lista de nombres de los meses abreviados.</li>
<li>
<code>c(Months)</code> lista de los nombres de los meses no abreviados.</li>
<li>
<code>c(Wdays)</code> lista de los dias de la semana abreviados a tres caracteres.</li>
<li>
<code>c(Weekdays)</code> lista de los días de la semana no abreviados.</li>
</ul>
<p>Con un iterador es posible aplicar estas listas para agregar labels. Suponga que tenemos valores de 1 a 12 que representan meses.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb103-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span> <span class="ot">all</span></span>
<span id="cb103-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="kw">obs</span> 12</span>
<span id="cb103-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb103-3" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> <span class="fu">month</span> = <span class="dt">_n</span> </span>
<span id="cb103-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb103-4" aria-hidden="true" tabindex="-1"></a><span class="kw">tokenize</span> <span class="ot">`c(Months)'</span> </span>
<span id="cb103-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb103-5" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> i = 1/12 {</span>
<span id="cb103-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb103-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">label</span> <span class="kw">define</span> monthlab <span class="ot">`i'</span> <span class="st">"``i''"</span> , modify </span>
<span id="cb103-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb103-7" aria-hidden="true" tabindex="-1"></a>                   }</span>
<span id="cb103-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb103-8" aria-hidden="true" tabindex="-1"></a><span class="kw">label</span> val <span class="fu">month</span> monthlab</span></code></pre></div>
</div>
<div id="monitorear-un-loop" class="section level4" number="2.3.2.6">
<h4>
<span class="header-section-number">2.3.2.6</span> Monitorear un loop<a class="anchor" aria-label="anchor" href="#monitorear-un-loop"><i class="fas fa-link"></i></a>
</h4>
<p>Ejemplo proveniente de (Stata tip 41). Cualquier <em>loop</em> puede ser modificado para que muestre su progreso con el comando <code>_dots</code>. Esto es importante para cuando se requieren hacer procesos que toman varias horas y es necesario monitorear avances.</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb104-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="kw">_dots</span> 0, <span class="bn">title</span>(Loop ejecutando) reps(75) </span>
<span id="cb104-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> i = 1/75 { </span>
<span id="cb104-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb104-3" aria-hidden="true" tabindex="-1"></a><span class="kw">_dots</span> ‘i’ 0</span>
<span id="cb104-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb104-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb104-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb104-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb104-6" aria-hidden="true" tabindex="-1"></a>----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5</span>
<span id="cb104-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb104-7" aria-hidden="true" tabindex="-1"></a>..................................................    50</span>
<span id="cb104-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb104-8" aria-hidden="true" tabindex="-1"></a>.........................</span></code></pre></div>
<p>El primer comando <code>_dots</code> establece las lineas. Titulo y número de repeticiones son opcionales. <code>reps</code> solo acepta enteros como argumento. <code>_dots ‘i’ 0</code> tiene dos elementos:</p>
<ul>
<li>El primer argumento es el número de repetición, que registra el número de intentos en curso. En el ejemplo, esta automáticamente determinado por el <em>loop</em>.</li>
<li>El segundo argumento es el código de retorno, el cual indica el tipo de símbolo. En el ejemplo tenemos un 0.</li>
<li>Los códigos de retorno alternativos producen una “s” (-1), “.” (), “x” roja (1), una “e” (2), una “n” (3) o un “?” (cualquier otro valor).</li>
</ul>
<p>Ejemplo no numérico: La idea es definir una macro local para que actue como un contador.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb105-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto</span>
<span id="cb105-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb105-2" aria-hidden="true" tabindex="-1"></a><span class="kw">_dots</span> 0, reps(10)</span>
<span id="cb105-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> <span class="kw">var</span> <span class="kw">of</span> <span class="kw">varlist</span> price - gear_ratio {</span>
<span id="cb105-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb105-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">sum</span> <span class="ot">`var'</span>, <span class="kw">d</span></span>
<span id="cb105-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb105-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">local</span> i = <span class="ot">`i'</span>+1</span>
<span id="cb105-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb105-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">_dots</span> <span class="ot">`i'</span> 0</span>
<span id="cb105-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb105-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Contar repeticiones:</p>
<ul>
<li>El número de repeticiones en <code>rep</code> no es calculado por <code>_dots</code>. Es necesario contar manualmente las variables e introducir el número.</li>
<li>Esto lo vamos a hacer con la ayuda de una función de macro extendida <code>sizeof</code>.</li>
<li>
<code>unab</code> permite ingresar una lista de variable abreviada y expandirla, de forma tal de que la pueda contar.</li>
</ul>
<div class="sourceCode" id="cb106"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb106-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto</span>
<span id="cb106-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb106-2" aria-hidden="true" tabindex="-1"></a><span class="kw">unab</span> myvars : price - gear_ratio</span>
<span id="cb106-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb106-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="kw">N</span> : <span class="ot">list</span> <span class="kw">sizeof</span> myvars</span>
<span id="cb106-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb106-4" aria-hidden="true" tabindex="-1"></a><span class="kw">_dots</span> 0, reps(<span class="ot">`N'</span>)</span>
<span id="cb106-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb106-5" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> <span class="kw">var</span> <span class="kw">of</span> <span class="kw">varlist</span> <span class="ot">`myvars'</span> {</span>
<span id="cb106-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb106-6" aria-hidden="true" tabindex="-1"></a>  ...</span>
<span id="cb106-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb106-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">local</span> i = <span class="ot">`i'</span>+1</span>
<span id="cb106-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb106-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">_dots</span> <span class="ot">`i'</span> 0</span>
<span id="cb106-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb106-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Un ejemplo más complejo es:</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb107-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="kw">noisily</span> <span class="kw">_dots</span> 0, <span class="bn">title</span>(Looping <span class="kw">until</span> 70 successes...) </span>
<span id="cb107-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb107-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> rep 1 </span>
<span id="cb107-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb107-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> nsuccess 0 </span>
<span id="cb107-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb107-4" aria-hidden="true" tabindex="-1"></a><span class="kw">while</span> ‘nsuccess’ &lt; 70 { </span>
<span id="cb107-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb107-5" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> fail = uniform() &lt; .2 </span>
<span id="cb107-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb107-6" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> nsuccess = ‘nsuccess’ + (‘fail’ == 0) </span>
<span id="cb107-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb107-7" aria-hidden="true" tabindex="-1"></a><span class="kw">noisily</span> <span class="kw">_dots</span> ‘rep++’ ‘fail’</span>
<span id="cb107-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb107-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Se ejecuta hasta que logre 70 aciertos. En este ejemplo artificial, cada iteración tiene un éxito aleatorio con una probabilidad del 80%. Los éxitos se indican con un punto (.) y los fracasos con una x.</p>
</div>
</div>
<div id="manejo-de-bases-de-datos" class="section level3" number="2.3.3">
<h3>
<span class="header-section-number">2.3.3</span> Manejo de bases de datos<a class="anchor" aria-label="anchor" href="#manejo-de-bases-de-datos"><i class="fas fa-link"></i></a>
</h3>
<div id="prefijo-by" class="section level4" number="2.3.3.1">
<h4>
<span class="header-section-number">2.3.3.1</span> Prefijo: by<a class="anchor" aria-label="anchor" href="#prefijo-by"><i class="fas fa-link"></i></a>
</h4>
<p>Los prefijos en Stata ejecutan tareas repetitivas sin la necesidad de especificar el rango de valores sobre la tarea que es ejecutada. Un prefijo muy conocido es <code>by</code>. Por ejemplo, <code>by varlist [, sort]: command</code>. <code>command</code> es repetido para cada valor de la variable. Es más, repeticiones siguen el orden de la variable sea <em>string</em> o <em>numeric</em>.</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb108-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> bpress, <span class="kw">clear</span></span>
<span id="cb108-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="kw">bysort</span> sex agegrp: <span class="kw">summarize</span> bp </span></code></pre></div>
</div>
<div id="prefijo-xi" class="section level4" number="2.3.3.2">
<h4>
<span class="header-section-number">2.3.3.2</span> Prefijo: xi<a class="anchor" aria-label="anchor" href="#prefijo-xi"><i class="fas fa-link"></i></a>
</h4>
<p><code>xi</code> es útil para cuando queremos producir un variable indicador para las observaciones que son distintas entre si.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb109-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="kw">xi</span> i.agegrp</span></code></pre></div>
<p>El ejemplo le esta diciendo a Stata que genere variables indicadores. Esto es muy útil para reducir los códigos.</p>
<p>Interpretando prefijo xi: <code>xi</code> es comúnmente utilizado como un prefijo. La principal ventaja es cuando existen múltiples interacciones entre las variables.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb110-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb110-1" aria-hidden="true" tabindex="-1"></a>* Caso 1: incluye indicadores <span class="kw">de</span> ambas variables.</span>
<span id="cb110-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="kw">xi</span>: <span class="kw">regress</span> bp i.agegrp i.sex</span>
<span id="cb110-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb110-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb110-4" aria-hidden="true" tabindex="-1"></a>* Caso 2: incluye además interacciones entre ellas.</span>
<span id="cb110-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb110-5" aria-hidden="true" tabindex="-1"></a><span class="kw">xi</span>: <span class="kw">regress</span> bp i.agegrp*i.sex</span>
<span id="cb110-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb110-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb110-7" aria-hidden="true" tabindex="-1"></a>* Caso 3: Interactúa una <span class="kw">variable</span> continua con una discreta.</span>
<span id="cb110-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb110-8" aria-hidden="true" tabindex="-1"></a><span class="kw">xi</span>: <span class="kw">regress</span> bp i.agegrp*bp0</span>
<span id="cb110-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb110-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb110-10" aria-hidden="true" tabindex="-1"></a>* Caso 4: Incluye solo interacciones con <span class="kw">variable</span> continua (además <span class="kw">de</span> principal). </span>
<span id="cb110-11"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb110-11" aria-hidden="true" tabindex="-1"></a><span class="kw">xi</span>: <span class="kw">regress</span> bp i.agegrp|bp0 </span></code></pre></div>
</div>
<div id="prefijo-statsby" class="section level4" number="2.3.3.3">
<h4>
<span class="header-section-number">2.3.3.3</span> Prefijo: statsby<a class="anchor" aria-label="anchor" href="#prefijo-statsby"><i class="fas fa-link"></i></a>
</h4>
<p><code>statsby</code> permite ampliar <code>by</code>. Este último tiene la limitación de permitir únicamente un comando.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb111-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="kw">statsby</span> <span class="kw">mean</span>=<span class="fu">r</span>(<span class="kw">mean</span>) <span class="fu">sd</span>=<span class="fu">r</span>(<span class="fu">sd</span>) n=<span class="fu">r</span>(<span class="kw">N</span>), <span class="kw">by</span>(agegrp sex): <span class="kw">summarize</span> bp</span></code></pre></div>
<p>Se produce una nueva base de datos con una observación por grupo con los estadísticos incorporados. <strong>Útil para calcular estadística descriptiva</strong>.</p>
</div>
<div id="prefijo-rolling" class="section level4" number="2.3.3.4">
<h4>
<span class="header-section-number">2.3.3.4</span> Prefijo: rolling<a class="anchor" aria-label="anchor" href="#prefijo-rolling"><i class="fas fa-link"></i></a>
</h4>
<p><code>statsby</code> permite obtener estadísticas para sub-muestras que no se traslapan. <code>rolling</code> sirve para sub-muestras traslapadas. Por ejemplo, al trabajar con series de tiempo se quiere calcular estadísticas para datos que están traslapados (el. calcular una media móvil).</p>
<p>Vamos a calcular medias y medianas utilizando una ventana de 90 días:</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb112-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> ibm, <span class="kw">clear</span> </span>
<span id="cb112-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="kw">rolling</span> <span class="kw">mean</span>=<span class="fu">r</span>(<span class="kw">mean</span>) <span class="kw">median</span>=<span class="fu">r</span>(p50), <span class="kw">window</span>(90): <span class="kw">summarize</span> spx, <span class="kw">d</span> </span>
<span id="cb112-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb112-3" aria-hidden="true" tabindex="-1"></a><span class="kw">tsset</span> <span class="kw">end</span> </span>
<span id="cb112-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb112-4" aria-hidden="true" tabindex="-1"></a><span class="kw">tsline</span> <span class="kw">mean</span></span></code></pre></div>
<p><code>start</code> y <code>end</code> indican el inicio y fin de la ventana.</p>
</div>
<div id="merge-y-append" class="section level4" number="2.3.3.5">
<h4>
<span class="header-section-number">2.3.3.5</span> Merge y Append<a class="anchor" aria-label="anchor" href="#merge-y-append"><i class="fas fa-link"></i></a>
</h4>
<p>Recomendaciones para utilizar merge</p>
<ul>
<li>Especifique siempre el tipo de fusión (1:1, m:1 o 1:m). Si no se especifica el tipo de fusión, se llama a la versión antigua y no robusta de la fusión.</li>
<li>Nunca haga fusiones de muchos a muchos (m:m), o al menos, sólo hágalo cuando tenga una muy buena razón.</li>
<li>Incluya siempre la opción <code>assert()</code> para indicar qué patrón de observaciones coincidentes espera.</li>
<li>Incluya siempre la opción <code>keep()</code> para indicar qué observaciones deben conservarse del conjunto de datos fusionados.</li>
<li>Siempre que sea posible, incluya la opción <code>keepusing()</code> y enumere explícitamente qué variables pretende añadir al conjunto de datos; puede incluir esta opción incluso cuando mantenga todas las variables de los datos utilizados.</li>
<li>Utilice la opción <code>nogen</code>, excepto cuando piense utilizar explícitamente la variable <code>_merge</code> más adelante. Nunca debe guardar un conjunto de datos que tenga <code>_merge</code>; si necesita esta variable más adelante, dele un nombre más informativo.</li>
</ul>
<p>Con respecto a especificar <code>_merge</code> y <code>assert</code> notar que:</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb113-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb113-1" aria-hidden="true" tabindex="-1"></a>     <span class="kw">merge</span> ..., <span class="kw">assert</span>(<span class="fu">match</span> master) <span class="kw">keep</span>(<span class="fu">match</span>)</span>
<span id="cb113-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb113-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb113-3" aria-hidden="true" tabindex="-1"></a>     * Es equivalente a: </span>
<span id="cb113-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb113-4" aria-hidden="true" tabindex="-1"></a>     <span class="kw">merge</span> ...</span>
<span id="cb113-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb113-5" aria-hidden="true" tabindex="-1"></a>     <span class="kw">assert</span> <span class="dt">_merge</span>==1 | <span class="dt">_merge</span>==3</span>
<span id="cb113-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb113-6" aria-hidden="true" tabindex="-1"></a>     <span class="kw">keep</span> <span class="kw">if</span> <span class="dt">_merge</span>==3</span></code></pre></div>
<p>Append con ciudado:</p>
<ul>
<li>El comando <code>append</code> es muy útil para manejos de bases de datos. Una precaución común es con respecto al nombre de las variables. Si dos variables (ej. PRECIO y precio) difieren, se generaran dos columnas nuevas al hacer el <code>append</code> en vez de una.</li>
<li>Una precaución un poco menos conocida guarda relación con el tipo de variables. ¿Qué ocurre si dos variables se llaman igual, pero <strong>estan guardadas en formatos distintos</strong>?</li>
<li>En este caso, el orden en el cual se combine la base de datos va a importar y puede generar diferencias al momento de pegar datos. Esto es especialmente importante cuando una variable esta guardada en numérico en una base de datos y en <code>string</code> en la otra.</li>
</ul>
<p>Veamos un ejemplo con la base <code>auto.dta</code>. Vamos a crear dos bases de datos según la procedencia de los autos y ejecutar el comando <code>append</code>.</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb114-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto </span>
<span id="cb114-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb114-2" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> <span class="kw">if</span> foreign</span>
<span id="cb114-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb114-3" aria-hidden="true" tabindex="-1"></a><span class="kw">save</span> autodom </span>
<span id="cb114-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb114-4" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto </span>
<span id="cb114-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb114-5" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> <span class="kw">if</span> !foreign </span>
<span id="cb114-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb114-6" aria-hidden="true" tabindex="-1"></a><span class="kw">rename</span> foreign nondom </span>
<span id="cb114-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb114-7" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> str foreign = <span class="st">"foreign"</span> <span class="kw">if</span> nondom </span>
<span id="cb114-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb114-8" aria-hidden="true" tabindex="-1"></a><span class="kw">save</span> autofor</span>
<span id="cb114-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb114-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb114-10" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> autdom </span>
<span id="cb114-11"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb114-11" aria-hidden="true" tabindex="-1"></a><span class="kw">append</span> <span class="kw">using</span> autofor </span>
<span id="cb114-12"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb114-12" aria-hidden="true" tabindex="-1"></a><span class="kw">describe</span> foreign </span></code></pre></div>
<p>Notar que <code>append</code> genera el siguiente mensaje: <code>foreign is str 7 in using data byt will be byte now</code>. Noten que el contenido de la variable string se ha perdido: 22 casos son ahora <em>missing</em>.</p>
<p>¿Qué ocurre si hacemos el proceso al revés? Vamos a cargar autos extranjeros y le vamos a pegar autos domésticos:</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb115-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> autfor </span>
<span id="cb115-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="kw">append</span> <span class="kw">using</span> autodom, <span class="kw">force</span></span>
<span id="cb115-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb115-3" aria-hidden="true" tabindex="-1"></a><span class="kw">describe</span> foreign </span>
<span id="cb115-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb115-4" aria-hidden="true" tabindex="-1"></a><span class="kw">codebook</span> foreign</span></code></pre></div>
<p>El formato de los datos de la primer base de datos manda.
* No utilizar force sin cuidado.
* Con distintos tipos de datos, <code>append</code> es sensible al orden en que los archivos son pegados. <strong>Tener cuidado y revisar consistencia en los datos</strong>. Hacer test aquí tambíen es importante.</p>
</div>
</div>
</div>
<div id="programar-ado---files-parte-i" class="section level2" number="2.4">
<h2>
<span class="header-section-number">2.4</span> Programar ado - files (Parte I)<a class="anchor" aria-label="anchor" href="#programar-ado---files-parte-i"><i class="fas fa-link"></i></a>
</h2>
<div id="escribir-programas-en-stata" class="section level3" number="2.4.1">
<h3>
<span class="header-section-number">2.4.1</span> Escribir programas en Stata<a class="anchor" aria-label="anchor" href="#escribir-programas-en-stata"><i class="fas fa-link"></i></a>
</h3>
<p>En esta sección aprenderemos a escribir nuestros propios comandos en Stata. Escribir programas en Stata tiene muchas ventajas relacionadas con las buenas practicas que vimos en la Sección 1.</p>
<p>Vamos a utilizar <code>program</code> para escribir los programas. Es posible equipar cualquier comando con las opciones típicas usuales (ej. <code>if</code> o <code>inrange</code>. Discutiremos mayormente programas del tipo <code>r-class</code> y algunos comentarios con respecto a los del tipo <code>e-class</code>.</p>
<p><strong>¿Por qué debiese escribir mis propios programas en Stata?</strong> Automatizar procesos que se ejecutan frecuentemente y donde los resultados dependen de algún tipo de heterogeneidad.</p>
</div>
<div id="por-qué-escribir-programas-abstracción" class="section level3" number="2.4.2">
<h3>
<span class="header-section-number">2.4.2</span> ¿Por qué escribir programas?: Abstracción<a class="anchor" aria-label="anchor" href="#por-qu%C3%A9-escribir-programas-abstracci%C3%B3n"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>Abstraer para eliminar pasos redundantes.<br>
</li>
<li>Abstraer con fines de hacer códigos más claros. <strong>No por otras razones</strong>.</li>
<li>Abstracción es esencial para escribir un buen código por al menos dos razones:
<ul>
<li>Al eliminar la redundancia se reducen las posibilidades de cometer errores.</li>
<li>Aumenta la claridad. Para cualquier lector será más facil leer un código no redundante.</li>
</ul>
</li>
</ul>
<p>Veamos un ejemplo: Supongamos que queremos ver la correlación espacial del consumo de papas fritas. Queremos testear si el consumo per-capita de papas fritas esta correlacionado con el consumo promedio percapita de las otras comunas de la misma región. Primero tenemos que calcular el consumo per-capita del resto:</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb116-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> total_pc_papitas = <span class="kw">total</span>(pc_papitas), <span class="kw">by</span>(region)</span>
<span id="cb116-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb116-2" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> total_obs = <span class="fu">count</span>(pc_papitas), <span class="kw">by</span>(region)</span>
<span id="cb116-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb116-3" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> consumo_papitas_resto_pc = <span class="co">///</span></span>
<span id="cb116-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb116-4" aria-hidden="true" tabindex="-1"></a>(total_pc_papitas - pc_papitas)/(total_obs - 1)</span></code></pre></div>
<p>Ahora podemos ver si existe correlación. ¿Pero si queremos cambiar el nivel de agregación? Tal vez si existe correlación, pero a nivel de área metropolitana. Copiemos el código de nuevo y calculemos esto.</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb117-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> total_pc_papitas = <span class="kw">total</span>(pc_papitas), <span class="kw">by</span>(metroarea)</span>
<span id="cb117-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> total_obs = <span class="fu">count</span>(pc_papitas), <span class="kw">by</span>(region)</span>
<span id="cb117-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb117-3" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> consumo_papitas_restometro_pc = <span class="co">///</span></span>
<span id="cb117-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb117-4" aria-hidden="true" tabindex="-1"></a>(total_pc_papitas - pc_papitas)/(total_obs - 1)</span></code></pre></div>
<p>Noten que hay un error. Se nos olvido remplazar región por <code>metroarea</code>. Este error se puede propagar si seguimos haciendo operaciones. Una alternativa al copiar y pegar es escribir una función con propósito general que calcule la variable que deseamos bajo distintos parámetros.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb118-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> consumo_papitas_resto </span>
<span id="cb118-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb118-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">syntax</span>, invar(varname) outvar(<span class="bn">name</span>) byvar(varname)</span>
<span id="cb118-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb118-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">tempvar</span> tot_invar count_invar </span>
<span id="cb118-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb118-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">egen</span> <span class="ot">`tot_invar'</span> = <span class="kw">total</span>(<span class="ot">`invar'</span>), <span class="kw">by</span>(<span class="ot">`byvar'</span>)</span>
<span id="cb118-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb118-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">egen</span> <span class="ot">`count_invar'</span> = <span class="fu">count</span>('invar'), <span class="kw">by</span>('byvar') </span>
<span id="cb118-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb118-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">gen</span> <span class="ot">`outvar'</span> = (<span class="ot">`tot_invar'</span> - <span class="ot">`invar'</span>) <span class="co">///</span></span>
<span id="cb118-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb118-7" aria-hidden="true" tabindex="-1"></a>    / (<span class="ot">`count_invar'</span> - 1) </span>
<span id="cb118-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb118-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> </span></code></pre></div>
<p>Con el programa podemos escribir los bloques de código anteriores como:</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb119-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb119-1" aria-hidden="true" tabindex="-1"></a>* Caso 1 </span>
<span id="cb119-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb119-2" aria-hidden="true" tabindex="-1"></a>consumo_papitas_resto, invar(pc_papitas) <span class="co">///</span></span>
<span id="cb119-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb119-3" aria-hidden="true" tabindex="-1"></a>outvar(consumo_papitas_resto_pc) byvar(region)</span>
<span id="cb119-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb119-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb119-5" aria-hidden="true" tabindex="-1"></a>* Caso 2</span>
<span id="cb119-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb119-6" aria-hidden="true" tabindex="-1"></a>consumo_papitas_resto, invar(pc_papitas)  <span class="co">///</span></span>
<span id="cb119-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb119-7" aria-hidden="true" tabindex="-1"></a>outvar(consumo_papitas_restometro_pc) byvar(metroarea)</span></code></pre></div>
<p>Hemos escrito la función de forma totalmente general. Podemos cambiar el nivel de agregación sin inducir errores.</p>
<p>Estructura de un programa en Stata: La sintaxis más simple es:</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb120-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb120-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">program</span> nombredelprograma</span>
<span id="cb120-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb120-2" aria-hidden="true" tabindex="-1"></a>        <span class="kw">display</span> <span class="st">"Lo que va a hacer el programa"</span></span>
<span id="cb120-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb120-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span> </span></code></pre></div>
<p>Cuando se ha definido un programa con <code>program</code>, este se vuelve indistinguible de cualquier otro comando de Stata. Es importante estar seguros(as) de que no estoy escribiendo el mismo nombre que otro programa. Para garantizar lo anterior, es bueno utilizar el comando <code>which</code>.</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb121-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb121-1" aria-hidden="true" tabindex="-1"></a>which tabmiss</span></code></pre></div>
<p>Guardar un programa en Stata</p>
<ul>
<li>Hay dos lugares en donde puedes guardar tus <code>ado-files</code>.</li>
<li>Cuando se ha definido un programa con <code>program</code>, este se vuelve indistinguible de cualquier otro comando de Stata.</li>
<li>En el directorio de trabajo del proyecto.</li>
<li>Se puede hacer una carpeta nueva en la sección de códigos que indique los programas.</li>
<li>Otra opción es guardarlo en el directorio <code>Personal</code> de Stata. Para entrar escriban <code>personal</code> en la consola.</li>
</ul>
<p>Nombrar un programa en Stata</p>
<ul>
<li>Es posible darle cualquier nombre a un programa mientras no sea un nombre que ya es utilizado por Stata.</li>
<li>Si por ejemplo, creas un programa llamado <code>summarize</code> Stata lo va a ignorar y utilizará su propio comando.</li>
</ul>
</div>
<div id="mis-primeros-programas-en-stata" class="section level3" number="2.4.3">
<h3>
<span class="header-section-number">2.4.3</span> Mis primeros programas en Stata<a class="anchor" aria-label="anchor" href="#mis-primeros-programas-en-stata"><i class="fas fa-link"></i></a>
</h3>
<div id="programa-1" class="section level4" number="2.4.3.1">
<h4>
<span class="header-section-number">2.4.3.1</span> Programa 1<a class="anchor" aria-label="anchor" href="#programa-1"><i class="fas fa-link"></i></a>
</h4>
<p>Vamos escribir nuestro primer programa:</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb122-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb122-1" aria-hidden="true" tabindex="-1"></a>  * Mi primer programa en Stata</span>
<span id="cb122-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb122-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">program</span> minombrees </span>
<span id="cb122-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb122-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">display</span> <span class="st">"Hola, mi nombre es "</span></span>
<span id="cb122-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb122-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span> </span></code></pre></div>
<p>Noten que al ejecutarlo no se genera ningún resultado. Lo que hemos hecho es definir un comando llamado <code>minombrees</code> con una simple función. Esta es la idea principal de un programa. Ejecuten nuevamente el programa. Al hacer esto observaran que se genera un error. Esto es porque al igual que las variables, no es posible asignar dos nombres iguales a un programa. Para evitar esto, es importante utilizar <code>program drop minombrees</code> antes de cargar el comando nuevamente. Este es un buen momento para utilizar <code>capture</code>.</p>
</div>
<div id="programa-2" class="section level4" number="2.4.3.2">
<h4>
<span class="header-section-number">2.4.3.2</span> Programa 2<a class="anchor" aria-label="anchor" href="#programa-2"><i class="fas fa-link"></i></a>
</h4>
<p>Vamos escribir un programa que permita calcular un promedio. Vamos a escribir un comando que nos permita crear una nueva variable que contenga los valores promedio y que muestre el resultado en la pantalla. Esto sería igual que escribir:</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb123-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb123-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">sysuse</span> auto, <span class="kw">clear</span></span>
<span id="cb123-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb123-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">egen</span> mimedia_mpg = <span class="kw">mean</span>(mpg)</span>
<span id="cb123-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb123-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">tab</span> mean_mpg </span></code></pre></div>
<p>Podemos evitar la repetición de estos dos comandos armando un programa:</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb124-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> <span class="kw">drop</span> <span class="dt">_all</span> </span>
<span id="cb124-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="kw">capture</span> <span class="kw">program</span> <span class="kw">drop</span> mymean</span>
<span id="cb124-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb124-3" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> mymean </span>
<span id="cb124-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb124-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">egen</span> media_<span class="ot">`1'</span> = <span class="kw">mean</span>(<span class="ot">`1'</span>)</span>
<span id="cb124-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb124-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">tab</span> media_<span class="ot">`1'</span></span>
<span id="cb124-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb124-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> </span>
<span id="cb124-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb124-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb124-8" aria-hidden="true" tabindex="-1"></a>* Aplicamos este programa </span>
<span id="cb124-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb124-9" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto, <span class="kw">clear</span></span>
<span id="cb124-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb124-10" aria-hidden="true" tabindex="-1"></a>mimedia mpg</span></code></pre></div>
<p>Noten que hemos utilizado `<code>1'</code>. Este nos indica cualquier variable que este en la primera posición. Si incluimos más de una variable. <strong>Solo va a considerar la primera variable</strong>.</p>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.5.1: </b></p>
<p>Preguntas</p>
<ol style="list-style-type: decimal">
<li>Escriba un programa que permita ver todas las etiquetas (<code>labels</code>) de una base de datos.</li>
<li>Aplique este programa a la base <code>auto.dta</code>.</li>
</ol>
</div>
</div>
<div id="programa-3" class="section level4" number="2.4.3.3">
<h4>
<span class="header-section-number">2.4.3.3</span> Programa 3<a class="anchor" aria-label="anchor" href="#programa-3"><i class="fas fa-link"></i></a>
</h4>
<p>Vamos a reescribir el programa para permitir un número arbitrario de variables. La macro ‘0’ contiene toda la cadena, ‘1’ el primer elemento, ‘2’ el segundo, etc. Podemos hacer una iteración sobre todos los elementos sin saber cuántos hay utilizando la técnica de desplazamiento incremental que implementaremos con <code>macro_shift</code>.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb125-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="kw">capture</span> <span class="kw">program</span> <span class="kw">drop</span> mimedia </span>
<span id="cb125-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb125-2" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> <span class="kw">define</span> mimedia </span>
<span id="cb125-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb125-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">while</span> <span class="st">"`1'"</span>!=<span class="st">""</span> { </span>
<span id="cb125-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb125-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">egen</span> mean_<span class="ot">`1'</span>=<span class="kw">mean</span>(<span class="ot">`1'</span>) </span>
<span id="cb125-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb125-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">tab</span> mean_<span class="ot">`1'</span> </span>
<span id="cb125-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb125-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">macro</span> <span class="kw">shift</span></span>
<span id="cb125-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb125-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb125-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb125-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb125-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb125-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb125-10" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto, <span class="kw">clear</span></span>
<span id="cb125-11"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb125-11" aria-hidden="true" tabindex="-1"></a>mimedia price mpg rep78 </span></code></pre></div>
<p>El comando <code>macro shift</code> sirve como incremental. Termina cuando encuentra un vacio, lo que explica la presencia del <code>while</code>. Notar que <code>"</code>1’“` habla de la posición. Es una buena tecnica para garantizar que el iterador seguirá cuando este vacio.</p>
</div>
<div id="programa-4" class="section level4" number="2.4.3.4">
<h4>
<span class="header-section-number">2.4.3.4</span> Programa 4<a class="anchor" aria-label="anchor" href="#programa-4"><i class="fas fa-link"></i></a>
</h4>
<p>Modificamos un poco el programa para que despliegue los resultados en la consola de Stata. Adicionalmente, agregamos un <code>quietly</code>.</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb126-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="kw">capture</span> <span class="kw">program</span> <span class="kw">drop</span> mimedia </span>
<span id="cb126-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb126-2" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> <span class="kw">define</span> mimedia </span>
<span id="cb126-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb126-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">while</span> <span class="st">"`1'"</span>!=<span class="st">""</span> { </span>
<span id="cb126-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb126-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">qui</span>: <span class="kw">egen</span> <span class="ot">`1'</span>_mean = <span class="kw">mean</span>(<span class="ot">`1'</span>) </span>
<span id="cb126-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb126-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">display</span> <span class="st">"Media de `1' = "</span> <span class="ot">`1'</span>_mean </span>
<span id="cb126-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb126-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">macro</span> <span class="kw">shift</span></span>
<span id="cb126-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb126-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb126-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb126-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb126-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb126-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb126-10" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto, <span class="kw">clear</span></span>
<span id="cb126-11"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb126-11" aria-hidden="true" tabindex="-1"></a>mimedia price mpg rep78 </span></code></pre></div>
</div>
<div id="programa-5" class="section level4" number="2.4.3.5">
<h4>
<span class="header-section-number">2.4.3.5</span> Programa 5<a class="anchor" aria-label="anchor" href="#programa-5"><i class="fas fa-link"></i></a>
</h4>
<p>El comando <code>macro shift</code> es útil, pero puede ser lento. Agregando variables locales usuales y un incremental es mucho mejor. Ojo con las dobles comillas.</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb127-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="kw">capture</span> <span class="kw">program</span> <span class="kw">drop</span> mimedia </span>
<span id="cb127-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb127-2" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> <span class="kw">define</span> mimedia </span>
<span id="cb127-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb127-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span> i = 1</span>
<span id="cb127-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb127-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">while</span> <span class="st">"``i''"</span>~=<span class="st">""</span> { </span>
<span id="cb127-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb127-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">qui</span>: <span class="kw">egen</span> <span class="ot">``i'</span>'_mean = <span class="kw">mean</span>(<span class="ot">``i'</span>') </span>
<span id="cb127-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb127-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">display</span> <span class="st">"Media de `i' = "</span> <span class="ot">``i'</span>'_mean </span>
<span id="cb127-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb127-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">local</span> ++i</span>
<span id="cb127-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb127-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb127-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb127-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
</div>
</div>
<div id="programa-con-distintos-argumentos" class="section level3" number="2.4.4">
<h3>
<span class="header-section-number">2.4.4</span> Programa con distintos argumentos<a class="anchor" aria-label="anchor" href="#programa-con-distintos-argumentos"><i class="fas fa-link"></i></a>
</h3>
<p>El programa de los ejemplos anteriores soporta un solo argumento. Ahora vamos a ver un programa que considere explícitamente que los argumentos de un programa pueden tomar roles distintos.</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb128-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> <span class="kw">drop</span> <span class="dt">_all</span> </span>
<span id="cb128-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="kw">capture</span> <span class="kw">program</span> <span class="kw">drop</span> show </span>
<span id="cb128-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb128-3" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> <span class="kw">define</span> show</span>
<span id="cb128-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb128-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">tempvar</span> <span class="kw">obs</span> </span>
<span id="cb128-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb128-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">quietly</span> <span class="kw">gen</span> <span class="ot">`obs'</span> = <span class="ot">`1'</span> <span class="co">///</span></span>
<span id="cb128-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb128-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> (ctycode == <span class="st">"`2'"</span> &amp; <span class="fu">year</span> ==<span class="ot">`3'</span>)</span>
<span id="cb128-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb128-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">sort</span> <span class="ot">`obs'</span></span>
<span id="cb128-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb128-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="st">"`1' of country `2' in `3' is: "</span> <span class="ot">`obs'</span> </span>
<span id="cb128-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb128-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p><code>tempvar</code> crea una variable temporal que existe mientras el programa se ejecuta pero que se elimina automáticamente una vez que el programa termina su ejecución. Es importante estar seguros(as) de que cualquier <em>string</em> están en comillas dobles.</p>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.5.2:</b></p>
<p>Preguntas</p>
<ol style="list-style-type: decimal">
<li>Escriba un programa que reporte la mediana de la diferencia entre dos variables.</li>
<li>Aplique este programa a la base <code>auto.dta</code>.</li>
</ol>
</div>
</div>
<div id="opción-syntax" class="section level3" number="2.4.5">
<h3>
<span class="header-section-number">2.4.5</span> Opción Syntax<a class="anchor" aria-label="anchor" href="#opci%C3%B3n-syntax"><i class="fas fa-link"></i></a>
</h3>
<p>Renombrando argumentos:</p>
<ul>
<li>De momento hemos escrito los programas utilizando <code>'1', '2', '3'</code> con el fin de introducir el uso de programas en Stata.</li>
<li>Sin embargo, esta notación puede ser un poco confusa y provocar errores en la codificación. Podemos asignar nombres de mayor significado a los argumentos del programa.</li>
</ul>
<div class="sourceCode" id="cb129"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb129-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> <span class="kw">drop</span> <span class="dt">_all</span> </span>
<span id="cb129-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb129-2" aria-hidden="true" tabindex="-1"></a><span class="kw">capture</span> <span class="kw">program</span> <span class="kw">drop</span> show </span>
<span id="cb129-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb129-3" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> <span class="kw">define</span> show</span>
<span id="cb129-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb129-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">args</span> <span class="kw">var</span> cty yr</span>
<span id="cb129-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb129-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">tempvar</span> <span class="kw">obs</span> </span>
<span id="cb129-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb129-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">quietly</span> <span class="kw">gen</span> <span class="ot">`obs'</span> = <span class="ot">`var'</span> <span class="co">///</span></span>
<span id="cb129-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb129-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> (ctycode == <span class="st">"`cty'"</span> &amp; <span class="fu">year</span> ==<span class="ot">`yr'</span>)</span>
<span id="cb129-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb129-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">sort</span> <span class="ot">`obs'</span></span>
<span id="cb129-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb129-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="st">"`1' of country `2' in `3' is: "</span> <span class="ot">`obs'</span> </span>
<span id="cb129-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb129-10" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p>El comando<code>args</code> asigna a las variables locales <code>var</code>, <code>cty</code>, <code>yr</code> los valores de <code>'1'</code>, <code>'2'</code>, <code>'3'</code>. Noten que si llaman al programa con cuatro argumentos <strong>no</strong> retorna un error. Un método mucho más robusto y mejor para llamar a los argumentos de un programa es utilizar <code>syntax</code>. En vez de referirnos a cada elemento de un programa por su posición, vamos a especificar la “gramática” del programa.</p>
<p>La sintaxis de Stata es:</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb130-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb130-1" aria-hidden="true" tabindex="-1"></a>[<span class="kw">by</span> <span class="kw">varlist</span>:] command [<span class="kw">varlist</span>] [=<span class="fu">exp</span>] [<span class="kw">in</span> <span class="kw">range</span>] [, options]</span></code></pre></div>
<p><code>varlist</code> denota la lista de variables, <code>command</code> el comando a ejecutar, <code>exp</code> denota una expresión algebraica, <code>range</code> denota un rango para las observaciones mientras que <code>,options</code> denota la lista de opciones propias de un comando. Utilizar <code>syntax</code> en un programa hace que Stata verifique si un programa satisface la sintaxis. En caso de que no la cumpla, arrojara un error.</p>
<p>Syntax
* El comando <code>syntax</code> almacena en macros locales todos los elementos típicos de un comando en Stata.
* Por ejemplo, <code>syntax</code> también puede definir condicionales como <code>if</code> o <code>in</code>.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb131-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb131-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">program</span> ... </span>
<span id="cb131-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb131-2" aria-hidden="true" tabindex="-1"></a>        <span class="kw">syntax</span> <span class="kw">varlist</span>(<span class="fu">min</span> = 2) [<span class="kw">if</span>] [<span class="kw">in</span>]</span></code></pre></div>
<p>Si quieren hacer programas más complejos, con otras características es importante revisar <a href="https://www.stata.com/manuals/psyntax.pdf#psyntax">syntax</a>.</p>
<p>Uno de los primeros elementos de <code>syntax</code> es <code>varlist</code>. Es posible indicar el mínimo o máximo de variables.
* Por ejemplo: <code>varlist(min = 2 max = 2)</code>.
* Si tienes solo una variable puedes utilizar <code>varname</code>.
* Es equivalente a <code>varlist(min = 1 max = 1)</code>.
* La macro que guarda las variables siempre se llama <code>varlist</code>.</p>
<p>Ejemplo 1: programa para calcular percentiles</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb132-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> pctrange, rclass </span>
<span id="cb132-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb132-2" aria-hidden="true" tabindex="-1"></a><span class="kw">version</span> 17 </span>
<span id="cb132-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb132-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">syntax</span> <span class="kw">varlist</span>(<span class="fu">max</span> = 1 <span class="kw">numeric</span>)</span>
<span id="cb132-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb132-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">quietly</span> <span class="kw">summarize</span> <span class="ot">`varlist'</span>, <span class="kw">detail</span> </span>
<span id="cb132-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb132-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="kw">range</span> = <span class="fu">r</span>(<span class="fu">max</span>) - <span class="fu">r</span>(<span class="fu">min</span>)</span>
<span id="cb132-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb132-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> p7525 = <span class="fu">r</span>(p75) - <span class="fu">r</span>(p25)</span>
<span id="cb132-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb132-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> p9010 = <span class="fu">r</span>(p90) - <span class="fu">r</span>(p10)</span>
<span id="cb132-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb132-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> result <span class="dt">_n</span> <span class="st">"Rangos de percentiles para `varlist'"</span></span>
<span id="cb132-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb132-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">"75-25 : "</span> p7525</span>
<span id="cb132-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb132-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">"90-10:  "</span> p9010 </span>
<span id="cb132-11"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb132-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">"Range: "</span> <span class="kw">range</span></span>
<span id="cb132-12"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb132-12" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> </span></code></pre></div>
<p>El programa anterior nos permite obtener los percentiles de alguna variable al mismo tiempo que los muestra en la consola. Noten que tambíen he incluido que tipo de comando es. En este caso es un comando <code>r-class</code>. <code>program</code> es quien determina el nombre del programa. <code>syntax</code> permite determinar los elementos de tu programa. En el ejemplo define el tipo y el límite de variables. También puede definir condicionales como <code>if</code> o <code>in</code>.</p>
<p>Los escalares definidos durante el programa se pueden utilizar. Esto no siempre es conveniente. Como recomendación es bueno <strong>guardar los programas como variables temporales</strong>.</p>
<p>Ejemplo 2: programa para calcular percentiles con variables locales</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb133-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> pctrange, rclass </span>
<span id="cb133-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb133-2" aria-hidden="true" tabindex="-1"></a><span class="kw">version</span> 17 </span>
<span id="cb133-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb133-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">syntax</span> <span class="kw">varlist</span>(<span class="fu">max</span> = 1 <span class="kw">numeric</span>)</span>
<span id="cb133-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb133-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span> res <span class="st">"range p7525 p9010"</span></span>
<span id="cb133-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb133-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">tempname</span> <span class="ot">`res'</span>    </span>
<span id="cb133-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb133-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> result <span class="dt">_n</span> <span class="st">"Rangos de percentiles para `varlist'"</span></span>
<span id="cb133-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb133-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">quietly</span> <span class="kw">summarize</span> <span class="ot">`varlist'</span>, <span class="kw">detail</span> </span>
<span id="cb133-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb133-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`range'</span> = <span class="fu">r</span>(<span class="fu">max</span>) - <span class="fu">r</span>(<span class="fu">min</span>)</span>
<span id="cb133-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb133-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`p7525'</span> = <span class="fu">r</span>(p75) - <span class="fu">r</span>(p25)</span>
<span id="cb133-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb133-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`p9010'</span> = <span class="fu">r</span>(p90) - <span class="fu">r</span>(p10)</span>
<span id="cb133-11"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb133-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">"75-25 : "</span> <span class="ot">`p7525'</span></span>
<span id="cb133-12"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb133-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">"90-10:  "</span> <span class="ot">`p9010'</span></span>
<span id="cb133-13"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb133-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">"Range: "</span> <span class="ot">`range'</span></span></code></pre></div>
</div>
<div id="return" class="section level3" number="2.4.6">
<h3>
<span class="header-section-number">2.4.6</span> Return<a class="anchor" aria-label="anchor" href="#return"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>Una característica importante de los comandos de Stata es su capacidad de reportar los resultados de forma tal de que los usuarios y usuarias podamos utilizarlos posteriormente.</li>
<li>El comando <code>return</code> nos permite guardar los escalares y hacerlos accesibles, sin tener el problema que vimos en el ejemplo anterior.<br>
</li>
<li>Notar que el lado izquierdo del escalar de retorno se refiere al nombre de la macro, el lado derecho debe hacer referencia a la macro una vez más para extraer el valor almacenado en ese nombre, por lo que debe utilizar dos comillas.</li>
</ul>
<p>Ejemplo 3: programa para calcular percentiles con return</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb134-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> pctrange, rclass </span>
<span id="cb134-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb134-2" aria-hidden="true" tabindex="-1"></a><span class="kw">version</span> 17 </span>
<span id="cb134-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb134-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">syntax</span> <span class="kw">varlist</span>(<span class="fu">max</span> = 1 <span class="kw">numeric</span>)</span>
<span id="cb134-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb134-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span> res <span class="st">"range p7525 p9010"</span></span>
<span id="cb134-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb134-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">tempname</span> <span class="ot">`res'</span>    </span>
<span id="cb134-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb134-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> result <span class="dt">_n</span> <span class="st">"Rangos de percentiles para `varlist'"</span></span>
<span id="cb134-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb134-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">quietly</span> <span class="kw">summarize</span> <span class="ot">`varlist'</span>, <span class="kw">detail</span> </span>
<span id="cb134-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb134-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`range'</span> = <span class="fu">r</span>(<span class="fu">max</span>) - <span class="fu">r</span>(<span class="fu">min</span>)</span>
<span id="cb134-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb134-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`p7525'</span> = <span class="fu">r</span>(p75) - <span class="fu">r</span>(p25)</span>
<span id="cb134-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb134-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`p9010'</span> = <span class="fu">r</span>(p90) - <span class="fu">r</span>(p10)</span>
<span id="cb134-11"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb134-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">"75-25 : "</span> <span class="ot">`p7525'</span></span>
<span id="cb134-12"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb134-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">"90-10:  "</span> <span class="ot">`p9010 '</span></span>
<span id="cb134-13"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb134-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">"Range: "</span> <span class="ot">`range'</span></span>
<span id="cb134-14"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb134-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="fu">r</span> <span class="kw">of</span> <span class="kw">local</span> res {</span>
<span id="cb134-15"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb134-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span> <span class="fu">scalar</span> <span class="ot">`r'</span> = <span class="ot">``r'</span>'</span>
<span id="cb134-16"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb134-16" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb134-17"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb134-17" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> </span></code></pre></div>
</div>
<div id="implementar-opciones-al-programa" class="section level3" number="2.4.7">
<h3>
<span class="header-section-number">2.4.7</span> Implementar opciones al programa<a class="anchor" aria-label="anchor" href="#implementar-opciones-al-programa"><i class="fas fa-link"></i></a>
</h3>
<p>Podemos agregar distintas opciones al programa. Una opción es agregar como opcional que el programa de un resultado en la consola. Al incluir <span class="math inline">\([ ]\)</span> en <code>syntax</code> significa un componente <strong>opcional</strong> en el comando.</p>
<p>Ejemplo 4: implementar opciones al programa (imprimir por defecto)</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb135-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> pctrange, rclass </span>
<span id="cb135-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="kw">version</span> 17 </span>
<span id="cb135-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb135-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">syntax</span> <span class="kw">varlist</span>(<span class="fu">max</span> = 1 <span class="kw">numeric</span>) [, PRINT]</span>
<span id="cb135-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb135-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span> res <span class="st">"range p7525 p9010"</span></span>
<span id="cb135-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb135-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">tempname</span> <span class="ot">`res'</span>    </span>
<span id="cb135-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb135-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> result <span class="dt">_n</span> <span class="st">"Rangos de percentiles para `varlist'"</span></span>
<span id="cb135-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb135-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">quietly</span> <span class="kw">summarize</span> <span class="ot">`varlist'</span>, <span class="kw">detail</span> </span>
<span id="cb135-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb135-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`range'</span> = <span class="fu">r</span>(<span class="fu">max</span>) - <span class="fu">r</span>(<span class="fu">min</span>)</span>
<span id="cb135-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb135-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`p7525'</span> = <span class="fu">r</span>(p75) - <span class="fu">r</span>(p25)</span>
<span id="cb135-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb135-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`p9010'</span> = <span class="fu">r</span>(p90) - <span class="fu">r</span>(p10)</span>
<span id="cb135-11"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb135-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="st">"`print'"</span> == <span class="st">"print"</span> {</span>
<span id="cb135-12"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb135-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">"75-25 : "</span> <span class="ot">`p7525'</span></span>
<span id="cb135-13"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb135-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">"90-10:  "</span> <span class="ot">`p9010 '</span></span>
<span id="cb135-14"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb135-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">"Range: "</span> <span class="ot">`range'</span></span>
<span id="cb135-15"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb135-15" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb135-16"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb135-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="fu">r</span> <span class="kw">of</span> <span class="kw">local</span> res {</span>
<span id="cb135-17"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb135-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span> <span class="fu">scalar</span> <span class="ot">`r'</span> = <span class="ot">``r'</span>'</span>
<span id="cb135-18"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb135-18" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb135-19"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb135-19" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> </span></code></pre></div>
<p>Ejemplo 5: implementar opciones al programa (no imprimir por defecto)</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb136-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> pctrange, rclass </span>
<span id="cb136-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb136-2" aria-hidden="true" tabindex="-1"></a><span class="kw">version</span> 17 </span>
<span id="cb136-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb136-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">syntax</span> <span class="kw">varlist</span>(<span class="fu">max</span> = 1 <span class="kw">numeric</span>) [, noPRINT]</span>
<span id="cb136-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb136-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span> res <span class="st">"range p7525 p9010"</span></span>
<span id="cb136-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb136-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">tempname</span> <span class="ot">`res'</span>    </span>
<span id="cb136-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb136-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> result <span class="dt">_n</span> <span class="st">"Rangos de percentiles para `varlist'"</span></span>
<span id="cb136-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb136-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">quietly</span> <span class="kw">summarize</span> <span class="ot">`varlist'</span>, <span class="kw">detail</span> </span>
<span id="cb136-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb136-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`range'</span> = <span class="fu">r</span>(<span class="fu">max</span>) - <span class="fu">r</span>(<span class="fu">min</span>)</span>
<span id="cb136-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb136-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`p7525'</span> = <span class="fu">r</span>(p75) - <span class="fu">r</span>(p25)</span>
<span id="cb136-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb136-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`p9010'</span> = <span class="fu">r</span>(p90) - <span class="fu">r</span>(p10)</span>
<span id="cb136-11"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb136-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="st">"`print'"</span> != <span class="st">"noprint"</span> {</span>
<span id="cb136-12"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb136-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">"75-25 : "</span> <span class="ot">`p7525'</span></span>
<span id="cb136-13"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb136-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">"90-10:  "</span> <span class="ot">`p9010 '</span></span>
<span id="cb136-14"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb136-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">"Range: "</span> <span class="ot">`range'</span></span>
<span id="cb136-15"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb136-15" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb136-16"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb136-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="fu">r</span> <span class="kw">of</span> <span class="kw">local</span> res {</span>
<span id="cb136-17"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb136-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span> <span class="fu">scalar</span> <span class="ot">`r'</span> = <span class="ot">``r'</span>'</span>
<span id="cb136-18"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb136-18" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb136-19"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb136-19" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> </span></code></pre></div>
</div>
<div id="incluir-ifin-al-programa" class="section level3" number="2.4.8">
<h3>
<span class="header-section-number">2.4.8</span> Incluir if/in al programa<a class="anchor" aria-label="anchor" href="#incluir-ifin-al-programa"><i class="fas fa-link"></i></a>
</h3>
<p>Incluir un subconjunto de observaciones</p>
<ul>
<li>Cualquier comando debiese incluir <code>if</code> o <code>in range</code>.</li>
<li>Nuevamente, estas opciones son manejadas dentro del comando <code>syntax</code>. Para incluir estas opciones hay que agregar <code>[if]</code> y <code>[in]</code>.</li>
<li>Con estos comandos puedo ejecutar el programa para sub-muestras. Es importante asegurar que la sub-muestra no es vacía. Para ello es importante calcular <code>r(N)</code>, chequear que sea distinto de cero y agregar un título que lo indique.</li>
<li>El comando <code>marksample touse</code> utiliza la información provista por <code>if</code> o <code>in</code> en caso de que estos sean indicados en el programa. Este comando genera una variable local <code>touse</code> que es igual a 1 si las variables entran en el calculo que hace el programa y 0 en caso contrario.</li>
<li>Utilizaremos <code>'touse'</code> para calcular el número de observaciones que se utilizan después de aplicar los condicionales. Es necesario agregar <code>'touse'</code> en cada parte del programa que trabaje con la variable de <em>input</em>.</li>
</ul>
<p>Ejemplo 6: Incluir un subconjunto de observaciones</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb137-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> pctrange, rclass </span>
<span id="cb137-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb137-2" aria-hidden="true" tabindex="-1"></a><span class="kw">version</span> 17 </span>
<span id="cb137-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb137-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">syntax</span> <span class="kw">varlist</span>(<span class="fu">max</span> = 1 <span class="kw">numeric</span>) [, noPRINT]</span>
<span id="cb137-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb137-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span> res <span class="st">"range p7525 p9010"</span></span>
<span id="cb137-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb137-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">tempname</span> <span class="ot">`res'</span>    </span>
<span id="cb137-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb137-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> result <span class="dt">_n</span> <span class="st">"Rangos de percentiles para `varlist'"</span></span>
<span id="cb137-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb137-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">quietly</span> <span class="kw">summarize</span> <span class="ot">`varlist'</span>, <span class="kw">detail</span> </span>
<span id="cb137-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb137-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`range'</span> = <span class="fu">r</span>(<span class="fu">max</span>) - <span class="fu">r</span>(<span class="fu">min</span>)</span>
<span id="cb137-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb137-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`p7525'</span> = <span class="fu">r</span>(p75) - <span class="fu">r</span>(p25)</span>
<span id="cb137-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb137-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`p9010'</span> = <span class="fu">r</span>(p90) - <span class="fu">r</span>(p10)</span>
<span id="cb137-11"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb137-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="st">"`print'"</span> != <span class="st">"noprint"</span> {</span>
<span id="cb137-12"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb137-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">"75-25 : "</span> <span class="ot">`p7525'</span></span>
<span id="cb137-13"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb137-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">"90-10:  "</span> <span class="ot">`p9010 '</span></span>
<span id="cb137-14"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb137-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">"Range: "</span> <span class="ot">`range'</span></span>
<span id="cb137-15"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb137-15" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb137-16"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb137-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="fu">r</span> <span class="kw">of</span> <span class="kw">local</span> res {</span>
<span id="cb137-17"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb137-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span> <span class="fu">scalar</span> <span class="ot">`r'</span> = <span class="ot">``r'</span>'</span>
<span id="cb137-18"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb137-18" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb137-19"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb137-19" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> </span></code></pre></div>
</div>
<div id="generalizar-el-comando-para-incluir-múltiples-variables" class="section level3" number="2.4.9">
<h3>
<span class="header-section-number">2.4.9</span> Generalizar el comando para incluir múltiples variables<a class="anchor" aria-label="anchor" href="#generalizar-el-comando-para-incluir-m%C3%BAltiples-variables"><i class="fas fa-link"></i></a>
</h3>
<p>Algunas consideraciones</p>
<ul>
<li>Si quiero ejecutar el programa sobre múltiples variables, es necesario ajustar un poco el programa.</li>
<li>Tengo que indicarle a <code>syntax</code> que hay más de una variable. Además, tengo que indicarle al programa que en caso de que existan más variables muestre los resultados en una tabla.</li>
<li>Guardaremos los resultados en matrices (no escalares) y vamos a aplicar una <strong>función de macro extendida</strong> con el fin de contar el número de filas que esta matriz debiese tener.</li>
<li>Agregaremos también una la opción para cambiar el formato y la opción <code>mat</code> que permite a la matriz ser guardada automáticamente con el nombre indicado.</li>
</ul>
<p>Ejemplo 7</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb138-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> <span class="kw">drop</span> <span class="dt">_all</span> </span>
<span id="cb138-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-2" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> pctrange, rclass</span>
<span id="cb138-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-3" aria-hidden="true" tabindex="-1"></a><span class="kw">version</span> 17 </span>
<span id="cb138-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">syntax</span> <span class="kw">varlist</span>(<span class="fu">min</span> = 1 <span class="kw">numeric</span> ts) [<span class="kw">if</span>] [<span class="kw">in</span>] [, noPRINT FORmat(passthru) MATrix(<span class="fu">string</span>)] </span>
<span id="cb138-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">marksample</span> touse </span>
<span id="cb138-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">quietly</span> <span class="fu">count</span> <span class="kw">if</span> <span class="ot">`touse'</span></span>
<span id="cb138-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="ot">`r(N)'</span> == 0 {</span>
<span id="cb138-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">error</span> 2000</span>
<span id="cb138-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb138-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span> nvar: <span class="fu">word</span> <span class="fu">count</span> <span class="ot">`varlist'</span></span>
<span id="cb138-11"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="ot">`nvar'</span> == 1 {</span>
<span id="cb138-12"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-12" aria-hidden="true" tabindex="-1"></a>        <span class="kw">local</span> res <span class="kw">range</span> p7525 p9010</span>
<span id="cb138-13"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">tempname</span> <span class="ot">`res'</span>    </span>
<span id="cb138-14"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb138-15"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">quietly</span> <span class="kw">summarize</span> <span class="ot">`varlist'</span> <span class="kw">if</span> <span class="ot">`touse'</span>, <span class="kw">detail</span> </span>
<span id="cb138-16"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scalar</span> <span class="ot">`range'</span> = <span class="fu">r</span>(<span class="fu">max</span>) - <span class="fu">r</span>(<span class="fu">min</span>)</span>
<span id="cb138-17"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scalar</span> <span class="ot">`p7525'</span> = <span class="fu">r</span>(p75) - <span class="fu">r</span>(p25)</span>
<span id="cb138-18"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-18" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scalar</span> <span class="ot">`p9010'</span> = <span class="fu">r</span>(p90) - <span class="fu">r</span>(p10)</span>
<span id="cb138-19"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-19" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="st">"`print'"</span> != <span class="st">"noprint"</span> {</span>
<span id="cb138-20"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-20" aria-hidden="true" tabindex="-1"></a>            <span class="kw">display</span> <span class="kw">as</span> result <span class="dt">_n</span> <span class="st">"Rangos de percentiles para `varlist', N = `r(N)'"</span></span>
<span id="cb138-21"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-21" aria-hidden="true" tabindex="-1"></a>            <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">"75-25 : "</span> <span class="ot">`p7525'</span></span>
<span id="cb138-22"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-22" aria-hidden="true" tabindex="-1"></a>            <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">"90-10:  "</span> <span class="ot">`p9010 '</span></span>
<span id="cb138-23"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-23" aria-hidden="true" tabindex="-1"></a>            <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">"Range: "</span> <span class="ot">`range'</span></span>
<span id="cb138-24"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb138-25"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb138-26"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="fu">r</span> <span class="kw">of</span> <span class="kw">local</span> res {</span>
<span id="cb138-27"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-27" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span> <span class="fu">scalar</span> <span class="ot">`r'</span> = <span class="ot">``r'</span>'</span>
<span id="cb138-28"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-28" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb138-29"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span> <span class="fu">scalar</span> <span class="kw">N</span> = <span class="fu">r</span>(<span class="kw">N</span>)</span>
<span id="cb138-30"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-30" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb138-31"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">else</span> {</span>
<span id="cb138-32"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">tempname</span> rmat </span>
<span id="cb138-33"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">matrix</span> <span class="ot">`rmat'</span> = <span class="fu">J</span>(<span class="ot">`nvar'</span>, 3, .)</span>
<span id="cb138-34"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-34" aria-hidden="true" tabindex="-1"></a>      <span class="kw">local</span> i 0 </span>
<span id="cb138-35"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-35" aria-hidden="true" tabindex="-1"></a>        <span class="kw">foreach</span> v <span class="kw">of</span> <span class="kw">varlist</span> <span class="ot">`varlist'</span>{</span>
<span id="cb138-36"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-36" aria-hidden="true" tabindex="-1"></a>        <span class="kw">local</span> ++i </span>
<span id="cb138-37"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-37" aria-hidden="true" tabindex="-1"></a>        <span class="kw">quietly</span> <span class="kw">summarize</span> <span class="ot">`v'</span> <span class="kw">if</span> <span class="ot">`touse'</span>, <span class="kw">detail</span> </span>
<span id="cb138-38"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-38" aria-hidden="true" tabindex="-1"></a>        <span class="fu">matrix</span> <span class="ot">`rmat'</span>[<span class="ot">`i'</span> ,1] = <span class="fu">r</span>(<span class="fu">max</span>) - <span class="fu">r</span>(<span class="fu">min</span>)</span>
<span id="cb138-39"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-39" aria-hidden="true" tabindex="-1"></a>        <span class="fu">matrix</span> <span class="ot">`rmat'</span>[<span class="ot">`i'</span>, 2] = <span class="fu">r</span>(p75) - <span class="fu">r</span>(p25)</span>
<span id="cb138-40"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-40" aria-hidden="true" tabindex="-1"></a>        <span class="fu">matrix</span> <span class="ot">`rmat'</span>[<span class="ot">`i'</span>, 3] = <span class="fu">r</span>(p90) - <span class="fu">r</span>(p10)</span>
<span id="cb138-41"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-41" aria-hidden="true" tabindex="-1"></a>        <span class="kw">local</span> <span class="ot">rown</span> <span class="ot">`rown'</span> <span class="ot">`v'</span></span>
<span id="cb138-42"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-42" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb138-43"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-43" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb138-44"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-44" aria-hidden="true" tabindex="-1"></a>      <span class="fu">matrix</span> <span class="ot">colnames</span> <span class="ot">`rmat'</span> = Range P75-P25 P90-P10 </span>
<span id="cb138-45"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-45" aria-hidden="true" tabindex="-1"></a>      <span class="fu">matrix</span> <span class="ot">rownames</span> <span class="ot">`rmat'</span> = <span class="ot">`rown'</span> </span>
<span id="cb138-46"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-47"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-47" aria-hidden="true" tabindex="-1"></a>      <span class="kw">if</span> <span class="st">"`print'"</span> != <span class="st">"noprint"</span> {</span>
<span id="cb138-48"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-48" aria-hidden="true" tabindex="-1"></a>          <span class="kw">local</span> form <span class="st">", noheader"</span></span>
<span id="cb138-49"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-49" aria-hidden="true" tabindex="-1"></a>          <span class="kw">if</span> <span class="st">"`format'"</span> != <span class="st">""</span> {</span>
<span id="cb138-50"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-50" aria-hidden="true" tabindex="-1"></a>                <span class="kw">local</span> form <span class="st">"`form' `format'"</span> </span>
<span id="cb138-51"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-51" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb138-52"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-52" aria-hidden="true" tabindex="-1"></a>          <span class="fu">matrix</span> <span class="ot">list</span> <span class="ot">`rmat'</span> <span class="ot">`form'</span></span>
<span id="cb138-53"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-53" aria-hidden="true" tabindex="-1"></a>                                }</span>
<span id="cb138-54"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-55"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-55" aria-hidden="true" tabindex="-1"></a>      <span class="kw">if</span> <span class="st">"`matrix'"</span> != <span class="st">""</span> {</span>
<span id="cb138-56"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-56" aria-hidden="true" tabindex="-1"></a>            <span class="fu">matrix</span> <span class="ot">`matrix'</span> = <span class="ot">`rmat'</span></span>
<span id="cb138-57"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-57" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb138-58"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-58" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span> <span class="fu">matrix</span> rmat = <span class="ot">`rmat'</span></span>
<span id="cb138-59"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-59" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb138-60"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-60" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span> <span class="kw">local</span> varname <span class="ot">`varlist'</span></span>
<span id="cb138-61"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb138-61" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> </span></code></pre></div>
</div>
<div id="agregar-prefijos-a-los-programas" class="section level3" number="2.4.10">
<h3>
<span class="header-section-number">2.4.10</span> Agregar prefijos a los programas<a class="anchor" aria-label="anchor" href="#agregar-prefijos-a-los-programas"><i class="fas fa-link"></i></a>
</h3>
<p>Prefijo by</p>
<ul>
<li>Ahora vamos a hacer que nuestro programa pueda utilizar el prefijo <code>by</code>.</li>
<li>Para agregar esta opción simplemente hay qyue modificar <code>program</code>.</li>
</ul>
<div class="sourceCode" id="cb139"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb139-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> pctrange, rclass byable(recall)</span></code></pre></div>
<p>También podemos permitir que la lista de variables incluya <strong>operadores de series de tiempo</strong> (ej. <code>L.pib</code>, <code>D.ingreso</code>). Para incorporar estos elementos tenemos que modificar <code>syntax</code>.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb140-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb140-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">syntax</span> <span class="kw">varlist</span>(<span class="fu">min</span> = 1 <span class="kw">numeric</span> ts) [<span class="kw">if</span>] [<span class="kw">in</span>] <span class="co">///</span></span>
<span id="cb140-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb140-2" aria-hidden="true" tabindex="-1"></a>    [, noPRINT  FORmat(passthru) MATrix(<span class="fu">string</span>)]</span></code></pre></div>
</div>
<div id="programas-para-complementar-función-egen" class="section level3" number="2.4.11">
<h3>
<span class="header-section-number">2.4.11</span> Programas para complementar función egen<a class="anchor" aria-label="anchor" href="#programas-para-complementar-funci%C3%B3n-egen"><i class="fas fa-link"></i></a>
</h3>
<p>Es posible programar funciones adicionales de <code>egen</code>. El nombre de estos programas deben empezar con <code>_g</code>. Una diferencia importante entre este tipo de programas y los que ya hemos escrito guarda relación con el hecho de que hay que tener en cuenta la nueva variable que se va a crear. La sintaxis es la siguiente:</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb141-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> [<span class="dv">type</span>] newvarname = fcn(arguments) [<span class="kw">if</span>] [<span class="kw">in</span>] [, options]</span></code></pre></div>
<p>El cambio que haremos en la sintaxis del programa será que incluiremos un <code>touse</code> para hacer la nueva variable.</p>
<p>Ejemplo 8: programa función egen</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb142-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb142-1" aria-hidden="true" tabindex="-1"></a>* Programas <span class="kw">de</span> <span class="kw">egen</span> </span>
<span id="cb142-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb142-2" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> <span class="kw">drop</span> <span class="dt">_all</span></span>
<span id="cb142-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb142-3" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> _gpct9010</span>
<span id="cb142-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb142-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">syntax</span> newvarname =/<span class="fu">exp</span> [<span class="kw">if</span>] [<span class="kw">in</span>] </span>
<span id="cb142-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb142-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">tempvar</span> touse </span>
<span id="cb142-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb142-6" aria-hidden="true" tabindex="-1"></a>    mark <span class="ot">`touse'</span> <span class="ot">`if'</span> <span class="ot">`in'</span> </span>
<span id="cb142-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb142-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">quietly</span> <span class="kw">summarize</span> <span class="ot">`exp'</span> <span class="kw">if</span> <span class="ot">`touse'</span>, <span class="kw">detail</span> </span>
<span id="cb142-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb142-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">quietly</span> <span class="kw">generate</span> <span class="ot">`typlist'</span> <span class="ot">`varlist'</span> = <span class="fu">r</span>(p90) - <span class="fu">r</span>(p10) <span class="kw">if</span> <span class="ot">`touse'</span></span>
<span id="cb142-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb142-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb142-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb142-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-11"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb142-11" aria-hidden="true" tabindex="-1"></a>* Aplicación del programa</span>
<span id="cb142-12"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb142-12" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto, <span class="kw">clear</span></span>
<span id="cb142-13"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb142-13" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> rango9010 = pct9010(price)</span></code></pre></div>
<p>Programas con funciones de egen con prefijo by</p>
<ul>
<li>Agregamos <code>[, *]</code> que corresponde a las opciones. En <code>egen</code> el prefijo <code>by</code> es una opción.</li>
<li>Con el fin de permitirle al programa que pueda producir un rango de percentil separado para cada grupos utilizaremos <code>pctile</code> en vez de <code>summarize</code>.</li>
<li>El cambio que haremos en la sintaxis del programa será que incluiremos un <code>touse</code> para hacer la nueva variable.</li>
</ul>
<p>Ejemplo 9: programa función egen con prefijo by</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb143-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb143-1" aria-hidden="true" tabindex="-1"></a>* Programa con opción <span class="kw">by</span>. </span>
<span id="cb143-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb143-2" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> <span class="kw">drop</span> <span class="dt">_all</span></span>
<span id="cb143-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb143-3" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> _gpct9010</span>
<span id="cb143-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb143-4" aria-hidden="true" tabindex="-1"></a><span class="kw">syntax</span> newvarname =/<span class="fu">exp</span> [<span class="kw">if</span>] [<span class="kw">in</span>] [, *] </span>
<span id="cb143-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb143-5" aria-hidden="true" tabindex="-1"></a><span class="kw">tempvar</span> touse p90 p10 </span>
<span id="cb143-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb143-6" aria-hidden="true" tabindex="-1"></a>mark <span class="ot">`touse'</span> <span class="ot">`if'</span> <span class="ot">`in'</span> </span>
<span id="cb143-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb143-7" aria-hidden="true" tabindex="-1"></a><span class="kw">quietly</span> {</span>
<span id="cb143-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb143-8" aria-hidden="true" tabindex="-1"></a>          <span class="kw">egen</span> <span class="kw">double</span> <span class="ot">`p90'</span> = <span class="kw">pctile</span>(<span class="ot">`exp'</span>) <span class="kw">if</span> <span class="ot">`touse'</span>, <span class="ot">`options'</span> <span class="kw">p</span>(90) </span>
<span id="cb143-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb143-9" aria-hidden="true" tabindex="-1"></a>          <span class="kw">egen</span> <span class="kw">double</span> <span class="ot">`p10'</span> = <span class="kw">pctile</span>(<span class="ot">`exp'</span>) <span class="kw">if</span> <span class="ot">`touse'</span>, <span class="ot">`options'</span> <span class="kw">p</span>(10)</span>
<span id="cb143-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb143-10" aria-hidden="true" tabindex="-1"></a>          <span class="kw">generate</span> <span class="ot">`typlist'</span> <span class="ot">`varlist'</span> = <span class="ot">`p90'</span> - <span class="ot">`p10'</span> <span class="kw">if</span> <span class="ot">`touse'</span> } </span>
<span id="cb143-11"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb143-11" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb143-12"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb143-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-13"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb143-13" aria-hidden="true" tabindex="-1"></a>* Aplicación del programa</span>
<span id="cb143-14"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb143-14" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto, <span class="kw">clear</span></span>
<span id="cb143-15"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb143-15" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> rango9010 = pct9010(price)</span>
<span id="cb143-16"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb143-16" aria-hidden="true" tabindex="-1"></a><span class="kw">bysort</span> rep78 foreign: <span class="kw">egen</span> rango9010_prefijoby = pct9010(price)</span></code></pre></div>
<p>Generalización de la función egen para soportar todos los pares de cuantiles</p>
<ul>
<li>Hemos desarrollado una función de <code>egen</code> que permite calcular un rango entre percentiles para una lista de variables especifica.</li>
<li>Puede ser util tomar ventaja de <code>egen pctile()</code> para poder calcular cualquier percentil de la lista de variables especificadas.</li>
<li>Vamos a agregar dos opciones a la función <code>egen</code> : <code>lo()</code> y <code>hi()</code>. En caso de que no especifiquemos, por defecto se calcula el rango interquartil. La función de <code>egen</code> ahora se llamará <code>_gpctrange.ado</code>.</li>
</ul>
<p>Ejemplo 10: función <code>egen</code> más general</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb144-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb144-1" aria-hidden="true" tabindex="-1"></a>* Programa con opción <span class="kw">by</span>. </span>
<span id="cb144-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb144-2" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> <span class="kw">drop</span> <span class="dt">_all</span></span>
<span id="cb144-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb144-3" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> _gpctrange</span>
<span id="cb144-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb144-4" aria-hidden="true" tabindex="-1"></a><span class="kw">syntax</span> newvarname =/<span class="fu">exp</span> [<span class="kw">if</span>] [<span class="kw">in</span>] [, LO(integer 25) HI(integer 75) *] </span>
<span id="cb144-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb144-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb144-6" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="ot">`hi'</span> &gt; 99 | <span class="ot">`lo'</span> &lt; 1 {</span>
<span id="cb144-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb144-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> <span class="kw">error</span> <span class="co">///</span></span>
<span id="cb144-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb144-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Percentiles `lo' `hi' deben estar entre 1 y 99."</span> </span>
<span id="cb144-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb144-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">error</span> 198 </span>
<span id="cb144-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb144-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb144-11"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb144-11" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="ot">`hi'</span> &lt;= <span class="ot">`lo'</span> {</span>
<span id="cb144-12"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb144-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> <span class="kw">error</span> <span class="co">///</span></span>
<span id="cb144-13"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb144-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Percentiles `lo' `hi' deben estar en orden ascendente"</span></span>
<span id="cb144-14"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb144-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">error</span> 198 </span>
<span id="cb144-15"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb144-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb144-16"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb144-16" aria-hidden="true" tabindex="-1"></a><span class="kw">tempvar</span> touse phi plo </span>
<span id="cb144-17"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb144-17" aria-hidden="true" tabindex="-1"></a>mark <span class="ot">`touse'</span> <span class="ot">`if'</span> <span class="ot">`in'</span> </span>
<span id="cb144-18"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb144-18" aria-hidden="true" tabindex="-1"></a><span class="kw">quietly</span> {</span>
<span id="cb144-19"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb144-19" aria-hidden="true" tabindex="-1"></a>          <span class="kw">egen</span> <span class="kw">double</span> <span class="ot">`phi'</span> = <span class="kw">pctile</span>(<span class="ot">`exp'</span>) <span class="kw">if</span> <span class="ot">`touse'</span>, <span class="ot">`options'</span> <span class="kw">p</span>(<span class="ot">`hi'</span>) </span>
<span id="cb144-20"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb144-20" aria-hidden="true" tabindex="-1"></a>          <span class="kw">egen</span> <span class="kw">double</span> <span class="ot">`plo'</span> = <span class="kw">pctile</span>(<span class="ot">`exp'</span>) <span class="kw">if</span> <span class="ot">`touse'</span>, <span class="ot">`options'</span> <span class="kw">p</span>(<span class="ot">`lo'</span>)</span>
<span id="cb144-21"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb144-21" aria-hidden="true" tabindex="-1"></a>          <span class="kw">generate</span> <span class="ot">`typlist'</span> <span class="ot">`varlist'</span> = <span class="ot">`phi'</span> - <span class="ot">`plo'</span> <span class="kw">if</span> <span class="ot">`touse'</span> </span>
<span id="cb144-22"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb144-22" aria-hidden="true" tabindex="-1"></a>          } </span>
<span id="cb144-23"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb144-23" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb144-24"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb144-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-25"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb144-25" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto, <span class="kw">clear</span></span>
<span id="cb144-26"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb144-26" aria-hidden="true" tabindex="-1"></a><span class="kw">bysort</span> rep78: <span class="kw">egen</span> <span class="fu">iqr</span> = pctrange(price) <span class="kw">if</span> <span class="fu">inrange</span>(rep78,3,5)</span>
<span id="cb144-27"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb144-27" aria-hidden="true" tabindex="-1"></a><span class="kw">bysort</span> rep78: <span class="kw">egen</span> p8020 = pctrange(price) <span class="kw">if</span> <span class="fu">inrange</span>(rep78,3,5), hi(80) lo(20)</span>
<span id="cb144-28"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb144-28" aria-hidden="true" tabindex="-1"></a><span class="kw">tabstat</span> <span class="fu">iqr</span> <span class="kw">if</span> <span class="fu">inrange</span>(rep78, 3, 5), <span class="kw">by</span>(rep78)</span>
<span id="cb144-29"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb144-29" aria-hidden="true" tabindex="-1"></a><span class="kw">tabstat</span> p8020 <span class="kw">if</span> <span class="fu">inrange</span>(rep78, 3, 5), <span class="kw">by</span>(rep78)</span></code></pre></div>
</div>
</div>
<div id="programar-ado---files-parte-ii" class="section level2" number="2.5">
<h2>
<span class="header-section-number">2.5</span> Programar ado - files (Parte II)<a class="anchor" aria-label="anchor" href="#programar-ado---files-parte-ii"><i class="fas fa-link"></i></a>
</h2>
<div id="syntax" class="section level3" number="2.5.1">
<h3>
<span class="header-section-number">2.5.1</span> Syntax<a class="anchor" aria-label="anchor" href="#syntax"><i class="fas fa-link"></i></a>
</h3>
<p>Algunas consideraciones</p>
<ul>
<li>Como hemos visto hay dos formas en los que un programa de Stata puede interpretar lo que ingresamos.</li>
<li>Por posición tal como lo hace <code>args</code> o como lo hicimos con los números entre las comillas.<br>
</li>
<li>De acuerdo a la gramática del programa utilizando <code>syntax</code>.</li>
<li>
<code>syntax</code> guarda los componentes en macros locales particulares a las cuales podemos acceder posteriormente.</li>
<li>Por ejemplo <code>'if'</code> <code>'in'</code> <code>'varlist'</code> son macros locales a las que podemos acceder tal como vimos la clase pasada.</li>
<li>Ahora vamos a ver algunas opciones de <code>syntax</code> que nos permitirán tener más herramientas para escribir nuestros programas.</li>
<li>Al utilizar dentro de un programa paréntesis cuadrados estoy indicando que esas partes son opcionales.</li>
<li>Por ejemplo, estas dos versiones son equivalentes, salvo que en la segunda linea todo es opcional:</li>
</ul>
<div class="sourceCode" id="cb145"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb145-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb145-1" aria-hidden="true" tabindex="-1"></a>    * Nada opcional</span>
<span id="cb145-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb145-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">syntax</span> <span class="kw">varlist</span> <span class="kw">if</span> <span class="kw">in</span> <span class="bn">title</span>(<span class="fu">string</span>) <span class="kw">adjust</span>(<span class="fu">real</span> 1) </span>
<span id="cb145-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb145-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb145-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb145-4" aria-hidden="true" tabindex="-1"></a>    * Todo opcional</span>
<span id="cb145-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb145-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">syntax</span> [<span class="kw">varlist</span>] [<span class="kw">if</span>] [, <span class="kw">adjust</span> (<span class="fu">real</span> 1) <span class="bn">title</span>(<span class="fu">string</span>)]</span></code></pre></div>
<p>Vamos a mirar las macros generadas por syntax:</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb146-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="kw">capture</span> <span class="kw">program</span> <span class="kw">drop</span> myprog</span>
<span id="cb146-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb146-2" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> myprog </span>
<span id="cb146-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb146-3" aria-hidden="true" tabindex="-1"></a><span class="kw">syntax</span> <span class="kw">varlist</span> [<span class="kw">if</span>] [<span class="kw">in</span>] [, <span class="kw">adjust</span>(<span class="fu">real</span> 1) <span class="bn">title</span>(<span class="fu">string</span>)] </span>
<span id="cb146-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb146-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="st">"varlist contiene |`varlist'|"</span> </span>
<span id="cb146-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb146-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="st">"if contiene |`if'|"</span> </span>
<span id="cb146-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb146-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="st">"in contiene |`in'|"</span> </span>
<span id="cb146-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb146-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="st">"adjust contiene |`adjust'|"</span> </span>
<span id="cb146-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb146-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="st">"title contiene |`title'|"</span> </span>
<span id="cb146-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb146-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p>Vamos a aplicar lo aprendido en un ejemplo sencillo:</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb147-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="kw">capture</span> <span class="kw">program</span> <span class="kw">drop</span> miprograma</span>
<span id="cb147-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb147-2" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> miprograma</span>
<span id="cb147-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb147-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">syntax</span> <span class="kw">varlist</span> [<span class="kw">if</span>] [<span class="kw">in</span>] [, <span class="kw">adjust</span>(<span class="fu">real</span> 1) <span class="bn">title</span>(<span class="fu">string</span>)]</span>
<span id="cb147-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb147-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> </span>
<span id="cb147-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb147-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="st">"`title'"</span> != <span class="st">""</span> {</span>
<span id="cb147-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb147-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">display</span> <span class="st">"`title':"</span></span>
<span id="cb147-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb147-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb147-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb147-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="kw">var</span> <span class="kw">of</span> <span class="kw">local</span> <span class="kw">varlist</span>{</span>
<span id="cb147-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb147-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">quietly</span> <span class="kw">summarize</span> <span class="ot">`var'</span> <span class="ot">`if'</span> <span class="ot">`in'</span></span>
<span id="cb147-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb147-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">display</span> <span class="st">"`var'"</span> <span class="st">" "</span>%9.0g <span class="fu">r</span>(<span class="kw">mean</span>)*<span class="ot">`adjust'</span></span>
<span id="cb147-11"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb147-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb147-12"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb147-12" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p><code>marksample</code> y <code>touse</code>: Un error común es utilizar una muestra en una parte del programa y otra distinta en otra parte. La solución es crear una variable que contiene un 1 si la observación fue utilizada y un 0 en caso contrario.</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb148-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="kw">capture</span> <span class="kw">program</span> <span class="kw">drop</span> miprograma</span>
<span id="cb148-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb148-2" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> miprograma</span>
<span id="cb148-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb148-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">syntax</span> <span class="kw">varlist</span> [<span class="kw">if</span>] [<span class="kw">in</span>] [, <span class="kw">adjust</span>(<span class="fu">real</span> 1) <span class="bn">title</span>(<span class="fu">string</span>)]</span>
<span id="cb148-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb148-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">marksample</span> touse</span>
<span id="cb148-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb148-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> </span>
<span id="cb148-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb148-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="st">"`title'"</span> != <span class="st">""</span> {</span>
<span id="cb148-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb148-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">display</span> <span class="st">"`title':"</span></span>
<span id="cb148-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb148-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb148-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb148-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="kw">var</span> <span class="kw">of</span> <span class="kw">local</span> <span class="kw">varlist</span>{</span>
<span id="cb148-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb148-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">quietly</span> <span class="kw">summarize</span> <span class="ot">`var'</span> <span class="ot">`if'</span> <span class="ot">`touse'</span></span>
<span id="cb148-11"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb148-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">display</span> <span class="st">"`var'"</span> <span class="st">" "</span> <span class="fu">r</span>(<span class="kw">mean</span>)*<span class="ot">`adjust'</span></span>
<span id="cb148-12"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb148-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb148-13"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb148-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
</div>
<div id="varlist" class="section level3" number="2.5.2">
<h3>
<span class="header-section-number">2.5.2</span> Varlist<a class="anchor" aria-label="anchor" href="#varlist"><i class="fas fa-link"></i></a>
</h3>
<p><code>varlist</code> específica la macro que contiene las variables que van a ingresar al programa como <em>inputs</em>. Las opciones de <code>varlist</code> son:
* <code>default = none</code>. Especifica como la <code>varlist</code> se va a llenar. Por defecto se llena con todas las variables.
* <code>min</code>, <code>max</code> especifica el número de variables permitidas.
* <code>numeric</code>, <code>string</code> especifican que criterio deben cumplir <strong>todas</strong> las variables que ingresas al programa.
* <code>ts</code> permite que la <code>varlist</code> contenga operadores de series de tiempo.
* <code>fv</code> permite que la <code>varlist</code> contenga variables categóricas.</p>
</div>
<div id="opciones" class="section level3" number="2.5.3">
<h3>
<span class="header-section-number">2.5.3</span> Opciones<a class="anchor" aria-label="anchor" href="#opciones"><i class="fas fa-link"></i></a>
</h3>
<p>Las opciones permiten hacer requeridos o opcionales. Por ejemplo, <code>regress, noconstant</code>. Las opciones pueden ser una <code>numlist</code>, una <code>varlist</code> (ej. <code>by(varlist) option</code>, una <code>namelist</code> tal como el nombre de una matriz o de una nueva variable. Como regla general, cualquier característica que pudieran encontrar en un comando de Stata, la pueden agregar en un programa. Para las opciones es importante recordar que las mayúsculas indican la menor abreviación posible.</p>
<ul>
<li>
<code>replace</code>, <code>detail</code>, <code>constant</code> son opciones de <strong>on</strong>.</li>
<li>
<code>noreplace</code>, <code>nodetail</code>, <code>noconstant</code> son opciones de <strong>off</strong>. Ojo las macros que retornan tienen los mismos nombres que en el caso anterior.</li>
<li>
<code>title</code> y <code>adjust</code> también son otros opcionales. El primero permite ingresar un título al comando mientras que el segundo permite ajustar los resultados por algún escalar.</li>
<li>Hay muchas otras. Veamos un ejemplo…</li>
</ul>
<div class="sourceCode" id="cb149"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb149-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="kw">capture</span> <span class="kw">program</span> <span class="kw">drop</span> miprograma</span>
<span id="cb149-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> miprograma</span>
<span id="cb149-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb149-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">syntax</span> <span class="kw">varlist</span> [<span class="kw">if</span>] [<span class="kw">in</span>] [, <span class="kw">adjust</span>(<span class="fu">real</span> 1) <span class="bn">title</span>(<span class="fu">string</span>)]</span>
<span id="cb149-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb149-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> </span>
<span id="cb149-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb149-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="st">"`title'"</span> != <span class="st">""</span> {</span>
<span id="cb149-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb149-6" aria-hidden="true" tabindex="-1"></a>        displa <span class="st">"`title':"</span></span>
<span id="cb149-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb149-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb149-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb149-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="kw">var</span> <span class="kw">of</span> <span class="kw">local</span> <span class="kw">varlist</span>{</span>
<span id="cb149-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb149-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">quietly</span> <span class="kw">summarize</span> <span class="ot">`var'</span> <span class="ot">`if'</span> <span class="ot">`in'</span></span>
<span id="cb149-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb149-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">display</span> <span class="st">"`var'"</span> <span class="st">" "</span>%9.0g <span class="fu">r</span>(<span class="kw">mean</span>)*<span class="ot">`adjust'</span></span>
<span id="cb149-11"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb149-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb149-12"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb149-12" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
</div>
<div id="programa-para-calcular-percentiles" class="section level3" number="2.5.4">
<h3>
<span class="header-section-number">2.5.4</span> Programa para calcular percentiles<a class="anchor" aria-label="anchor" href="#programa-para-calcular-percentiles"><i class="fas fa-link"></i></a>
</h3>
<p>Una versión simple para una variable:</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb150-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> pctrange, rclass </span>
<span id="cb150-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb150-2" aria-hidden="true" tabindex="-1"></a><span class="kw">version</span> 17 </span>
<span id="cb150-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb150-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">syntax</span> <span class="kw">varlist</span>(<span class="fu">max</span> = 1 <span class="kw">numeric</span>)</span>
<span id="cb150-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb150-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">quietly</span> <span class="kw">summarize</span> <span class="ot">`varlist'</span>, <span class="kw">detail</span> </span>
<span id="cb150-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb150-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="kw">range</span> = <span class="fu">r</span>(<span class="fu">max</span>) - <span class="fu">r</span>(<span class="fu">min</span>)</span>
<span id="cb150-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb150-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> p7525 = <span class="fu">r</span>(p75) - <span class="fu">r</span>(p25)</span>
<span id="cb150-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb150-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> p9010 = <span class="fu">r</span>(p90) - <span class="fu">r</span>(p10)</span>
<span id="cb150-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb150-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> result <span class="dt">_n</span> <span class="st">"Rangos de percentiles para `varlist'"</span></span>
<span id="cb150-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb150-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">"75-25 : "</span> p7525</span>
<span id="cb150-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb150-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">"90-10:  "</span> p9010 </span>
<span id="cb150-11"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb150-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">"Range: "</span> <span class="kw">range</span></span>
<span id="cb150-12"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb150-12" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> </span></code></pre></div>
<p>Algunas consideraciones</p>
<ul>
<li>El programa anterior nos permite obtener los percentiles de alguna variable al mismo tiempo que los muestra en la consola.</li>
<li>Noten que también he incluido que tipo de comando es. En este caso es un comando <code>r-class</code>.</li>
<li>Los escalares definidos en el programa se pueden utilizar. Esto no siempre es conveniente.</li>
<li>Como recomendación es bueno <strong>guardar los resultados esperados de los programas como variables temporales</strong>.</li>
</ul>
<p>Versión que incluye variables guardadas localmente:</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb151-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> pctrange, rclass </span>
<span id="cb151-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb151-2" aria-hidden="true" tabindex="-1"></a><span class="kw">version</span> 17 </span>
<span id="cb151-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb151-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">syntax</span> <span class="kw">varlist</span>(<span class="fu">max</span> = 1 <span class="kw">numeric</span>)</span>
<span id="cb151-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb151-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span> res <span class="st">"range p7525 p9010"</span></span>
<span id="cb151-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb151-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">tempname</span> <span class="ot">`res'</span>    </span>
<span id="cb151-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb151-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> result <span class="dt">_n</span> <span class="st">"Rangos de percentiles para `varlist'"</span></span>
<span id="cb151-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb151-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">quietly</span> <span class="kw">summarize</span> <span class="ot">`varlist'</span>, <span class="kw">detail</span> </span>
<span id="cb151-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb151-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`range'</span> = <span class="fu">r</span>(<span class="fu">max</span>) - <span class="fu">r</span>(<span class="fu">min</span>)</span>
<span id="cb151-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb151-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`p7525'</span> = <span class="fu">r</span>(p75) - <span class="fu">r</span>(p25)</span>
<span id="cb151-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb151-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`p9010'</span> = <span class="fu">r</span>(p90) - <span class="fu">r</span>(p10)</span>
<span id="cb151-11"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb151-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">"75-25 : "</span> <span class="ot">`p7525'</span></span>
<span id="cb151-12"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb151-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">"90-10:  "</span> <span class="ot">`p9010'</span></span>
<span id="cb151-13"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb151-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">"Range: "</span> <span class="ot">`range'</span></span></code></pre></div>
</div>
<div id="programa-con-opción-return" class="section level3" number="2.5.5">
<h3>
<span class="header-section-number">2.5.5</span> Programa con opción return<a class="anchor" aria-label="anchor" href="#programa-con-opci%C3%B3n-return"><i class="fas fa-link"></i></a>
</h3>
<p>Una característica importante de los comandos de Stata es su <strong>capacidad de reportar los resultados</strong> de forma tal de que los usuarios y usuarias podamos utilizarlos posteriormente. El comando <code>return</code> nos permite guardar los escalares y hacerlos accesibles, sin tener el problema de los escalares que vimos en los ejemplos anteriores.</p>
<p>Programa para calcular percentiles con return:</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb152-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> pctrange, rclass </span>
<span id="cb152-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb152-2" aria-hidden="true" tabindex="-1"></a><span class="kw">version</span> 17 </span>
<span id="cb152-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb152-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">syntax</span> <span class="kw">varlist</span>(<span class="fu">max</span> = 1 <span class="kw">numeric</span>)</span>
<span id="cb152-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb152-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span> res <span class="st">"range p7525 p9010"</span></span>
<span id="cb152-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb152-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">tempname</span> <span class="ot">`res'</span>    </span>
<span id="cb152-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb152-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> result <span class="dt">_n</span> <span class="st">"Rangos de percentiles para `varlist'"</span></span>
<span id="cb152-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb152-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">quietly</span> <span class="kw">summarize</span> <span class="ot">`varlist'</span>, <span class="kw">detail</span> </span>
<span id="cb152-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb152-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`range'</span> = <span class="fu">r</span>(<span class="fu">max</span>) - <span class="fu">r</span>(<span class="fu">min</span>)</span>
<span id="cb152-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb152-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`p7525'</span> = <span class="fu">r</span>(p75) - <span class="fu">r</span>(p25)</span>
<span id="cb152-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb152-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`p9010'</span> = <span class="fu">r</span>(p90) - <span class="fu">r</span>(p10)</span>
<span id="cb152-11"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb152-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">"75-25 : "</span> <span class="ot">`p7525'</span></span>
<span id="cb152-12"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb152-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">"90-10:  "</span> <span class="ot">`p9010 '</span></span>
<span id="cb152-13"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb152-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">"Range: "</span> <span class="ot">`range'</span></span>
<span id="cb152-14"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb152-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="fu">r</span> <span class="kw">of</span> <span class="kw">local</span> res {</span>
<span id="cb152-15"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb152-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span> <span class="fu">scalar</span> <span class="ot">`r'</span> = <span class="ot">``r'</span>'</span>
<span id="cb152-16"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb152-16" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb152-17"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb152-17" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> </span></code></pre></div>
<p>Sobre la forma en que llamamos a return:</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb153-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb153-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="fu">r</span> <span class="kw">of</span> <span class="kw">local</span> res {</span>
<span id="cb153-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb153-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span> <span class="fu">scalar</span> <span class="ot">`r'</span> = <span class="ot">``r'</span>'</span>
<span id="cb153-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb153-3" aria-hidden="true" tabindex="-1"></a>    }</span></code></pre></div>
<p>Notar que el lado izquierdo de <code>scalar('r')</code> se refiere al nombre de los elementos de la macro <code>res</code>. El lado derecho hace referencia a la macro una vez más para extraer el valor almacenado en ese nombre. En este caso es importante notar que se deben utilizar dos comillas (ej. <code>"range"</code>). Noten también que si utilizamos <code>scalar list</code> no hay resultados, sin embargo, al utilizar la opción <strong>return</strong> ahora podemos rescatar los resultados con <code>return list</code>.</p>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.6.3: </b></p>
<p>Preguntas</p>
<ol style="list-style-type: decimal">
<li>Escriba un programa llamado <code>misuma</code> que sea del tipo <code>r-class</code>.</li>
<li>Este programa debe entregar en la lista de <code>return list</code> el número total de observaciones, la suma total y el promedio de la variable.</li>
<li>Aplicarla en <code>auto.dta</code>.</li>
</ol>
</div>
</div>
<div id="agregar-opciones-al-programa" class="section level3" number="2.5.6">
<h3>
<span class="header-section-number">2.5.6</span> Agregar opciones al programa<a class="anchor" aria-label="anchor" href="#agregar-opciones-al-programa"><i class="fas fa-link"></i></a>
</h3>
<p>Podemos agregar distintas opciones al programa. Para este ejemplo vamos a agregar como opcional que el programa de un resultado en la consola. Recordemos que incluir <span class="math inline">\([ ]\)</span> en <code>syntax</code> significa un componente <strong>opcional</strong> en el comando.</p>
<p>Implementar opciones al programa (imprimir por defecto):</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb154-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> pctrange, rclass </span>
<span id="cb154-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb154-2" aria-hidden="true" tabindex="-1"></a><span class="kw">version</span> 17 </span>
<span id="cb154-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb154-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">syntax</span> <span class="kw">varlist</span>(<span class="fu">max</span> = 1 <span class="kw">numeric</span>) [, PRINT]</span>
<span id="cb154-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb154-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span> res <span class="st">"range p7525 p9010"</span></span>
<span id="cb154-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb154-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">tempname</span> <span class="ot">`res'</span>    </span>
<span id="cb154-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb154-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> result <span class="dt">_n</span> <span class="st">"Rangos de percentiles para `varlist'"</span></span>
<span id="cb154-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb154-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">quietly</span> <span class="kw">summarize</span> <span class="ot">`varlist'</span>, <span class="kw">detail</span> </span>
<span id="cb154-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb154-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`range'</span> = <span class="fu">r</span>(<span class="fu">max</span>) - <span class="fu">r</span>(<span class="fu">min</span>)</span>
<span id="cb154-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb154-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`p7525'</span> = <span class="fu">r</span>(p75) - <span class="fu">r</span>(p25)</span>
<span id="cb154-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb154-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`p9010'</span> = <span class="fu">r</span>(p90) - <span class="fu">r</span>(p10)</span>
<span id="cb154-11"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb154-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="st">"`print'"</span> == <span class="st">"print"</span> {</span>
<span id="cb154-12"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb154-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">"75-25 : "</span> <span class="ot">`p7525'</span></span>
<span id="cb154-13"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb154-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">"90-10:  "</span> <span class="ot">`p9010 '</span></span>
<span id="cb154-14"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb154-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">"Range: "</span> <span class="ot">`range'</span></span>
<span id="cb154-15"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb154-15" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb154-16"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb154-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="fu">r</span> <span class="kw">of</span> <span class="kw">local</span> res {</span>
<span id="cb154-17"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb154-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span> <span class="fu">scalar</span> <span class="ot">`r'</span> = <span class="ot">``r'</span>'</span>
<span id="cb154-18"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb154-18" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb154-19"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb154-19" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> </span></code></pre></div>
<p>Implementar opciones al programa (no imprimir por defecto):</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb155-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> pctrange, rclass </span>
<span id="cb155-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb155-2" aria-hidden="true" tabindex="-1"></a><span class="kw">version</span> 17 </span>
<span id="cb155-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb155-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">syntax</span> <span class="kw">varlist</span>(<span class="fu">max</span> = 1 <span class="kw">numeric</span>) [, noPRINT]</span>
<span id="cb155-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb155-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span> res <span class="st">"range p7525 p9010"</span></span>
<span id="cb155-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb155-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">tempname</span> <span class="ot">`res'</span>    </span>
<span id="cb155-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb155-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> result <span class="dt">_n</span> <span class="st">"Rangos de percentiles para `varlist'"</span></span>
<span id="cb155-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb155-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">quietly</span> <span class="kw">summarize</span> <span class="ot">`varlist'</span>, <span class="kw">detail</span> </span>
<span id="cb155-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb155-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`range'</span> = <span class="fu">r</span>(<span class="fu">max</span>) - <span class="fu">r</span>(<span class="fu">min</span>)</span>
<span id="cb155-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb155-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`p7525'</span> = <span class="fu">r</span>(p75) - <span class="fu">r</span>(p25)</span>
<span id="cb155-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb155-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`p9010'</span> = <span class="fu">r</span>(p90) - <span class="fu">r</span>(p10)</span>
<span id="cb155-11"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb155-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="st">"`print'"</span> != <span class="st">"noprint"</span> {</span>
<span id="cb155-12"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb155-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">"75-25 : "</span> <span class="ot">`p7525'</span></span>
<span id="cb155-13"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb155-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">"90-10:  "</span> <span class="ot">`p9010 '</span></span>
<span id="cb155-14"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb155-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">"Range: "</span> <span class="ot">`range'</span></span>
<span id="cb155-15"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb155-15" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb155-16"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb155-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="fu">r</span> <span class="kw">of</span> <span class="kw">local</span> res {</span>
<span id="cb155-17"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb155-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span> <span class="fu">scalar</span> <span class="ot">`r'</span> = <span class="ot">``r'</span>'</span>
<span id="cb155-18"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb155-18" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb155-19"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb155-19" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> </span></code></pre></div>
<p>Incluir un subconjunto de observaciones</p>
<ul>
<li>Cualquier comando debiese incluir <code>if</code> o <code>in range</code>.</li>
<li>Nuevamente, estas opciones son manejadas dentro del comando <code>syntax</code>. Para incluir estas opciones hay que agregar <code>[if]</code> y <code>[in]</code>.</li>
<li>Con estos comandos puedo ejecutar el programa para sub-muestras. Es importante asegurar que la sub-muestra no este vacía.</li>
<li>Para ello es importante calcular <code>r(N)</code>, chequear que sea distinto de cero y agregar un título que lo indique.</li>
<li>El comando <code>marksample touse</code> utiliza la información provista por <code>if</code> o <code>in</code> en caso de que estos sean indicados en el programa.</li>
<li>Este comando genera una variable local <code>touse</code> que es igual a 1 si las variables entran en el calculo que hace el programa y 0 en caso contrario.</li>
<li>Utilizaremos `<code>touse'</code> para calcular el número de observaciones que se utilizan después de aplicar los condicionales.</li>
<li>Es necesario agregar `<code>touse'</code> en cada parte del programa que trabaje con la variable de <em>input</em>.</li>
</ul>
<p>Incluir un subconjunto de observaciones:</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb156-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> <span class="kw">drop</span> <span class="dt">_all</span> </span>
<span id="cb156-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb156-2" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> pctrange, rclass </span>
<span id="cb156-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb156-3" aria-hidden="true" tabindex="-1"></a><span class="kw">syntax</span> <span class="kw">varlist</span>(<span class="fu">max</span> = 1 <span class="kw">numeric</span>) [<span class="kw">if</span>] [<span class="kw">in</span>] [, noPRINT]</span>
<span id="cb156-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb156-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">marksample</span> touse </span>
<span id="cb156-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb156-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">quietly</span> <span class="fu">count</span> <span class="kw">if</span> <span class="ot">`touse'</span></span>
<span id="cb156-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb156-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="ot">`r(N)'</span> == 0 {</span>
<span id="cb156-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb156-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">error</span> 2000</span>
<span id="cb156-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb156-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb156-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb156-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span> res <span class="kw">range</span> p7525 p9010</span>
<span id="cb156-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb156-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">tempname</span> <span class="ot">`res'</span>    </span>
<span id="cb156-11"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb156-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb156-12"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb156-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">quietly</span> <span class="kw">summarize</span> <span class="ot">`varlist'</span> <span class="kw">if</span> <span class="ot">`touse'</span>, <span class="kw">detail</span> </span>
<span id="cb156-13"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb156-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`range'</span> = <span class="fu">r</span>(<span class="fu">max</span>) - <span class="fu">r</span>(<span class="fu">min</span>)</span>
<span id="cb156-14"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb156-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`p7525'</span> = <span class="fu">r</span>(p75) - <span class="fu">r</span>(p25)</span>
<span id="cb156-15"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb156-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scalar</span> <span class="ot">`p9010'</span> = <span class="fu">r</span>(p90) - <span class="fu">r</span>(p10)</span>
<span id="cb156-16"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb156-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="st">"`print'"</span> != <span class="st">"noprint"</span> {</span>
<span id="cb156-17"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb156-17" aria-hidden="true" tabindex="-1"></a>        <span class="kw">display</span> <span class="kw">as</span> result <span class="dt">_n</span> <span class="st">"Rangos de percentiles para `varlist', N = `r(N)'"</span></span>
<span id="cb156-18"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb156-18" aria-hidden="true" tabindex="-1"></a>        <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">"75-25 : "</span> <span class="ot">`p7525'</span></span>
<span id="cb156-19"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb156-19" aria-hidden="true" tabindex="-1"></a>        <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">"90-10:  "</span> <span class="ot">`p9010 '</span></span>
<span id="cb156-20"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb156-20" aria-hidden="true" tabindex="-1"></a>        <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">"Range: "</span> <span class="ot">`range'</span></span>
<span id="cb156-21"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb156-21" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb156-22"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb156-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="fu">r</span> <span class="kw">of</span> <span class="kw">local</span> res {</span>
<span id="cb156-23"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb156-23" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span> <span class="fu">scalar</span> <span class="ot">`r'</span> = <span class="ot">``r'</span>'</span>
<span id="cb156-24"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb156-24" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb156-25"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb156-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span> <span class="fu">scalar</span> <span class="kw">N</span> = <span class="fu">r</span>(<span class="kw">N</span>)</span>
<span id="cb156-26"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb156-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span> <span class="kw">local</span> varname <span class="ot">`varlist'</span></span>
<span id="cb156-27"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb156-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-28"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb156-28" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> </span></code></pre></div>
<div class="alert alert-block alert-warning">
<p><b>Ejercicio 3.6.2: </b></p>
<p>Preguntas</p>
<ol style="list-style-type: decimal">
<li>Ajuste el programa del ejercicio 1 con el fin de incluir la opción <code>if</code>. Guárdelo como <code>misuma2</code>.</li>
<li>Aplicarla en <code>auto.dta</code>.</li>
</ol>
</div>
</div>
<div id="generalizar-el-comando-para-incluir-múltiples-variables-1" class="section level3" number="2.5.7">
<h3>
<span class="header-section-number">2.5.7</span> Generalizar el comando para incluir múltiples variables<a class="anchor" aria-label="anchor" href="#generalizar-el-comando-para-incluir-m%C3%BAltiples-variables-1"><i class="fas fa-link"></i></a>
</h3>
<p>Algunas consideraciones</p>
<ul>
<li>Si quiero ejecutar el programa sobre múltiples variables, es necesario ajustar un poco el programa.</li>
<li>Tengo que indicarle a <code>syntax</code> que hay más de una variable. Además, tengo que indicarle al programa que en caso de que existan más variables muestre los resultados en una tabla.</li>
<li>Guardaremos los resultados en matrices (no escalares) y vamos a aplicar una <strong>función de macro extendida</strong> con el fin de contar el número de filas que esta matriz debiese tener.</li>
<li>Agregaremos también una la opción <code>format</code> para cambiar el formato y la opción <code>mat</code> que permite a la matriz ser guardada automáticamente con el nombre indicado.</li>
</ul>
<div class="sourceCode" id="cb157"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb157-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> <span class="kw">drop</span> <span class="dt">_all</span> </span>
<span id="cb157-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-2" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> pctrange, rclass</span>
<span id="cb157-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-3" aria-hidden="true" tabindex="-1"></a><span class="kw">version</span> 17 </span>
<span id="cb157-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">syntax</span> <span class="kw">varlist</span>(<span class="fu">min</span> = 1 <span class="kw">numeric</span> ts) [<span class="kw">if</span>] [<span class="kw">in</span>] [, noPRINT FORmat(passthru) MATrix(<span class="fu">string</span>)] </span>
<span id="cb157-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">marksample</span> touse </span>
<span id="cb157-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">quietly</span> <span class="fu">count</span> <span class="kw">if</span> <span class="ot">`touse'</span></span>
<span id="cb157-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="ot">`r(N)'</span> == 0 {</span>
<span id="cb157-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">error</span> 2000</span>
<span id="cb157-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb157-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span> nvar: <span class="fu">word</span> <span class="fu">count</span> <span class="ot">`varlist'</span></span>
<span id="cb157-11"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="ot">`nvar'</span> == 1 {</span>
<span id="cb157-12"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-12" aria-hidden="true" tabindex="-1"></a>        <span class="kw">local</span> res <span class="kw">range</span> p7525 p9010</span>
<span id="cb157-13"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">tempname</span> <span class="ot">`res'</span>    </span>
<span id="cb157-14"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb157-15"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">quietly</span> <span class="kw">summarize</span> <span class="ot">`varlist'</span> <span class="kw">if</span> <span class="ot">`touse'</span>, <span class="kw">detail</span> </span>
<span id="cb157-16"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scalar</span> <span class="ot">`range'</span> = <span class="fu">r</span>(<span class="fu">max</span>) - <span class="fu">r</span>(<span class="fu">min</span>)</span>
<span id="cb157-17"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scalar</span> <span class="ot">`p7525'</span> = <span class="fu">r</span>(p75) - <span class="fu">r</span>(p25)</span>
<span id="cb157-18"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-18" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scalar</span> <span class="ot">`p9010'</span> = <span class="fu">r</span>(p90) - <span class="fu">r</span>(p10)</span>
<span id="cb157-19"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-19" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="st">"`print'"</span> != <span class="st">"noprint"</span> {</span>
<span id="cb157-20"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-20" aria-hidden="true" tabindex="-1"></a>            <span class="kw">display</span> <span class="kw">as</span> result <span class="dt">_n</span> <span class="st">"Rangos de percentiles para `varlist', N = `r(N)'"</span></span>
<span id="cb157-21"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-21" aria-hidden="true" tabindex="-1"></a>            <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">"75-25 : "</span> <span class="ot">`p7525'</span></span>
<span id="cb157-22"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-22" aria-hidden="true" tabindex="-1"></a>            <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">"90-10:  "</span> <span class="ot">`p9010 '</span></span>
<span id="cb157-23"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-23" aria-hidden="true" tabindex="-1"></a>            <span class="kw">display</span> <span class="kw">as</span> txt <span class="st">"Range: "</span> <span class="ot">`range'</span></span>
<span id="cb157-24"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb157-25"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-25" aria-hidden="true" tabindex="-1"></a>        <span class="kw">foreach</span> <span class="fu">r</span> <span class="kw">of</span> <span class="kw">local</span> res {</span>
<span id="cb157-26"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-26" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span> <span class="fu">scalar</span> <span class="ot">`r'</span> = <span class="ot">``r'</span>'</span>
<span id="cb157-27"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-27" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb157-28"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span> <span class="fu">scalar</span> <span class="kw">N</span> = <span class="fu">r</span>(<span class="kw">N</span>)</span>
<span id="cb157-29"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-29" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb157-30"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">else</span> {</span>
<span id="cb157-31"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">tempname</span> rmat </span>
<span id="cb157-32"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">matrix</span> <span class="ot">`rmat'</span> = <span class="fu">J</span>(<span class="ot">`nvar'</span>, 3, .)</span>
<span id="cb157-33"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-33" aria-hidden="true" tabindex="-1"></a>      <span class="kw">local</span> i 0 </span>
<span id="cb157-34"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-34" aria-hidden="true" tabindex="-1"></a>        <span class="kw">foreach</span> v <span class="kw">of</span> <span class="kw">varlist</span> <span class="ot">`varlist'</span>{</span>
<span id="cb157-35"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-35" aria-hidden="true" tabindex="-1"></a>        <span class="kw">local</span> ++i </span>
<span id="cb157-36"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-36" aria-hidden="true" tabindex="-1"></a>        <span class="kw">quietly</span> <span class="kw">summarize</span> <span class="ot">`v'</span> <span class="kw">if</span> <span class="ot">`touse'</span>, <span class="kw">detail</span> </span>
<span id="cb157-37"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-37" aria-hidden="true" tabindex="-1"></a>        <span class="fu">matrix</span> <span class="ot">`rmat'</span>[<span class="ot">`i'</span> ,1] = <span class="fu">r</span>(<span class="fu">max</span>) - <span class="fu">r</span>(<span class="fu">min</span>)</span>
<span id="cb157-38"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-38" aria-hidden="true" tabindex="-1"></a>        <span class="fu">matrix</span> <span class="ot">`rmat'</span>[<span class="ot">`i'</span>, 2] = <span class="fu">r</span>(p75) - <span class="fu">r</span>(p25)</span>
<span id="cb157-39"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-39" aria-hidden="true" tabindex="-1"></a>        <span class="fu">matrix</span> <span class="ot">`rmat'</span>[<span class="ot">`i'</span>, 3] = <span class="fu">r</span>(p90) - <span class="fu">r</span>(p10)</span>
<span id="cb157-40"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-40" aria-hidden="true" tabindex="-1"></a>        <span class="kw">local</span> <span class="ot">rown</span> <span class="ot">`rown'</span> <span class="ot">`v'</span></span>
<span id="cb157-41"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-41" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb157-42"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-42" aria-hidden="true" tabindex="-1"></a>      <span class="fu">matrix</span> <span class="ot">colnames</span> <span class="ot">`rmat'</span> = Range P75-P25 P90-P10 </span>
<span id="cb157-43"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-43" aria-hidden="true" tabindex="-1"></a>      <span class="fu">matrix</span> <span class="ot">rownames</span> <span class="ot">`rmat'</span> = <span class="ot">`rown'</span> </span>
<span id="cb157-44"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-45"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-45" aria-hidden="true" tabindex="-1"></a>      <span class="kw">if</span> <span class="st">"`print'"</span> != <span class="st">"noprint"</span> {</span>
<span id="cb157-46"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-46" aria-hidden="true" tabindex="-1"></a>          <span class="kw">local</span> form <span class="st">", noheader"</span></span>
<span id="cb157-47"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-47" aria-hidden="true" tabindex="-1"></a>          <span class="kw">if</span> <span class="st">"`format'"</span> != <span class="st">""</span> {</span>
<span id="cb157-48"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-48" aria-hidden="true" tabindex="-1"></a>                <span class="kw">local</span> form <span class="st">"`form' `format'"</span> </span>
<span id="cb157-49"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-49" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb157-50"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-50" aria-hidden="true" tabindex="-1"></a>          <span class="fu">matrix</span> <span class="ot">list</span> <span class="ot">`rmat'</span> <span class="ot">`form'</span></span>
<span id="cb157-51"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-51" aria-hidden="true" tabindex="-1"></a>                                }</span>
<span id="cb157-52"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-53"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-53" aria-hidden="true" tabindex="-1"></a>      <span class="kw">if</span> <span class="st">"`matrix'"</span> != <span class="st">""</span> {</span>
<span id="cb157-54"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-54" aria-hidden="true" tabindex="-1"></a>            <span class="fu">matrix</span> <span class="ot">`matrix'</span> = <span class="ot">`rmat'</span></span>
<span id="cb157-55"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-55" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb157-56"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-56" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span> <span class="fu">matrix</span> rmat = <span class="ot">`rmat'</span></span>
<span id="cb157-57"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-57" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb157-58"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-58" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span> <span class="kw">local</span> varname <span class="ot">`varlist'</span></span>
<span id="cb157-59"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb157-59" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
</div>
<div id="agregar-prefijos-a-los-programas-1" class="section level3" number="2.5.8">
<h3>
<span class="header-section-number">2.5.8</span> Agregar prefijos a los programas<a class="anchor" aria-label="anchor" href="#agregar-prefijos-a-los-programas-1"><i class="fas fa-link"></i></a>
</h3>
<p>prefijo by: Ahora vamos a hacer que nuestro programa pueda utilizar el prefijo <code>by</code>. Para agregar esta opción simplemente hay que modificar <code>program</code>.</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb158-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> pctrange, rclass byable(recall)</span></code></pre></div>
<p>También podemos permitir que la lista de variables incluya <strong>operadores de series de tiempo</strong> (ej. <code>L.pib</code>, <code>D.ingreso</code>).</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb159-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="kw">syntax</span> <span class="kw">varlist</span>(<span class="fu">min</span> = 1 <span class="kw">numeric</span> ts) </span></code></pre></div>
</div>
<div id="programas-para-complementar-función-egen-1" class="section level3" number="2.5.9">
<h3>
<span class="header-section-number">2.5.9</span> Programas para complementar función egen<a class="anchor" aria-label="anchor" href="#programas-para-complementar-funci%C3%B3n-egen-1"><i class="fas fa-link"></i></a>
</h3>
<p>Es posible programar funciones adicionales de <code>egen</code> (<em>extended generate</em>). El nombre de estos programas deben empezar con <code>_g</code>. Una diferencia entre este tipo de programas y los ya hechos es que en estos hay que tener en cuenta la nueva variable que se va a crear. La sintaxis es la siguiente:</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb160-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> [<span class="dv">type</span>] newvarname = fcn(arguments) [<span class="kw">if</span>] [<span class="kw">in</span>] [, options]</span></code></pre></div>
<p>El cambio que vamos a hacer en la sintaxis del programa será que incluiremos un <code>touse</code> para hacer la nueva variable.</p>
<p>Vamos a escribir un programa para calcular un rango en particular:</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb161-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb161-1" aria-hidden="true" tabindex="-1"></a>* Programas <span class="kw">de</span> <span class="kw">egen</span> </span>
<span id="cb161-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb161-2" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> <span class="kw">drop</span> <span class="dt">_all</span></span>
<span id="cb161-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb161-3" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> _gpct9010</span>
<span id="cb161-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb161-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">syntax</span> newvarname =/<span class="fu">exp</span> [<span class="kw">if</span>] [<span class="kw">in</span>] </span>
<span id="cb161-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb161-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">tempvar</span> touse </span>
<span id="cb161-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb161-6" aria-hidden="true" tabindex="-1"></a>    mark <span class="ot">`touse'</span> <span class="ot">`if'</span> <span class="ot">`in'</span> </span>
<span id="cb161-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb161-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">quietly</span> <span class="kw">summarize</span> <span class="ot">`exp'</span> <span class="kw">if</span> <span class="ot">`touse'</span>, <span class="kw">detail</span> </span>
<span id="cb161-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb161-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">quietly</span> <span class="kw">generate</span> <span class="ot">`typlist'</span> <span class="ot">`varlist'</span> = <span class="fu">r</span>(p90) - <span class="fu">r</span>(p10) <span class="kw">if</span> <span class="ot">`touse'</span></span>
<span id="cb161-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb161-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb161-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb161-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-11"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb161-11" aria-hidden="true" tabindex="-1"></a>* Aplicación del programa</span>
<span id="cb161-12"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb161-12" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto, <span class="kw">clear</span></span>
<span id="cb161-13"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb161-13" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> rango9010 = pct9010(price)</span></code></pre></div>
<p>Programas con funciones de egen con prefijo by:</p>
<ul>
<li>Agregamos [, *] que corresponde a las opciones. En <code>egen</code>el prefijo <code>by</code> es una opción.</li>
<li>Con el fin de permitirle al programa que pueda producir un rango de percentil separado para distintos grupos utilizaremos <code>pctile</code> en vez de <code>summarize</code>.</li>
</ul>
<div class="sourceCode" id="cb162"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb162-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb162-1" aria-hidden="true" tabindex="-1"></a>* Programa con opción <span class="kw">by</span>. </span>
<span id="cb162-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb162-2" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> <span class="kw">drop</span> <span class="dt">_all</span></span>
<span id="cb162-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb162-3" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> _gpct9010</span>
<span id="cb162-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb162-4" aria-hidden="true" tabindex="-1"></a><span class="kw">syntax</span> newvarname =/<span class="fu">exp</span> [<span class="kw">if</span>] [<span class="kw">in</span>] [, *] </span>
<span id="cb162-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb162-5" aria-hidden="true" tabindex="-1"></a><span class="kw">tempvar</span> touse p90 p10 </span>
<span id="cb162-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb162-6" aria-hidden="true" tabindex="-1"></a>mark <span class="ot">`touse'</span> <span class="ot">`if'</span> <span class="ot">`in'</span> </span>
<span id="cb162-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb162-7" aria-hidden="true" tabindex="-1"></a><span class="kw">quietly</span> {</span>
<span id="cb162-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb162-8" aria-hidden="true" tabindex="-1"></a>          <span class="kw">egen</span> <span class="kw">double</span> <span class="ot">`p90'</span> = <span class="kw">pctile</span>(<span class="ot">`exp'</span>) <span class="kw">if</span> <span class="ot">`touse'</span>, <span class="ot">`options'</span> <span class="kw">p</span>(90) </span>
<span id="cb162-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb162-9" aria-hidden="true" tabindex="-1"></a>          <span class="kw">egen</span> <span class="kw">double</span> <span class="ot">`p10'</span> = <span class="kw">pctile</span>(<span class="ot">`exp'</span>) <span class="kw">if</span> <span class="ot">`touse'</span>, <span class="ot">`options'</span> <span class="kw">p</span>(10)</span>
<span id="cb162-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb162-10" aria-hidden="true" tabindex="-1"></a>          <span class="kw">generate</span> <span class="ot">`typlist'</span> <span class="ot">`varlist'</span> = <span class="ot">`p90'</span> - <span class="ot">`p10'</span> <span class="kw">if</span> <span class="ot">`touse'</span> } </span>
<span id="cb162-11"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb162-11" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb162-12"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb162-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-13"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb162-13" aria-hidden="true" tabindex="-1"></a>* Aplicación del programa</span>
<span id="cb162-14"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb162-14" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto, <span class="kw">clear</span></span>
<span id="cb162-15"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb162-15" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> rango9010 = pct9010(price)</span>
<span id="cb162-16"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb162-16" aria-hidden="true" tabindex="-1"></a><span class="kw">bysort</span> rep78 foreign: <span class="kw">egen</span> rango9010_prefijoby = pct9010(price)</span></code></pre></div>
</div>
<div id="generalización-de-la-función-egen" class="section level3" number="2.5.10">
<h3>
<span class="header-section-number">2.5.10</span> Generalización de la función egen<a class="anchor" aria-label="anchor" href="#generalizaci%C3%B3n-de-la-funci%C3%B3n-egen"><i class="fas fa-link"></i></a>
</h3>
<p>Hemos desarrollado una función de <code>egen</code> que permite calcular un rango entre percentiles para una lista de variables especifica. Puede ser útil tomar ventaja de <code>egen pctile()</code> para poder calcular cualquier percentil de la lista de variables especificadas. Vamos a agregar dos opciones a la función <code>egen</code> : <code>lo()</code> y <code>hi()</code>. En caso de que no especifiquemos, por defecto se calcula el rango interquartil. La función de <code>egen</code> ahora se llamará <code>_gpctrange.ado</code>.</p>
<p>Función egen más general para percentiles:</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb163-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb163-1" aria-hidden="true" tabindex="-1"></a>* Programa con opción <span class="kw">by</span>. </span>
<span id="cb163-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb163-2" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> <span class="kw">drop</span> <span class="dt">_all</span></span>
<span id="cb163-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb163-3" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> _gpctrange</span>
<span id="cb163-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb163-4" aria-hidden="true" tabindex="-1"></a><span class="kw">syntax</span> newvarname =/<span class="fu">exp</span> [<span class="kw">if</span>] [<span class="kw">in</span>] [, LO(integer 25) HI(integer 75) *] </span>
<span id="cb163-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb163-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb163-6" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="ot">`hi'</span> &gt; 99 | <span class="ot">`lo'</span> &lt; 1 {</span>
<span id="cb163-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb163-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> <span class="kw">error</span> <span class="co">///</span></span>
<span id="cb163-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb163-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Percentiles `lo' `hi' deben estar entre 1 y 99."</span> </span>
<span id="cb163-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb163-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">error</span> 198 </span>
<span id="cb163-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb163-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb163-11"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb163-11" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="ot">`hi'</span> &lt;= <span class="ot">`lo'</span> {</span>
<span id="cb163-12"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb163-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span> <span class="kw">as</span> <span class="kw">error</span> <span class="co">///</span></span>
<span id="cb163-13"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb163-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Percentiles `lo' `hi' deben estar en orden ascendente"</span></span>
<span id="cb163-14"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb163-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">error</span> 198 </span>
<span id="cb163-15"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb163-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb163-16"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb163-16" aria-hidden="true" tabindex="-1"></a><span class="kw">tempvar</span> touse phi plo </span>
<span id="cb163-17"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb163-17" aria-hidden="true" tabindex="-1"></a>mark <span class="ot">`touse'</span> <span class="ot">`if'</span> <span class="ot">`in'</span> </span>
<span id="cb163-18"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb163-18" aria-hidden="true" tabindex="-1"></a><span class="kw">quietly</span> {</span>
<span id="cb163-19"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb163-19" aria-hidden="true" tabindex="-1"></a>          <span class="kw">egen</span> <span class="kw">double</span> <span class="ot">`phi'</span> = <span class="kw">pctile</span>(<span class="ot">`exp'</span>) <span class="kw">if</span> <span class="ot">`touse'</span>, <span class="ot">`options'</span> <span class="kw">p</span>(<span class="ot">`hi'</span>) </span>
<span id="cb163-20"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb163-20" aria-hidden="true" tabindex="-1"></a>          <span class="kw">egen</span> <span class="kw">double</span> <span class="ot">`plo'</span> = <span class="kw">pctile</span>(<span class="ot">`exp'</span>) <span class="kw">if</span> <span class="ot">`touse'</span>, <span class="ot">`options'</span> <span class="kw">p</span>(<span class="ot">`lo'</span>)</span>
<span id="cb163-21"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb163-21" aria-hidden="true" tabindex="-1"></a>          <span class="kw">generate</span> <span class="ot">`typlist'</span> <span class="ot">`varlist'</span> = <span class="ot">`phi'</span> - <span class="ot">`plo'</span> <span class="kw">if</span> <span class="ot">`touse'</span> </span>
<span id="cb163-22"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb163-22" aria-hidden="true" tabindex="-1"></a>          } </span>
<span id="cb163-23"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb163-23" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb163-24"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb163-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-25"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb163-25" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto, <span class="kw">clear</span></span>
<span id="cb163-26"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb163-26" aria-hidden="true" tabindex="-1"></a><span class="kw">bysort</span> rep78: <span class="kw">egen</span> <span class="fu">iqr</span> = pctrange(price) <span class="kw">if</span> <span class="fu">inrange</span>(rep78,3,5)</span>
<span id="cb163-27"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb163-27" aria-hidden="true" tabindex="-1"></a><span class="kw">bysort</span> rep78: <span class="kw">egen</span> p8020 = pctrange(price) <span class="kw">if</span> <span class="fu">inrange</span>(rep78,3,5), hi(80) lo(20)</span>
<span id="cb163-28"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb163-28" aria-hidden="true" tabindex="-1"></a><span class="kw">bysort</span> rep78: <span class="kw">egen</span> p8020 = pctrange(price) <span class="kw">if</span> <span class="fu">inrange</span>(rep78,3,5) <span class="co">///</span></span>
<span id="cb163-29"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb163-29" aria-hidden="true" tabindex="-1"></a>&amp; foreign==1, hi(80) lo(20)</span>
<span id="cb163-30"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb163-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-31"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb163-31" aria-hidden="true" tabindex="-1"></a>* Utilizar estas nuevas variables con otros comandos</span>
<span id="cb163-32"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb163-32" aria-hidden="true" tabindex="-1"></a><span class="kw">tabstat</span> <span class="fu">iqr</span> <span class="kw">if</span> <span class="fu">inrange</span>(rep78, 3, 5), <span class="kw">by</span>(rep78)</span>
<span id="cb163-33"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb163-33" aria-hidden="true" tabindex="-1"></a><span class="kw">tabstat</span> p8020 <span class="kw">if</span> <span class="fu">inrange</span>(rep78, 3, 5), <span class="kw">by</span>(rep78)</span></code></pre></div>
</div>
<div id="documentar-tu-programa" class="section level3" number="2.5.11">
<h3>
<span class="header-section-number">2.5.11</span> Documentar tu programa<a class="anchor" aria-label="anchor" href="#documentar-tu-programa"><i class="fas fa-link"></i></a>
</h3>
<p>Escribir un help</p>
<ul>
<li>Es necesario y recomendado mantener una documentación de los programas que se escriban para un proyecto.</li>
<li>Esta documentación debe estar actualizada e incluir cualquier modificación. <strong>Importante hacerlo mientras se hace el programa y no al final</strong>.</li>
<li>Vamos a aprender un poco de SMCL (<em>Stata Markup and Control Language file</em>). Básicamente es el lenguaje con el que se escriben los <code>help</code> en Stata. También es el lenguaje con el que se muestran los resultados de <code>display</code>.</li>
<li>Los archivos se pueden escribir en cualquier procesador de texto, pero deben ser guardados en formato <code>.smcl</code>. También deben ser guardados en la misma carpeta en donde se encuentra el <code>ado-file</code> relacionado con el archivo.</li>
<li>Hay que empezar los códigos con <span class="math inline">\(\{smcl\}\)</span> con el fin de indicarle a Stata que el texto que viene será en formato SMCL.</li>
<li>Las etiquetas de SMCL van entre llaves (<span class="math inline">\(\{\}\)</span>) y se pueden leer de dos formas principalmente:
<ul>
<li>
<span class="math inline">\(\{tag:text\}\)</span> etiquetar el texto que se esta escribiendo.</li>
<li>
<span class="math inline">\(\{tag\}\)</span> etiquetar todo lo que viene hasta que se cambie en otra parte del texto.</li>
</ul>
</li>
</ul>
<p>Por ejemplo, si quiero poner texto en <em>itálica</em> tengo que ocupar la <strong>etiqueta</strong> <em>it</em>:</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb164-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb164-1" aria-hidden="true" tabindex="-1"></a>* Una palabra/frase en particular</span>
<span id="cb164-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb164-2" aria-hidden="true" tabindex="-1"></a>{it:este texto aparecerá en itálica}</span>
<span id="cb164-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb164-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb164-4" aria-hidden="true" tabindex="-1"></a>* Todo <span class="fu">el</span> bloque <span class="kw">de</span> texto</span>
<span id="cb164-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb164-5" aria-hidden="true" tabindex="-1"></a>{it} Todo lo que este aquí aparecerá en itálica. <span class="co">///</span></span>
<span id="cb164-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb164-6" aria-hidden="true" tabindex="-1"></a>Esto va a ocurrir hasta que aparezca un nuevo <span class="co">///</span></span>
<span id="cb164-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb164-7" aria-hidden="true" tabindex="-1"></a>tipo <span class="kw">de</span> etiqueta. </span></code></pre></div>
<p>Etiquetas de SMCL</p>
<ul>
<li>
<strong>Texto:</strong> {it}, {bf}, {sf}, {ul}. Itálica, negrita, texto normal, subrayado, repectivamente.</li>
<li>
<strong>Texto en formato Stata:</strong> {cmd}, {error}, {result}, {text}.</li>
<li>
<strong>{Destacar una referencia:</strong> {hi}.</li>
<li>
<strong>Opciones de comando:</strong> {opt}.</li>
<li>
<strong>Insertar linea horizontal:</strong> {hline}.</li>
<li>
<strong>Volver a dejar el texto a su estado normal:</strong> {reset}.</li>
<li>
<strong>Formato de documento:</strong> {title:text}, {center}, {ralign}, {lalign}, {tab}.</li>
<li>
<strong>Párrafos:</strong> Hay dos opciones para escribirlos.
<ul>
<li>{p #1 #2 #3 #4}.<br>
</li>
<li>{p} = {p 0 0 0 0}</li>
</ul>
</li>
<li>Los números indican los siguientes elementos de un párrafo:
<ul>
<li>El primer número (#1) es cuántos caracteres hay que sangrar en la primera línea.</li>
<li>El segundo número (#2) es cuántos caracteres hay que sangrar en la segunda y tercera línea.</li>
<li>El tercer número (#3) es cuán lejos de la derecha debe estar el margen.</li>
<li>El cuarto número (#4) es para el ancho total del párrafo.</li>
<li>{phang}: es equivalente a {p 4 8 2}.</li>
<li>{pstd}: es equivalente a {p 4 4 2}.</li>
<li>{phang2}: es equivalente a {p 8 12 2}.</li>
<li>{p2col}: Para separar el texto en dos columnas.</li>
<li>{p_end}: Para terminar un párrafo. Útil cuando tienes dos parrafos en formatos distintos.</li>
</ul>
</li>
</ul>
</div>
<div id="escribir-programas-e-class" class="section level3" number="2.5.12">
<h3>
<span class="header-section-number">2.5.12</span> Escribir programas e-class<a class="anchor" aria-label="anchor" href="#escribir-programas-e-class"><i class="fas fa-link"></i></a>
</h3>
<p>Vamos a aprender algunos elementos que nos van a permitir escribir nuestros propios comandos de estimación en Stata. Muchos de los conceptos que hemos visto aplican también para este tipo de comandos. Es necesario recordar algunas convenciones que nos van a ser útiles para poder escribir nuestros programas.</p>
<ul>
<li>Los resultados se guardan en <code>|e()</code> y se puede acceder a ellos con <code>ereturn list</code>.</li>
<li>El número de observaciones es <code>e(N)</code> y para identificar que observaciones fueron incluidas en la estimación es necesario utilizar la función <code>e(sample)</code>.</li>
<li>Los coeficientes estimados se guardan en un vector <code>e(b)</code> y la matriz de varianza covarianza se guarda en <code>e(V)</code>.</li>
<li>El comando <code>ereturn name = exp</code> retorna un escalar, mientras que <code>ereturn local name value</code> y <code>ereturn matrix name matname</code> retorna una macro y una matriz respectivamente.</li>
<li>El comando <code>ereturn post</code> envía las estimaciones de <code>b</code> y <code>V</code> a sus ubicaciones oficiales.</li>
<li>Para devolver el vector de coeficientes y su matriz de varianza, es necesario crear el vector de coeficientes, digamos <span class="math inline">\(beta\)</span>, y su matriz de varianza-covarianza, digamos <span class="math inline">\(vce\)</span>.</li>
</ul>
<div class="sourceCode" id="cb165"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb165-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="kw">ereturn</span> <span class="kw">post</span> <span class="ot">`beta'</span> 'vce', <span class="kw">esample</span>(<span class="ot">`touse'</span>)</span></code></pre></div>
<p>También podemos definir la muestra de estimación incluida en la estimación con <code>touse</code>. Ahora es posible guardar los elementos en <code>e()</code>. Por ejemplo, es posible utilizar <code>ereturn scalar</code>, <code>ereturn local</code> o <code>ereturn matrix</code>.</p>
<p>Es conveniente utilizar los nombres típicamente asignados para guardar resultados de los programas <code>e(df_m)</code> o <code>e(df_r)</code>. Sin embargo, se pueden nombrar como deseen.</p>
</div>
</div>
<div id="programar-ado---files-parte-iii" class="section level2" number="2.6">
<h2>
<span class="header-section-number">2.6</span> Programar ado - files (Parte III)<a class="anchor" aria-label="anchor" href="#programar-ado---files-parte-iii"><i class="fas fa-link"></i></a>
</h2>
<div id="marksample-mark-y-markout" class="section level3" number="2.6.1">
<h3>
<span class="header-section-number">2.6.1</span> Marksample, Mark y Markout<a class="anchor" aria-label="anchor" href="#marksample-mark-y-markout"><i class="fas fa-link"></i></a>
</h3>
<p><code>marksample</code> y <code>mark</code> son alternativas. <code>mark</code> no es muy utilizado. Ambos comandos crean un indicador que marcan que observaciones será utilizadas. Los ocupadmos en los programas en Stata. La idea es indicarle al programa la muestra relevante. <code>markout</code> marca la variable con un indicador igual a 0 si cualquier variable en <code>varlist</code> indicada contiene un <em>missing</em>.</p>
<p>Marksample</p>
<ul>
<li>
<code>marksample</code> se utiliza en programas en los que los argumentos se analizan mediante el comando <code>syntax</code>.</li>
<li>Crea una variable temporal, almacena el nombre de la variable temporal en un local, y rellena la variable temporal con 0 y 1 según si la observación debe ser utilizada.</li>
</ul>
<div class="sourceCode" id="cb166"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb166-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> ....</span>
<span id="cb166-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb166-2" aria-hidden="true" tabindex="-1"></a><span class="kw">syntax</span> ...</span>
<span id="cb166-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb166-3" aria-hidden="true" tabindex="-1"></a><span class="kw">marksample</span> touse</span>
<span id="cb166-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb166-4" aria-hidden="true" tabindex="-1"></a>rest <span class="kw">of</span> code .... <span class="kw">if</span> <span class="ot">`touse'</span></span>
<span id="cb166-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb166-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p>Mark</p>
<ul>
<li>
<code>mark</code> utiliza la variable temporal <code>touse</code> basada en las expresiones de <code>if</code> e <code>in</code>.</li>
<li>Si no hay expresiones de <code>if</code> e <code>in</code>, <code>touse</code> será 1 para cada observación en los datos.</li>
<li>Si indico una condición, solo las observaciones que cumplan esta condición tendrán un 1 en <code>touse</code>.</li>
<li>
<code>Mark</code> actualiza <code>touse</code> de forma tal de que revisa <em>missing</em>.</li>
</ul>
<p>Mark y Markout</p>
<ul>
<li>
<code>mark</code> parte con una variable temporal previamente creada.<br>
</li>
<li>
<code>markout</code> modifica la variable creada por <code>mark</code> poniéndola a cero en las observaciones que tienen valores perdidos registrados para cualquiera de las variables en <em>varlist</em>.</li>
</ul>
<div class="sourceCode" id="cb167"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb167-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> ....</span>
<span id="cb167-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb167-2" aria-hidden="true" tabindex="-1"></a><span class="kw">tempvar</span> touse</span>
<span id="cb167-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb167-3" aria-hidden="true" tabindex="-1"></a>mark <span class="ot">`touse'</span> ...</span>
<span id="cb167-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb167-4" aria-hidden="true" tabindex="-1"></a><span class="kw">markout</span> <span class="ot">`touse'</span> ...</span>
<span id="cb167-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb167-5" aria-hidden="true" tabindex="-1"></a>rest <span class="kw">of</span> code ... <span class="kw">if</span> <span class="ot">`touse'</span></span>
<span id="cb167-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb167-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p>Marksample vs. Markout</p>
<ul>
<li>
<code>marksample</code> es mejor que <code>mark</code>. Disminuye la probabilidad de que se olvide alguna restricción.</li>
<li>
<code>markout</code> puede ser utilizados después de <code>mark</code> o bien <code>marksample</code>.</li>
</ul>
<div class="sourceCode" id="cb168"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb168-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> ...</span>
<span id="cb168-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb168-2" aria-hidden="true" tabindex="-1"></a><span class="kw">tempvar</span> touse</span>
<span id="cb168-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb168-3" aria-hidden="true" tabindex="-1"></a>mark <span class="ot">`touse'</span> ...</span>
<span id="cb168-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb168-4" aria-hidden="true" tabindex="-1"></a><span class="kw">markout</span> <span class="ot">`touse'</span> ...</span>
<span id="cb168-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb168-5" aria-hidden="true" tabindex="-1"></a>rest <span class="kw">of</span> code ... <span class="kw">if</span> <span class="ot">`touse'</span></span>
<span id="cb168-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb168-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb168-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb168-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb168-8" aria-hidden="true" tabindex="-1"></a>prgraom myprog</span>
<span id="cb168-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb168-9" aria-hidden="true" tabindex="-1"></a><span class="kw">syntax</span> <span class="kw">varlist</span> [<span class="kw">if</span>] [<span class="kw">in</span>]</span>
<span id="cb168-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb168-10" aria-hidden="true" tabindex="-1"></a><span class="kw">marksample</span> touse</span>
<span id="cb168-11"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb168-11" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb168-12"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb168-12" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb168-13"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb168-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-14"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb168-14" aria-hidden="true" tabindex="-1"></a>* Equivale a: </span>
<span id="cb168-15"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb168-15" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> myprog</span>
<span id="cb168-16"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb168-16" aria-hidden="true" tabindex="-1"></a><span class="kw">version</span> 17.0</span>
<span id="cb168-17"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb168-17" aria-hidden="true" tabindex="-1"></a><span class="kw">syntax</span> <span class="kw">varlist</span> [<span class="kw">if</span>] [<span class="kw">in</span>]</span>
<span id="cb168-18"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb168-18" aria-hidden="true" tabindex="-1"></a><span class="kw">tempvar</span> touse</span>
<span id="cb168-19"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb168-19" aria-hidden="true" tabindex="-1"></a>mark <span class="ot">`touse'</span> <span class="ot">`if'</span> <span class="ot">`in'</span></span>
<span id="cb168-20"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb168-20" aria-hidden="true" tabindex="-1"></a><span class="kw">markout</span> <span class="ot">`touse'</span> <span class="ot">`varlist'</span></span>
<span id="cb168-21"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb168-21" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb168-22"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb168-22" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p><code>markout</code> también puede ser usado con <code>marksample</code>:</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb169-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> ...</span>
<span id="cb169-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb169-2" aria-hidden="true" tabindex="-1"></a><span class="kw">syntax</span> ... [, Denom(varname) ... ]</span>
<span id="cb169-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb169-3" aria-hidden="true" tabindex="-1"></a><span class="kw">marksample</span> touse</span>
<span id="cb169-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb169-4" aria-hidden="true" tabindex="-1"></a><span class="kw">markout</span> <span class="ot">`touse'</span> <span class="ot">`denom'</span></span>
<span id="cb169-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb169-5" aria-hidden="true" tabindex="-1"></a>rest <span class="kw">of</span> code ... <span class="kw">if</span> <span class="ot">`touse'</span></span>
<span id="cb169-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb169-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p>Ejemplo Marksample y Markout:</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb170-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> cwsumm</span>
<span id="cb170-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb170-2" aria-hidden="true" tabindex="-1"></a><span class="kw">syntax</span> [<span class="kw">varlist</span>(fv ts)] [<span class="kw">if</span>] [<span class="kw">in</span>] [<span class="kw">aweight</span> <span class="kw">fweight</span>] [, Detail noFormat]</span>
<span id="cb170-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb170-3" aria-hidden="true" tabindex="-1"></a><span class="kw">marksample</span> touse</span>
<span id="cb170-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb170-4" aria-hidden="true" tabindex="-1"></a><span class="kw">summarize</span> <span class="ot">`varlist'</span> [<span class="ot">`weight'`exp'</span>] <span class="kw">if</span> <span class="ot">`touse'</span>, <span class="ot">`detail'</span> <span class="ot">`format'</span></span>
<span id="cb170-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb170-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
</div>
<div id="sortpreserve" class="section level3" number="2.6.2">
<h3>
<span class="header-section-number">2.6.2</span> Sortpreserve<a class="anchor" aria-label="anchor" href="#sortpreserve"><i class="fas fa-link"></i></a>
</h3>
<p>Si está escribiendo un programa de Stata que cambia temporalmente el orden de los datos y quieres que los datos se ordenen en su orden original al final de la ejecución, puede ahorrar un poco de programación incluyendo <code>sortpreserve</code>. Para ellos debemos escribir: <code>program miprograma, sortpreserve</code>. Stata automáticamente reordenara las variables como estaban originalmente. Al agregar esta opción se genera una variable temporal llamada <code>_sortindex</code> la que contiene el orden original de los datos.</p>
</div>
<div id="mata" class="section level3" number="2.6.3">
<h3>
<span class="header-section-number">2.6.3</span> Mata<a class="anchor" aria-label="anchor" href="#mata"><i class="fas fa-link"></i></a>
</h3>
<div id="qué-es-mata" class="section level4" number="2.6.3.1">
<h4>
<span class="header-section-number">2.6.3.1</span> ¿Qué es Mata?<a class="anchor" aria-label="anchor" href="#qu%C3%A9-es-mata"><i class="fas fa-link"></i></a>
</h4>
<p>Esta introducción esta basada en la guía de <a href="https://medium.com/the-stata-guide/mata-statas-end-game-5983c0ee11bd">Asjad Naqvi</a>.</p>
<ul>
<li>Mata es un lenguaje de programación matricial.</li>
<li>Es más rápido que Stata, pero necesita más precisión (ej. dimensiones de las matrices).</li>
<li>Muchos de los operadores de Mata son similares a R o Matlab. Adicionalmente, incluye sus propios optimizadores y funciones útiles.</li>
<li>Esta sección será una pequeña introducción al lenguaje. Tiene como objetivo mostrarles el abanico de herramientas que Mata posee con el fin de que puedan utilizarlo para hacer sus propios programas.</li>
</ul>
<p>La sintaxis básica de Mata</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb171-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb171-1" aria-hidden="true" tabindex="-1"></a>* Opción 1 </span>
<span id="cb171-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb171-2" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> </span>
<span id="cb171-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb171-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb171-4" aria-hidden="true" tabindex="-1"></a>&lt; comando <span class="kw">de</span> <span class="kw">mata</span> 1 &gt; </span>
<span id="cb171-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb171-5" aria-hidden="true" tabindex="-1"></a>&lt; comando <span class="kw">de</span> <span class="kw">mata</span> 2 &gt;</span>
<span id="cb171-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb171-6" aria-hidden="true" tabindex="-1"></a>&lt; <span class="fu">y</span> así .... &gt; </span>
<span id="cb171-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb171-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> </span>
<span id="cb171-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb171-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb171-9" aria-hidden="true" tabindex="-1"></a>* Opción 2 </span>
<span id="cb171-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb171-10" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> &lt;un comando <span class="kw">de</span> <span class="kw">mata</span>&gt;</span>
<span id="cb171-11"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb171-11" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb171-12"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb171-12" aria-hidden="true" tabindex="-1"></a>* Opción 3 : la versión estricta</span>
<span id="cb171-13"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb171-13" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span>: &lt;un comando <span class="kw">de</span> <span class="kw">mata</span>&gt; </span>
<span id="cb171-14"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb171-14" aria-hidden="true" tabindex="-1"></a>  </span></code></pre></div>
<p>Si son utilizados dos puntos y <strong>ocurre</strong> un error, Mata será abortado, volverá a Stata y aparecerá un mensaje de error.</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb172-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb172-1" aria-hidden="true" tabindex="-1"></a>* Ejemplo 1</span>
<span id="cb172-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb172-2" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> </span>
<span id="cb172-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb172-3" aria-hidden="true" tabindex="-1"></a>emat = 7 + 3</span>
<span id="cb172-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb172-4" aria-hidden="true" tabindex="-1"></a>emat </span>
<span id="cb172-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb172-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb172-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb172-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb172-7" aria-hidden="true" tabindex="-1"></a>* Ejemplo 2</span>
<span id="cb172-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb172-8" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> </span>
<span id="cb172-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb172-9" aria-hidden="true" tabindex="-1"></a>emat = (<span class="st">"Josefa"</span>, <span class="st">"Perez"</span>)</span>
<span id="cb172-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb172-10" aria-hidden="true" tabindex="-1"></a>emat = (21\8)</span>
<span id="cb172-11"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb172-11" aria-hidden="true" tabindex="-1"></a>mmat = (17\6)</span>
<span id="cb172-12"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb172-12" aria-hidden="true" tabindex="-1"></a>vmat = (25,3\3,11)</span>
<span id="cb172-13"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb172-13" aria-hidden="true" tabindex="-1"></a>emat, mmat, vmat </span>
<span id="cb172-14"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb172-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p>Para buscar ayuda, podemos hacer:</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb173-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb173-1" aria-hidden="true" tabindex="-1"></a>* Ejemplo 1</span>
<span id="cb173-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb173-2" aria-hidden="true" tabindex="-1"></a><span class="kw">help</span> <span class="kw">mata</span> comando</span>
<span id="cb173-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb173-3" aria-hidden="true" tabindex="-1"></a><span class="kw">help</span> <span class="kw">mata</span> <span class="fu">cholesky</span>()</span></code></pre></div>
<p>Comandos básicos:Al igual que Stata, Mata posee sus propios comandos. Algunos útiles de recordar son:</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb174-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> <span class="kw">describe</span> </span>
<span id="cb174-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb174-2" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> <span class="kw">clear</span> </span>
<span id="cb174-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb174-3" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> <span class="kw">rename</span> nombre</span>
<span id="cb174-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb174-4" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> <span class="kw">drop</span> nombre1 nombre2</span>
<span id="cb174-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb174-5" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> stata</span>
<span id="cb174-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb174-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb174-7" aria-hidden="true" tabindex="-1"></a>* Ejemplo</span>
<span id="cb174-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb174-8" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> </span>
<span id="cb174-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb174-9" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> <span class="kw">clear</span> </span>
<span id="cb174-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb174-10" aria-hidden="true" tabindex="-1"></a>emat = (<span class="st">"Josefa"</span>, <span class="st">"Perez"</span>)</span>
<span id="cb174-11"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb174-11" aria-hidden="true" tabindex="-1"></a>emat = (21\8)</span>
<span id="cb174-12"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb174-12" aria-hidden="true" tabindex="-1"></a>mmat = (17\6)</span>
<span id="cb174-13"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb174-13" aria-hidden="true" tabindex="-1"></a>vmat = (25,3\3,11)</span>
<span id="cb174-14"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb174-14" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> <span class="kw">describe</span> </span>
<span id="cb174-15"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb174-15" aria-hidden="true" tabindex="-1"></a>emat, mmat, vmat</span>
<span id="cb174-16"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb174-16" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> <span class="kw">rename</span> vmat vmat_renombrada</span>
<span id="cb174-17"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb174-17" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> <span class="kw">drop</span> mmat</span>
<span id="cb174-18"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb174-18" aria-hidden="true" tabindex="-1"></a>emat, vmat_renombrada</span>
<span id="cb174-19"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb174-19" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p><strong>Para hacer comentarios</strong> en Mata hay que utilizar <code>//</code>. No funcionan los asteriscos como en Stata. Todo los que se genera en Mata queda en la memoria a menos que Stata se cierre, se use <code>clear all</code>en Stata o bien <code>mata: mata clear</code>. Todas las matrices y funciones definidas se mantienen en el espacio de trabajo de Mata espacio de trabajo cuando se termina mata y se puede acceder a ellas cuando se vuelve a entrar en
mata.</p>
</div>
<div id="matrices" class="section level4" number="2.6.3.2">
<h4>
<span class="header-section-number">2.6.3.2</span> Matrices<a class="anchor" aria-label="anchor" href="#matrices"><i class="fas fa-link"></i></a>
</h4>
<p>Una forma común de generar una matriz en Mata es importándola desde los datos de Stata.</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb175-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span>: X = st_data(.,(<span class="st">"var1"</span>, <span class="st">"var2"</span>))</span></code></pre></div>
<p>Definimos la matriz X, que tiene todas las observaciones (filas) y dos columnas <code>var1</code> y <code>var2</code>. <code>st_</code> permite a Mata interactuar con la interfaz de Stata con el fin de pasar información de un lado a otro. Revisar <code>help m4_stata</code>.</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb176-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb176-1" aria-hidden="true" tabindex="-1"></a>* Ejemplo 4: confeccionar matrices en base a <span class="kw">mata</span></span>
<span id="cb176-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb176-2" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto.dta</span>
<span id="cb176-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb176-3" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span></span>
<span id="cb176-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb176-4" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> <span class="kw">clear</span> </span>
<span id="cb176-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb176-5" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span>: X = st_data(.,(<span class="st">"price"</span>, <span class="st">"mpg"</span>))</span>
<span id="cb176-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb176-6" aria-hidden="true" tabindex="-1"></a>X</span>
<span id="cb176-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb176-7" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> <span class="kw">describe</span></span>
<span id="cb176-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb176-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> </span></code></pre></div>
<p>Otra opción es definir matrices dentro de Mata.</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb177-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> A = (1,2 \ 3,4)</span></code></pre></div>
<p>Definimos la matriz A, la cual podemos ver escribiendo <code>mata A</code>. Veremos una matriz cuadrada de 2x2. Notar que la coma separa elementos <strong>entre columnas</strong> mientras que el <em>slash</em> mueve elementos <strong>entre filas</strong>. El uso de paréntesis es opcional en Mata, pero es más conveniente y es una buena práctica de estilo utilizarlos. También se pueden definir matrices especiales.</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb178-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb178-1" aria-hidden="true" tabindex="-1"></a>* Vector fila o Vector columna</span>
<span id="cb178-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb178-2" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> 1,2,3</span>
<span id="cb178-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb178-3" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> 1\2\3</span>
<span id="cb178-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb178-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb178-5" aria-hidden="true" tabindex="-1"></a>* Vector fila o Vector columna del 1 al 4</span>
<span id="cb178-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb178-6" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> 1..4</span>
<span id="cb178-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb178-7" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> 1::4</span></code></pre></div>
<p>Finalmente, uno puede generar matrices similar a lo que se hace en Stata.</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb179-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> <span class="fu">J</span>(2,2,1)</span></code></pre></div>
<p>Este comando genera una matriz de 2x2 rellena de unos. La sintaxis genérica es: <code>mata J(filas, columnas, constante)</code>. Para definir una matriz identidad: <code>mata I(5)</code>.</p>
<p>Otro operador útil es <code>range</code>:</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb180-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> <span class="kw">range</span>(1,7,2)</span></code></pre></div>
<p>Crea un vector que empieza en 1 y termina en 7 saltándose de 2 en 2 (es decir, <code>(1,3,5,7)</code>). Si quiero generar una matriz con números aleatorios provenientes de una distribución uniforme (0,1) : <code>mata runiform(3,3)</code>.</p>
<p>Accediendo a los elementos de una matriz</p>
<ul>
<li>Podemos acceder a los elementos de una matriz.
<ul>
<li>
<code>mata A[1,2]</code>: fila 1, columna 2.</li>
<li>
<code>mata A[1,.]</code>: <strong>Todas las columnas</strong> de la fila 1.</li>
<li>
<code>mata A[.,2]</code>: <strong>Todas las filas</strong> de la columna 2.</li>
</ul>
</li>
<li>También podemos extraer sub-conjuntos de elementos:</li>
</ul>
<div class="sourceCode" id="cb181"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb181-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb181-1" aria-hidden="true" tabindex="-1"></a>* Empezar <span class="kw">de</span> fila 2 columna 1 hasta fila 3 columna 3</span>
<span id="cb181-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb181-2" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> A[|2,1\3,3|]       </span>
<span id="cb181-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb181-3" aria-hidden="true" tabindex="-1"></a>* Tomar filas 2 <span class="fu">y</span> 3 <span class="fu">y</span> columnas <span class="kw">de</span> la 1 a la 3.</span>
<span id="cb181-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb181-4" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> A[(2::3),(1..3)]   </span></code></pre></div>
<p>Pegando elementos de matrices:</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb182-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span></span>
<span id="cb182-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb182-2" aria-hidden="true" tabindex="-1"></a>A = runiform(1,2)</span>
<span id="cb182-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb182-3" aria-hidden="true" tabindex="-1"></a>B = runiform(1,2)</span>
<span id="cb182-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb182-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb182-5" aria-hidden="true" tabindex="-1"></a>* Opción 1 : pegar horizontalmente</span>
<span id="cb182-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb182-6" aria-hidden="true" tabindex="-1"></a>A,B   </span>
<span id="cb182-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb182-7" aria-hidden="true" tabindex="-1"></a>* Opción 2 : pegar verticalmente</span>
<span id="cb182-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb182-8" aria-hidden="true" tabindex="-1"></a>A\B   </span>
<span id="cb182-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb182-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p><code>A,B</code> las pega horizontalmente, es decir por columnas (filas son las mismas). <code>A\B</code> las pega vertical, es decir por filas (columnas son las mismas).</p>
<p>Operaciones básicas entre matrices y por elementos: Una vez definidas las matrices, también se dedica bastante tiempo a sumar, restar, multiplicar y dividir matrices entre sí. Vamos a ver algunas operaciones entre matrices y también entre elementos.</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb183-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span></span>
<span id="cb183-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb183-2" aria-hidden="true" tabindex="-1"></a> A = (1,2,3\4,5,6)</span>
<span id="cb183-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb183-3" aria-hidden="true" tabindex="-1"></a> B = (2,3\4,5\6,7)</span>
<span id="cb183-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb183-4" aria-hidden="true" tabindex="-1"></a> A * B</span>
<span id="cb183-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb183-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p><code>A * B</code> es una operación entre matrices, de forma tal que el número de filas de A debe ser igual al número de columnas de B. Si queremos que cada elemento de A sea multiplicado por el mismo elemento en B, es necesario trasponer alguna matriz y cambiar el operador.</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb184-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span></span>
<span id="cb184-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb184-2" aria-hidden="true" tabindex="-1"></a> A = (1,2,3\4,5,6)</span>
<span id="cb184-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb184-3" aria-hidden="true" tabindex="-1"></a> B = (2,3\4,5\6,7)</span>
<span id="cb184-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb184-4" aria-hidden="true" tabindex="-1"></a>  A' :* B</span>
<span id="cb184-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb184-5" aria-hidden="true" tabindex="-1"></a>  A  :* B'</span>
<span id="cb184-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb184-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p>En el primer caso la matriz resultante corresponde a una matriz de 3x2, en el segundo caso es una matriz de 2x3.</p>
<p>Operadores lógicos y funciones sobre escalares: Las matrices también pueden ser comparadas a través de operadores lógicos. <code>A == B</code> chequea si dos matrices son iguales. Esto también puede hacerse elemento por elemento (por ejemplo <code>A:&gt;=B</code>). Tambien se puede utilizar <code>!=</code>.</p>
<p>Mata también tiene funciones sobre escalares:</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb185-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span></span>
<span id="cb185-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb185-2" aria-hidden="true" tabindex="-1"></a>  X = (-2, 1 \ 0, 5)</span>
<span id="cb185-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb185-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abs</span>(X)   <span class="co">// valor absoluto de cada elemento</span></span>
<span id="cb185-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb185-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sign</span>(X)  <span class="co">// signo de cada elemento</span></span>
<span id="cb185-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb185-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">exp</span>(X)   <span class="co">// exponencial de cada elemento</span></span>
<span id="cb185-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb185-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sqrt</span>(X)  <span class="co">// raíz cuadrada de cada elemento</span></span>
<span id="cb185-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb185-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sin</span>(X)   <span class="co">// seno de cada elemento</span></span>
<span id="cb185-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb185-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p>Algunas funciones para operar en matrices son:</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb186-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span></span>
<span id="cb186-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb186-2" aria-hidden="true" tabindex="-1"></a>A = (5,4\6,7)</span>
<span id="cb186-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb186-3" aria-hidden="true" tabindex="-1"></a>B = (1,6\3,2)</span>
<span id="cb186-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb186-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb186-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb186-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb186-6" aria-hidden="true" tabindex="-1"></a>* Número <span class="kw">de</span> filas <span class="fu">y</span> columnas </span>
<span id="cb186-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb186-7" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> <span class="bn">rows</span>(A)</span>
<span id="cb186-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb186-8" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> <span class="bn">cols</span>(A)</span>
<span id="cb186-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb186-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb186-10" aria-hidden="true" tabindex="-1"></a>* Suma <span class="kw">de</span> las filas/columnas</span>
<span id="cb186-11"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb186-11" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> rowsum(B)</span>
<span id="cb186-12"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb186-12" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> colsum(B)</span>
<span id="cb186-13"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb186-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-14"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb186-14" aria-hidden="true" tabindex="-1"></a>* Calcular <span class="fu">el</span> promedio (retorna un <span class="kw">vector</span> fila)</span>
<span id="cb186-15"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb186-15" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> <span class="kw">mean</span>(B')' </span>
<span id="cb186-16"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb186-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-17"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb186-17" aria-hidden="true" tabindex="-1"></a>* Seleccionar todas las columnas <span class="fu">sin</span> ceros</span>
<span id="cb186-18"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb186-18" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> D = (1,0,2,3,0)</span>
<span id="cb186-19"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb186-19" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> selectindex(D) </span>
<span id="cb186-20"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb186-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-21"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb186-21" aria-hidden="true" tabindex="-1"></a>* Select para condiciones más flexibles</span>
<span id="cb186-22"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb186-22" aria-hidden="true" tabindex="-1"></a>select(B, B[.,1]:&gt;2)</span>
<span id="cb186-23"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb186-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-24"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb186-24" aria-hidden="true" tabindex="-1"></a>* Ordenar matrices </span>
<span id="cb186-25"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb186-25" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> <span class="kw">sort</span>(B,2)  <span class="co">// Ordena según la columna 2 de B</span></span>
<span id="cb186-26"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb186-26" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> <span class="kw">jumble</span>(B) <span class="co">// Aleatoriza las filas de B</span></span></code></pre></div>
<p>Mata contiene varias funciones para extraer propiedades de las matrices:</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb187-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span></span>
<span id="cb187-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb187-2" aria-hidden="true" tabindex="-1"></a>A = (5,4\6,7)</span>
<span id="cb187-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb187-3" aria-hidden="true" tabindex="-1"></a><span class="fu">det</span>(A)         <span class="co">// Determinante de A</span></span>
<span id="cb187-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb187-4" aria-hidden="true" tabindex="-1"></a><span class="fu">invsym</span>(A)      <span class="co">// Ibversa de A</span></span>
<span id="cb187-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb187-5" aria-hidden="true" tabindex="-1"></a><span class="fu">trace</span>(A)       <span class="co">// Traza de A</span></span>
<span id="cb187-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb187-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rank</span>(A)        <span class="co">// Rango de A</span></span>
<span id="cb187-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb187-7" aria-hidden="true" tabindex="-1"></a><span class="fu">norm</span>(A)        <span class="co">// Norma de A</span></span>
<span id="cb187-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb187-8" aria-hidden="true" tabindex="-1"></a>X=.            <span class="co">// Vectores propios</span></span>
<span id="cb187-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb187-9" aria-hidden="true" tabindex="-1"></a>L=.            <span class="co">// Valores propios</span></span>
<span id="cb187-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb187-10" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p>Mata contiene varias funciones para operar o manipular dos matrices:</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb188-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span></span>
<span id="cb188-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb188-2" aria-hidden="true" tabindex="-1"></a>A = (5,4\6,7)</span>
<span id="cb188-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb188-3" aria-hidden="true" tabindex="-1"></a>B = (1,6\3,2)</span>
<span id="cb188-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb188-4" aria-hidden="true" tabindex="-1"></a>A' * B            <span class="co">// A x B</span></span>
<span id="cb188-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb188-5" aria-hidden="true" tabindex="-1"></a><span class="kw">cross</span>(A,B)        <span class="co">// A x B using a solver (faster)</span></span>
<span id="cb188-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb188-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p>Al igual que Stata, Mata puede utilizar iteradores. While loop:</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb189-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span></span>
<span id="cb189-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb189-2" aria-hidden="true" tabindex="-1"></a>  x = 1                  <span class="co">// Valor inicial</span></span>
<span id="cb189-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb189-3" aria-hidden="true" tabindex="-1"></a>  X = 4                  <span class="co">// Valor final</span></span>
<span id="cb189-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb189-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">while</span> (x &lt;= X) {       <span class="co">// Iniciar condición del while</span></span>
<span id="cb189-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb189-5" aria-hidden="true" tabindex="-1"></a>  printf(<span class="st">"\%g </span><span class="ch">\n</span><span class="st">"</span>, x)     <span class="co">// Alguna operación de Mata aquí</span></span>
<span id="cb189-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb189-6" aria-hidden="true" tabindex="-1"></a>  x++                    <span class="co">// Incremental</span></span>
<span id="cb189-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb189-7" aria-hidden="true" tabindex="-1"></a>  }                      <span class="co">// Terminar el while</span></span>
<span id="cb189-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb189-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p>For Loops:</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb190-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb190-1" aria-hidden="true" tabindex="-1"></a>* Este <span class="kw">for</span></span>
<span id="cb190-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb190-2" aria-hidden="true" tabindex="-1"></a><span class="kw">for</span> (expr1; expr2; expr3) {</span>
<span id="cb190-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb190-3" aria-hidden="true" tabindex="-1"></a>stmts</span>
<span id="cb190-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb190-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb190-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb190-5" aria-hidden="true" tabindex="-1"></a>* Es equivalente a </span>
<span id="cb190-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb190-6" aria-hidden="true" tabindex="-1"></a>expr1</span>
<span id="cb190-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb190-7" aria-hidden="true" tabindex="-1"></a><span class="kw">while</span> (expr2) {</span>
<span id="cb190-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb190-8" aria-hidden="true" tabindex="-1"></a>stmt</span>
<span id="cb190-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb190-9" aria-hidden="true" tabindex="-1"></a>expr3</span>
<span id="cb190-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb190-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Los valores iniciales y finales pueden extraerse de algunas declaraciones condicionales como las dimensiones de las matrices. Mata sólo permite incrementos de 1.</p>
<p>Notar que aquí es bien distinto a Stata:</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb191-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span></span>
<span id="cb191-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb191-2" aria-hidden="true" tabindex="-1"></a>   <span class="kw">N</span> = 4                      <span class="co">// Valor final</span></span>
<span id="cb191-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb191-3" aria-hidden="true" tabindex="-1"></a>   <span class="kw">for</span> (i=1; i&lt;=<span class="kw">N</span>; i++) {     <span class="co">// for loop </span></span>
<span id="cb191-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb191-4" aria-hidden="true" tabindex="-1"></a>   printf(<span class="st">"%g </span><span class="ch">\n</span><span class="st">"</span>, i)         <span class="co">// some Mata operation here</span></span>
<span id="cb191-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb191-5" aria-hidden="true" tabindex="-1"></a>   }                          <span class="co">// end for loop</span></span>
<span id="cb191-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb191-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p>If/else son:</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb192-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span></span>
<span id="cb192-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb192-2" aria-hidden="true" tabindex="-1"></a> x = 3                       <span class="co">// Valor de x</span></span>
<span id="cb192-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb192-3" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb192-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb192-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">for</span> (i=1; i&lt;=5; i++) {     <span class="co">// Empezar el loop</span></span>
<span id="cb192-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb192-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> (x &gt; i) {             <span class="co">// if</span></span>
<span id="cb192-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb192-6" aria-hidden="true" tabindex="-1"></a>      printf(<span class="st">"\%g</span><span class="ch">\n</span><span class="st">"</span>, 0)      <span class="co">// Comando de mata si la condición se cumple</span></span>
<span id="cb192-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb192-7" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb192-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb192-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">else</span> {                   <span class="co">//  en caso contrario</span></span>
<span id="cb192-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb192-9" aria-hidden="true" tabindex="-1"></a>      printf(<span class="st">"\%g</span><span class="ch">\n</span><span class="st">"</span>, 1)      <span class="co">// ejecutar este comando de mata</span></span>
<span id="cb192-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb192-10" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb192-11"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb192-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb192-12"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb192-12" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p>Mata también permite abreviar la sintaxis en caso de que existan dos o mas condiciones.</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb193-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb193-1" aria-hidden="true" tabindex="-1"></a>(a ? b : c)</span></code></pre></div>
<p>“a” es la condición, “b” es el valor en caso de que sea verdadero y “c” en caso de que sea falsa. Para el ejemplo, la condición sería: <code>(x &gt; i ? 1 : 0)</code>.</p>
</div>
<div id="de-stata-a-mata" class="section level4" number="2.6.3.3">
<h4>
<span class="header-section-number">2.6.3.3</span> De Stata a Mata<a class="anchor" aria-label="anchor" href="#de-stata-a-mata"><i class="fas fa-link"></i></a>
</h4>
<p>Estimar un MCO: Un ejemplo estándar es hacer un simple OLS en Mata.</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb194-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto, <span class="kw">clear</span></span>
<span id="cb194-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb194-2" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span></span>
<span id="cb194-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb194-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">y</span> = st_data(.,<span class="st">"price"</span>)</span>
<span id="cb194-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb194-4" aria-hidden="true" tabindex="-1"></a> X = st_data(.,(<span class="st">"mpg"</span>, <span class="st">"weight"</span>))</span>
<span id="cb194-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb194-5" aria-hidden="true" tabindex="-1"></a> X = X, <span class="fu">J</span>(<span class="bn">rows</span>(X),1,1)</span>
<span id="cb194-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb194-6" aria-hidden="true" tabindex="-1"></a>    beta   = <span class="fu">invsym</span>(<span class="kw">cross</span>(X,X))*<span class="kw">cross</span>(X,<span class="fu">y</span>)</span>
<span id="cb194-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb194-7" aria-hidden="true" tabindex="-1"></a>    esq    = (<span class="fu">y</span> - X*beta) :^ 2</span>
<span id="cb194-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb194-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">V</span>      = (<span class="kw">sum</span>(esq)/(<span class="bn">rows</span>(X)-<span class="bn">cols</span>(X)))*<span class="fu">invsym</span>(<span class="kw">cross</span>(X,X))</span>
<span id="cb194-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb194-9" aria-hidden="true" tabindex="-1"></a>    stderr = <span class="fu">sqrt</span>(diagonal(<span class="kw">V</span>))</span>
<span id="cb194-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb194-10" aria-hidden="true" tabindex="-1"></a>      st_matrix(<span class="st">"b"</span>, beta)</span>
<span id="cb194-11"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb194-11" aria-hidden="true" tabindex="-1"></a>      st_matrix(<span class="st">"se"</span>, stderr)</span>
<span id="cb194-12"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb194-12" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p>For Loops</p>
<ul>
<li>En Mata, la variable dependiente se importa como el vector y las variables independientes se importan como la matriz X. A esta matriz X se le añade un vector columna de unos para el intercepto.</li>
<li>Como el vector de unos debe tener el mismo número de filas que la matriz X, nótese el uso del operador J().</li>
<li>En el último paso, las betas y los errores estándar se exportan a Stata como matrices de Stata.</li>
</ul>
</div>
<div id="funciones-en-mata" class="section level4" number="2.6.3.4">
<h4>
<span class="header-section-number">2.6.3.4</span> Funciones en Mata<a class="anchor" aria-label="anchor" href="#funciones-en-mata"><i class="fas fa-link"></i></a>
</h4>
<p>Vector: Un ejemplo estándar es hacer un simple OLS en Mata.</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb195-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb195-1" aria-hidden="true" tabindex="-1"></a>* Generar un <span class="kw">vector</span> </span>
<span id="cb195-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb195-2" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> </span>
<span id="cb195-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb195-3" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> zeros(c)</span>
<span id="cb195-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb195-4" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb195-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb195-5" aria-hidden="true" tabindex="-1"></a>    a = <span class="fu">J</span>(c, 1, 0)</span>
<span id="cb195-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb195-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(a)</span>
<span id="cb195-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb195-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb195-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb195-8" aria-hidden="true" tabindex="-1"></a>b = zeros(3)</span>
<span id="cb195-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb195-9" aria-hidden="true" tabindex="-1"></a>b</span>
<span id="cb195-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb195-10" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> </span></code></pre></div>
<p>Matriz:</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb196-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb196-1" aria-hidden="true" tabindex="-1"></a>* Generar una matriz</span>
<span id="cb196-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb196-2" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> </span>
<span id="cb196-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb196-3" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> zerosv1(<span class="fu">real</span> <span class="fu">scalar</span> c, <span class="fu">real</span> <span class="fu">scalar</span> <span class="fu">r</span>)</span>
<span id="cb196-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb196-4" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb196-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb196-5" aria-hidden="true" tabindex="-1"></a><span class="fu">real</span> <span class="fu">matrix</span> A </span>
<span id="cb196-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb196-6" aria-hidden="true" tabindex="-1"></a>A = <span class="fu">J</span>(c,<span class="fu">r</span>,0)</span>
<span id="cb196-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb196-7" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(A)</span>
<span id="cb196-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb196-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb196-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb196-9" aria-hidden="true" tabindex="-1"></a>b = zerosv1(3,2)</span>
<span id="cb196-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb196-10" aria-hidden="true" tabindex="-1"></a>b</span>
<span id="cb196-11"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb196-11" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> </span></code></pre></div>
<p>Hacer opcionales:</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb197-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> </span>
<span id="cb197-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb197-2" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> zerosv2(<span class="fu">real</span> <span class="fu">scalar</span> c,| <span class="fu">real</span> <span class="fu">scalar</span> <span class="fu">r</span>)</span>
<span id="cb197-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb197-3" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb197-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb197-4" aria-hidden="true" tabindex="-1"></a><span class="fu">real</span> <span class="fu">matrix</span> A</span>
<span id="cb197-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb197-5" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> (<span class="kw">args</span>()==1) <span class="fu">r</span> = 1</span>
<span id="cb197-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb197-6" aria-hidden="true" tabindex="-1"></a>A = <span class="fu">J</span>(c, <span class="fu">r</span>, 0)</span>
<span id="cb197-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb197-7" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(A)</span>
<span id="cb197-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb197-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb197-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb197-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> </span>
<span id="cb197-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb197-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-11"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb197-11" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> </span>
<span id="cb197-12"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb197-12" aria-hidden="true" tabindex="-1"></a>zerosv2(3,2)</span>
<span id="cb197-13"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb197-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb197-14"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb197-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-15"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb197-15" aria-hidden="true" tabindex="-1"></a><span class="kw">help</span> m2 <span class="kw">syntax</span></span></code></pre></div>
<p>Guardar:</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb198-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> </span>
<span id="cb198-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb198-2" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> zerosfinal(<span class="fu">real</span> <span class="fu">scalar</span> c,| <span class="fu">real</span> <span class="fu">scalar</span> <span class="fu">r</span>)</span>
<span id="cb198-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb198-3" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb198-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb198-4" aria-hidden="true" tabindex="-1"></a><span class="fu">real</span> <span class="fu">matrix</span> A</span>
<span id="cb198-5"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb198-5" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> (<span class="kw">args</span>()==1) <span class="fu">r</span> = 1</span>
<span id="cb198-6"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb198-6" aria-hidden="true" tabindex="-1"></a>A = <span class="fu">J</span>(c, <span class="fu">r</span>, 0)</span>
<span id="cb198-7"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb198-7" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(A)</span>
<span id="cb198-8"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb198-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb198-9"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb198-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-10"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb198-10" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> stata cd <span class="st">"\$ejercicios"</span></span>
<span id="cb198-11"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb198-11" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span> mosave zerosfinal(), <span class="kw">replace</span></span>
<span id="cb198-12"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb198-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-13"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb198-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> </span></code></pre></div>
<p>Dos referencias recomendadas para profundizar en Mata:</p>
<ul>
<li>An Introduction to Stata Programming, Second Edition ()</li>
<li>The Mata Book: A Book for Serious Programmers and Those Who Want to Be ()</li>
</ul>
</div>
</div>
</div>
<div id="exportar-información" class="section level2" number="2.7">
<h2>
<span class="header-section-number">2.7</span> Exportar Información<a class="anchor" aria-label="anchor" href="#exportar-informaci%C3%B3n"><i class="fas fa-link"></i></a>
</h2>
<p>Exportar información es parte importante del proceso de análisis de datos. En esta sección veremos algunas herramientas que permiten conectar los resultados del análisis hecho en Stata con los reportes que queremos crear en Word.</p>
<div id="stata-markdown" class="section level3" number="2.7.1">
<h3>
<span class="header-section-number">2.7.1</span> Stata Markdown<a class="anchor" aria-label="anchor" href="#stata-markdown"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>Herramienta para crear informes que sean reproducibles y en donde los datos, códigos y operaciones están conectadas.<br>
</li>
<li>Básicamente una intersección entre texto narrativo y</li>
<li>Es posible generar informes en distintos formatos (ej. html, docx, pdf). Hoy veremos como generar un informe en Word y una presentación en HTML.</li>
<li>Stata Markdown es especialmente útil para:
<ul>
<li>
<strong>Informes rutinarios:</strong> Informe semanas/mensual sobre un conjunto de datos que se actualizan constantemente.</li>
<li>
<strong>Documentar análisis:</strong> Es posible integrar reportes intermedios en un trabajo de análisis de datos. Estos informes pueden ser de utilidad para detectar errores y para supervisión en equipos de trabajo.</li>
</ul>
</li>
</ul>
<p>Stata Markdown y otras herramientas similares son claves para mejorar en términos de . Algunos argumentos basados en :</p>
<ul>
<li>
<strong>Ayuda a documentación:</strong> En la fase de procesamiento de datos podemos describir todos los pasos utilizados para convertir los datos brutos en variables de análisis, produciendo un documento con un buen formato, más claro y legible. Es posible pensar en estos informes como productos intermedios.</li>
<li>En la fase de análisis de los datos, podemos incluir el código, explicar las razones para probar determinados modelos, incluir los resultados, las tablas y las figuras, y comentar los resultados, todo ello sin tener que cortar y pegar de forma tediosa y propensa a errores.</li>
<li>En la fase de presentación, podemos elaborar un informe centrado en los resultados, con la opción de ocultar los comandos reales utilizados para que no aparezcan en el documento final.</li>
</ul>
<p>Algunos conceptos</p>
<ul>
<li>
<strong>Markdown:</strong> Es un lenguaje que permite escribir documentos en texto plano. Los archivos escritos en Markdown tienen la extensión <code>md</code>.</li>
<li>
<strong>Stata Markdown:</strong> Es la variación especifica para Stata. Se implementa a través del comando <code>markstat</code> hecho por <a href="https://data.princeton.edu/stata/markdown">Germán Rodriguez</a>. Estos archivos tiene extensión <code>.stmd</code>.</li>
</ul>
<div id="instalación" class="section level4" number="2.7.1.1">
<h4>
<span class="header-section-number">2.7.1.1</span> Instalación<a class="anchor" aria-label="anchor" href="#instalaci%C3%B3n"><i class="fas fa-link"></i></a>
</h4>
<p>En Stata, ejecuta estos comandos:</p>
<ul>
<li>
<code>ssc install</code> markstat</li>
<li>
<code>ssc install</code> whereis<br>
</li>
<li>Instalar padcoc desde <code>pandoc.org/installing</code>
</li>
<li>Decirle a <code>markstat</code> donde encontrar pandoc. En mi caso es:</li>
</ul>
<div class="sourceCode" id="cb199"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb199-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb199-1" aria-hidden="true" tabindex="-1"></a>whereis pandoc <span class="st">"C:\Users</span><span class="ch">\n</span><span class="st">icol\AppData\Local\Pandoc\pandoc.exe"</span></span></code></pre></div>
</div>
<div id="funcionalidades" class="section level4" number="2.7.1.2">
<h4>
<span class="header-section-number">2.7.1.2</span> Funcionalidades<a class="anchor" aria-label="anchor" href="#funcionalidades"><i class="fas fa-link"></i></a>
</h4>
<p>Algunos elementos que vamos a utilizar en Stata Markdown:</p>
<ul>
<li>Ecuaciones y notación matemática utilizando (para los que lo sepan utilizar).</li>
<li>Hacer títulos y encabezados.</li>
<li>Enfatizar texto (negritas e itálicas).</li>
<li>Armas listas numeradas y no numeradas.</li>
<li>Poder mostrar líneas de código, resultados directamente de Stata. Esto incluye Mata.</li>
<li>Insertar quiebres de páginas: <code>\newpage</code>.</li>
</ul>
</div>
<div id="generar-un-documento" class="section level4" number="2.7.1.3">
<h4>
<span class="header-section-number">2.7.1.3</span> Generar un documento<a class="anchor" aria-label="anchor" href="#generar-un-documento"><i class="fas fa-link"></i></a>
</h4>
<p>Como mencionamos anteriormente es posible generar un documento de word, pdf o html que contenga todos los códigos, resultados, tablas y figuras hechas en Stata. Para generar un documento es necesario:</p>
<ul>
<li>Escribir en tu editor de códigos preferido un archivo en formato <code>stmd</code>. En nuestro caso escribiremos un archivo que se llama <code>ejemplo1.stmd</code>. Guardar el archivo en tu carpeta de trabajo.</li>
<li>Ejecutar el comando <code>markstat</code> según el tipo de archivo que desee generar. En nuestro caso será:</li>
</ul>
<div class="sourceCode" id="cb200"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb200-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb200-1" aria-hidden="true" tabindex="-1"></a>markstat <span class="kw">using</span> ejemplo1, <span class="ot">strict</span> docx</span></code></pre></div>
</div>
</div>
<div id="putdocx" class="section level3" number="2.7.2">
<h3>
<span class="header-section-number">2.7.2</span> Putdocx<a class="anchor" aria-label="anchor" href="#putdocx"><i class="fas fa-link"></i></a>
</h3>
<p>La ventaja de <code>putdocx</code> radica en que es posible personalizar un poco más las tablas. Esto permite conectar el informe final con el trabajo de análisis de datos.</p>
<div id="algunos-comandos-útiles" class="section level4" number="2.7.2.1">
<h4>
<span class="header-section-number">2.7.2.1</span> Algunos comandos útiles<a class="anchor" aria-label="anchor" href="#algunos-comandos-%C3%BAtiles"><i class="fas fa-link"></i></a>
</h4>
<p>Crear, pegar y guardar documentos:</p>
<ul>
<li>
<code>putdocx begin</code>: Crea un archivo docx para exportar.</li>
<li>
<code>putdocx describe</code>: Describe los contenidos de archivo.</li>
<li>
<code>putdocx save</code>: Guarda y cierra el archivo.</li>
<li>
<code>putdocx clear</code>: Cierra el archivo sin guardar.</li>
<li>
<code>putdocx append</code>: Combina el contenido de múltiples archivos.</li>
</ul>
<p>Insertar quiebres de páginas:
* <code>putdocx pagebreak</code>: Agrega una nueva página.
* <code>putdocx sectionbreak</code>: Agrega una nueva sección.</p>
<p>Agregar párrafos con texto e imágenes:
* <code>putdocx paragraph</code>: Agrega un nuevo párrafo.
* <code>putdocx text</code>: Agrega un bloque de texto a un párrafo.
* <code>putdocx image</code>: Agrega una imagen al párrafo.</p>
</div>
<div id="tablas" class="section level4" number="2.7.2.2">
<h4>
<span class="header-section-number">2.7.2.2</span> Tablas:<a class="anchor" aria-label="anchor" href="#tablas"><i class="fas fa-link"></i></a>
</h4>
<p><code>putdocx table</code>: Crea una nueva tabla en el documento la que puede contener resultados de estimaciones, estadística descriptiva o datos.
<code>putdocx sectionbreak</code>: Agrega una nueva sección.</p>
</div>
</div>
</div>
<div id="manejo-de-grandes-bases-de-datos-en-stata" class="section level2" number="2.8">
<h2>
<span class="header-section-number">2.8</span> Manejo de grandes bases de datos en Stata<a class="anchor" aria-label="anchor" href="#manejo-de-grandes-bases-de-datos-en-stata"><i class="fas fa-link"></i></a>
</h2>
<div id="estilo-de-codificación-mejorar-velocidad-y-eficiencia" class="section level3" number="2.8.1">
<h3>
<span class="header-section-number">2.8.1</span> Estilo de codificación: mejorar velocidad y eficiencia<a class="anchor" aria-label="anchor" href="#estilo-de-codificaci%C3%B3n-mejorar-velocidad-y-eficiencia"><i class="fas fa-link"></i></a>
</h3>
<p>Esta introducción esta basada en <strong>Suggestions on Stata programming style</strong> de Nicholas J. Cox.</p>
<p>Un buen estilo de codificación es por sobre todo <strong>claridad</strong>. Lo más importante es tener una <strong>estrategia</strong> y seguirla. En esta sección nos enfocaremos en algunos consejos de codificación que nos van a permitir mejorar la velocidad y eficiencia en el uso de Stata. Este punto es especialmente relevante cuando se trabaja con grandes bases de datos. Una lista de formas básicas de <strong>aumentar la velocidad y eficiencia</strong> al manejar grandes bases de datos:</p>
<ul>
<li>Testear siempre las condiciones claves. Hacerlo lo antes posible.</li>
<li>Utilizar <code>summarize, meanonly</code> cuando solo necesite este valor. Como regla general siempre he de preguntarme si lo que estoy obteniendo es útil o no.</li>
<li>Preferir <code>foreach</code> y <code>forvalues</code> sobre <code>while</code>. Son más rápidos.<br>
</li>
<li>Evitar el uso de <code>macro shift</code>. Con muchas variables, se vuelve muy lento. Mejor ocuapar un <code>forvalues</code>.</li>
<li>Evitar siempre que sea posible iterar sobre observaciones. Mata puede ser útil en este aspecto.</li>
<li>Evite usar <code>preserve</code> si es posible. Es atractivo para el programar pero puede ser costoso en tiempo cuando se utilizan grandes bases de datos. Es bueno profundizar en el uso de <code>marksample</code> con el fin de hacer programas efectivos.</li>
<li>Las variables temporales se eliminarán automáticamente al final de un programa, pero también considere la posibilidad de eliminarlas cuando ya no sean necesarias para minimizar la sobrecarga de memoria y reducir las posibilidades de que su programa se detenga porque no hay espacio para añadir más variables.<br>
</li>
<li>Especifique el tipo de las variables temporales para minimizar la sobrecarga de memoria. Si se puede utilizar una variable de <code>bytes</code>, especifique: <code>generate bytes 'myvar'</code> en lugar de dejar que se utilice el tipo por defecto, que desperdiciaría espacio de almacenamiento.</li>
<li>Evite utilizar una variable para mantener una constante; una macro o un escalar suele ser todo lo que se necesita.</li>
</ul>
</div>
<div id="cargar-grandes-bases-de-datos" class="section level3" number="2.8.2">
<h3>
<span class="header-section-number">2.8.2</span> Cargar grandes bases de datos<a class="anchor" aria-label="anchor" href="#cargar-grandes-bases-de-datos"><i class="fas fa-link"></i></a>
</h3>
<p>Cuatro aspectos que considerar siempre que se desee cargar en Stata alguna base de datos de un tamaño considerable:</p>
<ol style="list-style-type: decimal">
<li>¿Necesita todas las variables del conjunto de datos? Si no es así, cargue sólo las variables que necesite:</li>
</ol>
<div class="sourceCode" id="cb201"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb201-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> var1 var2 var3 var4 <span class="kw">using</span> data1, <span class="kw">clear</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>¿Necesita todas las observaciones del conjunto de datos? Si no es así, importe sólo las observaciones que necesite:</li>
</ol>
<div class="sourceCode" id="cb202"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb202-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> data1 <span class="kw">if</span> state &lt;= 9, <span class="kw">clear</span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>¿Su conjunto de datos ocupa más espacio de almacenamiento del necesario?:</li>
</ol>
<ul>
<li>Intenta leer tu conjunto de datos poco a poco y optimizarlo.</li>
<li>Además de solo importar determinadas observaciones o variables, se optimiza el espacio de almacenamiento utilizado <code>compress</code>.</li>
<li>Es posible inspeccionar la base de datos sin cargarla.</li>
</ul>
<div class="sourceCode" id="cb203"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb203-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="kw">describe</span> <span class="kw">using</span> <span class="kw">data</span>.1.dta</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>¿Su conjunto de datos contiene muchas observaciones idénticas?: Debe transformar el conjunto de datos en un conjunto de datos ponderado por frecuencia.</li>
</ol>
</div>
<div id="reducir-el-uso-de-memoria" class="section level3" number="2.8.3">
<h3>
<span class="header-section-number">2.8.3</span> Reducir el uso de memoria<a class="anchor" aria-label="anchor" href="#reducir-el-uso-de-memoria"><i class="fas fa-link"></i></a>
</h3>
<p>Cuando usted trabaja con un conjunto de datos en Stata, Stata debe cargar todo el conjunto de datos en la memoria de la computadora (RAM). Afortunadamente, las computadoras portátiles de hoy tienen más memoria que la mayoría de los servidores de hace 20 años, y la mayoría de la gente nunca tiene que preocuparse por la cantidad de memoria que Stata está utilizando.</p>
<p>¿Me tengo que preocupar de la memoria?</p>
<ul>
<li>Sólo tienes que preocuparte por la memoria si el tamaño de tu conjunto de datos se aproxima a la cantidad de memoria del ordenador que utilizas, y si es mayor, definitivamente tienes un problema.</li>
<li>Si usted trabaja con grandes conjuntos de datos, debe tener cuidado: tratar de usar más memoria de la que tiene terminará mal.</li>
<li>¿Cuando es mucho?: un Laptop tipico tiene 16gb.</li>
</ul>
</div>
<div id="reducir-el-tamaño-de-la-base-de-datos" class="section level3" number="2.8.4">
<h3>
<span class="header-section-number">2.8.4</span> Reducir el tamaño de la base de datos<a class="anchor" aria-label="anchor" href="#reducir-el-tama%C3%B1o-de-la-base-de-datos"><i class="fas fa-link"></i></a>
</h3>
<p>Elimina datos innecesarios. Utiliza tipos de variables pequeños: <code>help datatypes</code>. Siempre que crees una variable es una buena practica especificar el tipo de dato. Acortar cadenas o codificarlas: <code>strings</code> requieren un byte por caracteres.</p>
<p>Sin embargo, para las observaciones todas tienen el mismo tamaño. Si tengo una variable que contiene: “Si”, “No”, “No lo se”. La variable utilizara 8 bytes por observación tal como si solo tuviese “No lo se”. Si tu cambias “no lo se” por “ns”. Ahora solo se utilizaran 2 bytes por observacion. Si tu cambias a: “S”, “N”, “I” solo utilizara un byte por observación.</p>
<p>Codificar la variable de <code>string</code> como una variable númerica tambien reduce el espacio en memerio a un byte por observación. Se recomiendo agregar <code>labels</code> y trabajar los <code>string</code> de esta forma cuando sea posible.</p>
</div>
<div id="eliminar-siempre-resultados-intermedios-incluso-temporales" class="section level3" number="2.8.5">
<h3>
<span class="header-section-number">2.8.5</span> Eliminar siempre resultados intermedios, incluso temporales<a class="anchor" aria-label="anchor" href="#eliminar-siempre-resultados-intermedios-incluso-temporales"><i class="fas fa-link"></i></a>
</h3>
<p>Elimina resultados intermedios. Si creas variables para almacenar resultados intermedios, elimínelas tan pronto como haya terminado con ellas.</p>
<p>Por ejemplo, el siguiente código crea una variable llamada incomePovertyRatio sólo para poder crear una variable indicadora lowIncome que identifica a los sujetos cuyos ingresos son inferiores al 150% del nivel de pobreza</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb204-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> incomePovertyRatio = income/povertyLevel</span>
<span id="cb204-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb204-2" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> lowIncome = (incomePovertyRatio &lt; 1.5)</span>
<span id="cb204-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb204-3" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> incomePovertyRatio</span></code></pre></div>
<p>Debes eliminar la variable que no utilizas. Hacer esto siempre.</p>
</div>
<div id="dividir-en-trozos-cuando-sea-posible" class="section level3" number="2.8.6">
<h3>
<span class="header-section-number">2.8.6</span> Dividir en trozos cuando sea posible<a class="anchor" aria-label="anchor" href="#dividir-en-trozos-cuando-sea-posible"><i class="fas fa-link"></i></a>
</h3>
<p>Si un conjunto de datos es demasiado grande para cargarlo en la memoria, para algunas tareas puede dividirlo en un conjunto de conjuntos de datos más pequeños y trabajar con ellos de uno en uno. Puede haber una variable categórica en el conjunto de datos de tal manera que un conjunto de datos separado para cada categoría funcionaría bien, o puede dividirlo por número de observación.</p>
<p>Dividir el conjunto de datos en trozos más pequeños probablemente sólo tiene sentido si puedes reducir el tamaño de cada trozo para que al final puedas combinarlos todos en un único conjunto de datos que pueda cargarse en la memoria.</p>
</div>
<div id="sort" class="section level3" number="2.8.7">
<h3>
<span class="header-section-number">2.8.7</span> Sort<a class="anchor" aria-label="anchor" href="#sort"><i class="fas fa-link"></i></a>
</h3>
<p><code>sort</code> en Stata es razonablemente eficiente: un millón de valores aleatorios pueden ponerse en orden creciente en menos de 3 segundos con <code>sort x</code>. Sin embargo, el comando no tiene una opción inversa para ordenar de mayor a menor.</p>
<p><code>gsort</code> hace una ordenación decreciente de forma ineficiente - ordena de forma creciente en x, y luego ordena de forma creciente en menos <code>_n</code>. Esencialmente está haciendo:</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb205-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb205-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">sort</span> x</span>
<span id="cb205-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb205-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">gen</span> <span class="kw">long</span> sortvar = -<span class="dt">_n</span></span>
<span id="cb205-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb205-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">sort</span> sortvar</span>
<span id="cb205-4"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb205-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">drop</span> sortvar</span></code></pre></div>
<p>Es mejor negar por usted mismo antes de una ordenación creciente:</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb206-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> negx = -x</span>
<span id="cb206-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb206-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">sort</span> negx</span></code></pre></div>
</div>
<div id="selección-de-muestra" class="section level3" number="2.8.8">
<h3>
<span class="header-section-number">2.8.8</span> Selección de muestra<a class="anchor" aria-label="anchor" href="#selecci%C3%B3n-de-muestra"><i class="fas fa-link"></i></a>
</h3>
<p>Separar la selección de variables de la inclusión. Para minimizar la cantidad de memoria utilizada, necesitamos separar la decisión de selección de la muestra de la decisión de inclusión de la variable.</p>
</div>
<div id="precaución-con-reshape" class="section level3" number="2.8.9">
<h3>
<span class="header-section-number">2.8.9</span> Precaución con reshape<a class="anchor" aria-label="anchor" href="#precauci%C3%B3n-con-reshape"><i class="fas fa-link"></i></a>
</h3>
<p>El comando <code>reshape</code> es inexplicablemente lento. 13 segundos por millón de observaciones en mi computadora. Es importante pensar en codificación y buscar más opciones para hacer <code>reshape</code>. Se puede escribir un archivo separado para cada año de datos, y luego concatenarlos en un largo conjunto de datos en unos 2 segundos.</p>
</div>
<div id="subexpresiones-comunes" class="section level3" number="2.8.10">
<h3>
<span class="header-section-number">2.8.10</span> Subexpresiones comunes<a class="anchor" aria-label="anchor" href="#subexpresiones-comunes"><i class="fas fa-link"></i></a>
</h3>
<p>A menudo, varias sentencias generate o replace tendrán subexpresiones comunes.</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb207-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> <span class="fu">y</span> = a <span class="kw">if</span> c==<span class="kw">d</span> &amp; <span class="fu">e</span>==f</span>
<span id="cb207-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb207-2" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> x = b <span class="kw">if</span> c==<span class="kw">d</span> &amp; <span class="fu">e</span>==f</span></code></pre></div>
<p>Una mejor opcion es precalcularlo.</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb208-1"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> smpl = c==<span class="kw">d</span> &amp; <span class="fu">e</span>==f</span>
<span id="cb208-2"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb208-2" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> <span class="fu">y</span> = a <span class="kw">if</span> smpl</span>
<span id="cb208-3"><a href="an%C3%A1lisis-de-datos-con-stata.html#cb208-3" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> x = b <span class="kw">if</span> smpl</span></code></pre></div>
</div>
<div id="recomendaciones-adicionales" class="section level3" number="2.8.11">
<h3>
<span class="header-section-number">2.8.11</span> Recomendaciones Adicionales<a class="anchor" aria-label="anchor" href="#recomendaciones-adicionales"><i class="fas fa-link"></i></a>
</h3>
<div id="collapse" class="section level4" number="2.8.11.1">
<h4>
<span class="header-section-number">2.8.11.1</span> Collapse<a class="anchor" aria-label="anchor" href="#collapse"><i class="fas fa-link"></i></a>
</h4>
<p><code>collapse</code> no es muy rápido. El autor, sin duda, supuso que aunque se utilizara con grandes conjuntos de datos, no estaría dentro de una iteración. Pero a veces lo está, y puede convertirse en el paso limitante de la velocidad en un programa de larga duración. Se puede reemplazar fácilmente con código más rápido, pero el beneficio total no es tan grande como uno esperaría. Mejor ocupar <code>gtools</code>.</p>
</div>
<div id="egen" class="section level4" number="2.8.11.2">
<h4>
<span class="header-section-number">2.8.11.2</span> Egen<a class="anchor" aria-label="anchor" href="#egen"><i class="fas fa-link"></i></a>
</h4>
<p><code>egen</code> tambien puede ser adecuado para que funcione más rapido. Vamos a ver un ejemplo calculando el máximo de una variable.</p>
</div>
<div id="regresiones-en-sub-grupos" class="section level4" number="2.8.11.3">
<h4>
<span class="header-section-number">2.8.11.3</span> Regresiones en sub-grupos<a class="anchor" aria-label="anchor" href="#regresiones-en-sub-grupos"><i class="fas fa-link"></i></a>
</h4>
<p>Exiten varias opciones para calcular regresiones según el tipo de datos que queramos incluir en nuestra muestra. Vamos a ver distintas opciones y ver su desempeño en bases de datos grandes.</p>
</div>
<div id="recode" class="section level4" number="2.8.11.4">
<h4>
<span class="header-section-number">2.8.11.4</span> Recode<a class="anchor" aria-label="anchor" href="#recode"><i class="fas fa-link"></i></a>
</h4>
<p><code>recode</code> puede ser modificado utilizando matrices. Otra opción es utilizar <code>ggtools</code></p>
</div>
</div>
<div id="resumen" class="section level3" number="2.8.12">
<h3>
<span class="header-section-number">2.8.12</span> Resumen<a class="anchor" aria-label="anchor" href="#resumen"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>Utilizar <code>compress</code>.
</li>
<li>Mantener solo las variables que se van a utilizar.</li>
<li>Mantener solo las observaciones que se van a utilizar.</li>
<li>Cargar solo las variables y observaciones necesarias.</li>
<li>
<code>keepusing</code> y <code>nogen</code> siempre para <code>merge</code>.</li>
<li>
<code>ftools</code> y <code>gtools</code> (más detalles sección final).</li>
<li>Utilizar <code>parallel</code> (más detalles sección final).</li>
</ul>
</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="index.html"><span class="header-section-number">1</span> Introducción</a></div>
<div class="next"><a href="referencias.html"><span class="header-section-number">3</span> Referencias</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#an%C3%A1lisis-de-datos-con-stata"><span class="header-section-number">2</span> Análisis de datos con Stata</a></li>
<li>
<a class="nav-link" href="#buenas-pr%C3%A1cticas-de-programaci%C3%B3n-y-visualizaci%C3%B3n"><span class="header-section-number">2.1</span> Buenas prácticas de programación y visualización</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#introducci%C3%B3n-1"><span class="header-section-number">2.1.1</span> Introducción</a></li>
<li><a class="nav-link" href="#estilo-de-codificaci%C3%B3n-en-stata"><span class="header-section-number">2.1.2</span> Estilo de codificación en Stata</a></li>
<li><a class="nav-link" href="#organizaci%C3%B3n-de-un-proyecto-en-stata"><span class="header-section-number">2.1.3</span> Organización de un proyecto en Stata</a></li>
<li><a class="nav-link" href="#buenas-practicas-de-visualizaci%C3%B3n"><span class="header-section-number">2.1.4</span> Buenas practicas de visualización</a></li>
<li><a class="nav-link" href="#sublime-text"><span class="header-section-number">2.1.5</span> Sublime Text</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#programar-do---files-parte-i"><span class="header-section-number">2.2</span> Programar do - files (Parte I)</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#programar-en-stata"><span class="header-section-number">2.2.1</span> Programar en Stata</a></li>
<li><a class="nav-link" href="#comandos-y-funciones-claves-y-algunos-detalles"><span class="header-section-number">2.2.2</span> Comandos y funciones claves (y algunos detalles)}</a></li>
<li><a class="nav-link" href="#macros-locales-y-globales"><span class="header-section-number">2.2.3</span> Macros locales y globales</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#programar-do---files-parte-ii"><span class="header-section-number">2.3</span> Programar do - files (Parte II)</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#estructuras-de-datos"><span class="header-section-number">2.3.1</span> Estructuras de datos</a></li>
<li><a class="nav-link" href="#iteradores"><span class="header-section-number">2.3.2</span> Iteradores</a></li>
<li><a class="nav-link" href="#manejo-de-bases-de-datos"><span class="header-section-number">2.3.3</span> Manejo de bases de datos</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#programar-ado---files-parte-i"><span class="header-section-number">2.4</span> Programar ado - files (Parte I)</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#escribir-programas-en-stata"><span class="header-section-number">2.4.1</span> Escribir programas en Stata</a></li>
<li><a class="nav-link" href="#por-qu%C3%A9-escribir-programas-abstracci%C3%B3n"><span class="header-section-number">2.4.2</span> ¿Por qué escribir programas?: Abstracción</a></li>
<li><a class="nav-link" href="#mis-primeros-programas-en-stata"><span class="header-section-number">2.4.3</span> Mis primeros programas en Stata</a></li>
<li><a class="nav-link" href="#programa-con-distintos-argumentos"><span class="header-section-number">2.4.4</span> Programa con distintos argumentos</a></li>
<li><a class="nav-link" href="#opci%C3%B3n-syntax"><span class="header-section-number">2.4.5</span> Opción Syntax</a></li>
<li><a class="nav-link" href="#return"><span class="header-section-number">2.4.6</span> Return</a></li>
<li><a class="nav-link" href="#implementar-opciones-al-programa"><span class="header-section-number">2.4.7</span> Implementar opciones al programa</a></li>
<li><a class="nav-link" href="#incluir-ifin-al-programa"><span class="header-section-number">2.4.8</span> Incluir if/in al programa</a></li>
<li><a class="nav-link" href="#generalizar-el-comando-para-incluir-m%C3%BAltiples-variables"><span class="header-section-number">2.4.9</span> Generalizar el comando para incluir múltiples variables</a></li>
<li><a class="nav-link" href="#agregar-prefijos-a-los-programas"><span class="header-section-number">2.4.10</span> Agregar prefijos a los programas</a></li>
<li><a class="nav-link" href="#programas-para-complementar-funci%C3%B3n-egen"><span class="header-section-number">2.4.11</span> Programas para complementar función egen</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#programar-ado---files-parte-ii"><span class="header-section-number">2.5</span> Programar ado - files (Parte II)</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#syntax"><span class="header-section-number">2.5.1</span> Syntax</a></li>
<li><a class="nav-link" href="#varlist"><span class="header-section-number">2.5.2</span> Varlist</a></li>
<li><a class="nav-link" href="#opciones"><span class="header-section-number">2.5.3</span> Opciones</a></li>
<li><a class="nav-link" href="#programa-para-calcular-percentiles"><span class="header-section-number">2.5.4</span> Programa para calcular percentiles</a></li>
<li><a class="nav-link" href="#programa-con-opci%C3%B3n-return"><span class="header-section-number">2.5.5</span> Programa con opción return</a></li>
<li><a class="nav-link" href="#agregar-opciones-al-programa"><span class="header-section-number">2.5.6</span> Agregar opciones al programa</a></li>
<li><a class="nav-link" href="#generalizar-el-comando-para-incluir-m%C3%BAltiples-variables-1"><span class="header-section-number">2.5.7</span> Generalizar el comando para incluir múltiples variables</a></li>
<li><a class="nav-link" href="#agregar-prefijos-a-los-programas-1"><span class="header-section-number">2.5.8</span> Agregar prefijos a los programas</a></li>
<li><a class="nav-link" href="#programas-para-complementar-funci%C3%B3n-egen-1"><span class="header-section-number">2.5.9</span> Programas para complementar función egen</a></li>
<li><a class="nav-link" href="#generalizaci%C3%B3n-de-la-funci%C3%B3n-egen"><span class="header-section-number">2.5.10</span> Generalización de la función egen</a></li>
<li><a class="nav-link" href="#documentar-tu-programa"><span class="header-section-number">2.5.11</span> Documentar tu programa</a></li>
<li><a class="nav-link" href="#escribir-programas-e-class"><span class="header-section-number">2.5.12</span> Escribir programas e-class</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#programar-ado---files-parte-iii"><span class="header-section-number">2.6</span> Programar ado - files (Parte III)</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#marksample-mark-y-markout"><span class="header-section-number">2.6.1</span> Marksample, Mark y Markout</a></li>
<li><a class="nav-link" href="#sortpreserve"><span class="header-section-number">2.6.2</span> Sortpreserve</a></li>
<li><a class="nav-link" href="#mata"><span class="header-section-number">2.6.3</span> Mata</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#exportar-informaci%C3%B3n"><span class="header-section-number">2.7</span> Exportar Información</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#stata-markdown"><span class="header-section-number">2.7.1</span> Stata Markdown</a></li>
<li><a class="nav-link" href="#putdocx"><span class="header-section-number">2.7.2</span> Putdocx</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#manejo-de-grandes-bases-de-datos-en-stata"><span class="header-section-number">2.8</span> Manejo de grandes bases de datos en Stata</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#estilo-de-codificaci%C3%B3n-mejorar-velocidad-y-eficiencia"><span class="header-section-number">2.8.1</span> Estilo de codificación: mejorar velocidad y eficiencia</a></li>
<li><a class="nav-link" href="#cargar-grandes-bases-de-datos"><span class="header-section-number">2.8.2</span> Cargar grandes bases de datos</a></li>
<li><a class="nav-link" href="#reducir-el-uso-de-memoria"><span class="header-section-number">2.8.3</span> Reducir el uso de memoria</a></li>
<li><a class="nav-link" href="#reducir-el-tama%C3%B1o-de-la-base-de-datos"><span class="header-section-number">2.8.4</span> Reducir el tamaño de la base de datos</a></li>
<li><a class="nav-link" href="#eliminar-siempre-resultados-intermedios-incluso-temporales"><span class="header-section-number">2.8.5</span> Eliminar siempre resultados intermedios, incluso temporales</a></li>
<li><a class="nav-link" href="#dividir-en-trozos-cuando-sea-posible"><span class="header-section-number">2.8.6</span> Dividir en trozos cuando sea posible</a></li>
<li><a class="nav-link" href="#sort"><span class="header-section-number">2.8.7</span> Sort</a></li>
<li><a class="nav-link" href="#selecci%C3%B3n-de-muestra"><span class="header-section-number">2.8.8</span> Selección de muestra</a></li>
<li><a class="nav-link" href="#precauci%C3%B3n-con-reshape"><span class="header-section-number">2.8.9</span> Precaución con reshape</a></li>
<li><a class="nav-link" href="#subexpresiones-comunes"><span class="header-section-number">2.8.10</span> Subexpresiones comunes</a></li>
<li><a class="nav-link" href="#recomendaciones-adicionales"><span class="header-section-number">2.8.11</span> Recomendaciones Adicionales</a></li>
<li><a class="nav-link" href="#resumen"><span class="header-section-number">2.8.12</span> Resumen</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Análisis de Datos con Stata, R y Python</strong>" was written by Nicolás Campos Bijit. It was last built on Octubre 2023.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
